{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/apollo-enhance/source/favicon.png","path":"favicon.png","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/css/apollo.css","path":"css/apollo.css","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/scss/apollo.scss","path":"scss/apollo.scss","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/images/gitbook/0.png","path":"images/gitbook/0.png","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/images/gitbook/1.png","path":"images/gitbook/1.png","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/images/gitbook/2.png","path":"images/gitbook/2.png","modified":1,"renderable":1},{"_id":"themes/apollo-enhance/source/images/gitbook/3.png","path":"images/gitbook/3.png","modified":1,"renderable":1}],"Cache":[{"_id":"themes/apollo-enhance/LICENSE","hash":"1588511f0c37609ebfb55298b83a77ae5afca870","modified":1473923608162},{"_id":"themes/apollo-enhance/README.md","hash":"f017e433f0883fb0eadd768e9f1650e13465870f","modified":1473923608162},{"_id":"themes/apollo-enhance/_config.yml","hash":"78a282d20de82be4adf3b67cd243183d50efaca3","modified":1473923608163},{"_id":"themes/apollo-enhance/gulpfile.js","hash":"3bf61bca569665944cc61ac0483c9d568a4f58d7","modified":1473923608164},{"_id":"themes/apollo-enhance/package.json","hash":"fa63aee8ca050ec794093182245573659a46d07c","modified":1473923608172},{"_id":"source/me/.index.md","hash":"fd1942cf31e5174a6d8d80e5aaf4f89d8866c408","modified":1473923608160},{"_id":"source/me/index.md","hash":"a1a534871b28a772a206b7c34f70491ef0b0d918","modified":1474018551332},{"_id":"source/_posts/CentOS-Debian等Linux发行版更新镜像源-1.md","hash":"3f68ae2d03c8ce04cfcbe554d31afffccaed6023","modified":1473923608129},{"_id":"source/_posts/CentOS-jemalloc库缺失问题.md","hash":"5cd1fbc4f005d5d01874efe2f43f9b5f09c9ab82","modified":1473923608129},{"_id":"source/_posts/CentOS-无人值守安装-ftp模式.md","hash":"b95940c31d50d7f66b889bbf17e178b182b88a48","modified":1473923608130},{"_id":"source/_posts/CentOS6-5-Kernel2-6-Compile-PHP5-6-1.md","hash":"e783cb481895daea490177f3ea9aea061cfc8fea","modified":1473923608130},{"_id":"source/_posts/Knockoutjs-实现省市联动.md","hash":"3582fe524b53da5b405480c2b414d709c13d5efe","modified":1473923608138},{"_id":"source/_posts/MySQL-InnoDB存储引擎外键约束.md","hash":"6643851df852cce4a2c756cbc2ef65f496bbf61b","modified":1473923608138},{"_id":"source/_posts/MySQL单台服务器跑多个实例子.md","hash":"fcc5fdd8141dafff6219a9a4b15ce981a0bfd384","modified":1473923608139},{"_id":"source/_posts/PHP5-4-Trait-使用.md","hash":"8dbb3736b114be917a04ab305cb1f3013a88a69e","modified":1473923608139},{"_id":"source/_posts/PHP分页算法.md","hash":"a5f8a1c500827a828ecd9d0f4534061951a79d9e","modified":1473923608139},{"_id":"source/_posts/RazorSQL-注册码.md","hash":"cdbc80eebe9310890184242b3cec59a049dc6536","modified":1473923608140},{"_id":"source/_posts/bashshell-case-syntax.md","hash":"c72563e7e09885fb0e0321d0992a5c088ee94ef3","modified":1473923608140},{"_id":"source/_posts/js多对象数组唯一方法.md","hash":"3efbed3b19db5a13f97bf562c50bbcafa7f6ca7e","modified":1473923608141},{"_id":"source/_posts/linux下nginx-php-fpm运行用户以及资源目录的权限.md","hash":"5c70970e61d0b79e12e24deb7c67a614c013a540","modified":1473923608141},{"_id":"source/_posts/mysql主从备份.md","hash":"433d286f2d59ddc4a9b1c38cd2b9a280d07391c6","modified":1473923608141},{"_id":"source/_posts/php图片水印类.md","hash":"218bd9d7ee36496a9e7e0572e4a6b3116b692cd7","modified":1473923608142},{"_id":"source/_posts/redis数据迁移.md","hash":"7053b972fcbf3156fb8df679a24224828a13a534","modified":1473923608142},{"_id":"source/_posts/vagrant搭建lamp开发环境.md","hash":"5739d5e5f836dc51068ec93c8dc3a522d582087a","modified":1473923608143},{"_id":"source/_posts/使用gitbook整合github快速构建文档.md","hash":"af5f5a9c7f8623a3e7f270f2fe304a177cfce490","modified":1473923608144},{"_id":"source/_posts/判断ip是内网还是外网-判断请求来之pc还是mobile.md","hash":"616b077c260bbbaf5a9cea1d6112c10ac1000b99","modified":1473923608144},{"_id":"source/_posts/单点登入(SSO)实现.md","hash":"0a5ec847a0a038c8d241cd6fad11cdf22e2c814d","modified":1473923608145},{"_id":"source/_posts/如何实现6位数表示百亿.md","hash":"9d808052a0808ccb8e80de0146b2670aebe75d3a","modified":1473923608145},{"_id":"source/_posts/批量删除redis制定键.md","hash":"ae58fc83bcb023e737f799ec844e3df0a0efaeb6","modified":1473923608145},{"_id":"source/_posts/时间戳转日期，日期装时间戳快速tempermonkey脚本.md","hash":"5d9dd7d520c24e87873ed620ac1a3dc206a49ed9","modified":1473923608146},{"_id":"source/_posts/简单的mysql过程实现数据行累加.md","hash":"8579e6b546a6f318deb3340bb3c5391a03e0acd8","modified":1473923608146},{"_id":"source/_posts/自动更新hosts文件-访问google-facebook.md","hash":"e5f8a25b0c8968a44b5b5318b8d9fdc7df2614c7","modified":1473923608146},{"_id":"source/_posts/［chrome／chromium］插件-vimium-简单使用.md","hash":"32cfa736a0bb36a5317678a1b1d48dab141f8e2d","modified":1473923608159},{"_id":"themes/apollo-enhance/doc/doc-en.md","hash":"123aa670151db03ba5b1a20eaeef2cd3c9bec2b9","modified":1473923608163},{"_id":"themes/apollo-enhance/doc/doc-zh.md","hash":"f2ef939e9b39d4d150d613f68a80ca65425d406a","modified":1473923608164},{"_id":"themes/apollo-enhance/languages/en.yml","hash":"29b8e211d422cb846af005bd1c21435b45ed6457","modified":1473923608165},{"_id":"themes/apollo-enhance/languages/zh-cn.yml","hash":"05ef430fa5586e919839bad35aba4a9690e8e672","modified":1473923608166},{"_id":"themes/apollo-enhance/layout/archive.jade","hash":"a993dddad0213cfc4adbf5d25597b7effac758b0","modified":1473923608166},{"_id":"themes/apollo-enhance/layout/index.jade","hash":"fd11746c566d9fb6de1224a2992e3e443a83c139","modified":1473923608167},{"_id":"themes/apollo-enhance/layout/post.jade","hash":"ada9f5f76819ff76d2c37c893431dfdb808e19b7","modified":1473923608171},{"_id":"themes/apollo-enhance/source/favicon.png","hash":"9c9b1cd3887d68155cde3214d7583dc59f8e39ed","modified":1473924367507},{"_id":"themes/apollo-enhance/layout/mixins/paginator.jade","hash":"47712f8bb3d84ff6a2742f923626d568779fc45a","modified":1473923608167},{"_id":"themes/apollo-enhance/layout/mixins/post.jade","hash":"b9a6ca7d8769312cef09c86dbd6828bc04663ca2","modified":1473923608167},{"_id":"themes/apollo-enhance/layout/partial/comment.jade","hash":"009ec92b9038cfc8a0af3fa9e91ab2184a4f3f7b","modified":1473923608168},{"_id":"themes/apollo-enhance/layout/partial/copyright.jade","hash":"ffc9aa3346afe51c452eacfd87123568702727e6","modified":1473923608168},{"_id":"themes/apollo-enhance/layout/partial/head.jade","hash":"8e861e246f28a0ce707c4962de3f31909690d85c","modified":1473923608169},{"_id":"themes/apollo-enhance/layout/partial/layout.jade","hash":"54545f4a0c0ca26156364258bf9f4d74fc611f84","modified":1473923608170},{"_id":"themes/apollo-enhance/layout/partial/nav.jade","hash":"671b604bc38f43dfb17ea2592639ed27f4845e9f","modified":1473923608170},{"_id":"themes/apollo-enhance/layout/partial/scripts.jade","hash":"01166ea99e025d2c3ec6fa351f20a80d780a81b7","modified":1473923608170},{"_id":"themes/apollo-enhance/source/css/apollo.css","hash":"4436d9f64fff2615fb3236746c0fb0dd05b74f32","modified":1473925741459},{"_id":"themes/apollo-enhance/source/scss/apollo.scss","hash":"c05604c2b0c9b0a284ba1bce82880c495409dd4d","modified":1473923608178},{"_id":"themes/apollo-enhance/source/images/gitbook/0.png","hash":"ee6d5ddeee3703c4c55d77a84010dc3e52a33517","modified":1473923608116},{"_id":"themes/apollo-enhance/source/images/gitbook/1.png","hash":"f6a5b4f29288eec76524d4755abe0940afd49ca7","modified":1473923608117},{"_id":"themes/apollo-enhance/source/images/gitbook/2.png","hash":"b084b85ede4d499169ec2d5b00f58e0118927c8c","modified":1473923608118},{"_id":"themes/apollo-enhance/source/images/gitbook/3.png","hash":"be5da24d8dc08782fc4e55928a172b60a183c250","modified":1473923608118},{"_id":"themes/apollo-enhance/source/scss/_partial/archive-post-list.scss","hash":"3003361c281d7aa1cfed944ad0da180ac05f2c32","modified":1473923608174},{"_id":"themes/apollo-enhance/source/scss/_partial/base.scss","hash":"3cefb01c0d30fe09afb24b495060881ff31b9324","modified":1473923608174},{"_id":"themes/apollo-enhance/source/scss/_partial/copyright.scss","hash":"e87b144a8389eefeab4f50c353eef18c428a761c","modified":1473923608174},{"_id":"themes/apollo-enhance/source/scss/_partial/footer.scss","hash":"8cd2631d46be05a9518f1966bd84e1a8b0270857","modified":1473923608176},{"_id":"themes/apollo-enhance/source/scss/_partial/header.scss","hash":"a6aeb5177f370f984565f7b6f0a18fe27545d34d","modified":1473923608176},{"_id":"themes/apollo-enhance/source/scss/_partial/home-post-list.scss","hash":"658eef39c7cf6f730f784751c2e4701e8eb02e0d","modified":1473923608177},{"_id":"themes/apollo-enhance/source/scss/_partial/mq.scss","hash":"56b86662df5593581a5180abf5f1869cd5d0399d","modified":1473923608177},{"_id":"themes/apollo-enhance/source/scss/_partial/normalize.scss","hash":"612b367b0e9a0b9f66d37694ee64ce896c552967","modified":1473923608178},{"_id":"themes/apollo-enhance/source/scss/_partial/post.scss","hash":"6f58452c78a620619702d5d5824a664002e60203","modified":1473923608178},{"_id":"source/_posts/Haproxy-Configuration.md","hash":"a4691acb16be6b0a61bc57b9581a9c39e9b21229","modified":1473923608137},{"_id":"public/atom.xml","hash":"49c04b74b10c679a41098c77284e953adc9540ad","modified":1474018589833},{"_id":"public/sitemap.xml","hash":"a42edfa82318a2fa341ee3a19019a642069698c1","modified":1474018589849},{"_id":"public/me/index.html","hash":"eb044b402b4a71e4ca34b327247f267af4057cce","modified":1474018589864},{"_id":"public/2016/09/15/mysql主从备份/index.html","hash":"50edc9ea7088c0027e6d64c7a84b49284f1e47d8","modified":1474018589864},{"_id":"public/2016/09/13/js多对象数组唯一方法/index.html","hash":"12ff8c1665b90f5811fbbc6bb2f3ab9ead3a245f","modified":1474018589864},{"_id":"public/2016/09/10/简单的mysql过程实现数据行累加/index.html","hash":"1f219b9e3474ac41c6dce1c058051a8fff0145c6","modified":1474018589864},{"_id":"public/2016/09/09/使用gitbook整合github快速构建文档/index.html","hash":"7fbd23ec9dd5eeb01f91b35fe1876efd77627345","modified":1474018589864},{"_id":"public/2016/08/15/批量删除redis制定键/index.html","hash":"4f8b60042f4d96689f736012b4cd97d9182de184","modified":1474018589864},{"_id":"public/2016/07/12/bashshell-case-syntax/index.html","hash":"b7bf94102ad83e12fbe08ab7ac190f5c400cfef4","modified":1474018589864},{"_id":"public/2016/05/31/单点登入(SSO)实现/index.html","hash":"df951582d01f0bbbab91c0a4d7b282c93941d883","modified":1474018589864},{"_id":"public/2016/05/09/vagrant搭建lamp开发环境/index.html","hash":"0191b5fb2daef0aea9fcf9cbf57b56a38579a58f","modified":1474018589880},{"_id":"public/2016/05/08/［chrome／chromium］插件-vimium-简单使用/index.html","hash":"3b01d8025149b834527caf49b4e9ea4ff60bc920","modified":1474018589880},{"_id":"public/2016/04/13/时间戳转日期，日期装时间戳快速tempermonkey脚本/index.html","hash":"614a086ea5f6a69c04f6c12dfa473a339527ff68","modified":1474018589880},{"_id":"public/2015/12/28/自动更新hosts文件-访问google-facebook/index.html","hash":"6a06f83471526a3843823742177432c92f680bac","modified":1474018589880},{"_id":"public/2015/12/25/PHP5-4-Trait-使用/index.html","hash":"b7b190a9bb2139e2a825f1411163f6ec3151ef5c","modified":1474018589880},{"_id":"public/2015/12/22/MySQL单台服务器跑多个实例子/index.html","hash":"027304d7391121e03ee81a394f182f27be71a595","modified":1474018589880},{"_id":"public/2015/09/29/RazorSQL-注册码/index.html","hash":"8bfddd485a9c76bb7b1162e987d49611ce8e6317","modified":1474018589880},{"_id":"public/2015/09/14/CentOS-jemalloc库缺失问题/index.html","hash":"4abf188a6cb3e5238550fa2b13987aab5db09630","modified":1474018589880},{"_id":"public/2015/08/30/CentOS6-5-Kernel2-6-Compile-PHP5-6-1/index.html","hash":"15273306fb44eda8f9161c31eb9f4bb7d4c816b7","modified":1474018589880},{"_id":"public/2015/08/14/MySQL-InnoDB存储引擎外键约束/index.html","hash":"e36ef9ac9e6e1db83331ba4fd42715c4fd678484","modified":1474018589880},{"_id":"public/2015/07/26/redis数据迁移/index.html","hash":"63ce54891359b9de44cc742de6c12bb94195d2f2","modified":1474018589880},{"_id":"public/2015/07/26/CentOS-无人值守安装-ftp模式/index.html","hash":"88de215d81b629404dfb9d42aa45327702cc50ec","modified":1474018589880},{"_id":"public/2015/07/25/CentOS-Debian等Linux发行版更新镜像源-1/index.html","hash":"a73848e4cb731d5e7c5de36599038dfaa62d3be9","modified":1474018589880},{"_id":"public/2015/06/30/linux下nginx-php-fpm运行用户以及资源目录的权限/index.html","hash":"ea541667f7d8384073ae6baa0db584a4537da085","modified":1474018589880},{"_id":"public/archives/index.html","hash":"e12ed5d40b916876c87e6658ad9a0a90c5b03983","modified":1474018589880},{"_id":"public/index.html","hash":"0d077bb4037402a1017a73862515410b289b7889","modified":1474018589880},{"_id":"public/page/2/index.html","hash":"49a490f0a91058cca70e1fb3d83989b157c829e7","modified":1474018589880},{"_id":"public/page/3/index.html","hash":"62acf7c09add90f26267eeba5a96522a60cb4647","modified":1474018589880},{"_id":"public/tags/bash/index.html","hash":"0714ea4a2d45d6855535d7c865fa79b5deb2c7f9","modified":1474018589880},{"_id":"public/tags/case/index.html","hash":"0714ea4a2d45d6855535d7c865fa79b5deb2c7f9","modified":1474018589880},{"_id":"public/tags/command/index.html","hash":"0714ea4a2d45d6855535d7c865fa79b5deb2c7f9","modified":1474018589880},{"_id":"public/tags/SSO/index.html","hash":"1dd254edf5cb85f4ce1d8edba78436738b954ae2","modified":1474018589880},{"_id":"public/tags/SESSION-共享/index.html","hash":"1dd254edf5cb85f4ce1d8edba78436738b954ae2","modified":1474018589880},{"_id":"public/tags/Cookie作用域/index.html","hash":"1dd254edf5cb85f4ce1d8edba78436738b954ae2","modified":1474018589880},{"_id":"public/2016/05/30/如何实现6位数表示百亿/index.html","hash":"f105799165bfb5ee06d471ad542b345e212b7185","modified":1474018589880},{"_id":"public/2015/09/10/判断ip是内网还是外网-判断请求来之pc还是mobile/index.html","hash":"d69ec200d20207cff4f07aae4a1c601ddb874e9e","modified":1474018589880},{"_id":"public/2015/08/27/PHP分页算法/index.html","hash":"a8404fcb25fae593e0fff6202203410e8d024be8","modified":1474018589880},{"_id":"public/2015/08/25/Knockoutjs-实现省市联动/index.html","hash":"08390624adb5b359a8d30d43608d46e3c2a462bf","modified":1474018589880},{"_id":"public/2015/07/27/Haproxy-Configuration/index.html","hash":"89a550f1ed74a084aa71920c82c9e940bad23fe3","modified":1474018589880},{"_id":"public/2015/06/25/php图片水印类/index.html","hash":"91d5bfab532972582aa38ac7a3e53caa1676d810","modified":1474018589880},{"_id":"public/favicon.png","hash":"9c9b1cd3887d68155cde3214d7583dc59f8e39ed","modified":1474018589880},{"_id":"public/scss/apollo.scss","hash":"c05604c2b0c9b0a284ba1bce82880c495409dd4d","modified":1474018589880},{"_id":"public/images/gitbook/0.png","hash":"ee6d5ddeee3703c4c55d77a84010dc3e52a33517","modified":1474018589880},{"_id":"public/images/gitbook/1.png","hash":"f6a5b4f29288eec76524d4755abe0940afd49ca7","modified":1474018589880},{"_id":"public/images/gitbook/2.png","hash":"b084b85ede4d499169ec2d5b00f58e0118927c8c","modified":1474018589880},{"_id":"public/images/gitbook/3.png","hash":"be5da24d8dc08782fc4e55928a172b60a183c250","modified":1474018589880},{"_id":"public/css/apollo.css","hash":"c74575af7ec0b3f6d85b624085d885b4f87f35cc","modified":1474018590068}],"Category":[],"Data":[],"Page":[{"_content":"## 个人信息\n\n- 姓名     : 罗文辉\n- 性别     : 男\n- 出生日期 : 1989.12\n- 学历     : 大学本科\n- 工作经验 : 4年\n- 邮箱     : loovien@163.com\n- 住址     : 杭州拱墅区\n\n\n## 工作经验\n\n### 杭州可乐视媒网络科技有限公司\n\n- 职位     : php高级工程师,兼公司运维\n- 工作时间 : 2015.5~2016.至今\n- 主要职责 : 主要负责公司项目的开发, 兼公司服务器维护\n\n\n#### 运维工作\n\n1. 使用zabbix为公司所有服务器添加监控预警服务\n2. 优化服务器配置\n3. 编写脚本实现公司数据冷备份以及搭建mysql主从实现公司热备份\n4. 搭建公司内部开发预览服务器, apache+mysql+php+redis+svn开发环境\n5. 开发内部web更新svn小工具提供前端快速更新代码.\n6. 使用python开发每日发送邮件小系统\n\n\n#### 参与开发项目\n\n**小电商项目**\n\n1. 基于laravel5.2框架开发, 后台与下面微网页,情景网页后台实现sso登入\n2. 商品管理后台使用laravel5.2提供数据, 模版结合vuejs实现友好交互.\n3. 商品前台(手机端)使用reactjs构建一个单页应用, 认证服务器使用swoole提供高性能jwt(json web token)服务, api服务器使用laravel5.2 restfull api + cors 提供服务. 前台(手机端)实现前后端完全分离.\n4. 主要贡献, 前期项目脚手架搭建(自定框架), jwt验证(数据提供分离)实现, 跨域实现, 和CI框架实现sso单点的登入. api服务版本控制实现. 后期业务模块开发. 上线优化.\n5. [项目地址: http://trade.51lianying.mobi](http://trade.51lianying.mobi)\n\n\n**[渠道/代理商]后台项目**\n\n1. 基于[laravel5.2](https://laravel.com)框架开发, 前端使用angularjs1.4实现的一个单页面后台, 前端js使用requirejs模块管理库, 上线使用gulp构建工具压缩优化.\n2. 整个项目就2个人开发, 设计负责设计切图, 我负责前台端完整开发(js交互, 后台数据库设计, 业务功能实现)\n3. 项目地址: [渠道后台http://admin.precharge.51lianying.com](http://admin.precharge.51lianying.com) [代理商后台 http://precharge.51lianying.com](http://precharge.51lianying.com)\n\n**众筹项目**\n\n1. 基于laravel5.2框架主导开发的一个项目, 为富阳灵隐寺重建集资.\n2. 主要贡献, 后台独立完成使用bootstrap模版,构建一个简单的后台(时间紧迫), 前台基于微信客户端, 完成页面模版嵌套, 微信授权,支付等.\n3. [项目地址: http://fo.chou.51lianying.mobi](http://fo.chou.51lianying.mobi).\n\n**微信公众号平台开发**\n\n1. 基于CI框架, 开发的一个项目. 主要是微信第三方开发. 移植官方公号基本功能同时扩展关键字回复，用户事件定制个性化功能。为企业提供微信公号运营一个项目。\n4. 主要贡献, 微信开放接口封装, api设计(项目以api形式提供服务), 业务逻辑开发, 项目上线.\n6. [项目地址: http://biz.51lianying.com](http://biz.51lianying.com)\n\n\n\n\n**微网页,情景网页**\n\n1. 使用CI[codeigniter](https://codeigniter.com)搭建的服务手机端微网页,情景网页制作工具.\n3. 主要贡献: 此项目没有参与开发, 主要负责维护.\n4. [项目地址: http://www.51lianying.com](http://www.51lianying.com)\n\n### 上海[webpower](http://www.webpowerchina.com/)网络科技有限公司\n\n- 职位     : php工程师\n- 工作时间 : 2014.3 ~ 2015.5\n- 工作职责 : 主要负责公司项目开发\n\n#### 参与项目\n\n**allinone后台开发**\n\n1. 使用[yii1.x](http://www.yiiframework.com/)框架开发.\n2. 主要功能为管理公司所有产品(sms, wechat, dma)实现统一管理后台(产品的开通, 关闭, 功能付费开通等)\n3. 主要贡献,开发allinone系统后台业务逻辑,整合sms, wechat, dma的sso登入, sms, wechat, dma平台数据的管理统计\n4. [项目地址: http://demo.webpowerchina.cn/](http://demo.webpowerchina.cn/)\n\n**wechat项目**\n\n1. 使用yii1.x框架开发\n2. 主要贡献, 开发微信公众号功能开发, 实现客户个性化需求.\n\n\n**dma项目**\n\n1. 使用yii1.x框架开发\n2. 主要贡献, 获取用户浏览记录, 计算个性推送适合用户的商品, 给用户个性化发送邮件.\n\n**测试环境搭建**\n\n1. 根据公司线上正式服务器架设, 完整复制, 架设公司测试服务环境\n2. 搭建公司开发协作软件(禅道+svn)\n\n\n### 上海亿达科技网络有限公司\n\n- 职位     : php工程师\n- 工作时间 : 2013.6 ~ 2014.3\n- 工作职责 : 外包腾讯IEG(互娱事业部)\n\n#### 参与项目\n\n1. 主要使用腾讯互娱后台, 开发NBA2K, 剑灵, 等游戏活动.\n2. 更具产品经理需求, 快速代码实现游戏活动开发(每周3~4个活动).\n\n\n### 上饶协和医院\n\n- 职位     : 程序员\n- 工作时间 : 2012.9 ~ 2013.6\n- 工作职责 : 医院网站开发维护\n\n#### 参与项目\n\n1. 医院网站开发(dedecms)实现\n2. 网络维护, 路由器, 交换机维护\n3. seo推广.\n\n## 自我简介\n\n1. 爱学习, 爱编程, 熟练使用(php, python)编程语言, (mysql, nosql(redis, mongodb))数据库, (solr, lucene)企业搜索服务, 以及(html, css, javascript)前端语言, git, svn 版本控制软件. 能快速使用markdown语法, gitbook编写项目文档.\n2. 热衷linux哲学, 2年archlinux工作站用户, vim忠粉.\n3. 熟悉网络拓扑, 了解常见网络协议,  熟悉配置nginx, httpd, mysqld服务, 消息队列机制, lvs三种模式原理, haproxy四层七层代理.\n3. 爱挑战自己, 挑战新事物.\n4. 爱运动, 爱篮球.\n\n\n\n\n\n\n","source":"me/index.md","raw":"## 个人信息\n\n- 姓名     : 罗文辉\n- 性别     : 男\n- 出生日期 : 1989.12\n- 学历     : 大学本科\n- 工作经验 : 4年\n- 邮箱     : loovien@163.com\n- 住址     : 杭州拱墅区\n\n\n## 工作经验\n\n### 杭州可乐视媒网络科技有限公司\n\n- 职位     : php高级工程师,兼公司运维\n- 工作时间 : 2015.5~2016.至今\n- 主要职责 : 主要负责公司项目的开发, 兼公司服务器维护\n\n\n#### 运维工作\n\n1. 使用zabbix为公司所有服务器添加监控预警服务\n2. 优化服务器配置\n3. 编写脚本实现公司数据冷备份以及搭建mysql主从实现公司热备份\n4. 搭建公司内部开发预览服务器, apache+mysql+php+redis+svn开发环境\n5. 开发内部web更新svn小工具提供前端快速更新代码.\n6. 使用python开发每日发送邮件小系统\n\n\n#### 参与开发项目\n\n**小电商项目**\n\n1. 基于laravel5.2框架开发, 后台与下面微网页,情景网页后台实现sso登入\n2. 商品管理后台使用laravel5.2提供数据, 模版结合vuejs实现友好交互.\n3. 商品前台(手机端)使用reactjs构建一个单页应用, 认证服务器使用swoole提供高性能jwt(json web token)服务, api服务器使用laravel5.2 restfull api + cors 提供服务. 前台(手机端)实现前后端完全分离.\n4. 主要贡献, 前期项目脚手架搭建(自定框架), jwt验证(数据提供分离)实现, 跨域实现, 和CI框架实现sso单点的登入. api服务版本控制实现. 后期业务模块开发. 上线优化.\n5. [项目地址: http://trade.51lianying.mobi](http://trade.51lianying.mobi)\n\n\n**[渠道/代理商]后台项目**\n\n1. 基于[laravel5.2](https://laravel.com)框架开发, 前端使用angularjs1.4实现的一个单页面后台, 前端js使用requirejs模块管理库, 上线使用gulp构建工具压缩优化.\n2. 整个项目就2个人开发, 设计负责设计切图, 我负责前台端完整开发(js交互, 后台数据库设计, 业务功能实现)\n3. 项目地址: [渠道后台http://admin.precharge.51lianying.com](http://admin.precharge.51lianying.com) [代理商后台 http://precharge.51lianying.com](http://precharge.51lianying.com)\n\n**众筹项目**\n\n1. 基于laravel5.2框架主导开发的一个项目, 为富阳灵隐寺重建集资.\n2. 主要贡献, 后台独立完成使用bootstrap模版,构建一个简单的后台(时间紧迫), 前台基于微信客户端, 完成页面模版嵌套, 微信授权,支付等.\n3. [项目地址: http://fo.chou.51lianying.mobi](http://fo.chou.51lianying.mobi).\n\n**微信公众号平台开发**\n\n1. 基于CI框架, 开发的一个项目. 主要是微信第三方开发. 移植官方公号基本功能同时扩展关键字回复，用户事件定制个性化功能。为企业提供微信公号运营一个项目。\n4. 主要贡献, 微信开放接口封装, api设计(项目以api形式提供服务), 业务逻辑开发, 项目上线.\n6. [项目地址: http://biz.51lianying.com](http://biz.51lianying.com)\n\n\n\n\n**微网页,情景网页**\n\n1. 使用CI[codeigniter](https://codeigniter.com)搭建的服务手机端微网页,情景网页制作工具.\n3. 主要贡献: 此项目没有参与开发, 主要负责维护.\n4. [项目地址: http://www.51lianying.com](http://www.51lianying.com)\n\n### 上海[webpower](http://www.webpowerchina.com/)网络科技有限公司\n\n- 职位     : php工程师\n- 工作时间 : 2014.3 ~ 2015.5\n- 工作职责 : 主要负责公司项目开发\n\n#### 参与项目\n\n**allinone后台开发**\n\n1. 使用[yii1.x](http://www.yiiframework.com/)框架开发.\n2. 主要功能为管理公司所有产品(sms, wechat, dma)实现统一管理后台(产品的开通, 关闭, 功能付费开通等)\n3. 主要贡献,开发allinone系统后台业务逻辑,整合sms, wechat, dma的sso登入, sms, wechat, dma平台数据的管理统计\n4. [项目地址: http://demo.webpowerchina.cn/](http://demo.webpowerchina.cn/)\n\n**wechat项目**\n\n1. 使用yii1.x框架开发\n2. 主要贡献, 开发微信公众号功能开发, 实现客户个性化需求.\n\n\n**dma项目**\n\n1. 使用yii1.x框架开发\n2. 主要贡献, 获取用户浏览记录, 计算个性推送适合用户的商品, 给用户个性化发送邮件.\n\n**测试环境搭建**\n\n1. 根据公司线上正式服务器架设, 完整复制, 架设公司测试服务环境\n2. 搭建公司开发协作软件(禅道+svn)\n\n\n### 上海亿达科技网络有限公司\n\n- 职位     : php工程师\n- 工作时间 : 2013.6 ~ 2014.3\n- 工作职责 : 外包腾讯IEG(互娱事业部)\n\n#### 参与项目\n\n1. 主要使用腾讯互娱后台, 开发NBA2K, 剑灵, 等游戏活动.\n2. 更具产品经理需求, 快速代码实现游戏活动开发(每周3~4个活动).\n\n\n### 上饶协和医院\n\n- 职位     : 程序员\n- 工作时间 : 2012.9 ~ 2013.6\n- 工作职责 : 医院网站开发维护\n\n#### 参与项目\n\n1. 医院网站开发(dedecms)实现\n2. 网络维护, 路由器, 交换机维护\n3. seo推广.\n\n## 自我简介\n\n1. 爱学习, 爱编程, 熟练使用(php, python)编程语言, (mysql, nosql(redis, mongodb))数据库, (solr, lucene)企业搜索服务, 以及(html, css, javascript)前端语言, git, svn 版本控制软件. 能快速使用markdown语法, gitbook编写项目文档.\n2. 热衷linux哲学, 2年archlinux工作站用户, vim忠粉.\n3. 熟悉网络拓扑, 了解常见网络协议,  熟悉配置nginx, httpd, mysqld服务, 消息队列机制, lvs三种模式原理, haproxy四层七层代理.\n3. 爱挑战自己, 挑战新事物.\n4. 爱运动, 爱篮球.\n\n\n\n\n\n\n","date":"2016-09-16T09:35:51.332Z","updated":"2016-09-16T09:35:51.332Z","path":"me/index.html","title":"","comments":1,"layout":"page","_id":"cit5klxsf00007sqv7y0t92b7","content":"<h2 id=\"个人信息\"><a href=\"#个人信息\" class=\"headerlink\" title=\"个人信息\"></a>个人信息</h2><ul>\n<li>姓名     : 罗文辉</li>\n<li>性别     : 男</li>\n<li>出生日期 : 1989.12</li>\n<li>学历     : 大学本科</li>\n<li>工作经验 : 4年</li>\n<li>邮箱     : loovien@163.com</li>\n<li>住址     : 杭州拱墅区</li>\n</ul>\n<h2 id=\"工作经验\"><a href=\"#工作经验\" class=\"headerlink\" title=\"工作经验\"></a>工作经验</h2><h3 id=\"杭州可乐视媒网络科技有限公司\"><a href=\"#杭州可乐视媒网络科技有限公司\" class=\"headerlink\" title=\"杭州可乐视媒网络科技有限公司\"></a>杭州可乐视媒网络科技有限公司</h3><ul>\n<li>职位     : php高级工程师,兼公司运维</li>\n<li>工作时间 : 2015.5~2016.至今</li>\n<li>主要职责 : 主要负责公司项目的开发, 兼公司服务器维护</li>\n</ul>\n<h4 id=\"运维工作\"><a href=\"#运维工作\" class=\"headerlink\" title=\"运维工作\"></a>运维工作</h4><ol>\n<li>使用zabbix为公司所有服务器添加监控预警服务</li>\n<li>优化服务器配置</li>\n<li>编写脚本实现公司数据冷备份以及搭建mysql主从实现公司热备份</li>\n<li>搭建公司内部开发预览服务器, apache+mysql+php+redis+svn开发环境</li>\n<li>开发内部web更新svn小工具提供前端快速更新代码.</li>\n<li>使用python开发每日发送邮件小系统</li>\n</ol>\n<h4 id=\"参与开发项目\"><a href=\"#参与开发项目\" class=\"headerlink\" title=\"参与开发项目\"></a>参与开发项目</h4><p><strong>小电商项目</strong></p>\n<ol>\n<li>基于laravel5.2框架开发, 后台与下面微网页,情景网页后台实现sso登入</li>\n<li>商品管理后台使用laravel5.2提供数据, 模版结合vuejs实现友好交互.</li>\n<li>商品前台(手机端)使用reactjs构建一个单页应用, 认证服务器使用swoole提供高性能jwt(json web token)服务, api服务器使用laravel5.2 restfull api + cors 提供服务. 前台(手机端)实现前后端完全分离.</li>\n<li>主要贡献, 前期项目脚手架搭建(自定框架), jwt验证(数据提供分离)实现, 跨域实现, 和CI框架实现sso单点的登入. api服务版本控制实现. 后期业务模块开发. 上线优化.</li>\n<li><a href=\"http://trade.51lianying.mobi\" target=\"_blank\" rel=\"external\">项目地址: http://trade.51lianying.mobi</a></li>\n</ol>\n<p><strong>[渠道/代理商]后台项目</strong></p>\n<ol>\n<li>基于<a href=\"https://laravel.com\" target=\"_blank\" rel=\"external\">laravel5.2</a>框架开发, 前端使用angularjs1.4实现的一个单页面后台, 前端js使用requirejs模块管理库, 上线使用gulp构建工具压缩优化.</li>\n<li>整个项目就2个人开发, 设计负责设计切图, 我负责前台端完整开发(js交互, 后台数据库设计, 业务功能实现)</li>\n<li>项目地址: <a href=\"http://admin.precharge.51lianying.com\" target=\"_blank\" rel=\"external\">渠道后台http://admin.precharge.51lianying.com</a> <a href=\"http://precharge.51lianying.com\" target=\"_blank\" rel=\"external\">代理商后台 http://precharge.51lianying.com</a></li>\n</ol>\n<p><strong>众筹项目</strong></p>\n<ol>\n<li>基于laravel5.2框架主导开发的一个项目, 为富阳灵隐寺重建集资.</li>\n<li>主要贡献, 后台独立完成使用bootstrap模版,构建一个简单的后台(时间紧迫), 前台基于微信客户端, 完成页面模版嵌套, 微信授权,支付等.</li>\n<li><a href=\"http://fo.chou.51lianying.mobi\" target=\"_blank\" rel=\"external\">项目地址: http://fo.chou.51lianying.mobi</a>.</li>\n</ol>\n<p><strong>微信公众号平台开发</strong></p>\n<ol>\n<li>基于CI框架, 开发的一个项目. 主要是微信第三方开发. 移植官方公号基本功能同时扩展关键字回复，用户事件定制个性化功能。为企业提供微信公号运营一个项目。</li>\n<li>主要贡献, 微信开放接口封装, api设计(项目以api形式提供服务), 业务逻辑开发, 项目上线.</li>\n<li><a href=\"http://biz.51lianying.com\" target=\"_blank\" rel=\"external\">项目地址: http://biz.51lianying.com</a></li>\n</ol>\n<p><strong>微网页,情景网页</strong></p>\n<ol>\n<li>使用CI<a href=\"https://codeigniter.com\" target=\"_blank\" rel=\"external\">codeigniter</a>搭建的服务手机端微网页,情景网页制作工具.</li>\n<li>主要贡献: 此项目没有参与开发, 主要负责维护.</li>\n<li><a href=\"http://www.51lianying.com\" target=\"_blank\" rel=\"external\">项目地址: http://www.51lianying.com</a></li>\n</ol>\n<h3 id=\"上海webpower网络科技有限公司\"><a href=\"#上海webpower网络科技有限公司\" class=\"headerlink\" title=\"上海webpower网络科技有限公司\"></a>上海<a href=\"http://www.webpowerchina.com/\" target=\"_blank\" rel=\"external\">webpower</a>网络科技有限公司</h3><ul>\n<li>职位     : php工程师</li>\n<li>工作时间 : 2014.3 ~ 2015.5</li>\n<li>工作职责 : 主要负责公司项目开发</li>\n</ul>\n<h4 id=\"参与项目\"><a href=\"#参与项目\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><p><strong>allinone后台开发</strong></p>\n<ol>\n<li>使用<a href=\"http://www.yiiframework.com/\" target=\"_blank\" rel=\"external\">yii1.x</a>框架开发.</li>\n<li>主要功能为管理公司所有产品(sms, wechat, dma)实现统一管理后台(产品的开通, 关闭, 功能付费开通等)</li>\n<li>主要贡献,开发allinone系统后台业务逻辑,整合sms, wechat, dma的sso登入, sms, wechat, dma平台数据的管理统计</li>\n<li><a href=\"http://demo.webpowerchina.cn/\" target=\"_blank\" rel=\"external\">项目地址: http://demo.webpowerchina.cn/</a></li>\n</ol>\n<p><strong>wechat项目</strong></p>\n<ol>\n<li>使用yii1.x框架开发</li>\n<li>主要贡献, 开发微信公众号功能开发, 实现客户个性化需求.</li>\n</ol>\n<p><strong>dma项目</strong></p>\n<ol>\n<li>使用yii1.x框架开发</li>\n<li>主要贡献, 获取用户浏览记录, 计算个性推送适合用户的商品, 给用户个性化发送邮件.</li>\n</ol>\n<p><strong>测试环境搭建</strong></p>\n<ol>\n<li>根据公司线上正式服务器架设, 完整复制, 架设公司测试服务环境</li>\n<li>搭建公司开发协作软件(禅道+svn)</li>\n</ol>\n<h3 id=\"上海亿达科技网络有限公司\"><a href=\"#上海亿达科技网络有限公司\" class=\"headerlink\" title=\"上海亿达科技网络有限公司\"></a>上海亿达科技网络有限公司</h3><ul>\n<li>职位     : php工程师</li>\n<li>工作时间 : 2013.6 ~ 2014.3</li>\n<li>工作职责 : 外包腾讯IEG(互娱事业部)</li>\n</ul>\n<h4 id=\"参与项目-1\"><a href=\"#参与项目-1\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><ol>\n<li>主要使用腾讯互娱后台, 开发NBA2K, 剑灵, 等游戏活动.</li>\n<li>更具产品经理需求, 快速代码实现游戏活动开发(每周3~4个活动).</li>\n</ol>\n<h3 id=\"上饶协和医院\"><a href=\"#上饶协和医院\" class=\"headerlink\" title=\"上饶协和医院\"></a>上饶协和医院</h3><ul>\n<li>职位     : 程序员</li>\n<li>工作时间 : 2012.9 ~ 2013.6</li>\n<li>工作职责 : 医院网站开发维护</li>\n</ul>\n<h4 id=\"参与项目-2\"><a href=\"#参与项目-2\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><ol>\n<li>医院网站开发(dedecms)实现</li>\n<li>网络维护, 路由器, 交换机维护</li>\n<li>seo推广.</li>\n</ol>\n<h2 id=\"自我简介\"><a href=\"#自我简介\" class=\"headerlink\" title=\"自我简介\"></a>自我简介</h2><ol>\n<li>爱学习, 爱编程, 熟练使用(php, python)编程语言, (mysql, nosql(redis, mongodb))数据库, (solr, lucene)企业搜索服务, 以及(html, css, javascript)前端语言, git, svn 版本控制软件. 能快速使用markdown语法, gitbook编写项目文档.</li>\n<li>热衷linux哲学, 2年archlinux工作站用户, vim忠粉.</li>\n<li>熟悉网络拓扑, 了解常见网络协议,  熟悉配置nginx, httpd, mysqld服务, 消息队列机制, lvs三种模式原理, haproxy四层七层代理.</li>\n<li>爱挑战自己, 挑战新事物.</li>\n<li>爱运动, 爱篮球.</li>\n</ol>\n","excerpt":"","more":"<h2 id=\"个人信息\"><a href=\"#个人信息\" class=\"headerlink\" title=\"个人信息\"></a>个人信息</h2><ul>\n<li>姓名     : 罗文辉</li>\n<li>性别     : 男</li>\n<li>出生日期 : 1989.12</li>\n<li>学历     : 大学本科</li>\n<li>工作经验 : 4年</li>\n<li>邮箱     : loovien@163.com</li>\n<li>住址     : 杭州拱墅区</li>\n</ul>\n<h2 id=\"工作经验\"><a href=\"#工作经验\" class=\"headerlink\" title=\"工作经验\"></a>工作经验</h2><h3 id=\"杭州可乐视媒网络科技有限公司\"><a href=\"#杭州可乐视媒网络科技有限公司\" class=\"headerlink\" title=\"杭州可乐视媒网络科技有限公司\"></a>杭州可乐视媒网络科技有限公司</h3><ul>\n<li>职位     : php高级工程师,兼公司运维</li>\n<li>工作时间 : 2015.5~2016.至今</li>\n<li>主要职责 : 主要负责公司项目的开发, 兼公司服务器维护</li>\n</ul>\n<h4 id=\"运维工作\"><a href=\"#运维工作\" class=\"headerlink\" title=\"运维工作\"></a>运维工作</h4><ol>\n<li>使用zabbix为公司所有服务器添加监控预警服务</li>\n<li>优化服务器配置</li>\n<li>编写脚本实现公司数据冷备份以及搭建mysql主从实现公司热备份</li>\n<li>搭建公司内部开发预览服务器, apache+mysql+php+redis+svn开发环境</li>\n<li>开发内部web更新svn小工具提供前端快速更新代码.</li>\n<li>使用python开发每日发送邮件小系统</li>\n</ol>\n<h4 id=\"参与开发项目\"><a href=\"#参与开发项目\" class=\"headerlink\" title=\"参与开发项目\"></a>参与开发项目</h4><p><strong>小电商项目</strong></p>\n<ol>\n<li>基于laravel5.2框架开发, 后台与下面微网页,情景网页后台实现sso登入</li>\n<li>商品管理后台使用laravel5.2提供数据, 模版结合vuejs实现友好交互.</li>\n<li>商品前台(手机端)使用reactjs构建一个单页应用, 认证服务器使用swoole提供高性能jwt(json web token)服务, api服务器使用laravel5.2 restfull api + cors 提供服务. 前台(手机端)实现前后端完全分离.</li>\n<li>主要贡献, 前期项目脚手架搭建(自定框架), jwt验证(数据提供分离)实现, 跨域实现, 和CI框架实现sso单点的登入. api服务版本控制实现. 后期业务模块开发. 上线优化.</li>\n<li><a href=\"http://trade.51lianying.mobi\">项目地址: http://trade.51lianying.mobi</a></li>\n</ol>\n<p><strong>[渠道/代理商]后台项目</strong></p>\n<ol>\n<li>基于<a href=\"https://laravel.com\">laravel5.2</a>框架开发, 前端使用angularjs1.4实现的一个单页面后台, 前端js使用requirejs模块管理库, 上线使用gulp构建工具压缩优化.</li>\n<li>整个项目就2个人开发, 设计负责设计切图, 我负责前台端完整开发(js交互, 后台数据库设计, 业务功能实现)</li>\n<li>项目地址: <a href=\"http://admin.precharge.51lianying.com\">渠道后台http://admin.precharge.51lianying.com</a> <a href=\"http://precharge.51lianying.com\">代理商后台 http://precharge.51lianying.com</a></li>\n</ol>\n<p><strong>众筹项目</strong></p>\n<ol>\n<li>基于laravel5.2框架主导开发的一个项目, 为富阳灵隐寺重建集资.</li>\n<li>主要贡献, 后台独立完成使用bootstrap模版,构建一个简单的后台(时间紧迫), 前台基于微信客户端, 完成页面模版嵌套, 微信授权,支付等.</li>\n<li><a href=\"http://fo.chou.51lianying.mobi\">项目地址: http://fo.chou.51lianying.mobi</a>.</li>\n</ol>\n<p><strong>微信公众号平台开发</strong></p>\n<ol>\n<li>基于CI框架, 开发的一个项目. 主要是微信第三方开发. 移植官方公号基本功能同时扩展关键字回复，用户事件定制个性化功能。为企业提供微信公号运营一个项目。</li>\n<li>主要贡献, 微信开放接口封装, api设计(项目以api形式提供服务), 业务逻辑开发, 项目上线.</li>\n<li><a href=\"http://biz.51lianying.com\">项目地址: http://biz.51lianying.com</a></li>\n</ol>\n<p><strong>微网页,情景网页</strong></p>\n<ol>\n<li>使用CI<a href=\"https://codeigniter.com\">codeigniter</a>搭建的服务手机端微网页,情景网页制作工具.</li>\n<li>主要贡献: 此项目没有参与开发, 主要负责维护.</li>\n<li><a href=\"http://www.51lianying.com\">项目地址: http://www.51lianying.com</a></li>\n</ol>\n<h3 id=\"上海webpower网络科技有限公司\"><a href=\"#上海webpower网络科技有限公司\" class=\"headerlink\" title=\"上海webpower网络科技有限公司\"></a>上海<a href=\"http://www.webpowerchina.com/\">webpower</a>网络科技有限公司</h3><ul>\n<li>职位     : php工程师</li>\n<li>工作时间 : 2014.3 ~ 2015.5</li>\n<li>工作职责 : 主要负责公司项目开发</li>\n</ul>\n<h4 id=\"参与项目\"><a href=\"#参与项目\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><p><strong>allinone后台开发</strong></p>\n<ol>\n<li>使用<a href=\"http://www.yiiframework.com/\">yii1.x</a>框架开发.</li>\n<li>主要功能为管理公司所有产品(sms, wechat, dma)实现统一管理后台(产品的开通, 关闭, 功能付费开通等)</li>\n<li>主要贡献,开发allinone系统后台业务逻辑,整合sms, wechat, dma的sso登入, sms, wechat, dma平台数据的管理统计</li>\n<li><a href=\"http://demo.webpowerchina.cn/\">项目地址: http://demo.webpowerchina.cn/</a></li>\n</ol>\n<p><strong>wechat项目</strong></p>\n<ol>\n<li>使用yii1.x框架开发</li>\n<li>主要贡献, 开发微信公众号功能开发, 实现客户个性化需求.</li>\n</ol>\n<p><strong>dma项目</strong></p>\n<ol>\n<li>使用yii1.x框架开发</li>\n<li>主要贡献, 获取用户浏览记录, 计算个性推送适合用户的商品, 给用户个性化发送邮件.</li>\n</ol>\n<p><strong>测试环境搭建</strong></p>\n<ol>\n<li>根据公司线上正式服务器架设, 完整复制, 架设公司测试服务环境</li>\n<li>搭建公司开发协作软件(禅道+svn)</li>\n</ol>\n<h3 id=\"上海亿达科技网络有限公司\"><a href=\"#上海亿达科技网络有限公司\" class=\"headerlink\" title=\"上海亿达科技网络有限公司\"></a>上海亿达科技网络有限公司</h3><ul>\n<li>职位     : php工程师</li>\n<li>工作时间 : 2013.6 ~ 2014.3</li>\n<li>工作职责 : 外包腾讯IEG(互娱事业部)</li>\n</ul>\n<h4 id=\"参与项目-1\"><a href=\"#参与项目-1\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><ol>\n<li>主要使用腾讯互娱后台, 开发NBA2K, 剑灵, 等游戏活动.</li>\n<li>更具产品经理需求, 快速代码实现游戏活动开发(每周3~4个活动).</li>\n</ol>\n<h3 id=\"上饶协和医院\"><a href=\"#上饶协和医院\" class=\"headerlink\" title=\"上饶协和医院\"></a>上饶协和医院</h3><ul>\n<li>职位     : 程序员</li>\n<li>工作时间 : 2012.9 ~ 2013.6</li>\n<li>工作职责 : 医院网站开发维护</li>\n</ul>\n<h4 id=\"参与项目-2\"><a href=\"#参与项目-2\" class=\"headerlink\" title=\"参与项目\"></a>参与项目</h4><ol>\n<li>医院网站开发(dedecms)实现</li>\n<li>网络维护, 路由器, 交换机维护</li>\n<li>seo推广.</li>\n</ol>\n<h2 id=\"自我简介\"><a href=\"#自我简介\" class=\"headerlink\" title=\"自我简介\"></a>自我简介</h2><ol>\n<li>爱学习, 爱编程, 熟练使用(php, python)编程语言, (mysql, nosql(redis, mongodb))数据库, (solr, lucene)企业搜索服务, 以及(html, css, javascript)前端语言, git, svn 版本控制软件. 能快速使用markdown语法, gitbook编写项目文档.</li>\n<li>热衷linux哲学, 2年archlinux工作站用户, vim忠粉.</li>\n<li>熟悉网络拓扑, 了解常见网络协议,  熟悉配置nginx, httpd, mysqld服务, 消息队列机制, lvs三种模式原理, haproxy四层七层代理.</li>\n<li>爱挑战自己, 挑战新事物.</li>\n<li>爱运动, 爱篮球.</li>\n</ol>\n"}],"Post":[{"title":"CentOS,Debian等Linux发行版更新镜像源","date":"2015-07-25T03:31:00.000Z","_content":"\n安装后CentOS镜像源,默认使用国外的,很慢,你知道的, 国内更换163、aliyun (看了很多人的博客, 今天有空,自己写一篇)\n\n*   找到想要更换的源的官方网站, 比如\n\n    *   [网易163](http://mirrors.163.com/)&nbsp;页脚找到帮助中心 &nbsp;&nbsp;\n\n        *   [阿里云](chrome-extension://pghodfjepegmciihfhdipmimghiakcjf/sandbox/http;//mirrors.aliyun.com/)&nbsp;找到对应的发行版本,后面有个**help**可以点击进去看帮助\n\n*   比如CentOS6使用163镜像\n\n    *   备份系统的配置文件\n<pre>    mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\n    cd /etc/yum.repos.d/\n    wget http://mirrors.163.com/.help/CentOS6-Base-163.repo\n    yum clean all\n    yum makecache</pre>","source":"_posts/CentOS-Debian等Linux发行版更新镜像源-1.md","raw":"---\ntitle: 'CentOS,Debian等Linux发行版更新镜像源'\ntags: []\ndate: 2015-07-25 11:31:00\n---\n\n安装后CentOS镜像源,默认使用国外的,很慢,你知道的, 国内更换163、aliyun (看了很多人的博客, 今天有空,自己写一篇)\n\n*   找到想要更换的源的官方网站, 比如\n\n    *   [网易163](http://mirrors.163.com/)&nbsp;页脚找到帮助中心 &nbsp;&nbsp;\n\n        *   [阿里云](chrome-extension://pghodfjepegmciihfhdipmimghiakcjf/sandbox/http;//mirrors.aliyun.com/)&nbsp;找到对应的发行版本,后面有个**help**可以点击进去看帮助\n\n*   比如CentOS6使用163镜像\n\n    *   备份系统的配置文件\n<pre>    mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\n    cd /etc/yum.repos.d/\n    wget http://mirrors.163.com/.help/CentOS6-Base-163.repo\n    yum clean all\n    yum makecache</pre>","slug":"CentOS-Debian等Linux发行版更新镜像源-1","published":1,"updated":"2016-09-15T07:13:28.129Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsf00017sqvh2j3aq4k","content":"<p>安装后CentOS镜像源,默认使用国外的,很慢,你知道的, 国内更换163、aliyun (看了很多人的博客, 今天有空,自己写一篇)</p>\n<ul>\n<li><p>找到想要更换的源的官方网站, 比如</p>\n<ul>\n<li><p><a href=\"http://mirrors.163.com/\" target=\"_blank\" rel=\"external\">网易163</a>&nbsp;页脚找到帮助中心 &nbsp;&nbsp;</p>\n<ul>\n<li><a href=\"chrome-extension://pghodfjepegmciihfhdipmimghiakcjf/sandbox/http;//mirrors.aliyun.com/\" target=\"_blank\" rel=\"external\">阿里云</a>&nbsp;找到对应的发行版本,后面有个<strong>help</strong>可以点击进去看帮助</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>比如CentOS6使用163镜像</p>\n<ul>\n<li>备份系统的配置文件<pre>    mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\ncd /etc/yum.repos.d/\nwget http://mirrors.163.com/.help/CentOS6-Base-163.repo\nyum clean all\nyum makecache</pre></li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<p>安装后CentOS镜像源,默认使用国外的,很慢,你知道的, 国内更换163、aliyun (看了很多人的博客, 今天有空,自己写一篇)</p>\n<ul>\n<li><p>找到想要更换的源的官方网站, 比如</p>\n<ul>\n<li><p><a href=\"http://mirrors.163.com/\">网易163</a>&nbsp;页脚找到帮助中心 &nbsp;&nbsp;</p>\n<ul>\n<li><a href=\"chrome-extension://pghodfjepegmciihfhdipmimghiakcjf/sandbox/http;//mirrors.aliyun.com/\">阿里云</a>&nbsp;找到对应的发行版本,后面有个<strong>help</strong>可以点击进去看帮助</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>比如CentOS6使用163镜像</p>\n<ul>\n<li>备份系统的配置文件<pre>    mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\ncd /etc/yum.repos.d/\nwget http://mirrors.163.com/.help/CentOS6-Base-163.repo\nyum clean all\nyum makecache</pre></li>\n</ul>\n</li>\n</ul>\n"},{"title":"CentOS 无人值守安装(ftp模式)","date":"2015-07-25T18:05:00.000Z","_content":"\n## <span style=\"font-size: 14px; line-height: 1.5;\">每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装</span>\n\n*   测试环境\n\n    *   2台机器\n\n            *   机器1: ip 192.168.1.103/24 跑了vsftpd服务,并且共享了/var/ftp, 目录内容\n\n                        1.  ks.cfg CentOS kickstart配置文件[就是安装的配置文件, 每次安装系统后,都会生成 /root/anaconda-ks.cfg]\n            2.  pub/CentOS/* CentOS光盘中所有内容的复制[理论是可以挂在的, 但实验挂在不行,读取不到文件]\n        *   机器2 只需要放入CentOS的光盘, 启动后按键盘ESC, 输入命令 linux ks=ftp://192.168.1.103/ks.cfg 即可完成\n\n*   ks.cfg配置文件详解\n<div class=\"cnblogs_code\">\n<pre># Kickstart <span style=\"color: #0000ff;\">file</span><span style=\"color: #000000;\"> automatically generated by anaconda.\n\n#version</span>=<span style=\"color: #000000;\">DEVEL\n</span><span style=\"color: #0000ff;\">install</span><span style=\"color: #000000;\">\nurl </span>--url=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS # 配置安装树目录 本文已ftp方式</span>\nlang en_US.UTF-<span style=\"color: #800080;\">8</span><span style=\"color: #000000;\">\nkeyboard us\nnetwork </span>--onboot no --device eth0 --mtu=<span style=\"color: #800080;\">1500</span> --bootproto dhcp --<span style=\"color: #000000;\">noipv6 # dhcp方式获取ip\nrootpw  </span>--iscrypted $<span style=\"color: #800080;\">6</span><span style=\"color: #000000;\">$RyFEkouZJLufDNGf$POLwfvq2CHW2BY1qVGFzX6HoX1CsRGvaifo03Zec0uRQnupT.el3fg50b4I3pQRRMFZJqPdW8BypTe0shmZYi.\n# Reboot after installation\nreboot\nfirewall </span>--service=<span style=\"color: #0000ff;\">ssh</span><span style=\"color: #000000;\">\nauthconfig </span>--enableshadow --passalgo=<span style=\"color: #000000;\">sha512\nselinux </span>--<span style=\"color: #000000;\">enforcing\ntimezone </span>--utc Asia/<span style=\"color: #000000;\">Shanghai # 默认时区\nbootloader </span>--location=mbr --driveorder=sda --append=<span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">crashkernel=auto rhgb rhgb quiet quiet</span><span style=\"color: #800000;\">\"</span><span style=\"color: #000000;\">\n# The following is the partition information you requested\n# Note that any partitions you deleted are not expressed\n# here so unless you </span><span style=\"color: #0000ff;\">clear</span><span style=\"color: #000000;\"> all partitions first, this is\n# not guaranteed to work\nclearpart </span>--all --drives=<span style=\"color: #000000;\">sda # 删除磁盘\n\npart </span>/boot --fstype=ext4 --size=<span style=\"color: #800080;\">500</span><span style=\"color: #000000;\"> # 分boot分区\npart </span>/ --fstype=ext4 --size=<span style=\"color: #800080;\">5000</span><span style=\"color: #000000;\"> # 分根分区\npart swap </span>--grow --maxsize=<span style=\"color: #800080;\">1024</span> --size=<span style=\"color: #800080;\">1024</span> # 分swap分区 可以使用 `part swap --<span style=\"color: #000000;\">recommended` 推荐\n\nrepo </span>--name=<span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">CentOS</span><span style=\"color: #800000;\">\"</span>  --baseurl=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS --cost=1000 # 镜像源,包含所有的软件包</span>\n\n%packages --<span style=\"color: #000000;\">nobase\n@Core # 核心包, 可以自己添加多个\n\n</span>%<span style=\"color: #000000;\">end\n\n</span>%<span style=\"color: #000000;\">post\n</span><span style=\"color: #0000ff;\">yum</span> <span style=\"color: #0000ff;\">install</span> -<span style=\"color: #000000;\">y vim # 安装后自动执行脚本 可根据自己定义编写\n</span>%end</pre>\n</div>\n\n&nbsp;\n\n配置参数很多,只列出了一点详细可参考官方网站[centos kickstart](http://www.centos.org/docs/5/html/Installation_Guide-en-US/s1-kickstart2-options.html)&nbsp;也可一用软件自动生成ks.cfg文件,搜索软件包&nbsp;`yum search kickstart`&nbsp;出来两个 pykickstart|system-config-kickstart 安装即可","source":"_posts/CentOS-无人值守安装-ftp模式.md","raw":"---\ntitle: CentOS 无人值守安装(ftp模式)\ntags: []\ndate: 2015-07-26 02:05:00\n---\n\n## <span style=\"font-size: 14px; line-height: 1.5;\">每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装</span>\n\n*   测试环境\n\n    *   2台机器\n\n            *   机器1: ip 192.168.1.103/24 跑了vsftpd服务,并且共享了/var/ftp, 目录内容\n\n                        1.  ks.cfg CentOS kickstart配置文件[就是安装的配置文件, 每次安装系统后,都会生成 /root/anaconda-ks.cfg]\n            2.  pub/CentOS/* CentOS光盘中所有内容的复制[理论是可以挂在的, 但实验挂在不行,读取不到文件]\n        *   机器2 只需要放入CentOS的光盘, 启动后按键盘ESC, 输入命令 linux ks=ftp://192.168.1.103/ks.cfg 即可完成\n\n*   ks.cfg配置文件详解\n<div class=\"cnblogs_code\">\n<pre># Kickstart <span style=\"color: #0000ff;\">file</span><span style=\"color: #000000;\"> automatically generated by anaconda.\n\n#version</span>=<span style=\"color: #000000;\">DEVEL\n</span><span style=\"color: #0000ff;\">install</span><span style=\"color: #000000;\">\nurl </span>--url=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS # 配置安装树目录 本文已ftp方式</span>\nlang en_US.UTF-<span style=\"color: #800080;\">8</span><span style=\"color: #000000;\">\nkeyboard us\nnetwork </span>--onboot no --device eth0 --mtu=<span style=\"color: #800080;\">1500</span> --bootproto dhcp --<span style=\"color: #000000;\">noipv6 # dhcp方式获取ip\nrootpw  </span>--iscrypted $<span style=\"color: #800080;\">6</span><span style=\"color: #000000;\">$RyFEkouZJLufDNGf$POLwfvq2CHW2BY1qVGFzX6HoX1CsRGvaifo03Zec0uRQnupT.el3fg50b4I3pQRRMFZJqPdW8BypTe0shmZYi.\n# Reboot after installation\nreboot\nfirewall </span>--service=<span style=\"color: #0000ff;\">ssh</span><span style=\"color: #000000;\">\nauthconfig </span>--enableshadow --passalgo=<span style=\"color: #000000;\">sha512\nselinux </span>--<span style=\"color: #000000;\">enforcing\ntimezone </span>--utc Asia/<span style=\"color: #000000;\">Shanghai # 默认时区\nbootloader </span>--location=mbr --driveorder=sda --append=<span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">crashkernel=auto rhgb rhgb quiet quiet</span><span style=\"color: #800000;\">\"</span><span style=\"color: #000000;\">\n# The following is the partition information you requested\n# Note that any partitions you deleted are not expressed\n# here so unless you </span><span style=\"color: #0000ff;\">clear</span><span style=\"color: #000000;\"> all partitions first, this is\n# not guaranteed to work\nclearpart </span>--all --drives=<span style=\"color: #000000;\">sda # 删除磁盘\n\npart </span>/boot --fstype=ext4 --size=<span style=\"color: #800080;\">500</span><span style=\"color: #000000;\"> # 分boot分区\npart </span>/ --fstype=ext4 --size=<span style=\"color: #800080;\">5000</span><span style=\"color: #000000;\"> # 分根分区\npart swap </span>--grow --maxsize=<span style=\"color: #800080;\">1024</span> --size=<span style=\"color: #800080;\">1024</span> # 分swap分区 可以使用 `part swap --<span style=\"color: #000000;\">recommended` 推荐\n\nrepo </span>--name=<span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">CentOS</span><span style=\"color: #800000;\">\"</span>  --baseurl=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS --cost=1000 # 镜像源,包含所有的软件包</span>\n\n%packages --<span style=\"color: #000000;\">nobase\n@Core # 核心包, 可以自己添加多个\n\n</span>%<span style=\"color: #000000;\">end\n\n</span>%<span style=\"color: #000000;\">post\n</span><span style=\"color: #0000ff;\">yum</span> <span style=\"color: #0000ff;\">install</span> -<span style=\"color: #000000;\">y vim # 安装后自动执行脚本 可根据自己定义编写\n</span>%end</pre>\n</div>\n\n&nbsp;\n\n配置参数很多,只列出了一点详细可参考官方网站[centos kickstart](http://www.centos.org/docs/5/html/Installation_Guide-en-US/s1-kickstart2-options.html)&nbsp;也可一用软件自动生成ks.cfg文件,搜索软件包&nbsp;`yum search kickstart`&nbsp;出来两个 pykickstart|system-config-kickstart 安装即可","slug":"CentOS-无人值守安装-ftp模式","published":1,"updated":"2016-09-15T07:13:28.130Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsf00027sqvrpjkr8n6","content":"<h2 id=\"每次安装CentOS时候-都需要鼠标勾选配置-一台机器安装还可以接受-如果有多台-就不好了-下面就介绍下CentOS-ftp形式无人值守安装\"><a href=\"#每次安装CentOS时候-都需要鼠标勾选配置-一台机器安装还可以接受-如果有多台-就不好了-下面就介绍下CentOS-ftp形式无人值守安装\" class=\"headerlink\" title=\"每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装\"></a><span style=\"font-size: 14px; line-height: 1.5;\">每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装</span></h2><ul>\n<li><p>测试环境</p>\n<ul>\n<li><p>2台机器</p>\n<pre><code>*   机器1: ip 192.168.1.103/24 跑了vsftpd服务,并且共享了/var/ftp, 目录内容\n\n            1.  ks.cfg CentOS kickstart配置文件[就是安装的配置文件, 每次安装系统后,都会生成 /root/anaconda-ks.cfg]\n2.  pub/CentOS/* CentOS光盘中所有内容的复制[理论是可以挂在的, 但实验挂在不行,读取不到文件]\n</code></pre><ul>\n<li>机器2 只需要放入CentOS的光盘, 启动后按键盘ESC, 输入命令 linux ks=ftp://192.168.1.103/ks.cfg 即可完成</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>ks.cfg配置文件详解<br><div class=\"cnblogs_code\"><br><pre># Kickstart <span style=\"color: #0000ff;\">file</span><span style=\"color: #000000;\"> automatically generated by anaconda.</span></pre></div></p>\n</li>\n</ul>\n<p>#version=<span style=\"color: #000000;\">DEVEL<br></span><span style=\"color: #0000ff;\">install</span><span style=\"color: #000000;\"><br>url </span>–url=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS # 配置安装树目录 本文已ftp方式</span><br>lang en_US.UTF-<span style=\"color: #800080;\">8</span><span style=\"color: #000000;\"><br>keyboard us<br>network </span>–onboot no –device eth0 –mtu=<span style=\"color: #800080;\">1500</span> –bootproto dhcp –<span style=\"color: #000000;\">noipv6 # dhcp方式获取ip<br>rootpw  </span>–iscrypted $<span style=\"color: #800080;\">6</span><span style=\"color: #000000;\">$RyFEkouZJLufDNGf$POLwfvq2CHW2BY1qVGFzX6HoX1CsRGvaifo03Zec0uRQnupT.el3fg50b4I3pQRRMFZJqPdW8BypTe0shmZYi.</span></p>\n<h1 id=\"Reboot-after-installation\"><a href=\"#Reboot-after-installation\" class=\"headerlink\" title=\"Reboot after installation\"></a>Reboot after installation</h1><p>reboot<br>firewall –service=<span style=\"color: #0000ff;\">ssh</span><span style=\"color: #000000;\"><br>authconfig </span>–enableshadow –passalgo=<span style=\"color: #000000;\">sha512<br>selinux </span>–<span style=\"color: #000000;\">enforcing<br>timezone </span>–utc Asia/<span style=\"color: #000000;\">Shanghai # 默认时区<br>bootloader </span>–location=mbr –driveorder=sda –append=<span style=\"color: #800000;\">“</span><span style=\"color: #800000;\">crashkernel=auto rhgb rhgb quiet quiet</span><span style=\"color: #800000;\">“</span><span style=\"color: #000000;\"></span></p>\n<h1 id=\"The-following-is-the-partition-information-you-requested\"><a href=\"#The-following-is-the-partition-information-you-requested\" class=\"headerlink\" title=\"The following is the partition information you requested\"></a>The following is the partition information you requested</h1><h1 id=\"Note-that-any-partitions-you-deleted-are-not-expressed\"><a href=\"#Note-that-any-partitions-you-deleted-are-not-expressed\" class=\"headerlink\" title=\"Note that any partitions you deleted are not expressed\"></a>Note that any partitions you deleted are not expressed</h1><h1 id=\"here-so-unless-you-clear-all-partitions-first-this-is\"><a href=\"#here-so-unless-you-clear-all-partitions-first-this-is\" class=\"headerlink\" title=\"here so unless you clear all partitions first, this is\"></a>here so unless you <span style=\"color: #0000ff;\">clear</span><span style=\"color: #000000;\"> all partitions first, this is</span></h1><h1 id=\"not-guaranteed-to-work\"><a href=\"#not-guaranteed-to-work\" class=\"headerlink\" title=\"not guaranteed to work\"></a>not guaranteed to work</h1><p>clearpart –all –drives=<span style=\"color: #000000;\">sda # 删除磁盘</span></p>\n<p>part /boot –fstype=ext4 –size=<span style=\"color: #800080;\">500</span><span style=\"color: #000000;\"> # 分boot分区<br>part </span>/ –fstype=ext4 –size=<span style=\"color: #800080;\">5000</span><span style=\"color: #000000;\"> # 分根分区<br>part swap </span>–grow –maxsize=<span style=\"color: #800080;\">1024</span> –size=<span style=\"color: #800080;\">1024</span> # 分swap分区 可以使用 <code>part swap --&lt;span style=&quot;color: #000000;&quot;&gt;recommended</code> 推荐</p>\n<p>repo –name=<span style=\"color: #800000;\">“</span><span style=\"color: #800000;\">CentOS</span><span style=\"color: #800000;\">“</span>  –baseurl=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS –cost=1000 # 镜像源,包含所有的软件包</span></p>\n<p>%packages –<span style=\"color: #000000;\">nobase<br>@Core # 核心包, 可以自己添加多个</span></p>\n<p>%<span style=\"color: #000000;\">end</span></p>\n<p>%<span style=\"color: #000000;\">post<br></span><span style=\"color: #0000ff;\">yum</span> <span style=\"color: #0000ff;\">install</span> -<span style=\"color: #000000;\">y vim # 安装后自动执行脚本 可根据自己定义编写<br></span>%end<br></p>\n<p>&nbsp;</p>\n<p>配置参数很多,只列出了一点详细可参考官方网站<a href=\"http://www.centos.org/docs/5/html/Installation_Guide-en-US/s1-kickstart2-options.html\" target=\"_blank\" rel=\"external\">centos kickstart</a>&nbsp;也可一用软件自动生成ks.cfg文件,搜索软件包&nbsp;<code>yum search kickstart</code>&nbsp;出来两个 pykickstart|system-config-kickstart 安装即可</p>\n","excerpt":"","more":"<h2 id=\"每次安装CentOS时候-都需要鼠标勾选配置-一台机器安装还可以接受-如果有多台-就不好了-下面就介绍下CentOS-ftp形式无人值守安装\"><a href=\"#每次安装CentOS时候-都需要鼠标勾选配置-一台机器安装还可以接受-如果有多台-就不好了-下面就介绍下CentOS-ftp形式无人值守安装\" class=\"headerlink\" title=\"每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装\"></a><span style=\"font-size: 14px; line-height: 1.5;\">每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装</span></h2><ul>\n<li><p>测试环境</p>\n<ul>\n<li><p>2台机器</p>\n<pre><code>*   机器1: ip 192.168.1.103/24 跑了vsftpd服务,并且共享了/var/ftp, 目录内容\n\n            1.  ks.cfg CentOS kickstart配置文件[就是安装的配置文件, 每次安装系统后,都会生成 /root/anaconda-ks.cfg]\n2.  pub/CentOS/* CentOS光盘中所有内容的复制[理论是可以挂在的, 但实验挂在不行,读取不到文件]\n</code></pre><ul>\n<li>机器2 只需要放入CentOS的光盘, 启动后按键盘ESC, 输入命令 linux ks=ftp://192.168.1.103/ks.cfg 即可完成</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>ks.cfg配置文件详解<br><div class=\"cnblogs_code\"><br><pre># Kickstart <span style=\"color: #0000ff;\">file</span><span style=\"color: #000000;\"> automatically generated by anaconda.</p>\n</li>\n</ul>\n<p>#version</span>=<span style=\"color: #000000;\">DEVEL<br></span><span style=\"color: #0000ff;\">install</span><span style=\"color: #000000;\"><br>url </span>–url=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS # 配置安装树目录 本文已ftp方式</span><br>lang en_US.UTF-<span style=\"color: #800080;\">8</span><span style=\"color: #000000;\"><br>keyboard us<br>network </span>–onboot no –device eth0 –mtu=<span style=\"color: #800080;\">1500</span> –bootproto dhcp –<span style=\"color: #000000;\">noipv6 # dhcp方式获取ip<br>rootpw  </span>–iscrypted $<span style=\"color: #800080;\">6</span><span style=\"color: #000000;\">$RyFEkouZJLufDNGf$POLwfvq2CHW2BY1qVGFzX6HoX1CsRGvaifo03Zec0uRQnupT.el3fg50b4I3pQRRMFZJqPdW8BypTe0shmZYi.</p>\n<h1 id=\"Reboot-after-installation\"><a href=\"#Reboot-after-installation\" class=\"headerlink\" title=\"Reboot after installation\"></a>Reboot after installation</h1><p>reboot<br>firewall </span>–service=<span style=\"color: #0000ff;\">ssh</span><span style=\"color: #000000;\"><br>authconfig </span>–enableshadow –passalgo=<span style=\"color: #000000;\">sha512<br>selinux </span>–<span style=\"color: #000000;\">enforcing<br>timezone </span>–utc Asia/<span style=\"color: #000000;\">Shanghai # 默认时区<br>bootloader </span>–location=mbr –driveorder=sda –append=<span style=\"color: #800000;\">“</span><span style=\"color: #800000;\">crashkernel=auto rhgb rhgb quiet quiet</span><span style=\"color: #800000;\">“</span><span style=\"color: #000000;\"></p>\n<h1 id=\"The-following-is-the-partition-information-you-requested\"><a href=\"#The-following-is-the-partition-information-you-requested\" class=\"headerlink\" title=\"The following is the partition information you requested\"></a>The following is the partition information you requested</h1><h1 id=\"Note-that-any-partitions-you-deleted-are-not-expressed\"><a href=\"#Note-that-any-partitions-you-deleted-are-not-expressed\" class=\"headerlink\" title=\"Note that any partitions you deleted are not expressed\"></a>Note that any partitions you deleted are not expressed</h1><h1 id=\"here-so-unless-you-clear-all-partitions-first-this-is\"><a href=\"#here-so-unless-you-clear-all-partitions-first-this-is\" class=\"headerlink\" title=\"here so unless you clear all partitions first, this is\"></a>here so unless you </span><span style=\"color: #0000ff;\">clear</span><span style=\"color: #000000;\"> all partitions first, this is</h1><h1 id=\"not-guaranteed-to-work\"><a href=\"#not-guaranteed-to-work\" class=\"headerlink\" title=\"not guaranteed to work\"></a>not guaranteed to work</h1><p>clearpart </span>–all –drives=<span style=\"color: #000000;\">sda # 删除磁盘</p>\n<p>part </span>/boot –fstype=ext4 –size=<span style=\"color: #800080;\">500</span><span style=\"color: #000000;\"> # 分boot分区<br>part </span>/ –fstype=ext4 –size=<span style=\"color: #800080;\">5000</span><span style=\"color: #000000;\"> # 分根分区<br>part swap </span>–grow –maxsize=<span style=\"color: #800080;\">1024</span> –size=<span style=\"color: #800080;\">1024</span> # 分swap分区 可以使用 <code>part swap --&lt;span style=&quot;color: #000000;&quot;&gt;recommended</code> 推荐</p>\n<p>repo </span>–name=<span style=\"color: #800000;\">“</span><span style=\"color: #800000;\">CentOS</span><span style=\"color: #800000;\">“</span>  –baseurl=<span style=\"color: #0000ff;\">ftp</span>:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">192.168.1.103/pub/CentOS –cost=1000 # 镜像源,包含所有的软件包</span></p>\n<p>%packages –<span style=\"color: #000000;\">nobase<br>@Core # 核心包, 可以自己添加多个</p>\n<p></span>%<span style=\"color: #000000;\">end</p>\n<p></span>%<span style=\"color: #000000;\">post<br></span><span style=\"color: #0000ff;\">yum</span> <span style=\"color: #0000ff;\">install</span> -<span style=\"color: #000000;\">y vim # 安装后自动执行脚本 可根据自己定义编写<br></span>%end</pre><br></div></p>\n<p>&nbsp;</p>\n<p>配置参数很多,只列出了一点详细可参考官方网站<a href=\"http://www.centos.org/docs/5/html/Installation_Guide-en-US/s1-kickstart2-options.html\">centos kickstart</a>&nbsp;也可一用软件自动生成ks.cfg文件,搜索软件包&nbsp;<code>yum search kickstart</code>&nbsp;出来两个 pykickstart|system-config-kickstart 安装即可</p>\n"},{"title":"CentOS jemalloc库缺失问题","date":"2015-09-14T03:45:00.000Z","_content":"\n#### jemalloc 库安装 ####\n\n* 最近编译redis, varnish老薄jemalloc缺失.\n\n* 到[网站](https://dl.fedoraproject.org/pub/epel/6/x86_64/repoview/jemalloc.html)下载对应的rpm包\n\n   rpm -ivh jemalloc-3.6.0-1.el6.{i686 | X86_64}\n\n* 在编译一次","source":"_posts/CentOS-jemalloc库缺失问题.md","raw":"---\ntitle: CentOS jemalloc库缺失问题\ntags: []\ndate: 2015-09-14 11:45:00\n---\n\n#### jemalloc 库安装 ####\n\n* 最近编译redis, varnish老薄jemalloc缺失.\n\n* 到[网站](https://dl.fedoraproject.org/pub/epel/6/x86_64/repoview/jemalloc.html)下载对应的rpm包\n\n   rpm -ivh jemalloc-3.6.0-1.el6.{i686 | X86_64}\n\n* 在编译一次","slug":"CentOS-jemalloc库缺失问题","published":1,"updated":"2016-09-15T07:13:28.129Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsv00037sqvxqx4yh1g","content":"<h4 id=\"jemalloc-库安装\"><a href=\"#jemalloc-库安装\" class=\"headerlink\" title=\"jemalloc 库安装\"></a>jemalloc 库安装</h4><ul>\n<li><p>最近编译redis, varnish老薄jemalloc缺失.</p>\n</li>\n<li><p>到<a href=\"https://dl.fedoraproject.org/pub/epel/6/x86_64/repoview/jemalloc.html\" target=\"_blank\" rel=\"external\">网站</a>下载对应的rpm包</p>\n<p> rpm -ivh jemalloc-3.6.0-1.el6.{i686 | X86_64}</p>\n</li>\n<li><p>在编译一次</p>\n</li>\n</ul>\n","excerpt":"","more":"<h4 id=\"jemalloc-库安装\"><a href=\"#jemalloc-库安装\" class=\"headerlink\" title=\"jemalloc 库安装\"></a>jemalloc 库安装</h4><ul>\n<li><p>最近编译redis, varnish老薄jemalloc缺失.</p>\n</li>\n<li><p>到<a href=\"https://dl.fedoraproject.org/pub/epel/6/x86_64/repoview/jemalloc.html\">网站</a>下载对应的rpm包</p>\n<p> rpm -ivh jemalloc-3.6.0-1.el6.{i686 | X86_64}</p>\n</li>\n<li><p>在编译一次</p>\n</li>\n</ul>\n"},{"title":"CentOS6.5(Kernel2.6) Compile PHP5.6","date":"2015-08-29T16:15:00.000Z","_content":"\n>CentOS的镜像源php版本是5.3,好旧，使用5.6\n\n*  **到php官方网站下载最新的phpxxx.tar.bz2 [php official website](http://php.net),后使用命令**\n\n      wget http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror php-5.6.12.tar.bz2\n\n*  **解压包**\n\n      tar -jxvf php-5.6.12.tar.bz2 && cd php-5.6.12\n\n* **安装编译php依赖**\n\n      yum install gcc bison bison-devel zlib-devel libmcrypt-devel mcrypt mhash-devel openssl-devel libxml2-devel libcurl-devel bzip2-devel readline-devel libedit-devel sqlite-devel\n\n* **编译**\n\n      --prefix=/usr/local/php56 \\\n      -with-config-file-path=/usr/local/php56/etc \\\n        --enable-inline-optimization \\\n        --disable-debug \\\n        --disable-rpath \\\n        --enable-shared \\\n        --enable-opcache \\\n        --enable-fpm \\\n        --with-fpm-user=www \\\n        --with-fpm-group=www \\\n        --with-mysql=mysqlnd \\\n        --with-mysqli=mysqlnd \\\n        --with-pdo-mysql=mysqlnd \\\n        --with-gettext \\\n        --enable-mbstring \\\n        --with-iconv \\\n        --with-mcrypt \\\n        --with-mhash \\\n        --with-openssl \\\n        --enable-bcmath \\\n        --enable-soap \\\n        --with-libxml-dir \\\n        --enable-pcntl \\\n        --enable-shmop \\\n        --enable-sysvmsg \\\n        --enable-sysvsem \\\n        --enable-sysvshm \\\n        --enable-sockets \\\n        --with-curl \\\n        --with-zlib \\\n        --enable-zip \\\n        --with-bz2 \\\n        --with-readline   \\\n       --with-apxs2=/usr/sbin/apxs \\ \n\n      (参数[**_--with-apxs2=FILE _**]php是以模块形式加入到httpd服务中运行需要家此参数, (nginx做web服务时候是不需要的) 如果没有apxs命令,使用yum install httpd-devel包)\n\n* **httpd添加php模块支持,找多对应httpd配置文件,(etc. vim /etc/httpd/conf/httpd.conf)添加如下行**\n\n      DirectoryIndex index.html index.html.var index.php\n\n      LoadModule php5_module        /usr/lib64/httpd/modules/libphp5.so\n\n      PHPIniDir /usr/local/php56/etc/php.ini\n\n      AddType application/x-httpd-php .php   \n\n* **测试是否成功**\n\n      [sudo] service httpd start\n\n      echo '<?php phpinfo();' > /var/www/html/index.php (ps: /var/www/html 为CentOS默认路径,根据自己配置的,对应配置即可)","source":"_posts/CentOS6-5-Kernel2-6-Compile-PHP5-6-1.md","raw":"---\ntitle: CentOS6.5(Kernel2.6) Compile PHP5.6\ntags: []\ndate: 2015-08-30 00:15:00\n---\n\n>CentOS的镜像源php版本是5.3,好旧，使用5.6\n\n*  **到php官方网站下载最新的phpxxx.tar.bz2 [php official website](http://php.net),后使用命令**\n\n      wget http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror php-5.6.12.tar.bz2\n\n*  **解压包**\n\n      tar -jxvf php-5.6.12.tar.bz2 && cd php-5.6.12\n\n* **安装编译php依赖**\n\n      yum install gcc bison bison-devel zlib-devel libmcrypt-devel mcrypt mhash-devel openssl-devel libxml2-devel libcurl-devel bzip2-devel readline-devel libedit-devel sqlite-devel\n\n* **编译**\n\n      --prefix=/usr/local/php56 \\\n      -with-config-file-path=/usr/local/php56/etc \\\n        --enable-inline-optimization \\\n        --disable-debug \\\n        --disable-rpath \\\n        --enable-shared \\\n        --enable-opcache \\\n        --enable-fpm \\\n        --with-fpm-user=www \\\n        --with-fpm-group=www \\\n        --with-mysql=mysqlnd \\\n        --with-mysqli=mysqlnd \\\n        --with-pdo-mysql=mysqlnd \\\n        --with-gettext \\\n        --enable-mbstring \\\n        --with-iconv \\\n        --with-mcrypt \\\n        --with-mhash \\\n        --with-openssl \\\n        --enable-bcmath \\\n        --enable-soap \\\n        --with-libxml-dir \\\n        --enable-pcntl \\\n        --enable-shmop \\\n        --enable-sysvmsg \\\n        --enable-sysvsem \\\n        --enable-sysvshm \\\n        --enable-sockets \\\n        --with-curl \\\n        --with-zlib \\\n        --enable-zip \\\n        --with-bz2 \\\n        --with-readline   \\\n       --with-apxs2=/usr/sbin/apxs \\ \n\n      (参数[**_--with-apxs2=FILE _**]php是以模块形式加入到httpd服务中运行需要家此参数, (nginx做web服务时候是不需要的) 如果没有apxs命令,使用yum install httpd-devel包)\n\n* **httpd添加php模块支持,找多对应httpd配置文件,(etc. vim /etc/httpd/conf/httpd.conf)添加如下行**\n\n      DirectoryIndex index.html index.html.var index.php\n\n      LoadModule php5_module        /usr/lib64/httpd/modules/libphp5.so\n\n      PHPIniDir /usr/local/php56/etc/php.ini\n\n      AddType application/x-httpd-php .php   \n\n* **测试是否成功**\n\n      [sudo] service httpd start\n\n      echo '<?php phpinfo();' > /var/www/html/index.php (ps: /var/www/html 为CentOS默认路径,根据自己配置的,对应配置即可)","slug":"CentOS6-5-Kernel2-6-Compile-PHP5-6-1","published":1,"updated":"2016-09-15T07:13:28.130Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsv00047sqvfofecjcl","content":"<blockquote>\n<p>CentOS的镜像源php版本是5.3,好旧，使用5.6</p>\n</blockquote>\n<ul>\n<li><p><strong>到php官方网站下载最新的phpxxx.tar.bz2 <a href=\"http://php.net\" target=\"_blank\" rel=\"external\">php official website</a>,后使用命令</strong></p>\n<p>   wget <a href=\"http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror\" target=\"_blank\" rel=\"external\">http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror</a> php-5.6.12.tar.bz2</p>\n</li>\n<li><p><strong>解压包</strong></p>\n<p>   tar -jxvf php-5.6.12.tar.bz2 &amp;&amp; cd php-5.6.12</p>\n</li>\n<li><p><strong>安装编译php依赖</strong></p>\n<pre><code>yum install gcc bison bison-devel zlib-devel libmcrypt-devel mcrypt mhash-devel openssl-devel libxml2-devel libcurl-devel bzip2-devel readline-devel libedit-devel sqlite-devel\n</code></pre></li>\n<li><p><strong>编译</strong></p>\n<pre><code>--prefix=/usr/local/php56 \\\n-with-config-file-path=/usr/local/php56/etc \\\n  --enable-inline-optimization \\\n  --disable-debug \\\n  --disable-rpath \\\n  --enable-shared \\\n  --enable-opcache \\\n  --enable-fpm \\\n  --with-fpm-user=www \\\n  --with-fpm-group=www \\\n  --with-mysql=mysqlnd \\\n  --with-mysqli=mysqlnd \\\n  --with-pdo-mysql=mysqlnd \\\n  --with-gettext \\\n  --enable-mbstring \\\n  --with-iconv \\\n  --with-mcrypt \\\n  --with-mhash \\\n  --with-openssl \\\n  --enable-bcmath \\\n  --enable-soap \\\n  --with-libxml-dir \\\n  --enable-pcntl \\\n  --enable-shmop \\\n  --enable-sysvmsg \\\n  --enable-sysvsem \\\n  --enable-sysvshm \\\n  --enable-sockets \\\n  --with-curl \\\n  --with-zlib \\\n  --enable-zip \\\n  --with-bz2 \\\n  --with-readline   \\\n --with-apxs2=/usr/sbin/apxs \\ \n\n(参数[**_--with-apxs2=FILE _**]php是以模块形式加入到httpd服务中运行需要家此参数, (nginx做web服务时候是不需要的) 如果没有apxs命令,使用yum install httpd-devel包)\n</code></pre></li>\n<li><p><strong>httpd添加php模块支持,找多对应httpd配置文件,(etc. vim /etc/httpd/conf/httpd.conf)添加如下行</strong></p>\n<pre><code>DirectoryIndex index.html index.html.var index.php\n\nLoadModule php5_module        /usr/lib64/httpd/modules/libphp5.so\n\nPHPIniDir /usr/local/php56/etc/php.ini\n\nAddType application/x-httpd-php .php   \n</code></pre></li>\n<li><p><strong>测试是否成功</strong></p>\n<pre><code>[sudo] service httpd start\n\necho &apos;&lt;?php phpinfo();&apos; &gt; /var/www/html/index.php (ps: /var/www/html 为CentOS默认路径,根据自己配置的,对应配置即可)\n</code></pre></li>\n</ul>\n","excerpt":"","more":"<blockquote>\n<p>CentOS的镜像源php版本是5.3,好旧，使用5.6</p>\n</blockquote>\n<ul>\n<li><p><strong>到php官方网站下载最新的phpxxx.tar.bz2 <a href=\"http://php.net\">php official website</a>,后使用命令</strong></p>\n<p>   wget <a href=\"http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror\">http://bg2.php.net/get/php-5.6.12.tar.bz2/from/this/mirror</a> php-5.6.12.tar.bz2</p>\n</li>\n<li><p><strong>解压包</strong></p>\n<p>   tar -jxvf php-5.6.12.tar.bz2 &amp;&amp; cd php-5.6.12</p>\n</li>\n<li><p><strong>安装编译php依赖</strong></p>\n<pre><code>yum install gcc bison bison-devel zlib-devel libmcrypt-devel mcrypt mhash-devel openssl-devel libxml2-devel libcurl-devel bzip2-devel readline-devel libedit-devel sqlite-devel\n</code></pre></li>\n<li><p><strong>编译</strong></p>\n<pre><code>--prefix=/usr/local/php56 \\\n-with-config-file-path=/usr/local/php56/etc \\\n  --enable-inline-optimization \\\n  --disable-debug \\\n  --disable-rpath \\\n  --enable-shared \\\n  --enable-opcache \\\n  --enable-fpm \\\n  --with-fpm-user=www \\\n  --with-fpm-group=www \\\n  --with-mysql=mysqlnd \\\n  --with-mysqli=mysqlnd \\\n  --with-pdo-mysql=mysqlnd \\\n  --with-gettext \\\n  --enable-mbstring \\\n  --with-iconv \\\n  --with-mcrypt \\\n  --with-mhash \\\n  --with-openssl \\\n  --enable-bcmath \\\n  --enable-soap \\\n  --with-libxml-dir \\\n  --enable-pcntl \\\n  --enable-shmop \\\n  --enable-sysvmsg \\\n  --enable-sysvsem \\\n  --enable-sysvshm \\\n  --enable-sockets \\\n  --with-curl \\\n  --with-zlib \\\n  --enable-zip \\\n  --with-bz2 \\\n  --with-readline   \\\n --with-apxs2=/usr/sbin/apxs \\ \n\n(参数[**_--with-apxs2=FILE _**]php是以模块形式加入到httpd服务中运行需要家此参数, (nginx做web服务时候是不需要的) 如果没有apxs命令,使用yum install httpd-devel包)\n</code></pre></li>\n<li><p><strong>httpd添加php模块支持,找多对应httpd配置文件,(etc. vim /etc/httpd/conf/httpd.conf)添加如下行</strong></p>\n<pre><code>DirectoryIndex index.html index.html.var index.php\n\nLoadModule php5_module        /usr/lib64/httpd/modules/libphp5.so\n\nPHPIniDir /usr/local/php56/etc/php.ini\n\nAddType application/x-httpd-php .php   \n</code></pre></li>\n<li><p><strong>测试是否成功</strong></p>\n<pre><code>[sudo] service httpd start\n\necho &apos;&lt;?php phpinfo();&apos; &gt; /var/www/html/index.php (ps: /var/www/html 为CentOS默认路径,根据自己配置的,对应配置即可)\n</code></pre></li>\n</ul>\n"},{"title":"Knockoutjs 实现省市联动","date":"2015-08-24T16:22:00.000Z","_content":"\n## Knockoutjs 实现省市联动 ##\n\nhtml code\n\n```html\n\n<!doctype>\n<html>\n    <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <meta charset=\"utf-8\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"bower_components/bootstrap/dist/css/bootstrap.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"bower_components/bootstrap/dist/css/bootstrap-theme.css\">\n        <script src=\"bower_components/jquery/dist/jquery.js\"></script>\n        <script src=\"bower_components/bootstrap/dist/js/bootstrap.js\"></script>\n        <script src=\"bower_components/knockoutjs/dist/knockout.debug.js\"></script>\n    </head>\n    <body>\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-md-3\" id=\"country\">\n                    <select class=\"form-control\" data-bind=\"options: countryArray, optionsText: 'countryName', optionsValue: 'countryId', value: countryValue, optionsCaption: 'please select', event:{'change': getCity}\"></select>\n                </div>\n                <div class=\"col-md-2\" id=\"village\">\n                    <select class=\"form-control\" data-bind=\"visible: countryValue, options: cityArray, optionsText: 'cityName', optionsCaption: 'Please select', optionsValue: 'cityId', value: 'cityValue'\"></select>\n                </div>\n            </div>\n        </div>\n    </body>\n    <script>\n        var countryModel = function(){\n            var that = this;\n\n            that.countryArray = ko.observableArray();\n\n            that.countryValue = ko.observable();\n\n            $.getJSON('http://localhost/demo.php', function(response) {//动态获取国家\n                that.countryArray(response);\n            })\n\n            that.getCity = function() {\n                var id = that.countryValue();\n                $.getJSON('http://localhost/demo.php', {id: id}, function(response){//动态获取城市\n                    that.cityArray(response);\n                })\n            }\n\n            that.cityArray = ko.observableArray();\n        }\n\n        ko.applyBindings(new countryModel());\n    </script>\n</html>\n\n```\n\njavascript code\n\n```php\n<?php\n\n$country = array(\n    array(\n        'countryName' => 'china',\n        'countryId' => 1,\n    ),\n    array(\n        'countryName' => 'japan',\n        'countryId' => 2,\n    ),\n    array(\n        'countryName' => 'korean',\n        'countryId' => 3,\n    ),\n);\n\nif(isset($_GET['id']) && $_GET['id'] == '1')\n{\n    $city = array(\n        array(\n            'cityName' => 'beijing',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'shanghai',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse if(isset($_GET['id']) && $_GET['id'] == 2)\n{\n    $city = array(\n        array(\n            'cityName' => 'dongjing',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'daban',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse if(isset($_GET['id']) && $_GET['id'] == 3)\n{\n    $city = array(\n        array(\n            'cityName' => '首尔',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'ahha',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse\n{\n    echo json_encode($country);\n}\n\n```","source":"_posts/Knockoutjs-实现省市联动.md","raw":"---\ntitle: Knockoutjs 实现省市联动\ntags: []\ndate: 2015-08-25 00:22:00\n---\n\n## Knockoutjs 实现省市联动 ##\n\nhtml code\n\n```html\n\n<!doctype>\n<html>\n    <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <meta charset=\"utf-8\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"bower_components/bootstrap/dist/css/bootstrap.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"bower_components/bootstrap/dist/css/bootstrap-theme.css\">\n        <script src=\"bower_components/jquery/dist/jquery.js\"></script>\n        <script src=\"bower_components/bootstrap/dist/js/bootstrap.js\"></script>\n        <script src=\"bower_components/knockoutjs/dist/knockout.debug.js\"></script>\n    </head>\n    <body>\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-md-3\" id=\"country\">\n                    <select class=\"form-control\" data-bind=\"options: countryArray, optionsText: 'countryName', optionsValue: 'countryId', value: countryValue, optionsCaption: 'please select', event:{'change': getCity}\"></select>\n                </div>\n                <div class=\"col-md-2\" id=\"village\">\n                    <select class=\"form-control\" data-bind=\"visible: countryValue, options: cityArray, optionsText: 'cityName', optionsCaption: 'Please select', optionsValue: 'cityId', value: 'cityValue'\"></select>\n                </div>\n            </div>\n        </div>\n    </body>\n    <script>\n        var countryModel = function(){\n            var that = this;\n\n            that.countryArray = ko.observableArray();\n\n            that.countryValue = ko.observable();\n\n            $.getJSON('http://localhost/demo.php', function(response) {//动态获取国家\n                that.countryArray(response);\n            })\n\n            that.getCity = function() {\n                var id = that.countryValue();\n                $.getJSON('http://localhost/demo.php', {id: id}, function(response){//动态获取城市\n                    that.cityArray(response);\n                })\n            }\n\n            that.cityArray = ko.observableArray();\n        }\n\n        ko.applyBindings(new countryModel());\n    </script>\n</html>\n\n```\n\njavascript code\n\n```php\n<?php\n\n$country = array(\n    array(\n        'countryName' => 'china',\n        'countryId' => 1,\n    ),\n    array(\n        'countryName' => 'japan',\n        'countryId' => 2,\n    ),\n    array(\n        'countryName' => 'korean',\n        'countryId' => 3,\n    ),\n);\n\nif(isset($_GET['id']) && $_GET['id'] == '1')\n{\n    $city = array(\n        array(\n            'cityName' => 'beijing',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'shanghai',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse if(isset($_GET['id']) && $_GET['id'] == 2)\n{\n    $city = array(\n        array(\n            'cityName' => 'dongjing',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'daban',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse if(isset($_GET['id']) && $_GET['id'] == 3)\n{\n    $city = array(\n        array(\n            'cityName' => '首尔',\n            'cityId' => 1,\n        ),\n        array(\n            'cityName' => 'ahha',\n            'cityId' => 2,\n        ),\n    );\n\n    echo json_encode($city);\n}\n\nelse\n{\n    echo json_encode($country);\n}\n\n```","slug":"Knockoutjs-实现省市联动","published":1,"updated":"2016-09-15T07:13:28.138Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsv00057sqv3ami8ou8","content":"<h2 id=\"Knockoutjs-实现省市联动\"><a href=\"#Knockoutjs-实现省市联动\" class=\"headerlink\" title=\"Knockoutjs 实现省市联动\"></a>Knockoutjs 实现省市联动</h2><p>html code</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;!doctype&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"bower_components/bootstrap/dist/css/bootstrap.css\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"bower_components/bootstrap/dist/css/bootstrap-theme.css\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/jquery/dist/jquery.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/bootstrap/dist/js/bootstrap.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/knockoutjs/dist/knockout.debug.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"row\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col-md-3\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"country\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">data-bind</span>=<span class=\"string\">\"options: countryArray, optionsText: 'countryName', optionsValue: 'countryId', value: countryValue, optionsCaption: 'please select', event:&#123;'change': getCity&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col-md-2\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"village\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">data-bind</span>=<span class=\"string\">\"visible: countryValue, options: cityArray, optionsText: 'cityName', optionsCaption: 'Please select', optionsValue: 'cityId', value: 'cityValue'\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        var countryModel = function()&#123;</span><br><span class=\"line\">            var that = this;</span><br><span class=\"line\"></span><br><span class=\"line\">            that.countryArray = ko.observableArray();</span><br><span class=\"line\"></span><br><span class=\"line\">            that.countryValue = ko.observable();</span><br><span class=\"line\"></span><br><span class=\"line\">            $.getJSON('http://localhost/demo.php', function(response) &#123;//动态获取国家</span><br><span class=\"line\">                that.countryArray(response);</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">            that.getCity = function() &#123;</span><br><span class=\"line\">                var id = that.countryValue();</span><br><span class=\"line\">                $.getJSON('http://localhost/demo.php', &#123;id: id&#125;, function(response)&#123;//动态获取城市</span><br><span class=\"line\">                    that.cityArray(response);</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            that.cityArray = ko.observableArray();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ko.applyBindings(new countryModel());</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>javascript code</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">$country = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'china'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'japan'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'korean'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">3</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"string\">'1'</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'beijing'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'shanghai'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"number\">2</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'dongjing'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'daban'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"number\">3</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'首尔'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'ahha'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($country);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h2 id=\"Knockoutjs-实现省市联动\"><a href=\"#Knockoutjs-实现省市联动\" class=\"headerlink\" title=\"Knockoutjs 实现省市联动\"></a>Knockoutjs 实现省市联动</h2><p>html code</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;!doctype&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"bower_components/bootstrap/dist/css/bootstrap.css\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"bower_components/bootstrap/dist/css/bootstrap-theme.css\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/jquery/dist/jquery.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/bootstrap/dist/js/bootstrap.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bower_components/knockoutjs/dist/knockout.debug.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"row\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col-md-3\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"country\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">data-bind</span>=<span class=\"string\">\"options: countryArray, optionsText: 'countryName', optionsValue: 'countryId', value: countryValue, optionsCaption: 'please select', event:&#123;'change': getCity&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col-md-2\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"village\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">data-bind</span>=<span class=\"string\">\"visible: countryValue, options: cityArray, optionsText: 'cityName', optionsCaption: 'Please select', optionsValue: 'cityId', value: 'cityValue'\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        var countryModel = function()&#123;</span><br><span class=\"line\">            var that = this;</span><br><span class=\"line\"></span><br><span class=\"line\">            that.countryArray = ko.observableArray();</span><br><span class=\"line\"></span><br><span class=\"line\">            that.countryValue = ko.observable();</span><br><span class=\"line\"></span><br><span class=\"line\">            $.getJSON('http://localhost/demo.php', function(response) &#123;//动态获取国家</span><br><span class=\"line\">                that.countryArray(response);</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">            that.getCity = function() &#123;</span><br><span class=\"line\">                var id = that.countryValue();</span><br><span class=\"line\">                $.getJSON('http://localhost/demo.php', &#123;id: id&#125;, function(response)&#123;//动态获取城市</span><br><span class=\"line\">                    that.cityArray(response);</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            that.cityArray = ko.observableArray();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ko.applyBindings(new countryModel());</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>javascript code</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">$country = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'china'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'japan'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">'countryName'</span> =&gt; <span class=\"string\">'korean'</span>,</span><br><span class=\"line\">        <span class=\"string\">'countryId'</span> =&gt; <span class=\"number\">3</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"string\">'1'</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'beijing'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'shanghai'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"number\">2</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'dongjing'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'daban'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'id'</span>]) &amp;&amp; $_GET[<span class=\"string\">'id'</span>] == <span class=\"number\">3</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $city = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'首尔'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">1</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'cityName'</span> =&gt; <span class=\"string\">'ahha'</span>,</span><br><span class=\"line\">            <span class=\"string\">'cityId'</span> =&gt; <span class=\"number\">2</span>,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($city);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> json_encode($country);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"MySQL InnoDB存储引擎外键约束","date":"2015-08-14T03:22:00.000Z","_content":"\n## InnoDB存储引擎 外键约束 ##\n\n语法:\n\n```sql\nCREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (index_col_name,...)\nREFERENCES tbl_name(index_col_name,...) ON DELETE  [RESTRICT | CASCADE | SET NULL | NO ACTION] ON UPDATE [RESTRICT | CASCADE | SET NULL | NO ACTION]\n```\n[官方文档参考][1]\n\n本文讨论 ON {DELETE , UPDATE} [RESTRICT | CASCADE | SET DEFAULT | NO ACTION | SET NULL]\n\n* ON DELETE | UPDATE 表示父表在发生删除, 更新事件的时候,子表对应的操作\n* RESTRICT 表示当子表有数据关联到父表的数据时候, 不能删除父表的数据\n* CASCADE  表示删除或更新父表数据的时候, 对应也会相应跟删除或更新子表的数据. Note: 到5.6版本为止, 还不支持事务\n* SET DEFAULT MySQL占不支持InnoDB表\n* NO ACTION MySQL中的NO ACTION可理解为RESTRICT, 有些数据库延迟检查功能, MySQL是即时检查,所以和RESTRICT一样的\n* SET NULL 父表中的删除或更新数据, 子表中的有关联约束的字段设置为NULL\n\n[官方参考文档][1]\n\n[1]: http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html","source":"_posts/MySQL-InnoDB存储引擎外键约束.md","raw":"---\ntitle: MySQL InnoDB存储引擎外键约束\ntags: []\ndate: 2015-08-14 11:22:00\n---\n\n## InnoDB存储引擎 外键约束 ##\n\n语法:\n\n```sql\nCREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (index_col_name,...)\nREFERENCES tbl_name(index_col_name,...) ON DELETE  [RESTRICT | CASCADE | SET NULL | NO ACTION] ON UPDATE [RESTRICT | CASCADE | SET NULL | NO ACTION]\n```\n[官方文档参考][1]\n\n本文讨论 ON {DELETE , UPDATE} [RESTRICT | CASCADE | SET DEFAULT | NO ACTION | SET NULL]\n\n* ON DELETE | UPDATE 表示父表在发生删除, 更新事件的时候,子表对应的操作\n* RESTRICT 表示当子表有数据关联到父表的数据时候, 不能删除父表的数据\n* CASCADE  表示删除或更新父表数据的时候, 对应也会相应跟删除或更新子表的数据. Note: 到5.6版本为止, 还不支持事务\n* SET DEFAULT MySQL占不支持InnoDB表\n* NO ACTION MySQL中的NO ACTION可理解为RESTRICT, 有些数据库延迟检查功能, MySQL是即时检查,所以和RESTRICT一样的\n* SET NULL 父表中的删除或更新数据, 子表中的有关联约束的字段设置为NULL\n\n[官方参考文档][1]\n\n[1]: http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html","slug":"MySQL-InnoDB存储引擎外键约束","published":1,"updated":"2016-09-15T07:13:28.138Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsv00067sqv31q5er3l","content":"<h2 id=\"InnoDB存储引擎-外键约束\"><a href=\"#InnoDB存储引擎-外键约束\" class=\"headerlink\" title=\"InnoDB存储引擎 外键约束\"></a>InnoDB存储引擎 外键约束</h2><p>语法:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">TEMPORARY</span>] <span class=\"keyword\">TABLE</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span>] tbl_name [<span class=\"keyword\">CONSTRAINT</span> [symbol]] FOREIGN <span class=\"keyword\">KEY</span> [index_name] (index_col_name,...)</span><br><span class=\"line\"><span class=\"keyword\">REFERENCES</span> tbl_name(index_col_name,...) <span class=\"keyword\">ON</span> <span class=\"keyword\">DELETE</span>  [RESTRICT | <span class=\"keyword\">CASCADE</span> | <span class=\"keyword\">SET</span> <span class=\"literal\">NULL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">ACTION</span>] <span class=\"keyword\">ON</span> <span class=\"keyword\">UPDATE</span> [RESTRICT | <span class=\"keyword\">CASCADE</span> | <span class=\"keyword\">SET</span> <span class=\"literal\">NULL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">ACTION</span>]</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html\" target=\"_blank\" rel=\"external\">官方文档参考</a></p>\n<p>本文讨论 ON {DELETE , UPDATE} [RESTRICT | CASCADE | SET DEFAULT | NO ACTION | SET NULL]</p>\n<ul>\n<li>ON DELETE | UPDATE 表示父表在发生删除, 更新事件的时候,子表对应的操作</li>\n<li>RESTRICT 表示当子表有数据关联到父表的数据时候, 不能删除父表的数据</li>\n<li>CASCADE  表示删除或更新父表数据的时候, 对应也会相应跟删除或更新子表的数据. Note: 到5.6版本为止, 还不支持事务</li>\n<li>SET DEFAULT MySQL占不支持InnoDB表</li>\n<li>NO ACTION MySQL中的NO ACTION可理解为RESTRICT, 有些数据库延迟检查功能, MySQL是即时检查,所以和RESTRICT一样的</li>\n<li>SET NULL 父表中的删除或更新数据, 子表中的有关联约束的字段设置为NULL</li>\n</ul>\n<p><a href=\"http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html\" target=\"_blank\" rel=\"external\">官方参考文档</a></p>\n","excerpt":"","more":"<h2 id=\"InnoDB存储引擎-外键约束\"><a href=\"#InnoDB存储引擎-外键约束\" class=\"headerlink\" title=\"InnoDB存储引擎 外键约束\"></a>InnoDB存储引擎 外键约束</h2><p>语法:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">TEMPORARY</span>] <span class=\"keyword\">TABLE</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span>] tbl_name [<span class=\"keyword\">CONSTRAINT</span> [symbol]] FOREIGN <span class=\"keyword\">KEY</span> [index_name] (index_col_name,...)</span><br><span class=\"line\"><span class=\"keyword\">REFERENCES</span> tbl_name(index_col_name,...) <span class=\"keyword\">ON</span> <span class=\"keyword\">DELETE</span>  [RESTRICT | <span class=\"keyword\">CASCADE</span> | <span class=\"keyword\">SET</span> <span class=\"literal\">NULL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">ACTION</span>] <span class=\"keyword\">ON</span> <span class=\"keyword\">UPDATE</span> [RESTRICT | <span class=\"keyword\">CASCADE</span> | <span class=\"keyword\">SET</span> <span class=\"literal\">NULL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">ACTION</span>]</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html\">官方文档参考</a></p>\n<p>本文讨论 ON {DELETE , UPDATE} [RESTRICT | CASCADE | SET DEFAULT | NO ACTION | SET NULL]</p>\n<ul>\n<li>ON DELETE | UPDATE 表示父表在发生删除, 更新事件的时候,子表对应的操作</li>\n<li>RESTRICT 表示当子表有数据关联到父表的数据时候, 不能删除父表的数据</li>\n<li>CASCADE  表示删除或更新父表数据的时候, 对应也会相应跟删除或更新子表的数据. Note: 到5.6版本为止, 还不支持事务</li>\n<li>SET DEFAULT MySQL占不支持InnoDB表</li>\n<li>NO ACTION MySQL中的NO ACTION可理解为RESTRICT, 有些数据库延迟检查功能, MySQL是即时检查,所以和RESTRICT一样的</li>\n<li>SET NULL 父表中的删除或更新数据, 子表中的有关联约束的字段设置为NULL</li>\n</ul>\n<p><a href=\"http://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html\">官方参考文档</a></p>\n"},{"title":"MySQL单台服务器跑多个实例子","date":"2015-12-22T08:18:00.000Z","_content":"\n#####   mysqld_multi 命令实现管理 #####\n\n1\\. 每个mysql实例都需要有独立的数据目录, socket链接, 端口. 所以, 为每个实例创建数据目录  \n\n    到mysql的数据目录下, 复制整个目录(有几个实例,就复制几份), 命名为新的实例名字(任意) (本例子拷贝了3份,分别放在/var/data/data{1,2,3}, Unix, Unix-like 注意文件权限)  \n    多个实例可以共享一份数据目录, 但强烈不建议, 会有意想不到的问到[mysql官方](http://dev.mysql.com/doc/refman/5.7/en/multiple-data-directories.html)\n\n2\\. 修改my.cnf文件(本例子跑了3个实例子分别[1,2,3])\n    <pre>\n            [client]\n            # 默认 使用/tmp/mysql.sock1\n            socket = /tmp/mysql.sock1\n\n            [mysqld1]\n            socket     = /tmp/mysql.sock1\n            port       = 3306\n            pid-file   = /var/data/data1/data1.pid\n            datadir    = /var/data/data1\n            user       = mysql\n\n            [mysqld2]\n            #mysqld     = /usr/bin/mysqld_safe\n            #mysqladmin = /usr/bin/mysqladmin\n            socket     = /tmp/mysql.sock2\n            port       = 3307\n            pid-file   = /var/data/data2/data2.pid\n            datadir    = /var/data/data2\n            user\t   = mysql\n\n            [mysqld3]\n            #mysqld     = /usr/bin/mysqld_safe\n            #mysqladmin = /usr/bin/mysqladmin\n            socket     = /tmp/mysql.sock3\n            port       = 3308\n            pid-file   = /var/data/data3/data3.pid\n            datadir    = /var/data/data3\n            user\t   = mysql\n    </pre>\n\n3\\. 启动/停止\n    `mysqld_multi [OPTIONS] {start|stop|report} [GNR,GNR,GNR...]`  \n    **GNR** 表示组名,本例子 启动所有 为 `mysqld_multi start 1-3`, 启动单个 `mysqld_multi start 1`  \n    同理 停止 `mysqld_multi stop 1-3`  \n\n####  mysqld_safe 实现 ####\n\n1\\. 这种方式实现很简单了, 直接使用命令\n    <pre>\n        mysqld_safe --defaults-file=/etc/my1.cnf --user=mysql &\n        mysqld_safe --defaults-file=/etc/my2.cnf --user=mysql &\n        mysqld_safe --datadir=/var/data/data3 --pid-file=/var/data/data3/data3.pid --socket=/tmp/mysql.sock3 --user=mysql &\n    </pre>","source":"_posts/MySQL单台服务器跑多个实例子.md","raw":"---\ntitle: MySQL单台服务器跑多个实例子\ntags: []\ndate: 2015-12-22 16:18:00\n---\n\n#####   mysqld_multi 命令实现管理 #####\n\n1\\. 每个mysql实例都需要有独立的数据目录, socket链接, 端口. 所以, 为每个实例创建数据目录  \n\n    到mysql的数据目录下, 复制整个目录(有几个实例,就复制几份), 命名为新的实例名字(任意) (本例子拷贝了3份,分别放在/var/data/data{1,2,3}, Unix, Unix-like 注意文件权限)  \n    多个实例可以共享一份数据目录, 但强烈不建议, 会有意想不到的问到[mysql官方](http://dev.mysql.com/doc/refman/5.7/en/multiple-data-directories.html)\n\n2\\. 修改my.cnf文件(本例子跑了3个实例子分别[1,2,3])\n    <pre>\n            [client]\n            # 默认 使用/tmp/mysql.sock1\n            socket = /tmp/mysql.sock1\n\n            [mysqld1]\n            socket     = /tmp/mysql.sock1\n            port       = 3306\n            pid-file   = /var/data/data1/data1.pid\n            datadir    = /var/data/data1\n            user       = mysql\n\n            [mysqld2]\n            #mysqld     = /usr/bin/mysqld_safe\n            #mysqladmin = /usr/bin/mysqladmin\n            socket     = /tmp/mysql.sock2\n            port       = 3307\n            pid-file   = /var/data/data2/data2.pid\n            datadir    = /var/data/data2\n            user\t   = mysql\n\n            [mysqld3]\n            #mysqld     = /usr/bin/mysqld_safe\n            #mysqladmin = /usr/bin/mysqladmin\n            socket     = /tmp/mysql.sock3\n            port       = 3308\n            pid-file   = /var/data/data3/data3.pid\n            datadir    = /var/data/data3\n            user\t   = mysql\n    </pre>\n\n3\\. 启动/停止\n    `mysqld_multi [OPTIONS] {start|stop|report} [GNR,GNR,GNR...]`  \n    **GNR** 表示组名,本例子 启动所有 为 `mysqld_multi start 1-3`, 启动单个 `mysqld_multi start 1`  \n    同理 停止 `mysqld_multi stop 1-3`  \n\n####  mysqld_safe 实现 ####\n\n1\\. 这种方式实现很简单了, 直接使用命令\n    <pre>\n        mysqld_safe --defaults-file=/etc/my1.cnf --user=mysql &\n        mysqld_safe --defaults-file=/etc/my2.cnf --user=mysql &\n        mysqld_safe --datadir=/var/data/data3 --pid-file=/var/data/data3/data3.pid --socket=/tmp/mysql.sock3 --user=mysql &\n    </pre>","slug":"MySQL单台服务器跑多个实例子","published":1,"updated":"2016-09-15T07:13:28.139Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxsv00077sqvjcufndby","content":"<h5 id=\"mysqld-multi-命令实现管理\"><a href=\"#mysqld-multi-命令实现管理\" class=\"headerlink\" title=\"mysqld_multi 命令实现管理\"></a>mysqld_multi 命令实现管理</h5><p>1. 每个mysql实例都需要有独立的数据目录, socket链接, 端口. 所以, 为每个实例创建数据目录  </p>\n<pre><code>到mysql的数据目录下, 复制整个目录(有几个实例,就复制几份), 命名为新的实例名字(任意) (本例子拷贝了3份,分别放在/var/data/data{1,2,3}, Unix, Unix-like 注意文件权限)  \n多个实例可以共享一份数据目录, 但强烈不建议, 会有意想不到的问到[mysql官方](http://dev.mysql.com/doc/refman/5.7/en/multiple-data-directories.html)\n</code></pre><p>2. 修改my.cnf文件(本例子跑了3个实例子分别[1,2,3])<br>    <pre><br>            [client]</pre></p>\n<pre><code>        # 默认 使用/tmp/mysql.sock1\n        socket = /tmp/mysql.sock1\n\n        [mysqld1]\n        socket     = /tmp/mysql.sock1\n        port       = 3306\n        pid-file   = /var/data/data1/data1.pid\n        datadir    = /var/data/data1\n        user       = mysql\n\n        [mysqld2]\n        #mysqld     = /usr/bin/mysqld_safe\n        #mysqladmin = /usr/bin/mysqladmin\n        socket     = /tmp/mysql.sock2\n        port       = 3307\n        pid-file   = /var/data/data2/data2.pid\n        datadir    = /var/data/data2\n        user       = mysql\n\n        [mysqld3]\n        #mysqld     = /usr/bin/mysqld_safe\n        #mysqladmin = /usr/bin/mysqladmin\n        socket     = /tmp/mysql.sock3\n        port       = 3308\n        pid-file   = /var/data/data3/data3.pid\n        datadir    = /var/data/data3\n        user       = mysql\n&lt;/pre&gt;\n</code></pre><p>3. 启动/停止<br>    <code>mysqld_multi [OPTIONS] {start|stop|report} [GNR,GNR,GNR...]</code><br>    <strong>GNR</strong> 表示组名,本例子 启动所有 为 <code>mysqld_multi start 1-3</code>, 启动单个 <code>mysqld_multi start 1</code><br>    同理 停止 <code>mysqld_multi stop 1-3</code>  </p>\n<h4 id=\"mysqld-safe-实现\"><a href=\"#mysqld-safe-实现\" class=\"headerlink\" title=\"mysqld_safe 实现\"></a>mysqld_safe 实现</h4><p>1. 这种方式实现很简单了, 直接使用命令<br>    <pre><br>        mysqld_safe –defaults-file=/etc/my1.cnf –user=mysql &amp;<br>        mysqld_safe –defaults-file=/etc/my2.cnf –user=mysql &amp;<br>        mysqld_safe –datadir=/var/data/data3 –pid-file=/var/data/data3/data3.pid –socket=/tmp/mysql.sock3 –user=mysql &amp;<br>    </pre></p>\n","excerpt":"","more":"<h5 id=\"mysqld-multi-命令实现管理\"><a href=\"#mysqld-multi-命令实现管理\" class=\"headerlink\" title=\"mysqld_multi 命令实现管理\"></a>mysqld_multi 命令实现管理</h5><p>1. 每个mysql实例都需要有独立的数据目录, socket链接, 端口. 所以, 为每个实例创建数据目录  </p>\n<pre><code>到mysql的数据目录下, 复制整个目录(有几个实例,就复制几份), 命名为新的实例名字(任意) (本例子拷贝了3份,分别放在/var/data/data{1,2,3}, Unix, Unix-like 注意文件权限)  \n多个实例可以共享一份数据目录, 但强烈不建议, 会有意想不到的问到[mysql官方](http://dev.mysql.com/doc/refman/5.7/en/multiple-data-directories.html)\n</code></pre><p>2. 修改my.cnf文件(本例子跑了3个实例子分别[1,2,3])<br>    <pre><br>            [client]</p>\n<pre><code>        # 默认 使用/tmp/mysql.sock1\n        socket = /tmp/mysql.sock1\n\n        [mysqld1]\n        socket     = /tmp/mysql.sock1\n        port       = 3306\n        pid-file   = /var/data/data1/data1.pid\n        datadir    = /var/data/data1\n        user       = mysql\n\n        [mysqld2]\n        #mysqld     = /usr/bin/mysqld_safe\n        #mysqladmin = /usr/bin/mysqladmin\n        socket     = /tmp/mysql.sock2\n        port       = 3307\n        pid-file   = /var/data/data2/data2.pid\n        datadir    = /var/data/data2\n        user       = mysql\n\n        [mysqld3]\n        #mysqld     = /usr/bin/mysqld_safe\n        #mysqladmin = /usr/bin/mysqladmin\n        socket     = /tmp/mysql.sock3\n        port       = 3308\n        pid-file   = /var/data/data3/data3.pid\n        datadir    = /var/data/data3\n        user       = mysql\n&lt;/pre&gt;\n</code></pre><p>3. 启动/停止<br>    <code>mysqld_multi [OPTIONS] {start|stop|report} [GNR,GNR,GNR...]</code><br>    <strong>GNR</strong> 表示组名,本例子 启动所有 为 <code>mysqld_multi start 1-3</code>, 启动单个 <code>mysqld_multi start 1</code><br>    同理 停止 <code>mysqld_multi stop 1-3</code>  </p>\n<h4 id=\"mysqld-safe-实现\"><a href=\"#mysqld-safe-实现\" class=\"headerlink\" title=\"mysqld_safe 实现\"></a>mysqld_safe 实现</h4><p>1. 这种方式实现很简单了, 直接使用命令<br>    <pre><br>        mysqld_safe –defaults-file=/etc/my1.cnf –user=mysql &amp;<br>        mysqld_safe –defaults-file=/etc/my2.cnf –user=mysql &amp;<br>        mysqld_safe –datadir=/var/data/data3 –pid-file=/var/data/data3/data3.pid –socket=/tmp/mysql.sock3 –user=mysql &amp;<br>    </pre></p>\n"},{"title":"PHP5.4 Trait 使用","date":"2015-12-25T07:36:00.000Z","_content":"\n### Trait 是个什么鬼 ###\nPHP Trait 是一个抽象类, 不能实例化, 简单理解就是将trait的代码复制, 粘贴到你使用trait的类中. 和接口对比, 还是有区别的  \n有这么个问题.\n\n    <?php\n    class DbReader extends Mysqli\n    {\n    }\n\n    class FileReader extends SplFileObject\n    {\n    }\n\nDbReader, FileReader 都需要些公共方法, 假设都设计为单列模式, 两个类都需要getInstance方法, php不支持多继承, 怎么办?  \n\n    <?php\n    interface Singleton\n    {\n        public static function getInstance();\n    }\n\n    class DbReader extends Mysqli implements Singleton\n    {\n        public static function getInstance(){ return \"instanceOfDbReader\";}\n    }\n\n    class FileReader extends SplFileObject implements Singleton\n    {\n        public static function getInstance(){ return \"instanceOfFileReader\";}\n    }\n\n是你想要的吗? 显然是NO  \n\nSO PHP特性 Trait  \n\n    <?php\n    trait Singleton\n    {\n        private static $instance;\n\n        public static function getInstance() {\n            if (!(self::$instance instanceof self)) {\n                self::$instance = new self;\n            }\n            return self::$instance;\n        }\n    }\n\n    class DbReader extends ArrayObject\n    {\n        use Singleton;\n    }\n\n    class  FileReader\n    {\n        use Singleton;\n    }\n    $a = DbReader::getInstance();\n    $b = FileReader::getInstance();\n    var_dump($a);  //object(DbReader)\n    var_dump($b);  //object(FileReader)\n\n是不是爽了!!!. \n\n### 使用多个Trait ###\n\nPHP Trait 是可以多个使用的\n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            echo \"Hello\";\n        }\n    }\n\n    trait World\n    {\n        function sayWorld() {\n            echo \"World\";\n        }\n    }\n\n    class MyWorld\n    {\n        use Hello, World;\n    }\n\n    $world = new MyWorld();\n    echo $world->sayHello() . \" \" . $world->sayWorld(); //Hello World\n\n是不是很方便!!!  \n\n### Trait 组装 Trait ###\n\n多个Trait可以组装成一个Trait  \n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            echo \"Hello\";\n        }\n    }\n\n    trait World\n    {\n        function sayWorld() {\n            echo \"World\";\n        }\n    }\n    trait HelloWorld\n    {\n        use Hello, World;\n    }\n\n    class MyWorld\n    {\n        use HelloWorld;\n    }\n\n    $world = new MyWorld();\n    echo $world->sayHello() . \" \" . $world->sayWorld(); //Hello World\n\n### Trait 优先级 ###\n    Trait中的方法重写继承父类的方法.  \n    当前类中方法复写trait中的方法  \n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            return \"Hello\";\n        }\n\n        function sayWorld() {\n            return \"Trait World\";\n        }\n\n        function sayHelloWorld() {\n            echo $this->sayHello() . \" \" . $this->sayWorld();\n        }\n\n        function sayBaseWorld() {\n            echo $this->sayHello() . \" \" . parent::sayWorld();\n        }\n    }\n\n    class Base\n    {\n        function sayWorld(){\n            return \"Base World\";\n        }\n    }\n\n    class HelloWorld extends Base\n    {\n        use Hello;\n        function sayWorld() {\n            return \"World\";\n        }\n    }\n\n    $h =  new HelloWorld();\n    $h->sayHelloWorld(); // Hello World\n    $h->sayBaseWorld(); // Hello Base World\n\n### 解决Trait冲突 ###\n\n    <?php\n    trait Game\n    {\n        function play() {\n            echo \"Playing a game\";\n        }\n    }\n\n    trait Music\n    {\n        function play() {\n            echo \"Playing music\";\n        }\n    }\n\n    class Player\n    {\n        use Game, Music;\n    }\n\n    $player = new Player();\n    $player->play(); // Fatal Error\n\n    // resolve one\n    class Player\n    {\n        use Game, Music {\n            Music::play insteadof Game;\n        }\n    }\n\n    $player = new Player();\n    $player->play(); //Playing music\n\n    // resolve two\n    class Player\n    {\n        use Game, Music {\n            Game::play as gamePlay;\n            Music::play insteadof Game;\n        }\n    }\n\n    $player = new Player();\n    $player->play(); //Playing music\n    $player->gamePlay(); //Playing a game\n\n使用PHP Reflection类 `ReflectionClass::getTraits()` 获取类使用的traits. `ReflectionClass::getTraitNames()` 获取类中trait名称 `ReflectionClass::isTrait()` 此类是否是trait\n\n### 其他特性 ###\ntrait中的 `protected, private` 可以随便访问  \n\n    <?php\n    trait Message\n    {\n        private $message;\n\n        function alert() {\n            $this->define();\n            echo $this->message;\n        }\n        abstract function define();\n    }\n\n    class Messenger\n    {\n        use Message;\n        function define() {\n            $this->message = \"Custom Message\";\n        }\n    }\n\n    $messenger = new Messenger;\n    $messenger->alert(); //Custom Message\n\n[参考Shameer C's Blog](http://www.sitepoint.com/using-traits-in-php-5-4/)","source":"_posts/PHP5-4-Trait-使用.md","raw":"---\ntitle: PHP5.4 Trait 使用\ntags: []\ndate: 2015-12-25 15:36:00\n---\n\n### Trait 是个什么鬼 ###\nPHP Trait 是一个抽象类, 不能实例化, 简单理解就是将trait的代码复制, 粘贴到你使用trait的类中. 和接口对比, 还是有区别的  \n有这么个问题.\n\n    <?php\n    class DbReader extends Mysqli\n    {\n    }\n\n    class FileReader extends SplFileObject\n    {\n    }\n\nDbReader, FileReader 都需要些公共方法, 假设都设计为单列模式, 两个类都需要getInstance方法, php不支持多继承, 怎么办?  \n\n    <?php\n    interface Singleton\n    {\n        public static function getInstance();\n    }\n\n    class DbReader extends Mysqli implements Singleton\n    {\n        public static function getInstance(){ return \"instanceOfDbReader\";}\n    }\n\n    class FileReader extends SplFileObject implements Singleton\n    {\n        public static function getInstance(){ return \"instanceOfFileReader\";}\n    }\n\n是你想要的吗? 显然是NO  \n\nSO PHP特性 Trait  \n\n    <?php\n    trait Singleton\n    {\n        private static $instance;\n\n        public static function getInstance() {\n            if (!(self::$instance instanceof self)) {\n                self::$instance = new self;\n            }\n            return self::$instance;\n        }\n    }\n\n    class DbReader extends ArrayObject\n    {\n        use Singleton;\n    }\n\n    class  FileReader\n    {\n        use Singleton;\n    }\n    $a = DbReader::getInstance();\n    $b = FileReader::getInstance();\n    var_dump($a);  //object(DbReader)\n    var_dump($b);  //object(FileReader)\n\n是不是爽了!!!. \n\n### 使用多个Trait ###\n\nPHP Trait 是可以多个使用的\n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            echo \"Hello\";\n        }\n    }\n\n    trait World\n    {\n        function sayWorld() {\n            echo \"World\";\n        }\n    }\n\n    class MyWorld\n    {\n        use Hello, World;\n    }\n\n    $world = new MyWorld();\n    echo $world->sayHello() . \" \" . $world->sayWorld(); //Hello World\n\n是不是很方便!!!  \n\n### Trait 组装 Trait ###\n\n多个Trait可以组装成一个Trait  \n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            echo \"Hello\";\n        }\n    }\n\n    trait World\n    {\n        function sayWorld() {\n            echo \"World\";\n        }\n    }\n    trait HelloWorld\n    {\n        use Hello, World;\n    }\n\n    class MyWorld\n    {\n        use HelloWorld;\n    }\n\n    $world = new MyWorld();\n    echo $world->sayHello() . \" \" . $world->sayWorld(); //Hello World\n\n### Trait 优先级 ###\n    Trait中的方法重写继承父类的方法.  \n    当前类中方法复写trait中的方法  \n\n    <?php\n    trait Hello\n    {\n        function sayHello() {\n            return \"Hello\";\n        }\n\n        function sayWorld() {\n            return \"Trait World\";\n        }\n\n        function sayHelloWorld() {\n            echo $this->sayHello() . \" \" . $this->sayWorld();\n        }\n\n        function sayBaseWorld() {\n            echo $this->sayHello() . \" \" . parent::sayWorld();\n        }\n    }\n\n    class Base\n    {\n        function sayWorld(){\n            return \"Base World\";\n        }\n    }\n\n    class HelloWorld extends Base\n    {\n        use Hello;\n        function sayWorld() {\n            return \"World\";\n        }\n    }\n\n    $h =  new HelloWorld();\n    $h->sayHelloWorld(); // Hello World\n    $h->sayBaseWorld(); // Hello Base World\n\n### 解决Trait冲突 ###\n\n    <?php\n    trait Game\n    {\n        function play() {\n            echo \"Playing a game\";\n        }\n    }\n\n    trait Music\n    {\n        function play() {\n            echo \"Playing music\";\n        }\n    }\n\n    class Player\n    {\n        use Game, Music;\n    }\n\n    $player = new Player();\n    $player->play(); // Fatal Error\n\n    // resolve one\n    class Player\n    {\n        use Game, Music {\n            Music::play insteadof Game;\n        }\n    }\n\n    $player = new Player();\n    $player->play(); //Playing music\n\n    // resolve two\n    class Player\n    {\n        use Game, Music {\n            Game::play as gamePlay;\n            Music::play insteadof Game;\n        }\n    }\n\n    $player = new Player();\n    $player->play(); //Playing music\n    $player->gamePlay(); //Playing a game\n\n使用PHP Reflection类 `ReflectionClass::getTraits()` 获取类使用的traits. `ReflectionClass::getTraitNames()` 获取类中trait名称 `ReflectionClass::isTrait()` 此类是否是trait\n\n### 其他特性 ###\ntrait中的 `protected, private` 可以随便访问  \n\n    <?php\n    trait Message\n    {\n        private $message;\n\n        function alert() {\n            $this->define();\n            echo $this->message;\n        }\n        abstract function define();\n    }\n\n    class Messenger\n    {\n        use Message;\n        function define() {\n            $this->message = \"Custom Message\";\n        }\n    }\n\n    $messenger = new Messenger;\n    $messenger->alert(); //Custom Message\n\n[参考Shameer C's Blog](http://www.sitepoint.com/using-traits-in-php-5-4/)","slug":"PHP5-4-Trait-使用","published":1,"updated":"2016-09-15T07:13:28.139Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxtb00087sqvojdblx1r","content":"<h3 id=\"Trait-是个什么鬼\"><a href=\"#Trait-是个什么鬼\" class=\"headerlink\" title=\"Trait 是个什么鬼\"></a>Trait 是个什么鬼</h3><p>PHP Trait 是一个抽象类, 不能实例化, 简单理解就是将trait的代码复制, 粘贴到你使用trait的类中. 和接口对比, 还是有区别的<br>有这么个问题.</p>\n<pre><code>&lt;?php\nclass DbReader extends Mysqli\n{\n}\n\nclass FileReader extends SplFileObject\n{\n}\n</code></pre><p>DbReader, FileReader 都需要些公共方法, 假设都设计为单列模式, 两个类都需要getInstance方法, php不支持多继承, 怎么办?  </p>\n<pre><code>&lt;?php\ninterface Singleton\n{\n    public static function getInstance();\n}\n\nclass DbReader extends Mysqli implements Singleton\n{\n    public static function getInstance(){ return &quot;instanceOfDbReader&quot;;}\n}\n\nclass FileReader extends SplFileObject implements Singleton\n{\n    public static function getInstance(){ return &quot;instanceOfFileReader&quot;;}\n}\n</code></pre><p>是你想要的吗? 显然是NO  </p>\n<p>SO PHP特性 Trait  </p>\n<pre><code>&lt;?php\ntrait Singleton\n{\n    private static $instance;\n\n    public static function getInstance() {\n        if (!(self::$instance instanceof self)) {\n            self::$instance = new self;\n        }\n        return self::$instance;\n    }\n}\n\nclass DbReader extends ArrayObject\n{\n    use Singleton;\n}\n\nclass  FileReader\n{\n    use Singleton;\n}\n$a = DbReader::getInstance();\n$b = FileReader::getInstance();\nvar_dump($a);  //object(DbReader)\nvar_dump($b);  //object(FileReader)\n</code></pre><p>是不是爽了!!!. </p>\n<h3 id=\"使用多个Trait\"><a href=\"#使用多个Trait\" class=\"headerlink\" title=\"使用多个Trait\"></a>使用多个Trait</h3><p>PHP Trait 是可以多个使用的</p>\n<pre><code>&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        echo &quot;Hello&quot;;\n    }\n}\n\ntrait World\n{\n    function sayWorld() {\n        echo &quot;World&quot;;\n    }\n}\n\nclass MyWorld\n{\n    use Hello, World;\n}\n\n$world = new MyWorld();\necho $world-&gt;sayHello() . &quot; &quot; . $world-&gt;sayWorld(); //Hello World\n</code></pre><p>是不是很方便!!!  </p>\n<h3 id=\"Trait-组装-Trait\"><a href=\"#Trait-组装-Trait\" class=\"headerlink\" title=\"Trait 组装 Trait\"></a>Trait 组装 Trait</h3><p>多个Trait可以组装成一个Trait  </p>\n<pre><code>&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        echo &quot;Hello&quot;;\n    }\n}\n\ntrait World\n{\n    function sayWorld() {\n        echo &quot;World&quot;;\n    }\n}\ntrait HelloWorld\n{\n    use Hello, World;\n}\n\nclass MyWorld\n{\n    use HelloWorld;\n}\n\n$world = new MyWorld();\necho $world-&gt;sayHello() . &quot; &quot; . $world-&gt;sayWorld(); //Hello World\n</code></pre><h3 id=\"Trait-优先级\"><a href=\"#Trait-优先级\" class=\"headerlink\" title=\"Trait 优先级\"></a>Trait 优先级</h3><pre><code>Trait中的方法重写继承父类的方法.  \n当前类中方法复写trait中的方法  \n\n&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        return &quot;Hello&quot;;\n    }\n\n    function sayWorld() {\n        return &quot;Trait World&quot;;\n    }\n\n    function sayHelloWorld() {\n        echo $this-&gt;sayHello() . &quot; &quot; . $this-&gt;sayWorld();\n    }\n\n    function sayBaseWorld() {\n        echo $this-&gt;sayHello() . &quot; &quot; . parent::sayWorld();\n    }\n}\n\nclass Base\n{\n    function sayWorld(){\n        return &quot;Base World&quot;;\n    }\n}\n\nclass HelloWorld extends Base\n{\n    use Hello;\n    function sayWorld() {\n        return &quot;World&quot;;\n    }\n}\n\n$h =  new HelloWorld();\n$h-&gt;sayHelloWorld(); // Hello World\n$h-&gt;sayBaseWorld(); // Hello Base World\n</code></pre><h3 id=\"解决Trait冲突\"><a href=\"#解决Trait冲突\" class=\"headerlink\" title=\"解决Trait冲突\"></a>解决Trait冲突</h3><pre><code>&lt;?php\ntrait Game\n{\n    function play() {\n        echo &quot;Playing a game&quot;;\n    }\n}\n\ntrait Music\n{\n    function play() {\n        echo &quot;Playing music&quot;;\n    }\n}\n\nclass Player\n{\n    use Game, Music;\n}\n\n$player = new Player();\n$player-&gt;play(); // Fatal Error\n\n// resolve one\nclass Player\n{\n    use Game, Music {\n        Music::play insteadof Game;\n    }\n}\n\n$player = new Player();\n$player-&gt;play(); //Playing music\n\n// resolve two\nclass Player\n{\n    use Game, Music {\n        Game::play as gamePlay;\n        Music::play insteadof Game;\n    }\n}\n\n$player = new Player();\n$player-&gt;play(); //Playing music\n$player-&gt;gamePlay(); //Playing a game\n</code></pre><p>使用PHP Reflection类 <code>ReflectionClass::getTraits()</code> 获取类使用的traits. <code>ReflectionClass::getTraitNames()</code> 获取类中trait名称 <code>ReflectionClass::isTrait()</code> 此类是否是trait</p>\n<h3 id=\"其他特性\"><a href=\"#其他特性\" class=\"headerlink\" title=\"其他特性\"></a>其他特性</h3><p>trait中的 <code>protected, private</code> 可以随便访问  </p>\n<pre><code>&lt;?php\ntrait Message\n{\n    private $message;\n\n    function alert() {\n        $this-&gt;define();\n        echo $this-&gt;message;\n    }\n    abstract function define();\n}\n\nclass Messenger\n{\n    use Message;\n    function define() {\n        $this-&gt;message = &quot;Custom Message&quot;;\n    }\n}\n\n$messenger = new Messenger;\n$messenger-&gt;alert(); //Custom Message\n</code></pre><p><a href=\"http://www.sitepoint.com/using-traits-in-php-5-4/\" target=\"_blank\" rel=\"external\">参考Shameer C’s Blog</a></p>\n","excerpt":"","more":"<h3 id=\"Trait-是个什么鬼\"><a href=\"#Trait-是个什么鬼\" class=\"headerlink\" title=\"Trait 是个什么鬼\"></a>Trait 是个什么鬼</h3><p>PHP Trait 是一个抽象类, 不能实例化, 简单理解就是将trait的代码复制, 粘贴到你使用trait的类中. 和接口对比, 还是有区别的<br>有这么个问题.</p>\n<pre><code>&lt;?php\nclass DbReader extends Mysqli\n{\n}\n\nclass FileReader extends SplFileObject\n{\n}\n</code></pre><p>DbReader, FileReader 都需要些公共方法, 假设都设计为单列模式, 两个类都需要getInstance方法, php不支持多继承, 怎么办?  </p>\n<pre><code>&lt;?php\ninterface Singleton\n{\n    public static function getInstance();\n}\n\nclass DbReader extends Mysqli implements Singleton\n{\n    public static function getInstance(){ return &quot;instanceOfDbReader&quot;;}\n}\n\nclass FileReader extends SplFileObject implements Singleton\n{\n    public static function getInstance(){ return &quot;instanceOfFileReader&quot;;}\n}\n</code></pre><p>是你想要的吗? 显然是NO  </p>\n<p>SO PHP特性 Trait  </p>\n<pre><code>&lt;?php\ntrait Singleton\n{\n    private static $instance;\n\n    public static function getInstance() {\n        if (!(self::$instance instanceof self)) {\n            self::$instance = new self;\n        }\n        return self::$instance;\n    }\n}\n\nclass DbReader extends ArrayObject\n{\n    use Singleton;\n}\n\nclass  FileReader\n{\n    use Singleton;\n}\n$a = DbReader::getInstance();\n$b = FileReader::getInstance();\nvar_dump($a);  //object(DbReader)\nvar_dump($b);  //object(FileReader)\n</code></pre><p>是不是爽了!!!. </p>\n<h3 id=\"使用多个Trait\"><a href=\"#使用多个Trait\" class=\"headerlink\" title=\"使用多个Trait\"></a>使用多个Trait</h3><p>PHP Trait 是可以多个使用的</p>\n<pre><code>&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        echo &quot;Hello&quot;;\n    }\n}\n\ntrait World\n{\n    function sayWorld() {\n        echo &quot;World&quot;;\n    }\n}\n\nclass MyWorld\n{\n    use Hello, World;\n}\n\n$world = new MyWorld();\necho $world-&gt;sayHello() . &quot; &quot; . $world-&gt;sayWorld(); //Hello World\n</code></pre><p>是不是很方便!!!  </p>\n<h3 id=\"Trait-组装-Trait\"><a href=\"#Trait-组装-Trait\" class=\"headerlink\" title=\"Trait 组装 Trait\"></a>Trait 组装 Trait</h3><p>多个Trait可以组装成一个Trait  </p>\n<pre><code>&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        echo &quot;Hello&quot;;\n    }\n}\n\ntrait World\n{\n    function sayWorld() {\n        echo &quot;World&quot;;\n    }\n}\ntrait HelloWorld\n{\n    use Hello, World;\n}\n\nclass MyWorld\n{\n    use HelloWorld;\n}\n\n$world = new MyWorld();\necho $world-&gt;sayHello() . &quot; &quot; . $world-&gt;sayWorld(); //Hello World\n</code></pre><h3 id=\"Trait-优先级\"><a href=\"#Trait-优先级\" class=\"headerlink\" title=\"Trait 优先级\"></a>Trait 优先级</h3><pre><code>Trait中的方法重写继承父类的方法.  \n当前类中方法复写trait中的方法  \n\n&lt;?php\ntrait Hello\n{\n    function sayHello() {\n        return &quot;Hello&quot;;\n    }\n\n    function sayWorld() {\n        return &quot;Trait World&quot;;\n    }\n\n    function sayHelloWorld() {\n        echo $this-&gt;sayHello() . &quot; &quot; . $this-&gt;sayWorld();\n    }\n\n    function sayBaseWorld() {\n        echo $this-&gt;sayHello() . &quot; &quot; . parent::sayWorld();\n    }\n}\n\nclass Base\n{\n    function sayWorld(){\n        return &quot;Base World&quot;;\n    }\n}\n\nclass HelloWorld extends Base\n{\n    use Hello;\n    function sayWorld() {\n        return &quot;World&quot;;\n    }\n}\n\n$h =  new HelloWorld();\n$h-&gt;sayHelloWorld(); // Hello World\n$h-&gt;sayBaseWorld(); // Hello Base World\n</code></pre><h3 id=\"解决Trait冲突\"><a href=\"#解决Trait冲突\" class=\"headerlink\" title=\"解决Trait冲突\"></a>解决Trait冲突</h3><pre><code>&lt;?php\ntrait Game\n{\n    function play() {\n        echo &quot;Playing a game&quot;;\n    }\n}\n\ntrait Music\n{\n    function play() {\n        echo &quot;Playing music&quot;;\n    }\n}\n\nclass Player\n{\n    use Game, Music;\n}\n\n$player = new Player();\n$player-&gt;play(); // Fatal Error\n\n// resolve one\nclass Player\n{\n    use Game, Music {\n        Music::play insteadof Game;\n    }\n}\n\n$player = new Player();\n$player-&gt;play(); //Playing music\n\n// resolve two\nclass Player\n{\n    use Game, Music {\n        Game::play as gamePlay;\n        Music::play insteadof Game;\n    }\n}\n\n$player = new Player();\n$player-&gt;play(); //Playing music\n$player-&gt;gamePlay(); //Playing a game\n</code></pre><p>使用PHP Reflection类 <code>ReflectionClass::getTraits()</code> 获取类使用的traits. <code>ReflectionClass::getTraitNames()</code> 获取类中trait名称 <code>ReflectionClass::isTrait()</code> 此类是否是trait</p>\n<h3 id=\"其他特性\"><a href=\"#其他特性\" class=\"headerlink\" title=\"其他特性\"></a>其他特性</h3><p>trait中的 <code>protected, private</code> 可以随便访问  </p>\n<pre><code>&lt;?php\ntrait Message\n{\n    private $message;\n\n    function alert() {\n        $this-&gt;define();\n        echo $this-&gt;message;\n    }\n    abstract function define();\n}\n\nclass Messenger\n{\n    use Message;\n    function define() {\n        $this-&gt;message = &quot;Custom Message&quot;;\n    }\n}\n\n$messenger = new Messenger;\n$messenger-&gt;alert(); //Custom Message\n</code></pre><p><a href=\"http://www.sitepoint.com/using-traits-in-php-5-4/\">参考Shameer C’s Blog</a></p>\n"},{"title":"PHP分页算法","date":"2015-08-27T14:32:00.000Z","_content":"\n### PHP分页算法 ###\n```php\n<html>\n    <head>\n        <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css\">\n        <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\">\n        <script src=\"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js\"></script>\n        <script src=\"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\n    </head>\n<body>\n    <div class=\"container\">\n<?php\n$page = isset($_GET['page']) ? $_GET['page'] : 1;\necho getPaginationString($page, $total = 80, $limit = 5, $adjacents = 1, $targetpage = '/php/demo.php', $pagestring = '?page=');\n\n//$page = isset($_GET['page']) ? $_GET['page'] : 1;\n//echo getPaginationString2($page, $total = 80, $limit = 5, $showPageCount = 5, $targetpage = '/php/demo.php', $pagestring = '?page=');\n?>\n</div>\n</body>\n</html>\n<?php\n//function to return the pagination string\nfunction getPaginationString($page = 1, $totalitems, $limit = 15, $adjacents = 3, $targetpage = \"/\", $pagestring = \"?page=\")\n{\n    //defaults\n    if(!$adjacents) $adjacents = 1;\n    if(!$limit) $limit = 15;\n    if(!$page) $page = 1;\n    if(!$targetpage) $targetpage = \"/\";\n\n    //other vars\n    $prev = $page - 1;                                    //previous page is page - 1\n    $next = $page + 1;                                    //next page is page + 1\n    $lastpage = ceil($totalitems / $limit);                //lastpage is = total items / items per page, rounded up.\n    $lpm1 = $lastpage - 1;                                //last page minus 1\n\n    /*\n        Now we apply our rules and draw the pagination object.\n        We're actually saving the code to a variable in case we want to draw it more than once.\n    */\n    $pagination = \"\";\n    if($lastpage > 1)\n    {\n        $pagination .= \"\n\n\";\n\n        //previous button\n        if ($page > 1)\n            $pagination .= \"*   [« prev](\\)\n\";\n        else\n            $pagination .= \"*   <span class=\\\"disabled\\\">« prev</span>\n\";\n\n        //pages\n        if ($lastpage < 7 + ($adjacents * 2))    //not enough pages to bother breaking it up\n        {\n            for ($counter = 1; $counter <= $lastpage; $counter++)\n            {\n                if ($counter == $page)\n                    $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                else\n                    $pagination .= \"*   [$counter](\\)\n\";\n            }\n        }\n        elseif($lastpage >= 7 + ($adjacents * 2))    //enough pages to hide some\n        {\n            //close to beginning; only hide later pages\n            if($page < 1 + ($adjacents * 3))\n            {\n                for ($counter = 1; $counter < 4 + ($adjacents * 2); $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                $pagination .= \"*   [$lpm1](\\)\n\";\n                $pagination .= \"*   [$lastpage](\\)\n\";\n            }\n            //in middle; hide some front and some back\n            elseif($lastpage - ($adjacents * 2) > $page && $page > ($adjacents * 2))\n            {\n                $pagination .= \"*   [1](\\)\n\";\n                $pagination .= \"*   [2](\\)\n\";\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                for ($counter = $page - $adjacents; $counter <= $page + $adjacents; $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n                $pagination .= \"*   [...](javascript:;)\n\";\n                $pagination .= \"*   [$lpm1](\\)\n\";\n                $pagination .= \"*   [$lastpage](\\)\n\";\n            }\n            //close to end; only hide early pages\n            else\n            {\n                $pagination .= \"*   [1](\\)\n\";\n                $pagination .= \"*   [2](\\)\n\";\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                for ($counter = $lastpage - (1 + ($adjacents * 3)); $counter <= $lastpage; $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n            }\n        }\n\n        //next button\n        if ($page < $counter - 1)\n            $pagination .= \"*   [next »](\\)\n\";\n        else\n            $pagination .= \"*   <span class=\\\"disabled\\\">next &raquo;</span>\\n\";\n    }\n\n    return $pagination;\n\n}\n\n/**\nfunction getPaginationString2($page = null, $totalItems = null, $limit = 5, $showPageCount = 4, $target = '/', $pageString = '?page=')\n{\n    $totalPage = ceil($totalItems / $limit); // compute total page\n\n    if(($offset = ($page + floor($showPageCount / 2))) > $totalPage)\n        $offset = $totalPage;\n\n    if($page + floor($showPageCount / 2) > $totalPage)\n        $counter = $totalPage - floor($showPageCount / 2);\n    else\n        $counter = ($computerPage = $page - floor($showPageCount / 2)) > 0 ? $computerPage : 1;\n\n    $pagination = '\n\n';\n    for($counter; $counter < $offset; $counter++)\n    {\n        $pagination .= '*   ['.$counter . ']()';\n\n    return $pagination;\n}\n */\n```\n![](http://images0.cnblogs.com/blog2015/451327/201508/272231215945352.png)","source":"_posts/PHP分页算法.md","raw":"---\ntitle: PHP分页算法\ntags: []\ndate: 2015-08-27 22:32:00\n---\n\n### PHP分页算法 ###\n```php\n<html>\n    <head>\n        <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css\">\n        <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\">\n        <script src=\"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js\"></script>\n        <script src=\"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\n    </head>\n<body>\n    <div class=\"container\">\n<?php\n$page = isset($_GET['page']) ? $_GET['page'] : 1;\necho getPaginationString($page, $total = 80, $limit = 5, $adjacents = 1, $targetpage = '/php/demo.php', $pagestring = '?page=');\n\n//$page = isset($_GET['page']) ? $_GET['page'] : 1;\n//echo getPaginationString2($page, $total = 80, $limit = 5, $showPageCount = 5, $targetpage = '/php/demo.php', $pagestring = '?page=');\n?>\n</div>\n</body>\n</html>\n<?php\n//function to return the pagination string\nfunction getPaginationString($page = 1, $totalitems, $limit = 15, $adjacents = 3, $targetpage = \"/\", $pagestring = \"?page=\")\n{\n    //defaults\n    if(!$adjacents) $adjacents = 1;\n    if(!$limit) $limit = 15;\n    if(!$page) $page = 1;\n    if(!$targetpage) $targetpage = \"/\";\n\n    //other vars\n    $prev = $page - 1;                                    //previous page is page - 1\n    $next = $page + 1;                                    //next page is page + 1\n    $lastpage = ceil($totalitems / $limit);                //lastpage is = total items / items per page, rounded up.\n    $lpm1 = $lastpage - 1;                                //last page minus 1\n\n    /*\n        Now we apply our rules and draw the pagination object.\n        We're actually saving the code to a variable in case we want to draw it more than once.\n    */\n    $pagination = \"\";\n    if($lastpage > 1)\n    {\n        $pagination .= \"\n\n\";\n\n        //previous button\n        if ($page > 1)\n            $pagination .= \"*   [« prev](\\)\n\";\n        else\n            $pagination .= \"*   <span class=\\\"disabled\\\">« prev</span>\n\";\n\n        //pages\n        if ($lastpage < 7 + ($adjacents * 2))    //not enough pages to bother breaking it up\n        {\n            for ($counter = 1; $counter <= $lastpage; $counter++)\n            {\n                if ($counter == $page)\n                    $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                else\n                    $pagination .= \"*   [$counter](\\)\n\";\n            }\n        }\n        elseif($lastpage >= 7 + ($adjacents * 2))    //enough pages to hide some\n        {\n            //close to beginning; only hide later pages\n            if($page < 1 + ($adjacents * 3))\n            {\n                for ($counter = 1; $counter < 4 + ($adjacents * 2); $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                $pagination .= \"*   [$lpm1](\\)\n\";\n                $pagination .= \"*   [$lastpage](\\)\n\";\n            }\n            //in middle; hide some front and some back\n            elseif($lastpage - ($adjacents * 2) > $page && $page > ($adjacents * 2))\n            {\n                $pagination .= \"*   [1](\\)\n\";\n                $pagination .= \"*   [2](\\)\n\";\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                for ($counter = $page - $adjacents; $counter <= $page + $adjacents; $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n                $pagination .= \"*   [...](javascript:;)\n\";\n                $pagination .= \"*   [$lpm1](\\)\n\";\n                $pagination .= \"*   [$lastpage](\\)\n\";\n            }\n            //close to end; only hide early pages\n            else\n            {\n                $pagination .= \"*   [1](\\)\n\";\n                $pagination .= \"*   [2](\\)\n\";\n                $pagination .= \"*   <span class=\\\"elipses\\\">...</span>\n\";\n                for ($counter = $lastpage - (1 + ($adjacents * 3)); $counter <= $lastpage; $counter++)\n                {\n                    if ($counter == $page)\n                        $pagination .= \"*   <span class=\\\"current\\\">$counter</span>\n\";\n                    else\n                        $pagination .= \"*   [$counter](\\)\n\";\n                }\n            }\n        }\n\n        //next button\n        if ($page < $counter - 1)\n            $pagination .= \"*   [next »](\\)\n\";\n        else\n            $pagination .= \"*   <span class=\\\"disabled\\\">next &raquo;</span>\\n\";\n    }\n\n    return $pagination;\n\n}\n\n/**\nfunction getPaginationString2($page = null, $totalItems = null, $limit = 5, $showPageCount = 4, $target = '/', $pageString = '?page=')\n{\n    $totalPage = ceil($totalItems / $limit); // compute total page\n\n    if(($offset = ($page + floor($showPageCount / 2))) > $totalPage)\n        $offset = $totalPage;\n\n    if($page + floor($showPageCount / 2) > $totalPage)\n        $counter = $totalPage - floor($showPageCount / 2);\n    else\n        $counter = ($computerPage = $page - floor($showPageCount / 2)) > 0 ? $computerPage : 1;\n\n    $pagination = '\n\n';\n    for($counter; $counter < $offset; $counter++)\n    {\n        $pagination .= '*   ['.$counter . ']()';\n\n    return $pagination;\n}\n */\n```\n![](http://images0.cnblogs.com/blog2015/451327/201508/272231215945352.png)","slug":"PHP分页算法","published":1,"updated":"2016-09-15T07:13:28.139Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxtb00097sqvbbpx8eh4","content":"<h3 id=\"PHP分页算法\"><a href=\"#PHP分页算法\" class=\"headerlink\" title=\"PHP分页算法\"></a>PHP分页算法</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css\"&gt;</span><br><span class=\"line\">        &lt;link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\"&gt;</span><br><span class=\"line\">        &lt;script src=\"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">        &lt;script src=\"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div class=\"container\"&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">$page = isset($_GET['page']) ? $_GET['page'] : 1;</span><br><span class=\"line\">echo getPaginationString($page, $total = 80, $limit = 5, $adjacents = 1, $targetpage = '/php/demo.php', $pagestring = '?page=');</span><br><span class=\"line\"></span><br><span class=\"line\">//$page = isset($_GET['page']) ? $_GET['page'] : 1;</span><br><span class=\"line\">//echo getPaginationString2($page, $total = 80, $limit = 5, $showPageCount = 5, $targetpage = '/php/demo.php', $pagestring = '?page=');</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">//function to return the pagination string</span><br><span class=\"line\">function getPaginationString($page = 1, $totalitems, $limit = 15, $adjacents = 3, $targetpage = \"/\", $pagestring = \"?page=\")</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    //defaults</span><br><span class=\"line\">    if(!$adjacents) $adjacents = 1;</span><br><span class=\"line\">    if(!$limit) $limit = 15;</span><br><span class=\"line\">    if(!$page) $page = 1;</span><br><span class=\"line\">    if(!$targetpage) $targetpage = \"/\";</span><br><span class=\"line\"></span><br><span class=\"line\">    //other vars</span><br><span class=\"line\">    $prev = $page - 1;                                    //previous page is page - 1</span><br><span class=\"line\">    $next = $page + 1;                                    //next page is page + 1</span><br><span class=\"line\">    $lastpage = ceil($totalitems / $limit);                //lastpage is = total items / items per page, rounded up.</span><br><span class=\"line\">    $lpm1 = $lastpage - 1;                                //last page minus 1</span><br><span class=\"line\"></span><br><span class=\"line\">    /*</span><br><span class=\"line\">        Now we apply our rules and draw the pagination object.</span><br><span class=\"line\">        We're actually saving the code to a variable in case we want to draw it more than once.</span><br><span class=\"line\">    */</span><br><span class=\"line\">    $pagination = \"\";</span><br><span class=\"line\">    if($lastpage &gt; 1)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $pagination .= \"</span><br><span class=\"line\"></span><br><span class=\"line\">\";</span><br><span class=\"line\"></span><br><span class=\"line\">        //previous button</span><br><span class=\"line\">        if ($page &gt; 1)</span><br><span class=\"line\">            $pagination .= \"*   [« prev](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">        else</span><br><span class=\"line\">            $pagination .= \"*   &lt;span class=\\\"disabled\\\"&gt;« prev&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\"></span><br><span class=\"line\">        //pages</span><br><span class=\"line\">        if ($lastpage &lt; 7 + ($adjacents * 2))    //not enough pages to bother breaking it up</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            for ($counter = 1; $counter &lt;= $lastpage; $counter++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                if ($counter == $page)</span><br><span class=\"line\">                    $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                else</span><br><span class=\"line\">                    $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        elseif($lastpage &gt;= 7 + ($adjacents * 2))    //enough pages to hide some</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            //close to beginning; only hide later pages</span><br><span class=\"line\">            if($page &lt; 1 + ($adjacents * 3))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                for ($counter = 1; $counter &lt; 4 + ($adjacents * 2); $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lpm1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lastpage](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //in middle; hide some front and some back</span><br><span class=\"line\">            elseif($lastpage - ($adjacents * 2) &gt; $page &amp;&amp; $page &gt; ($adjacents * 2))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                $pagination .= \"*   [1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [2](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                for ($counter = $page - $adjacents; $counter &lt;= $page + $adjacents; $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $pagination .= \"*   [...](javascript:;)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lpm1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lastpage](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //close to end; only hide early pages</span><br><span class=\"line\">            else</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                $pagination .= \"*   [1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [2](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                for ($counter = $lastpage - (1 + ($adjacents * 3)); $counter &lt;= $lastpage; $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        //next button</span><br><span class=\"line\">        if ($page &lt; $counter - 1)</span><br><span class=\"line\">            $pagination .= \"*   [next »](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">        else</span><br><span class=\"line\">            $pagination .= \"*   &lt;span class=\\\"disabled\\\"&gt;next &amp;raquo;&lt;/span&gt;\\n\";</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $pagination;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\">function getPaginationString2($page = null, $totalItems = null, $limit = 5, $showPageCount = 4, $target = '/', $pageString = '?page=')</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $totalPage = ceil($totalItems / $limit); // compute total page</span><br><span class=\"line\"></span><br><span class=\"line\">    if(($offset = ($page + floor($showPageCount / 2))) &gt; $totalPage)</span><br><span class=\"line\">        $offset = $totalPage;</span><br><span class=\"line\"></span><br><span class=\"line\">    if($page + floor($showPageCount / 2) &gt; $totalPage)</span><br><span class=\"line\">        $counter = $totalPage - floor($showPageCount / 2);</span><br><span class=\"line\">    else</span><br><span class=\"line\">        $counter = ($computerPage = $page - floor($showPageCount / 2)) &gt; 0 ? $computerPage : 1;</span><br><span class=\"line\"></span><br><span class=\"line\">    $pagination = '</span><br><span class=\"line\"></span><br><span class=\"line\">';</span><br><span class=\"line\">    for($counter; $counter &lt; $offset; $counter++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $pagination .= '*   ['.$counter . ']()';</span><br><span class=\"line\"></span><br><span class=\"line\">    return $pagination;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> */</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://images0.cnblogs.com/blog2015/451327/201508/272231215945352.png\" alt=\"\"></p>\n","excerpt":"","more":"<h3 id=\"PHP分页算法\"><a href=\"#PHP分页算法\" class=\"headerlink\" title=\"PHP分页算法\"></a>PHP分页算法</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css\"&gt;</span><br><span class=\"line\">        &lt;link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\"&gt;</span><br><span class=\"line\">        &lt;script src=\"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">        &lt;script src=\"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div class=\"container\"&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">$page = isset($_GET['page']) ? $_GET['page'] : 1;</span><br><span class=\"line\">echo getPaginationString($page, $total = 80, $limit = 5, $adjacents = 1, $targetpage = '/php/demo.php', $pagestring = '?page=');</span><br><span class=\"line\"></span><br><span class=\"line\">//$page = isset($_GET['page']) ? $_GET['page'] : 1;</span><br><span class=\"line\">//echo getPaginationString2($page, $total = 80, $limit = 5, $showPageCount = 5, $targetpage = '/php/demo.php', $pagestring = '?page=');</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">//function to return the pagination string</span><br><span class=\"line\">function getPaginationString($page = 1, $totalitems, $limit = 15, $adjacents = 3, $targetpage = \"/\", $pagestring = \"?page=\")</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    //defaults</span><br><span class=\"line\">    if(!$adjacents) $adjacents = 1;</span><br><span class=\"line\">    if(!$limit) $limit = 15;</span><br><span class=\"line\">    if(!$page) $page = 1;</span><br><span class=\"line\">    if(!$targetpage) $targetpage = \"/\";</span><br><span class=\"line\"></span><br><span class=\"line\">    //other vars</span><br><span class=\"line\">    $prev = $page - 1;                                    //previous page is page - 1</span><br><span class=\"line\">    $next = $page + 1;                                    //next page is page + 1</span><br><span class=\"line\">    $lastpage = ceil($totalitems / $limit);                //lastpage is = total items / items per page, rounded up.</span><br><span class=\"line\">    $lpm1 = $lastpage - 1;                                //last page minus 1</span><br><span class=\"line\"></span><br><span class=\"line\">    /*</span><br><span class=\"line\">        Now we apply our rules and draw the pagination object.</span><br><span class=\"line\">        We're actually saving the code to a variable in case we want to draw it more than once.</span><br><span class=\"line\">    */</span><br><span class=\"line\">    $pagination = \"\";</span><br><span class=\"line\">    if($lastpage &gt; 1)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $pagination .= \"</span><br><span class=\"line\"></span><br><span class=\"line\">\";</span><br><span class=\"line\"></span><br><span class=\"line\">        //previous button</span><br><span class=\"line\">        if ($page &gt; 1)</span><br><span class=\"line\">            $pagination .= \"*   [« prev](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">        else</span><br><span class=\"line\">            $pagination .= \"*   &lt;span class=\\\"disabled\\\"&gt;« prev&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\"></span><br><span class=\"line\">        //pages</span><br><span class=\"line\">        if ($lastpage &lt; 7 + ($adjacents * 2))    //not enough pages to bother breaking it up</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            for ($counter = 1; $counter &lt;= $lastpage; $counter++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                if ($counter == $page)</span><br><span class=\"line\">                    $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                else</span><br><span class=\"line\">                    $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        elseif($lastpage &gt;= 7 + ($adjacents * 2))    //enough pages to hide some</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            //close to beginning; only hide later pages</span><br><span class=\"line\">            if($page &lt; 1 + ($adjacents * 3))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                for ($counter = 1; $counter &lt; 4 + ($adjacents * 2); $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lpm1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lastpage](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //in middle; hide some front and some back</span><br><span class=\"line\">            elseif($lastpage - ($adjacents * 2) &gt; $page &amp;&amp; $page &gt; ($adjacents * 2))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                $pagination .= \"*   [1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [2](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                for ($counter = $page - $adjacents; $counter &lt;= $page + $adjacents; $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $pagination .= \"*   [...](javascript:;)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lpm1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [$lastpage](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //close to end; only hide early pages</span><br><span class=\"line\">            else</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                $pagination .= \"*   [1](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   [2](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                $pagination .= \"*   &lt;span class=\\\"elipses\\\"&gt;...&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                for ($counter = $lastpage - (1 + ($adjacents * 3)); $counter &lt;= $lastpage; $counter++)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if ($counter == $page)</span><br><span class=\"line\">                        $pagination .= \"*   &lt;span class=\\\"current\\\"&gt;$counter&lt;/span&gt;</span><br><span class=\"line\">\";</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                        $pagination .= \"*   [$counter](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        //next button</span><br><span class=\"line\">        if ($page &lt; $counter - 1)</span><br><span class=\"line\">            $pagination .= \"*   [next »](\\)</span><br><span class=\"line\">\";</span><br><span class=\"line\">        else</span><br><span class=\"line\">            $pagination .= \"*   &lt;span class=\\\"disabled\\\"&gt;next &amp;raquo;&lt;/span&gt;\\n\";</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $pagination;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\">function getPaginationString2($page = null, $totalItems = null, $limit = 5, $showPageCount = 4, $target = '/', $pageString = '?page=')</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $totalPage = ceil($totalItems / $limit); // compute total page</span><br><span class=\"line\"></span><br><span class=\"line\">    if(($offset = ($page + floor($showPageCount / 2))) &gt; $totalPage)</span><br><span class=\"line\">        $offset = $totalPage;</span><br><span class=\"line\"></span><br><span class=\"line\">    if($page + floor($showPageCount / 2) &gt; $totalPage)</span><br><span class=\"line\">        $counter = $totalPage - floor($showPageCount / 2);</span><br><span class=\"line\">    else</span><br><span class=\"line\">        $counter = ($computerPage = $page - floor($showPageCount / 2)) &gt; 0 ? $computerPage : 1;</span><br><span class=\"line\"></span><br><span class=\"line\">    $pagination = '</span><br><span class=\"line\"></span><br><span class=\"line\">';</span><br><span class=\"line\">    for($counter; $counter &lt; $offset; $counter++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $pagination .= '*   ['.$counter . ']()';</span><br><span class=\"line\"></span><br><span class=\"line\">    return $pagination;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> */</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://images0.cnblogs.com/blog2015/451327/201508/272231215945352.png\" alt=\"\"></p>\n"},{"title":"RazorSQL 注册码","date":"2015-09-29T15:25:00.000Z","_content":"\nRazorSQL 是一个非开源的功能非常强大数据库查询工具、SQL的编辑、数据库管理工具。支持通过 JDBC 和 ODBC 连接超过 29 种的数据库。\n\nRazorSQL是一个SQL查询工具，数据库浏览器，SQL编辑器和数据库管理工具，在Windows，Mac OS X，Linux上，和Solaris。\n\nRazorSQL is an SQL query tool, database browser, SQL editor, and database administration tool for Windows, Mac OS X, Linux, and Solaris.\n\nRYVBTQFCNUEHE7XARCD78VR\n\nFF6J4RYVNXJXSUYSZJV49BZ\n\nFUQSCFTPF4Z4XZMYZJV49BR\n\nFGBMVYETCKBHHTNGBHD43KB\n\nFUBKZXPQ4STUL24GVMJ43KV\n\nF6ZEYD8WAJSZGERCRKJ67BR","source":"_posts/RazorSQL-注册码.md","raw":"---\ntitle: RazorSQL 注册码\ntags: []\ndate: 2015-09-29 23:25:00\n---\n\nRazorSQL 是一个非开源的功能非常强大数据库查询工具、SQL的编辑、数据库管理工具。支持通过 JDBC 和 ODBC 连接超过 29 种的数据库。\n\nRazorSQL是一个SQL查询工具，数据库浏览器，SQL编辑器和数据库管理工具，在Windows，Mac OS X，Linux上，和Solaris。\n\nRazorSQL is an SQL query tool, database browser, SQL editor, and database administration tool for Windows, Mac OS X, Linux, and Solaris.\n\nRYVBTQFCNUEHE7XARCD78VR\n\nFF6J4RYVNXJXSUYSZJV49BZ\n\nFUQSCFTPF4Z4XZMYZJV49BR\n\nFGBMVYETCKBHHTNGBHD43KB\n\nFUBKZXPQ4STUL24GVMJ43KV\n\nF6ZEYD8WAJSZGERCRKJ67BR","slug":"RazorSQL-注册码","published":1,"updated":"2016-09-15T07:13:28.140Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxtb000a7sqvzgwravmp","content":"<p>RazorSQL 是一个非开源的功能非常强大数据库查询工具、SQL的编辑、数据库管理工具。支持通过 JDBC 和 ODBC 连接超过 29 种的数据库。</p>\n<p>RazorSQL是一个SQL查询工具，数据库浏览器，SQL编辑器和数据库管理工具，在Windows，Mac OS X，Linux上，和Solaris。</p>\n<p>RazorSQL is an SQL query tool, database browser, SQL editor, and database administration tool for Windows, Mac OS X, Linux, and Solaris.</p>\n<p>RYVBTQFCNUEHE7XARCD78VR</p>\n<p>FF6J4RYVNXJXSUYSZJV49BZ</p>\n<p>FUQSCFTPF4Z4XZMYZJV49BR</p>\n<p>FGBMVYETCKBHHTNGBHD43KB</p>\n<p>FUBKZXPQ4STUL24GVMJ43KV</p>\n<p>F6ZEYD8WAJSZGERCRKJ67BR</p>\n","excerpt":"","more":"<p>RazorSQL 是一个非开源的功能非常强大数据库查询工具、SQL的编辑、数据库管理工具。支持通过 JDBC 和 ODBC 连接超过 29 种的数据库。</p>\n<p>RazorSQL是一个SQL查询工具，数据库浏览器，SQL编辑器和数据库管理工具，在Windows，Mac OS X，Linux上，和Solaris。</p>\n<p>RazorSQL is an SQL query tool, database browser, SQL editor, and database administration tool for Windows, Mac OS X, Linux, and Solaris.</p>\n<p>RYVBTQFCNUEHE7XARCD78VR</p>\n<p>FF6J4RYVNXJXSUYSZJV49BZ</p>\n<p>FUQSCFTPF4Z4XZMYZJV49BR</p>\n<p>FGBMVYETCKBHHTNGBHD43KB</p>\n<p>FUBKZXPQ4STUL24GVMJ43KV</p>\n<p>F6ZEYD8WAJSZGERCRKJ67BR</p>\n"},{"title":"bash shell 获取命令行参数","date":"2016-07-12T02:42:00.000Z","_content":"\n场景: 写bash脚本经长要获取命令行参数, so...\n\n<!-- more -->\n\n#### bash 自动获取 本文参考[stackoverflow](http://stackoverflow.com/questions/192249/how-do-i-parse-command-line-arguments-in-bash)\n\n```bash\n#!/bin/bash\nwhile [[ $# -gt 0 ]] # 判断有参数, 就获取\ndo\n  key=$1\n  case $1 in\n    -u|--user)\n      echo $2 # get -u | --user value\n      shift\n      ;;\n    -p|--password)\n      echo $2 # get -p | --password value\n      shift\n      ;;\n    -h|--help)\n      echo \"Use: (-u | --user set username) : (-p | --password set passwod)\"  # get --help\n      shift\n      ;;\n  esac\n  shift\ndone\n```\n\nps: `$#` 获取参数个数. `$@` 获取所有参数. `$1`获取第1个参数. 脚本[shift](http://unix.stackexchange.com/questions/174566/what-is-the-purpose-of-using-shift-in-shell-scripts)关键字的作用就很好理解咯\n\n\n","source":"_posts/bashshell-case-syntax.md","raw":"---\ntitle: bash shell 获取命令行参数\ntags: [\"bash\", \"case\", \"command\"]\n\ndate: 2016-07-12 10:42:00\n---\n\n场景: 写bash脚本经长要获取命令行参数, so...\n\n<!-- more -->\n\n#### bash 自动获取 本文参考[stackoverflow](http://stackoverflow.com/questions/192249/how-do-i-parse-command-line-arguments-in-bash)\n\n```bash\n#!/bin/bash\nwhile [[ $# -gt 0 ]] # 判断有参数, 就获取\ndo\n  key=$1\n  case $1 in\n    -u|--user)\n      echo $2 # get -u | --user value\n      shift\n      ;;\n    -p|--password)\n      echo $2 # get -p | --password value\n      shift\n      ;;\n    -h|--help)\n      echo \"Use: (-u | --user set username) : (-p | --password set passwod)\"  # get --help\n      shift\n      ;;\n  esac\n  shift\ndone\n```\n\nps: `$#` 获取参数个数. `$@` 获取所有参数. `$1`获取第1个参数. 脚本[shift](http://unix.stackexchange.com/questions/174566/what-is-the-purpose-of-using-shift-in-shell-scripts)关键字的作用就很好理解咯\n\n\n","slug":"bashshell-case-syntax","published":1,"updated":"2016-09-15T07:13:28.140Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxtb000b7sqve4r0psla","content":"<p>场景: 写bash脚本经长要获取命令行参数, so…</p>\n<a id=\"more\"></a>\n<h4 id=\"bash-自动获取-本文参考stackoverflow\"><a href=\"#bash-自动获取-本文参考stackoverflow\" class=\"headerlink\" title=\"bash 自动获取 本文参考stackoverflow\"></a>bash 自动获取 本文参考<a href=\"http://stackoverflow.com/questions/192249/how-do-i-parse-command-line-arguments-in-bash\" target=\"_blank\" rel=\"external\">stackoverflow</a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"variable\">$#</span> <span class=\"_\">-gt</span> 0 ]] <span class=\"comment\"># 判断有参数, 就获取</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  key=<span class=\"variable\">$1</span></span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"variable\">$1</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    -u|--user)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$2</span> <span class=\"comment\"># get -u | --user value</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    -p|--password)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$2</span> <span class=\"comment\"># get -p | --password value</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    -h|--help)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">\"Use: (-u | --user set username) : (-p | --password set passwod)\"</span>  <span class=\"comment\"># get --help</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">  <span class=\"keyword\">esac</span></span><br><span class=\"line\">  <span class=\"built_in\">shift</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>ps: <code>$#</code> 获取参数个数. <code>$@</code> 获取所有参数. <code>$1</code>获取第1个参数. 脚本<a href=\"http://unix.stackexchange.com/questions/174566/what-is-the-purpose-of-using-shift-in-shell-scripts\" target=\"_blank\" rel=\"external\">shift</a>关键字的作用就很好理解咯</p>\n","excerpt":"<p>场景: 写bash脚本经长要获取命令行参数, so…</p>","more":"<h4 id=\"bash-自动获取-本文参考stackoverflow\"><a href=\"#bash-自动获取-本文参考stackoverflow\" class=\"headerlink\" title=\"bash 自动获取 本文参考stackoverflow\"></a>bash 自动获取 本文参考<a href=\"http://stackoverflow.com/questions/192249/how-do-i-parse-command-line-arguments-in-bash\">stackoverflow</a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"variable\">$#</span> <span class=\"_\">-gt</span> 0 ]] <span class=\"comment\"># 判断有参数, 就获取</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  key=<span class=\"variable\">$1</span></span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"variable\">$1</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    -u|--user)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$2</span> <span class=\"comment\"># get -u | --user value</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    -p|--password)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$2</span> <span class=\"comment\"># get -p | --password value</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    -h|--help)</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">\"Use: (-u | --user set username) : (-p | --password set passwod)\"</span>  <span class=\"comment\"># get --help</span></span><br><span class=\"line\">      <span class=\"built_in\">shift</span></span><br><span class=\"line\">      ;;</span><br><span class=\"line\">  <span class=\"keyword\">esac</span></span><br><span class=\"line\">  <span class=\"built_in\">shift</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>ps: <code>$#</code> 获取参数个数. <code>$@</code> 获取所有参数. <code>$1</code>获取第1个参数. 脚本<a href=\"http://unix.stackexchange.com/questions/174566/what-is-the-purpose-of-using-shift-in-shell-scripts\">shift</a>关键字的作用就很好理解咯</p>"},{"title":"js多对象数组唯一方法","date":"2016-09-13T09:33:58.000Z","desc":null,"_content":"\n前些天做项目, 小伙伴遇到一个js多对象数组, 求唯一问题, 思考了很久, 没有找到好的方案. 小伙伴使用了递归, 个人感觉不是最好的方案.\n今天有空重写了一个.\n\n<!--more-->\n\n## 原理分析\n\n* 遍历数组中的对象, 第一个对象和接下来所有的对象进行对比, 如果碰到一致的, 将其删除. 自身对象进行处理.\n\n* 问题主要处在删除后, 数组的索引发生变更, 之前没有考虑到. 一直不正确. 今天把代码贴出. 欢迎拍砖.! :)\n\n* es6 code 需要babeljs转换下\n\n        // es6 code\n        const uniq = (source = [], fields = [], callback = ()=>{}) => {\n          for(let i = 0; i < source.length; i++){\n            for(let j = i+1; j < source.length; j++){\n                /*\n                 * 对比对象中的字段(传入的参数)是否相等 返回一个和fileds数组相同数量的true, false数组,\n                 * 本列子返回[false, true], 对返回的true, false数组reduce计算, 看看对象是否相等, 如果相等\n                 * 调用callback, 删除原数组中相同的对象, 原数组相同的对象删除后, for循环需要回退.\n                 */\n              if(fields.map((field) => {\n                return source[i][field] == source[j][field];\n              }).reduce((prev, next) => prev&&next)){\n                source[i] = callback(source[i]);\n                source.splice(j, 1);\n                j--; // 回退for\n              }\n            }\n          }\n          return source;\n        };\n\n        let source = [\n          {name: 'luo', age: 3, count:1}, \n          {name: 'v', age: 2, count:1}, \n          {name: 'luo', age: 3, count:1},\n          {name: 'luo', age: 3, count:1},\n          {name: 'luo', age: 3, count:1},\n          {name: 'v', age: 2, count:1}, \n          {name: 'luo', age: 3, count:1}, \n          {name: 'v', age: 3, count:1}, \n          {name: 'v', age: 2, count:1}, \n          {name: 'v', age: 42, count:1}, \n        ];\n\n        let ret = uniq(source, ['name', 'age'], (item) => {\n          item.count += 1;\n          return item;\n        });\n\n* es5 转换好的code\n\n        // es5 code\n        'use strict';\n\n        var uniq = function uniq() {\n          var source = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n          var fields = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n          var callback = arguments.length <= 2 || arguments[2] === undefined ? function () {} : arguments[2];\n\n          var _loop = function _loop(i) {\n            var _loop2 = function _loop2(_j) {\n              if (fields.map(function (field) {\n                return source[i][field] == source[_j][field];\n              }).reduce(function (prev, next) {\n                return prev && next;\n              })) {\n                source[i] = callback(source[i]);\n                source.splice(_j, 1);\n                _j--;\n              }\n              j = _j;\n            };\n\n            for (var j = i + 1; j < source.length; j++) {\n              _loop2(j);\n            }\n          };\n\n          for (var i = 0; i < source.length; i++) {\n            _loop(i);\n          }\n          return source;\n        };\n\n        var source = [{ name: 'luo', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'v', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'v', age: 42, count: 1 }];\n\n        var ret = uniq(source, ['name', 'age'], function (item) {\n          item.count += 1;\n          return item;\n        });\n        //console.log(ret)\n","source":"_posts/js多对象数组唯一方法.md","raw":"---\ntitle: js多对象数组唯一方法\ndate: 2016-09-13 17:33:58\ndesc:\ntags:\n---\n\n前些天做项目, 小伙伴遇到一个js多对象数组, 求唯一问题, 思考了很久, 没有找到好的方案. 小伙伴使用了递归, 个人感觉不是最好的方案.\n今天有空重写了一个.\n\n<!--more-->\n\n## 原理分析\n\n* 遍历数组中的对象, 第一个对象和接下来所有的对象进行对比, 如果碰到一致的, 将其删除. 自身对象进行处理.\n\n* 问题主要处在删除后, 数组的索引发生变更, 之前没有考虑到. 一直不正确. 今天把代码贴出. 欢迎拍砖.! :)\n\n* es6 code 需要babeljs转换下\n\n        // es6 code\n        const uniq = (source = [], fields = [], callback = ()=>{}) => {\n          for(let i = 0; i < source.length; i++){\n            for(let j = i+1; j < source.length; j++){\n                /*\n                 * 对比对象中的字段(传入的参数)是否相等 返回一个和fileds数组相同数量的true, false数组,\n                 * 本列子返回[false, true], 对返回的true, false数组reduce计算, 看看对象是否相等, 如果相等\n                 * 调用callback, 删除原数组中相同的对象, 原数组相同的对象删除后, for循环需要回退.\n                 */\n              if(fields.map((field) => {\n                return source[i][field] == source[j][field];\n              }).reduce((prev, next) => prev&&next)){\n                source[i] = callback(source[i]);\n                source.splice(j, 1);\n                j--; // 回退for\n              }\n            }\n          }\n          return source;\n        };\n\n        let source = [\n          {name: 'luo', age: 3, count:1}, \n          {name: 'v', age: 2, count:1}, \n          {name: 'luo', age: 3, count:1},\n          {name: 'luo', age: 3, count:1},\n          {name: 'luo', age: 3, count:1},\n          {name: 'v', age: 2, count:1}, \n          {name: 'luo', age: 3, count:1}, \n          {name: 'v', age: 3, count:1}, \n          {name: 'v', age: 2, count:1}, \n          {name: 'v', age: 42, count:1}, \n        ];\n\n        let ret = uniq(source, ['name', 'age'], (item) => {\n          item.count += 1;\n          return item;\n        });\n\n* es5 转换好的code\n\n        // es5 code\n        'use strict';\n\n        var uniq = function uniq() {\n          var source = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n          var fields = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n          var callback = arguments.length <= 2 || arguments[2] === undefined ? function () {} : arguments[2];\n\n          var _loop = function _loop(i) {\n            var _loop2 = function _loop2(_j) {\n              if (fields.map(function (field) {\n                return source[i][field] == source[_j][field];\n              }).reduce(function (prev, next) {\n                return prev && next;\n              })) {\n                source[i] = callback(source[i]);\n                source.splice(_j, 1);\n                _j--;\n              }\n              j = _j;\n            };\n\n            for (var j = i + 1; j < source.length; j++) {\n              _loop2(j);\n            }\n          };\n\n          for (var i = 0; i < source.length; i++) {\n            _loop(i);\n          }\n          return source;\n        };\n\n        var source = [{ name: 'luo', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'luo', age: 3, count: 1 }, { name: 'v', age: 3, count: 1 }, { name: 'v', age: 2, count: 1 }, { name: 'v', age: 42, count: 1 }];\n\n        var ret = uniq(source, ['name', 'age'], function (item) {\n          item.count += 1;\n          return item;\n        });\n        //console.log(ret)\n","slug":"js多对象数组唯一方法","published":1,"updated":"2016-09-15T07:13:28.141Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxtb000c7sqvgbi9m84m","content":"<p>前些天做项目, 小伙伴遇到一个js多对象数组, 求唯一问题, 思考了很久, 没有找到好的方案. 小伙伴使用了递归, 个人感觉不是最好的方案.<br>今天有空重写了一个.</p>\n<a id=\"more\"></a>\n<h2 id=\"原理分析\"><a href=\"#原理分析\" class=\"headerlink\" title=\"原理分析\"></a>原理分析</h2><ul>\n<li><p>遍历数组中的对象, 第一个对象和接下来所有的对象进行对比, 如果碰到一致的, 将其删除. 自身对象进行处理.</p>\n</li>\n<li><p>问题主要处在删除后, 数组的索引发生变更, 之前没有考虑到. 一直不正确. 今天把代码贴出. 欢迎拍砖.! :)</p>\n</li>\n<li><p>es6 code 需要babeljs转换下</p>\n<pre><code>// es6 code\nconst uniq = (source = [], fields = [], callback = ()=&gt;{}) =&gt; {\n  for(let i = 0; i &lt; source.length; i++){\n    for(let j = i+1; j &lt; source.length; j++){\n        /*\n         * 对比对象中的字段(传入的参数)是否相等 返回一个和fileds数组相同数量的true, false数组,\n         * 本列子返回[false, true], 对返回的true, false数组reduce计算, 看看对象是否相等, 如果相等\n         * 调用callback, 删除原数组中相同的对象, 原数组相同的对象删除后, for循环需要回退.\n         */\n      if(fields.map((field) =&gt; {\n        return source[i][field] == source[j][field];\n      }).reduce((prev, next) =&gt; prev&amp;&amp;next)){\n        source[i] = callback(source[i]);\n        source.splice(j, 1);\n        j--; // 回退for\n      }\n    }\n  }\n  return source;\n};\n\nlet source = [\n  {name: &apos;luo&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;luo&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;v&apos;, age: 42, count:1}, \n];\n\nlet ret = uniq(source, [&apos;name&apos;, &apos;age&apos;], (item) =&gt; {\n  item.count += 1;\n  return item;\n});\n</code></pre></li>\n<li><p>es5 转换好的code</p>\n<pre><code>// es5 code\n&apos;use strict&apos;;\n\nvar uniq = function uniq() {\n  var source = arguments.length &lt;= 0 || arguments[0] === undefined ? [] : arguments[0];\n  var fields = arguments.length &lt;= 1 || arguments[1] === undefined ? [] : arguments[1];\n  var callback = arguments.length &lt;= 2 || arguments[2] === undefined ? function () {} : arguments[2];\n\n  var _loop = function _loop(i) {\n    var _loop2 = function _loop2(_j) {\n      if (fields.map(function (field) {\n        return source[i][field] == source[_j][field];\n      }).reduce(function (prev, next) {\n        return prev &amp;&amp; next;\n      })) {\n        source[i] = callback(source[i]);\n        source.splice(_j, 1);\n        _j--;\n      }\n      j = _j;\n    };\n\n    for (var j = i + 1; j &lt; source.length; j++) {\n      _loop2(j);\n    }\n  };\n\n  for (var i = 0; i &lt; source.length; i++) {\n    _loop(i);\n  }\n  return source;\n};\n\nvar source = [{ name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;v&apos;, age: 42, count: 1 }];\n\nvar ret = uniq(source, [&apos;name&apos;, &apos;age&apos;], function (item) {\n  item.count += 1;\n  return item;\n});\n//console.log(ret)\n</code></pre></li>\n</ul>\n","excerpt":"<p>前些天做项目, 小伙伴遇到一个js多对象数组, 求唯一问题, 思考了很久, 没有找到好的方案. 小伙伴使用了递归, 个人感觉不是最好的方案.<br>今天有空重写了一个.</p>","more":"<h2 id=\"原理分析\"><a href=\"#原理分析\" class=\"headerlink\" title=\"原理分析\"></a>原理分析</h2><ul>\n<li><p>遍历数组中的对象, 第一个对象和接下来所有的对象进行对比, 如果碰到一致的, 将其删除. 自身对象进行处理.</p>\n</li>\n<li><p>问题主要处在删除后, 数组的索引发生变更, 之前没有考虑到. 一直不正确. 今天把代码贴出. 欢迎拍砖.! :)</p>\n</li>\n<li><p>es6 code 需要babeljs转换下</p>\n<pre><code>// es6 code\nconst uniq = (source = [], fields = [], callback = ()=&gt;{}) =&gt; {\n  for(let i = 0; i &lt; source.length; i++){\n    for(let j = i+1; j &lt; source.length; j++){\n        /*\n         * 对比对象中的字段(传入的参数)是否相等 返回一个和fileds数组相同数量的true, false数组,\n         * 本列子返回[false, true], 对返回的true, false数组reduce计算, 看看对象是否相等, 如果相等\n         * 调用callback, 删除原数组中相同的对象, 原数组相同的对象删除后, for循环需要回退.\n         */\n      if(fields.map((field) =&gt; {\n        return source[i][field] == source[j][field];\n      }).reduce((prev, next) =&gt; prev&amp;&amp;next)){\n        source[i] = callback(source[i]);\n        source.splice(j, 1);\n        j--; // 回退for\n      }\n    }\n  }\n  return source;\n};\n\nlet source = [\n  {name: &apos;luo&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;luo&apos;, age: 3, count:1},\n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;luo&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 3, count:1}, \n  {name: &apos;v&apos;, age: 2, count:1}, \n  {name: &apos;v&apos;, age: 42, count:1}, \n];\n\nlet ret = uniq(source, [&apos;name&apos;, &apos;age&apos;], (item) =&gt; {\n  item.count += 1;\n  return item;\n});\n</code></pre></li>\n<li><p>es5 转换好的code</p>\n<pre><code>// es5 code\n&apos;use strict&apos;;\n\nvar uniq = function uniq() {\n  var source = arguments.length &lt;= 0 || arguments[0] === undefined ? [] : arguments[0];\n  var fields = arguments.length &lt;= 1 || arguments[1] === undefined ? [] : arguments[1];\n  var callback = arguments.length &lt;= 2 || arguments[2] === undefined ? function () {} : arguments[2];\n\n  var _loop = function _loop(i) {\n    var _loop2 = function _loop2(_j) {\n      if (fields.map(function (field) {\n        return source[i][field] == source[_j][field];\n      }).reduce(function (prev, next) {\n        return prev &amp;&amp; next;\n      })) {\n        source[i] = callback(source[i]);\n        source.splice(_j, 1);\n        _j--;\n      }\n      j = _j;\n    };\n\n    for (var j = i + 1; j &lt; source.length; j++) {\n      _loop2(j);\n    }\n  };\n\n  for (var i = 0; i &lt; source.length; i++) {\n    _loop(i);\n  }\n  return source;\n};\n\nvar source = [{ name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;luo&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 3, count: 1 }, { name: &apos;v&apos;, age: 2, count: 1 }, { name: &apos;v&apos;, age: 42, count: 1 }];\n\nvar ret = uniq(source, [&apos;name&apos;, &apos;age&apos;], function (item) {\n  item.count += 1;\n  return item;\n});\n//console.log(ret)\n</code></pre></li>\n</ul>"},{"title":"linux下nginx+php-fpm运行用户以及资源目录的权限","date":"2015-06-30T14:38:00.000Z","_content":"\n最近研究了下linux下nginx+php-fpm等web服务的运行用户,和web目录的权限\n\n之前以为,nginx php-fpm 等服务,是用户登入的linux服务器上后, 然后运行对应的服务, 该服务就是以那个用户身份在跑的,后面发现是错的, 普通用户登入,没有权限启动服务.\n\n&nbsp;\n\ngoogle,下,找同事了解到, 猜发现, 服务的运行身份都是在配置文件中配置的, 如nginx服务, 在nginx.conf的开头有user [用户名] &nbsp;这就表示以填写的用户运行该模式了. 对应的web资源,必须对填写的用户读的权限了, 如果加了php-fpm服务, 可以讲各个用户添加到一个web组中,然后对php资源,和web资源给web组加读取权限.\n\n&nbsp;\n\n以上描述只是个人和以前同事的理解,如有错误,欢迎指正. 3ks!\n","source":"_posts/linux下nginx-php-fpm运行用户以及资源目录的权限.md","raw":"---\ntitle: linux下nginx+php-fpm运行用户以及资源目录的权限\ntags: []\ndate: 2015-06-30 22:38:00\n---\n\n最近研究了下linux下nginx+php-fpm等web服务的运行用户,和web目录的权限\n\n之前以为,nginx php-fpm 等服务,是用户登入的linux服务器上后, 然后运行对应的服务, 该服务就是以那个用户身份在跑的,后面发现是错的, 普通用户登入,没有权限启动服务.\n\n&nbsp;\n\ngoogle,下,找同事了解到, 猜发现, 服务的运行身份都是在配置文件中配置的, 如nginx服务, 在nginx.conf的开头有user [用户名] &nbsp;这就表示以填写的用户运行该模式了. 对应的web资源,必须对填写的用户读的权限了, 如果加了php-fpm服务, 可以讲各个用户添加到一个web组中,然后对php资源,和web资源给web组加读取权限.\n\n&nbsp;\n\n以上描述只是个人和以前同事的理解,如有错误,欢迎指正. 3ks!\n","slug":"linux下nginx-php-fpm运行用户以及资源目录的权限","published":1,"updated":"2016-09-15T07:13:28.141Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxu6000e7sqv2rww3c7k","content":"<p>最近研究了下linux下nginx+php-fpm等web服务的运行用户,和web目录的权限</p>\n<p>之前以为,nginx php-fpm 等服务,是用户登入的linux服务器上后, 然后运行对应的服务, 该服务就是以那个用户身份在跑的,后面发现是错的, 普通用户登入,没有权限启动服务.</p>\n<p>&nbsp;</p>\n<p>google,下,找同事了解到, 猜发现, 服务的运行身份都是在配置文件中配置的, 如nginx服务, 在nginx.conf的开头有user [用户名] &nbsp;这就表示以填写的用户运行该模式了. 对应的web资源,必须对填写的用户读的权限了, 如果加了php-fpm服务, 可以讲各个用户添加到一个web组中,然后对php资源,和web资源给web组加读取权限.</p>\n<p>&nbsp;</p>\n<p>以上描述只是个人和以前同事的理解,如有错误,欢迎指正. 3ks!</p>\n","excerpt":"","more":"<p>最近研究了下linux下nginx+php-fpm等web服务的运行用户,和web目录的权限</p>\n<p>之前以为,nginx php-fpm 等服务,是用户登入的linux服务器上后, 然后运行对应的服务, 该服务就是以那个用户身份在跑的,后面发现是错的, 普通用户登入,没有权限启动服务.</p>\n<p>&nbsp;</p>\n<p>google,下,找同事了解到, 猜发现, 服务的运行身份都是在配置文件中配置的, 如nginx服务, 在nginx.conf的开头有user [用户名] &nbsp;这就表示以填写的用户运行该模式了. 对应的web资源,必须对填写的用户读的权限了, 如果加了php-fpm服务, 可以讲各个用户添加到一个web组中,然后对php资源,和web资源给web组加读取权限.</p>\n<p>&nbsp;</p>\n<p>以上描述只是个人和以前同事的理解,如有错误,欢迎指正. 3ks!</p>\n"},{"title":"php图片水印类","date":"2015-06-25T06:45:00.000Z","_content":"\n<div class=\"cnblogs_code\">\n<pre>&lt;?<span style=\"color: #000000;\">php\n</span><span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> Image {\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #800080;\">$path</span><span style=\"color: #000000;\">;\n    </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">构造方法用来对图片所在位置进行初使化</span>\n    <span style=\"color: #0000ff;\">function</span> __construct(<span style=\"color: #800080;\">$path</span>=\"./\"<span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$this</span>-&gt;path=<span style=\"color: #008080;\">rtrim</span>(<span style=\"color: #800080;\">$path</span>, \"/\").\"/\"<span style=\"color: #000000;\">;\n        </span><span style=\"color: #800080;\">$this</span> -&gt; path = ''<span style=\"color: #000000;\">;\n    }\n    </span><span style=\"color: #008000;\">/*</span><span style=\"color: #008000;\"> 对图片进行缩放\n     *\n     * 参数$name: 是需要处理的图片名称\n     * 参数$width:是缩放后的宽度\n     * 参数$height:是缩放后的高度\n     * 参数$qz: 是新图片的名称前缀\n     * 返回值:就是缩放后的图片名称，失败则返回false\n     *\n     </span><span style=\"color: #008000;\">*/</span>\n    <span style=\"color: #0000ff;\">function</span> thumb(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$qz</span>=\"th_\"<span style=\"color: #000000;\">){\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取图片信息</span>\n        <span style=\"color: #800080;\">$imgInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$name</span>); <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片的宽度，高度，类型\n        //获取图片资源, 各种类型的图片都可以创建资源 jpg, gif, png</span>\n        <span style=\"color: #800080;\">$srcImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取计算图片等比例之后的大小, $size[\"width\"], $size[\"height\"]</span>\n        <span style=\"color: #800080;\">$size</span>=<span style=\"color: #800080;\">$this</span>-&gt;getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取新的图片资源, 处理一下gif透明背景</span>\n        <span style=\"color: #800080;\">$newImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">另存为一个新的图片，返回新的缩放后的图片名称    </span>\n        <span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);    \n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newName</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"type\"<span style=\"color: #000000;\">]){\n        </span><span style=\"color: #0000ff;\">case</span> 1:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/gif\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$result</span>=imageGif(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/jpg\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$result</span>=imageJPEG(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/png\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$return</span>=imagepng(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        }\n        imagedestroy(</span><span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newName</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$newImg</span>=imagecreatetruecolor(<span style=\"color: #800080;\">$size</span>[\"width\"], <span style=\"color: #800080;\">$size</span>[\"height\"<span style=\"color: #000000;\">]);\n\n        </span><span style=\"color: #800080;\">$otsc</span>=imagecolortransparent(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$otsc</span> &gt;=0 &amp;&amp; <span style=\"color: #800080;\">$otsc</span> &lt;= imagecolorstotal(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">)){\n            </span><span style=\"color: #800080;\">$tran</span>=imagecolorsforindex(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$otsc</span><span style=\"color: #000000;\">);\n\n            </span><span style=\"color: #800080;\">$newt</span>=imagecolorallocate(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$tran</span>[\"red\"], <span style=\"color: #800080;\">$tran</span>[\"green\"], <span style=\"color: #800080;\">$tran</span>[\"blue\"<span style=\"color: #000000;\">]);\n\n            imagefill(</span><span style=\"color: #800080;\">$newImg</span>, 0, 0, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);\n\n            imagecolortransparent(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);\n        }\n\n        imagecopyresized(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$srcImg</span>, 0, 0, 0, 0, <span style=\"color: #800080;\">$size</span>[\"width\"], <span style=\"color: #800080;\">$size</span>[\"height\"], <span style=\"color: #800080;\">$imgInfo</span>[\"width\"], <span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n\n        imagedestroy(</span><span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">];\n\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的宽度如果比原图小才重新设置宽度</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$width</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #800080;\">$width</span><span style=\"color: #000000;\">;\n        }\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的高度如果比原图小才重新设置高度</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$height</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #800080;\">$height</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片等比例缩放的算法</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"width\"]*<span style=\"color: #800080;\">$size</span>[\"width\"] &gt; <span style=\"color: #800080;\">$imgInfo</span>[\"height\"] * <span style=\"color: #800080;\">$size</span>[\"height\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"height\"]*<span style=\"color: #800080;\">$size</span>[\"width\"]/<span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">]);\n        }</span><span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">{\n            </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"width\"]*<span style=\"color: #800080;\">$size</span>[\"height\"]/<span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$size</span><span style=\"color: #000000;\">;\n\n    }\n\n    </span><span style=\"color: #0000ff;\">public</span> <span style=\"color: #0000ff;\">function</span> getInfo(<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$data</span>=<span style=\"color: #008080;\">getImageSize</span>(<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"width\"]=<span style=\"color: #800080;\">$data</span>[0<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"height\"]=<span style=\"color: #800080;\">$data</span>[1<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"type\"]=<span style=\"color: #800080;\">$data</span>[2<span style=\"color: #000000;\">];\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$imageInfo</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$srcPic</span>=<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">;\n\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"type\"<span style=\"color: #000000;\">]){\n        </span><span style=\"color: #0000ff;\">case</span> 1: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span>\n            <span style=\"color: #800080;\">$img</span>=imagecreatefromgif(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span>\n            <span style=\"color: #800080;\">$img</span>=imageCreatefromjpeg(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span>\n            <span style=\"color: #800080;\">$img</span>=imageCreatefrompng(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">default</span>:\n            <span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;\n\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$img</span><span style=\"color: #000000;\">;\n    }\n    </span><span style=\"color: #008000;\">/*</span><span style=\"color: #008000;\"> 功能：为图片加水印图片\n     * 参数$groundName: 背景图片，即需要加水印的图片\n     * 参数$waterName: 水钱图片\n     * 参数#aterPost：水印位置， 10种状态， \n     *  0为随机位置\n     *\n     *  1\\. 为顶端居左  2\\. 为顶端居中  3 为顶端居右\n     *  4  为中部居左  5\\. 为中部居中  6 为中部居右\n     *  7 . 为底端居左 8\\. 为底端居中， 9\\. 为底端居右\n     *\n     * 参数$qz : 是加水印后的图片名称前缀\n     * 返回值：就是处理后图片的名称\n     *\n     </span><span style=\"color: #008000;\">*/</span>\n    <span style=\"color: #0000ff;\">function</span> waterMark(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterPos</span>=0, <span style=\"color: #800080;\">$qz</span>=\"wa_\"<span style=\"color: #000000;\">){\n\n        </span><span style=\"color: #800080;\">$groundInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$groundName</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #800080;\">$waterInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$waterName</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">水印的位置</span>\n        <span style=\"color: #0000ff;\">if</span>(!<span style=\"color: #800080;\">$pos</span>=<span style=\"color: #800080;\">$this</span>-&gt;position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">)){\n            </span><span style=\"color: #0000ff;\">return</span> \"Picture too small!\"<span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #800080;\">$waterImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);\n\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">){\n        imagecopy(</span><span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>[\"posX\"], <span style=\"color: #800080;\">$pos</span>[\"posY\"], 0, 0, <span style=\"color: #800080;\">$waterInfo</span>[\"width\"], <span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n        imagedestroy(</span><span style=\"color: #800080;\">$waterImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$groundImg</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">需要背景比水印图片大</span>\n        <span style=\"color: #0000ff;\">if</span>((<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]&lt; <span style=\"color: #800080;\">$waterInfo</span>[\"width\"]) ||(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"] &lt; <span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">])){\n            </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #0000ff;\">case</span> 1:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 4:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 5:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 6:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 7:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 8:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 9:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 0:\n        <span style=\"color: #0000ff;\">default</span>:\n        <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">]));\n        </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">]));\n        </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">array</span>(\"posX\"=&gt;<span style=\"color: #800080;\">$posX</span>, \"posY\"=&gt;<span style=\"color: #800080;\">$posY</span><span style=\"color: #000000;\">);\n    }\n\n}</span></pre>\n</div>\n\n&nbsp;","source":"_posts/php图片水印类.md","raw":"---\ntitle: php图片水印类\ntags: []\ndate: 2015-06-25 14:45:00\n---\n\n<div class=\"cnblogs_code\">\n<pre>&lt;?<span style=\"color: #000000;\">php\n</span><span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> Image {\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #800080;\">$path</span><span style=\"color: #000000;\">;\n    </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">构造方法用来对图片所在位置进行初使化</span>\n    <span style=\"color: #0000ff;\">function</span> __construct(<span style=\"color: #800080;\">$path</span>=\"./\"<span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$this</span>-&gt;path=<span style=\"color: #008080;\">rtrim</span>(<span style=\"color: #800080;\">$path</span>, \"/\").\"/\"<span style=\"color: #000000;\">;\n        </span><span style=\"color: #800080;\">$this</span> -&gt; path = ''<span style=\"color: #000000;\">;\n    }\n    </span><span style=\"color: #008000;\">/*</span><span style=\"color: #008000;\"> 对图片进行缩放\n     *\n     * 参数$name: 是需要处理的图片名称\n     * 参数$width:是缩放后的宽度\n     * 参数$height:是缩放后的高度\n     * 参数$qz: 是新图片的名称前缀\n     * 返回值:就是缩放后的图片名称，失败则返回false\n     *\n     </span><span style=\"color: #008000;\">*/</span>\n    <span style=\"color: #0000ff;\">function</span> thumb(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$qz</span>=\"th_\"<span style=\"color: #000000;\">){\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取图片信息</span>\n        <span style=\"color: #800080;\">$imgInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$name</span>); <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片的宽度，高度，类型\n        //获取图片资源, 各种类型的图片都可以创建资源 jpg, gif, png</span>\n        <span style=\"color: #800080;\">$srcImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取计算图片等比例之后的大小, $size[\"width\"], $size[\"height\"]</span>\n        <span style=\"color: #800080;\">$size</span>=<span style=\"color: #800080;\">$this</span>-&gt;getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取新的图片资源, 处理一下gif透明背景</span>\n        <span style=\"color: #800080;\">$newImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">另存为一个新的图片，返回新的缩放后的图片名称    </span>\n        <span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);    \n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newName</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"type\"<span style=\"color: #000000;\">]){\n        </span><span style=\"color: #0000ff;\">case</span> 1:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/gif\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$result</span>=imageGif(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/jpg\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$result</span>=imageJPEG(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span>\n            <span style=\"color: #008080;\">Header</span>(\"Content-type: image/png\"<span style=\"color: #000000;\">);\n            </span><span style=\"color: #800080;\">$return</span>=imagepng(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        }\n        imagedestroy(</span><span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newName</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$newImg</span>=imagecreatetruecolor(<span style=\"color: #800080;\">$size</span>[\"width\"], <span style=\"color: #800080;\">$size</span>[\"height\"<span style=\"color: #000000;\">]);\n\n        </span><span style=\"color: #800080;\">$otsc</span>=imagecolortransparent(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$otsc</span> &gt;=0 &amp;&amp; <span style=\"color: #800080;\">$otsc</span> &lt;= imagecolorstotal(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">)){\n            </span><span style=\"color: #800080;\">$tran</span>=imagecolorsforindex(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$otsc</span><span style=\"color: #000000;\">);\n\n            </span><span style=\"color: #800080;\">$newt</span>=imagecolorallocate(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$tran</span>[\"red\"], <span style=\"color: #800080;\">$tran</span>[\"green\"], <span style=\"color: #800080;\">$tran</span>[\"blue\"<span style=\"color: #000000;\">]);\n\n            imagefill(</span><span style=\"color: #800080;\">$newImg</span>, 0, 0, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);\n\n            imagecolortransparent(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);\n        }\n\n        imagecopyresized(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$srcImg</span>, 0, 0, 0, 0, <span style=\"color: #800080;\">$size</span>[\"width\"], <span style=\"color: #800080;\">$size</span>[\"height\"], <span style=\"color: #800080;\">$imgInfo</span>[\"width\"], <span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n\n        imagedestroy(</span><span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">];\n\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的宽度如果比原图小才重新设置宽度</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$width</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #800080;\">$width</span><span style=\"color: #000000;\">;\n        }\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的高度如果比原图小才重新设置高度</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$height</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #800080;\">$height</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片等比例缩放的算法</span>\n        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"width\"]*<span style=\"color: #800080;\">$size</span>[\"width\"] &gt; <span style=\"color: #800080;\">$imgInfo</span>[\"height\"] * <span style=\"color: #800080;\">$size</span>[\"height\"<span style=\"color: #000000;\">]){\n            </span><span style=\"color: #800080;\">$size</span>[\"height\"]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"height\"]*<span style=\"color: #800080;\">$size</span>[\"width\"]/<span style=\"color: #800080;\">$imgInfo</span>[\"width\"<span style=\"color: #000000;\">]);\n        }</span><span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">{\n            </span><span style=\"color: #800080;\">$size</span>[\"width\"]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"width\"]*<span style=\"color: #800080;\">$size</span>[\"height\"]/<span style=\"color: #800080;\">$imgInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$size</span><span style=\"color: #000000;\">;\n\n    }\n\n    </span><span style=\"color: #0000ff;\">public</span> <span style=\"color: #0000ff;\">function</span> getInfo(<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$data</span>=<span style=\"color: #008080;\">getImageSize</span>(<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"width\"]=<span style=\"color: #800080;\">$data</span>[0<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"height\"]=<span style=\"color: #800080;\">$data</span>[1<span style=\"color: #000000;\">];\n        </span><span style=\"color: #800080;\">$imageInfo</span>[\"type\"]=<span style=\"color: #800080;\">$data</span>[2<span style=\"color: #000000;\">];\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$imageInfo</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #800080;\">$srcPic</span>=<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">;\n\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[\"type\"<span style=\"color: #000000;\">]){\n        </span><span style=\"color: #0000ff;\">case</span> 1: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span>\n            <span style=\"color: #800080;\">$img</span>=imagecreatefromgif(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span>\n            <span style=\"color: #800080;\">$img</span>=imageCreatefromjpeg(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span>\n            <span style=\"color: #800080;\">$img</span>=imageCreatefrompng(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">default</span>:\n            <span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;\n\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$img</span><span style=\"color: #000000;\">;\n    }\n    </span><span style=\"color: #008000;\">/*</span><span style=\"color: #008000;\"> 功能：为图片加水印图片\n     * 参数$groundName: 背景图片，即需要加水印的图片\n     * 参数$waterName: 水钱图片\n     * 参数#aterPost：水印位置， 10种状态， \n     *  0为随机位置\n     *\n     *  1\\. 为顶端居左  2\\. 为顶端居中  3 为顶端居右\n     *  4  为中部居左  5\\. 为中部居中  6 为中部居右\n     *  7 . 为底端居左 8\\. 为底端居中， 9\\. 为底端居右\n     *\n     * 参数$qz : 是加水印后的图片名称前缀\n     * 返回值：就是处理后图片的名称\n     *\n     </span><span style=\"color: #008000;\">*/</span>\n    <span style=\"color: #0000ff;\">function</span> waterMark(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterPos</span>=0, <span style=\"color: #800080;\">$qz</span>=\"wa_\"<span style=\"color: #000000;\">){\n\n        </span><span style=\"color: #800080;\">$groundInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$groundName</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #800080;\">$waterInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$waterName</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">水印的位置</span>\n        <span style=\"color: #0000ff;\">if</span>(!<span style=\"color: #800080;\">$pos</span>=<span style=\"color: #800080;\">$this</span>-&gt;position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">)){\n            </span><span style=\"color: #0000ff;\">return</span> \"Picture too small!\"<span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);\n        </span><span style=\"color: #800080;\">$waterImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);\n\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">){\n        imagecopy(</span><span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>[\"posX\"], <span style=\"color: #800080;\">$pos</span>[\"posY\"], 0, 0, <span style=\"color: #800080;\">$waterInfo</span>[\"width\"], <span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">]);\n        imagedestroy(</span><span style=\"color: #800080;\">$waterImg</span><span style=\"color: #000000;\">);\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$groundImg</span><span style=\"color: #000000;\">;\n    }\n\n    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">需要背景比水印图片大</span>\n        <span style=\"color: #0000ff;\">if</span>((<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]&lt; <span style=\"color: #800080;\">$waterInfo</span>[\"width\"]) ||(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"] &lt; <span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">])){\n            </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){\n        </span><span style=\"color: #0000ff;\">case</span> 1:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 2:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 3:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 4:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 5:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 6:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"]) /2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 7:\n            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 8:\n            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"])/2<span style=\"color: #000000;\">;\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 9:\n            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">];\n            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        </span><span style=\"color: #0000ff;\">case</span> 0:\n        <span style=\"color: #0000ff;\">default</span>:\n        <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[\"width\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"width\"<span style=\"color: #000000;\">]));\n        </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[\"height\"]-<span style=\"color: #800080;\">$waterInfo</span>[\"height\"<span style=\"color: #000000;\">]));\n        </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;\n        }\n\n        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">array</span>(\"posX\"=&gt;<span style=\"color: #800080;\">$posX</span>, \"posY\"=&gt;<span style=\"color: #800080;\">$posY</span><span style=\"color: #000000;\">);\n    }\n\n}</span></pre>\n</div>\n\n&nbsp;","slug":"php图片水印类","published":1,"updated":"2016-09-15T07:13:28.142Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxu6000f7sqv6c64bacx","content":"<div class=\"cnblogs_code\"><br><pre>&lt;?<span style=\"color: #000000;\">php<br></span><span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> Image {<br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #800080;\">$path</span><span style=\"color: #000000;\">;<br>    </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">构造方法用来对图片所在位置进行初使化</span><br>    <span style=\"color: #0000ff;\">function</span> _<em>construct(<span style=\"color: #800080;\">$path</span>=”./“<span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$this</span>-&gt;path=<span style=\"color: #008080;\">rtrim</span>(<span style=\"color: #800080;\">$path</span>, “/“).”/“<span style=\"color: #000000;\">;<br>        </span><span style=\"color: #800080;\">$this</span> -&gt; path = ‘’<span style=\"color: #000000;\">;<br>    }<br>    </span><span style=\"color: #008000;\">/<em></em></span><span style=\"color: #008000;\"> 对图片进行缩放\n     </span></em><br>     <em> 参数$name: 是需要处理的图片名称\n     </em> 参数$width:是缩放后的宽度<br>     <em> 参数$height:是缩放后的高度\n     </em> 参数$qz: 是新图片的名称前缀<br>     <em> 返回值:就是缩放后的图片名称，失败则返回false\n     </em><br>     <span style=\"color: #008000;\">*/</span><br>    <span style=\"color: #0000ff;\">function</span> thumb(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$qz</span>=”th“<span style=\"color: #000000;\">){<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取图片信息</span><br>        <span style=\"color: #800080;\">$imgInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$name</span>); <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片的宽度，高度，类型<br>        //获取图片资源, 各种类型的图片都可以创建资源 jpg, gif, png</span><br>        <span style=\"color: #800080;\">$srcImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取计算图片等比例之后的大小, $size[“width”], $size[“height”]</span><br>        <span style=\"color: #800080;\">$size</span>=<span style=\"color: #800080;\">$this</span>-&gt;getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取新的图片资源, 处理一下gif透明背景</span><br>        <span style=\"color: #800080;\">$newImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">另存为一个新的图片，返回新的缩放后的图片名称    </span><br>        <span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newName</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[“type”<span style=\"color: #000000;\">]){<br>        </span><span style=\"color: #0000ff;\">case</span> 1:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/gif”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$result</span>=imageGif(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/jpg”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$result</span>=imageJPEG(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/png”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$return</span>=imagepng(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        }<br>        imagedestroy(</span><span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newName</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$newImg</span>=imagecreatetruecolor(<span style=\"color: #800080;\">$size</span>[“width”], <span style=\"color: #800080;\">$size</span>[“height”<span style=\"color: #000000;\">]);<br><br>        </span><span style=\"color: #800080;\">$otsc</span>=imagecolortransparent(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$otsc</span> &gt;=0 &amp;&amp; <span style=\"color: #800080;\">$otsc</span> &lt;= imagecolorstotal(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">)){<br>            </span><span style=\"color: #800080;\">$tran</span>=imagecolorsforindex(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$otsc</span><span style=\"color: #000000;\">);<br><br>            </span><span style=\"color: #800080;\">$newt</span>=imagecolorallocate(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$tran</span>[“red”], <span style=\"color: #800080;\">$tran</span>[“green”], <span style=\"color: #800080;\">$tran</span>[“blue”<span style=\"color: #000000;\">]);<br><br>            imagefill(</span><span style=\"color: #800080;\">$newImg</span>, 0, 0, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);<br><br>            imagecolortransparent(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);<br>        }<br><br>        imagecopyresized(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$srcImg</span>, 0, 0, 0, 0, <span style=\"color: #800080;\">$size</span>[“width”], <span style=\"color: #800080;\">$size</span>[“height”], <span style=\"color: #800080;\">$imgInfo</span>[“width”], <span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]);<br><br>        imagedestroy(</span><span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">];<br><br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的宽度如果比原图小才重新设置宽度</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$width</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #800080;\">$width</span><span style=\"color: #000000;\">;<br>        }<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的高度如果比原图小才重新设置高度</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$height</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #800080;\">$height</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片等比例缩放的算法</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$imgInfo</span>[“width”]<em><span style=\"color: #800080;\">$size</span>[“width”] &gt; <span style=\"color: #800080;\">$imgInfo</span>[“height”] </em> <span style=\"color: #800080;\">$size</span>[“height”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[“height”]<em><span style=\"color: #800080;\">$size</span>[“width”]/<span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">]);<br>        }</span><span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">{<br>            </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[“width”]</em><span style=\"color: #800080;\">$size</span>[“height”]/<span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]);<br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$size</span><span style=\"color: #000000;\">;<br><br>    }<br><br>    </span><span style=\"color: #0000ff;\">public</span> <span style=\"color: #0000ff;\">function</span> getInfo(<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$data</span>=<span style=\"color: #008080;\">getImageSize</span>(<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“width”]=<span style=\"color: #800080;\">$data</span>[0<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“height”]=<span style=\"color: #800080;\">$data</span>[1<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“type”]=<span style=\"color: #800080;\">$data</span>[2<span style=\"color: #000000;\">];<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$imageInfo</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$srcPic</span>=<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">;<br><br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[“type”<span style=\"color: #000000;\">]){<br>        </span><span style=\"color: #0000ff;\">case</span> 1: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span><br>            <span style=\"color: #800080;\">$img</span>=imagecreatefromgif(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span><br>            <span style=\"color: #800080;\">$img</span>=imageCreatefromjpeg(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span><br>            <span style=\"color: #800080;\">$img</span>=imageCreatefrompng(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">default</span>:<br>            <span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;<br><br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$img</span><span style=\"color: #000000;\">;<br>    }<br>    </span><span style=\"color: #008000;\">/<em></em></span><span style=\"color: #008000;\"> 功能：为图片加水印图片\n      参数$groundName: 背景图片，即需要加水印的图片<br>     <em> 参数$waterName: 水钱图片\n     </em> 参数#aterPost：水印位置， 10种状态，<br>     <em>  0为随机位置\n     </em><br>     <em>  1. 为顶端居左  2. 为顶端居中  3 为顶端居右\n     </em>  4  为中部居左  5. 为中部居中  6 为中部居右<br>     <em>  7 . 为底端居左 8. 为底端居中， 9. 为底端居右\n     </em><br>     <em> 参数$qz : 是加水印后的图片名称前缀\n     </em> 返回值：就是处理后图片的名称<br>     <em><br>     </em></span><span style=\"color: #008000;\">/</span><br>    <span style=\"color: #0000ff;\">function</span> waterMark(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterPos</span>=0, <span style=\"color: #800080;\">$qz</span>=”wa_”<span style=\"color: #000000;\">){<br><br>        </span><span style=\"color: #800080;\">$groundInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$groundName</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #800080;\">$waterInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$waterName</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">水印的位置</span><br>        <span style=\"color: #0000ff;\">if</span>(!<span style=\"color: #800080;\">$pos</span>=<span style=\"color: #800080;\">$this</span>-&gt;position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">)){<br>            </span><span style=\"color: #0000ff;\">return</span> “Picture too small!”<span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #800080;\">$waterImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);<br><br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">){<br>        imagecopy(</span><span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>[“posX”], <span style=\"color: #800080;\">$pos</span>[“posY”], 0, 0, <span style=\"color: #800080;\">$waterInfo</span>[“width”], <span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">]);<br>        imagedestroy(</span><span style=\"color: #800080;\">$waterImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$groundImg</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">需要背景比水印图片大</span><br>        <span style=\"color: #0000ff;\">if</span>((<span style=\"color: #800080;\">$groundInfo</span>[“width”]&lt; <span style=\"color: #800080;\">$waterInfo</span>[“width”]) ||(<span style=\"color: #800080;\">$groundInfo</span>[“height”] &lt; <span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">])){<br>            </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #0000ff;\">case</span> 1:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 4:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 5:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 6:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 7:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 8:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 9:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 0:<br>        <span style=\"color: #0000ff;\">default</span>:<br>        <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">]));<br>        </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">]));<br>        </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">array</span>(“posX”=&gt;<span style=\"color: #800080;\">$posX</span>, “posY”=&gt;<span style=\"color: #800080;\">$posY</span><span style=\"color: #000000;\">);<br>    }<br><br>}</span></pre><br></div>\n\n<p>&nbsp;</p>\n","excerpt":"","more":"<div class=\"cnblogs_code\"><br><pre>&lt;?<span style=\"color: #000000;\">php<br></span><span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> Image {<br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #800080;\">$path</span><span style=\"color: #000000;\">;<br>    </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">构造方法用来对图片所在位置进行初使化</span><br>    <span style=\"color: #0000ff;\">function</span> _<em>construct(<span style=\"color: #800080;\">$path</span>=”./“<span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$this</span>-&gt;path=<span style=\"color: #008080;\">rtrim</span>(<span style=\"color: #800080;\">$path</span>, “/“).”/“<span style=\"color: #000000;\">;<br>        </span><span style=\"color: #800080;\">$this</span> -&gt; path = ‘’<span style=\"color: #000000;\">;<br>    }<br>    </span><span style=\"color: #008000;\">/<em></span><span style=\"color: #008000;\"> 对图片进行缩放\n     </em><br>     <em> 参数$name: 是需要处理的图片名称\n     </em> 参数$width:是缩放后的宽度<br>     <em> 参数$height:是缩放后的高度\n     </em> 参数$qz: 是新图片的名称前缀<br>     <em> 返回值:就是缩放后的图片名称，失败则返回false\n     </em><br>     </span><span style=\"color: #008000;\">*/</span><br>    <span style=\"color: #0000ff;\">function</span> thumb(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$qz</span>=”th</em>“<span style=\"color: #000000;\">){<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取图片信息</span><br>        <span style=\"color: #800080;\">$imgInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$name</span>); <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片的宽度，高度，类型<br>        //获取图片资源, 各种类型的图片都可以创建资源 jpg, gif, png</span><br>        <span style=\"color: #800080;\">$srcImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取计算图片等比例之后的大小, $size[“width”], $size[“height”]</span><br>        <span style=\"color: #800080;\">$size</span>=<span style=\"color: #800080;\">$this</span>-&gt;getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">获取新的图片资源, 处理一下gif透明背景</span><br>        <span style=\"color: #800080;\">$newImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">另存为一个新的图片，返回新的缩放后的图片名称    </span><br>        <span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">);<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> createNewImage(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newName</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[“type”<span style=\"color: #000000;\">]){<br>        </span><span style=\"color: #0000ff;\">case</span> 1:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/gif”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$result</span>=imageGif(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/jpg”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$result</span>=imageJPEG(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3:<span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span><br>            <span style=\"color: #008080;\">Header</span>(“Content-type: image/png”<span style=\"color: #000000;\">);<br>            </span><span style=\"color: #800080;\">$return</span>=imagepng(<span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        }<br>        imagedestroy(</span><span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newName</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> kidOfImage(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$size</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$newImg</span>=imagecreatetruecolor(<span style=\"color: #800080;\">$size</span>[“width”], <span style=\"color: #800080;\">$size</span>[“height”<span style=\"color: #000000;\">]);<br><br>        </span><span style=\"color: #800080;\">$otsc</span>=imagecolortransparent(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$otsc</span> &gt;=0 &amp;&amp; <span style=\"color: #800080;\">$otsc</span> &lt;= imagecolorstotal(<span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">)){<br>            </span><span style=\"color: #800080;\">$tran</span>=imagecolorsforindex(<span style=\"color: #800080;\">$srcImg</span>, <span style=\"color: #800080;\">$otsc</span><span style=\"color: #000000;\">);<br><br>            </span><span style=\"color: #800080;\">$newt</span>=imagecolorallocate(<span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$tran</span>[“red”], <span style=\"color: #800080;\">$tran</span>[“green”], <span style=\"color: #800080;\">$tran</span>[“blue”<span style=\"color: #000000;\">]);<br><br>            imagefill(</span><span style=\"color: #800080;\">$newImg</span>, 0, 0, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);<br><br>            imagecolortransparent(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$newt</span><span style=\"color: #000000;\">);<br>        }<br><br>        imagecopyresized(</span><span style=\"color: #800080;\">$newImg</span>, <span style=\"color: #800080;\">$srcImg</span>, 0, 0, 0, 0, <span style=\"color: #800080;\">$size</span>[“width”], <span style=\"color: #800080;\">$size</span>[“height”], <span style=\"color: #800080;\">$imgInfo</span>[“width”], <span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]);<br><br>        imagedestroy(</span><span style=\"color: #800080;\">$srcImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$newImg</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getNewSize(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$width</span>, <span style=\"color: #800080;\">$height</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">];<br><br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的宽度如果比原图小才重新设置宽度</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$width</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #800080;\">$width</span><span style=\"color: #000000;\">;<br>        }<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">缩放的高度如果比原图小才重新设置高度</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$height</span> &lt; <span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #800080;\">$height</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">图片等比例缩放的算法</span><br>        <span style=\"color: #0000ff;\">if</span>(<span style=\"color: #800080;\">$imgInfo</span>[“width”]<em><span style=\"color: #800080;\">$size</span>[“width”] &gt; <span style=\"color: #800080;\">$imgInfo</span>[“height”] </em> <span style=\"color: #800080;\">$size</span>[“height”<span style=\"color: #000000;\">]){<br>            </span><span style=\"color: #800080;\">$size</span>[“height”]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[“height”]<em><span style=\"color: #800080;\">$size</span>[“width”]/<span style=\"color: #800080;\">$imgInfo</span>[“width”<span style=\"color: #000000;\">]);<br>        }</span><span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">{<br>            </span><span style=\"color: #800080;\">$size</span>[“width”]=<span style=\"color: #008080;\">round</span>(<span style=\"color: #800080;\">$imgInfo</span>[“width”]</em><span style=\"color: #800080;\">$size</span>[“height”]/<span style=\"color: #800080;\">$imgInfo</span>[“height”<span style=\"color: #000000;\">]);<br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$size</span><span style=\"color: #000000;\">;<br><br>    }<br><br>    </span><span style=\"color: #0000ff;\">public</span> <span style=\"color: #0000ff;\">function</span> getInfo(<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$data</span>=<span style=\"color: #008080;\">getImageSize</span>(<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“width”]=<span style=\"color: #800080;\">$data</span>[0<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“height”]=<span style=\"color: #800080;\">$data</span>[1<span style=\"color: #000000;\">];<br>        </span><span style=\"color: #800080;\">$imageInfo</span>[“type”]=<span style=\"color: #800080;\">$data</span>[2<span style=\"color: #000000;\">];<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$imageInfo</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> getImg(<span style=\"color: #800080;\">$name</span>, <span style=\"color: #800080;\">$imgInfo</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #800080;\">$srcPic</span>=<span style=\"color: #800080;\">$this</span>-&gt;path.<span style=\"color: #800080;\">$name</span><span style=\"color: #000000;\">;<br><br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$imgInfo</span>[“type”<span style=\"color: #000000;\">]){<br>        </span><span style=\"color: #0000ff;\">case</span> 1: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">gif</span><br>            <span style=\"color: #800080;\">$img</span>=imagecreatefromgif(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">jpg</span><br>            <span style=\"color: #800080;\">$img</span>=imageCreatefromjpeg(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3: <span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">png</span><br>            <span style=\"color: #800080;\">$img</span>=imageCreatefrompng(<span style=\"color: #800080;\">$srcPic</span><span style=\"color: #000000;\">);<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">default</span>:<br>            <span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;<br><br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$img</span><span style=\"color: #000000;\">;<br>    }<br>    </span><span style=\"color: #008000;\">/<em></span><span style=\"color: #008000;\"> 功能：为图片加水印图片\n     </em> 参数$groundName: 背景图片，即需要加水印的图片<br>     <em> 参数$waterName: 水钱图片\n     </em> 参数#aterPost：水印位置， 10种状态，<br>     <em>  0为随机位置\n     </em><br>     <em>  1. 为顶端居左  2. 为顶端居中  3 为顶端居右\n     </em>  4  为中部居左  5. 为中部居中  6 为中部居右<br>     <em>  7 . 为底端居左 8. 为底端居中， 9. 为底端居右\n     </em><br>     <em> 参数$qz : 是加水印后的图片名称前缀\n     </em> 返回值：就是处理后图片的名称<br>     <em><br>     </span><span style=\"color: #008000;\"></em>/</span><br>    <span style=\"color: #0000ff;\">function</span> waterMark(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterPos</span>=0, <span style=\"color: #800080;\">$qz</span>=”wa_”<span style=\"color: #000000;\">){<br><br>        </span><span style=\"color: #800080;\">$groundInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$groundName</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #800080;\">$waterInfo</span>=<span style=\"color: #800080;\">$this</span>-&gt;getInfo(<span style=\"color: #800080;\">$waterName</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">水印的位置</span><br>        <span style=\"color: #0000ff;\">if</span>(!<span style=\"color: #800080;\">$pos</span>=<span style=\"color: #800080;\">$this</span>-&gt;position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">)){<br>            </span><span style=\"color: #0000ff;\">return</span> “Picture too small!”<span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);<br>        </span><span style=\"color: #800080;\">$waterImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;getImg(<span style=\"color: #800080;\">$waterName</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #800080;\">$groundImg</span>=<span style=\"color: #800080;\">$this</span>-&gt;copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$this</span>-&gt;createNewImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$qz</span>.<span style=\"color: #800080;\">$groundName</span>, <span style=\"color: #800080;\">$groundInfo</span><span style=\"color: #000000;\">);<br><br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> copyImage(<span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>, <span style=\"color: #800080;\">$waterInfo</span><span style=\"color: #000000;\">){<br>        imagecopy(</span><span style=\"color: #800080;\">$groundImg</span>, <span style=\"color: #800080;\">$waterImg</span>, <span style=\"color: #800080;\">$pos</span>[“posX”], <span style=\"color: #800080;\">$pos</span>[“posY”], 0, 0, <span style=\"color: #800080;\">$waterInfo</span>[“width”], <span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">]);<br>        imagedestroy(</span><span style=\"color: #800080;\">$waterImg</span><span style=\"color: #000000;\">);<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #800080;\">$groundImg</span><span style=\"color: #000000;\">;<br>    }<br><br>    </span><span style=\"color: #0000ff;\">private</span> <span style=\"color: #0000ff;\">function</span> position(<span style=\"color: #800080;\">$groundInfo</span>, <span style=\"color: #800080;\">$waterInfo</span>, <span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #008000;\">//</span><span style=\"color: #008000;\">需要背景比水印图片大</span><br>        <span style=\"color: #0000ff;\">if</span>((<span style=\"color: #800080;\">$groundInfo</span>[“width”]&lt; <span style=\"color: #800080;\">$waterInfo</span>[“width”]) ||(<span style=\"color: #800080;\">$groundInfo</span>[“height”] &lt; <span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">])){<br>            </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">false</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #0000ff;\">switch</span>(<span style=\"color: #800080;\">$waterPos</span><span style=\"color: #000000;\">){<br>        </span><span style=\"color: #0000ff;\">case</span> 1:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 2:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 3:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 4:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 5:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 6:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”]) /2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 7:<br>            <span style=\"color: #800080;\">$posX</span>=0<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 8:<br>            <span style=\"color: #800080;\">$posX</span>=(<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”])/2<span style=\"color: #000000;\">;<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 9:<br>            <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">];<br>            </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        </span><span style=\"color: #0000ff;\">case</span> 0:<br>        <span style=\"color: #0000ff;\">default</span>:<br>        <span style=\"color: #800080;\">$posX</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[“width”]-<span style=\"color: #800080;\">$waterInfo</span>[“width”<span style=\"color: #000000;\">]));<br>        </span><span style=\"color: #800080;\">$posY</span>=<span style=\"color: #008080;\">rand</span>(0, (<span style=\"color: #800080;\">$groundInfo</span>[“height”]-<span style=\"color: #800080;\">$waterInfo</span>[“height”<span style=\"color: #000000;\">]));<br>        </span><span style=\"color: #0000ff;\">break</span><span style=\"color: #000000;\">;<br>        }<br><br>        </span><span style=\"color: #0000ff;\">return</span> <span style=\"color: #0000ff;\">array</span>(“posX”=&gt;<span style=\"color: #800080;\">$posX</span>, “posY”=&gt;<span style=\"color: #800080;\">$posY</span><span style=\"color: #000000;\">);<br>    }<br><br>}</span></pre><br></div>\n\n<p>&nbsp;</p>\n"},{"title":"mysql主从备份","date":"2016-09-15T05:45:37.000Z","desc":null,"_content":"\nMySQL的主从复制配置很简单, 帖子已经很多了, 再不厌其烦的写主要是为了下篇配合zabbix做监控存活做准备.\n\n<!-- more -->\n\n### 先说mysql备份策略\n\n* 冷备份(不能实时备份)\n\n    1. 将mysql的dataDir目录打包scp/rsync 到备份服务器. 优点: 简单暴力. 冷备的缺点, mysql版本一致, 后期数据量大了, 备份越来越久.\n    2. 使用mysqldump, (mysqlcopy, mysqlbackup企业版) 自带工具备份, 有点: 简单, 一条命令就ok, mysql版本能向上兼容, 数据量大, 备份慢.\n\n\n* 热备份(及时备份)\n\n    1. mysql主从复制, 主mysql开启bin-log, 从mysql读取主bin-log文件名和位置, 写入到从库中(mysql版本需要一致)\n    2. inotify+rsync inotify检测文件是否发生变动, 如变动使用rsync备份到远程.(使用所有备份, 不只是mysql业务)\n    3. drbd (分布式块设备) 即时写入.(使用所有备份, 不只是mysql业务)\n\n\n### 配置mysql主从配置.\n\n* 英文好的同学, 直接参照[官方文档](https://dev.mysql.com/doc/refman/5.6/en/replication.html)\n\n* 默认环境\n\n    ```sql\n        192.168.1.100 主mysql5.6\n        192.168.1.101 从mysql5.6\n    ```\n\n* 主mysql配置\n\n    1. 编辑my.cnf. (参考多目录下my.cnf的优先级)\n\n        ```sql\n            bind-address=192.168.1.100\n            server-id=1\n            bin_log=/var/log/mysql/mysql-bin.log\n            binlog_do_db=newdatabase # 需要同步的数据库, 不写, 表示全部库\n        ```\n    2. 添加具有复制权限的用户\n\n        ```sql\n            GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'slave_password';\n            flush privileges; # 刷新权限\n        ```\n\n    3. 重启动mysql服务 `service mysqld restart | systemctl restart mysqld`\n\n    4. 锁定当前主库的数据状态, 将当前数据状态备份到从库中去.\n\n        ```sql\n            USE DATABASE;\n            FLUSH TABLES WITH READ LOCK;\n\n            SHOW MASTER STATUS;\n            +------------------+----------+--------------+------------------+\n            | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n            +------------------+----------+--------------+------------------+\n            | mysql-bin.000001 |      107 | newdatabase  |                  |\n            +------------------+----------+--------------+------------------+\n\n            # 此窗口不要动了(如果有改动, 会自动解除锁), 新开一个窗口, 将数据库导出\n            # 新窗口mysql回话\n            mysqldump -uUsername -pPassword newdatabase > newdatabase-dump.sql\n\n            exit; # 主配置完成, 关闭退出.\n        ```\n\n* 从mysql配置\n\n    1. 导入主mysql数据\n\n        ```sql\n            mysql -uUser -pPassword newdatabase < newdatabase-dump.sql\n        ```\n\n    2. 编辑从my.cnf\n\n        ```sql\n            server-id=2\n            relay-log=/var/log/mysql/mysql-relay-bin.log\n            log_bin=/var/log/mysql/mysql-bin.log\n            binlog_do_db=newdatabase\n        ```\n\n    3. 重启从mysql服务 `service mysqld restart | systemctl restart mysqld`\n\n    4. 设置从mysql连接主mysql\n\n        ```sql\n            CHANGE MASTER TO MASTER_HOST='192.168.1.100',\n            MASTER_USER='slave',\n            MASTER_PASSWORD='slavepassword',\n            MASTER_LOG_FILE='mysql-bin.000001',\n            MASTER_LOG_POS=  107;\n\n            start slave;\n        ```\n\n    5. 查看是否成功\n\n        ```sql\n            SHOW SLAVE STATUS\\G\n\n            # 出现一下 表明已经ok了\n            Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n\n        ```\n\n* 仅作参考, 有问题欢迎拍砖. :)\n","source":"_posts/mysql主从备份.md","raw":"---\ntitle: mysql主从备份\ndate: 2016-09-15 13:45:37\ndesc:\ntags:\n---\n\nMySQL的主从复制配置很简单, 帖子已经很多了, 再不厌其烦的写主要是为了下篇配合zabbix做监控存活做准备.\n\n<!-- more -->\n\n### 先说mysql备份策略\n\n* 冷备份(不能实时备份)\n\n    1. 将mysql的dataDir目录打包scp/rsync 到备份服务器. 优点: 简单暴力. 冷备的缺点, mysql版本一致, 后期数据量大了, 备份越来越久.\n    2. 使用mysqldump, (mysqlcopy, mysqlbackup企业版) 自带工具备份, 有点: 简单, 一条命令就ok, mysql版本能向上兼容, 数据量大, 备份慢.\n\n\n* 热备份(及时备份)\n\n    1. mysql主从复制, 主mysql开启bin-log, 从mysql读取主bin-log文件名和位置, 写入到从库中(mysql版本需要一致)\n    2. inotify+rsync inotify检测文件是否发生变动, 如变动使用rsync备份到远程.(使用所有备份, 不只是mysql业务)\n    3. drbd (分布式块设备) 即时写入.(使用所有备份, 不只是mysql业务)\n\n\n### 配置mysql主从配置.\n\n* 英文好的同学, 直接参照[官方文档](https://dev.mysql.com/doc/refman/5.6/en/replication.html)\n\n* 默认环境\n\n    ```sql\n        192.168.1.100 主mysql5.6\n        192.168.1.101 从mysql5.6\n    ```\n\n* 主mysql配置\n\n    1. 编辑my.cnf. (参考多目录下my.cnf的优先级)\n\n        ```sql\n            bind-address=192.168.1.100\n            server-id=1\n            bin_log=/var/log/mysql/mysql-bin.log\n            binlog_do_db=newdatabase # 需要同步的数据库, 不写, 表示全部库\n        ```\n    2. 添加具有复制权限的用户\n\n        ```sql\n            GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'slave_password';\n            flush privileges; # 刷新权限\n        ```\n\n    3. 重启动mysql服务 `service mysqld restart | systemctl restart mysqld`\n\n    4. 锁定当前主库的数据状态, 将当前数据状态备份到从库中去.\n\n        ```sql\n            USE DATABASE;\n            FLUSH TABLES WITH READ LOCK;\n\n            SHOW MASTER STATUS;\n            +------------------+----------+--------------+------------------+\n            | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n            +------------------+----------+--------------+------------------+\n            | mysql-bin.000001 |      107 | newdatabase  |                  |\n            +------------------+----------+--------------+------------------+\n\n            # 此窗口不要动了(如果有改动, 会自动解除锁), 新开一个窗口, 将数据库导出\n            # 新窗口mysql回话\n            mysqldump -uUsername -pPassword newdatabase > newdatabase-dump.sql\n\n            exit; # 主配置完成, 关闭退出.\n        ```\n\n* 从mysql配置\n\n    1. 导入主mysql数据\n\n        ```sql\n            mysql -uUser -pPassword newdatabase < newdatabase-dump.sql\n        ```\n\n    2. 编辑从my.cnf\n\n        ```sql\n            server-id=2\n            relay-log=/var/log/mysql/mysql-relay-bin.log\n            log_bin=/var/log/mysql/mysql-bin.log\n            binlog_do_db=newdatabase\n        ```\n\n    3. 重启从mysql服务 `service mysqld restart | systemctl restart mysqld`\n\n    4. 设置从mysql连接主mysql\n\n        ```sql\n            CHANGE MASTER TO MASTER_HOST='192.168.1.100',\n            MASTER_USER='slave',\n            MASTER_PASSWORD='slavepassword',\n            MASTER_LOG_FILE='mysql-bin.000001',\n            MASTER_LOG_POS=  107;\n\n            start slave;\n        ```\n\n    5. 查看是否成功\n\n        ```sql\n            SHOW SLAVE STATUS\\G\n\n            # 出现一下 表明已经ok了\n            Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n\n        ```\n\n* 仅作参考, 有问题欢迎拍砖. :)\n","slug":"mysql主从备份","published":1,"updated":"2016-09-15T07:13:28.141Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxu6000h7sqvw3gyyavd","content":"<p>MySQL的主从复制配置很简单, 帖子已经很多了, 再不厌其烦的写主要是为了下篇配合zabbix做监控存活做准备.</p>\n<a id=\"more\"></a>\n<h3 id=\"先说mysql备份策略\"><a href=\"#先说mysql备份策略\" class=\"headerlink\" title=\"先说mysql备份策略\"></a>先说mysql备份策略</h3><ul>\n<li><p>冷备份(不能实时备份)</p>\n<ol>\n<li>将mysql的dataDir目录打包scp/rsync 到备份服务器. 优点: 简单暴力. 冷备的缺点, mysql版本一致, 后期数据量大了, 备份越来越久.</li>\n<li>使用mysqldump, (mysqlcopy, mysqlbackup企业版) 自带工具备份, 有点: 简单, 一条命令就ok, mysql版本能向上兼容, 数据量大, 备份慢.</li>\n</ol>\n</li>\n</ul>\n<ul>\n<li><p>热备份(及时备份)</p>\n<ol>\n<li>mysql主从复制, 主mysql开启bin-log, 从mysql读取主bin-log文件名和位置, 写入到从库中(mysql版本需要一致)</li>\n<li>inotify+rsync inotify检测文件是否发生变动, 如变动使用rsync备份到远程.(使用所有备份, 不只是mysql业务)</li>\n<li>drbd (分布式块设备) 即时写入.(使用所有备份, 不只是mysql业务)</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"配置mysql主从配置\"><a href=\"#配置mysql主从配置\" class=\"headerlink\" title=\"配置mysql主从配置.\"></a>配置mysql主从配置.</h3><ul>\n<li><p>英文好的同学, 直接参照<a href=\"https://dev.mysql.com/doc/refman/5.6/en/replication.html\" target=\"_blank\" rel=\"external\">官方文档</a></p>\n</li>\n<li><p>默认环境</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.100 主mysql5.6</span><br><span class=\"line\">192.168.1.101 从mysql5.6</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>主mysql配置</p>\n<ol>\n<li><p>编辑my.cnf. (参考多目录下my.cnf的优先级)</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bind-address=192.168.1.100</span><br><span class=\"line\">server-id=1</span><br><span class=\"line\">bin_log=/var/log/mysql/mysql-bin.log</span><br><span class=\"line\">binlog_do_db=newdatabase # 需要同步的数据库, 不写, 表示全部库</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加具有复制权限的用户</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'slave_password';</span><br><span class=\"line\">flush privileges; # 刷新权限</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启动mysql服务 <code>service mysqld restart | systemctl restart mysqld</code></p>\n</li>\n<li><p>锁定当前主库的数据状态, 将当前数据状态备份到从库中去.</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USE DATABASE;</span><br><span class=\"line\">FLUSH TABLES WITH READ LOCK;</span><br><span class=\"line\"></span><br><span class=\"line\">SHOW MASTER STATUS;</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\">| mysql-bin.000001 |      107 | newdatabase  |                  |</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\"></span><br><span class=\"line\"># 此窗口不要动了(如果有改动, 会自动解除锁), 新开一个窗口, 将数据库导出</span><br><span class=\"line\"># 新窗口mysql回话</span><br><span class=\"line\">mysqldump -uUsername -pPassword newdatabase &gt; newdatabase-dump.sql</span><br><span class=\"line\"></span><br><span class=\"line\">exit; # 主配置完成, 关闭退出.</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>从mysql配置</p>\n<ol>\n<li><p>导入主mysql数据</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uUser -pPassword newdatabase &lt; newdatabase-dump.sql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编辑从my.cnf</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server-id=2</span><br><span class=\"line\">relay-log=/var/log/mysql/mysql-relay-bin.log</span><br><span class=\"line\">log_bin=/var/log/mysql/mysql-bin.log</span><br><span class=\"line\">binlog_do_db=newdatabase</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启从mysql服务 <code>service mysqld restart | systemctl restart mysqld</code></p>\n</li>\n<li><p>设置从mysql连接主mysql</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> MASTER_HOST=<span class=\"string\">'192.168.1.100'</span>,</span><br><span class=\"line\">MASTER_USER=<span class=\"string\">'slave'</span>,</span><br><span class=\"line\">MASTER_PASSWORD=<span class=\"string\">'slavepassword'</span>,</span><br><span class=\"line\">MASTER_LOG_FILE=<span class=\"string\">'mysql-bin.000001'</span>,</span><br><span class=\"line\">MASTER_LOG_POS=  <span class=\"number\">107</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">start</span> <span class=\"keyword\">slave</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看是否成功</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">SLAVE</span> <span class=\"keyword\">STATUS</span>\\G</span><br><span class=\"line\"></span><br><span class=\"line\"># 出现一下 表明已经ok了</span><br><span class=\"line\">Slave_IO_Running: Yes</span><br><span class=\"line\">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>仅作参考, 有问题欢迎拍砖. :)</p>\n</li>\n</ul>\n","excerpt":"<p>MySQL的主从复制配置很简单, 帖子已经很多了, 再不厌其烦的写主要是为了下篇配合zabbix做监控存活做准备.</p>","more":"<h3 id=\"先说mysql备份策略\"><a href=\"#先说mysql备份策略\" class=\"headerlink\" title=\"先说mysql备份策略\"></a>先说mysql备份策略</h3><ul>\n<li><p>冷备份(不能实时备份)</p>\n<ol>\n<li>将mysql的dataDir目录打包scp/rsync 到备份服务器. 优点: 简单暴力. 冷备的缺点, mysql版本一致, 后期数据量大了, 备份越来越久.</li>\n<li>使用mysqldump, (mysqlcopy, mysqlbackup企业版) 自带工具备份, 有点: 简单, 一条命令就ok, mysql版本能向上兼容, 数据量大, 备份慢.</li>\n</ol>\n</li>\n</ul>\n<ul>\n<li><p>热备份(及时备份)</p>\n<ol>\n<li>mysql主从复制, 主mysql开启bin-log, 从mysql读取主bin-log文件名和位置, 写入到从库中(mysql版本需要一致)</li>\n<li>inotify+rsync inotify检测文件是否发生变动, 如变动使用rsync备份到远程.(使用所有备份, 不只是mysql业务)</li>\n<li>drbd (分布式块设备) 即时写入.(使用所有备份, 不只是mysql业务)</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"配置mysql主从配置\"><a href=\"#配置mysql主从配置\" class=\"headerlink\" title=\"配置mysql主从配置.\"></a>配置mysql主从配置.</h3><ul>\n<li><p>英文好的同学, 直接参照<a href=\"https://dev.mysql.com/doc/refman/5.6/en/replication.html\">官方文档</a></p>\n</li>\n<li><p>默认环境</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.100 主mysql5.6</span><br><span class=\"line\">192.168.1.101 从mysql5.6</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>主mysql配置</p>\n<ol>\n<li><p>编辑my.cnf. (参考多目录下my.cnf的优先级)</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bind-address=192.168.1.100</span><br><span class=\"line\">server-id=1</span><br><span class=\"line\">bin_log=/var/log/mysql/mysql-bin.log</span><br><span class=\"line\">binlog_do_db=newdatabase # 需要同步的数据库, 不写, 表示全部库</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加具有复制权限的用户</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY 'slave_password';</span><br><span class=\"line\">flush privileges; # 刷新权限</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启动mysql服务 <code>service mysqld restart | systemctl restart mysqld</code></p>\n</li>\n<li><p>锁定当前主库的数据状态, 将当前数据状态备份到从库中去.</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USE DATABASE;</span><br><span class=\"line\">FLUSH TABLES WITH READ LOCK;</span><br><span class=\"line\"></span><br><span class=\"line\">SHOW MASTER STATUS;</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\">| mysql-bin.000001 |      107 | newdatabase  |                  |</span><br><span class=\"line\">+------------------+----------+--------------+------------------+</span><br><span class=\"line\"></span><br><span class=\"line\"># 此窗口不要动了(如果有改动, 会自动解除锁), 新开一个窗口, 将数据库导出</span><br><span class=\"line\"># 新窗口mysql回话</span><br><span class=\"line\">mysqldump -uUsername -pPassword newdatabase &gt; newdatabase-dump.sql</span><br><span class=\"line\"></span><br><span class=\"line\">exit; # 主配置完成, 关闭退出.</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>从mysql配置</p>\n<ol>\n<li><p>导入主mysql数据</p>\n <figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uUser -pPassword newdatabase &lt; newdatabase-dump.sql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编辑从my.cnf</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server-id=2</span><br><span class=\"line\">relay-log=/var/log/mysql/mysql-relay-bin.log</span><br><span class=\"line\">log_bin=/var/log/mysql/mysql-bin.log</span><br><span class=\"line\">binlog_do_db=newdatabase</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启从mysql服务 <code>service mysqld restart | systemctl restart mysqld</code></p>\n</li>\n<li><p>设置从mysql连接主mysql</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> MASTER_HOST=<span class=\"string\">'192.168.1.100'</span>,</span><br><span class=\"line\">MASTER_USER=<span class=\"string\">'slave'</span>,</span><br><span class=\"line\">MASTER_PASSWORD=<span class=\"string\">'slavepassword'</span>,</span><br><span class=\"line\">MASTER_LOG_FILE=<span class=\"string\">'mysql-bin.000001'</span>,</span><br><span class=\"line\">MASTER_LOG_POS=  <span class=\"number\">107</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">start</span> <span class=\"keyword\">slave</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看是否成功</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">SLAVE</span> <span class=\"keyword\">STATUS</span>\\G</span><br><span class=\"line\"></span><br><span class=\"line\"># 出现一下 表明已经ok了</span><br><span class=\"line\">Slave_IO_Running: Yes</span><br><span class=\"line\">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>仅作参考, 有问题欢迎拍砖. :)</p>\n</li>\n</ul>"},{"title":"redis数据迁移","date":"2015-07-25T18:40:00.000Z","_content":"\n##### 将数据从本地db1迁移到db2中 ###\n\n很遗憾,redis只有[MOVE](http://redis.io/commands/move)命令,模式: MOVE KEY(需要移动的key) DB(到目标库中),只能单个键值移动,无法批量移动, 实现需要shell脚本\n\n   `redis-cli -n 1 keys '*' | xargs -I '{}' redis-cli -n 1 move '{}' 2`\n\n命令解析\n   * redis-cli -n 1 keys '\\*' 表示获取db1中所有的keys\n   * xargs -I '{}' 表示讲上部操作的结果作为参数,保存在'{}'中, 在执行移动命令: redis-cli -n 1 move '{}' 2 \n\n##### 将数据从本地服务器迁移到另外一台服务器上 ###\n\n很遗憾,也是没有批量处理,只有[MIGRATE](http://redis.io/commands/migrate)命令, MIGRATE HOST(目标主机) PORT(目标端口) KEY(需要移动的key) DISTINATION_DB(目标库中) [COPY(拷贝本地数据,不删除)| REPLACE(覆盖目的主机上的键值) | 不填就等于复制本地后在删除本地数据 ] 只能单个移动,实现\n\n   `redis-cli -n 1 keys '*' | grep regex | xargs -I '{}' redis-cli -n 1 migrate 192.168.1.100 11211 '{}' 2 COPY`","source":"_posts/redis数据迁移.md","raw":"---\ntitle: redis数据迁移\ntags: []\ndate: 2015-07-26 02:40:00\n---\n\n##### 将数据从本地db1迁移到db2中 ###\n\n很遗憾,redis只有[MOVE](http://redis.io/commands/move)命令,模式: MOVE KEY(需要移动的key) DB(到目标库中),只能单个键值移动,无法批量移动, 实现需要shell脚本\n\n   `redis-cli -n 1 keys '*' | xargs -I '{}' redis-cli -n 1 move '{}' 2`\n\n命令解析\n   * redis-cli -n 1 keys '\\*' 表示获取db1中所有的keys\n   * xargs -I '{}' 表示讲上部操作的结果作为参数,保存在'{}'中, 在执行移动命令: redis-cli -n 1 move '{}' 2 \n\n##### 将数据从本地服务器迁移到另外一台服务器上 ###\n\n很遗憾,也是没有批量处理,只有[MIGRATE](http://redis.io/commands/migrate)命令, MIGRATE HOST(目标主机) PORT(目标端口) KEY(需要移动的key) DISTINATION_DB(目标库中) [COPY(拷贝本地数据,不删除)| REPLACE(覆盖目的主机上的键值) | 不填就等于复制本地后在删除本地数据 ] 只能单个移动,实现\n\n   `redis-cli -n 1 keys '*' | grep regex | xargs -I '{}' redis-cli -n 1 migrate 192.168.1.100 11211 '{}' 2 COPY`","slug":"redis数据迁移","published":1,"updated":"2016-09-15T07:13:28.142Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxu6000i7sqvl4dogyhn","content":"<h5 id=\"将数据从本地db1迁移到db2中\"><a href=\"#将数据从本地db1迁移到db2中\" class=\"headerlink\" title=\"将数据从本地db1迁移到db2中\"></a>将数据从本地db1迁移到db2中</h5><p>很遗憾,redis只有<a href=\"http://redis.io/commands/move\" target=\"_blank\" rel=\"external\">MOVE</a>命令,模式: MOVE KEY(需要移动的key) DB(到目标库中),只能单个键值移动,无法批量移动, 实现需要shell脚本</p>\n<p>   <code>redis-cli -n 1 keys &#39;*&#39; | xargs -I &#39;{}&#39; redis-cli -n 1 move &#39;{}&#39; 2</code></p>\n<p>命令解析</p>\n<ul>\n<li>redis-cli -n 1 keys ‘*‘ 表示获取db1中所有的keys</li>\n<li>xargs -I ‘{}’ 表示讲上部操作的结果作为参数,保存在’{}’中, 在执行移动命令: redis-cli -n 1 move ‘{}’ 2 </li>\n</ul>\n<h5 id=\"将数据从本地服务器迁移到另外一台服务器上\"><a href=\"#将数据从本地服务器迁移到另外一台服务器上\" class=\"headerlink\" title=\"将数据从本地服务器迁移到另外一台服务器上\"></a>将数据从本地服务器迁移到另外一台服务器上</h5><p>很遗憾,也是没有批量处理,只有<a href=\"http://redis.io/commands/migrate\" target=\"_blank\" rel=\"external\">MIGRATE</a>命令, MIGRATE HOST(目标主机) PORT(目标端口) KEY(需要移动的key) DISTINATION_DB(目标库中) [COPY(拷贝本地数据,不删除)| REPLACE(覆盖目的主机上的键值) | 不填就等于复制本地后在删除本地数据 ] 只能单个移动,实现</p>\n<p>   <code>redis-cli -n 1 keys &#39;*&#39; | grep regex | xargs -I &#39;{}&#39; redis-cli -n 1 migrate 192.168.1.100 11211 &#39;{}&#39; 2 COPY</code></p>\n","excerpt":"","more":"<h5 id=\"将数据从本地db1迁移到db2中\"><a href=\"#将数据从本地db1迁移到db2中\" class=\"headerlink\" title=\"将数据从本地db1迁移到db2中\"></a>将数据从本地db1迁移到db2中</h5><p>很遗憾,redis只有<a href=\"http://redis.io/commands/move\">MOVE</a>命令,模式: MOVE KEY(需要移动的key) DB(到目标库中),只能单个键值移动,无法批量移动, 实现需要shell脚本</p>\n<p>   <code>redis-cli -n 1 keys &#39;*&#39; | xargs -I &#39;{}&#39; redis-cli -n 1 move &#39;{}&#39; 2</code></p>\n<p>命令解析</p>\n<ul>\n<li>redis-cli -n 1 keys ‘*‘ 表示获取db1中所有的keys</li>\n<li>xargs -I ‘{}’ 表示讲上部操作的结果作为参数,保存在’{}’中, 在执行移动命令: redis-cli -n 1 move ‘{}’ 2 </li>\n</ul>\n<h5 id=\"将数据从本地服务器迁移到另外一台服务器上\"><a href=\"#将数据从本地服务器迁移到另外一台服务器上\" class=\"headerlink\" title=\"将数据从本地服务器迁移到另外一台服务器上\"></a>将数据从本地服务器迁移到另外一台服务器上</h5><p>很遗憾,也是没有批量处理,只有<a href=\"http://redis.io/commands/migrate\">MIGRATE</a>命令, MIGRATE HOST(目标主机) PORT(目标端口) KEY(需要移动的key) DISTINATION_DB(目标库中) [COPY(拷贝本地数据,不删除)| REPLACE(覆盖目的主机上的键值) | 不填就等于复制本地后在删除本地数据 ] 只能单个移动,实现</p>\n<p>   <code>redis-cli -n 1 keys &#39;*&#39; | grep regex | xargs -I &#39;{}&#39; redis-cli -n 1 migrate 192.168.1.100 11211 &#39;{}&#39; 2 COPY</code></p>\n"},{"title":"vagrant搭建lamp开发环境","date":"2016-05-09T05:20:00.000Z","_content":"\n# 使用vagrant快速搭建分享开发环境 #\n\n### 本案列操作环境\n\n1\\. windows7 vagrant1.8.1 virtualbox4.3\n\n### 安装virtualbox4.x(或更高)\n\n1\\. virtualbox, win7下傻瓜式安装, 无需配置, 略过.  \n\n### 安装vagrant\n\n1\\. 下载vagrant软件包 [地址](https://www.vagrantup.com/downloads.html), 安装(windows傻瓜式安装, 不多说).  \n\n2\\. 创建vagrant工程目录, 初始化Vagrantfile.  \n\n        F:\\> mkdir vagrant\n        F:\\> cd vagrant\n        F:\\vagrant>vagrant.exe init\n            A `Vagrantfile` has been placed in this directory. You are now\n            ready to `vagrant up` your first virtual environment! Please read\n            the comments in the Vagrantfile as well as documentation on\n            `vagrantup.com` for more information on using Vagrant.\n\n3\\. 添加box(类似docker的容器), 到[官方源](https://atlas.hashicorp.com/boxes/search)下载需要的box, 本案例下载(puppetlabs/centos-6.6-64-nocm)(https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x.  \n\n        F:\\vagrant>vagrant box add puppetlabs/centos-6.6-64-nocm\n        ==> box: Loading metadata for box 'puppetlabs/centos-6.6-64-nocm'\n            box: URL: https://atlas.hashicorp.com/puppetlabs/centos-6.6-64-nocm\n        This box can work with multiple providers! The providers that it\n        can work with are listed below. Please review the list and choose\n        the provider you will be working with.\n\n        1) virtualbox\n        2) vmware_desktop\n\n        Enter your choice: 1\n        ==> box: Adding box 'puppetlabs/centos-6.6-64-nocm' (v1.0.3) for provider: virtualbox\n            box: Downloading: https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm/versions/1.0.3/providers/virtualbox.box\n            box: Progress: 0% (Rate: 27052/s, Estimated time remaining: 3:23:32)==> box: Waiting for cleanup before exiting...\n\n            box: Progress: 0% (Rate: 23813/s, Estimated time remaining: 3:26:33)\n        ==> box: Box download was interrupted. Exiting.\n\n    ps: 慢的有的一B啊, 果断复制链接, 迅雷下载, 安装*.box文件. 速度还能接受.  \n        ![download](http://images2015.cnblogs.com/blog/451327/201605/451327-20160509131846359-688138673.png)\n\n    box命令略解: `vagrant box add [可选参数] <官方源名称, url链接地址, 下载后的*.box文件>`   \n\n    安装box文件(秒干):  \n\n            F:\\vagrant>vagrant box add --name puppetlabs/centos-6.6-64-nocm  F:\\boxes\\virtualbox.box\n            ==> box: Box file was not detected as metadata. Adding it directly...\n            ==> box: Adding box 'puppetlabs/centos-6.6-64-nocm' (v0) for provider:\n                box: Unpacking necessary files from: file://F:/boxes/virtualbox.box\n                box: Progress: 100% (Rate: 658M/s, Estimated time remaining: --:--:--)\n            ==> box: Successfully added box 'puppetlabs/centos-6.6-64-nocm' (v0) for 'virtualbox'!\n\n4\\. 使用刚下在的box\n\n    1\\. 编辑vagrant工程目录下的Vagrantfile文件  \n\n            15行: config.vm.box = \"puppetlabs/centos-6.6-64-nocm\"\n\n    2\\. 启动vagrant(此处会启动virtualbox, 预先安装virtualbox, win7安装有点小问题, 请自行google或百度解决)  \n\n            vagrant up\n\n    3\\. ssh上去(默认F:/vagrant 自动挂载到/vagrant)上  \n\n            F:\\vagrant>vagrant ssh\n            Last login: Fri May  6 02:33:11 2016 from 10.0.2.2\n            [vagrant@localhost ~]$ ls /\n            bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  sbin  selinux  srv  sys  tmp  usr  vagrant  var\n            [vagrant@localhost ~]$\n\n    4\\. 在/vagrant创建的文件, 会同步到 F:\\>vagrant下.  \n\n### Centos Box 安装lamp环境\n\n> 本案列使用 apache2.4, php5.6.12 mysql5.7 编译安装, 源文件都一打包好, 有需要可以找我要<loovien@163.com>.  \n\n1\\. 默认所有服务安装到/usr/local/webserver目录下.  \n\n2\\. 安装必要的依赖.  \n\n        $ sudo yum groupinstall \"Development tools\"\n\n3\\. apache2.4 编译.  \n\n    1\\. http2.4.x源码包中不含有apr apr-util [下载它们](http://apr.apache.org/download.cgi), 解压到http2.4.x/srclib下.  \n    2\\. 下载pcre-8.3.x.tar.gz, 解压 执行 `./configure && make && make install`.  \n    3\\. 编译apache2.4.x 定位到httpd源码目录, 执行编译`./configure --enable-file-cache --enable-cache --enable-disk-cache --enable-mem-cache --enable-expires --enable-headers --enable-usertrack  --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so --with-include-apr --prefix=/usr/local/webserver`, `make && make install`\n    4\\. 配置httpd DocumentRoot =\\> /vagrant/www目录下.  \n\n4\\. 编译php\n\n    1\\. 安装依赖, 没办法, 编译就是这样, 少了什么依赖就安装什么依赖, 编译安装.  \n\n        $ sudo yum install libxml2 libxml-devel\n        $ ./configure --prefix=/usr/local/webserver/php --with-mysql\n        $ make && make install\n\n5\\. 编译mysql  \n\n    1\\. 完全编译mysql5.5工程量比较大, 本例下载二进制包, [下载](http://dev.mysql.com/downloads/mysql/).  \n    2\\. 解压后查看README文档安装即可\n\n6\\. 运行项目可能需要编译php扩展, 自行安装即可, 使用 `phpize`.  \n\n7\\. 在/etc/rc.local, 添加apache2, mysql 启动命令, 是开机启动.  \n\n### 开发\n\n1\\. 后期自动把项目挂载F:\\vagrant下, 让虚拟box的http Document目录软链接到 /vagrant目录即可.","source":"_posts/vagrant搭建lamp开发环境.md","raw":"---\ntitle: vagrant搭建lamp开发环境\ntags: []\ndate: 2016-05-09 13:20:00\n---\n\n# 使用vagrant快速搭建分享开发环境 #\n\n### 本案列操作环境\n\n1\\. windows7 vagrant1.8.1 virtualbox4.3\n\n### 安装virtualbox4.x(或更高)\n\n1\\. virtualbox, win7下傻瓜式安装, 无需配置, 略过.  \n\n### 安装vagrant\n\n1\\. 下载vagrant软件包 [地址](https://www.vagrantup.com/downloads.html), 安装(windows傻瓜式安装, 不多说).  \n\n2\\. 创建vagrant工程目录, 初始化Vagrantfile.  \n\n        F:\\> mkdir vagrant\n        F:\\> cd vagrant\n        F:\\vagrant>vagrant.exe init\n            A `Vagrantfile` has been placed in this directory. You are now\n            ready to `vagrant up` your first virtual environment! Please read\n            the comments in the Vagrantfile as well as documentation on\n            `vagrantup.com` for more information on using Vagrant.\n\n3\\. 添加box(类似docker的容器), 到[官方源](https://atlas.hashicorp.com/boxes/search)下载需要的box, 本案例下载(puppetlabs/centos-6.6-64-nocm)(https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x.  \n\n        F:\\vagrant>vagrant box add puppetlabs/centos-6.6-64-nocm\n        ==> box: Loading metadata for box 'puppetlabs/centos-6.6-64-nocm'\n            box: URL: https://atlas.hashicorp.com/puppetlabs/centos-6.6-64-nocm\n        This box can work with multiple providers! The providers that it\n        can work with are listed below. Please review the list and choose\n        the provider you will be working with.\n\n        1) virtualbox\n        2) vmware_desktop\n\n        Enter your choice: 1\n        ==> box: Adding box 'puppetlabs/centos-6.6-64-nocm' (v1.0.3) for provider: virtualbox\n            box: Downloading: https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm/versions/1.0.3/providers/virtualbox.box\n            box: Progress: 0% (Rate: 27052/s, Estimated time remaining: 3:23:32)==> box: Waiting for cleanup before exiting...\n\n            box: Progress: 0% (Rate: 23813/s, Estimated time remaining: 3:26:33)\n        ==> box: Box download was interrupted. Exiting.\n\n    ps: 慢的有的一B啊, 果断复制链接, 迅雷下载, 安装*.box文件. 速度还能接受.  \n        ![download](http://images2015.cnblogs.com/blog/451327/201605/451327-20160509131846359-688138673.png)\n\n    box命令略解: `vagrant box add [可选参数] <官方源名称, url链接地址, 下载后的*.box文件>`   \n\n    安装box文件(秒干):  \n\n            F:\\vagrant>vagrant box add --name puppetlabs/centos-6.6-64-nocm  F:\\boxes\\virtualbox.box\n            ==> box: Box file was not detected as metadata. Adding it directly...\n            ==> box: Adding box 'puppetlabs/centos-6.6-64-nocm' (v0) for provider:\n                box: Unpacking necessary files from: file://F:/boxes/virtualbox.box\n                box: Progress: 100% (Rate: 658M/s, Estimated time remaining: --:--:--)\n            ==> box: Successfully added box 'puppetlabs/centos-6.6-64-nocm' (v0) for 'virtualbox'!\n\n4\\. 使用刚下在的box\n\n    1\\. 编辑vagrant工程目录下的Vagrantfile文件  \n\n            15行: config.vm.box = \"puppetlabs/centos-6.6-64-nocm\"\n\n    2\\. 启动vagrant(此处会启动virtualbox, 预先安装virtualbox, win7安装有点小问题, 请自行google或百度解决)  \n\n            vagrant up\n\n    3\\. ssh上去(默认F:/vagrant 自动挂载到/vagrant)上  \n\n            F:\\vagrant>vagrant ssh\n            Last login: Fri May  6 02:33:11 2016 from 10.0.2.2\n            [vagrant@localhost ~]$ ls /\n            bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  sbin  selinux  srv  sys  tmp  usr  vagrant  var\n            [vagrant@localhost ~]$\n\n    4\\. 在/vagrant创建的文件, 会同步到 F:\\>vagrant下.  \n\n### Centos Box 安装lamp环境\n\n> 本案列使用 apache2.4, php5.6.12 mysql5.7 编译安装, 源文件都一打包好, 有需要可以找我要<loovien@163.com>.  \n\n1\\. 默认所有服务安装到/usr/local/webserver目录下.  \n\n2\\. 安装必要的依赖.  \n\n        $ sudo yum groupinstall \"Development tools\"\n\n3\\. apache2.4 编译.  \n\n    1\\. http2.4.x源码包中不含有apr apr-util [下载它们](http://apr.apache.org/download.cgi), 解压到http2.4.x/srclib下.  \n    2\\. 下载pcre-8.3.x.tar.gz, 解压 执行 `./configure && make && make install`.  \n    3\\. 编译apache2.4.x 定位到httpd源码目录, 执行编译`./configure --enable-file-cache --enable-cache --enable-disk-cache --enable-mem-cache --enable-expires --enable-headers --enable-usertrack  --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so --with-include-apr --prefix=/usr/local/webserver`, `make && make install`\n    4\\. 配置httpd DocumentRoot =\\> /vagrant/www目录下.  \n\n4\\. 编译php\n\n    1\\. 安装依赖, 没办法, 编译就是这样, 少了什么依赖就安装什么依赖, 编译安装.  \n\n        $ sudo yum install libxml2 libxml-devel\n        $ ./configure --prefix=/usr/local/webserver/php --with-mysql\n        $ make && make install\n\n5\\. 编译mysql  \n\n    1\\. 完全编译mysql5.5工程量比较大, 本例下载二进制包, [下载](http://dev.mysql.com/downloads/mysql/).  \n    2\\. 解压后查看README文档安装即可\n\n6\\. 运行项目可能需要编译php扩展, 自行安装即可, 使用 `phpize`.  \n\n7\\. 在/etc/rc.local, 添加apache2, mysql 启动命令, 是开机启动.  \n\n### 开发\n\n1\\. 后期自动把项目挂载F:\\vagrant下, 让虚拟box的http Document目录软链接到 /vagrant目录即可.","slug":"vagrant搭建lamp开发环境","published":1,"updated":"2016-09-15T07:13:28.143Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxum000j7sqv9la1nk2s","content":"<h1 id=\"使用vagrant快速搭建分享开发环境\"><a href=\"#使用vagrant快速搭建分享开发环境\" class=\"headerlink\" title=\"使用vagrant快速搭建分享开发环境\"></a>使用vagrant快速搭建分享开发环境</h1><h3 id=\"本案列操作环境\"><a href=\"#本案列操作环境\" class=\"headerlink\" title=\"本案列操作环境\"></a>本案列操作环境</h3><p>1. windows7 vagrant1.8.1 virtualbox4.3</p>\n<h3 id=\"安装virtualbox4-x-或更高\"><a href=\"#安装virtualbox4-x-或更高\" class=\"headerlink\" title=\"安装virtualbox4.x(或更高)\"></a>安装virtualbox4.x(或更高)</h3><p>1. virtualbox, win7下傻瓜式安装, 无需配置, 略过.  </p>\n<h3 id=\"安装vagrant\"><a href=\"#安装vagrant\" class=\"headerlink\" title=\"安装vagrant\"></a>安装vagrant</h3><p>1. 下载vagrant软件包 <a href=\"https://www.vagrantup.com/downloads.html\" target=\"_blank\" rel=\"external\">地址</a>, 安装(windows傻瓜式安装, 不多说).  </p>\n<p>2. 创建vagrant工程目录, 初始化Vagrantfile.  </p>\n<pre><code>F:\\&gt; mkdir vagrant\nF:\\&gt; cd vagrant\nF:\\vagrant&gt;vagrant.exe init\n    A `Vagrantfile` has been placed in this directory. You are now\n    ready to `vagrant up` your first virtual environment! Please read\n    the comments in the Vagrantfile as well as documentation on\n    `vagrantup.com` for more information on using Vagrant.\n</code></pre><p>3. 添加box(类似docker的容器), 到<a href=\"https://atlas.hashicorp.com/boxes/search\" target=\"_blank\" rel=\"external\">官方源</a>下载需要的box, 本案例下载(puppetlabs/centos-6.6-64-nocm)(<a href=\"https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x\" target=\"_blank\" rel=\"external\">https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x</a>.  </p>\n<pre><code>    F:\\vagrant&gt;vagrant box add puppetlabs/centos-6.6-64-nocm\n    ==&gt; box: Loading metadata for box &apos;puppetlabs/centos-6.6-64-nocm&apos;\n        box: URL: https://atlas.hashicorp.com/puppetlabs/centos-6.6-64-nocm\n    This box can work with multiple providers! The providers that it\n    can work with are listed below. Please review the list and choose\n    the provider you will be working with.\n\n    1) virtualbox\n    2) vmware_desktop\n\n    Enter your choice: 1\n    ==&gt; box: Adding box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v1.0.3) for provider: virtualbox\n        box: Downloading: https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm/versions/1.0.3/providers/virtualbox.box\n        box: Progress: 0% (Rate: 27052/s, Estimated time remaining: 3:23:32)==&gt; box: Waiting for cleanup before exiting...\n\n        box: Progress: 0% (Rate: 23813/s, Estimated time remaining: 3:26:33)\n    ==&gt; box: Box download was interrupted. Exiting.\n\nps: 慢的有的一B啊, 果断复制链接, 迅雷下载, 安装*.box文件. 速度还能接受.  \n    ![download](http://images2015.cnblogs.com/blog/451327/201605/451327-20160509131846359-688138673.png)\n\nbox命令略解: `vagrant box add [可选参数] &lt;官方源名称, url链接地址, 下载后的*.box文件&gt;`   \n\n安装box文件(秒干):  \n\n        F:\\vagrant&gt;vagrant box add --name puppetlabs/centos-6.6-64-nocm  F:\\boxes\\virtualbox.box\n        ==&gt; box: Box file was not detected as metadata. Adding it directly...\n        ==&gt; box: Adding box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v0) for provider:\n            box: Unpacking necessary files from: file://F:/boxes/virtualbox.box\n            box: Progress: 100% (Rate: 658M/s, Estimated time remaining: --:--:--)\n        ==&gt; box: Successfully added box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v0) for &apos;virtualbox&apos;!\n</code></pre><p>4. 使用刚下在的box</p>\n<pre><code>1\\. 编辑vagrant工程目录下的Vagrantfile文件  \n\n        15行: config.vm.box = &quot;puppetlabs/centos-6.6-64-nocm&quot;\n\n2\\. 启动vagrant(此处会启动virtualbox, 预先安装virtualbox, win7安装有点小问题, 请自行google或百度解决)  \n\n        vagrant up\n\n3\\. ssh上去(默认F:/vagrant 自动挂载到/vagrant)上  \n\n        F:\\vagrant&gt;vagrant ssh\n        Last login: Fri May  6 02:33:11 2016 from 10.0.2.2\n        [vagrant@localhost ~]$ ls /\n        bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  sbin  selinux  srv  sys  tmp  usr  vagrant  var\n        [vagrant@localhost ~]$\n\n4\\. 在/vagrant创建的文件, 会同步到 F:\\&gt;vagrant下.  \n</code></pre><h3 id=\"Centos-Box-安装lamp环境\"><a href=\"#Centos-Box-安装lamp环境\" class=\"headerlink\" title=\"Centos Box 安装lamp环境\"></a>Centos Box 安装lamp环境</h3><blockquote>\n<p>本案列使用 apache2.4, php5.6.12 mysql5.7 编译安装, 源文件都一打包好, 有需要可以找我要<a href=\"&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#58;&#x6c;&#111;&#111;&#118;&#x69;&#x65;&#110;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;\">&#x6c;&#111;&#111;&#118;&#x69;&#x65;&#110;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;</a>.  </p>\n</blockquote>\n<p>1. 默认所有服务安装到/usr/local/webserver目录下.  </p>\n<p>2. 安装必要的依赖.  </p>\n<pre><code>$ sudo yum groupinstall &quot;Development tools&quot;\n</code></pre><p>3. apache2.4 编译.  </p>\n<pre><code>1\\. http2.4.x源码包中不含有apr apr-util [下载它们](http://apr.apache.org/download.cgi), 解压到http2.4.x/srclib下.  \n2\\. 下载pcre-8.3.x.tar.gz, 解压 执行 `./configure &amp;&amp; make &amp;&amp; make install`.  \n3\\. 编译apache2.4.x 定位到httpd源码目录, 执行编译`./configure --enable-file-cache --enable-cache --enable-disk-cache --enable-mem-cache --enable-expires --enable-headers --enable-usertrack  --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so --with-include-apr --prefix=/usr/local/webserver`, `make &amp;&amp; make install`\n4\\. 配置httpd DocumentRoot =\\&gt; /vagrant/www目录下.  \n</code></pre><p>4. 编译php</p>\n<pre><code>1\\. 安装依赖, 没办法, 编译就是这样, 少了什么依赖就安装什么依赖, 编译安装.  \n\n    $ sudo yum install libxml2 libxml-devel\n    $ ./configure --prefix=/usr/local/webserver/php --with-mysql\n    $ make &amp;&amp; make install\n</code></pre><p>5. 编译mysql  </p>\n<pre><code>1\\. 完全编译mysql5.5工程量比较大, 本例下载二进制包, [下载](http://dev.mysql.com/downloads/mysql/).  \n2\\. 解压后查看README文档安装即可\n</code></pre><p>6. 运行项目可能需要编译php扩展, 自行安装即可, 使用 <code>phpize</code>.  </p>\n<p>7. 在/etc/rc.local, 添加apache2, mysql 启动命令, 是开机启动.  </p>\n<h3 id=\"开发\"><a href=\"#开发\" class=\"headerlink\" title=\"开发\"></a>开发</h3><p>1. 后期自动把项目挂载F:\\vagrant下, 让虚拟box的http Document目录软链接到 /vagrant目录即可.</p>\n","excerpt":"","more":"<h1 id=\"使用vagrant快速搭建分享开发环境\"><a href=\"#使用vagrant快速搭建分享开发环境\" class=\"headerlink\" title=\"使用vagrant快速搭建分享开发环境\"></a>使用vagrant快速搭建分享开发环境</h1><h3 id=\"本案列操作环境\"><a href=\"#本案列操作环境\" class=\"headerlink\" title=\"本案列操作环境\"></a>本案列操作环境</h3><p>1. windows7 vagrant1.8.1 virtualbox4.3</p>\n<h3 id=\"安装virtualbox4-x-或更高\"><a href=\"#安装virtualbox4-x-或更高\" class=\"headerlink\" title=\"安装virtualbox4.x(或更高)\"></a>安装virtualbox4.x(或更高)</h3><p>1. virtualbox, win7下傻瓜式安装, 无需配置, 略过.  </p>\n<h3 id=\"安装vagrant\"><a href=\"#安装vagrant\" class=\"headerlink\" title=\"安装vagrant\"></a>安装vagrant</h3><p>1. 下载vagrant软件包 <a href=\"https://www.vagrantup.com/downloads.html\">地址</a>, 安装(windows傻瓜式安装, 不多说).  </p>\n<p>2. 创建vagrant工程目录, 初始化Vagrantfile.  </p>\n<pre><code>F:\\&gt; mkdir vagrant\nF:\\&gt; cd vagrant\nF:\\vagrant&gt;vagrant.exe init\n    A `Vagrantfile` has been placed in this directory. You are now\n    ready to `vagrant up` your first virtual environment! Please read\n    the comments in the Vagrantfile as well as documentation on\n    `vagrantup.com` for more information on using Vagrant.\n</code></pre><p>3. 添加box(类似docker的容器), 到<a href=\"https://atlas.hashicorp.com/boxes/search\">官方源</a>下载需要的box, 本案例下载(puppetlabs/centos-6.6-64-nocm)(<a href=\"https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x\">https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm),公司服务器是centos6.x</a>.  </p>\n<pre><code>    F:\\vagrant&gt;vagrant box add puppetlabs/centos-6.6-64-nocm\n    ==&gt; box: Loading metadata for box &apos;puppetlabs/centos-6.6-64-nocm&apos;\n        box: URL: https://atlas.hashicorp.com/puppetlabs/centos-6.6-64-nocm\n    This box can work with multiple providers! The providers that it\n    can work with are listed below. Please review the list and choose\n    the provider you will be working with.\n\n    1) virtualbox\n    2) vmware_desktop\n\n    Enter your choice: 1\n    ==&gt; box: Adding box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v1.0.3) for provider: virtualbox\n        box: Downloading: https://atlas.hashicorp.com/puppetlabs/boxes/centos-6.6-64-nocm/versions/1.0.3/providers/virtualbox.box\n        box: Progress: 0% (Rate: 27052/s, Estimated time remaining: 3:23:32)==&gt; box: Waiting for cleanup before exiting...\n\n        box: Progress: 0% (Rate: 23813/s, Estimated time remaining: 3:26:33)\n    ==&gt; box: Box download was interrupted. Exiting.\n\nps: 慢的有的一B啊, 果断复制链接, 迅雷下载, 安装*.box文件. 速度还能接受.  \n    ![download](http://images2015.cnblogs.com/blog/451327/201605/451327-20160509131846359-688138673.png)\n\nbox命令略解: `vagrant box add [可选参数] &lt;官方源名称, url链接地址, 下载后的*.box文件&gt;`   \n\n安装box文件(秒干):  \n\n        F:\\vagrant&gt;vagrant box add --name puppetlabs/centos-6.6-64-nocm  F:\\boxes\\virtualbox.box\n        ==&gt; box: Box file was not detected as metadata. Adding it directly...\n        ==&gt; box: Adding box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v0) for provider:\n            box: Unpacking necessary files from: file://F:/boxes/virtualbox.box\n            box: Progress: 100% (Rate: 658M/s, Estimated time remaining: --:--:--)\n        ==&gt; box: Successfully added box &apos;puppetlabs/centos-6.6-64-nocm&apos; (v0) for &apos;virtualbox&apos;!\n</code></pre><p>4. 使用刚下在的box</p>\n<pre><code>1\\. 编辑vagrant工程目录下的Vagrantfile文件  \n\n        15行: config.vm.box = &quot;puppetlabs/centos-6.6-64-nocm&quot;\n\n2\\. 启动vagrant(此处会启动virtualbox, 预先安装virtualbox, win7安装有点小问题, 请自行google或百度解决)  \n\n        vagrant up\n\n3\\. ssh上去(默认F:/vagrant 自动挂载到/vagrant)上  \n\n        F:\\vagrant&gt;vagrant ssh\n        Last login: Fri May  6 02:33:11 2016 from 10.0.2.2\n        [vagrant@localhost ~]$ ls /\n        bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  sbin  selinux  srv  sys  tmp  usr  vagrant  var\n        [vagrant@localhost ~]$\n\n4\\. 在/vagrant创建的文件, 会同步到 F:\\&gt;vagrant下.  \n</code></pre><h3 id=\"Centos-Box-安装lamp环境\"><a href=\"#Centos-Box-安装lamp环境\" class=\"headerlink\" title=\"Centos Box 安装lamp环境\"></a>Centos Box 安装lamp环境</h3><blockquote>\n<p>本案列使用 apache2.4, php5.6.12 mysql5.7 编译安装, 源文件都一打包好, 有需要可以找我要<a href=\"&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#58;&#x6c;&#111;&#111;&#118;&#x69;&#x65;&#110;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;\">&#x6c;&#111;&#111;&#118;&#x69;&#x65;&#110;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;</a>.  </p>\n</blockquote>\n<p>1. 默认所有服务安装到/usr/local/webserver目录下.  </p>\n<p>2. 安装必要的依赖.  </p>\n<pre><code>$ sudo yum groupinstall &quot;Development tools&quot;\n</code></pre><p>3. apache2.4 编译.  </p>\n<pre><code>1\\. http2.4.x源码包中不含有apr apr-util [下载它们](http://apr.apache.org/download.cgi), 解压到http2.4.x/srclib下.  \n2\\. 下载pcre-8.3.x.tar.gz, 解压 执行 `./configure &amp;&amp; make &amp;&amp; make install`.  \n3\\. 编译apache2.4.x 定位到httpd源码目录, 执行编译`./configure --enable-file-cache --enable-cache --enable-disk-cache --enable-mem-cache --enable-expires --enable-headers --enable-usertrack  --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so --with-include-apr --prefix=/usr/local/webserver`, `make &amp;&amp; make install`\n4\\. 配置httpd DocumentRoot =\\&gt; /vagrant/www目录下.  \n</code></pre><p>4. 编译php</p>\n<pre><code>1\\. 安装依赖, 没办法, 编译就是这样, 少了什么依赖就安装什么依赖, 编译安装.  \n\n    $ sudo yum install libxml2 libxml-devel\n    $ ./configure --prefix=/usr/local/webserver/php --with-mysql\n    $ make &amp;&amp; make install\n</code></pre><p>5. 编译mysql  </p>\n<pre><code>1\\. 完全编译mysql5.5工程量比较大, 本例下载二进制包, [下载](http://dev.mysql.com/downloads/mysql/).  \n2\\. 解压后查看README文档安装即可\n</code></pre><p>6. 运行项目可能需要编译php扩展, 自行安装即可, 使用 <code>phpize</code>.  </p>\n<p>7. 在/etc/rc.local, 添加apache2, mysql 启动命令, 是开机启动.  </p>\n<h3 id=\"开发\"><a href=\"#开发\" class=\"headerlink\" title=\"开发\"></a>开发</h3><p>1. 后期自动把项目挂载F:\\vagrant下, 让虚拟box的http Document目录软链接到 /vagrant目录即可.</p>\n"},{"title":"使用gitbook整合github快速构建文档","date":"2016-09-08T22:17:59.000Z","desc":null,"_content":"\n我们把markdown文档托管到github, 然后使用gitbook格式化后阅读. 感觉还是很酷的. 实例:[reduxjs](http://redux.js.org/). SO 实现这个玩意.\n\n<!-- more -->\n\n1. github新建一个仓库.\n\n2. [gitbook](https://gitbook.com) 新建一个\n\n    ![新建文档](/images/gitbook/0.png)\n\n3. 文档新建好了, 设置同步github仓库.\n\n    ![同步仓库](/images/gitbook/1.png)\n    ![同步](/images/gitbook/2.png)\n\n4. 出现下图后, 说名搞成了, 就这么简单.\n\n    ![ok](/images/gitbook/3.png)\n\n5. 上述操作是建立在你的github帐号已经授权给gitbook帐号读取仓库权限基础上的. 如果没有授权参看网站提示. \n\n6. [原文档](http://help.gitbook.com/github/can-i-host-on-github.html)\n\n\n","source":"_posts/使用gitbook整合github快速构建文档.md","raw":"---\ntitle: 使用gitbook整合github快速构建文档\ndate: 2016-09-09 06:17:59\ndesc:\ntags:\n---\n\n我们把markdown文档托管到github, 然后使用gitbook格式化后阅读. 感觉还是很酷的. 实例:[reduxjs](http://redux.js.org/). SO 实现这个玩意.\n\n<!-- more -->\n\n1. github新建一个仓库.\n\n2. [gitbook](https://gitbook.com) 新建一个\n\n    ![新建文档](/images/gitbook/0.png)\n\n3. 文档新建好了, 设置同步github仓库.\n\n    ![同步仓库](/images/gitbook/1.png)\n    ![同步](/images/gitbook/2.png)\n\n4. 出现下图后, 说名搞成了, 就这么简单.\n\n    ![ok](/images/gitbook/3.png)\n\n5. 上述操作是建立在你的github帐号已经授权给gitbook帐号读取仓库权限基础上的. 如果没有授权参看网站提示. \n\n6. [原文档](http://help.gitbook.com/github/can-i-host-on-github.html)\n\n\n","slug":"使用gitbook整合github快速构建文档","published":1,"updated":"2016-09-15T07:13:28.144Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxum000l7sqvs4nq7jm2","content":"<p>我们把markdown文档托管到github, 然后使用gitbook格式化后阅读. 感觉还是很酷的. 实例:<a href=\"http://redux.js.org/\" target=\"_blank\" rel=\"external\">reduxjs</a>. SO 实现这个玩意.</p>\n<a id=\"more\"></a>\n<ol>\n<li><p>github新建一个仓库.</p>\n</li>\n<li><p><a href=\"https://gitbook.com\" target=\"_blank\" rel=\"external\">gitbook</a> 新建一个</p>\n<p> <img src=\"/images/gitbook/0.png\" alt=\"新建文档\"></p>\n</li>\n<li><p>文档新建好了, 设置同步github仓库.</p>\n<p> <img src=\"/images/gitbook/1.png\" alt=\"同步仓库\"><br> <img src=\"/images/gitbook/2.png\" alt=\"同步\"></p>\n</li>\n<li><p>出现下图后, 说名搞成了, 就这么简单.</p>\n<p> <img src=\"/images/gitbook/3.png\" alt=\"ok\"></p>\n</li>\n<li><p>上述操作是建立在你的github帐号已经授权给gitbook帐号读取仓库权限基础上的. 如果没有授权参看网站提示. </p>\n</li>\n<li><p><a href=\"http://help.gitbook.com/github/can-i-host-on-github.html\" target=\"_blank\" rel=\"external\">原文档</a></p>\n</li>\n</ol>\n","excerpt":"<p>我们把markdown文档托管到github, 然后使用gitbook格式化后阅读. 感觉还是很酷的. 实例:<a href=\"http://redux.js.org/\">reduxjs</a>. SO 实现这个玩意.</p>","more":"<ol>\n<li><p>github新建一个仓库.</p>\n</li>\n<li><p><a href=\"https://gitbook.com\">gitbook</a> 新建一个</p>\n<p> <img src=\"/images/gitbook/0.png\" alt=\"新建文档\"></p>\n</li>\n<li><p>文档新建好了, 设置同步github仓库.</p>\n<p> <img src=\"/images/gitbook/1.png\" alt=\"同步仓库\"><br> <img src=\"/images/gitbook/2.png\" alt=\"同步\"></p>\n</li>\n<li><p>出现下图后, 说名搞成了, 就这么简单.</p>\n<p> <img src=\"/images/gitbook/3.png\" alt=\"ok\"></p>\n</li>\n<li><p>上述操作是建立在你的github帐号已经授权给gitbook帐号读取仓库权限基础上的. 如果没有授权参看网站提示. </p>\n</li>\n<li><p><a href=\"http://help.gitbook.com/github/can-i-host-on-github.html\">原文档</a></p>\n</li>\n</ol>"},{"title":"判断ip是内网还是外网, 判断请求来之pc还是mobile","date":"2015-09-10T07:01:00.000Z","_content":"\n### 判断内网ip ###\n```php\nfunction is_internal_id($ip_address)\n    {\n\n        $get_ip_number = function($ip)\n        {\n            $ip_segment = explode('.', $ip);\n            if(!is_array($ip_segment) || count($ip_segment) != 4)\n                return -1;\n\n            $ip_num = $ip_segment[0] * 256 * 256 * 256 + $ip_segment[1] * 256 * 256 + $ip_segment[2] * 256 + $ip_segment[3];\n            return $ip_num;\n        };\n\n        $process_ip = $get_ip_number($ip_address);\n\n        /**\n         * 私有IP：A类  10.0.0.0    -10.255.255.255\n         *       B类  172.16.0.0  -172.31.255.255\n         *       C类  192.168.0.0 -192.168.255.255\n         *       D类   127.0.0.0   -127.255.255.255(环回地址)\n         */\n        $a_begin = $get_ip_number(\"10.0.0.0\");\n        $a_end = $get_ip_number(\"10.255.255.255\");\n        if($process_ip >= $a_begin && $process_ip <= $a_end)\n            return true;\n\n        $b_begin = $get_ip_number(\"172.16.0.0\");\n        $b_end = $get_ip_number(\"172.31.255.255\");\n        if($process_ip >= $b_begin && $process_ip <= $b_end)\n            return true;\n\n        $c_begin = $get_ip_number(\"192.168.0.0\");\n        $c_end = $get_ip_number(\"192.168.255.255\");\n        if($process_ip >= $c_begin && $process_ip <= $c_end)\n            return true;\n\n        $d_begin = $get_ip_number(\"127.0.0.0\");\n        $d_end = $get_ip_number(\"127.255.255.255\");\n        if($process_ip >= $d_begin && $process_ip <= $d_end)\n            return true;\n\n        return false;\n    }\n```\n### PHP 自带判断私有ip 方法 ###\n\n```php\nfunction is_private_ip($ip) { \n    return !filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); \n} \n```\n### 判断Mobile,还是pc ###\n```php\nfunction ismobile() {\n    $is_mobile = '0';\n\n    if(preg_match('/(android|up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone)/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {\n        $is_mobile=1;\n    }\n\n    if((strpos(strtolower($_SERVER['HTTP_ACCEPT']),'application/vnd.wap.xhtml+xml')>0) or ((isset($_SERVER['HTTP_X_WAP_PROFILE']) or isset($_SERVER['HTTP_PROFILE'])))) {\n        $is_mobile=1;\n    }\n\n    $mobile_ua = strtolower(substr($_SERVER['HTTP_USER_AGENT'],0,4));\n    $mobile_agents = array('w3c ','acs-','alav','alca','amoi','andr','audi','avan','benq','bird','blac','blaz','brew','cell','cldc','cmd-','dang','doco','eric','hipt','inno','ipaq','java','jigs','kddi','keji','leno','lg-c','lg-d','lg-g','lge-','maui','maxo','midp','mits','mmef','mobi','mot-','moto','mwbp','nec-','newt','noki','oper','palm','pana','pant','phil','play','port','prox','qwap','sage','sams','sany','sch-','sec-','send','seri','sgh-','shar','sie-','siem','smal','smar','sony','sph-','symb','t-mo','teli','tim-','tosh','tsm-','upg1','upsi','vk-v','voda','wap-','wapa','wapi','wapp','wapr','webc','winw','winw','xda','xda-');\n\n    if(in_array($mobile_ua,$mobile_agents)) {\n        $is_mobile=1;\n    }\n\n    if (isset($_SERVER['ALL_HTTP'])) {\n        if (strpos(strtolower($_SERVER['ALL_HTTP']),'OperaMini')>0) {\n            $is_mobile=1;\n        }\n    }\n\n    if (strpos(strtolower($_SERVER['HTTP_USER_AGENT']),'windows')>0) {\n        $is_mobile=0;\n    }\n\n    return $is_mobile;\n}\n\nvar_dump(ismobile());\n```","source":"_posts/判断ip是内网还是外网-判断请求来之pc还是mobile.md","raw":"---\ntitle: '判断ip是内网还是外网, 判断请求来之pc还是mobile'\ntags: []\ndate: 2015-09-10 15:01:00\n---\n\n### 判断内网ip ###\n```php\nfunction is_internal_id($ip_address)\n    {\n\n        $get_ip_number = function($ip)\n        {\n            $ip_segment = explode('.', $ip);\n            if(!is_array($ip_segment) || count($ip_segment) != 4)\n                return -1;\n\n            $ip_num = $ip_segment[0] * 256 * 256 * 256 + $ip_segment[1] * 256 * 256 + $ip_segment[2] * 256 + $ip_segment[3];\n            return $ip_num;\n        };\n\n        $process_ip = $get_ip_number($ip_address);\n\n        /**\n         * 私有IP：A类  10.0.0.0    -10.255.255.255\n         *       B类  172.16.0.0  -172.31.255.255\n         *       C类  192.168.0.0 -192.168.255.255\n         *       D类   127.0.0.0   -127.255.255.255(环回地址)\n         */\n        $a_begin = $get_ip_number(\"10.0.0.0\");\n        $a_end = $get_ip_number(\"10.255.255.255\");\n        if($process_ip >= $a_begin && $process_ip <= $a_end)\n            return true;\n\n        $b_begin = $get_ip_number(\"172.16.0.0\");\n        $b_end = $get_ip_number(\"172.31.255.255\");\n        if($process_ip >= $b_begin && $process_ip <= $b_end)\n            return true;\n\n        $c_begin = $get_ip_number(\"192.168.0.0\");\n        $c_end = $get_ip_number(\"192.168.255.255\");\n        if($process_ip >= $c_begin && $process_ip <= $c_end)\n            return true;\n\n        $d_begin = $get_ip_number(\"127.0.0.0\");\n        $d_end = $get_ip_number(\"127.255.255.255\");\n        if($process_ip >= $d_begin && $process_ip <= $d_end)\n            return true;\n\n        return false;\n    }\n```\n### PHP 自带判断私有ip 方法 ###\n\n```php\nfunction is_private_ip($ip) { \n    return !filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); \n} \n```\n### 判断Mobile,还是pc ###\n```php\nfunction ismobile() {\n    $is_mobile = '0';\n\n    if(preg_match('/(android|up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone)/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {\n        $is_mobile=1;\n    }\n\n    if((strpos(strtolower($_SERVER['HTTP_ACCEPT']),'application/vnd.wap.xhtml+xml')>0) or ((isset($_SERVER['HTTP_X_WAP_PROFILE']) or isset($_SERVER['HTTP_PROFILE'])))) {\n        $is_mobile=1;\n    }\n\n    $mobile_ua = strtolower(substr($_SERVER['HTTP_USER_AGENT'],0,4));\n    $mobile_agents = array('w3c ','acs-','alav','alca','amoi','andr','audi','avan','benq','bird','blac','blaz','brew','cell','cldc','cmd-','dang','doco','eric','hipt','inno','ipaq','java','jigs','kddi','keji','leno','lg-c','lg-d','lg-g','lge-','maui','maxo','midp','mits','mmef','mobi','mot-','moto','mwbp','nec-','newt','noki','oper','palm','pana','pant','phil','play','port','prox','qwap','sage','sams','sany','sch-','sec-','send','seri','sgh-','shar','sie-','siem','smal','smar','sony','sph-','symb','t-mo','teli','tim-','tosh','tsm-','upg1','upsi','vk-v','voda','wap-','wapa','wapi','wapp','wapr','webc','winw','winw','xda','xda-');\n\n    if(in_array($mobile_ua,$mobile_agents)) {\n        $is_mobile=1;\n    }\n\n    if (isset($_SERVER['ALL_HTTP'])) {\n        if (strpos(strtolower($_SERVER['ALL_HTTP']),'OperaMini')>0) {\n            $is_mobile=1;\n        }\n    }\n\n    if (strpos(strtolower($_SERVER['HTTP_USER_AGENT']),'windows')>0) {\n        $is_mobile=0;\n    }\n\n    return $is_mobile;\n}\n\nvar_dump(ismobile());\n```","slug":"判断ip是内网还是外网-判断请求来之pc还是mobile","published":1,"updated":"2016-09-15T07:13:28.144Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxum000m7sqvnobok0ce","content":"<h3 id=\"判断内网ip\"><a href=\"#判断内网ip\" class=\"headerlink\" title=\"判断内网ip\"></a>判断内网ip</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_internal_id</span><span class=\"params\">($ip_address)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        $get_ip_number = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">($ip)</span></span><br><span class=\"line\">        </span>&#123;</span><br><span class=\"line\">            $ip_segment = explode(<span class=\"string\">'.'</span>, $ip);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!is_array($ip_segment) || count($ip_segment) != <span class=\"number\">4</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            $ip_num = $ip_segment[<span class=\"number\">0</span>] * <span class=\"number\">256</span> * <span class=\"number\">256</span> * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">1</span>] * <span class=\"number\">256</span> * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">2</span>] * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">3</span>];</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $ip_num;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        $process_ip = $get_ip_number($ip_address);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span><br><span class=\"line\">         * 私有IP：A类  10.0.0.0    -10.255.255.255</span><br><span class=\"line\">         *       B类  172.16.0.0  -172.31.255.255</span><br><span class=\"line\">         *       C类  192.168.0.0 -192.168.255.255</span><br><span class=\"line\">         *       D类   127.0.0.0   -127.255.255.255(环回地址)</span><br><span class=\"line\">         */</span></span><br><span class=\"line\">        $a_begin = $get_ip_number(<span class=\"string\">\"10.0.0.0\"</span>);</span><br><span class=\"line\">        $a_end = $get_ip_number(<span class=\"string\">\"10.255.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $a_begin &amp;&amp; $process_ip &lt;= $a_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $b_begin = $get_ip_number(<span class=\"string\">\"172.16.0.0\"</span>);</span><br><span class=\"line\">        $b_end = $get_ip_number(<span class=\"string\">\"172.31.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $b_begin &amp;&amp; $process_ip &lt;= $b_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $c_begin = $get_ip_number(<span class=\"string\">\"192.168.0.0\"</span>);</span><br><span class=\"line\">        $c_end = $get_ip_number(<span class=\"string\">\"192.168.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $c_begin &amp;&amp; $process_ip &lt;= $c_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $d_begin = $get_ip_number(<span class=\"string\">\"127.0.0.0\"</span>);</span><br><span class=\"line\">        $d_end = $get_ip_number(<span class=\"string\">\"127.255.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $d_begin &amp;&amp; $process_ip &lt;= $d_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"PHP-自带判断私有ip-方法\"><a href=\"#PHP-自带判断私有ip-方法\" class=\"headerlink\" title=\"PHP 自带判断私有ip 方法\"></a>PHP 自带判断私有ip 方法</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_private_ip</span><span class=\"params\">($ip)</span> </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> !filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"判断Mobile-还是pc\"><a href=\"#判断Mobile-还是pc\" class=\"headerlink\" title=\"判断Mobile,还是pc\"></a>判断Mobile,还是pc</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ismobile</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    $is_mobile = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/(android|up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone)/i'</span>, strtolower($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>]))) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>((strpos(strtolower($_SERVER[<span class=\"string\">'HTTP_ACCEPT'</span>]),<span class=\"string\">'application/vnd.wap.xhtml+xml'</span>)&gt;<span class=\"number\">0</span>) <span class=\"keyword\">or</span> ((<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_X_WAP_PROFILE'</span>]) <span class=\"keyword\">or</span> <span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_PROFILE'</span>])))) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $mobile_ua = strtolower(substr($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>],<span class=\"number\">0</span>,<span class=\"number\">4</span>));</span><br><span class=\"line\">    $mobile_agents = <span class=\"keyword\">array</span>(<span class=\"string\">'w3c '</span>,<span class=\"string\">'acs-'</span>,<span class=\"string\">'alav'</span>,<span class=\"string\">'alca'</span>,<span class=\"string\">'amoi'</span>,<span class=\"string\">'andr'</span>,<span class=\"string\">'audi'</span>,<span class=\"string\">'avan'</span>,<span class=\"string\">'benq'</span>,<span class=\"string\">'bird'</span>,<span class=\"string\">'blac'</span>,<span class=\"string\">'blaz'</span>,<span class=\"string\">'brew'</span>,<span class=\"string\">'cell'</span>,<span class=\"string\">'cldc'</span>,<span class=\"string\">'cmd-'</span>,<span class=\"string\">'dang'</span>,<span class=\"string\">'doco'</span>,<span class=\"string\">'eric'</span>,<span class=\"string\">'hipt'</span>,<span class=\"string\">'inno'</span>,<span class=\"string\">'ipaq'</span>,<span class=\"string\">'java'</span>,<span class=\"string\">'jigs'</span>,<span class=\"string\">'kddi'</span>,<span class=\"string\">'keji'</span>,<span class=\"string\">'leno'</span>,<span class=\"string\">'lg-c'</span>,<span class=\"string\">'lg-d'</span>,<span class=\"string\">'lg-g'</span>,<span class=\"string\">'lge-'</span>,<span class=\"string\">'maui'</span>,<span class=\"string\">'maxo'</span>,<span class=\"string\">'midp'</span>,<span class=\"string\">'mits'</span>,<span class=\"string\">'mmef'</span>,<span class=\"string\">'mobi'</span>,<span class=\"string\">'mot-'</span>,<span class=\"string\">'moto'</span>,<span class=\"string\">'mwbp'</span>,<span class=\"string\">'nec-'</span>,<span class=\"string\">'newt'</span>,<span class=\"string\">'noki'</span>,<span class=\"string\">'oper'</span>,<span class=\"string\">'palm'</span>,<span class=\"string\">'pana'</span>,<span class=\"string\">'pant'</span>,<span class=\"string\">'phil'</span>,<span class=\"string\">'play'</span>,<span class=\"string\">'port'</span>,<span class=\"string\">'prox'</span>,<span class=\"string\">'qwap'</span>,<span class=\"string\">'sage'</span>,<span class=\"string\">'sams'</span>,<span class=\"string\">'sany'</span>,<span class=\"string\">'sch-'</span>,<span class=\"string\">'sec-'</span>,<span class=\"string\">'send'</span>,<span class=\"string\">'seri'</span>,<span class=\"string\">'sgh-'</span>,<span class=\"string\">'shar'</span>,<span class=\"string\">'sie-'</span>,<span class=\"string\">'siem'</span>,<span class=\"string\">'smal'</span>,<span class=\"string\">'smar'</span>,<span class=\"string\">'sony'</span>,<span class=\"string\">'sph-'</span>,<span class=\"string\">'symb'</span>,<span class=\"string\">'t-mo'</span>,<span class=\"string\">'teli'</span>,<span class=\"string\">'tim-'</span>,<span class=\"string\">'tosh'</span>,<span class=\"string\">'tsm-'</span>,<span class=\"string\">'upg1'</span>,<span class=\"string\">'upsi'</span>,<span class=\"string\">'vk-v'</span>,<span class=\"string\">'voda'</span>,<span class=\"string\">'wap-'</span>,<span class=\"string\">'wapa'</span>,<span class=\"string\">'wapi'</span>,<span class=\"string\">'wapp'</span>,<span class=\"string\">'wapr'</span>,<span class=\"string\">'webc'</span>,<span class=\"string\">'winw'</span>,<span class=\"string\">'winw'</span>,<span class=\"string\">'xda'</span>,<span class=\"string\">'xda-'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(in_array($mobile_ua,$mobile_agents)) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'ALL_HTTP'</span>])) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strpos(strtolower($_SERVER[<span class=\"string\">'ALL_HTTP'</span>]),<span class=\"string\">'OperaMini'</span>)&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strpos(strtolower($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>]),<span class=\"string\">'windows'</span>)&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $is_mobile;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(ismobile());</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h3 id=\"判断内网ip\"><a href=\"#判断内网ip\" class=\"headerlink\" title=\"判断内网ip\"></a>判断内网ip</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_internal_id</span><span class=\"params\">($ip_address)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        $get_ip_number = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">($ip)</span></span><br><span class=\"line\">        </span>&#123;</span><br><span class=\"line\">            $ip_segment = explode(<span class=\"string\">'.'</span>, $ip);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!is_array($ip_segment) || count($ip_segment) != <span class=\"number\">4</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            $ip_num = $ip_segment[<span class=\"number\">0</span>] * <span class=\"number\">256</span> * <span class=\"number\">256</span> * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">1</span>] * <span class=\"number\">256</span> * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">2</span>] * <span class=\"number\">256</span> + $ip_segment[<span class=\"number\">3</span>];</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $ip_num;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        $process_ip = $get_ip_number($ip_address);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span><br><span class=\"line\">         * 私有IP：A类  10.0.0.0    -10.255.255.255</span><br><span class=\"line\">         *       B类  172.16.0.0  -172.31.255.255</span><br><span class=\"line\">         *       C类  192.168.0.0 -192.168.255.255</span><br><span class=\"line\">         *       D类   127.0.0.0   -127.255.255.255(环回地址)</span><br><span class=\"line\">         */</span></span><br><span class=\"line\">        $a_begin = $get_ip_number(<span class=\"string\">\"10.0.0.0\"</span>);</span><br><span class=\"line\">        $a_end = $get_ip_number(<span class=\"string\">\"10.255.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $a_begin &amp;&amp; $process_ip &lt;= $a_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $b_begin = $get_ip_number(<span class=\"string\">\"172.16.0.0\"</span>);</span><br><span class=\"line\">        $b_end = $get_ip_number(<span class=\"string\">\"172.31.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $b_begin &amp;&amp; $process_ip &lt;= $b_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $c_begin = $get_ip_number(<span class=\"string\">\"192.168.0.0\"</span>);</span><br><span class=\"line\">        $c_end = $get_ip_number(<span class=\"string\">\"192.168.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $c_begin &amp;&amp; $process_ip &lt;= $c_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $d_begin = $get_ip_number(<span class=\"string\">\"127.0.0.0\"</span>);</span><br><span class=\"line\">        $d_end = $get_ip_number(<span class=\"string\">\"127.255.255.255\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($process_ip &gt;= $d_begin &amp;&amp; $process_ip &lt;= $d_end)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"PHP-自带判断私有ip-方法\"><a href=\"#PHP-自带判断私有ip-方法\" class=\"headerlink\" title=\"PHP 自带判断私有ip 方法\"></a>PHP 自带判断私有ip 方法</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_private_ip</span><span class=\"params\">($ip)</span> </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> !filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"判断Mobile-还是pc\"><a href=\"#判断Mobile-还是pc\" class=\"headerlink\" title=\"判断Mobile,还是pc\"></a>判断Mobile,还是pc</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ismobile</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    $is_mobile = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/(android|up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone)/i'</span>, strtolower($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>]))) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>((strpos(strtolower($_SERVER[<span class=\"string\">'HTTP_ACCEPT'</span>]),<span class=\"string\">'application/vnd.wap.xhtml+xml'</span>)&gt;<span class=\"number\">0</span>) <span class=\"keyword\">or</span> ((<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_X_WAP_PROFILE'</span>]) <span class=\"keyword\">or</span> <span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_PROFILE'</span>])))) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $mobile_ua = strtolower(substr($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>],<span class=\"number\">0</span>,<span class=\"number\">4</span>));</span><br><span class=\"line\">    $mobile_agents = <span class=\"keyword\">array</span>(<span class=\"string\">'w3c '</span>,<span class=\"string\">'acs-'</span>,<span class=\"string\">'alav'</span>,<span class=\"string\">'alca'</span>,<span class=\"string\">'amoi'</span>,<span class=\"string\">'andr'</span>,<span class=\"string\">'audi'</span>,<span class=\"string\">'avan'</span>,<span class=\"string\">'benq'</span>,<span class=\"string\">'bird'</span>,<span class=\"string\">'blac'</span>,<span class=\"string\">'blaz'</span>,<span class=\"string\">'brew'</span>,<span class=\"string\">'cell'</span>,<span class=\"string\">'cldc'</span>,<span class=\"string\">'cmd-'</span>,<span class=\"string\">'dang'</span>,<span class=\"string\">'doco'</span>,<span class=\"string\">'eric'</span>,<span class=\"string\">'hipt'</span>,<span class=\"string\">'inno'</span>,<span class=\"string\">'ipaq'</span>,<span class=\"string\">'java'</span>,<span class=\"string\">'jigs'</span>,<span class=\"string\">'kddi'</span>,<span class=\"string\">'keji'</span>,<span class=\"string\">'leno'</span>,<span class=\"string\">'lg-c'</span>,<span class=\"string\">'lg-d'</span>,<span class=\"string\">'lg-g'</span>,<span class=\"string\">'lge-'</span>,<span class=\"string\">'maui'</span>,<span class=\"string\">'maxo'</span>,<span class=\"string\">'midp'</span>,<span class=\"string\">'mits'</span>,<span class=\"string\">'mmef'</span>,<span class=\"string\">'mobi'</span>,<span class=\"string\">'mot-'</span>,<span class=\"string\">'moto'</span>,<span class=\"string\">'mwbp'</span>,<span class=\"string\">'nec-'</span>,<span class=\"string\">'newt'</span>,<span class=\"string\">'noki'</span>,<span class=\"string\">'oper'</span>,<span class=\"string\">'palm'</span>,<span class=\"string\">'pana'</span>,<span class=\"string\">'pant'</span>,<span class=\"string\">'phil'</span>,<span class=\"string\">'play'</span>,<span class=\"string\">'port'</span>,<span class=\"string\">'prox'</span>,<span class=\"string\">'qwap'</span>,<span class=\"string\">'sage'</span>,<span class=\"string\">'sams'</span>,<span class=\"string\">'sany'</span>,<span class=\"string\">'sch-'</span>,<span class=\"string\">'sec-'</span>,<span class=\"string\">'send'</span>,<span class=\"string\">'seri'</span>,<span class=\"string\">'sgh-'</span>,<span class=\"string\">'shar'</span>,<span class=\"string\">'sie-'</span>,<span class=\"string\">'siem'</span>,<span class=\"string\">'smal'</span>,<span class=\"string\">'smar'</span>,<span class=\"string\">'sony'</span>,<span class=\"string\">'sph-'</span>,<span class=\"string\">'symb'</span>,<span class=\"string\">'t-mo'</span>,<span class=\"string\">'teli'</span>,<span class=\"string\">'tim-'</span>,<span class=\"string\">'tosh'</span>,<span class=\"string\">'tsm-'</span>,<span class=\"string\">'upg1'</span>,<span class=\"string\">'upsi'</span>,<span class=\"string\">'vk-v'</span>,<span class=\"string\">'voda'</span>,<span class=\"string\">'wap-'</span>,<span class=\"string\">'wapa'</span>,<span class=\"string\">'wapi'</span>,<span class=\"string\">'wapp'</span>,<span class=\"string\">'wapr'</span>,<span class=\"string\">'webc'</span>,<span class=\"string\">'winw'</span>,<span class=\"string\">'winw'</span>,<span class=\"string\">'xda'</span>,<span class=\"string\">'xda-'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(in_array($mobile_ua,$mobile_agents)) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'ALL_HTTP'</span>])) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strpos(strtolower($_SERVER[<span class=\"string\">'ALL_HTTP'</span>]),<span class=\"string\">'OperaMini'</span>)&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            $is_mobile=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strpos(strtolower($_SERVER[<span class=\"string\">'HTTP_USER_AGENT'</span>]),<span class=\"string\">'windows'</span>)&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        $is_mobile=<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $is_mobile;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(ismobile());</span><br></pre></td></tr></table></figure>"},{"title":"如何实现6位数表示百亿","date":"2016-05-30T03:47:46.000Z","_content":"\n场景: 只能用6位数, 要表示0~百亿区间的数. etc. xabdex => 2000000000.\n<!-- more -->\n\n### 理解进制\n\n二进制, 逢2进1. `101 => 1x2^2 + 0x2^1 + 1x2^0 = 5` 二进制3为才能表示10进制的1位数.  \n16进制, 逢16进1. `101 => 1x16^2 + 0x16^1 + 1x16^0 = 257` 16进制101表示到了257.  \n\n64进制, 逢64进1. `101 => 1x64^2 + 0x64^1 + 1x64^0 = 4160` 64进制三位表示到了4位数, 就是我们想要的.  \n\n\n### 实现(php)\n\n```php\nclass UIDUtils\n{\n\n    /**\n     * 用户唯一表示长度\n     */\n    const CODE_LENGTH = 6;\n\n\n    /**\n     * if number is negative prefix with zero\n     *\n     */\n    private static $negative = 0;\n\n    /**\n     * this character presentation zero\n     */\n    private static $zeroCharacter = [ 'J', 'q', 's', 'T', 'U', 'E'];\n\n    /**\n     * code dictionary\n     */\n    private static $dictionary = [\n          0 => 'K',\n          1 => 'v',\n          2 => 'F',\n          3 => 'm',\n          4 => 'u',\n          5 => 'B',\n          6 => 'S',\n          7 => 'n',\n          8 => 'Y',\n          9 => 'e',\n          10 => 'O',\n          11 => 'd',\n          12 => 'A',\n          13 => 'j',\n          14 => 'x',\n          15 => 'y',\n          16 => 'V',\n          17 => 'X',\n          18 => 'b',\n          19 => 'W',\n          20 => 'Q',\n          21 => 'P',\n          22 => 'z',\n          23 => 't',\n          24 => 'r',\n          25 => 'Z',\n          26 => 'R',\n          27 => 'w',\n          28 => 'c',\n          29 => 'p',\n          30 => 'I',\n          31 => 'G',\n          32 => 'k',\n          33 => 'C',\n          34 => 'h',\n          35 => 'f',\n          36 => 'l',\n          37 => 'i',\n          38 => 'o',\n          39 => 'N',\n          40 => 'L',\n          41 => 'M',\n          42 => 'D',\n          43 => 'a',\n          44 => 'g',\n          45 => 'H',\n    ];\n\n    /**\n     * encrypt function get code\n     *\n     * @param $number\n     * @return string\n     * @throws \\Error\n     */\n    public static function encode($number)\n    {\n        $encodeString = '';\n        $numberType = $number < 0  ? true : false;\n\n        $dictionaryLength = count(self::$dictionary);\n\n        while($number > $dictionaryLength)\n        {\n            $encodeString = self::$dictionary[abs($number % $dictionaryLength)] . $encodeString;\n            $number = floor($number / $dictionaryLength);\n        }\n        if($number > 0)\n            $encodeString = self::$dictionary[$number] . $encodeString;\n\n        $encodeStringLength = strlen($encodeString);\n        $padStringLength = self::CODE_LENGTH - $encodeStringLength;\n\n\n        // if number is negative number and encode length is six. number overflow\n        if(($numberType && $padStringLength < 1) || (!$numberType && $padStringLength < 0))\n            throw new \\Error(\"加密数字溢出....\");\n\n        // if number is positive and encode length is six. just return it.\n        if($padStringLength == 0)\n            return $encodeString;\n\n        // if number is positive and encode length small than six. pad random character left.\n        shuffle(self::$zeroCharacter);\n\n        if($numberType)\n            $resultEncodeString = self::$negative . implode(array_slice(self::$zeroCharacter, 0, $padStringLength + 1)) . $encodeString;\n        else\n            $resultEncodeString = implode(array_slice(self::$zeroCharacter, 0, $padStringLength)) . $encodeString;\n\n        return $resultEncodeString;\n    }\n\n    /**\n     *  decode string to number value\n     *\n     * @param $string\n     * @return int\n     * @throws \\Error\n     */\n    public static function decode($string)\n    {\n        $numberValue = 0;\n        $dictionaryLength = count(self::$dictionary);\n        $decodeArr = array_reverse(str_split($string));\n\n        if(count($decodeArr) != self::CODE_LENGTH)\n            throw new \\Error(\"字符长度错误.\");\n\n        $dictionaryNumberMap = array_flip(self::$dictionary);\n        foreach($decodeArr as $key => $value)\n        {\n            if(in_array($value, self::$zeroCharacter))\n                continue;\n            $numberValue += $dictionaryNumberMap[$value] * pow($dictionaryLength, $key);\n        }\n        return $numberValue;\n    }\n\n$number = 10000000;\n\n$string = UIDUtils::encode($number);\nvar_dump($string);\n\n$number = UIDUtils::decode($string);\nvar_dump($number);\n\n```\n\n### 思路很重要, 实现很简单.\n\n\n\n\n\n","source":"_posts/如何实现6位数表示百亿.md","raw":"---\ntitle: 如何实现6位数表示百亿\ndate: 2016-05-30 11:47:46\ntags:\n---\n\n场景: 只能用6位数, 要表示0~百亿区间的数. etc. xabdex => 2000000000.\n<!-- more -->\n\n### 理解进制\n\n二进制, 逢2进1. `101 => 1x2^2 + 0x2^1 + 1x2^0 = 5` 二进制3为才能表示10进制的1位数.  \n16进制, 逢16进1. `101 => 1x16^2 + 0x16^1 + 1x16^0 = 257` 16进制101表示到了257.  \n\n64进制, 逢64进1. `101 => 1x64^2 + 0x64^1 + 1x64^0 = 4160` 64进制三位表示到了4位数, 就是我们想要的.  \n\n\n### 实现(php)\n\n```php\nclass UIDUtils\n{\n\n    /**\n     * 用户唯一表示长度\n     */\n    const CODE_LENGTH = 6;\n\n\n    /**\n     * if number is negative prefix with zero\n     *\n     */\n    private static $negative = 0;\n\n    /**\n     * this character presentation zero\n     */\n    private static $zeroCharacter = [ 'J', 'q', 's', 'T', 'U', 'E'];\n\n    /**\n     * code dictionary\n     */\n    private static $dictionary = [\n          0 => 'K',\n          1 => 'v',\n          2 => 'F',\n          3 => 'm',\n          4 => 'u',\n          5 => 'B',\n          6 => 'S',\n          7 => 'n',\n          8 => 'Y',\n          9 => 'e',\n          10 => 'O',\n          11 => 'd',\n          12 => 'A',\n          13 => 'j',\n          14 => 'x',\n          15 => 'y',\n          16 => 'V',\n          17 => 'X',\n          18 => 'b',\n          19 => 'W',\n          20 => 'Q',\n          21 => 'P',\n          22 => 'z',\n          23 => 't',\n          24 => 'r',\n          25 => 'Z',\n          26 => 'R',\n          27 => 'w',\n          28 => 'c',\n          29 => 'p',\n          30 => 'I',\n          31 => 'G',\n          32 => 'k',\n          33 => 'C',\n          34 => 'h',\n          35 => 'f',\n          36 => 'l',\n          37 => 'i',\n          38 => 'o',\n          39 => 'N',\n          40 => 'L',\n          41 => 'M',\n          42 => 'D',\n          43 => 'a',\n          44 => 'g',\n          45 => 'H',\n    ];\n\n    /**\n     * encrypt function get code\n     *\n     * @param $number\n     * @return string\n     * @throws \\Error\n     */\n    public static function encode($number)\n    {\n        $encodeString = '';\n        $numberType = $number < 0  ? true : false;\n\n        $dictionaryLength = count(self::$dictionary);\n\n        while($number > $dictionaryLength)\n        {\n            $encodeString = self::$dictionary[abs($number % $dictionaryLength)] . $encodeString;\n            $number = floor($number / $dictionaryLength);\n        }\n        if($number > 0)\n            $encodeString = self::$dictionary[$number] . $encodeString;\n\n        $encodeStringLength = strlen($encodeString);\n        $padStringLength = self::CODE_LENGTH - $encodeStringLength;\n\n\n        // if number is negative number and encode length is six. number overflow\n        if(($numberType && $padStringLength < 1) || (!$numberType && $padStringLength < 0))\n            throw new \\Error(\"加密数字溢出....\");\n\n        // if number is positive and encode length is six. just return it.\n        if($padStringLength == 0)\n            return $encodeString;\n\n        // if number is positive and encode length small than six. pad random character left.\n        shuffle(self::$zeroCharacter);\n\n        if($numberType)\n            $resultEncodeString = self::$negative . implode(array_slice(self::$zeroCharacter, 0, $padStringLength + 1)) . $encodeString;\n        else\n            $resultEncodeString = implode(array_slice(self::$zeroCharacter, 0, $padStringLength)) . $encodeString;\n\n        return $resultEncodeString;\n    }\n\n    /**\n     *  decode string to number value\n     *\n     * @param $string\n     * @return int\n     * @throws \\Error\n     */\n    public static function decode($string)\n    {\n        $numberValue = 0;\n        $dictionaryLength = count(self::$dictionary);\n        $decodeArr = array_reverse(str_split($string));\n\n        if(count($decodeArr) != self::CODE_LENGTH)\n            throw new \\Error(\"字符长度错误.\");\n\n        $dictionaryNumberMap = array_flip(self::$dictionary);\n        foreach($decodeArr as $key => $value)\n        {\n            if(in_array($value, self::$zeroCharacter))\n                continue;\n            $numberValue += $dictionaryNumberMap[$value] * pow($dictionaryLength, $key);\n        }\n        return $numberValue;\n    }\n\n$number = 10000000;\n\n$string = UIDUtils::encode($number);\nvar_dump($string);\n\n$number = UIDUtils::decode($string);\nvar_dump($number);\n\n```\n\n### 思路很重要, 实现很简单.\n\n\n\n\n\n","slug":"如何实现6位数表示百亿","published":1,"updated":"2016-09-15T07:13:28.145Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxum000n7sqvjzgh5adn","content":"<p>场景: 只能用6位数, 要表示0~百亿区间的数. etc. xabdex =&gt; 2000000000.<br><a id=\"more\"></a></p>\n<h3 id=\"理解进制\"><a href=\"#理解进制\" class=\"headerlink\" title=\"理解进制\"></a>理解进制</h3><p>二进制, 逢2进1. <code>101 =&gt; 1x2^2 + 0x2^1 + 1x2^0 = 5</code> 二进制3为才能表示10进制的1位数.<br>16进制, 逢16进1. <code>101 =&gt; 1x16^2 + 0x16^1 + 1x16^0 = 257</code> 16进制101表示到了257.  </p>\n<p>64进制, 逢64进1. <code>101 =&gt; 1x64^2 + 0x64^1 + 1x64^0 = 4160</code> 64进制三位表示到了4位数, 就是我们想要的.  </p>\n<h3 id=\"实现-php\"><a href=\"#实现-php\" class=\"headerlink\" title=\"实现(php)\"></a>实现(php)</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UIDUtils</span></span><br><span class=\"line\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * 用户唯一表示长度</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> CODE_LENGTH = <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * if number is negative prefix with zero</span><br><span class=\"line\">     *</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $negative = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * this character presentation zero</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $zeroCharacter = [ <span class=\"string\">'J'</span>, <span class=\"string\">'q'</span>, <span class=\"string\">'s'</span>, <span class=\"string\">'T'</span>, <span class=\"string\">'U'</span>, <span class=\"string\">'E'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * code dictionary</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $dictionary = [</span><br><span class=\"line\">          <span class=\"number\">0</span> =&gt; <span class=\"string\">'K'</span>,</span><br><span class=\"line\">          <span class=\"number\">1</span> =&gt; <span class=\"string\">'v'</span>,</span><br><span class=\"line\">          <span class=\"number\">2</span> =&gt; <span class=\"string\">'F'</span>,</span><br><span class=\"line\">          <span class=\"number\">3</span> =&gt; <span class=\"string\">'m'</span>,</span><br><span class=\"line\">          <span class=\"number\">4</span> =&gt; <span class=\"string\">'u'</span>,</span><br><span class=\"line\">          <span class=\"number\">5</span> =&gt; <span class=\"string\">'B'</span>,</span><br><span class=\"line\">          <span class=\"number\">6</span> =&gt; <span class=\"string\">'S'</span>,</span><br><span class=\"line\">          <span class=\"number\">7</span> =&gt; <span class=\"string\">'n'</span>,</span><br><span class=\"line\">          <span class=\"number\">8</span> =&gt; <span class=\"string\">'Y'</span>,</span><br><span class=\"line\">          <span class=\"number\">9</span> =&gt; <span class=\"string\">'e'</span>,</span><br><span class=\"line\">          <span class=\"number\">10</span> =&gt; <span class=\"string\">'O'</span>,</span><br><span class=\"line\">          <span class=\"number\">11</span> =&gt; <span class=\"string\">'d'</span>,</span><br><span class=\"line\">          <span class=\"number\">12</span> =&gt; <span class=\"string\">'A'</span>,</span><br><span class=\"line\">          <span class=\"number\">13</span> =&gt; <span class=\"string\">'j'</span>,</span><br><span class=\"line\">          <span class=\"number\">14</span> =&gt; <span class=\"string\">'x'</span>,</span><br><span class=\"line\">          <span class=\"number\">15</span> =&gt; <span class=\"string\">'y'</span>,</span><br><span class=\"line\">          <span class=\"number\">16</span> =&gt; <span class=\"string\">'V'</span>,</span><br><span class=\"line\">          <span class=\"number\">17</span> =&gt; <span class=\"string\">'X'</span>,</span><br><span class=\"line\">          <span class=\"number\">18</span> =&gt; <span class=\"string\">'b'</span>,</span><br><span class=\"line\">          <span class=\"number\">19</span> =&gt; <span class=\"string\">'W'</span>,</span><br><span class=\"line\">          <span class=\"number\">20</span> =&gt; <span class=\"string\">'Q'</span>,</span><br><span class=\"line\">          <span class=\"number\">21</span> =&gt; <span class=\"string\">'P'</span>,</span><br><span class=\"line\">          <span class=\"number\">22</span> =&gt; <span class=\"string\">'z'</span>,</span><br><span class=\"line\">          <span class=\"number\">23</span> =&gt; <span class=\"string\">'t'</span>,</span><br><span class=\"line\">          <span class=\"number\">24</span> =&gt; <span class=\"string\">'r'</span>,</span><br><span class=\"line\">          <span class=\"number\">25</span> =&gt; <span class=\"string\">'Z'</span>,</span><br><span class=\"line\">          <span class=\"number\">26</span> =&gt; <span class=\"string\">'R'</span>,</span><br><span class=\"line\">          <span class=\"number\">27</span> =&gt; <span class=\"string\">'w'</span>,</span><br><span class=\"line\">          <span class=\"number\">28</span> =&gt; <span class=\"string\">'c'</span>,</span><br><span class=\"line\">          <span class=\"number\">29</span> =&gt; <span class=\"string\">'p'</span>,</span><br><span class=\"line\">          <span class=\"number\">30</span> =&gt; <span class=\"string\">'I'</span>,</span><br><span class=\"line\">          <span class=\"number\">31</span> =&gt; <span class=\"string\">'G'</span>,</span><br><span class=\"line\">          <span class=\"number\">32</span> =&gt; <span class=\"string\">'k'</span>,</span><br><span class=\"line\">          <span class=\"number\">33</span> =&gt; <span class=\"string\">'C'</span>,</span><br><span class=\"line\">          <span class=\"number\">34</span> =&gt; <span class=\"string\">'h'</span>,</span><br><span class=\"line\">          <span class=\"number\">35</span> =&gt; <span class=\"string\">'f'</span>,</span><br><span class=\"line\">          <span class=\"number\">36</span> =&gt; <span class=\"string\">'l'</span>,</span><br><span class=\"line\">          <span class=\"number\">37</span> =&gt; <span class=\"string\">'i'</span>,</span><br><span class=\"line\">          <span class=\"number\">38</span> =&gt; <span class=\"string\">'o'</span>,</span><br><span class=\"line\">          <span class=\"number\">39</span> =&gt; <span class=\"string\">'N'</span>,</span><br><span class=\"line\">          <span class=\"number\">40</span> =&gt; <span class=\"string\">'L'</span>,</span><br><span class=\"line\">          <span class=\"number\">41</span> =&gt; <span class=\"string\">'M'</span>,</span><br><span class=\"line\">          <span class=\"number\">42</span> =&gt; <span class=\"string\">'D'</span>,</span><br><span class=\"line\">          <span class=\"number\">43</span> =&gt; <span class=\"string\">'a'</span>,</span><br><span class=\"line\">          <span class=\"number\">44</span> =&gt; <span class=\"string\">'g'</span>,</span><br><span class=\"line\">          <span class=\"number\">45</span> =&gt; <span class=\"string\">'H'</span>,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * encrypt function get code</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> $number</span><br><span class=\"line\">     * <span class=\"doctag\">@return</span> string</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> \\Error</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encode</span><span class=\"params\">($number)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\">        $encodeString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $numberType = $number &lt; <span class=\"number\">0</span>  ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $dictionaryLength = count(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>($number &gt; $dictionaryLength)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            $encodeString = <span class=\"keyword\">self</span>::$dictionary[abs($number % $dictionaryLength)] . $encodeString;</span><br><span class=\"line\">            $number = floor($number / $dictionaryLength);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($number &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            $encodeString = <span class=\"keyword\">self</span>::$dictionary[$number] . $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        $encodeStringLength = strlen($encodeString);</span><br><span class=\"line\">        $padStringLength = <span class=\"keyword\">self</span>::CODE_LENGTH - $encodeStringLength;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is negative number and encode length is six. number overflow</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(($numberType &amp;&amp; $padStringLength &lt; <span class=\"number\">1</span>) || (!$numberType &amp;&amp; $padStringLength &lt; <span class=\"number\">0</span>))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\Error(<span class=\"string\">\"加密数字溢出....\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is positive and encode length is six. just return it.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>($padStringLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is positive and encode length small than six. pad random character left.</span></span><br><span class=\"line\">        shuffle(<span class=\"keyword\">self</span>::$zeroCharacter);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>($numberType)</span><br><span class=\"line\">            $resultEncodeString = <span class=\"keyword\">self</span>::$negative . implode(array_slice(<span class=\"keyword\">self</span>::$zeroCharacter, <span class=\"number\">0</span>, $padStringLength + <span class=\"number\">1</span>)) . $encodeString;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            $resultEncodeString = implode(array_slice(<span class=\"keyword\">self</span>::$zeroCharacter, <span class=\"number\">0</span>, $padStringLength)) . $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $resultEncodeString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     *  decode string to number value</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> $string</span><br><span class=\"line\">     * <span class=\"doctag\">@return</span> int</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> \\Error</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decode</span><span class=\"params\">($string)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\">        $numberValue = <span class=\"number\">0</span>;</span><br><span class=\"line\">        $dictionaryLength = count(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\">        $decodeArr = array_reverse(str_split($string));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count($decodeArr) != <span class=\"keyword\">self</span>::CODE_LENGTH)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\Error(<span class=\"string\">\"字符长度错误.\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        $dictionaryNumberMap = array_flip(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span>($decodeArr <span class=\"keyword\">as</span> $key =&gt; $value)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(in_array($value, <span class=\"keyword\">self</span>::$zeroCharacter))</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            $numberValue += $dictionaryNumberMap[$value] * pow($dictionaryLength, $key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $numberValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$number = <span class=\"number\">10000000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$string = UIDUtils::encode($number);</span><br><span class=\"line\">var_dump($string);</span><br><span class=\"line\"></span><br><span class=\"line\">$number = UIDUtils::decode($string);</span><br><span class=\"line\">var_dump($number);</span><br></pre></td></tr></table></figure>\n<h3 id=\"思路很重要-实现很简单\"><a href=\"#思路很重要-实现很简单\" class=\"headerlink\" title=\"思路很重要, 实现很简单.\"></a>思路很重要, 实现很简单.</h3>","excerpt":"<p>场景: 只能用6位数, 要表示0~百亿区间的数. etc. xabdex =&gt; 2000000000.<br>","more":"</p>\n<h3 id=\"理解进制\"><a href=\"#理解进制\" class=\"headerlink\" title=\"理解进制\"></a>理解进制</h3><p>二进制, 逢2进1. <code>101 =&gt; 1x2^2 + 0x2^1 + 1x2^0 = 5</code> 二进制3为才能表示10进制的1位数.<br>16进制, 逢16进1. <code>101 =&gt; 1x16^2 + 0x16^1 + 1x16^0 = 257</code> 16进制101表示到了257.  </p>\n<p>64进制, 逢64进1. <code>101 =&gt; 1x64^2 + 0x64^1 + 1x64^0 = 4160</code> 64进制三位表示到了4位数, 就是我们想要的.  </p>\n<h3 id=\"实现-php\"><a href=\"#实现-php\" class=\"headerlink\" title=\"实现(php)\"></a>实现(php)</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UIDUtils</span></span><br><span class=\"line\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * 用户唯一表示长度</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> CODE_LENGTH = <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * if number is negative prefix with zero</span><br><span class=\"line\">     *</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $negative = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * this character presentation zero</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $zeroCharacter = [ <span class=\"string\">'J'</span>, <span class=\"string\">'q'</span>, <span class=\"string\">'s'</span>, <span class=\"string\">'T'</span>, <span class=\"string\">'U'</span>, <span class=\"string\">'E'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * code dictionary</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $dictionary = [</span><br><span class=\"line\">          <span class=\"number\">0</span> =&gt; <span class=\"string\">'K'</span>,</span><br><span class=\"line\">          <span class=\"number\">1</span> =&gt; <span class=\"string\">'v'</span>,</span><br><span class=\"line\">          <span class=\"number\">2</span> =&gt; <span class=\"string\">'F'</span>,</span><br><span class=\"line\">          <span class=\"number\">3</span> =&gt; <span class=\"string\">'m'</span>,</span><br><span class=\"line\">          <span class=\"number\">4</span> =&gt; <span class=\"string\">'u'</span>,</span><br><span class=\"line\">          <span class=\"number\">5</span> =&gt; <span class=\"string\">'B'</span>,</span><br><span class=\"line\">          <span class=\"number\">6</span> =&gt; <span class=\"string\">'S'</span>,</span><br><span class=\"line\">          <span class=\"number\">7</span> =&gt; <span class=\"string\">'n'</span>,</span><br><span class=\"line\">          <span class=\"number\">8</span> =&gt; <span class=\"string\">'Y'</span>,</span><br><span class=\"line\">          <span class=\"number\">9</span> =&gt; <span class=\"string\">'e'</span>,</span><br><span class=\"line\">          <span class=\"number\">10</span> =&gt; <span class=\"string\">'O'</span>,</span><br><span class=\"line\">          <span class=\"number\">11</span> =&gt; <span class=\"string\">'d'</span>,</span><br><span class=\"line\">          <span class=\"number\">12</span> =&gt; <span class=\"string\">'A'</span>,</span><br><span class=\"line\">          <span class=\"number\">13</span> =&gt; <span class=\"string\">'j'</span>,</span><br><span class=\"line\">          <span class=\"number\">14</span> =&gt; <span class=\"string\">'x'</span>,</span><br><span class=\"line\">          <span class=\"number\">15</span> =&gt; <span class=\"string\">'y'</span>,</span><br><span class=\"line\">          <span class=\"number\">16</span> =&gt; <span class=\"string\">'V'</span>,</span><br><span class=\"line\">          <span class=\"number\">17</span> =&gt; <span class=\"string\">'X'</span>,</span><br><span class=\"line\">          <span class=\"number\">18</span> =&gt; <span class=\"string\">'b'</span>,</span><br><span class=\"line\">          <span class=\"number\">19</span> =&gt; <span class=\"string\">'W'</span>,</span><br><span class=\"line\">          <span class=\"number\">20</span> =&gt; <span class=\"string\">'Q'</span>,</span><br><span class=\"line\">          <span class=\"number\">21</span> =&gt; <span class=\"string\">'P'</span>,</span><br><span class=\"line\">          <span class=\"number\">22</span> =&gt; <span class=\"string\">'z'</span>,</span><br><span class=\"line\">          <span class=\"number\">23</span> =&gt; <span class=\"string\">'t'</span>,</span><br><span class=\"line\">          <span class=\"number\">24</span> =&gt; <span class=\"string\">'r'</span>,</span><br><span class=\"line\">          <span class=\"number\">25</span> =&gt; <span class=\"string\">'Z'</span>,</span><br><span class=\"line\">          <span class=\"number\">26</span> =&gt; <span class=\"string\">'R'</span>,</span><br><span class=\"line\">          <span class=\"number\">27</span> =&gt; <span class=\"string\">'w'</span>,</span><br><span class=\"line\">          <span class=\"number\">28</span> =&gt; <span class=\"string\">'c'</span>,</span><br><span class=\"line\">          <span class=\"number\">29</span> =&gt; <span class=\"string\">'p'</span>,</span><br><span class=\"line\">          <span class=\"number\">30</span> =&gt; <span class=\"string\">'I'</span>,</span><br><span class=\"line\">          <span class=\"number\">31</span> =&gt; <span class=\"string\">'G'</span>,</span><br><span class=\"line\">          <span class=\"number\">32</span> =&gt; <span class=\"string\">'k'</span>,</span><br><span class=\"line\">          <span class=\"number\">33</span> =&gt; <span class=\"string\">'C'</span>,</span><br><span class=\"line\">          <span class=\"number\">34</span> =&gt; <span class=\"string\">'h'</span>,</span><br><span class=\"line\">          <span class=\"number\">35</span> =&gt; <span class=\"string\">'f'</span>,</span><br><span class=\"line\">          <span class=\"number\">36</span> =&gt; <span class=\"string\">'l'</span>,</span><br><span class=\"line\">          <span class=\"number\">37</span> =&gt; <span class=\"string\">'i'</span>,</span><br><span class=\"line\">          <span class=\"number\">38</span> =&gt; <span class=\"string\">'o'</span>,</span><br><span class=\"line\">          <span class=\"number\">39</span> =&gt; <span class=\"string\">'N'</span>,</span><br><span class=\"line\">          <span class=\"number\">40</span> =&gt; <span class=\"string\">'L'</span>,</span><br><span class=\"line\">          <span class=\"number\">41</span> =&gt; <span class=\"string\">'M'</span>,</span><br><span class=\"line\">          <span class=\"number\">42</span> =&gt; <span class=\"string\">'D'</span>,</span><br><span class=\"line\">          <span class=\"number\">43</span> =&gt; <span class=\"string\">'a'</span>,</span><br><span class=\"line\">          <span class=\"number\">44</span> =&gt; <span class=\"string\">'g'</span>,</span><br><span class=\"line\">          <span class=\"number\">45</span> =&gt; <span class=\"string\">'H'</span>,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     * encrypt function get code</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> $number</span><br><span class=\"line\">     * <span class=\"doctag\">@return</span> string</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> \\Error</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encode</span><span class=\"params\">($number)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\">        $encodeString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $numberType = $number &lt; <span class=\"number\">0</span>  ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $dictionaryLength = count(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>($number &gt; $dictionaryLength)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            $encodeString = <span class=\"keyword\">self</span>::$dictionary[abs($number % $dictionaryLength)] . $encodeString;</span><br><span class=\"line\">            $number = floor($number / $dictionaryLength);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($number &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            $encodeString = <span class=\"keyword\">self</span>::$dictionary[$number] . $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        $encodeStringLength = strlen($encodeString);</span><br><span class=\"line\">        $padStringLength = <span class=\"keyword\">self</span>::CODE_LENGTH - $encodeStringLength;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is negative number and encode length is six. number overflow</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(($numberType &amp;&amp; $padStringLength &lt; <span class=\"number\">1</span>) || (!$numberType &amp;&amp; $padStringLength &lt; <span class=\"number\">0</span>))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\Error(<span class=\"string\">\"加密数字溢出....\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is positive and encode length is six. just return it.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>($padStringLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// if number is positive and encode length small than six. pad random character left.</span></span><br><span class=\"line\">        shuffle(<span class=\"keyword\">self</span>::$zeroCharacter);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>($numberType)</span><br><span class=\"line\">            $resultEncodeString = <span class=\"keyword\">self</span>::$negative . implode(array_slice(<span class=\"keyword\">self</span>::$zeroCharacter, <span class=\"number\">0</span>, $padStringLength + <span class=\"number\">1</span>)) . $encodeString;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            $resultEncodeString = implode(array_slice(<span class=\"keyword\">self</span>::$zeroCharacter, <span class=\"number\">0</span>, $padStringLength)) . $encodeString;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $resultEncodeString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span><br><span class=\"line\">     *  decode string to number value</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> $string</span><br><span class=\"line\">     * <span class=\"doctag\">@return</span> int</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> \\Error</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decode</span><span class=\"params\">($string)</span></span><br><span class=\"line\">    </span>&#123;</span><br><span class=\"line\">        $numberValue = <span class=\"number\">0</span>;</span><br><span class=\"line\">        $dictionaryLength = count(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\">        $decodeArr = array_reverse(str_split($string));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count($decodeArr) != <span class=\"keyword\">self</span>::CODE_LENGTH)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\Error(<span class=\"string\">\"字符长度错误.\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        $dictionaryNumberMap = array_flip(<span class=\"keyword\">self</span>::$dictionary);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span>($decodeArr <span class=\"keyword\">as</span> $key =&gt; $value)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(in_array($value, <span class=\"keyword\">self</span>::$zeroCharacter))</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            $numberValue += $dictionaryNumberMap[$value] * pow($dictionaryLength, $key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $numberValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$number = <span class=\"number\">10000000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$string = UIDUtils::encode($number);</span><br><span class=\"line\">var_dump($string);</span><br><span class=\"line\"></span><br><span class=\"line\">$number = UIDUtils::decode($string);</span><br><span class=\"line\">var_dump($number);</span><br></pre></td></tr></table></figure>\n<h3 id=\"思路很重要-实现很简单\"><a href=\"#思路很重要-实现很简单\" class=\"headerlink\" title=\"思路很重要, 实现很简单.\"></a>思路很重要, 实现很简单.</h3>"},{"title":"单点(SSO)登入实现","date":"2016-05-31T12:40:00.000Z","_content":"\n场景: 一公司旗下有很多网站，要求在旗下任意一个网站登入后，其他网站都处于登入状态．\n说明: 本帖子不涉及代码实现，之说明重要的点．(阐述不恰当的，欢迎拍砖)\n\n<!-- more -->\n\n\n### 理解登入原理\n\n就我个人理解，网站登入两种实现．\n\n* 基于session登入\n* 基于token登入\n\n\n#### 基于session登入原理\n\n1. 用户访问网站的一个页面, 服务器端随机生成一个标识sessionId, 更具服务端session配置，session数据可以保存在文件中(默认),也可保存在数据库(关系性或nosql)中 同时并把sessionId的值添加到响应头中，让用户浏览器已cookie的方式保存．\n2. 用户再次访问其他网页时候，请求头中就会带上上一步中sessionID, 服务端根据sessionId到取得对应用户的信息．判断是否登入.\n\n3. session过期时间\n\n    * 写入浏览器cookie的过期时间．当浏览器的cookie过期了，会导致sessionId丢失，倒是session失效．需要重新登入．\n    * 服务端的session过期，当服务端session过期，就算cookie没有过期，session也失效．　需要重新登入．\n    * 注意，每次请求，服务端session如果有存在值的话，需要更新服务端session过期时间，这些都session都是默认帮我们做了(一直访问，session不会失效)．\n\n4. 几天免登入实现\n\n    * 将session中的数据加密一起保存到cookie中，cookie的过期时间设置到对应几天失效，期间用户访问带上了cookie中的加密的值，实现免登入．\n\n\n#### 基于token登入原理\n\n* token验证有很多方式, (HTTP_BASIC Authorized, Auth0 auth2, jwt ...)，那jwt(json web token)说明．\n\n    1. 用户请求认证，认证服务器发放token(token中包含了用户信息).\n    2. 用户之后每个请求都在请求头中带上认证头信息.\n    3. token过期，再次请求认证服务器，刷新token.\n\n\n\n#### 单点(SSO)登入实现\n\n* 根据session,token登入原理，很明显基于token的方式无需要任何而外的配置，就实现了单点登入功能了．\n* session实现单点登入．\n    * 保证服务端session是共享的，默认文件存储需要设置保存session的目录共享，推荐使用数据库存储．\n    * 设置cookie作用域，域名，是每个域名下都能读取到保存sessionId的cookie\n\n\n\n#### session vs token\n\n* 实现复杂度　token &gt; session\n* 性能　token &gt; session \n* 扩展性 token &gt; session\n\n\n\n","source":"_posts/单点登入(SSO)实现.md","raw":"---\ntitle: 单点(SSO)登入实现\ndate: 2016-05-31 20:40:00\ntags: [SSO, SESSION 共享, Cookie作用域]\n---\n\n场景: 一公司旗下有很多网站，要求在旗下任意一个网站登入后，其他网站都处于登入状态．\n说明: 本帖子不涉及代码实现，之说明重要的点．(阐述不恰当的，欢迎拍砖)\n\n<!-- more -->\n\n\n### 理解登入原理\n\n就我个人理解，网站登入两种实现．\n\n* 基于session登入\n* 基于token登入\n\n\n#### 基于session登入原理\n\n1. 用户访问网站的一个页面, 服务器端随机生成一个标识sessionId, 更具服务端session配置，session数据可以保存在文件中(默认),也可保存在数据库(关系性或nosql)中 同时并把sessionId的值添加到响应头中，让用户浏览器已cookie的方式保存．\n2. 用户再次访问其他网页时候，请求头中就会带上上一步中sessionID, 服务端根据sessionId到取得对应用户的信息．判断是否登入.\n\n3. session过期时间\n\n    * 写入浏览器cookie的过期时间．当浏览器的cookie过期了，会导致sessionId丢失，倒是session失效．需要重新登入．\n    * 服务端的session过期，当服务端session过期，就算cookie没有过期，session也失效．　需要重新登入．\n    * 注意，每次请求，服务端session如果有存在值的话，需要更新服务端session过期时间，这些都session都是默认帮我们做了(一直访问，session不会失效)．\n\n4. 几天免登入实现\n\n    * 将session中的数据加密一起保存到cookie中，cookie的过期时间设置到对应几天失效，期间用户访问带上了cookie中的加密的值，实现免登入．\n\n\n#### 基于token登入原理\n\n* token验证有很多方式, (HTTP_BASIC Authorized, Auth0 auth2, jwt ...)，那jwt(json web token)说明．\n\n    1. 用户请求认证，认证服务器发放token(token中包含了用户信息).\n    2. 用户之后每个请求都在请求头中带上认证头信息.\n    3. token过期，再次请求认证服务器，刷新token.\n\n\n\n#### 单点(SSO)登入实现\n\n* 根据session,token登入原理，很明显基于token的方式无需要任何而外的配置，就实现了单点登入功能了．\n* session实现单点登入．\n    * 保证服务端session是共享的，默认文件存储需要设置保存session的目录共享，推荐使用数据库存储．\n    * 设置cookie作用域，域名，是每个域名下都能读取到保存sessionId的cookie\n\n\n\n#### session vs token\n\n* 实现复杂度　token &gt; session\n* 性能　token &gt; session \n* 扩展性 token &gt; session\n\n\n\n","slug":"单点登入(SSO)实现","published":1,"updated":"2016-09-15T07:13:28.145Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxum000p7sqvqbxyrzto","content":"<p>场景: 一公司旗下有很多网站，要求在旗下任意一个网站登入后，其他网站都处于登入状态．<br>说明: 本帖子不涉及代码实现，之说明重要的点．(阐述不恰当的，欢迎拍砖)</p>\n<a id=\"more\"></a>\n<h3 id=\"理解登入原理\"><a href=\"#理解登入原理\" class=\"headerlink\" title=\"理解登入原理\"></a>理解登入原理</h3><p>就我个人理解，网站登入两种实现．</p>\n<ul>\n<li>基于session登入</li>\n<li>基于token登入</li>\n</ul>\n<h4 id=\"基于session登入原理\"><a href=\"#基于session登入原理\" class=\"headerlink\" title=\"基于session登入原理\"></a>基于session登入原理</h4><ol>\n<li>用户访问网站的一个页面, 服务器端随机生成一个标识sessionId, 更具服务端session配置，session数据可以保存在文件中(默认),也可保存在数据库(关系性或nosql)中 同时并把sessionId的值添加到响应头中，让用户浏览器已cookie的方式保存．</li>\n<li><p>用户再次访问其他网页时候，请求头中就会带上上一步中sessionID, 服务端根据sessionId到取得对应用户的信息．判断是否登入.</p>\n</li>\n<li><p>session过期时间</p>\n<ul>\n<li>写入浏览器cookie的过期时间．当浏览器的cookie过期了，会导致sessionId丢失，倒是session失效．需要重新登入．</li>\n<li>服务端的session过期，当服务端session过期，就算cookie没有过期，session也失效．　需要重新登入．</li>\n<li>注意，每次请求，服务端session如果有存在值的话，需要更新服务端session过期时间，这些都session都是默认帮我们做了(一直访问，session不会失效)．</li>\n</ul>\n</li>\n<li><p>几天免登入实现</p>\n<ul>\n<li>将session中的数据加密一起保存到cookie中，cookie的过期时间设置到对应几天失效，期间用户访问带上了cookie中的加密的值，实现免登入．</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"基于token登入原理\"><a href=\"#基于token登入原理\" class=\"headerlink\" title=\"基于token登入原理\"></a>基于token登入原理</h4><ul>\n<li><p>token验证有很多方式, (HTTP_BASIC Authorized, Auth0 auth2, jwt …)，那jwt(json web token)说明．</p>\n<ol>\n<li>用户请求认证，认证服务器发放token(token中包含了用户信息).</li>\n<li>用户之后每个请求都在请求头中带上认证头信息.</li>\n<li>token过期，再次请求认证服务器，刷新token.</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"单点-SSO-登入实现\"><a href=\"#单点-SSO-登入实现\" class=\"headerlink\" title=\"单点(SSO)登入实现\"></a>单点(SSO)登入实现</h4><ul>\n<li>根据session,token登入原理，很明显基于token的方式无需要任何而外的配置，就实现了单点登入功能了．</li>\n<li>session实现单点登入．<ul>\n<li>保证服务端session是共享的，默认文件存储需要设置保存session的目录共享，推荐使用数据库存储．</li>\n<li>设置cookie作用域，域名，是每个域名下都能读取到保存sessionId的cookie</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"session-vs-token\"><a href=\"#session-vs-token\" class=\"headerlink\" title=\"session vs token\"></a>session vs token</h4><ul>\n<li>实现复杂度　token &gt; session</li>\n<li>性能　token &gt; session </li>\n<li>扩展性 token &gt; session</li>\n</ul>\n","excerpt":"<p>场景: 一公司旗下有很多网站，要求在旗下任意一个网站登入后，其他网站都处于登入状态．<br>说明: 本帖子不涉及代码实现，之说明重要的点．(阐述不恰当的，欢迎拍砖)</p>","more":"<h3 id=\"理解登入原理\"><a href=\"#理解登入原理\" class=\"headerlink\" title=\"理解登入原理\"></a>理解登入原理</h3><p>就我个人理解，网站登入两种实现．</p>\n<ul>\n<li>基于session登入</li>\n<li>基于token登入</li>\n</ul>\n<h4 id=\"基于session登入原理\"><a href=\"#基于session登入原理\" class=\"headerlink\" title=\"基于session登入原理\"></a>基于session登入原理</h4><ol>\n<li>用户访问网站的一个页面, 服务器端随机生成一个标识sessionId, 更具服务端session配置，session数据可以保存在文件中(默认),也可保存在数据库(关系性或nosql)中 同时并把sessionId的值添加到响应头中，让用户浏览器已cookie的方式保存．</li>\n<li><p>用户再次访问其他网页时候，请求头中就会带上上一步中sessionID, 服务端根据sessionId到取得对应用户的信息．判断是否登入.</p>\n</li>\n<li><p>session过期时间</p>\n<ul>\n<li>写入浏览器cookie的过期时间．当浏览器的cookie过期了，会导致sessionId丢失，倒是session失效．需要重新登入．</li>\n<li>服务端的session过期，当服务端session过期，就算cookie没有过期，session也失效．　需要重新登入．</li>\n<li>注意，每次请求，服务端session如果有存在值的话，需要更新服务端session过期时间，这些都session都是默认帮我们做了(一直访问，session不会失效)．</li>\n</ul>\n</li>\n<li><p>几天免登入实现</p>\n<ul>\n<li>将session中的数据加密一起保存到cookie中，cookie的过期时间设置到对应几天失效，期间用户访问带上了cookie中的加密的值，实现免登入．</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"基于token登入原理\"><a href=\"#基于token登入原理\" class=\"headerlink\" title=\"基于token登入原理\"></a>基于token登入原理</h4><ul>\n<li><p>token验证有很多方式, (HTTP_BASIC Authorized, Auth0 auth2, jwt …)，那jwt(json web token)说明．</p>\n<ol>\n<li>用户请求认证，认证服务器发放token(token中包含了用户信息).</li>\n<li>用户之后每个请求都在请求头中带上认证头信息.</li>\n<li>token过期，再次请求认证服务器，刷新token.</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"单点-SSO-登入实现\"><a href=\"#单点-SSO-登入实现\" class=\"headerlink\" title=\"单点(SSO)登入实现\"></a>单点(SSO)登入实现</h4><ul>\n<li>根据session,token登入原理，很明显基于token的方式无需要任何而外的配置，就实现了单点登入功能了．</li>\n<li>session实现单点登入．<ul>\n<li>保证服务端session是共享的，默认文件存储需要设置保存session的目录共享，推荐使用数据库存储．</li>\n<li>设置cookie作用域，域名，是每个域名下都能读取到保存sessionId的cookie</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"session-vs-token\"><a href=\"#session-vs-token\" class=\"headerlink\" title=\"session vs token\"></a>session vs token</h4><ul>\n<li>实现复杂度　token &gt; session</li>\n<li>性能　token &gt; session </li>\n<li>扩展性 token &gt; session</li>\n</ul>"},{"title":"批量删除redis制定键","date":"2016-08-15T13:42:40.000Z","desc":null,"_content":"\n有时候需要删除redis中的制定key, 使用redis-descktop桌面软件虽然挺好要, 但要批量删除, 并不是那么好用. so 使用脚本吧. \n\n<!-- more -->\n\n### 脚本奉上, (欢迎拍砖)\n\n```bash\n\n    redis-cli -n {数据库} keys '{glob 匹配, 参考官方文档有惊喜}' | xargs -n 1 redis-cli del\n\n```\n","source":"_posts/批量删除redis制定键.md","raw":"---\ntitle: 批量删除redis制定键\ndate: 2016-08-15 21:42:40\ndesc:\ntags:\n---\n\n有时候需要删除redis中的制定key, 使用redis-descktop桌面软件虽然挺好要, 但要批量删除, 并不是那么好用. so 使用脚本吧. \n\n<!-- more -->\n\n### 脚本奉上, (欢迎拍砖)\n\n```bash\n\n    redis-cli -n {数据库} keys '{glob 匹配, 参考官方文档有惊喜}' | xargs -n 1 redis-cli del\n\n```\n","slug":"批量删除redis制定键","published":1,"updated":"2016-09-15T07:13:28.145Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxv1000r7sqvu90083cj","content":"<p>有时候需要删除redis中的制定key, 使用redis-descktop桌面软件虽然挺好要, 但要批量删除, 并不是那么好用. so 使用脚本吧. </p>\n<a id=\"more\"></a>\n<h3 id=\"脚本奉上-欢迎拍砖\"><a href=\"#脚本奉上-欢迎拍砖\" class=\"headerlink\" title=\"脚本奉上, (欢迎拍砖)\"></a>脚本奉上, (欢迎拍砖)</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">redis-cli -n &#123;数据库&#125; keys <span class=\"string\">'&#123;glob 匹配, 参考官方文档有惊喜&#125;'</span> | xargs -n 1 redis-cli del</span><br></pre></td></tr></table></figure>\n","excerpt":"<p>有时候需要删除redis中的制定key, 使用redis-descktop桌面软件虽然挺好要, 但要批量删除, 并不是那么好用. so 使用脚本吧. </p>","more":"<h3 id=\"脚本奉上-欢迎拍砖\"><a href=\"#脚本奉上-欢迎拍砖\" class=\"headerlink\" title=\"脚本奉上, (欢迎拍砖)\"></a>脚本奉上, (欢迎拍砖)</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">redis-cli -n &#123;数据库&#125; keys <span class=\"string\">'&#123;glob 匹配, 参考官方文档有惊喜&#125;'</span> | xargs -n 1 redis-cli del</span><br></pre></td></tr></table></figure>"},{"title":"时间戳转日期，日期装时间戳快速tempermonkey脚本","date":"2016-04-13T15:52:00.000Z","_content":"\n####　使用　####\n１．安装ｃｈｒｏｍｅ　ｔｅｍｐｅｒｍｏｎｋｅｙ插件．\n２．安装此脚本．\n３．连续按ｔ键３次，　调出时间戳转日期输入框，按回车转换，按ｅｓｃ退出．\n４．连续按ｄ键３次，调出日期转时间戳选择框，按回车转化，按ｅｓｃ退出．\n\n```javascript\n// ==UserScript==\n// @name         time-date-convertor\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  press [t/d] key three time then show [timestamp/date] convertor\n// @author       arvim.lo <bigpao.luo@gmail.com>\n// @require       http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\n// @match        http*://*/*\n// @grant        none\n// ==/UserScript==\n\n(function() {\n    'use strict';\n    var timeTemplateEle = $('<div  style=\"display: inline; position: fixed; z-index:10000; right: 10px; top: 10px;\"><input type=\"number\" id=\"time-ipt\" />\n<span id=\"time-result\"></span></div>');\n    var dateTemplateEle = $('<div  style=\" display: inline; position: fixed; z-index: 10000; right: 10px; top: 10px;\"><input type=\"date\" id=\"date-ipt\" />\n<span id=\"date-result\"></span></div>');\n    var bodyEle = $(\"body\");\n    var timeResultEle = $(\"#time-result\", timeTemplateEle);\n    var timeIptEle = $(\"#time-ipt\", timeTemplateEle);\n    var cssStyle =  {\n        \"font-size\": \"12px\",\n        \"padding\": \" 5px\",\n        \"color\": \"#555\",\n        \"vertial-align\": \"middle\",\n        \"border\": \"1px solid #ccc\",\n        \"border-radius\": \"3px\",\n    };\n    timeIptEle.css(cssStyle);\n\n    var dateResultEle = $(\"#date-result\", dateTemplateEle);\n    var dateIptEle = $(\"#date-ipt\", dateTemplateEle);\n    dateIptEle.css(cssStyle);\n    var keyCounter = new Map();\n\n    /**\n     * 响应ｔ事件，　当ｔ连续三次后，　调出输入框，　输入时间戳，　回车时间计算，　ｅｓｃ键干掉\n     */\n    bodyEle.on(\"keyup\", \"#time-ipt\", function (evt) {\n        var timeIptEle = $(this);\n        if (evt.keyCode == 13) {\n            var value = timeIptEle.val();\n            if ($.trim(value) === \"\") {\n                alert(\" Please Input Value ! \");\n            } else {\n                var dateObj = new Date(value * 1000);\n                timeResultEle.html(dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate() + ' ' + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds());\n            }\n        } else if (evt.keyCode == 27) {\n            timeTemplateEle.remove();\n        }\n    });\n\n    /**\n     * 响应ｄ事件，　当日期选择好后，　回车转换成时间ＪａｖａＳｃｒｉｐｔ时间戳,ｅｓｃ键干掉\n     */\n    bodyEle.on(\"keyup\", \"#date-ipt\", function (evt) {\n        var dateIptEle = $(this);\n        if (evt.keyCode == 13) {\n            var value = dateIptEle.val();\n            if ($.trim(value) === \"\") {\n                alert(\" Please Input Date ! \");\n            } else {\n                var dateObj = new Date(value);\n                dateResultEle.html(dateObj.getTime());\n                return;\n            }\n        } else if (evt.keyCode == 27) {\n            dateTemplateEle.remove();\n        }\n    });\n\n    /**\n     * 响应　ｔ，ｄ事件，　当ｔ，ｄ连续三次，　调出时间，日期转ｉｎｐｕｔ框\n     */\n    bodyEle.on(\"keyup\", function (evt) {\n        var keyCode = evt.keyCode,\n        keyFlag = 'key-' + keyCode,\n        keyCount = keyCounter.get(keyFlag) || 0;\n\n        if (keyCode == 84) {\n            keyCounter.set(keyFlag, ++keyCount);\n            if (keyCount == 3) {\n                bodyEle.prepend(timeTemplateEle);\n                timeIptEle.focus();\n                keyCounter.clear();\n            }\n        } else if (keyCode == 68) {\n            keyCounter.set(keyFlag, ++keyCount);\n            if (keyCount === 3) {\n                bodyEle.prepend(dateTemplateEle);\n                dateIptEle.focus();\n                keyCounter.clear();\n            }\n        } else {\n            keyCounter.clear();\n        }\n    });\n})();\n```","source":"_posts/时间戳转日期，日期装时间戳快速tempermonkey脚本.md","raw":"---\ntitle: 时间戳转日期，日期装时间戳快速tempermonkey脚本\ntags: []\ndate: 2016-04-13 23:52:00\n---\n\n####　使用　####\n１．安装ｃｈｒｏｍｅ　ｔｅｍｐｅｒｍｏｎｋｅｙ插件．\n２．安装此脚本．\n３．连续按ｔ键３次，　调出时间戳转日期输入框，按回车转换，按ｅｓｃ退出．\n４．连续按ｄ键３次，调出日期转时间戳选择框，按回车转化，按ｅｓｃ退出．\n\n```javascript\n// ==UserScript==\n// @name         time-date-convertor\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  press [t/d] key three time then show [timestamp/date] convertor\n// @author       arvim.lo <bigpao.luo@gmail.com>\n// @require       http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\n// @match        http*://*/*\n// @grant        none\n// ==/UserScript==\n\n(function() {\n    'use strict';\n    var timeTemplateEle = $('<div  style=\"display: inline; position: fixed; z-index:10000; right: 10px; top: 10px;\"><input type=\"number\" id=\"time-ipt\" />\n<span id=\"time-result\"></span></div>');\n    var dateTemplateEle = $('<div  style=\" display: inline; position: fixed; z-index: 10000; right: 10px; top: 10px;\"><input type=\"date\" id=\"date-ipt\" />\n<span id=\"date-result\"></span></div>');\n    var bodyEle = $(\"body\");\n    var timeResultEle = $(\"#time-result\", timeTemplateEle);\n    var timeIptEle = $(\"#time-ipt\", timeTemplateEle);\n    var cssStyle =  {\n        \"font-size\": \"12px\",\n        \"padding\": \" 5px\",\n        \"color\": \"#555\",\n        \"vertial-align\": \"middle\",\n        \"border\": \"1px solid #ccc\",\n        \"border-radius\": \"3px\",\n    };\n    timeIptEle.css(cssStyle);\n\n    var dateResultEle = $(\"#date-result\", dateTemplateEle);\n    var dateIptEle = $(\"#date-ipt\", dateTemplateEle);\n    dateIptEle.css(cssStyle);\n    var keyCounter = new Map();\n\n    /**\n     * 响应ｔ事件，　当ｔ连续三次后，　调出输入框，　输入时间戳，　回车时间计算，　ｅｓｃ键干掉\n     */\n    bodyEle.on(\"keyup\", \"#time-ipt\", function (evt) {\n        var timeIptEle = $(this);\n        if (evt.keyCode == 13) {\n            var value = timeIptEle.val();\n            if ($.trim(value) === \"\") {\n                alert(\" Please Input Value ! \");\n            } else {\n                var dateObj = new Date(value * 1000);\n                timeResultEle.html(dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate() + ' ' + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds());\n            }\n        } else if (evt.keyCode == 27) {\n            timeTemplateEle.remove();\n        }\n    });\n\n    /**\n     * 响应ｄ事件，　当日期选择好后，　回车转换成时间ＪａｖａＳｃｒｉｐｔ时间戳,ｅｓｃ键干掉\n     */\n    bodyEle.on(\"keyup\", \"#date-ipt\", function (evt) {\n        var dateIptEle = $(this);\n        if (evt.keyCode == 13) {\n            var value = dateIptEle.val();\n            if ($.trim(value) === \"\") {\n                alert(\" Please Input Date ! \");\n            } else {\n                var dateObj = new Date(value);\n                dateResultEle.html(dateObj.getTime());\n                return;\n            }\n        } else if (evt.keyCode == 27) {\n            dateTemplateEle.remove();\n        }\n    });\n\n    /**\n     * 响应　ｔ，ｄ事件，　当ｔ，ｄ连续三次，　调出时间，日期转ｉｎｐｕｔ框\n     */\n    bodyEle.on(\"keyup\", function (evt) {\n        var keyCode = evt.keyCode,\n        keyFlag = 'key-' + keyCode,\n        keyCount = keyCounter.get(keyFlag) || 0;\n\n        if (keyCode == 84) {\n            keyCounter.set(keyFlag, ++keyCount);\n            if (keyCount == 3) {\n                bodyEle.prepend(timeTemplateEle);\n                timeIptEle.focus();\n                keyCounter.clear();\n            }\n        } else if (keyCode == 68) {\n            keyCounter.set(keyFlag, ++keyCount);\n            if (keyCount === 3) {\n                bodyEle.prepend(dateTemplateEle);\n                dateIptEle.focus();\n                keyCounter.clear();\n            }\n        } else {\n            keyCounter.clear();\n        }\n    });\n})();\n```","slug":"时间戳转日期，日期装时间戳快速tempermonkey脚本","published":1,"updated":"2016-09-15T07:13:28.146Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxv1000u7sqvcvthmofm","content":"<p>####　使用　####<br>１．安装ｃｈｒｏｍｅ　ｔｅｍｐｅｒｍｏｎｋｅｙ插件．<br>２．安装此脚本．<br>３．连续按ｔ键３次，　调出时间戳转日期输入框，按回车转换，按ｅｓｃ退出．<br>４．连续按ｄ键３次，调出日期转时间戳选择框，按回车转化，按ｅｓｃ退出．</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// ==UserScript==</span><br><span class=\"line\">// @name         time-date-convertor</span><br><span class=\"line\">// @namespace    http://tampermonkey.net/</span><br><span class=\"line\">// @version      0.1</span><br><span class=\"line\">// @description  press [t/d] key three time then show [timestamp/date] convertor</span><br><span class=\"line\">// @author       arvim.lo &lt;bigpao.luo@gmail.com&gt;</span><br><span class=\"line\">// @require       http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js</span><br><span class=\"line\">// @match        http*://*/*</span><br><span class=\"line\">// @grant        none</span><br><span class=\"line\">// ==/UserScript==</span><br><span class=\"line\"></span><br><span class=\"line\">(function() &#123;</span><br><span class=\"line\">    'use strict';</span><br><span class=\"line\">    var timeTemplateEle = $('&lt;div  style=\"display: inline; position: fixed; z-index:10000; right: 10px; top: 10px;\"&gt;&lt;input type=\"number\" id=\"time-ipt\" /&gt;</span><br><span class=\"line\">&lt;span id=\"time-result\"&gt;&lt;/span&gt;&lt;/div&gt;');</span><br><span class=\"line\">    var dateTemplateEle = $('&lt;div  style=\" display: inline; position: fixed; z-index: 10000; right: 10px; top: 10px;\"&gt;&lt;input type=\"date\" id=\"date-ipt\" /&gt;</span><br><span class=\"line\">&lt;span id=\"date-result\"&gt;&lt;/span&gt;&lt;/div&gt;');</span><br><span class=\"line\">    var bodyEle = $(\"body\");</span><br><span class=\"line\">    var timeResultEle = $(\"#time-result\", timeTemplateEle);</span><br><span class=\"line\">    var timeIptEle = $(\"#time-ipt\", timeTemplateEle);</span><br><span class=\"line\">    var cssStyle =  &#123;</span><br><span class=\"line\">        \"font-size\": \"12px\",</span><br><span class=\"line\">        \"padding\": \" 5px\",</span><br><span class=\"line\">        \"color\": \"#555\",</span><br><span class=\"line\">        \"vertial-align\": \"middle\",</span><br><span class=\"line\">        \"border\": \"1px solid #ccc\",</span><br><span class=\"line\">        \"border-radius\": \"3px\",</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    timeIptEle.css(cssStyle);</span><br><span class=\"line\"></span><br><span class=\"line\">    var dateResultEle = $(\"#date-result\", dateTemplateEle);</span><br><span class=\"line\">    var dateIptEle = $(\"#date-ipt\", dateTemplateEle);</span><br><span class=\"line\">    dateIptEle.css(cssStyle);</span><br><span class=\"line\">    var keyCounter = new Map();</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应ｔ事件，　当ｔ连续三次后，　调出输入框，　输入时间戳，　回车时间计算，　ｅｓｃ键干掉</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", \"#time-ipt\", function (evt) &#123;</span><br><span class=\"line\">        var timeIptEle = $(this);</span><br><span class=\"line\">        if (evt.keyCode == 13) &#123;</span><br><span class=\"line\">            var value = timeIptEle.val();</span><br><span class=\"line\">            if ($.trim(value) === \"\") &#123;</span><br><span class=\"line\">                alert(\" Please Input Value ! \");</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var dateObj = new Date(value * 1000);</span><br><span class=\"line\">                timeResultEle.html(dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate() + ' ' + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (evt.keyCode == 27) &#123;</span><br><span class=\"line\">            timeTemplateEle.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应ｄ事件，　当日期选择好后，　回车转换成时间ＪａｖａＳｃｒｉｐｔ时间戳,ｅｓｃ键干掉</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", \"#date-ipt\", function (evt) &#123;</span><br><span class=\"line\">        var dateIptEle = $(this);</span><br><span class=\"line\">        if (evt.keyCode == 13) &#123;</span><br><span class=\"line\">            var value = dateIptEle.val();</span><br><span class=\"line\">            if ($.trim(value) === \"\") &#123;</span><br><span class=\"line\">                alert(\" Please Input Date ! \");</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var dateObj = new Date(value);</span><br><span class=\"line\">                dateResultEle.html(dateObj.getTime());</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (evt.keyCode == 27) &#123;</span><br><span class=\"line\">            dateTemplateEle.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应　ｔ，ｄ事件，　当ｔ，ｄ连续三次，　调出时间，日期转ｉｎｐｕｔ框</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", function (evt) &#123;</span><br><span class=\"line\">        var keyCode = evt.keyCode,</span><br><span class=\"line\">        keyFlag = 'key-' + keyCode,</span><br><span class=\"line\">        keyCount = keyCounter.get(keyFlag) || 0;</span><br><span class=\"line\"></span><br><span class=\"line\">        if (keyCode == 84) &#123;</span><br><span class=\"line\">            keyCounter.set(keyFlag, ++keyCount);</span><br><span class=\"line\">            if (keyCount == 3) &#123;</span><br><span class=\"line\">                bodyEle.prepend(timeTemplateEle);</span><br><span class=\"line\">                timeIptEle.focus();</span><br><span class=\"line\">                keyCounter.clear();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (keyCode == 68) &#123;</span><br><span class=\"line\">            keyCounter.set(keyFlag, ++keyCount);</span><br><span class=\"line\">            if (keyCount === 3) &#123;</span><br><span class=\"line\">                bodyEle.prepend(dateTemplateEle);</span><br><span class=\"line\">                dateIptEle.focus();</span><br><span class=\"line\">                keyCounter.clear();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            keyCounter.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<p>####　使用　####<br>１．安装ｃｈｒｏｍｅ　ｔｅｍｐｅｒｍｏｎｋｅｙ插件．<br>２．安装此脚本．<br>３．连续按ｔ键３次，　调出时间戳转日期输入框，按回车转换，按ｅｓｃ退出．<br>４．连续按ｄ键３次，调出日期转时间戳选择框，按回车转化，按ｅｓｃ退出．</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// ==UserScript==</span><br><span class=\"line\">// @name         time-date-convertor</span><br><span class=\"line\">// @namespace    http://tampermonkey.net/</span><br><span class=\"line\">// @version      0.1</span><br><span class=\"line\">// @description  press [t/d] key three time then show [timestamp/date] convertor</span><br><span class=\"line\">// @author       arvim.lo &lt;bigpao.luo@gmail.com&gt;</span><br><span class=\"line\">// @require       http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js</span><br><span class=\"line\">// @match        http*://*/*</span><br><span class=\"line\">// @grant        none</span><br><span class=\"line\">// ==/UserScript==</span><br><span class=\"line\"></span><br><span class=\"line\">(function() &#123;</span><br><span class=\"line\">    'use strict';</span><br><span class=\"line\">    var timeTemplateEle = $('&lt;div  style=\"display: inline; position: fixed; z-index:10000; right: 10px; top: 10px;\"&gt;&lt;input type=\"number\" id=\"time-ipt\" /&gt;</span><br><span class=\"line\">&lt;span id=\"time-result\"&gt;&lt;/span&gt;&lt;/div&gt;');</span><br><span class=\"line\">    var dateTemplateEle = $('&lt;div  style=\" display: inline; position: fixed; z-index: 10000; right: 10px; top: 10px;\"&gt;&lt;input type=\"date\" id=\"date-ipt\" /&gt;</span><br><span class=\"line\">&lt;span id=\"date-result\"&gt;&lt;/span&gt;&lt;/div&gt;');</span><br><span class=\"line\">    var bodyEle = $(\"body\");</span><br><span class=\"line\">    var timeResultEle = $(\"#time-result\", timeTemplateEle);</span><br><span class=\"line\">    var timeIptEle = $(\"#time-ipt\", timeTemplateEle);</span><br><span class=\"line\">    var cssStyle =  &#123;</span><br><span class=\"line\">        \"font-size\": \"12px\",</span><br><span class=\"line\">        \"padding\": \" 5px\",</span><br><span class=\"line\">        \"color\": \"#555\",</span><br><span class=\"line\">        \"vertial-align\": \"middle\",</span><br><span class=\"line\">        \"border\": \"1px solid #ccc\",</span><br><span class=\"line\">        \"border-radius\": \"3px\",</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    timeIptEle.css(cssStyle);</span><br><span class=\"line\"></span><br><span class=\"line\">    var dateResultEle = $(\"#date-result\", dateTemplateEle);</span><br><span class=\"line\">    var dateIptEle = $(\"#date-ipt\", dateTemplateEle);</span><br><span class=\"line\">    dateIptEle.css(cssStyle);</span><br><span class=\"line\">    var keyCounter = new Map();</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应ｔ事件，　当ｔ连续三次后，　调出输入框，　输入时间戳，　回车时间计算，　ｅｓｃ键干掉</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", \"#time-ipt\", function (evt) &#123;</span><br><span class=\"line\">        var timeIptEle = $(this);</span><br><span class=\"line\">        if (evt.keyCode == 13) &#123;</span><br><span class=\"line\">            var value = timeIptEle.val();</span><br><span class=\"line\">            if ($.trim(value) === \"\") &#123;</span><br><span class=\"line\">                alert(\" Please Input Value ! \");</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var dateObj = new Date(value * 1000);</span><br><span class=\"line\">                timeResultEle.html(dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate() + ' ' + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (evt.keyCode == 27) &#123;</span><br><span class=\"line\">            timeTemplateEle.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应ｄ事件，　当日期选择好后，　回车转换成时间ＪａｖａＳｃｒｉｐｔ时间戳,ｅｓｃ键干掉</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", \"#date-ipt\", function (evt) &#123;</span><br><span class=\"line\">        var dateIptEle = $(this);</span><br><span class=\"line\">        if (evt.keyCode == 13) &#123;</span><br><span class=\"line\">            var value = dateIptEle.val();</span><br><span class=\"line\">            if ($.trim(value) === \"\") &#123;</span><br><span class=\"line\">                alert(\" Please Input Date ! \");</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var dateObj = new Date(value);</span><br><span class=\"line\">                dateResultEle.html(dateObj.getTime());</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (evt.keyCode == 27) &#123;</span><br><span class=\"line\">            dateTemplateEle.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 响应　ｔ，ｄ事件，　当ｔ，ｄ连续三次，　调出时间，日期转ｉｎｐｕｔ框</span><br><span class=\"line\">     */</span><br><span class=\"line\">    bodyEle.on(\"keyup\", function (evt) &#123;</span><br><span class=\"line\">        var keyCode = evt.keyCode,</span><br><span class=\"line\">        keyFlag = 'key-' + keyCode,</span><br><span class=\"line\">        keyCount = keyCounter.get(keyFlag) || 0;</span><br><span class=\"line\"></span><br><span class=\"line\">        if (keyCode == 84) &#123;</span><br><span class=\"line\">            keyCounter.set(keyFlag, ++keyCount);</span><br><span class=\"line\">            if (keyCount == 3) &#123;</span><br><span class=\"line\">                bodyEle.prepend(timeTemplateEle);</span><br><span class=\"line\">                timeIptEle.focus();</span><br><span class=\"line\">                keyCounter.clear();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else if (keyCode == 68) &#123;</span><br><span class=\"line\">            keyCounter.set(keyFlag, ++keyCount);</span><br><span class=\"line\">            if (keyCount === 3) &#123;</span><br><span class=\"line\">                bodyEle.prepend(dateTemplateEle);</span><br><span class=\"line\">                dateIptEle.focus();</span><br><span class=\"line\">                keyCounter.clear();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            keyCounter.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>"},{"title":"简单的mysql过程实现数据行累加","date":"2016-09-10T05:04:37.000Z","desc":null,"_content":"\n今天碰到mysql的一个问题, 下一行的一个字段需要累加上一行的字段的值\n\n    +----+------+-----+           +----+------+--------------+\n    | id | name | age |           | id | name | age          |\n    +----+------+-----+           +----+------+--------------+\n    | 1  | lily | 10  |           | 1  | lily | 10           |\n    +----+------+-----+    =>     +----+------+--------------+\n    | 2  | lucy | 28  |           | 2  | lucy | 28 +10       |\n    +----+------+-----+           +----+------+--------------+\n    | 3  | tom  | 80  |           | 3  | tom  | 80 + 28 + 10 |\n    +----+------+-----+           +----+------+--------------+\n\n\n<!-- more -->\n\n\n### 如何实现它\n\n* 可以使用java, php, python等脚本语言轻松实现, 不讨论.\n\n* 今天讨论用sql语言实现它. 要实现这个东东, 第一感觉想到的是过程\n\n    1. 编写过程\n\n            ```sql\n\n                delimiter ;;\n\n                create procedure demo()\n\n                begin\n\n                declare done int default 0;\n                declare prevalue int default 0;\n                declare vid int;\n                declare currentvalue int;\n\n                -- 声明游标\n\n                declare demo_cursor cursor for select id, age from demo;\n                declare continue handler for not found set done = 1;\n\n                -- 打开游标\n\n                open demo_cursor;\n\n                -- 循环操作\n                read_loop: LOOP\n\n                    fetch invest into vid, currentvalue;\n                    set prevalue := prevalue+currentvalue;\n\n                    if done then\n                        leave read_loop;\n                    end if;\n\n                    update demo set age = prevalue where id = id;\n\n                end LOOP;\n                CLOSE demo_cursor;\n\n                end;\n                ;;\n\n                delimiter ;\n            ```\n=======\n\n    1. 编写过程\n\n        ```sql\n\n            delimiter ;;\n\n            create procedure demo()\n\n            begin\n\n            declare done int default 0;\n            declare prevalue int default 0;\n            declare vid int;\n            declare currentvalue int;\n\n            -- 声明游标\n\n            declare demo_cursor cursor for select id, age from demo;\n            declare continue handler for not found set done = 1;\n\n            -- 打开游标\n\n            open demo_cursor;\n\n            -- 循环操作\n            read_loop: LOOP\n\n                fetch invest into vid, currentvalue;\n                set prevalue := prevalue+currentvalue;\n\n                if done then\n                    leave read_loop;\n                end if;\n\n                update demo set age = prevalue where id = id;\n\n            end LOOP;\n            CLOSE demo_cursor;\n\n            end;\n            ;;\n\n            delimiter ;\n        ```\n\n    2. 执行过程 `call demo();`\n\n    3. 删除过程 `drop procedure demo;`\n\n\n\n就这样实现了, 欢迎拍砖.\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/简单的mysql过程实现数据行累加.md","raw":"---\ntitle: 简单的mysql过程实现数据行累加\ndate: 2016-09-10 13:04:37\ndesc:\ntags:\n---\n\n今天碰到mysql的一个问题, 下一行的一个字段需要累加上一行的字段的值\n\n    +----+------+-----+           +----+------+--------------+\n    | id | name | age |           | id | name | age          |\n    +----+------+-----+           +----+------+--------------+\n    | 1  | lily | 10  |           | 1  | lily | 10           |\n    +----+------+-----+    =>     +----+------+--------------+\n    | 2  | lucy | 28  |           | 2  | lucy | 28 +10       |\n    +----+------+-----+           +----+------+--------------+\n    | 3  | tom  | 80  |           | 3  | tom  | 80 + 28 + 10 |\n    +----+------+-----+           +----+------+--------------+\n\n\n<!-- more -->\n\n\n### 如何实现它\n\n* 可以使用java, php, python等脚本语言轻松实现, 不讨论.\n\n* 今天讨论用sql语言实现它. 要实现这个东东, 第一感觉想到的是过程\n\n    1. 编写过程\n\n            ```sql\n\n                delimiter ;;\n\n                create procedure demo()\n\n                begin\n\n                declare done int default 0;\n                declare prevalue int default 0;\n                declare vid int;\n                declare currentvalue int;\n\n                -- 声明游标\n\n                declare demo_cursor cursor for select id, age from demo;\n                declare continue handler for not found set done = 1;\n\n                -- 打开游标\n\n                open demo_cursor;\n\n                -- 循环操作\n                read_loop: LOOP\n\n                    fetch invest into vid, currentvalue;\n                    set prevalue := prevalue+currentvalue;\n\n                    if done then\n                        leave read_loop;\n                    end if;\n\n                    update demo set age = prevalue where id = id;\n\n                end LOOP;\n                CLOSE demo_cursor;\n\n                end;\n                ;;\n\n                delimiter ;\n            ```\n=======\n\n    1. 编写过程\n\n        ```sql\n\n            delimiter ;;\n\n            create procedure demo()\n\n            begin\n\n            declare done int default 0;\n            declare prevalue int default 0;\n            declare vid int;\n            declare currentvalue int;\n\n            -- 声明游标\n\n            declare demo_cursor cursor for select id, age from demo;\n            declare continue handler for not found set done = 1;\n\n            -- 打开游标\n\n            open demo_cursor;\n\n            -- 循环操作\n            read_loop: LOOP\n\n                fetch invest into vid, currentvalue;\n                set prevalue := prevalue+currentvalue;\n\n                if done then\n                    leave read_loop;\n                end if;\n\n                update demo set age = prevalue where id = id;\n\n            end LOOP;\n            CLOSE demo_cursor;\n\n            end;\n            ;;\n\n            delimiter ;\n        ```\n\n    2. 执行过程 `call demo();`\n\n    3. 删除过程 `drop procedure demo;`\n\n\n\n就这样实现了, 欢迎拍砖.\n\n\n\n\n\n\n\n\n\n\n\n","slug":"简单的mysql过程实现数据行累加","published":1,"updated":"2016-09-15T07:13:28.146Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxv1000v7sqv9efziac2","content":"<p>今天碰到mysql的一个问题, 下一行的一个字段需要累加上一行的字段的值</p>\n<pre><code>+----+------+-----+           +----+------+--------------+\n| id | name | age |           | id | name | age          |\n+----+------+-----+           +----+------+--------------+\n| 1  | lily | 10  |           | 1  | lily | 10           |\n+----+------+-----+    =&gt;     +----+------+--------------+\n| 2  | lucy | 28  |           | 2  | lucy | 28 +10       |\n+----+------+-----+           +----+------+--------------+\n| 3  | tom  | 80  |           | 3  | tom  | 80 + 28 + 10 |\n+----+------+-----+           +----+------+--------------+\n</code></pre><a id=\"more\"></a>\n<h3 id=\"如何实现它\"><a href=\"#如何实现它\" class=\"headerlink\" title=\"如何实现它\"></a>如何实现它</h3><ul>\n<li><p>可以使用java, php, python等脚本语言轻松实现, 不讨论.</p>\n</li>\n<li><p>今天讨论用sql语言实现它. 要实现这个东东, 第一感觉想到的是过程</p>\n<ol>\n<li><p>编写过程</p>\n<pre><code><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> demo()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> done <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> prevalue <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> vid <span class=\"built_in\">int</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> currentvalue <span class=\"built_in\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 声明游标</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> demo_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> <span class=\"keyword\">id</span>, age <span class=\"keyword\">from</span> demo;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> continue <span class=\"keyword\">handler</span> <span class=\"keyword\">for</span> <span class=\"keyword\">not</span> <span class=\"keyword\">found</span> <span class=\"keyword\">set</span> done = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 打开游标</span></span><br><span class=\"line\"></span><br><span class=\"line\">open demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 循环操作</span></span><br><span class=\"line\">read_loop: LOOP</span><br><span class=\"line\"></span><br><span class=\"line\">    fetch invest into vid, currentvalue;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> prevalue := prevalue+currentvalue;</span><br><span class=\"line\"></span><br><span class=\"line\">    if done then</span><br><span class=\"line\">        leave read_loop;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">update</span> demo <span class=\"keyword\">set</span> age = prevalue <span class=\"keyword\">where</span> <span class=\"keyword\">id</span> = <span class=\"keyword\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">LOOP</span>;</span><br><span class=\"line\">CLOSE demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\">;;</span><br><span class=\"line\"></span><br><span class=\"line\">delimiter ;</span><br></pre></td></tr></table></figure>\n</code></pre></li>\n</ol>\n</li>\n</ul>\n<p>=======</p>\n<pre><code>1. 编写过程\n\n    <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> demo()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> done <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> prevalue <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> vid <span class=\"built_in\">int</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> currentvalue <span class=\"built_in\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 声明游标</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> demo_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> <span class=\"keyword\">id</span>, age <span class=\"keyword\">from</span> demo;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> continue <span class=\"keyword\">handler</span> <span class=\"keyword\">for</span> <span class=\"keyword\">not</span> <span class=\"keyword\">found</span> <span class=\"keyword\">set</span> done = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 打开游标</span></span><br><span class=\"line\"></span><br><span class=\"line\">open demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 循环操作</span></span><br><span class=\"line\">read_loop: LOOP</span><br><span class=\"line\"></span><br><span class=\"line\">    fetch invest into vid, currentvalue;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> prevalue := prevalue+currentvalue;</span><br><span class=\"line\"></span><br><span class=\"line\">    if done then</span><br><span class=\"line\">        leave read_loop;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">update</span> demo <span class=\"keyword\">set</span> age = prevalue <span class=\"keyword\">where</span> <span class=\"keyword\">id</span> = <span class=\"keyword\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">LOOP</span>;</span><br><span class=\"line\">CLOSE demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\">;;</span><br><span class=\"line\"></span><br><span class=\"line\">delimiter ;</span><br></pre></td></tr></table></figure>\n\n2. 执行过程 `call demo();`\n\n3. 删除过程 `drop procedure demo;`\n</code></pre><p>就这样实现了, 欢迎拍砖.</p>\n","excerpt":"<p>今天碰到mysql的一个问题, 下一行的一个字段需要累加上一行的字段的值</p>\n<pre><code>+----+------+-----+           +----+------+--------------+\n| id | name | age |           | id | name | age          |\n+----+------+-----+           +----+------+--------------+\n| 1  | lily | 10  |           | 1  | lily | 10           |\n+----+------+-----+    =&gt;     +----+------+--------------+\n| 2  | lucy | 28  |           | 2  | lucy | 28 +10       |\n+----+------+-----+           +----+------+--------------+\n| 3  | tom  | 80  |           | 3  | tom  | 80 + 28 + 10 |\n+----+------+-----+           +----+------+--------------+\n</code></pre>","more":"<h3 id=\"如何实现它\"><a href=\"#如何实现它\" class=\"headerlink\" title=\"如何实现它\"></a>如何实现它</h3><ul>\n<li><p>可以使用java, php, python等脚本语言轻松实现, 不讨论.</p>\n</li>\n<li><p>今天讨论用sql语言实现它. 要实现这个东东, 第一感觉想到的是过程</p>\n<ol>\n<li><p>编写过程</p>\n<pre><code><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> demo()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> done <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> prevalue <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> vid <span class=\"built_in\">int</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> currentvalue <span class=\"built_in\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 声明游标</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> demo_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> <span class=\"keyword\">id</span>, age <span class=\"keyword\">from</span> demo;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> continue <span class=\"keyword\">handler</span> <span class=\"keyword\">for</span> <span class=\"keyword\">not</span> <span class=\"keyword\">found</span> <span class=\"keyword\">set</span> done = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 打开游标</span></span><br><span class=\"line\"></span><br><span class=\"line\">open demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 循环操作</span></span><br><span class=\"line\">read_loop: LOOP</span><br><span class=\"line\"></span><br><span class=\"line\">    fetch invest into vid, currentvalue;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> prevalue := prevalue+currentvalue;</span><br><span class=\"line\"></span><br><span class=\"line\">    if done then</span><br><span class=\"line\">        leave read_loop;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">update</span> demo <span class=\"keyword\">set</span> age = prevalue <span class=\"keyword\">where</span> <span class=\"keyword\">id</span> = <span class=\"keyword\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">LOOP</span>;</span><br><span class=\"line\">CLOSE demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\">;;</span><br><span class=\"line\"></span><br><span class=\"line\">delimiter ;</span><br></pre></td></tr></table></figure>\n</code></pre></li>\n</ol>\n</li>\n</ul>\n<p>=======</p>\n<pre><code>1. 编写过程\n\n    <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> demo()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> done <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> prevalue <span class=\"built_in\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> vid <span class=\"built_in\">int</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> currentvalue <span class=\"built_in\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 声明游标</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">declare</span> demo_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> <span class=\"keyword\">id</span>, age <span class=\"keyword\">from</span> demo;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> continue <span class=\"keyword\">handler</span> <span class=\"keyword\">for</span> <span class=\"keyword\">not</span> <span class=\"keyword\">found</span> <span class=\"keyword\">set</span> done = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 打开游标</span></span><br><span class=\"line\"></span><br><span class=\"line\">open demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 循环操作</span></span><br><span class=\"line\">read_loop: LOOP</span><br><span class=\"line\"></span><br><span class=\"line\">    fetch invest into vid, currentvalue;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> prevalue := prevalue+currentvalue;</span><br><span class=\"line\"></span><br><span class=\"line\">    if done then</span><br><span class=\"line\">        leave read_loop;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">update</span> demo <span class=\"keyword\">set</span> age = prevalue <span class=\"keyword\">where</span> <span class=\"keyword\">id</span> = <span class=\"keyword\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">LOOP</span>;</span><br><span class=\"line\">CLOSE demo_cursor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\">;;</span><br><span class=\"line\"></span><br><span class=\"line\">delimiter ;</span><br></pre></td></tr></table></figure>\n\n2. 执行过程 `call demo();`\n\n3. 删除过程 `drop procedure demo;`\n</code></pre><p>就这样实现了, 欢迎拍砖.</p>"},{"title":"自动更新hosts文件, 访问google, facebook","date":"2015-12-28T08:39:00.000Z","_content":"\n##### 脚本自动获取 [racaljk project](https://github.com/racaljk/hosts) hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用--start, --line 保留本地hosts文件行数 #####\n\n##### 基本要求系统 #####\n* Python3.x.x\n* 应hosts文件权限关系\n* windows需要使用administrator 权限\n* linux需要使用root权限\n\n##### 加入计划任务(windows) #####\n* 打开开始菜单, 搜索框输入**计划任务** 或快捷键[win + r] 粘贴 `%windir%\\system32\\taskschd.msc /s`\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170213417-181074786.png)\n\n* 右击 [任务计划库] -> [创建任务]\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170224932-659219118.png)\n\n* 常规选项卡, 添加名称, 描述\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170321089-2002023170.png)\n\n* 点击触发器选项卡 [新建] 添加触发器, 比如多久运行, 什么时候执行\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228165952292-1171750287.png)\n\n* 点击操作选项卡   [新建] 添加脚本执行\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170603885-700230869.png)\n\n##### Linux安装方法 #####\n* 添加执行权限. `shell> chmod +x UpdateHosts.py`\n* 添加计划任务. `shell> echo ' 0 09 * * * python /path/to/UpdateHosts.py --line 60 --os linux 2>&1 >/dev/null' >> /var/spool/cron/root`\n* 每天9点半更新, 根据自己时间更新\n\n##### UpdateHosts.py 代码如下(欢迎拍砖)####\n\n```python\n#!/bin/python env\nimport argparse\nfrom urllib import request\n\"\"\"\n    The Script get from github racaljk's hosts project and merge localhost host file.\n    Used: python UPdateHosts.py --help get detail information.\n    Author: Gawim <bigpao.luo@gmail.com>\n    Time: 2015-12-28\n    Require: python3.x.x\n    Notes: please use administrator execute it. before execute script remember backup your hosts file.\n    in the first line of hosts, you can set how many line you don't want replace. for example \n    ```hosts\n        # 11\n        # Copyright (c) 1993-2009 Microsoft Corp.\n        #\n        # This is a sample HOSTS file used by Microsoft TCP/IP for Windows.\n    ```\n    that will keep 11 line\n\"\"\"\n\nWINDOWS_HOST = \"C:\\Windows\\System32\\drivers\\etc\\hosts\"\nLINUX_HOST = \"/etc/hosts\"\nGITHUB_HOSTS = \"https://raw.githubusercontent.com/racaljk/hosts/master/hosts\"  # copy github racaljk hosts project\n\ndef getParam():\n    \"Obtain The Extran Parameters\"\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--start\", help=\"Input The Line Which You Need Not To Replace\", default=\"0\", type=int)\n    parser.add_argument(\"--line\", help=\"Input The Line Which You Need Not To Replace\", default=\"50\", type=int)\n    parser.add_argument(\"--os\", help=\"What System You Use\", default=\"windows\", choices=[\"linux\", \"window\", \"OSX\"])\n\n    return parser.parse_args()\n\ndef getHostsNeedContent(hostsPath, lineStart, lineOffset):\n\n    needHostDomain = []\n    with open(hostsPath, mode=\"r+\", encoding=\"utf-8\") as fileHandle:\n        customerLineNumStr = fileHandle.readline().strip(\"#\").strip();\n        try:\n            customerLineNum = int(customerLineNumStr)\n        except ValueError:\n            customerLineNum = lineOffset\n        fileHandle.seek(lineStart)\n        i = 0\n        while i < customerLineNum:\n            needHostDomain.append(fileHandle.readline())\n            i += 1\n        return \"\".join(needHostDomain)\n\ndef getGitHubHostsAndWriteNewHots(needHostContents, hostsPath):\n    fileHandle = open(hostsPath, mode=\"w\", encoding=\"utf-8\")\n    fileHandle.write(needHostContents)\n    with request.urlopen(GITHUB_HOSTS) as socketHandle:\n        for contents in socketHandle:\n            fileHandle.write(contents.decode(\"utf-8\"))\n    fileHandle.close()\n    return True\n\ndef main():\n    options = getParam()\n    if options.os == \"windows\":\n        hostsPath = WINDOWS_HOST\n    elif options.os == \"linux\":\n        hostsPath = LINUX_HOST\n    elif options.os == \"OSX\":\n        hostsPath = LINUX_HOST\n    else:\n        raise ValueError(\"Please Tell Me What System You Used\")\n    lineStart = options.start\n    lineOffset = options.line\n\n    needHostContents = getHostsNeedContent(hostsPath, lineStart, lineOffset)  # get localhost hosts line need merge default start 0 line 50\n\n    resultSet = getGitHubHostsAndWriteNewHots(needHostContents, hostsPath)  # get github hosts and merge localhost hosts\n    print(resultSet);\n\nif __name__ == \"__main__\":\n    main()\n\n```","source":"_posts/自动更新hosts文件-访问google-facebook.md","raw":"---\ntitle: '自动更新hosts文件, 访问google, facebook'\ntags: []\ndate: 2015-12-28 16:39:00\n---\n\n##### 脚本自动获取 [racaljk project](https://github.com/racaljk/hosts) hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用--start, --line 保留本地hosts文件行数 #####\n\n##### 基本要求系统 #####\n* Python3.x.x\n* 应hosts文件权限关系\n* windows需要使用administrator 权限\n* linux需要使用root权限\n\n##### 加入计划任务(windows) #####\n* 打开开始菜单, 搜索框输入**计划任务** 或快捷键[win + r] 粘贴 `%windir%\\system32\\taskschd.msc /s`\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170213417-181074786.png)\n\n* 右击 [任务计划库] -> [创建任务]\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170224932-659219118.png)\n\n* 常规选项卡, 添加名称, 描述\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170321089-2002023170.png)\n\n* 点击触发器选项卡 [新建] 添加触发器, 比如多久运行, 什么时候执行\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228165952292-1171750287.png)\n\n* 点击操作选项卡   [新建] 添加脚本执行\n![](http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170603885-700230869.png)\n\n##### Linux安装方法 #####\n* 添加执行权限. `shell> chmod +x UpdateHosts.py`\n* 添加计划任务. `shell> echo ' 0 09 * * * python /path/to/UpdateHosts.py --line 60 --os linux 2>&1 >/dev/null' >> /var/spool/cron/root`\n* 每天9点半更新, 根据自己时间更新\n\n##### UpdateHosts.py 代码如下(欢迎拍砖)####\n\n```python\n#!/bin/python env\nimport argparse\nfrom urllib import request\n\"\"\"\n    The Script get from github racaljk's hosts project and merge localhost host file.\n    Used: python UPdateHosts.py --help get detail information.\n    Author: Gawim <bigpao.luo@gmail.com>\n    Time: 2015-12-28\n    Require: python3.x.x\n    Notes: please use administrator execute it. before execute script remember backup your hosts file.\n    in the first line of hosts, you can set how many line you don't want replace. for example \n    ```hosts\n        # 11\n        # Copyright (c) 1993-2009 Microsoft Corp.\n        #\n        # This is a sample HOSTS file used by Microsoft TCP/IP for Windows.\n    ```\n    that will keep 11 line\n\"\"\"\n\nWINDOWS_HOST = \"C:\\Windows\\System32\\drivers\\etc\\hosts\"\nLINUX_HOST = \"/etc/hosts\"\nGITHUB_HOSTS = \"https://raw.githubusercontent.com/racaljk/hosts/master/hosts\"  # copy github racaljk hosts project\n\ndef getParam():\n    \"Obtain The Extran Parameters\"\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--start\", help=\"Input The Line Which You Need Not To Replace\", default=\"0\", type=int)\n    parser.add_argument(\"--line\", help=\"Input The Line Which You Need Not To Replace\", default=\"50\", type=int)\n    parser.add_argument(\"--os\", help=\"What System You Use\", default=\"windows\", choices=[\"linux\", \"window\", \"OSX\"])\n\n    return parser.parse_args()\n\ndef getHostsNeedContent(hostsPath, lineStart, lineOffset):\n\n    needHostDomain = []\n    with open(hostsPath, mode=\"r+\", encoding=\"utf-8\") as fileHandle:\n        customerLineNumStr = fileHandle.readline().strip(\"#\").strip();\n        try:\n            customerLineNum = int(customerLineNumStr)\n        except ValueError:\n            customerLineNum = lineOffset\n        fileHandle.seek(lineStart)\n        i = 0\n        while i < customerLineNum:\n            needHostDomain.append(fileHandle.readline())\n            i += 1\n        return \"\".join(needHostDomain)\n\ndef getGitHubHostsAndWriteNewHots(needHostContents, hostsPath):\n    fileHandle = open(hostsPath, mode=\"w\", encoding=\"utf-8\")\n    fileHandle.write(needHostContents)\n    with request.urlopen(GITHUB_HOSTS) as socketHandle:\n        for contents in socketHandle:\n            fileHandle.write(contents.decode(\"utf-8\"))\n    fileHandle.close()\n    return True\n\ndef main():\n    options = getParam()\n    if options.os == \"windows\":\n        hostsPath = WINDOWS_HOST\n    elif options.os == \"linux\":\n        hostsPath = LINUX_HOST\n    elif options.os == \"OSX\":\n        hostsPath = LINUX_HOST\n    else:\n        raise ValueError(\"Please Tell Me What System You Used\")\n    lineStart = options.start\n    lineOffset = options.line\n\n    needHostContents = getHostsNeedContent(hostsPath, lineStart, lineOffset)  # get localhost hosts line need merge default start 0 line 50\n\n    resultSet = getGitHubHostsAndWriteNewHots(needHostContents, hostsPath)  # get github hosts and merge localhost hosts\n    print(resultSet);\n\nif __name__ == \"__main__\":\n    main()\n\n```","slug":"自动更新hosts文件-访问google-facebook","published":1,"updated":"2016-09-15T07:13:28.146Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxv1000x7sqvww1wnoxn","content":"<h5 id=\"脚本自动获取-racaljk-project-hosts文件-racaljk自带更新脚本-个人嫌复杂-写此简单能用版本-和本地hosts文件合并-使用–start-–line-保留本地hosts文件行数\"><a href=\"#脚本自动获取-racaljk-project-hosts文件-racaljk自带更新脚本-个人嫌复杂-写此简单能用版本-和本地hosts文件合并-使用–start-–line-保留本地hosts文件行数\" class=\"headerlink\" title=\"脚本自动获取 racaljk project hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用–start, –line 保留本地hosts文件行数\"></a>脚本自动获取 <a href=\"https://github.com/racaljk/hosts\" target=\"_blank\" rel=\"external\">racaljk project</a> hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用–start, –line 保留本地hosts文件行数</h5><h5 id=\"基本要求系统\"><a href=\"#基本要求系统\" class=\"headerlink\" title=\"基本要求系统\"></a>基本要求系统</h5><ul>\n<li>Python3.x.x</li>\n<li>应hosts文件权限关系</li>\n<li>windows需要使用administrator 权限</li>\n<li>linux需要使用root权限</li>\n</ul>\n<h5 id=\"加入计划任务-windows\"><a href=\"#加入计划任务-windows\" class=\"headerlink\" title=\"加入计划任务(windows)\"></a>加入计划任务(windows)</h5><ul>\n<li><p>打开开始菜单, 搜索框输入<strong>计划任务</strong> 或快捷键[win + r] 粘贴 <code>%windir%\\system32\\taskschd.msc /s</code><br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170213417-181074786.png\" alt=\"\"></p>\n</li>\n<li><p>右击 [任务计划库] -&gt; [创建任务]<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170224932-659219118.png\" alt=\"\"></p>\n</li>\n<li><p>常规选项卡, 添加名称, 描述<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170321089-2002023170.png\" alt=\"\"></p>\n</li>\n<li><p>点击触发器选项卡 [新建] 添加触发器, 比如多久运行, 什么时候执行<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228165952292-1171750287.png\" alt=\"\"></p>\n</li>\n<li><p>点击操作选项卡   [新建] 添加脚本执行<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170603885-700230869.png\" alt=\"\"></p>\n</li>\n</ul>\n<h5 id=\"Linux安装方法\"><a href=\"#Linux安装方法\" class=\"headerlink\" title=\"Linux安装方法\"></a>Linux安装方法</h5><ul>\n<li>添加执行权限. <code>shell&gt; chmod +x UpdateHosts.py</code></li>\n<li>添加计划任务. <code>shell&gt; echo &#39; 0 09 * * * python /path/to/UpdateHosts.py --line 60 --os linux 2&gt;&amp;1 &gt;/dev/null&#39; &gt;&gt; /var/spool/cron/root</code></li>\n<li>每天9点半更新, 根据自己时间更新</li>\n</ul>\n<h5 id=\"UpdateHosts-py-代码如下-欢迎拍砖\"><a href=\"#UpdateHosts-py-代码如下-欢迎拍砖\" class=\"headerlink\" title=\"UpdateHosts.py 代码如下(欢迎拍砖)\"></a>UpdateHosts.py 代码如下(欢迎拍砖)</h5><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/bin/python env</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"string\">\"\"\"</span><br><span class=\"line\">    The Script get from github racaljk's hosts project and merge localhost host file.</span><br><span class=\"line\">    Used: python UPdateHosts.py --help get detail information.</span><br><span class=\"line\">    Author: Gawim &lt;bigpao.luo@gmail.com&gt;</span><br><span class=\"line\">    Time: 2015-12-28</span><br><span class=\"line\">    Require: python3.x.x</span><br><span class=\"line\">    Notes: please use administrator execute it. before execute script remember backup your hosts file.</span><br><span class=\"line\">    in the first line of hosts, you can set how many line you don't want replace. for example </span><br><span class=\"line\">    ```hosts</span><br><span class=\"line\">        # 11</span><br><span class=\"line\">        # Copyright (c) 1993-2009 Microsoft Corp.</span><br><span class=\"line\">        #</span><br><span class=\"line\">        # This is a sample HOSTS file used by Microsoft TCP/IP for Windows.</span></span><br></pre></td></tr></table></figure>\n<pre><code>that will keep 11 line\n</code></pre><p>“””</p>\n<p>WINDOWS_HOST = “C:\\Windows\\System32\\drivers\\etc\\hosts”<br>LINUX_HOST = “/etc/hosts”<br>GITHUB_HOSTS = “<a href=\"https://raw.githubusercontent.com/racaljk/hosts/master/hosts\" target=\"_blank\" rel=\"external\">https://raw.githubusercontent.com/racaljk/hosts/master/hosts</a>“  # copy github racaljk hosts project</p>\n<p>def getParam():<br>    “Obtain The Extran Parameters”<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(“–start”, help=”Input The Line Which You Need Not To Replace”, default=”0”, type=int)<br>    parser.add_argument(“–line”, help=”Input The Line Which You Need Not To Replace”, default=”50”, type=int)<br>    parser.add_argument(“–os”, help=”What System You Use”, default=”windows”, choices=[“linux”, “window”, “OSX”])</p>\n<pre><code>return parser.parse_args()\n</code></pre><p>def getHostsNeedContent(hostsPath, lineStart, lineOffset):</p>\n<pre><code>needHostDomain = []\nwith open(hostsPath, mode=&quot;r+&quot;, encoding=&quot;utf-8&quot;) as fileHandle:\n    customerLineNumStr = fileHandle.readline().strip(&quot;#&quot;).strip();\n    try:\n        customerLineNum = int(customerLineNumStr)\n    except ValueError:\n        customerLineNum = lineOffset\n    fileHandle.seek(lineStart)\n    i = 0\n    while i &lt; customerLineNum:\n        needHostDomain.append(fileHandle.readline())\n        i += 1\n    return &quot;&quot;.join(needHostDomain)\n</code></pre><p>def getGitHubHostsAndWriteNewHots(needHostContents, hostsPath):<br>    fileHandle = open(hostsPath, mode=”w”, encoding=”utf-8”)<br>    fileHandle.write(needHostContents)<br>    with request.urlopen(GITHUB_HOSTS) as socketHandle:<br>        for contents in socketHandle:<br>            fileHandle.write(contents.decode(“utf-8”))<br>    fileHandle.close()<br>    return True</p>\n<p>def main():<br>    options = getParam()<br>    if options.os == “windows”:<br>        hostsPath = WINDOWS_HOST<br>    elif options.os == “linux”:<br>        hostsPath = LINUX_HOST<br>    elif options.os == “OSX”:<br>        hostsPath = LINUX_HOST<br>    else:<br>        raise ValueError(“Please Tell Me What System You Used”)<br>    lineStart = options.start<br>    lineOffset = options.line</p>\n<pre><code>needHostContents = getHostsNeedContent(hostsPath, lineStart, lineOffset)  # get localhost hosts line need merge default start 0 line 50\n\nresultSet = getGitHubHostsAndWriteNewHots(needHostContents, hostsPath)  # get github hosts and merge localhost hosts\nprint(resultSet);\n</code></pre><p>if <strong>name</strong> == “<strong>main</strong>“:<br>    main()</p>\n<p>```</p>\n","excerpt":"","more":"<h5 id=\"脚本自动获取-racaljk-project-hosts文件-racaljk自带更新脚本-个人嫌复杂-写此简单能用版本-和本地hosts文件合并-使用–start-–line-保留本地hosts文件行数\"><a href=\"#脚本自动获取-racaljk-project-hosts文件-racaljk自带更新脚本-个人嫌复杂-写此简单能用版本-和本地hosts文件合并-使用–start-–line-保留本地hosts文件行数\" class=\"headerlink\" title=\"脚本自动获取 racaljk project hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用–start, –line 保留本地hosts文件行数\"></a>脚本自动获取 <a href=\"https://github.com/racaljk/hosts\">racaljk project</a> hosts文件(racaljk自带更新脚本, 个人嫌复杂, 写此简单能用版本), 和本地hosts文件合并, 使用–start, –line 保留本地hosts文件行数</h5><h5 id=\"基本要求系统\"><a href=\"#基本要求系统\" class=\"headerlink\" title=\"基本要求系统\"></a>基本要求系统</h5><ul>\n<li>Python3.x.x</li>\n<li>应hosts文件权限关系</li>\n<li>windows需要使用administrator 权限</li>\n<li>linux需要使用root权限</li>\n</ul>\n<h5 id=\"加入计划任务-windows\"><a href=\"#加入计划任务-windows\" class=\"headerlink\" title=\"加入计划任务(windows)\"></a>加入计划任务(windows)</h5><ul>\n<li><p>打开开始菜单, 搜索框输入<strong>计划任务</strong> 或快捷键[win + r] 粘贴 <code>%windir%\\system32\\taskschd.msc /s</code><br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170213417-181074786.png\" alt=\"\"></p>\n</li>\n<li><p>右击 [任务计划库] -&gt; [创建任务]<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170224932-659219118.png\" alt=\"\"></p>\n</li>\n<li><p>常规选项卡, 添加名称, 描述<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170321089-2002023170.png\" alt=\"\"></p>\n</li>\n<li><p>点击触发器选项卡 [新建] 添加触发器, 比如多久运行, 什么时候执行<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228165952292-1171750287.png\" alt=\"\"></p>\n</li>\n<li><p>点击操作选项卡   [新建] 添加脚本执行<br><img src=\"http://images2015.cnblogs.com/blog/451327/201512/451327-20151228170603885-700230869.png\" alt=\"\"></p>\n</li>\n</ul>\n<h5 id=\"Linux安装方法\"><a href=\"#Linux安装方法\" class=\"headerlink\" title=\"Linux安装方法\"></a>Linux安装方法</h5><ul>\n<li>添加执行权限. <code>shell&gt; chmod +x UpdateHosts.py</code></li>\n<li>添加计划任务. <code>shell&gt; echo &#39; 0 09 * * * python /path/to/UpdateHosts.py --line 60 --os linux 2&gt;&amp;1 &gt;/dev/null&#39; &gt;&gt; /var/spool/cron/root</code></li>\n<li>每天9点半更新, 根据自己时间更新</li>\n</ul>\n<h5 id=\"UpdateHosts-py-代码如下-欢迎拍砖\"><a href=\"#UpdateHosts-py-代码如下-欢迎拍砖\" class=\"headerlink\" title=\"UpdateHosts.py 代码如下(欢迎拍砖)\"></a>UpdateHosts.py 代码如下(欢迎拍砖)</h5><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/bin/python env</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"string\">\"\"\"</span><br><span class=\"line\">    The Script get from github racaljk's hosts project and merge localhost host file.</span><br><span class=\"line\">    Used: python UPdateHosts.py --help get detail information.</span><br><span class=\"line\">    Author: Gawim &lt;bigpao.luo@gmail.com&gt;</span><br><span class=\"line\">    Time: 2015-12-28</span><br><span class=\"line\">    Require: python3.x.x</span><br><span class=\"line\">    Notes: please use administrator execute it. before execute script remember backup your hosts file.</span><br><span class=\"line\">    in the first line of hosts, you can set how many line you don't want replace. for example </span><br><span class=\"line\">    ```hosts</span><br><span class=\"line\">        # 11</span><br><span class=\"line\">        # Copyright (c) 1993-2009 Microsoft Corp.</span><br><span class=\"line\">        #</span><br><span class=\"line\">        # This is a sample HOSTS file used by Microsoft TCP/IP for Windows.</span></span><br></pre></td></tr></table></figure>\n<pre><code>that will keep 11 line\n</code></pre><p>“””</p>\n<p>WINDOWS_HOST = “C:\\Windows\\System32\\drivers\\etc\\hosts”<br>LINUX_HOST = “/etc/hosts”<br>GITHUB_HOSTS = “<a href=\"https://raw.githubusercontent.com/racaljk/hosts/master/hosts\">https://raw.githubusercontent.com/racaljk/hosts/master/hosts</a>“  # copy github racaljk hosts project</p>\n<p>def getParam():<br>    “Obtain The Extran Parameters”<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(“–start”, help=”Input The Line Which You Need Not To Replace”, default=”0”, type=int)<br>    parser.add_argument(“–line”, help=”Input The Line Which You Need Not To Replace”, default=”50”, type=int)<br>    parser.add_argument(“–os”, help=”What System You Use”, default=”windows”, choices=[“linux”, “window”, “OSX”])</p>\n<pre><code>return parser.parse_args()\n</code></pre><p>def getHostsNeedContent(hostsPath, lineStart, lineOffset):</p>\n<pre><code>needHostDomain = []\nwith open(hostsPath, mode=&quot;r+&quot;, encoding=&quot;utf-8&quot;) as fileHandle:\n    customerLineNumStr = fileHandle.readline().strip(&quot;#&quot;).strip();\n    try:\n        customerLineNum = int(customerLineNumStr)\n    except ValueError:\n        customerLineNum = lineOffset\n    fileHandle.seek(lineStart)\n    i = 0\n    while i &lt; customerLineNum:\n        needHostDomain.append(fileHandle.readline())\n        i += 1\n    return &quot;&quot;.join(needHostDomain)\n</code></pre><p>def getGitHubHostsAndWriteNewHots(needHostContents, hostsPath):<br>    fileHandle = open(hostsPath, mode=”w”, encoding=”utf-8”)<br>    fileHandle.write(needHostContents)<br>    with request.urlopen(GITHUB_HOSTS) as socketHandle:<br>        for contents in socketHandle:<br>            fileHandle.write(contents.decode(“utf-8”))<br>    fileHandle.close()<br>    return True</p>\n<p>def main():<br>    options = getParam()<br>    if options.os == “windows”:<br>        hostsPath = WINDOWS_HOST<br>    elif options.os == “linux”:<br>        hostsPath = LINUX_HOST<br>    elif options.os == “OSX”:<br>        hostsPath = LINUX_HOST<br>    else:<br>        raise ValueError(“Please Tell Me What System You Used”)<br>    lineStart = options.start<br>    lineOffset = options.line</p>\n<pre><code>needHostContents = getHostsNeedContent(hostsPath, lineStart, lineOffset)  # get localhost hosts line need merge default start 0 line 50\n\nresultSet = getGitHubHostsAndWriteNewHots(needHostContents, hostsPath)  # get github hosts and merge localhost hosts\nprint(resultSet);\n</code></pre><p>if <strong>name</strong> == “<strong>main</strong>“:<br>    main()</p>\n<p>```</p>\n"},{"title":"chrome vimium 插件简单使用","date":"2016-05-08T10:07:00.000Z","_content":"\n### ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件\n\n#### 安装\n\n1\\. 打开chrome设置\n2\\. 搜索vimium插件，安装它\n\n#### 使用\n\n1\\. 快捷键列表，列出常用部分，其他的可以敲？查看所有列表．也可自己定制．\n\n        ? => 打开帮助\n        j, <c-e> => 向下滚动\n        k, <c-y> => 向上滚动\n        h => 向做滚动，页面很宽\n        l => 向右滚动\n        gg => 滚动到顶部\n        G => 滚动到底部\n        zH => 滚动到最左边\n        zL => 滚动到最右边\n        d => 向下滚一页\n        u => 向上滚一页\n        r => 刷新\n        gs, <c-u> => 查看源码\n        yy => 复制当前ｕｒｌ到剪切板\n        yf => 复制页面中的某一个ｕｒｌ到剪切板\n        p => 当前页打开ｕｒｌ\n        P => 新开一个ｔａｂ页面打开复制的ｕｒｌ\n        f => 打开一个ｕｒｌ在当前页面\n        F => 新开一个页面打开需要的页面\n        o => 打开历史中的一个ｕｒｌ，在当前页面\n        O => 打开历史中的一个ｕｒｌ，在当前页面,新开ｔａｂ\n        T => 打开的页面搜索\n        b => 打开一个标签, 在当前页面\n        B => 打开一个标签, 在新的ｔａｂ\n        H => 历史回退\n        L => 历史前进\n        K, gt => 定位前一个ｔａｂ\n        J, gT => 定位后一个ｔａｂ\n        t => 创建一个新的ｔａｂ\n        yt => 复制当前ｕｒｌ\n        x <c-w> => 关闭当前ｕｒｌ\n        X<c-s-t> => 回复打开的ｕｒｌ\n        << => 移动ｔａｂ到左边\n        >> => 移动ｔａｂ到右边\n","source":"_posts/［chrome／chromium］插件-vimium-简单使用.md","raw":"---\ntitle: chrome vimium 插件简单使用\ntags: []\ndate: 2016-05-08 18:07:00\n---\n\n### ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件\n\n#### 安装\n\n1\\. 打开chrome设置\n2\\. 搜索vimium插件，安装它\n\n#### 使用\n\n1\\. 快捷键列表，列出常用部分，其他的可以敲？查看所有列表．也可自己定制．\n\n        ? => 打开帮助\n        j, <c-e> => 向下滚动\n        k, <c-y> => 向上滚动\n        h => 向做滚动，页面很宽\n        l => 向右滚动\n        gg => 滚动到顶部\n        G => 滚动到底部\n        zH => 滚动到最左边\n        zL => 滚动到最右边\n        d => 向下滚一页\n        u => 向上滚一页\n        r => 刷新\n        gs, <c-u> => 查看源码\n        yy => 复制当前ｕｒｌ到剪切板\n        yf => 复制页面中的某一个ｕｒｌ到剪切板\n        p => 当前页打开ｕｒｌ\n        P => 新开一个ｔａｂ页面打开复制的ｕｒｌ\n        f => 打开一个ｕｒｌ在当前页面\n        F => 新开一个页面打开需要的页面\n        o => 打开历史中的一个ｕｒｌ，在当前页面\n        O => 打开历史中的一个ｕｒｌ，在当前页面,新开ｔａｂ\n        T => 打开的页面搜索\n        b => 打开一个标签, 在当前页面\n        B => 打开一个标签, 在新的ｔａｂ\n        H => 历史回退\n        L => 历史前进\n        K, gt => 定位前一个ｔａｂ\n        J, gT => 定位后一个ｔａｂ\n        t => 创建一个新的ｔａｂ\n        yt => 复制当前ｕｒｌ\n        x <c-w> => 关闭当前ｕｒｌ\n        X<c-s-t> => 回复打开的ｕｒｌ\n        << => 移动ｔａｂ到左边\n        >> => 移动ｔａｂ到右边\n","slug":"［chrome／chromium］插件-vimium-简单使用","published":1,"updated":"2016-09-15T07:13:28.159Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5klxv1000y7sqva0ffg0as","content":"<h3 id=\"vimium插件是一个了让你不用鼠标浏览网页的炸天的插件\"><a href=\"#vimium插件是一个了让你不用鼠标浏览网页的炸天的插件\" class=\"headerlink\" title=\"ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件\"></a>ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>1. 打开chrome设置<br>2. 搜索vimium插件，安装它</p>\n<h4 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h4><p>1. 快捷键列表，列出常用部分，其他的可以敲？查看所有列表．也可自己定制．</p>\n<pre><code>? =&gt; 打开帮助\nj, &lt;c-e&gt; =&gt; 向下滚动\nk, &lt;c-y&gt; =&gt; 向上滚动\nh =&gt; 向做滚动，页面很宽\nl =&gt; 向右滚动\ngg =&gt; 滚动到顶部\nG =&gt; 滚动到底部\nzH =&gt; 滚动到最左边\nzL =&gt; 滚动到最右边\nd =&gt; 向下滚一页\nu =&gt; 向上滚一页\nr =&gt; 刷新\ngs, &lt;c-u&gt; =&gt; 查看源码\nyy =&gt; 复制当前ｕｒｌ到剪切板\nyf =&gt; 复制页面中的某一个ｕｒｌ到剪切板\np =&gt; 当前页打开ｕｒｌ\nP =&gt; 新开一个ｔａｂ页面打开复制的ｕｒｌ\nf =&gt; 打开一个ｕｒｌ在当前页面\nF =&gt; 新开一个页面打开需要的页面\no =&gt; 打开历史中的一个ｕｒｌ，在当前页面\nO =&gt; 打开历史中的一个ｕｒｌ，在当前页面,新开ｔａｂ\nT =&gt; 打开的页面搜索\nb =&gt; 打开一个标签, 在当前页面\nB =&gt; 打开一个标签, 在新的ｔａｂ\nH =&gt; 历史回退\nL =&gt; 历史前进\nK, gt =&gt; 定位前一个ｔａｂ\nJ, gT =&gt; 定位后一个ｔａｂ\nt =&gt; 创建一个新的ｔａｂ\nyt =&gt; 复制当前ｕｒｌ\nx &lt;c-w&gt; =&gt; 关闭当前ｕｒｌ\nX&lt;c-s-t&gt; =&gt; 回复打开的ｕｒｌ\n&lt;&lt; =&gt; 移动ｔａｂ到左边\n&gt;&gt; =&gt; 移动ｔａｂ到右边\n</code></pre>","excerpt":"","more":"<h3 id=\"vimium插件是一个了让你不用鼠标浏览网页的炸天的插件\"><a href=\"#vimium插件是一个了让你不用鼠标浏览网页的炸天的插件\" class=\"headerlink\" title=\"ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件\"></a>ｖｉｍｉｕｍ插件是一个了让你不用鼠标浏览网页的炸天的插件</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>1. 打开chrome设置<br>2. 搜索vimium插件，安装它</p>\n<h4 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h4><p>1. 快捷键列表，列出常用部分，其他的可以敲？查看所有列表．也可自己定制．</p>\n<pre><code>? =&gt; 打开帮助\nj, &lt;c-e&gt; =&gt; 向下滚动\nk, &lt;c-y&gt; =&gt; 向上滚动\nh =&gt; 向做滚动，页面很宽\nl =&gt; 向右滚动\ngg =&gt; 滚动到顶部\nG =&gt; 滚动到底部\nzH =&gt; 滚动到最左边\nzL =&gt; 滚动到最右边\nd =&gt; 向下滚一页\nu =&gt; 向上滚一页\nr =&gt; 刷新\ngs, &lt;c-u&gt; =&gt; 查看源码\nyy =&gt; 复制当前ｕｒｌ到剪切板\nyf =&gt; 复制页面中的某一个ｕｒｌ到剪切板\np =&gt; 当前页打开ｕｒｌ\nP =&gt; 新开一个ｔａｂ页面打开复制的ｕｒｌ\nf =&gt; 打开一个ｕｒｌ在当前页面\nF =&gt; 新开一个页面打开需要的页面\no =&gt; 打开历史中的一个ｕｒｌ，在当前页面\nO =&gt; 打开历史中的一个ｕｒｌ，在当前页面,新开ｔａｂ\nT =&gt; 打开的页面搜索\nb =&gt; 打开一个标签, 在当前页面\nB =&gt; 打开一个标签, 在新的ｔａｂ\nH =&gt; 历史回退\nL =&gt; 历史前进\nK, gt =&gt; 定位前一个ｔａｂ\nJ, gT =&gt; 定位后一个ｔａｂ\nt =&gt; 创建一个新的ｔａｂ\nyt =&gt; 复制当前ｕｒｌ\nx &lt;c-w&gt; =&gt; 关闭当前ｕｒｌ\nX&lt;c-s-t&gt; =&gt; 回复打开的ｕｒｌ\n&lt;&lt; =&gt; 移动ｔａｂ到左边\n&gt;&gt; =&gt; 移动ｔａｂ到右边\n</code></pre>"},{"title":"Haproxy Configuration","date":"2015-07-27T07:52:00.000Z","_content":"\n----------------------\n                                haproxy\n                          configuration manual\n                         ----------------------\n                              version 1.6\n                             willy tarreau\n                              2015/07/22\n\nthis document covers the configuration language as implemented in the version\nspecified above. it does not provide any hint, example or advice. for such\ndocumentation, please refer to the reference manual or the architecture manual.\nthe summary below is meant to help you search sections by name and navigate\nthrough the document.\n\nnote to documentation contributors :\n    this document is formatted with 80 columns per line, with even number of\n    spaces for indentation and without tabs. please follow these rules strictly\n    so that it remains easily printable everywhere. if a line needs to be\n    printed verbatim and does not fit, please end each line with a backslash\n    ('\\') and continue on next line, indented by two characters. it is also\n    sometimes useful to prefix all output lines (logs, console outs) with 3\n    closing angle brackets ('>>>') in order to help get the difference between\n    inputs and outputs when it can become ambiguous. if you add sections,\n    please update the summary below for easier searching.\n\nsummary\n-------\n\n1\\.    quick reminder about http\n1.1\\.      the http transaction model\n1.2\\.      http request\n1.2.1\\.        the request line\n1.2.2\\.        the request headers\n1.3\\.      http response\n1.3.1\\.        the response line\n1.3.2\\.        the response headers\n\n2\\.    configuring haproxy\n2.1\\.      configuration file format\n2.2\\.      quoting and escaping\n2.3\\.      environment variables\n2.4\\.      time format\n2.5\\.      examples\n\n3\\.    global parameters\n3.1\\.      process management and security\n3.2\\.      performance tuning\n3.3\\.      debugging\n3.4\\.      userlists\n3.5\\.      peers\n\n4\\.    proxies\n4.1\\.      proxy keywords matrix\n4.2\\.      alphabetically sorted keywords reference\n\n5\\.    bind and server options\n5.1\\.      bind options\n5.2\\.      server and default-server options\n5.3\\.      server dns resolution\n5.3.1\\.      global overview\n5.3.2\\.      the resolvers section\n\n6\\.    http header manipulation\n\n7\\.    using acls and fetching samples\n7.1\\.      acl basics\n7.1.1\\.      matching booleans\n7.1.2\\.      matching integers\n7.1.3\\.      matching strings\n7.1.4\\.      matching regular expressions (regexes)\n7.1.5\\.      matching arbitrary data blocks\n7.1.6\\.      matching ipv4 and ipv6 addresses\n7.2\\.      using acls to form conditions\n7.3\\.      fetching samples\n7.3.1\\.        converters\n7.3.2\\.        fetching samples from internal states\n7.3.3\\.        fetching samples at layer 4\n7.3.4\\.        fetching samples at layer 5\n7.3.5\\.        fetching samples from buffer contents (layer 6)\n7.3.6\\.        fetching http samples (layer 7)\n7.4\\.      pre-defined acls\n\n8\\.    logging\n8.1\\.      log levels\n8.2\\.      log formats\n8.2.1\\.        default log format\n8.2.2\\.        tcp log format\n8.2.3\\.        http log format\n8.2.4\\.        custom log format\n8.2.5\\.        error log format\n8.3\\.      advanced logging options\n8.3.1\\.        disabling logging of external tests\n8.3.2\\.        logging before waiting for the session to terminate\n8.3.3\\.        raising log level upon errors\n8.3.4\\.        disabling logging of successful connections\n8.4\\.      timing events\n8.5\\.      session state at disconnection\n8.6\\.      non-printable characters\n8.7\\.      capturing http cookies\n8.8\\.      capturing http headers\n8.9\\.      examples of logs\n\n9\\.    statistics and monitoring\n9.1\\.      csv format\n9.2\\.      unix socket commands\n\n1\\. quick reminder about http\n----------------------------\n\nwhen haproxy is running in http mode, both the request and the response are\nfully analyzed and indexed, thus it becomes possible to build matching criteria\non almost anything found in the contents.\n\nhowever, it is important to understand how http requests and responses are\nformed, and how haproxy decomposes them. it will then become easier to write\ncorrect rules and to debug existing configurations.\n\n1.1\\. the http transaction model\n-------------------------------\n\nthe http protocol is transaction-driven. this means that each request will lead\nto one and only one response. traditionally, a tcp connection is established\nfrom the client to the server, a request is sent by the client on the\nconnection, the server responds and the connection is closed. a new request\nwill involve a new connection :\n\n  [con1] [req1] ... [resp1] [clo1] [con2] [req2] ... [resp2] [clo2] ...\n\nin this mode, called the \"http close\" mode, there are as many connection\nestablishments as there are http transactions. since the connection is closed\nby the server after the response, the client does not need to know the content\nlength.\n\ndue to the transactional nature of the protocol, it was possible to improve it\nto avoid closing a connection between two subsequent transactions. in this mode\nhowever, it is mandatory that the server indicates the content length for each\nresponse so that the client does not wait indefinitely. for this, a special\nheader is used: \"content-length\". this mode is called the \"keep-alive\" mode :\n\n  [con] [req1] ... [resp1] [req2] ... [resp2] [clo] ...\n\nits advantages are a reduced latency between transactions, and less processing\npower required on the server side. it is generally better than the close mode,\nbut not always because the clients often limit their concurrent connections to\na smaller value.\n\na last improvement in the communications is the pipelining mode. it still uses\nkeep-alive, but the client does not wait for the first response to send the\nsecond request. this is useful for fetching large number of images composing a\npage :\n\n  [con] [req1] [req2] ... [resp1] [resp2] [clo] ...\n\nthis can obviously have a tremendous benefit on performance because the network\nlatency is eliminated between subsequent requests. many http agents do not\ncorrectly support pipelining since there is no way to associate a response with\nthe corresponding request in http. for this reason, it is mandatory for the\nserver to reply in the exact same order as the requests were received.\n\nby default haproxy operates in keep-alive mode with regards to persistent\nconnections: for each connection it processes each request and response, and\nleaves the connection idle on both sides between the end of a response and the\nstart of a new request.\n\nhaproxy supports 5 connection modes :\n  - keep alive    : all requests and responses are processed (default)\n  - tunnel        : only the first request and response are processed,\n                    everything else is forwarded with no analysis.\n  - passive close : tunnel with \"connection: close\" added in both directions.\n  - server close  : the server-facing connection is closed after the response.\n  - forced close  : the connection is actively closed after end of response.\n\n1.2\\. http request\n-----------------\n\nfirst, let's consider this http request :\n\n  line     contents\n  number\n     1     get /serv/login.php?lang=en&profile=2 http/1.1\n     2     host: www.mydomain.com\n     3     user-agent: my small browser\n     4     accept: image/jpeg, image/gif\n     5     accept: image/png\n\n1.2.1\\. the request line\n-----------------------\n\nline 1 is the \"request line\". it is always composed of 3 fields :\n\n  - a method      : get\n  - a uri         : /serv/login.php?lang=en&profile=2\n  - a version tag : http/1.1\n\nall of them are delimited by what the standard calls lws (linear white spaces),\nwhich are commonly spaces, but can also be tabs or line feeds/carriage returns\nfollowed by spaces/tabs. the method itself cannot contain any colon (':') and\nis limited to alphabetic letters. all those various combinations make it\ndesirable that haproxy performs the splitting itself rather than leaving it to\nthe user to write a complex or inaccurate regular expression.\n\nthe uri itself can have several forms :\n\n  - a \"relative uri\" :\n\n      /serv/login.php?lang=en&profile=2\n\n    it is a complete url without the host part. this is generally what is\n    received by servers, reverse proxies and transparent proxies.\n\n  - an \"absolute uri\", also called a \"url\" :\n\n      http://192.168.0.12:8080/serv/login.php?lang=en&profile=2\n\n    it is composed of a \"scheme\" (the protocol name followed by '://'), a host\n    name or address, optionally a colon (':') followed by a port number, then\n    a relative uri beginning at the first slash ('/') after the address part.\n    this is generally what proxies receive, but a server supporting http/1.1\n    must accept this form too.\n\n  - a star ('*') : this form is only accepted in association with the options\n    method and is not relayable. it is used to inquiry a next hop's\n    capabilities.\n\n  - an address:port combination : 192.168.0.12:80\n    this is used with the connect method, which is used to establish tcp\n    tunnels through http proxies, generally for https, but sometimes for\n    other protocols too.\n\nin a relative uri, two sub-parts are identified. the part before the question\nmark is called the \"path\". it is typically the relative path to static objects\non the server. the part after the question mark is called the \"query string\".\nit is mostly used with get requests sent to dynamic scripts and is very\nspecific to the language, framework or application in use.\n\n1.2.2\\. the request headers\n--------------------------\n\nthe headers start at the second line. they are composed of a name at the\nbeginning of the line, immediately followed by a colon (':'). traditionally,\nan lws is added after the colon but that's not required. then come the values.\nmultiple identical headers may be folded into one single line, delimiting the\nvalues with commas, provided that their order is respected. this is commonly\nencountered in the \"cookie:\" field. a header may span over multiple lines if\nthe subsequent lines begin with an lws. in the example in 1.2, lines 4 and 5\ndefine a total of 3 values for the \"accept:\" header.\n\ncontrary to a common mis-conception, header names are not case-sensitive, and\ntheir values are not either if they refer to other header names (such as the\n\"connection:\" header).\n\nthe end of the headers is indicated by the first empty line. people often say\nthat it's a double line feed, which is not exact, even if a double line feed\nis one valid form of empty line.\n\nfortunately, haproxy takes care of all these complex combinations when indexing\nheaders, checking values and counting them, so there is no reason to worry\nabout the way they could be written, but it is important not to accuse an\napplication of being buggy if it does unusual, valid things.\n\nimportant note:\n   as suggested by rfc2616, haproxy normalizes headers by replacing line breaks\n   in the middle of headers by lws in order to join multi-line headers. this\n   is necessary for proper analysis and helps less capable http parsers to work\n   correctly and not to be fooled by such complex constructs.\n\n1.3\\. http response\n------------------\n\nan http response looks very much like an http request. both are called http\nmessages. let's consider this http response :\n\n  line     contents\n  number\n     1     http/1.1 200 ok\n     2     content-length: 350\n     3     content-type: text/html\n\nas a special case, http supports so called \"informational responses\" as status\ncodes 1xx. these messages are special in that they don't convey any part of the\nresponse, they're just used as sort of a signaling message to ask a client to\ncontinue to post its request for instance. in the case of a status 100 response\nthe requested information will be carried by the next non-100 response message\nfollowing the informational one. this implies that multiple responses may be\nsent to a single request, and that this only works when keep-alive is enabled\n(1xx messages are http/1.1 only). haproxy handles these messages and is able to\ncorrectly forward and skip them, and only process the next non-100 response. as\nsuch, these messages are neither logged nor transformed, unless explicitly\nstate otherwise. status 101 messages indicate that the protocol is changing\nover the same connection and that haproxy must switch to tunnel mode, just as\nif a connect had occurred. then the upgrade header would contain additional\ninformation about the type of protocol the connection is switching to.\n\n1.3.1\\. the response line\n------------------------\n\nline 1 is the \"response line\". it is always composed of 3 fields :\n\n  - a version tag : http/1.1\n  - a status code : 200\n  - a reason      : ok\n\nthe status code is always 3-digit. the first digit indicates a general status :\n - 1xx = informational message to be skipped (eg: 100, 101)\n - 2xx = ok, content is following   (eg: 200, 206)\n - 3xx = ok, no content following   (eg: 302, 304)\n - 4xx = error caused by the client (eg: 401, 403, 404)\n - 5xx = error caused by the server (eg: 500, 502, 503)\n\nplease refer to rfc2616 for the detailed meaning of all such codes. the\n\"reason\" field is just a hint, but is not parsed by clients. anything can be\nfound there, but it's a common practice to respect the well-established\nmessages. it can be composed of one or multiple words, such as \"ok\", \"found\",\nor \"authentication required\".\n\nhaproxy may emit the following status codes by itself :\n\n  code  when / reason\n   200  access to stats page, and when replying to monitoring requests\n   301  when performing a redirection, depending on the configured code\n   302  when performing a redirection, depending on the configured code\n   303  when performing a redirection, depending on the configured code\n   307  when performing a redirection, depending on the configured code\n   308  when performing a redirection, depending on the configured code\n   400  for an invalid or too large request\n   401  when an authentication is required to perform the action (when\n        accessing the stats page)\n   403  when a request is forbidden by a \"block\" acl or \"reqdeny\" filter\n   408  when the request timeout strikes before the request is complete\n   500  when haproxy encounters an unrecoverable internal error, such as a\n        memory allocation failure, which should never happen\n   502  when the server returns an empty, invalid or incomplete response, or\n        when an \"rspdeny\" filter blocks the response.\n   503  when no server was available to handle the request, or in response to\n        monitoring requests which match the \"monitor fail\" condition\n   504  when the response timeout strikes before the server responds\n\nthe error 4xx and 5xx codes above may be customized (see \"errorloc\" in section\n4.2).\n\n1.3.2\\. the response headers\n---------------------------\n\nresponse headers work exactly like request headers, and as such, haproxy uses\nthe same parsing function for both. please refer to paragraph 1.2.2 for more\ndetails.\n\n2\\. configuring haproxy\n----------------------\n\n2.1\\. configuration file format\n------------------------------\n\nhaproxy's configuration process involves 3 major sources of parameters :\n\n  - the arguments from the command-line, which always take precedence\n  - the \"global\" section, which sets process-wide parameters\n  - the proxies sections which can take form of \"defaults\", \"listen\",\n    \"frontend\" and \"backend\".\n\nthe configuration file syntax consists in lines beginning with a keyword\nreferenced in this manual, optionally followed by one or several parameters\ndelimited by spaces.\n\n2.2\\. quoting and escaping\n-------------------------\n\nhaproxy's configuration introduces a quoting and escaping system similar to\nmany programming languages. the configuration file supports 3 types: escaping\nwith a backslash, weak quoting with double quotes, and strong quoting with\nsingle quotes.\n\nif spaces have to be entered in strings, then they must be escaped by preceding\nthem by a backslash ('\\') or by quoting them. backslashes also have to be\nescaped by doubling or strong quoting them.\n\nescaping is achieved by preceding a special character by a backslash ('\\'):\n\n  \\    to mark a space and differentiate it from a delimiter\n  \\#   to mark a hash and differentiate it from a comment\n  \\\\   to use a backslash\n  \\'   to use a single quote and differentiate it from strong quoting\n  \\\"   to use a double quote and differentiate it from weak quoting\n\nweak quoting is achieved by using double quotes (\"\"). weak quoting prevents\nthe interpretation of:\n\n       space as a parameter separator\n  '    single quote as a strong quoting delimiter\n  #    hash as a comment start\n\nweak quoting permits the interpretation of variables, if you want to use a non\n-interpreted dollar within a double quoted string, you should escape it with a\nbackslash (\"\\$\"), it does not work outside weak quoting.\n\ninterpretation of escaping and special characters are not prevented by weak\nquoting.\n\nstrong quoting is achieved by using single quotes (''). inside single quotes,\nnothing is interpreted, it's the efficient way to quote regexes.\n\nquoted and escaped strings are replaced in memory by their interpreted\nequivalent, it allows you to perform concatenation.\n\n  example:\n      # those are equivalents:\n      log-format %{+q}o\\ %t\\ %s\\ %{-q}r\n      log-format \"%{+q}o %t %s %{-q}r\"\n      log-format '%{+q}o %t %s %{-q}r'\n      log-format \"%{+q}o %t\"' %s %{-q}r'\n      log-format \"%{+q}o %t\"' %s'\\ %{-q}r\n\n      # those are equivalents:\n      reqrep \"^([^\\ :]*)\\ /static/(.*)\"     \\1\\ /\\2\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     '\\1 /\\2'\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     \"\\1 /\\2\"\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     \"\\1\\ /\\2\"\n\n2.3\\. environment variables\n--------------------------\n\nhaproxy's configuration supports environment variables. those variables are\ninterpreted only within double quotes. variables are expanded during the\nconfiguration parsing. variable names must be preceded by a dollar (\"$\") and\noptionally enclosed with braces (\"{}\") similarly to what is done in bourne\nshell. variable names can contain alphanumerical characters or the character\nunderscore (\"_\") but should not start with a digit.\n\n  example:\n\n      bind \"fd@${fd_app1}\"\n\n      log \"${local_syslog}:514\" local0 notice   # send to local server\n\n      user \"$haproxy_user\"\n\n2.4\\. time format\n----------------\n\nsome parameters involve values representing time, such as timeouts. these\nvalues are generally expressed in milliseconds (unless explicitly stated\notherwise) but may be expressed in any other unit by suffixing the unit to the\nnumeric value. it is important to consider this because it will not be repeated\nfor every keyword. supported units are :\n\n  - us : microseconds. 1 microsecond = 1/1000000 second\n  - ms : milliseconds. 1 millisecond = 1/1000 second. this is the default.\n  - s  : seconds. 1s = 1000ms\n  - m  : minutes. 1m = 60s = 60000ms\n  - h  : hours.   1h = 60m = 3600s = 3600000ms\n  - d  : days.    1d = 24h = 1440m = 86400s = 86400000ms\n\n2.4\\. examples\n-------------\n\n    # simple configuration for an http proxy listening on port 80 on all\n    # interfaces and forwarding requests to a single backend \"servers\" with a\n    # single server \"server1\" listening on 127.0.0.1:8000\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    frontend http-in\n        bind *:80\n        default_backend servers\n\n    backend servers\n        server server1 127.0.0.1:8000 maxconn 32\n\n    # the same configuration defined with a single listen block. shorter but\n    # less expressive, especially in http mode.\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    listen http-in\n        bind *:80\n        server server1 127.0.0.1:8000 maxconn 32\n\nassuming haproxy is in $path, test these configurations in a shell with:\n\n    $ sudo haproxy -f configuration.conf -c\n\n3\\. global parameters\n--------------------\n\nparameters in the \"global\" section are process-wide and often os-specific. they\nare generally set once for all and do not need being changed once correct. some\nof them have command-line equivalents.\n\nthe following keywords are supported in the \"global\" section :\n\n * process management and security\n   - ca-base\n   - chroot\n   - crt-base\n   - daemon\n   - external-check\n   - gid\n   - group\n   - log\n   - log-send-hostname\n   - nbproc\n   - pidfile\n   - uid\n   - ulimit-n\n   - user\n   - stats\n   - ssl-server-verify\n   - node\n   - description\n   - unix-bind\n   - 51degrees-data-file\n   - 51degrees-property-name-list\n   - 51degrees-property-separator\n   - 51degrees-cache-size\n\n * performance tuning\n   - max-spread-checks\n   - maxconn\n   - maxconnrate\n   - maxcomprate\n   - maxcompcpuusage\n   - maxpipes\n   - maxsessrate\n   - maxsslconn\n   - maxsslrate\n   - noepoll\n   - nokqueue\n   - nopoll\n   - nosplice\n   - nogetaddrinfo\n   - spread-checks\n   - tune.bufsize\n   - tune.chksize\n   - tune.comp.maxlevel\n   - tune.http.cookielen\n   - tune.http.maxhdr\n   - tune.idletimer\n   - tune.lua.forced-yield\n   - tune.lua.maxmem\n   - tune.lua.session-timeout\n   - tune.lua.task-timeout\n   - tune.maxaccept\n   - tune.maxpollevents\n   - tune.maxrewrite\n   - tune.pattern.cache-size\n   - tune.pipesize\n   - tune.rcvbuf.client\n   - tune.rcvbuf.server\n   - tune.sndbuf.client\n   - tune.sndbuf.server\n   - tune.ssl.cachesize\n   - tune.ssl.lifetime\n   - tune.ssl.force-private-cache\n   - tune.ssl.maxrecord\n   - tune.ssl.default-dh-param\n   - tune.ssl.ssl-ctx-cache-size\n   - tune.vars.global-max-size\n   - tune.vars.reqres-max-size\n   - tune.vars.sess-max-size\n   - tune.vars.txn-max-size\n   - tune.zlib.memlevel\n   - tune.zlib.windowsize\n\n * debugging\n   - debug\n   - quiet\n\n3.1\\. process management and security\n------------------------------------\n\nca-base <dir>\n  assigns a default directory to fetch ssl ca certificates and crls from when a\n  relative path is used with \"ca-file\" or \"crl-file\" directives. absolute\n  locations specified in \"ca-file\" and \"crl-file\" prevail and ignore \"ca-base\".\n\nchroot <jail dir>\n  changes current directory to <jail dir> and performs a chroot() there before\n  dropping privileges. this increases the security level in case an unknown\n  vulnerability would be exploited, since it would make it very hard for the\n  attacker to exploit the system. this only works when the process is started\n  with superuser privileges. it is important to ensure that <jail_dir> is both\n  empty and unwritable to anyone.\n\ncpu-map <\"all\"|\"odd\"|\"even\"|process_num> <cpu-set>...\n  on linux 2.6 and above, it is possible to bind a process to a specific cpu\n  set. this means that the process will never run on other cpus. the \"cpu-map\"\n  directive specifies cpu sets for process sets. the first argument is the\n  process number to bind. this process must have a number between 1 and 32 or\n  64, depending on the machine's word size, and any process ids above nbproc\n  are ignored. it is possible to specify all processes at once using \"all\",\n  only odd numbers using \"odd\" or even numbers using \"even\", just like with the\n  \"bind-process\" directive. the second and forthcoming arguments are cpu sets.\n  each cpu set is either a unique number between 0 and 31 or 63 or a range with\n  two such numbers delimited by a dash ('-'). multiple cpu numbers or ranges\n  may be specified, and the processes will be allowed to bind to all of them.\n  obviously, multiple \"cpu-map\" directives may be specified. each \"cpu-map\"\n  directive will replace the previous ones when they overlap.\n\ncrt-base <dir>\n  assigns a default directory to fetch ssl certificates from when a relative\n  path is used with \"crtfile\" directives. absolute locations specified after\n  \"crtfile\" prevail and ignore \"crt-base\".\n\ndaemon\n  makes the process fork into background. this is the recommended mode of\n  operation. it is equivalent to the command line \"-d\" argument. it can be\n  disabled by the command line \"-db\" argument.\n\ndeviceatlas-json-file <path>\n  sets the path of the deviceatlas json data file to be loaded by the api.\n  the path must be a valid json data file and accessible by haproxy process.\n\ndeviceatlas-log-level <value>\n  sets the level of informations returned by the api. this directive is\n  optional and set to 0 by default if not set.\n\ndeviceatlas-separator <char>\n  sets the character separator for the api properties results. this directive\n  is optional and set to | by default if not set.\n\nexternal-check\n  allows the use of an external agent to perform health checks.\n  this is disabled by default as a security precaution.\n  see \"option external-check\".\n\ngid <number>\n  changes the process' group id to <number>. it is recommended that the group\n  id is dedicated to haproxy or to a small set of similar daemons. haproxy must\n  be started with a user belonging to this group, or with superuser privileges.\n  note that if haproxy is started from a user having supplementary groups, it\n  will only be able to drop these groups if started with superuser privileges.\n  see also \"group\" and \"uid\".\n\ngroup <group name>\n  similar to \"gid\" but uses the gid of group name <group name> from /etc/group.\n  see also \"gid\" and \"user\".\n\nlog <address> [len <length>] <facility> [max level [min level]]\n  adds a global syslog server. up to two global servers can be defined. they\n  will receive logs for startups and exits, as well as all logs from proxies\n  configured with \"log global\".\n\n  <address> can be one of:\n\n        - an ipv4 address optionally followed by a colon and a udp port. if\n          no port is specified, 514 is used by default (the standard syslog\n          port).\n\n        - an ipv6 address followed by a colon and optionally a udp port. if\n          no port is specified, 514 is used by default (the standard syslog\n          port).\n\n        - a filesystem path to a unix domain socket, keeping in mind\n          considerations for chroot (be sure the path is accessible inside\n          the chroot) and uid/gid (be sure the path is appropriately\n          writeable).\n\n        you may want to reference some environment variables in the address\n        parameter, see section 2.3 about environment variables.\n\n  <length> is an optional maximum line length. log lines larger than this value\n           will be truncated before being sent. the reason is that syslog\n           servers act differently on log line length. all servers support the\n           default value of 1024, but some servers simply drop larger lines\n           while others do log them. if a server supports long lines, it may\n           make sense to set this value here in order to avoid truncating long\n           lines. similarly, if a server drops long lines, it is preferable to\n           truncate them before sending them. accepted values are 80 to 65535\n           inclusive. the default value of 1024 is generally fine for all\n           standard usages. some specific cases of long captures or\n           json-formated logs may require larger values.\n\n  <facility> must be one of the 24 standard syslog facilities :\n\n          kern   user   mail   daemon auth   syslog lpr    news\n          uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n          local0 local1 local2 local3 local4 local5 local6 local7\n\n  an optional level can be specified to filter outgoing messages. by default,\n  all messages are sent. if a maximum level is specified, only messages with a\n  severity at least as important as this level will be sent. an optional minimum\n  level can be specified. if it is set, logs emitted with a more severe level\n  than this one will be capped to this level. this is used to avoid sending\n  \"emerg\" messages on all terminals on some default syslog configurations.\n  eight levels are known :\n\n          emerg  alert  crit   err    warning notice info  debug\n\nlog-send-hostname [<string>]\n  sets the hostname field in the syslog header. if optional \"string\" parameter\n  is set the header is set to the string contents, otherwise uses the hostname\n  of the system. generally used if one is not relaying logs through an\n  intermediate syslog server or for simply customizing the hostname printed in\n  the logs.\n\nlog-tag <string>\n  sets the tag field in the syslog header to this string. it defaults to the\n  program name as launched from the command line, which usually is \"haproxy\".\n  sometimes it can be useful to differentiate between multiple processes\n  running on the same host. see also the per-proxy \"log-tag\" directive.\n\nlua-load <file>\n  this global directive loads and executes a lua file. this directive can be\n  used multiple times.\n\nnbproc <number>\n  creates <number> processes when going daemon. this requires the \"daemon\"\n  mode. by default, only one process is created, which is the recommended mode\n  of operation. for systems limited to small sets of file descriptors per\n  process, it may be needed to fork multiple daemons. using multiple processes\n  is harder to debug and is really discouraged. see also \"daemon\".\n\npidfile <pidfile>\n  writes pids of all daemons into file <pidfile>. this option is equivalent to\n  the \"-p\" command line argument. the file must be accessible to the user\n  starting the process. see also \"daemon\".\n\nstats bind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] ...\n  limits the stats socket to a certain set of processes numbers. by default the\n  stats socket is bound to all processes, causing a warning to be emitted when\n  nbproc is greater than 1 because there is no way to select the target process\n  when connecting. however, by using this setting, it becomes possible to pin\n  the stats socket to a specific set of processes, typically the first one. the\n  warning will automatically be disabled when this setting is used, whatever\n  the number of processes used. the maximum process id depends on the machine's\n  word size (32 or 64). a better option consists in using the \"process\" setting\n  of the \"stats socket\" line to force the process on each line.\n\nssl-default-bind-ciphers <ciphers>\n  this setting is only available when support for openssl was built in. it sets\n  the default string describing the list of cipher algorithms (\"cipher suite\")\n  that are negotiated during the ssl/tls handshake for all \"bind\" lines which\n  do not explicitly define theirs. the format of the string is defined in\n  \"man 1 ciphers\" from openssl man pages, and can be for instance a string such\n  as \"aes:all:!anull:!enull:+rc4:@strength\" (without quotes). please check the\n  \"bind\" keyword for more information.\n\nssl-default-bind-options [<option>]...\n  this setting is only available when support for openssl was built in. it sets\n  default ssl-options to force on all \"bind\" lines. please check the \"bind\"\n  keyword to see available options.\n\n  example:\n        global\n           ssl-default-bind-options no-sslv3 no-tls-tickets\n\nssl-default-server-ciphers <ciphers>\n  this setting is only available when support for openssl was built in. it\n  sets the default string describing the list of cipher algorithms that are\n  negotiated during the ssl/tls handshake with the server, for all \"server\"\n  lines which do not explicitly define theirs. the format of the string is\n  defined in \"man 1 ciphers\". please check the \"server\" keyword for more\n  information.\n\nssl-default-server-options [<option>]...\n  this setting is only available when support for openssl was built in. it sets\n  default ssl-options to force on all \"server\" lines. please check the \"server\"\n  keyword to see available options.\n\nssl-dh-param-file <file>\n  this setting is only available when support for openssl was built in. it sets\n  the default dh parameters that are used during the ssl/tls handshake when\n  ephemeral diffie-hellman (dhe) key exchange is used, for all \"bind\" lines\n  which do not explicitely define theirs. it will be overridden by custom dh\n  parameters found in a bind certificate file if any. if custom dh parameters\n  are not specified either by using ssl-dh-param-file or by setting them directly\n  in the certificate file, pre-generated dh parameters of the size specified\n  by tune.ssl.default-dh-param will be used. custom parameters are known to be\n  more secure and therefore their use is recommended.\n  custom dh parameters may be generated by using the openssl command\n  \"openssl dhparam <size>\", where size should be at least 2048, as 1024-bit dh\n  parameters should not be considered secure anymore.\n\nssl-server-verify [none|required]\n  the default behavior for ssl verify on servers side. if specified to 'none',\n  servers certificates are not verified. the default is 'required' except if\n  forced using cmdline option '-dv'.\n\nstats socket [<address:port>|<path>] [param*]\n  binds a unix socket to <path> or a tcpv4/v6 address to <address:port>.\n  connections to this socket will return various statistics outputs and even\n  allow some commands to be issued to change some runtime settings. please\n  consult section 9.2 \"unix socket commands\" for more details.\n\n  all parameters supported by \"bind\" lines are supported, for instance to\n  restrict access to some users or their access rights. please consult\n  section 5.1 for more information.\n\nstats timeout <timeout, in milliseconds>\n  the default timeout on the stats socket is set to 10 seconds. it is possible\n  to change this value with \"stats timeout\". the value must be passed in\n  milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.\n\nstats maxconn <connections>\n  by default, the stats socket is limited to 10 concurrent connections. it is\n  possible to change this value with \"stats maxconn\".\n\nuid <number>\n  changes the process' user id to <number>. it is recommended that the user id\n  is dedicated to haproxy or to a small set of similar daemons. haproxy must\n  be started with superuser privileges in order to be able to switch to another\n  one. see also \"gid\" and \"user\".\n\nulimit-n <number>\n  sets the maximum number of per-process file-descriptors to <number>. by\n  default, it is automatically computed, so it is recommended not to use this\n  option.\n\nunix-bind [ prefix <prefix> ] [ mode <mode> ] [ user <user> ] [ uid <uid> ]\n          [ group <group> ] [ gid <gid> ]\n\n  fixes common settings to unix listening sockets declared in \"bind\" statements.\n  this is mainly used to simplify declaration of those unix sockets and reduce\n  the risk of errors, since those settings are most commonly required but are\n  also process-specific. the <prefix> setting can be used to force all socket\n  path to be relative to that directory. this might be needed to access another\n  component's chroot. note that those paths are resolved before haproxy chroots\n  itself, so they are absolute. the <mode>, <user>, <uid>, <group> and <gid>\n  all have the same meaning as their homonyms used by the \"bind\" statement. if\n  both are specified, the \"bind\" statement has priority, meaning that the\n  \"unix-bind\" settings may be seen as process-wide default settings.\n\nuser <user name>\n  similar to \"uid\" but uses the uid of user name <user name> from /etc/passwd.\n  see also \"uid\" and \"group\".\n\nnode <name>\n  only letters, digits, hyphen and underscore are allowed, like in dns names.\n\n  this statement is useful in ha configurations where two or more processes or\n  servers share the same ip address. by setting a different node-name on all\n  nodes, it becomes easy to immediately spot what server is handling the\n  traffic.\n\ndescription <text>\n  add a text that describes the instance.\n\n  please note that it is required to escape certain characters (# for example)\n  and this text is inserted into a html page so you should avoid using\n  \"<\" and \">\" characters.\n\n51degrees-data-file <file path>\n  the path of the 51degrees data file to provide device detection services. the\n  file should be unzipped and accessible by haproxy with relevavnt permissions.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-property-name-list [<string>]\n  a list of 51degrees property names to be load from the dataset. a full list\n  of names is available on the 51degrees website:\n  https://51degrees.com/resources/property-dictionary\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-property-separator <char>\n  a char that will be appended to every property value in a response header\n  containing 51degrees results. if not set that will be set as ','.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-cache-size <number>\n  sets the size of the 51degrees converter cache to <number> entries. this\n  is an lru cache which reminds previous device detections and their results.\n  by default, this cache is disabled.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n3.2\\. performance tuning\n-----------------------\n\nmax-spread-checks <delay in milliseconds>\n  by default, haproxy tries to spread the start of health checks across the\n  smallest health check interval of all the servers in a farm. the principle is\n  to avoid hammering services running on the same server. but when using large\n  check intervals (10 seconds or more), the last servers in the farm take some\n  time before starting to be tested, which can be a problem. this parameter is\n  used to enforce an upper bound on delay between the first and the last check,\n  even if the servers' check intervals are larger. when servers run with\n  shorter intervals, their intervals will be respected though.\n\nmaxconn <number>\n  sets the maximum per-process number of concurrent connections to <number>. it\n  is equivalent to the command-line argument \"-n\". proxies will stop accepting\n  connections when this limit is reached. the \"ulimit-n\" parameter is\n  automatically adjusted according to this value. see also \"ulimit-n\". note:\n  the \"select\" poller cannot reliably use more than 1024 file descriptors on\n  some platforms. if your platform only supports select and reports \"select\n  failed\" on startup, you need to reduce maxconn until it works (slightly\n  below 500 in general). if this value is not set, it will default to the value\n  set in default_maxconn at build time (reported in haproxy -vv) if no memory\n  limit is enforced, or will be computed based on the memory limit, the buffer\n  size, memory allocated to compression, ssl cache size, and use or not of ssl\n  and the associated maxsslconn (which can also be automatic).\n\nmaxconnrate <number>\n  sets the maximum per-process number of connections per second to <number>.\n  proxies will stop accepting connections when this limit is reached. it can be\n  used to limit the global capacity regardless of each frontend capacity. it is\n  important to note that this can only be used as a service protection measure,\n  as there will not necessarily be a fair share between frontends when the\n  limit is reached, so it's a good idea to also limit each frontend to some\n  value close to its expected share. also, lowering tune.maxaccept can improve\n  fairness.\n\nmaxcomprate <number>\n  sets the maximum per-process input compression rate to <number> kilobytes\n  per second.  for each session, if the maximum is reached, the compression\n  level will be decreased during the session. if the maximum is reached at the\n  beginning of a session, the session will not compress at all. if the maximum\n  is not reached, the compression level will be increased up to\n  tune.comp.maxlevel.  a value of zero means there is no limit, this is the\n  default value.\n\nmaxcompcpuusage <number>\n  sets the maximum cpu usage haproxy can reach before stopping the compression\n  for new requests or decreasing the compression level of current requests.\n  it works like 'maxcomprate' but measures cpu usage instead of incoming data\n  bandwidth. the value is expressed in percent of the cpu used by haproxy. in\n  case of multiple processes (nbproc > 1), each process manages its individual\n  usage. a value of 100 disable the limit. the default value is 100\\. setting\n  a lower value will prevent the compression work from slowing the whole\n  process down and from introducing high latencies.\n\nmaxpipes <number>\n  sets the maximum per-process number of pipes to <number>. currently, pipes\n  are only used by kernel-based tcp splicing. since a pipe contains two file\n  descriptors, the \"ulimit-n\" value will be increased accordingly. the default\n  value is maxconn/4, which seems to be more than enough for most heavy usages.\n  the splice code dynamically allocates and releases pipes, and can fall back\n  to standard copy, so setting this value too low may only impact performance.\n\nmaxsessrate <number>\n  sets the maximum per-process number of sessions per second to <number>.\n  proxies will stop accepting connections when this limit is reached. it can be\n  used to limit the global capacity regardless of each frontend capacity. it is\n  important to note that this can only be used as a service protection measure,\n  as there will not necessarily be a fair share between frontends when the\n  limit is reached, so it's a good idea to also limit each frontend to some\n  value close to its expected share. also, lowering tune.maxaccept can improve\n  fairness.\n\nmaxsslconn <number>\n  sets the maximum per-process number of concurrent ssl connections to\n  <number>. by default there is no ssl-specific limit, which means that the\n  global maxconn setting will apply to all connections. setting this limit\n  avoids having openssl use too much memory and crash when malloc returns null\n  (since it unfortunately does not reliably check for such conditions). note\n  that the limit applies both to incoming and outgoing connections, so one\n  connection which is deciphered then ciphered accounts for 2 ssl connections.\n  if this value is not set, but a memory limit is enforced, this value will be\n  automatically computed based on the memory limit, maxconn,  the buffer size,\n  memory allocated to compression, ssl cache size, and use of ssl in either\n  frontends, backends or both. if neither maxconn nor maxsslconn are specified\n  when there is a memory limit, haproxy will automatically adjust these values\n  so that 100% of the connections can be made over ssl with no risk, and will\n  consider the sides where it is enabled (frontend, backend, both).\n\nmaxsslrate <number>\n  sets the maximum per-process number of ssl sessions per second to <number>.\n  ssl listeners will stop accepting connections when this limit is reached. it\n  can be used to limit the global ssl cpu usage regardless of each frontend\n  capacity. it is important to note that this can only be used as a service\n  protection measure, as there will not necessarily be a fair share between\n  frontends when the limit is reached, so it's a good idea to also limit each\n  frontend to some value close to its expected share. it is also important to\n  note that the sessions are accounted before they enter the ssl stack and not\n  after, which also protects the stack against bad handshakes. also, lowering\n  tune.maxaccept can improve fairness.\n\nmaxzlibmem <number>\n  sets the maximum amount of ram in megabytes per process usable by the zlib.\n  when the maximum amount is reached, future sessions will not compress as long\n  as ram is unavailable. when sets to 0, there is no limit.\n  the default value is 0\\. the value is available in bytes on the unix socket\n  with \"show info\" on the line \"maxzlibmemusage\", the memory used by zlib is\n  \"zlibmemusage\" in bytes.\n\nnoepoll\n  disables the use of the \"epoll\" event polling system on linux. it is\n  equivalent to the command-line argument \"-de\". the next polling system\n  used will generally be \"poll\". see also \"nopoll\".\n\nnokqueue\n  disables the use of the \"kqueue\" event polling system on bsd. it is\n  equivalent to the command-line argument \"-dk\". the next polling system\n  used will generally be \"poll\". see also \"nopoll\".\n\nnopoll\n  disables the use of the \"poll\" event polling system. it is equivalent to the\n  command-line argument \"-dp\". the next polling system used will be \"select\".\n  it should never be needed to disable \"poll\" since it's available on all\n  platforms supported by haproxy. see also \"nokqueue\" and \"noepoll\".\n\nnosplice\n  disables the use of kernel tcp splicing between sockets on linux. it is\n  equivalent to the command line argument \"-ds\".  data will then be copied\n  using conventional and more portable recv/send calls. kernel tcp splicing is\n  limited to some very recent instances of kernel 2.6\\. most versions between\n  2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not\n  be used. this option makes it easier to globally disable kernel splicing in\n  case of doubt. see also \"option splice-auto\", \"option splice-request\" and\n  \"option splice-response\".\n\nnogetaddrinfo\n  disables the use of getaddrinfo(3) for name resolving. it is equivalent to\n  the command line argument \"-dg\". deprecated gethostbyname(3) will be used.\n\nspread-checks <0..50, in percent>\n  sometimes it is desirable to avoid sending agent and health checks to\n  servers at exact intervals, for instance when many logical servers are\n  located on the same physical server. with the help of this parameter, it\n  becomes possible to add some randomness in the check interval between 0\n  and +/- 50%. a value between 2 and 5 seems to show good results. the\n  default value remains at 0.\n\ntune.buffers.limit <number>\n  sets a hard limit on the number of buffers which may be allocated per process.\n  the default value is zero which means unlimited. the minimum non-zero value\n  will always be greater than \"tune.buffers.reserve\" and should ideally always\n  be about twice as large. forcing this value can be particularly useful to\n  limit the amount of memory a process may take, while retaining a sane\n  behaviour. when this limit is reached, sessions which need a buffer wait for\n  another one to be released by another session. since buffers are dynamically\n  allocated and released, the waiting time is very short and not perceptible\n  provided that limits remain reasonable. in fact sometimes reducing the limit\n  may even increase performance by increasing the cpu cache's efficiency. tests\n  have shown good results on average http traffic with a limit to 1/10 of the\n  expected global maxconn setting, which also significantly reduces memory\n  usage. the memory savings come from the fact that a number of connections\n  will not allocate 2*tune.bufsize. it is best not to touch this value unless\n  advised to do so by an haproxy core developer.\n\ntune.buffers.reserve <number>\n  sets the number of buffers which are pre-allocated and reserved for use only\n  during memory shortage conditions resulting in failed memory allocations. the\n  minimum value is 2 and is also the default. there is no reason a user would\n  want to change this value, it's mostly aimed at haproxy core developers.\n\ntune.bufsize <number>\n  sets the buffer size to this size (in bytes). lower values allow more\n  sessions to coexist in the same amount of ram, and higher values allow some\n  applications with very large cookies to work. the default value is 16384 and\n  can be changed at build time. it is strongly recommended not to change this\n  from the default value, as very low values will break some services such as\n  statistics, and values larger than default size will increase memory usage,\n  possibly causing the system to run out of memory. at least the global maxconn\n  parameter should be decreased by the same factor as this one is increased.\n  if http request is larger than (tune.bufsize - tune.maxrewrite), haproxy will\n  return http 400 (bad request) error. similarly if an http response is larger\n  than this size, haproxy will return http 502 (bad gateway).\n\ntune.chksize <number>\n  sets the check buffer size to this size (in bytes). higher values may help\n  find string or regex patterns in very large pages, though doing so may imply\n  more memory and cpu usage. the default value is 16384 and can be changed at\n  build time. it is not recommended to change this value, but to use better\n  checks whenever possible.\n\ntune.comp.maxlevel <number>\n  sets the maximum compression level. the compression level affects cpu\n  usage during compression. this value affects cpu usage during compression.\n  each session using compression initializes the compression algorithm with\n  this value. the default value is 1.\n\ntune.http.cookielen <number>\n  sets the maximum length of captured cookies. this is the maximum value that\n  the \"capture cookie xxx len yyy\" will be allowed to take, and any upper value\n  will automatically be truncated to this one. it is important not to set too\n  high a value because all cookie captures still allocate this size whatever\n  their configured value (they share a same pool). this value is per request\n  per response, so the memory allocated is twice this value per connection.\n  when not specified, the limit is set to 63 characters. it is recommended not\n  to change this value.\n\ntune.http.maxhdr <number>\n  sets the maximum number of headers in a request. when a request comes with a\n  number of headers greater than this value (including the first line), it is\n  rejected with a \"400 bad request\" status code. similarly, too large responses\n  are blocked with \"502 bad gateway\". the default value is 101, which is enough\n  for all usages, considering that the widely deployed apache server uses the\n  same limit. it can be useful to push this limit further to temporarily allow\n  a buggy application to work by the time it gets fixed. keep in mind that each\n  new header consumes 32bits of memory for each session, so don't push this\n  limit too high.\n\ntune.idletimer <timeout>\n  sets the duration after which haproxy will consider that an empty buffer is\n  probably associated with an idle stream. this is used to optimally adjust\n  some packet sizes while forwarding large and small data alternatively. the\n  decision to use splice() or to send large buffers in ssl is modulated by this\n  parameter. the value is in milliseconds between 0 and 65535\\. a value of zero\n  means that haproxy will not try to detect idle streams. the default is 1000,\n  which seems to correctly detect end user pauses (eg: read a page before\n  clicking). there should be not reason for changing this value. please check\n  tune.ssl.maxrecord below.\n\ntune.lua.forced-yield <number>\n  this directive forces the lua engine to execute a yield each <number> of\n  instructions executed. this permits interruptng a long script and allows the\n  haproxy scheduler to process other tasks like accepting connections or\n  forwarding traffic. the default value is 10000 instructions. if haproxy often\n  executes some lua code but more reactivity is required, this value can be\n  lowered. if the lua code is quite long and its result is absolutely required\n  to process the data, the <number> can be increased.\n\ntune.lua.maxmem\n  sets the maximum amount of ram in megabytes per process usable by lua. by\n  default it is zero which means unlimited. it is important to set a limit to\n  ensure that a bug in a script will not result in the system running out of\n  memory.\n\ntune.lua.session-timeout <timeout>\n  this is the execution timeout for the lua sessions. this is useful for\n  preventing infinite loops or spending too much time in lua. this timeout has a\n  priority over other timeouts. for example, if this timeout is set to 4s and\n  you run a 5s sleep, the code will be interrupted with an error after waiting\n  4s.\n\ntune.lua.task-timeout <timeout>\n  purpose is the same as \"tune.lua.session-timeout\", but this timeout is\n  dedicated to the tasks. by default, this timeout isn't set because a task may\n  remain alive during of the lifetime of haproxy. for example, a task used to\n  check servers.\n\ntune.maxaccept <number>\n  sets the maximum number of consecutive connections a process may accept in a\n  row before switching to other work. in single process mode, higher numbers\n  give better performance at high connection rates. however in multi-process\n  modes, keeping a bit of fairness between processes generally is better to\n  increase performance. this value applies individually to each listener, so\n  that the number of processes a listener is bound to is taken into account.\n  this value defaults to 64\\. in multi-process mode, it is divided by twice\n  the number of processes the listener is bound to. setting this value to -1\n  completely disables the limitation. it should normally not be needed to tweak\n  this value.\n\ntune.maxpollevents <number>\n  sets the maximum amount of events that can be processed at once in a call to\n  the polling system. the default value is adapted to the operating system. it\n  has been noticed that reducing it below 200 tends to slightly decrease\n  latency at the expense of network bandwidth, and increasing it above 200\n  tends to trade latency for slightly increased bandwidth.\n\ntune.maxrewrite <number>\n  sets the reserved buffer space to this size in bytes. the reserved space is\n  used for header rewriting or appending. the first reads on sockets will never\n  fill more than bufsize-maxrewrite. historically it has defaulted to half of\n  bufsize, though that does not make much sense since there are rarely large\n  numbers of headers to add. setting it too high prevents processing of large\n  requests or responses. setting it too low prevents addition of new headers\n  to already large requests or to post requests. it is generally wise to set it\n  to about 1024\\. it is automatically readjusted to half of bufsize if it is\n  larger than that. this means you don't have to worry about it when changing\n  bufsize.\n\ntune.pattern.cache-size <number>\n  sets the size of the pattern lookup cache to <number> entries. this is an lru\n  cache which reminds previous lookups and their results. it is used by acls\n  and maps on slow pattern lookups, namely the ones using the \"sub\", \"reg\",\n  \"dir\", \"dom\", \"end\", \"bin\" match methods as well as the case-insensitive\n  strings. it applies to pattern expressions which means that it will be able\n  to memorize the result of a lookup among all the patterns specified on a\n  configuration line (including all those loaded from files). it automatically\n  invalidates entries which are updated using http actions or on the cli. the\n  default cache size is set to 10000 entries, which limits its footprint to\n  about 5 mb on 32-bit systems and 8 mb on 64-bit systems. there is a very low\n  risk of collision in this cache, which is in the order of the size of the\n  cache divided by 2^64\\. typically, at 10000 requests per second with the\n  default cache size of 10000 entries, there's 1% chance that a brute force\n  attack could cause a single collision after 60 years, or 0.1% after 6 years.\n  this is considered much lower than the risk of a memory corruption caused by\n  aging components. if this is not acceptable, the cache can be disabled by\n  setting this parameter to 0.\n\ntune.pipesize <number>\n  sets the kernel pipe buffer size to this size (in bytes). by default, pipes\n  are the default size for the system. but sometimes when using tcp splicing,\n  it can improve performance to increase pipe sizes, especially if it is\n  suspected that pipes are not filled and that many calls to splice() are\n  performed. this has an impact on the kernel's memory footprint, so this must\n  not be changed if impacts are not understood.\n\ntune.rcvbuf.client <number>\ntune.rcvbuf.server <number>\n  forces the kernel socket receive buffer size on the client or the server side\n  to the specified value in bytes. this value applies to all tcp/http frontends\n  and backends. it should normally never be set, and the default size (0) lets\n  the kernel autotune this value depending on the amount of available memory.\n  however it can sometimes help to set it to very low values (eg: 4096) in\n  order to save kernel memory by preventing it from buffering too large amounts\n  of received data. lower values will significantly increase cpu usage though.\n\ntune.sndbuf.client <number>\ntune.sndbuf.server <number>\n  forces the kernel socket send buffer size on the client or the server side to\n  the specified value in bytes. this value applies to all tcp/http frontends\n  and backends. it should normally never be set, and the default size (0) lets\n  the kernel autotune this value depending on the amount of available memory.\n  however it can sometimes help to set it to very low values (eg: 4096) in\n  order to save kernel memory by preventing it from buffering too large amounts\n  of received data. lower values will significantly increase cpu usage though.\n  another use case is to prevent write timeouts with extremely slow clients due\n  to the kernel waiting for a large part of the buffer to be read before\n  notifying haproxy again.\n\ntune.ssl.cachesize <number>\n  sets the size of the global ssl session cache, in a number of blocks. a block\n  is large enough to contain an encoded session without peer certificate.\n  an encoded session with peer certificate is stored in multiple blocks\n  depending on the size of the peer certificate. a block uses approximately\n  200 bytes of memory. the default value may be forced at build time, otherwise\n  defaults to 20000\\.  when the cache is full, the most idle entries are purged\n  and reassigned. higher values reduce the occurrence of such a purge, hence\n  the number of cpu-intensive ssl handshakes by ensuring that all users keep\n  their session as long as possible. all entries are pre-allocated upon startup\n  and are shared between all processes if \"nbproc\" is greater than 1\\. setting\n  this value to 0 disables the ssl session cache.\n\ntune.ssl.force-private-cache\n  this boolean disables ssl session cache sharing between all processes. it\n  should normally not be used since it will force many renegotiations due to\n  clients hitting a random process. but it may be required on some operating\n  systems where none of the ssl cache synchronization method may be used. in\n  this case, adding a first layer of hash-based load balancing before the ssl\n  layer might limit the impact of the lack of session sharing.\n\ntune.ssl.lifetime <timeout>\n  sets how long a cached ssl session may remain valid. this time is expressed\n  in seconds and defaults to 300 (5 min). it is important to understand that it\n  does not guarantee that sessions will last that long, because if the cache is\n  full, the longest idle sessions will be purged despite their configured\n  lifetime. the real usefulness of this setting is to prevent sessions from\n  being used for too long.\n\ntune.ssl.maxrecord <number>\n  sets the maximum amount of bytes passed to ssl_write() at a time. default\n  value 0 means there is no limit. over ssl/tls, the client can decipher the\n  data only once it has received a full record. with large records, it means\n  that clients might have to download up to 16kb of data before starting to\n  process them. limiting the value can improve page load times on browsers\n  located over high latency or low bandwidth networks. it is suggested to find\n  optimal values which fit into 1 or 2 tcp segments (generally 1448 bytes over\n  ethernet with tcp timestamps enabled, or 1460 when timestamps are disabled),\n  keeping in mind that ssl/tls add some overhead. typical values of 1419 and\n  2859 gave good results during tests. use \"strace -e trace=write\" to find the\n  best value. haproxy will automatically switch to this setting after an idle\n  stream has been detected (see tune.idletimer above).\n\ntune.ssl.default-dh-param <number>\n  sets the maximum size of the diffie-hellman parameters used for generating\n  the ephemeral/temporary diffie-hellman key in case of dhe key exchange. the\n  final size will try to match the size of the server's rsa (or dsa) key (e.g,\n  a 2048 bits temporary dh key for a 2048 bits rsa key), but will not exceed\n  this maximum value. default value if 1024\\. only 1024 or higher values are\n  allowed. higher values will increase the cpu load, and values greater than\n  1024 bits are not supported by java 7 and earlier clients. this value is not\n  used if static diffie-hellman parameters are supplied either directly\n  in the certificate file or by using the ssl-dh-param-file parameter.\n\ntune.ssl.ssl-ctx-cache-size <number>\n  sets the size of the cache used to store generated certificates to <number>\n  entries. this is a lru cache. because generating a ssl certificate\n  dynamically is expensive, they are cached. the default cache size is set to\n  1000 entries.\n\ntune.vars.global-max-size <size>\ntune.vars.reqres-max-size <size>\ntune.vars.sess-max-size <size>\ntune.vars.txn-max-size <size>\n  these four tunes helps to manage the allowed amount of memory used by the\n  variables system. \"global\" limits the memory for all the systems. \"sess\" limit\n  the memory by session, \"txn\" limits the memory by transaction and \"reqres\"\n  limits the memory for each request or response processing. during the\n  accounting, \"sess\" embbed \"txn\" and \"txn\" embed \"reqres\".\n\n  by example, we considers that \"tune.vars.sess-max-size\" is fixed to 100,\n  \"tune.vars.txn-max-size\" is fixed to 100, \"tune.vars.reqres-max-size\" is\n  also fixed to 100\\. if we create a variable \"txn.var\" that contains 100 bytes,\n  we cannot create any more variable in the other contexts.\n\ntune.zlib.memlevel <number>\n  sets the memlevel parameter in zlib initialization for each session. it\n  defines how much memory should be allocated for the internal compression\n  state. a value of 1 uses minimum memory but is slow and reduces compression\n  ratio, a value of 9 uses maximum memory for optimal speed.  can be a value\n  between 1 and 9\\. the default value is 8.\n\ntune.zlib.windowsize <number>\n  sets the window size (the size of the history buffer) as a parameter of the\n  zlib initialization for each session. larger values of this parameter result\n  in better compression at the expense of memory usage.  can be a value between\n  8 and 15\\.  the default value is 15.\n\n3.3\\. debugging\n--------------\n\ndebug\n  enables debug mode which dumps to stdout all exchanges, and disables forking\n  into background. it is the equivalent of the command-line argument \"-d\". it\n  should never be used in a production configuration since it may prevent full\n  system startup.\n\nquiet\n  do not display any message during startup. it is equivalent to the command-\n  line argument \"-q\".\n\n3.4\\. userlists\n--------------\nit is possible to control access to frontend/backend/listen sections or to\nhttp stats by allowing only authenticated and authorized users. to do this,\nit is required to create at least one userlist and to define users.\n\nuserlist <listname>\n  creates new userlist with name <listname>. many independent userlists can be\n  used to store authentication & authorization data for independent customers.\n\ngroup <groupname> [users <user>,<user>,(...)]\n  adds group <groupname> to the current userlist. it is also possible to\n  attach users to this group by using a comma separated list of names\n  proceeded by \"users\" keyword.\n\nuser <username> [password|insecure-password <password>]\n                [groups <group>,<group>,(...)]\n  adds user <username> to the current userlist. both secure (encrypted) and\n  insecure (unencrypted) passwords can be used. encrypted passwords are\n  evaluated using the crypt(3) function so depending of the system's\n  capabilities, different algorithms are supported. for example modern glibc\n  based linux system supports md5, sha-256, sha-512 and of course classic,\n  des-based method of encrypting passwords.\n\n  example:\n        userlist l1\n          group g1 users tiger,scott\n          group g2 users xdb,scott\n\n          user tiger password $6$k6y3o.ep$jlkbx9za9667qe4(...)xhswrv6j.c0/d7cv91\n          user scott insecure-password elgato\n          user xdb insecure-password hello\n\n        userlist l2\n          group g1\n          group g2\n\n          user tiger password $6$k6y3o.ep$jlkbx(...)xhswrv6j.c0/d7cv91 groups g1\n          user scott insecure-password elgato groups g1,g2\n          user xdb insecure-password hello groups g2\n\n  please note that both lists are functionally identical.\n\n3.5\\. peers\n----------\nit is possible to propagate entries of any data-types in stick-tables between\nseveral haproxy instances over tcp connections in a multi-master fashion. each\ninstance pushes its local updates and insertions to remote peers. the pushed\nvalues overwrite remote ones without aggregation. interrupted exchanges are\nautomatically detected and recovered from the last known point.\nin addition, during a soft restart, the old process connects to the new one\nusing such a tcp connection to push all its entries before the new process\ntries to connect to other peers. that ensures very fast replication during a\nreload, it typically takes a fraction of a second even for large tables.\nnote that server ids are used to identify servers remotely, so it is important\nthat configurations look similar or at least that the same ids are forced on\neach server on all participants.\n\npeers <peersect>\n  creates a new peer list with name <peersect>. it is an independent section,\n  which is referenced by one or more stick-tables.\n\ndisabled\n  disables a peers section. it disables both listening and any synchronization\n  related to this section. this is provided to disable synchronization of stick\n  tables without having to comment out all \"peers\" references.\n\nenable\n  this re-enables a disabled peers section which was previously disabled.\n\npeer <peername> <ip>:<port>\n  defines a peer inside a peers section.\n  if <peername> is set to the local peer name (by default hostname, or forced\n  using \"-l\" command line option), haproxy will listen for incoming remote peer\n  connection on <ip>:<port>. otherwise, <ip>:<port> defines where to connect to\n  to join the remote peer, and <peername> is used at the protocol level to\n  identify and validate the remote peer on the server side.\n\n  during a soft restart, local peer <ip>:<port> is used by the old instance to\n  connect the new one and initiate a complete replication (teaching process).\n\n  it is strongly recommended to have the exact same peers declaration on all\n  peers and to only rely on the \"-l\" command line argument to change the local\n  peer name. this makes it easier to maintain coherent configuration files\n  across all peers.\n\n  you may want to reference some environment variables in the address\n  parameter, see section 2.3 about environment variables.\n\n  example:\n    peers mypeers\n        peer haproxy1 192.168.0.1:1024\n        peer haproxy2 192.168.0.2:1024\n        peer haproxy3 10.2.0.1:1024\n\n    backend mybackend\n        mode tcp\n        balance roundrobin\n        stick-table type ip size 20k peers mypeers\n        stick on src\n\n        server srv1 192.168.0.30:80\n        server srv2 192.168.0.31:80\n\n3.6\\. mailers\n------------\nit is possible to send email alerts when the state of servers changes.\nif configured email alerts are sent to each mailer that is configured\nin a mailers section. email is sent to mailers using smtp.\n\nmailer <mailersect>\n  creates a new mailer list with the name <mailersect>. it is an\n  independent section which is referenced by one or more proxies.\n\nmailer <mailername> <ip>:<port>\n  defines a mailer inside a mailers section.\n\n  example:\n    mailers mymailers\n        mailer smtp1 192.168.0.1:587\n        mailer smtp2 192.168.0.2:587\n\n    backend mybackend\n        mode tcp\n        balance roundrobin\n\n        email-alert mailers mymailers\n        email-alert from test1@horms.org\n        email-alert to test2@horms.org\n\n        server srv1 192.168.0.30:80\n        server srv2 192.168.0.31:80\n\n4\\. proxies\n----------\n\nproxy configuration can be located in a set of sections :\n - defaults [<name>]\n - frontend <name>\n - backend  <name>\n - listen   <name>\n\na \"defaults\" section sets default parameters for all other sections following\nits declaration. those default parameters are reset by the next \"defaults\"\nsection. see below for the list of parameters which can be set in a \"defaults\"\nsection. the name is optional but its use is encouraged for better readability.\n\na \"frontend\" section describes a set of listening sockets accepting client\nconnections.\n\na \"backend\" section describes a set of servers to which the proxy will connect\nto forward incoming connections.\n\na \"listen\" section defines a complete proxy with its frontend and backend\nparts combined in one section. it is generally useful for tcp-only traffic.\n\nall proxy names must be formed from upper and lower case letters, digits,\n'-' (dash), '_' (underscore) , '.' (dot) and ':' (colon). acl names are\ncase-sensitive, which means that \"www\" and \"www\" are two different proxies.\n\nhistorically, all proxy names could overlap, it just caused troubles in the\nlogs. since the introduction of content switching, it is mandatory that two\nproxies with overlapping capabilities (frontend/backend) have different names.\nhowever, it is still permitted that a frontend and a backend share the same\nname, as this configuration seems to be commonly encountered.\n\nright now, two major proxy modes are supported : \"tcp\", also known as layer 4,\nand \"http\", also known as layer 7\\. in layer 4 mode, haproxy simply forwards\nbidirectional traffic between two sides. in layer 7 mode, haproxy analyzes the\nprotocol, and can interact with it by allowing, blocking, switching, adding,\nmodifying, or removing arbitrary contents in requests or responses, based on\narbitrary criteria.\n\nin http mode, the processing applied to requests and responses flowing over\na connection depends in the combination of the frontend's http options and\nthe backend's. haproxy supports 5 connection modes :\n\n  - kal : keep alive (\"option http-keep-alive\") which is the default mode : all\n    requests and responses are processed, and connections remain open but idle\n    between responses and new requests.\n\n  - tun: tunnel (\"option http-tunnel\") : this was the default mode for versions\n    1.0 to 1.5-dev21 : only the first request and response are processed, and\n    everything else is forwarded with no analysis at all. this mode should not\n    be used as it creates lots of trouble with logging and http processing.\n\n  - pcl: passive close (\"option httpclose\") : exactly the same as tunnel mode,\n    but with \"connection: close\" appended in both directions to try to make\n    both ends close after the first request/response exchange.\n\n  - scl: server close (\"option http-server-close\") : the server-facing\n    connection is closed after the end of the response is received, but the\n    client-facing connection remains open.\n\n  - fcl: forced close (\"option forceclose\") : the connection is actively closed\n    after the end of the response.\n\nthe effective mode that will be applied to a connection passing through a\nfrontend and a backend can be determined by both proxy modes according to the\nfollowing matrix, but in short, the modes are symmetric, keep-alive is the\nweakest option and force close is the strongest.\n\n                          backend mode\n\n                | kal | tun | pcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            kal | kal | tun | pcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            tun | tun | tun | pcl | scl | fcl\n frontend   ----+-----+-----+-----+-----+----\n   mode     pcl | pcl | pcl | pcl | fcl | fcl\n            ----+-----+-----+-----+-----+----\n            scl | scl | scl | fcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            fcl | fcl | fcl | fcl | fcl | fcl\n\n4.1\\. proxy keywords matrix\n--------------------------\n\nthe following list of keywords is supported. most of them may only be used in a\nlimited set of section types. some of them are marked as \"deprecated\" because\nthey are inherited from an old syntax which may be confusing or functionally\nlimited, and there are new recommended keywords to replace them. keywords\nmarked with \"(*)\" can be optionally inverted using the \"no\" prefix, eg. \"no\noption contstats\". this makes sense when the option has been enabled by default\nand must be disabled for a specific instance. such options may also be prefixed\nwith \"default\" in order to restore default settings regardless of what has been\nspecified in a previous \"defaults\" section.\n\n keyword                              defaults   frontend   listen    backend\n------------------------------------+----------+----------+---------+---------\nacl                                       -          x         x         x\nappsession                                -          -         x         x\nbacklog                                   x          x         x         -\nbalance                                   x          -         x         x\nbind                                      -          x         x         -\nbind-process                              x          x         x         x\nblock                                     -          x         x         x\ncapture cookie                            -          x         x         -\ncapture request header                    -          x         x         -\ncapture response header                   -          x         x         -\nclitimeout                  (deprecated)  x          x         x         -\ncompression                               x          x         x         x\ncontimeout                  (deprecated)  x          -         x         x\ncookie                                    x          -         x         x\ndeclare capture                           -          x         x         -\ndefault-server                            x          -         x         x\ndefault_backend                           x          x         x         -\ndescription                               -          x         x         x\ndisabled                                  x          x         x         x\ndispatch                                  -          -         x         x\nemail-alert from                          x          x         x         x\nemail-alert level                         x          x         x         x\nemail-alert mailers                       x          x         x         x\nemail-alert myhostname                    x          x         x         x\nemail-alert to                            x          x         x         x\nenabled                                   x          x         x         x\nerrorfile                                 x          x         x         x\nerrorloc                                  x          x         x         x\nerrorloc302                               x          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nerrorloc303                               x          x         x         x\nforce-persist                             -          x         x         x\nfullconn                                  x          -         x         x\ngrace                                     x          x         x         x\nhash-type                                 x          -         x         x\nhttp-check disable-on-404                 x          -         x         x\nhttp-check expect                         -          -         x         x\nhttp-check send-state                     x          -         x         x\nhttp-request                              -          x         x         x\nhttp-response                             -          x         x         x\nhttp-send-name-header                     -          -         x         x\nid                                        -          x         x         x\nignore-persist                            -          x         x         x\nlog                                  (*)  x          x         x         x\nlog-format                                x          x         x         -\nlog-tag                                   x          x         x         x\nmax-keep-alive-queue                      x          -         x         x\nmaxconn                                   x          x         x         -\nmode                                      x          x         x         x\nmonitor fail                              -          x         x         -\nmonitor-net                               x          x         x         -\nmonitor-uri                               x          x         x         -\noption abortonclose                  (*)  x          -         x         x\noption accept-invalid-http-request   (*)  x          x         x         -\noption accept-invalid-http-response  (*)  x          -         x         x\noption allbackups                    (*)  x          -         x         x\noption checkcache                    (*)  x          -         x         x\noption clitcpka                      (*)  x          x         x         -\noption contstats                     (*)  x          x         x         -\noption dontlog-normal                (*)  x          x         x         -\noption dontlognull                   (*)  x          x         x         -\noption forceclose                    (*)  x          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\noption forwardfor                         x          x         x         x\noption http-buffer-request           (*)  x          x         x         x\noption http-ignore-probes            (*)  x          x         x         -\noption http-keep-alive               (*)  x          x         x         x\noption http-no-delay                 (*)  x          x         x         x\noption http-pretend-keepalive        (*)  x          x         x         x\noption http-server-close             (*)  x          x         x         x\noption http-tunnel                   (*)  x          x         x         x\noption http-use-proxy-header         (*)  x          x         x         -\noption httpchk                            x          -         x         x\noption httpclose                     (*)  x          x         x         x\noption httplog                            x          x         x         x\noption http_proxy                    (*)  x          x         x         x\noption independent-streams           (*)  x          x         x         x\noption ldap-check                         x          -         x         x\noption external-check                     x          -         x         x\noption log-health-checks             (*)  x          -         x         x\noption log-separate-errors           (*)  x          x         x         -\noption logasap                       (*)  x          x         x         -\noption mysql-check                        x          -         x         x\noption pgsql-check                        x          -         x         x\noption nolinger                      (*)  x          x         x         x\noption originalto                         x          x         x         x\noption persist                       (*)  x          -         x         x\noption redispatch                    (*)  x          -         x         x\noption redis-check                        x          -         x         x\noption smtpchk                            x          -         x         x\noption socket-stats                  (*)  x          x         x         -\noption splice-auto                   (*)  x          x         x         x\noption splice-request                (*)  x          x         x         x\noption splice-response               (*)  x          x         x         x\noption srvtcpka                      (*)  x          -         x         x\noption ssl-hello-chk                      x          -         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\noption tcp-check                          x          -         x         x\noption tcp-smart-accept              (*)  x          x         x         -\noption tcp-smart-connect             (*)  x          -         x         x\noption tcpka                              x          x         x         x\noption tcplog                             x          x         x         x\noption transparent                   (*)  x          -         x         x\nexternal-check command                    x          -         x         x\nexternal-check path                       x          -         x         x\npersist rdp-cookie                        x          -         x         x\nrate-limit sessions                       x          x         x         -\nredirect                                  -          x         x         x\nredisp                      (deprecated)  x          -         x         x\nredispatch                  (deprecated)  x          -         x         x\nreqadd                                    -          x         x         x\nreqallow                                  -          x         x         x\nreqdel                                    -          x         x         x\nreqdeny                                   -          x         x         x\nreqiallow                                 -          x         x         x\nreqidel                                   -          x         x         x\nreqideny                                  -          x         x         x\nreqipass                                  -          x         x         x\nreqirep                                   -          x         x         x\nreqitarpit                                -          x         x         x\nreqpass                                   -          x         x         x\nreqrep                                    -          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nreqtarpit                                 -          x         x         x\nretries                                   x          -         x         x\nrspadd                                    -          x         x         x\nrspdel                                    -          x         x         x\nrspdeny                                   -          x         x         x\nrspidel                                   -          x         x         x\nrspideny                                  -          x         x         x\nrspirep                                   -          x         x         x\nrsprep                                    -          x         x         x\nserver                                    -          -         x         x\nsource                                    x          -         x         x\nsrvtimeout                  (deprecated)  x          -         x         x\nstats admin                               -          -         x         x\nstats auth                                x          -         x         x\nstats enable                              x          -         x         x\nstats hide-version                        x          -         x         x\nstats http-request                        -          -         x         x\nstats realm                               x          -         x         x\nstats refresh                             x          -         x         x\nstats scope                               x          -         x         x\nstats show-desc                           x          -         x         x\nstats show-legends                        x          -         x         x\nstats show-node                           x          -         x         x\nstats uri                                 x          -         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nstick match                               -          -         x         x\nstick on                                  -          -         x         x\nstick store-request                       -          -         x         x\nstick store-response                      -          -         x         x\nstick-table                               -          -         x         x\ntcp-check connect                         -          -         x         x\ntcp-check expect                          -          -         x         x\ntcp-check send                            -          -         x         x\ntcp-check send-binary                     -          -         x         x\ntcp-request connection                    -          x         x         -\ntcp-request content                       -          x         x         x\ntcp-request inspect-delay                 -          x         x         x\ntcp-response content                      -          -         x         x\ntcp-response inspect-delay                -          -         x         x\ntimeout check                             x          -         x         x\ntimeout client                            x          x         x         -\ntimeout client-fin                        x          x         x         -\ntimeout clitimeout          (deprecated)  x          x         x         -\ntimeout connect                           x          -         x         x\ntimeout contimeout          (deprecated)  x          -         x         x\ntimeout http-keep-alive                   x          x         x         x\ntimeout http-request                      x          x         x         x\ntimeout queue                             x          -         x         x\ntimeout server                            x          -         x         x\ntimeout server-fin                        x          -         x         x\ntimeout srvtimeout          (deprecated)  x          -         x         x\ntimeout tarpit                            x          x         x         x\ntimeout tunnel                            x          -         x         x\ntransparent                 (deprecated)  x          -         x         x\nunique-id-format                          x          x         x         -\nunique-id-header                          x          x         x         -\nuse_backend                               -          x         x         -\nuse-server                                -          -         x         x\n------------------------------------+----------+----------+---------+---------\n keyword                              defaults   frontend   listen    backend\n\n4.2\\. alphabetically sorted keywords reference\n---------------------------------------------\n\nthis section provides a description of each keyword and its usage.\n\nacl <aclname> <criterion> [flags] [operator] <value> ...\n  declare or complete an access list.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  example:\n        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3\n        acl invalid_src  src_port     0:1023\n        acl local_dst    hdr(host) -i localhost\n\n  see section 7 about acl usage.\n\nappsession <cookie> len <length> timeout <holdtime>\n           [request-learn] [prefix] [mode <path-parameters|query-string>]\n  define session stickiness on an existing application cookie.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <cookie>   this is the name of the cookie used by the application and which\n               haproxy will have to learn for each new session.\n\n    <length>   this is the max number of characters that will be memorized and\n               checked in each cookie value.\n\n    <holdtime> this is the time after which the cookie will be removed from\n               memory if unused. if no unit is specified, this time is in\n               milliseconds.\n\n    request-learn\n               if this option is specified, then haproxy will be able to learn\n               the cookie found in the request in case the server does not\n               specify any in response. this is typically what happens with\n               phpsessid cookies, or when haproxy's session expires before\n               the application's session and the correct server is selected.\n               it is recommended to specify this option to improve reliability.\n\n    prefix     when this option is specified, haproxy will match on the cookie\n               prefix (or url parameter prefix). the appsession value is the\n               data following this prefix.\n\n               example :\n               appsession aspsessionid len 64 timeout 3h prefix\n\n               this will match the cookie aspsessionidxxxx=xxxxx,\n               the appsession value will be xxxx=xxxxx.\n\n    mode       this option allows to change the url parser mode.\n               2 modes are currently supported :\n               - path-parameters :\n                 the parser looks for the appsession in the path parameters\n                 part (each parameter is separated by a semi-colon), which is\n                 convenient for jsessionid for example.\n                 this is the default mode if the option is not set.\n               - query-string :\n                 in this mode, the parser will look for the appsession in the\n                 query string.\n\n  when an application cookie is defined in a backend, haproxy will check when\n  the server sets such a cookie, and will store its value in a table, and\n  associate it with the server's identifier. up to <length> characters from\n  the value will be retained. on each connection, haproxy will look for this\n  cookie both in the \"cookie:\" headers, and as a url parameter (depending on\n  the mode used). if a known value is found, the client will be directed to the\n  server associated with this value. otherwise, the load balancing algorithm is\n  applied. cookies are automatically removed from memory when they have been\n  unused for a duration longer than <holdtime>.\n\n  the definition of an application cookie is limited to one per backend.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n        appsession jsessionid len 52 timeout 3h\n\n  see also : \"cookie\", \"capture cookie\", \"balance\", \"stick\", \"stick-table\",\n             \"ignore-persist\", \"nbproc\" and \"bind-process\".\n\nbacklog <conns>\n  give hints to the system about the approximate listen backlog desired size\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <conns>   is the number of pending connections. depending on the operating\n              system, it may represent the number of already acknowledged\n              connections, of non-acknowledged ones, or both.\n\n  in order to protect against syn flood attacks, one solution is to increase\n  the system's syn backlog size. depending on the system, sometimes it is just\n  tunable via a system parameter, sometimes it is not adjustable at all, and\n  sometimes the system relies on hints given by the application at the time of\n  the listen() syscall. by default, haproxy passes the frontend's maxconn value\n  to the listen() syscall. on systems which can make use of this value, it can\n  sometimes be useful to be able to specify a different value, hence this\n  backlog parameter.\n\n  on linux 2.4, the parameter is ignored by the system. on linux 2.6, it is\n  used as a hint and the system accepts up to the smallest greater power of\n  two, and never more than some limits (usually 32768).\n\n  see also : \"maxconn\" and the target operating system's tuning guide.\n\nbalance <algorithm> [ <arguments> ]\nbalance url_param <param> [check_post]\n  define the load balancing algorithm to be used in a backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <algorithm> is the algorithm used to select a server when doing load\n                balancing. this only applies when no persistence information\n                is available, or when a connection is redispatched to another\n                server. <algorithm> may be one of the following :\n\n      roundrobin  each server is used in turns, according to their weights.\n                  this is the smoothest and fairest algorithm when the server's\n                  processing time remains equally distributed. this algorithm\n                  is dynamic, which means that server weights may be adjusted\n                  on the fly for slow starts for instance. it is limited by\n                  design to 4095 active servers per backend. note that in some\n                  large farms, when a server becomes up after having been down\n                  for a very short time, it may sometimes take a few hundreds\n                  requests for it to be re-integrated into the farm and start\n                  receiving traffic. this is normal, though very rare. it is\n                  indicated here in case you would have the chance to observe\n                  it, so that you don't worry.\n\n      static-rr   each server is used in turns, according to their weights.\n                  this algorithm is as similar to roundrobin except that it is\n                  static, which means that changing a server's weight on the\n                  fly will have no effect. on the other hand, it has no design\n                  limitation on the number of servers, and when a server goes\n                  up, it is always immediately reintroduced into the farm, once\n                  the full map is recomputed. it also uses slightly less cpu to\n                  run (around -1%).\n\n      leastconn   the server with the lowest number of connections receives the\n                  connection. round-robin is performed within groups of servers\n                  of the same load to ensure that all servers will be used. use\n                  of this algorithm is recommended where very long sessions are\n                  expected, such as ldap, sql, tse, etc... but is not very well\n                  suited for protocols using short sessions such as http. this\n                  algorithm is dynamic, which means that server weights may be\n                  adjusted on the fly for slow starts for instance.\n\n      first       the first server with available connection slots receives the\n                  connection. the servers are chosen from the lowest numeric\n                  identifier to the highest (see server parameter \"id\"), which\n                  defaults to the server's position in the farm. once a server\n                  reaches its maxconn value, the next server is used. it does\n                  not make sense to use this algorithm without setting maxconn.\n                  the purpose of this algorithm is to always use the smallest\n                  number of servers so that extra servers can be powered off\n                  during non-intensive hours. this algorithm ignores the server\n                  weight, and brings more benefit to long session such as rdp\n                  or imap than http, though it can be useful there too. in\n                  order to use this algorithm efficiently, it is recommended\n                  that a cloud controller regularly checks server usage to turn\n                  them off when unused, and regularly checks backend queue to\n                  turn new servers on when the queue inflates. alternatively,\n                  using \"http-check send-state\" may inform servers on the load.\n\n      source      the source ip address is hashed and divided by the total\n                  weight of the running servers to designate which server will\n                  receive the request. this ensures that the same client ip\n                  address will always reach the same server as long as no\n                  server goes down or up. if the hash result changes due to the\n                  number of running servers changing, many clients will be\n                  directed to a different server. this algorithm is generally\n                  used in tcp mode where no cookie may be inserted. it may also\n                  be used on the internet to provide a best-effort stickiness\n                  to clients which refuse session cookies. this algorithm is\n                  static by default, which means that changing a server's\n                  weight on the fly will have no effect, but this can be\n                  changed using \"hash-type\".\n\n      uri         this algorithm hashes either the left part of the uri (before\n                  the question mark) or the whole uri (if the \"whole\" parameter\n                  is present) and divides the hash value by the total weight of\n                  the running servers. the result designates which server will\n                  receive the request. this ensures that the same uri will\n                  always be directed to the same server as long as no server\n                  goes up or down. this is used with proxy caches and\n                  anti-virus proxies in order to maximize the cache hit rate.\n                  note that this algorithm may only be used in an http backend.\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n                  this algorithm supports two optional parameters \"len\" and\n                  \"depth\", both followed by a positive integer number. these\n                  options may be helpful when it is needed to balance servers\n                  based on the beginning of the uri only. the \"len\" parameter\n                  indicates that the algorithm should only consider that many\n                  characters at the beginning of the uri to compute the hash.\n                  note that having \"len\" set to 1 rarely makes sense since most\n                  uris start with a leading \"/\".\n\n                  the \"depth\" parameter indicates the maximum directory depth\n                  to be used to compute the hash. one level is counted for each\n                  slash in the request. if both parameters are specified, the\n                  evaluation stops when either is reached.\n\n      url_param   the url parameter specified in argument will be looked up in\n                  the query string of each http get request.\n\n                  if the modifier \"check_post\" is used, then an http post\n                  request entity will be searched for the parameter argument,\n                  when it is not found in a query string after a question mark\n                  ('?') in the url. the message body will only start to be\n                  analyzed once either the advertised amount of data has been\n                  received or the request buffer is full. in the unlikely event\n                  that chunked encoding is used, only the first chunk is\n                  scanned. parameter values separated by a chunk boundary, may\n                  be randomly balanced if at all. this keyword used to support\n                  an optional <max_wait> parameter which is now ignored.\n\n                  if the parameter is found followed by an equal sign ('=') and\n                  a value, then the value is hashed and divided by the total\n                  weight of the running servers. the result designates which\n                  server will receive the request.\n\n                  this is used to track user identifiers in requests and ensure\n                  that a same user id will always be sent to the same server as\n                  long as no server goes up or down. if no value is found or if\n                  the parameter is not found, then a round robin algorithm is\n                  applied. note that this algorithm may only be used in an http\n                  backend. this algorithm is static by default, which means\n                  that changing a server's weight on the fly will have no\n                  effect, but this can be changed using \"hash-type\".\n\n      hdr(<name>) the http header <name> will be looked up in each http\n                  request. just as with the equivalent acl 'hdr()' function,\n                  the header name in parenthesis is not case sensitive. if the\n                  header is absent or if it does not contain any value, the\n                  roundrobin algorithm is applied instead.\n\n                  an optional 'use_domain_only' parameter is available, for\n                  reducing the hash algorithm to the main domain part with some\n                  specific headers such as 'host'. for instance, in the host\n                  value \"haproxy.1wt.eu\", only \"1wt\" will be considered.\n\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n      rdp-cookie\n      rdp-cookie(<name>)\n                  the rdp cookie <name> (or \"mstshash\" if omitted) will be\n                  looked up and hashed for each incoming tcp request. just as\n                  with the equivalent acl 'req_rdp_cookie()' function, the name\n                  is not case-sensitive. this mechanism is useful as a degraded\n                  persistence mode, as it makes it possible to always send the\n                  same user (or the same session id) to the same server. if the\n                  cookie is not found, the normal roundrobin algorithm is\n                  used instead.\n\n                  note that for this to work, the frontend must ensure that an\n                  rdp cookie is already present in the request buffer. for this\n                  you must use 'tcp-request content accept' rule combined with\n                  a 'req_rdp_cookie_cnt' acl.\n\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n                  see also the rdp_cookie pattern fetch function.\n\n    <arguments> is an optional list of arguments which may be needed by some\n                algorithms. right now, only \"url_param\" and \"uri\" support an\n                optional argument.\n\n  the load balancing algorithm of a backend is set to roundrobin when no other\n  algorithm, mode nor option have been set. the algorithm may only be set once\n  for each backend.\n\n  examples :\n        balance roundrobin\n        balance url_param userid\n        balance url_param session_id check_post 64\n        balance hdr(user-agent)\n        balance hdr(host)\n        balance hdr(host) use_domain_only\n\n  note: the following caveats and limitations on using the \"check_post\"\n  extension with \"url_param\" must be considered :\n\n    - all post requests are eligible for consideration, because there is no way\n      to determine if the parameters will be found in the body or entity which\n      may contain binary data. therefore another method may be required to\n      restrict consideration of post requests that have no url parameters in\n      the body. (see acl reqideny http_end)\n\n    - using a <max_wait> value larger than the request buffer size does not\n      make sense and is useless. the buffer size is set at build time, and\n      defaults to 16 kb.\n\n    - content-encoding is not supported, the parameter search will probably\n      fail; and load balancing will fall back to round robin.\n\n    - expect: 100-continue is not supported, load balancing will fall back to\n      round robin.\n\n    - transfer-encoding (rfc2616 3.6.1) is only supported in the first chunk.\n      if the entire parameter value is not present in the first chunk, the\n      selection of server is undefined (actually, defined by how little\n      actually appeared in the first chunk).\n\n    - this feature does not support generation of a 100, 411 or 501 response.\n\n    - in some cases, requesting \"check_post\" may attempt to scan the entire\n      contents of a message body. scanning normally terminates when linear\n      white space or control characters are found, indicating the end of what\n      might be a url parameter list. this is probably not a concern with sgml\n      type message bodies.\n\n  see also : \"dispatch\", \"cookie\", \"appsession\", \"transparent\", \"hash-type\" and\n             \"http_proxy\".\n\nbind [<address>]:<port_range> [, ...] [param*]\nbind /<path> [, ...] [param*]\n  define one or several listening addresses and/or ports in a frontend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <address>     is optional and can be a host name, an ipv4 address, an ipv6\n                  address, or '*'. it designates the address the frontend will\n                  listen on. if unset, all ipv4 addresses of the system will be\n                  listened on. the same will apply for '*' or the system's\n                  special address \"0.0.0.0\". the ipv6 equivalent is '::'.\n                  optionally, an address family prefix may be used before the\n                  address to force the family regardless of the address format,\n                  which can be useful to specify a path to a unix socket with\n                  no slash ('/'). currently supported prefixes are :\n                    - 'ipv4@'  -> address is always ipv4\n                    - 'ipv6@'  -> address is always ipv6\n                    - 'unix@'  -> address is a path to a local unix socket\n                    - 'abns@'  -> address is in abstract namespace (linux only).\n                      note: since abstract sockets are not \"rebindable\", they\n                            do not cope well with multi-process mode during\n                            soft-restart, so it is better to avoid them if\n                            nbproc is greater than 1\\. the effect is that if the\n                            new process fails to start, only one of the old ones\n                            will be able to rebind to the socket.\n                    - 'fd@<n>' -> use file descriptor <n> inherited from the\n                      parent. the fd must be bound and may or may not already\n                      be listening.\n                  you may want to reference some environment variables in the\n                  address parameter, see section 2.3 about environment\n                  variables.\n\n    <port_range>  is either a unique tcp port, or a port range for which the\n                  proxy will accept connections for the ip address specified\n                  above. the port is mandatory for tcp listeners. note that in\n                  the case of an ipv6 address, the port is always the number\n                  after the last colon (':'). a range can either be :\n                   - a numerical port (ex: '80')\n                   - a dash-delimited ports range explicitly stating the lower\n                     and upper bounds (ex: '2000-2100') which are included in\n                     the range.\n\n                  particular care must be taken against port ranges, because\n                  every <address:port> couple consumes one socket (= a file\n                  descriptor), so it's easy to consume lots of descriptors\n                  with a simple range, and to run out of sockets. also, each\n                  <address:port> couple must be used only once among all\n                  instances running on a same system. please note that binding\n                  to ports lower than 1024 generally require particular\n                  privileges to start the program, which are independent of\n                  the 'uid' parameter.\n\n    <path>        is a unix socket path beginning with a slash ('/'). this is\n                  alternative to the tcp listening port. haproxy will then\n                  receive unix connections on the socket located at this place.\n                  the path must begin with a slash and by default is absolute.\n                  it can be relative to the prefix defined by \"unix-bind\" in\n                  the global section. note that the total length of the prefix\n                  followed by the socket path cannot exceed some system limits\n                  for unix sockets, which commonly are set to 107 characters.\n\n    <param*>      is a list of parameters common to all sockets declared on the\n                  same line. these numerous parameters depend on os and build\n                  options and have a complete section dedicated to them. please\n                  refer to section 5 to for more details.\n\n  it is possible to specify a list of address:port combinations delimited by\n  commas. the frontend will then listen on all of these addresses. there is no\n  fixed limit to the number of addresses and ports which can be listened on in\n  a frontend, as well as there is no limit to the number of \"bind\" statements\n  in a frontend.\n\n  example :\n        listen http_proxy\n            bind :80,:443\n            bind 10.0.0.1:10080,10.0.0.1:10443\n            bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy\n\n        listen http_https_proxy\n            bind :80\n            bind :443 ssl crt /etc/haproxy/site.pem\n\n        listen http_https_proxy_explicit\n            bind ipv6@:80\n            bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem\n            bind unix@ssl-frontend.sock user root mode 600 accept-proxy\n\n        listen external_bind_app1\n            bind \"fd@${fd_app1}\"\n\n  see also : \"source\", \"option forwardfor\", \"unix-bind\" and the proxy protocol\n             documentation, and section 5 about bind options.\n\nbind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] ...\n  limit visibility of an instance to a certain set of processes numbers.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    all           all process will see this instance. this is the default. it\n                  may be used to override a default value.\n\n    odd           this instance will be enabled on processes 1,3,5,...63\\. this\n                  option may be combined with other numbers.\n\n    even          this instance will be enabled on processes 2,4,6,...64\\. this\n                  option may be combined with other numbers. do not use it\n                  with less than 2 processes otherwise some instances might be\n                  missing from all processes.\n\n    number        the instance will be enabled on this process number or range,\n                  whose values must all be between 1 and 32 or 64 depending on\n                  the machine's word size. if a proxy is bound to process\n                  numbers greater than the configured global.nbproc, it will\n                  either be forced to process #1 if a single process was\n                  specified, or to all processes otherwise.\n\n  this keyword limits binding of certain instances to certain processes. this\n  is useful in order not to have too many processes listening to the same\n  ports. for instance, on a dual-core machine, it might make sense to set\n  'nbproc 2' in the global section, then distributes the listeners among 'odd'\n  and 'even' instances.\n\n  at the moment, it is not possible to reference more than 32 or 64 processes\n  using this keyword, but this should be more than enough for most setups.\n  please note that 'all' really means all processes regardless of the machine's\n  word size, and is not limited to the first 32 or 64.\n\n  each \"bind\" line may further be limited to a subset of the proxy's processes,\n  please consult the \"process\" bind keyword in section 5.1.\n\n  when a frontend has no explicit \"bind-process\" line, it tries to bind to all\n  the processes referenced by its \"bind\" lines. that means that frontends can\n  easily adapt to their listeners' processes.\n\n  if some backends are referenced by frontends bound to other processes, the\n  backend automatically inherits the frontend's processes.\n\n  example :\n        listen app_ip1\n            bind 10.0.0.1:80\n            bind-process odd\n\n        listen app_ip2\n            bind 10.0.0.2:80\n            bind-process even\n\n        listen management\n            bind 10.0.0.3:80\n            bind-process 1 2 3 4\n\n        listen management\n            bind 10.0.0.4:80\n            bind-process 1-4\n\n  see also : \"nbproc\" in global section, and \"process\" in section 5.1.\n\nblock { if | unless } <condition>\n  block a layer 7 request if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  the http request will be blocked very early in the layer 7 processing\n  if/unless <condition> is matched. a 403 error will be returned if the request\n  is blocked. the condition has to reference acls (see section 7). this is\n  typically used to deny access to certain sensitive resources if some\n  conditions are met or not met. there is no fixed limit to the number of\n  \"block\" statements per instance.\n\n  example:\n        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3\n        acl invalid_src  src_port     0:1023\n        acl local_dst    hdr(host) -i localhost\n        block if invalid_src || local_dst\n\n  see section 7 about acl usage.\n\ncapture cookie <name> len <length>\n  capture and log a cookie in the request and in the response.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the beginning of the name of the cookie to capture. in order\n              to match the exact name, simply suffix the name with an equal\n              sign ('='). the full name will appear in the logs, which is\n              useful with application servers which adjust both the cookie name\n              and value (eg: aspsessionxxxxx).\n\n    <length>  is the maximum number of characters to report in the logs, which\n              include the cookie name, the equal sign and the value, all in the\n              standard \"name=value\" form. the string will be truncated on the\n              right if it exceeds <length>.\n\n  only the first cookie is captured. both the \"cookie\" request headers and the\n  \"set-cookie\" response headers are monitored. this is particularly useful to\n  check for application bugs causing session crossing or stealing between\n  users, because generally the user's cookies can only change on a login page.\n\n  when the cookie was not presented by the client, the associated log column\n  will report \"-\". when a request does not cause a cookie to be assigned by the\n  server, a \"-\" is reported in the response column.\n\n  the capture is performed in the frontend only because it is necessary that\n  the log format does not change for a given frontend depending on the\n  backends. this may change in the future. note that there can be only one\n  \"capture cookie\" statement in a frontend. the maximum capture length is set\n  by the global \"tune.http.cookielen\" setting and defaults to 63 characters. it\n  is not possible to specify a capture in a \"defaults\" section.\n\n  example:\n        capture cookie aspsession len 32\n\n  see also : \"capture request header\", \"capture response header\" as well as\n            section 8 about logging.\n\ncapture request header <name> len <length>\n  capture and log the last occurrence of the specified request header.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the name of the header to capture. the header names are not\n              case-sensitive, but it is a common practice to write them as they\n              appear in the requests, with the first letter of each word in\n              upper case. the header name will not appear in the logs, only the\n              value is reported, but the position in the logs is respected.\n\n    <length>  is the maximum number of characters to extract from the value and\n              report in the logs. the string will be truncated on the right if\n              it exceeds <length>.\n\n  the complete value of the last occurrence of the header is captured. the\n  value will be added to the logs between braces ('{}'). if multiple headers\n  are captured, they will be delimited by a vertical bar ('|') and will appear\n  in the same order they were declared in the configuration. non-existent\n  headers will be logged just as an empty string. common uses for request\n  header captures include the \"host\" field in virtual hosting environments, the\n  \"content-length\" when uploads are supported, \"user-agent\" to quickly\n  differentiate between real users and robots, and \"x-forwarded-for\" in proxied\n  environments to find where the request came from.\n\n  note that when capturing headers such as \"user-agent\", some spaces may be\n  logged, making the log analysis more difficult. thus be careful about what\n  you log if you know your log parser is not smart enough to rely on the\n  braces.\n\n  there is no limit to the number of captured request headers nor to their\n  length, though it is wise to keep them low to limit memory usage per session.\n  in order to keep log format consistent for a same frontend, header captures\n  can only be declared in a frontend. it is not possible to specify a capture\n  in a \"defaults\" section.\n\n  example:\n        capture request header host len 15\n        capture request header x-forwarded-for len 15\n        capture request header referrer len 15\n\n  see also : \"capture cookie\", \"capture response header\" as well as section 8\n             about logging.\n\ncapture response header <name> len <length>\n  capture and log the last occurrence of the specified response header.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the name of the header to capture. the header names are not\n              case-sensitive, but it is a common practice to write them as they\n              appear in the response, with the first letter of each word in\n              upper case. the header name will not appear in the logs, only the\n              value is reported, but the position in the logs is respected.\n\n    <length>  is the maximum number of characters to extract from the value and\n              report in the logs. the string will be truncated on the right if\n              it exceeds <length>.\n\n  the complete value of the last occurrence of the header is captured. the\n  result will be added to the logs between braces ('{}') after the captured\n  request headers. if multiple headers are captured, they will be delimited by\n  a vertical bar ('|') and will appear in the same order they were declared in\n  the configuration. non-existent headers will be logged just as an empty\n  string. common uses for response header captures include the \"content-length\"\n  header which indicates how many bytes are expected to be returned, the\n  \"location\" header to track redirections.\n\n  there is no limit to the number of captured response headers nor to their\n  length, though it is wise to keep them low to limit memory usage per session.\n  in order to keep log format consistent for a same frontend, header captures\n  can only be declared in a frontend. it is not possible to specify a capture\n  in a \"defaults\" section.\n\n  example:\n        capture response header content-length len 9\n        capture response header location len 15\n\n  see also : \"capture cookie\", \"capture request header\" as well as section 8\n             about logging.\n\nclitimeout <timeout> (deprecated)\n  set the maximum inactivity time on the client side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value is specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase, when the client sends the request, and during the\n  response while it is reading data sent by the server. the value is specified\n  in milliseconds by default, but can be in any other unit if the number is\n  suffixed by the unit, as specified at the top of this document. in tcp mode\n  (and to a lesser extent, in http mode), it is highly recommended that the\n  client timeout remains equal to the server timeout in order to avoid complex\n  situations to debug. it is a good practice to cover one or several tcp packet\n  losses by specifying timeouts that are slightly above multiples of 3 seconds\n  (eg: 4 or 5 seconds).\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for compatibility but is currently deprecated.\n  please use \"timeout client\" instead.\n\n  see also : \"timeout client\", \"timeout http-request\", \"timeout server\", and\n             \"srvtimeout\".\n\ncompression algo <algorithm> ...\ncompression type <mime type> ...\ncompression offload\n  enable http compression.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    algo     is followed by the list of supported compression algorithms.\n    type     is followed by the list of mime types that will be compressed.\n    offload  makes haproxy work as a compression offloader only (see notes).\n\n  the currently supported algorithms are :\n    identity     this is mostly for debugging, and it was useful for developing\n                 the compression feature. identity does not apply any change on\n                 data.\n\n    gzip         applies gzip compression. this setting is only available when\n                 support for zlib was built in.\n\n    deflate      same as \"gzip\", but with deflate algorithm and zlib format.\n                 note that this algorithm has ambiguous support on many\n                 browsers and no support at all from recent ones. it is\n                 strongly recommended not to use it for anything else than\n                 experimentation. this setting is only available when support\n                 for zlib was built in.\n\n    raw-deflate  same as \"deflate\" without the zlib wrapper, and used as an\n                 alternative when the browser wants \"deflate\". all major\n                 browsers understand it and despite violating the standards,\n                 it is known to work better than \"deflate\", at least on msie\n                 and some versions of safari. do not use it in conjunction\n                 with \"deflate\", use either one or the other since both react\n                 to the same accept-encoding token. this setting is only\n                 available when support for zlib was built in.\n\n  compression will be activated depending on the accept-encoding request\n  header. with identity, it does not take care of that header.\n  if backend servers support http compression, these directives\n  will be no-op: haproxy will see the compressed response and will not\n  compress again. if backend servers do not support http compression and\n  there is accept-encoding header in request, haproxy will compress the\n  matching response.\n\n  the \"offload\" setting makes haproxy remove the accept-encoding header to\n  prevent backend servers from compressing responses. it is strongly\n  recommended not to do this because this means that all the compression work\n  will be done on the single point where haproxy is located. however in some\n  deployment scenarios, haproxy may be installed in front of a buggy gateway\n  with broken http compression implementation which can't be turned off.\n  in that case haproxy can be used to prevent that gateway from emitting\n  invalid payloads. in this case, simply removing the header in the\n  configuration does not work because it applies before the header is parsed,\n  so that prevents haproxy from compressing. the \"offload\" setting should\n  then be used for such scenarios. note: for now, the \"offload\" setting is\n  ignored when set in a defaults section.\n\n  compression is disabled when:\n    * the request does not advertise a supported compression algorithm in the\n      \"accept-encoding\" header\n    * the response message is not http/1.1\n    * http status code is not 200\n    * response header \"transfer-encoding\" contains \"chunked\" (temporary\n      workaround)\n    * response contain neither a \"content-length\" header nor a\n      \"transfer-encoding\" whose last value is \"chunked\"\n    * response contains a \"content-type\" header whose first value starts with\n      \"multipart\"\n    * the response contains the \"no-transform\" value in the \"cache-control\"\n      header\n    * user-agent matches \"mozilla/4\" unless it is msie 6 with xp sp2, or msie 7\n      and later\n    * the response contains a \"content-encoding\" header, indicating that the\n      response is already compressed (see compression offload)\n\n  note: the compression does not rewrite etag headers, and does not emit the\n        warning header.\n\n  examples :\n        compression algo gzip\n        compression type text/html text/plain\n\ncontimeout <timeout> (deprecated)\n  set the maximum time to wait for a connection attempt to a server to succeed.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value is specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if the server is located on the same lan as haproxy, the connection should be\n  immediate (less than a few milliseconds). anyway, it is a good practice to\n  cover one or several tcp packet losses by specifying timeouts that are\n  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the\n  connect timeout also presets the queue timeout to the same value if this one\n  has not been specified. historically, the contimeout was also used to set the\n  tarpit timeout in a listen section, which is not possible in a pure frontend.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of failed sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for backwards compatibility but is currently\n  deprecated. please use \"timeout connect\", \"timeout queue\" or \"timeout tarpit\"\n  instead.\n\n  see also : \"timeout connect\", \"timeout queue\", \"timeout tarpit\",\n             \"timeout server\", \"contimeout\".\n\ncookie <name> [ rewrite | insert | prefix ] [ indirect ] [ nocache ]\n              [ postonly ] [ preserve ] [ httponly ] [ secure ]\n              [ domain <domain> ]* [ maxidle <idle> ] [ maxlife <life> ]\n  enable cookie-based persistence in a backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <name>    is the name of the cookie which will be monitored, modified or\n              inserted in order to bring persistence. this cookie is sent to\n              the client via a \"set-cookie\" header in the response, and is\n              brought back by the client in a \"cookie\" header in all requests.\n              special care should be taken to choose a name which does not\n              conflict with any likely application cookie. also, if the same\n              backends are subject to be used by the same clients (eg:\n              http/https), care should be taken to use different cookie names\n              between all backends if persistence between them is not desired.\n\n    rewrite   this keyword indicates that the cookie will be provided by the\n              server and that haproxy will have to modify its value to set the\n              server's identifier in it. this mode is handy when the management\n              of complex combinations of \"set-cookie\" and \"cache-control\"\n              headers is left to the application. the application can then\n              decide whether or not it is appropriate to emit a persistence\n              cookie. since all responses should be monitored, this mode only\n              works in http close mode. unless the application behaviour is\n              very complex and/or broken, it is advised not to start with this\n              mode for new deployments. this keyword is incompatible with\n              \"insert\" and \"prefix\".\n\n    insert    this keyword indicates that the persistence cookie will have to\n              be inserted by haproxy in server responses if the client did not\n\n              already have a cookie that would have permitted it to access this\n              server. when used without the \"preserve\" option, if the server\n              emits a cookie with the same name, it will be remove before\n              processing.  for this reason, this mode can be used to upgrade\n              existing configurations running in the \"rewrite\" mode. the cookie\n              will only be a session cookie and will not be stored on the\n              client's disk. by default, unless the \"indirect\" option is added,\n              the server will see the cookies emitted by the client. due to\n              caching effects, it is generally wise to add the \"nocache\" or\n              \"postonly\" keywords (see below). the \"insert\" keyword is not\n              compatible with \"rewrite\" and \"prefix\".\n\n    prefix    this keyword indicates that instead of relying on a dedicated\n              cookie for the persistence, an existing one will be completed.\n              this may be needed in some specific environments where the client\n              does not support more than one single cookie and the application\n              already needs it. in this case, whenever the server sets a cookie\n              named <name>, it will be prefixed with the server's identifier\n              and a delimiter. the prefix will be removed from all client\n              requests so that the server still finds the cookie it emitted.\n              since all requests and responses are subject to being modified,\n              this mode requires the http close mode. the \"prefix\" keyword is\n              not compatible with \"rewrite\" and \"insert\". note: it is highly\n              recommended not to use \"indirect\" with \"prefix\", otherwise server\n              cookie updates would not be sent to clients.\n\n    indirect  when this option is specified, no cookie will be emitted to a\n              client which already has a valid one for the server which has\n              processed the request. if the server sets such a cookie itself,\n              it will be removed, unless the \"preserve\" option is also set. in\n              \"insert\" mode, this will additionally remove cookies from the\n              requests transmitted to the server, making the persistence\n              mechanism totally transparent from an application point of view.\n              note: it is highly recommended not to use \"indirect\" with\n              \"prefix\", otherwise server cookie updates would not be sent to\n              clients.\n\n    nocache   this option is recommended in conjunction with the insert mode\n              when there is a cache between the client and haproxy, as it\n              ensures that a cacheable response will be tagged non-cacheable if\n              a cookie needs to be inserted. this is important because if all\n              persistence cookies are added on a cacheable home page for\n              instance, then all customers will then fetch the page from an\n              outer cache and will all share the same persistence cookie,\n              leading to one server receiving much more traffic than others.\n              see also the \"insert\" and \"postonly\" options.\n\n    postonly  this option ensures that cookie insertion will only be performed\n              on responses to post requests. it is an alternative to the\n              \"nocache\" option, because post responses are not cacheable, so\n              this ensures that the persistence cookie will never get cached.\n              since most sites do not need any sort of persistence before the\n              first post which generally is a login request, this is a very\n              efficient method to optimize caching without risking to find a\n              persistence cookie in the cache.\n              see also the \"insert\" and \"nocache\" options.\n\n    preserve  this option may only be used with \"insert\" and/or \"indirect\". it\n              allows the server to emit the persistence cookie itself. in this\n              case, if a cookie is found in the response, haproxy will leave it\n              untouched. this is useful in order to end persistence after a\n              logout request for instance. for this, the server just has to\n              emit a cookie with an invalid value (eg: empty) or with a date in\n              the past. by combining this mechanism with the \"disable-on-404\"\n              check option, it is possible to perform a completely graceful\n              shutdown because users will definitely leave the server after\n              they logout.\n\n    httponly  this option tells haproxy to add an \"httponly\" cookie attribute\n              when a cookie is inserted. this attribute is used so that a\n              user agent doesn't share the cookie with non-http components.\n              please check rfc6265 for more information on this attribute.\n\n    secure    this option tells haproxy to add a \"secure\" cookie attribute when\n              a cookie is inserted. this attribute is used so that a user agent\n              never emits this cookie over non-secure channels, which means\n              that a cookie learned with this flag will be presented only over\n              ssl/tls connections. please check rfc6265 for more information on\n              this attribute.\n\n    domain    this option allows to specify the domain at which a cookie is\n              inserted. it requires exactly one parameter: a valid domain\n              name. if the domain begins with a dot, the browser is allowed to\n              use it for any host ending with that name. it is also possible to\n              specify several domain names by invoking this option multiple\n              times. some browsers might have small limits on the number of\n              domains, so be careful when doing that. for the record, sending\n              10 domains to msie 6 or firefox 2 works as expected.\n\n    maxidle   this option allows inserted cookies to be ignored after some idle\n              time. it only works with insert-mode cookies. when a cookie is\n              sent to the client, the date this cookie was emitted is sent too.\n              upon further presentations of this cookie, if the date is older\n              than the delay indicated by the parameter (in seconds), it will\n              be ignored. otherwise, it will be refreshed if needed when the\n              response is sent to the client. this is particularly useful to\n              prevent users who never close their browsers from remaining for\n              too long on the same server (eg: after a farm size change). when\n              this option is set and a cookie has no date, it is always\n              accepted, but gets refreshed in the response. this maintains the\n              ability for admins to access their sites. cookies that have a\n              date in the future further than 24 hours are ignored. doing so\n              lets admins fix timezone issues without risking kicking users off\n              the site.\n\n    maxlife   this option allows inserted cookies to be ignored after some life\n              time, whether they're in use or not. it only works with insert\n              mode cookies. when a cookie is first sent to the client, the date\n              this cookie was emitted is sent too. upon further presentations\n              of this cookie, if the date is older than the delay indicated by\n              the parameter (in seconds), it will be ignored. if the cookie in\n              the request has no date, it is accepted and a date will be set.\n              cookies that have a date in the future further than 24 hours are\n              ignored. doing so lets admins fix timezone issues without risking\n              kicking users off the site. contrary to maxidle, this value is\n              not refreshed, only the first visit date counts. both maxidle and\n              maxlife may be used at the time. this is particularly useful to\n              prevent users who never close their browsers from remaining for\n              too long on the same server (eg: after a farm size change). this\n              is stronger than the maxidle method in that it forces a\n              redispatch after some absolute delay.\n\n  there can be only one persistence cookie per http backend, and it can be\n  declared in a defaults section. the value of the cookie will be the value\n  indicated after the \"cookie\" keyword in a \"server\" statement. if no cookie\n  is declared for a given server, the cookie is not set.\n\n  examples :\n        cookie jsessionid prefix\n        cookie srv insert indirect nocache\n        cookie srv insert postonly indirect\n        cookie srv insert indirect nocache maxidle 30m maxlife 8h\n\n  see also : \"appsession\", \"balance source\", \"capture cookie\", \"server\"\n             and \"ignore-persist\".\n\ndeclare capture [ request | response ] len <length>\n  declares a capture slot.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments:\n    <length> is the length allowed for the capture.\n\n  this declaration is only available in the frontend or listen section, but the\n  reserved slot can be used in the backends. the \"request\" keyword allocates a\n  capture slot for use in the request, and \"response\" allocates a capture slot\n  for use in the response.\n\n  see also: \"capture-req\", \"capture-res\" (sample converters),\n            \"http-request capture\" and \"http-response capture\".\n\ndefault-server [param*]\n  change default options for a server in a backend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments:\n    <param*>  is a list of parameters for this server. the \"default-server\"\n              keyword accepts an important number of options and has a complete\n              section dedicated to it. please refer to section 5 for more\n              details.\n\n  example :\n        default-server inter 1000 weight 13\n\n  see also: \"server\" and section 5 about server options\n\ndefault_backend <backend>\n  specify the backend to use when no \"use_backend\" rule has been matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <backend> is the name of the backend to use.\n\n  when doing content-switching between frontend and backends using the\n  \"use_backend\" keyword, it is often useful to indicate which backend will be\n  used when no rule has matched. it generally is the dynamic backend which\n  will catch all undetermined requests.\n\n  example :\n\n        use_backend     dynamic  if  url_dyn\n        use_backend     static   if  url_css url_img extension_img\n        default_backend dynamic\n\n  see also : \"use_backend\"\n\ndescription <string>\n  describe a listen, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments : string\n\n  allows to add a sentence to describe the related object in the haproxy html\n  stats page. the description will be printed on the right of the object name\n  it describes.\n  no need to backslash spaces in the <string> arguments.\n\ndisabled\n  disable a proxy, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  the \"disabled\" keyword is used to disable an instance, mainly in order to\n  liberate a listening port or to temporarily disable a service. the instance\n  will still be created and its configuration will be checked, but it will be\n  created in the \"stopped\" state and will appear as such in the statistics. it\n  will not receive any traffic nor will it send any health-checks or logs. it\n  is possible to disable many instances at once by adding the \"disabled\"\n  keyword in a \"defaults\" section.\n\n  see also : \"enabled\"\n\ndispatch <address>:<port>\n  set a default server address\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n\n    <address> is the ipv4 address of the default server. alternatively, a\n              resolvable hostname is supported, but this name will be resolved\n              during start-up.\n\n    <ports>   is a mandatory port specification. all connections will be sent\n              to this port, and it is not permitted to use port offsets as is\n              possible with normal servers.\n\n  the \"dispatch\" keyword designates a default server for use when no other\n  server can take the connection. in the past it was used to forward non\n  persistent connections to an auxiliary load balancer. due to its simple\n  syntax, it has also been used for simple tcp relays. it is recommended not to\n  use it for more clarity, and to use the \"server\" directive instead.\n\n  see also : \"server\"\n\nenabled\n  enable a proxy, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  the \"enabled\" keyword is used to explicitly enable an instance, when the\n  defaults has been set to \"disabled\". this is very rarely used.\n\n  see also : \"disabled\"\n\nerrorfile <code> <file>\n  return a file contents instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 200, 400, 403, 405, 408, 429, 500, 502, 503, and\n              504.\n\n    <file>    designates a file containing the full http response. it is\n              recommended to follow the common practice of appending \".http\" to\n              the filename so that people do not confuse the response with html\n              error pages, and to use absolute paths, since files are read\n              before any chroot is performed.\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  the files are returned verbatim on the tcp socket. this allows any trick such\n  as redirections to another url or site, as well as tricks to clean cookies,\n  force enable or disable caching, etc... the package provides default error\n  files returning the same contents as default errors.\n\n  the files should not exceed the configured buffer size (bufsize), which\n  generally is 8 or 16 kb, otherwise they will be truncated. it is also wise\n  not to put any reference to local contents (eg: images) in order to avoid\n  loops between the client and haproxy when all servers are down, causing an\n  error to be returned instead of an image. for better http compliance, it is\n  recommended that all header lines end with cr-lf and not lf alone.\n\n  the files are read at the same time as the configuration and kept in memory.\n  for this reason, the errors continue to be returned even when the process is\n  chrooted, and no file change is considered while the process is running. a\n  simple method for developing those files consists in associating them to the\n  403 status code and interrogating a blocked url.\n\n  see also : \"errorloc\", \"errorloc302\", \"errorloc303\"\n\n  example :\n        errorfile 400 /etc/haproxy/errorfiles/400badreq.http\n        errorfile 408 /dev/null  # workaround chrome pre-connect bug\n        errorfile 403 /etc/haproxy/errorfiles/403forbid.http\n        errorfile 503 /etc/haproxy/errorfiles/503sorry.http\n\nerrorloc <code> <url>\nerrorloc302 <code> <url>\n  return an http redirection to a url instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 200, 400, 403, 408, 500, 502, 503, and 504.\n\n    <url>     it is the exact contents of the \"location\" header. it may contain\n              either a relative uri to an error page hosted on the same site,\n              or an absolute uri designating an error page on another site.\n              special care should be given to relative uris to avoid redirect\n              loops if the uri itself may generate the same error (eg: 500).\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  note that both keyword return the http 302 status code, which tells the\n  client to fetch the designated url using the same http method. this can be\n  quite problematic in case of non-get methods such as post, because the url\n  sent to the client might not be allowed for something other than get. to\n  workaround this problem, please use \"errorloc303\" which send the http 303\n  status code, indicating to the client that the url must be fetched with a get\n  request.\n\n  see also : \"errorfile\", \"errorloc303\"\n\nerrorloc303 <code> <url>\n  return an http redirection to a url instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 400, 403, 408, 500, 502, 503, and 504.\n\n    <url>     it is the exact contents of the \"location\" header. it may contain\n              either a relative uri to an error page hosted on the same site,\n              or an absolute uri designating an error page on another site.\n              special care should be given to relative uris to avoid redirect\n              loops if the uri itself may generate the same error (eg: 500).\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  note that both keyword return the http 303 status code, which tells the\n  client to fetch the designated url using the same http get method. this\n  solves the usual problems associated with \"errorloc\" and the 302 code. it is\n  possible that some very old browsers designed before http/1.1 do not support\n  it, but no such problem has been reported till now.\n\n  see also : \"errorfile\", \"errorloc\", \"errorloc302\"\n\nemail-alert from <emailaddr>\n  declare the from email address to be used in both the envelope and header\n  of email alerts.  this is the address that email alerts are sent from.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the from email address to use when sending email alerts\n\n  also requires \"email-alert mailers\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert level\", \"email-alert mailers\",\n             \"email-alert myhostname\", \"email-alert to\", section 3.6 about mailers.\n\nemail-alert level <level>\n  declare the maximum log level of messages for which email alerts will be\n  sent. this acts as a filter on the sending of email alerts.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <level> one of the 8 syslog levels:\n              emerg alert crit err warning notice info  debug\n            the above syslog levels are ordered from lowest to highest.\n\n  by default level is alert\n\n  also requires \"email-alert from\", \"email-alert mailers\" and\n  \"email-alert to\" to be set and if so sending email alerts is enabled\n  for the proxy.\n\n  alerts are sent when :\n\n  * an un-paused server is marked as down and <level> is alert or lower\n  * a paused server is marked as down and <level> is notice or lower\n  * a server is marked as up or enters the drain state and <level>\n    is notice or lower\n  * \"option log-health-checks\" is enabled, <level> is info or lower,\n     and a health check status update occurs\n\n  see also : \"email-alert from\", \"email-alert mailers\",\n             \"email-alert myhostname\", \"email-alert to\",\n             section 3.6 about mailers.\n\nemail-alert mailers <mailersect>\n  declare the mailers to be used when sending email alerts\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <mailersect> is the name of the mailers section to send email alerts.\n\n  also requires \"email-alert from\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert myhostname\",\n             \"email-alert to\", section 3.6 about mailers.\n\nemail-alert myhostname <hostname>\n  declare the to hostname address to be used when communicating with\n  mailers.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the to email address to use when sending email alerts\n\n  by default the systems hostname is used.\n\n  also requires \"email-alert from\", \"email-alert mailers\" and\n  \"email-alert to\" to be set and if so sending email alerts is enabled\n  for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert mailers\",\n             \"email-alert to\", section 3.6 about mailers.\n\nemail-alert to <emailaddr>\n  declare both the recipent address in the envelope and to address in the\n  header of email alerts. this is the address that email alerts are sent to.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the to email address to use when sending email alerts\n\n  also requires \"email-alert mailers\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert mailers\",\n             \"email-alert myhostname\", section 3.6 about mailers.\n\nforce-persist { if | unless } <condition>\n  declare a condition to force persistence on down servers\n  may be used in sections:    defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n\n  by default, requests are not dispatched to down servers. it is possible to\n  force this using \"option persist\", but it is unconditional and redispatches\n  to a valid server if \"option redispatch\" is set. that leaves with very little\n  possibilities to force some requests to reach a server which is artificially\n  marked down for maintenance operations.\n\n  the \"force-persist\" statement allows one to declare various acl-based\n  conditions which, when met, will cause a request to ignore the down status of\n  a server and still try to connect to it. that makes it possible to start a\n  server, still replying an error to the health checks, and run a specially\n  configured browser to test the service. among the handy methods, one could\n  use a specific source ip address, or a specific cookie. the cookie also has\n  the advantage that it can easily be added/removed on the browser from a test\n  page. once the service is validated, it is then possible to open the service\n  to the world by returning a valid response to health checks.\n\n  the forced persistence is enabled when an \"if\" condition is met, or unless an\n  \"unless\" condition is met. the final redispatch is always disabled when this\n  is used.\n\n  see also : \"option redispatch\", \"ignore-persist\", \"persist\",\n             and section 7 about acl usage.\n\nfullconn <conns>\n  specify at what backend load the servers will reach their maxconn\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <conns>   is the number of connections on the backend which will make the\n              servers use the maximal number of connections.\n\n  when a server has a \"maxconn\" parameter specified, it means that its number\n  of concurrent connections will never go higher. additionally, if it has a\n  \"minconn\" parameter, it indicates a dynamic limit following the backend's\n  load. the server will then always accept at least <minconn> connections,\n  never more than <maxconn>, and the limit will be on the ramp between both\n  values when the backend has less than <conns> concurrent connections. this\n  makes it possible to limit the load on the servers during normal loads, but\n  push it further for important loads without overloading the servers during\n  exceptional loads.\n\n  since it's hard to get this value right, haproxy automatically sets it to\n  10% of the sum of the maxconns of all frontends that may branch to this\n  backend (based on \"use_backend\" and \"default_backend\" rules). that way it's\n  safe to leave it unset. however, \"use_backend\" involving dynamic names are\n  not counted since there is no way to know if they could match or not.\n\n  example :\n     # the servers will accept between 100 and 1000 concurrent connections each\n     # and the maximum of 1000 will be reached when the backend reaches 10000\n     # connections.\n     backend dynamic\n        fullconn   10000\n        server     srv1   dyn1:80 minconn 100 maxconn 1000\n        server     srv2   dyn2:80 minconn 100 maxconn 1000\n\n  see also : \"maxconn\", \"server\"\n\ngrace <time>\n  maintain a proxy operational for some time after a soft stop\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <time>    is the time (by default in milliseconds) for which the instance\n              will remain operational with the frontend sockets still listening\n              when a soft-stop is received via the sigusr1 signal.\n\n  this may be used to ensure that the services disappear in a certain order.\n  this was designed so that frontends which are dedicated to monitoring by an\n  external equipment fail immediately while other ones remain up for the time\n  needed by the equipment to detect the failure.\n\n  note that currently, there is very little benefit in using this parameter,\n  and it may in fact complicate the soft-reconfiguration process more than\n  simplify it.\n\nhash-type <method> <function> <modifier>\n  specify a method to use for mapping hashes to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <method> is the method used to select a server from the hash computed by\n             the <function> :\n\n      map-based   the hash table is a static array containing all alive servers.\n                  the hashes will be very smooth, will consider weights, but\n                  will be static in that weight changes while a server is up\n                  will be ignored. this means that there will be no slow start.\n                  also, since a server is selected by its position in the array,\n                  most mappings are changed when the server count changes. this\n                  means that when a server goes up or down, or when a server is\n                  added to a farm, most connections will be redistributed to\n                  different servers. this can be inconvenient with caches for\n                  instance.\n\n      consistent  the hash table is a tree filled with many occurrences of each\n                  server. the hash key is looked up in the tree and the closest\n                  server is chosen. this hash is dynamic, it supports changing\n                  weights while the servers are up, so it is compatible with the\n                  slow start feature. it has the advantage that when a server\n                  goes up or down, only its associations are moved. when a\n                  server is added to the farm, only a few part of the mappings\n                  are redistributed, making it an ideal method for caches.\n                  however, due to its principle, the distribution will never be\n                  very smooth and it may sometimes be necessary to adjust a\n                  server's weight or its id to get a more balanced distribution.\n                  in order to get the same distribution on multiple load\n                  balancers, it is important that all servers have the exact\n                  same ids. note: consistent hash uses sdbm and avalanche if no\n                  hash function is specified.\n\n    <function> is the hash function to be used :\n\n       sdbm   this function was created initially for sdbm (a public-domain\n              reimplementation of ndbm) database library. it was found to do\n              well in scrambling bits, causing better distribution of the keys\n              and fewer splits. it also happens to be a good general hashing\n              function with good distribution, unless the total server weight\n              is a multiple of 64, in which case applying the avalanche\n              modifier may help.\n\n       djb2   this function was first proposed by dan bernstein many years ago\n              on comp.lang.c. studies have shown that for certain workload this\n              function provides a better distribution than sdbm. it generally\n              works well with text-based inputs though it can perform extremely\n              poorly with numeric-only input or when the total server weight is\n              a multiple of 33, unless the avalanche modifier is also used.\n\n       wt6    this function was designed for haproxy while testing other\n              functions in the past. it is not as smooth as the other ones, but\n              is much less sensible to the input data set or to the number of\n              servers. it can make sense as an alternative to sdbm+avalanche or\n              djb2+avalanche for consistent hashing or when hashing on numeric\n              data such as a source ip address or a visitor identifier in a url\n              parameter.\n\n       crc32  this is the most common crc32 implementation as used in ethernet,\n              gzip, png, etc. it is slower than the other ones but may provide\n              a better distribution or less predictable results especially when\n              used on strings.\n\n    <modifier> indicates an optional method applied after hashing the key :\n\n       avalanche   this directive indicates that the result from the hash\n                   function above should not be used in its raw form but that\n                   a 4-byte full avalanche hash must be applied first. the\n                   purpose of this step is to mix the resulting bits from the\n                   previous hash in order to avoid any undesired effect when\n                   the input contains some limited values or when the number of\n                   servers is a multiple of one of the hash's components (64\n                   for sdbm, 33 for djb2). enabling avalanche tends to make the\n                   result less predictable, but it's also not as smooth as when\n                   using the original function. some testing might be needed\n                   with some workloads. this hash is one of the many proposed\n                   by bob jenkins.\n\n  the default hash type is \"map-based\" and is recommended for most usages. the\n  default function is \"sdbm\", the selection of a function should be based on\n  the range of the values being hashed.\n\n  see also : \"balance\", \"server\"\n\nhttp-check disable-on-404\n  enable a maintenance mode upon http/404 response to health-checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when this option is set, a server which returns an http code 404 will be\n  excluded from further load-balancing, but will still receive persistent\n  connections. this provides a very convenient method for web administrators\n  to perform a graceful shutdown of their servers. it is also important to note\n  that a server which is detected as failed while it was in this mode will not\n  generate an alert, just a notice. if the server responds 2xx or 3xx again, it\n  will immediately be reinserted into the farm. the status on the stats page\n  reports \"nolb\" for a server in this mode. it is important to note that this\n  option only works in conjunction with the \"httpchk\" option. if this option\n  is used with \"http-check expect\", then it has precedence over it so that 404\n  responses will still be considered as soft-stop.\n\n  see also : \"option httpchk\", \"http-check expect\"\n\nhttp-check expect [!] <match> <pattern>\n  make http health checks consider response contents or specific status codes\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <match>   is a keyword indicating how to look for a specific pattern in the\n              response. the keyword may be one of \"status\", \"rstatus\",\n              \"string\", or \"rstring\". the keyword may be preceded by an\n              exclamation mark (\"!\") to negate the match. spaces are allowed\n              between the exclamation mark and the keyword. see below for more\n              details on the supported keywords.\n\n    <pattern> is the pattern to look for. it may be a string or a regular\n              expression. if the pattern contains spaces, they must be escaped\n              with the usual backslash ('\\').\n\n  by default, \"option httpchk\" considers that response statuses 2xx and 3xx\n  are valid, and that others are invalid. when \"http-check expect\" is used,\n  it defines what is considered valid or invalid. only one \"http-check\"\n  statement is supported in a backend. if a server fails to respond or times\n  out, the check obviously fails. the available matches are :\n\n    status <string> : test the exact string match for the http status code.\n                      a health check response will be considered valid if the\n                      response's status code is exactly this string. if the\n                      \"status\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the status code matches.\n\n    rstatus <regex> : test a regular expression for the http status code.\n                      a health check response will be considered valid if the\n                      response's status code matches the expression. if the\n                      \"rstatus\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the status code matches.\n                      this is mostly used to check for multiple codes.\n\n    string <string> : test the exact string match in the http response body.\n                      a health check response will be considered valid if the\n                      response's body contains this exact string. if the\n                      \"string\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body contains this\n                      string. this can be used to look for a mandatory word at\n                      the end of a dynamic page, or to detect a failure when a\n                      specific error appears on the check page (eg: a stack\n                      trace).\n\n    rstring <regex> : test a regular expression on the http response body.\n                      a health check response will be considered valid if the\n                      response's body matches this expression. if the \"rstring\"\n                      keyword is prefixed with \"!\", then the response will be\n                      considered invalid if the body matches the expression.\n                      this can be used to look for a mandatory word at the end\n                      of a dynamic page, or to detect a failure when a specific\n                      error appears on the check page (eg: a stack trace).\n\n  it is important to note that the responses will be limited to a certain size\n  defined by the global \"tune.chksize\" option, which defaults to 16384 bytes.\n  thus, too large responses may not contain the mandatory pattern when using\n  \"string\" or \"rstring\". if a large response is absolutely required, it is\n  possible to change the default max size by setting the global variable.\n  however, it is worth keeping in mind that parsing very large responses can\n  waste some cpu cycles, especially when regular expressions are used, and that\n  it is always better to focus the checks on smaller resources.\n\n  also \"http-check expect\" doesn't support http keep-alive. keep in mind that it\n  will automatically append a \"connection: close\" header, meaning that this\n  header should not be present in the request provided by \"option httpchk\".\n\n  last, if \"http-check expect\" is combined with \"http-check disable-on-404\",\n  then this last one has precedence when the server responds with 404.\n\n  examples :\n         # only accept status 200 as valid\n         http-check expect status 200\n\n         # consider sql errors as errors\n         http-check expect ! string sql\\ error\n\n         # consider status 5xx only as errors\n         http-check expect ! rstatus ^5\n\n         # check that we have a correct hexadecimal tag before /html\n         http-check expect rstring <!--tag:[0-9a-f]*</html>\n\n  see also : \"option httpchk\", \"http-check disable-on-404\"\n\nhttp-check send-state\n  enable emission of a state header with http health checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when this option is set, haproxy will systematically send a special header\n  \"x-haproxy-server-state\" with a list of parameters indicating to each server\n  how they are seen by haproxy. this can be used for instance when a server is\n  manipulated without access to haproxy and the operator needs to know whether\n  haproxy still sees it up or not, or if the server is the last one in a farm.\n\n  the header is composed of fields delimited by semi-colons, the first of which\n  is a word (\"up\", \"down\", \"nolb\"), possibly followed by a number of valid\n  checks on the total number before transition, just as appears in the stats\n  interface. next headers are in the form \"<variable>=<value>\", indicating in\n  no specific order some values available in the stats interface :\n    - a variable \"address\", containing the address of the backend server.\n      this corresponds to the <address> field in the server declaration. for\n      unix domain sockets, it will read \"unix\".\n\n    - a variable \"port\", containing the port of the backend server. this\n      corresponds to the <port> field in the server declaration. for unix\n      domain sockets, it will read \"unix\".\n\n    - a variable \"name\", containing the name of the backend followed by a slash\n      (\"/\") then the name of the server. this can be used when a server is\n      checked in multiple backends.\n\n    - a variable \"node\" containing the name of the haproxy node, as set in the\n      global \"node\" variable, otherwise the system's hostname if unspecified.\n\n    - a variable \"weight\" indicating the weight of the server, a slash (\"/\")\n      and the total weight of the farm (just counting usable servers). this\n      helps to know if other servers are available to handle the load when this\n      one fails.\n\n    - a variable \"scur\" indicating the current number of concurrent connections\n      on the server, followed by a slash (\"/\") then the total number of\n      connections on all servers of the same backend.\n\n    - a variable \"qcur\" indicating the current number of requests in the\n      server's queue.\n\n  example of a header received by the application server :\n    >>>  x-haproxy-server-state: up 2/3; name=bck/srv2; node=lb1; weight=1/2; \\\n           scur=13/22; qcur=0\n\n  see also : \"option httpchk\", \"http-check disable-on-404\"\n\nhttp-request { allow | deny | tarpit | auth [realm <realm>] | redirect <rule> |\n              add-header <name> <fmt> | set-header <name> <fmt> |\n              capture <sample> [ len <length> | id <id> ] |\n              del-header <name> | set-nice <nice> | set-log-level <level> |\n              replace-header <name> <match-regex> <replace-fmt> |\n              replace-value <name> <match-regex> <replace-fmt> |\n              set-method <fmt> | set-path <fmt> | set-query <fmt> |\n              set-uri <fmt> | set-tos <tos> | set-mark <mark> |\n              add-acl(<file name>) <key fmt> |\n              del-acl(<file name>) <key fmt> |\n              del-map(<file name>) <key fmt> |\n              set-map(<file name>) <key fmt> <value fmt> |\n              set-var(<var name>) <expr> |\n              { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] |\n              lua <function name>\n             }\n             [ { if | unless } <condition> ]\n  access control for layer 7 requests\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    yes   |   yes  |   yes\n\n  the http-request statement defines a set of rules which apply to layer 7\n  processing. the rules are evaluated in their declaration order when they are\n  met in a frontend, listen or backend section. any rule may optionally be\n  followed by an acl-based condition, in which case it will only be evaluated\n  if the condition is true.\n\n  the first keyword is the rule's action. currently supported actions include :\n    - \"allow\" : this stops the evaluation of the rules and lets the request\n      pass the check. no further \"http-request\" rules are evaluated.\n\n    - \"deny\" : this stops the evaluation of the rules and immediately rejects\n      the request and emits an http 403 error. no further \"http-request\" rules\n      are evaluated.\n\n    - \"tarpit\" : this stops the evaluation of the rules and immediately blocks\n      the request without responding for a delay specified by \"timeout tarpit\"\n      or \"timeout connect\" if the former is not set. after that delay, if the\n      client is still connected, an http error 500 is returned so that the\n      client does not suspect it has been tarpitted. logs will report the flags\n      \"pt\". the goal of the tarpit rule is to slow down robots during an attack\n      when they're limited on the number of concurrent requests. it can be very\n      efficient against very dumb robots, and will significantly reduce the\n      load on firewalls compared to a \"deny\" rule. but when facing \"correctly\"\n      developed robots, it can make things worse by forcing haproxy and the\n      front firewall to support insane number of concurrent connections.\n\n    - \"auth\" : this stops the evaluation of the rules and immediately responds\n      with an http 401 or 407 error code to invite the user to present a valid\n      user name and password. no further \"http-request\" rules are evaluated. an\n      optional \"realm\" parameter is supported, it sets the authentication realm\n      that is returned with the response (typically the application's name).\n\n    - \"redirect\" : this performs an http redirection based on a redirect rule.\n      this is exactly the same as the \"redirect\" statement except that it\n      inserts a redirect rule which can be processed in the middle of other\n      \"http-request\" rules and that these rules use the \"log-format\" strings.\n      see the \"redirect\" keyword for the rule's syntax.\n\n    - \"add-header\" appends an http header field whose name is specified in\n      <name> and whose value is defined by <fmt> which follows the log-format\n      rules (see custom log format in section 8.2.4). this is particularly\n      useful to pass connection-specific information to the server (eg: the\n      client's ssl certificate), or to combine several headers into one. this\n      rule is not final, so it is possible to add other similar rules. note\n      that header addition is performed immediately, so one rule might reuse\n      the resulting header from a previous rule.\n\n    - \"set-header\" does the same as \"add-header\" except that the header name\n      is first removed if it existed. this is useful when passing security\n      information to the server, where the header must not be manipulated by\n      external users. note that the new value is computed before the removal so\n      it is possible to concatenate a value to an existing header.\n\n    - \"del-header\" removes all http header fields whose name is specified in\n      <name>.\n\n    - \"replace-header\" matches the regular expression in all occurrences of\n      header field <name> according to <match-regex>, and replaces them with\n      the <replace-fmt> argument. format characters are allowed in replace-fmt\n      and work like in <fmt> arguments in \"add-header\". the match is only\n      case-sensitive. it is important to understand that this action only\n      considers whole header lines, regardless of the number of values they\n      may contain. this usage is suited to headers naturally containing commas\n      in their value, such as if-modified-since and so on.\n\n      example:\n\n        http-request replace-header cookie foo=([^;]*);(.*) foo=\\1;ip=%bi;\\2\n\n      applied to:\n\n        cookie: foo=foobar; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n      outputs:\n\n        cookie: foo=foobar;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n      assuming the backend ip is 192.168.1.20\n\n    - \"replace-value\" works like \"replace-header\" except that it matches the\n      regex against every comma-delimited value of the header field <name>\n      instead of the entire header. this is suited for all headers which are\n      allowed to carry more than one value. an example could be the accept\n      header.\n\n      example:\n\n        http-request replace-value x-forwarded-for ^192\\.168\\.(.*)$ 172.16.\\1\n\n      applied to:\n\n        x-forwarded-for: 192.168.10.1, 192.168.13.24, 10.0.0.37\n\n      outputs:\n\n        x-forwarded-for: 172.16.10.1, 172.16.13.24, 10.0.0.37\n\n    - \"set-method\" rewrites the request method with the result of the\n      evaluation of format string <fmt>. there should be very few valid reasons\n      for having to do so as this is more likely to break something than to fix\n      it.\n\n    - \"set-path\" rewrites the request path with the result of the evaluation of\n      format string <fmt>. the query string, if any, is left intact. if a\n      scheme and authority is found before the path, they are left intact as\n      well. if the request doesn't have a path (\"*\"), this one is replaced with\n      the format. this can be used to prepend a directory component in front of\n      a path for example. see also \"set-query\" and \"set-uri\".\n\n      example :\n          # prepend the host name before the path\n          http-request set-path /%[hdr(host)]%[path]\n\n    - \"set-query\" rewrites the request's query string which appears after the\n      first question mark (\"?\") with the result of the evaluation of format\n      string <fmt>. the part prior to the question mark is left intact. if the\n      request doesn't contain a question mark and the new value is not empty,\n      then one is added at the end of the uri, followed by the new value. if\n      a question mark was present, it will never be removed even if the value\n      is empty. this can be used to add or remove parameters from the query\n      string. see also \"set-query\" and \"set-uri\".\n\n      example :\n          # replace \"%3d\" with \"=\" in the query string\n          http-request set-query %[query,regsub(%3d,=,g)]\n\n    - \"set-uri\" rewrites the request uri with the result of the evaluation of\n      format string <fmt>. the scheme, authority, path and query string are all\n      replaced at once. this can be used to rewrite hosts in front of proxies,\n      or to perform complex modifications to the uri such as moving parts\n      between the path and the query string. see also \"set-path\" and\n      \"set-query\".\n\n    - \"set-nice\" sets the \"nice\" factor of the current request being processed.\n      it only has effect against the other requests being processed at the same\n      time. the default value is 0, unless altered by the \"nice\" setting on the\n      \"bind\" line. the accepted range is -1024..1024\\. the higher the value, the\n      nicest the request will be. lower values will make the request more\n      important than other ones. this can be useful to improve the speed of\n      some requests, or lower the priority of non-important requests. using\n      this setting without prior experimentation can cause some major slowdown.\n\n    - \"set-log-level\" is used to change the log level of the current request\n      when a certain condition is met. valid levels are the 8 syslog levels\n      (see the \"log\" keyword) plus the special level \"silent\" which disables\n      logging for this request. this rule is not final so the last matching\n      rule wins. this rule can be useful to disable health checks coming from\n      another equipment.\n\n    - \"set-tos\" is used to set the tos or dscp field value of packets sent to\n      the client to the value passed in <tos> on platforms which support this.\n      this value represents the whole 8 bits of the ip tos field, and can be\n      expressed both in decimal or hexadecimal format (prefixed by \"0x\"). note\n      that only the 6 higher bits are used in dscp or tos, and the two lower\n      bits are always 0\\. this can be used to adjust some routing behaviour on\n      border routers based on some information from the request. see rfc 2474,\n      2597, 3260 and 4594 for more information.\n\n    - \"set-mark\" is used to set the netfilter mark on all packets sent to the\n      client to the value passed in <mark> on platforms which support it. this\n      value is an unsigned 32 bit value which can be matched by netfilter and\n      by the routing table. it can be expressed both in decimal or hexadecimal\n      format (prefixed by \"0x\"). this can be useful to force certain packets to\n      take a different route (for example a cheaper network path for bulk\n      downloads). this works on linux kernels 2.6.32 and above and requires\n      admin privileges.\n\n    - \"add-acl\" is used to add a new entry into an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the new entry. it\n      performs a lookup in the acl before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"add acl\" command from the\n      stats socket, but can be triggered by an http request.\n\n    - \"del-acl\" is used to delete an entry from an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it is the equivalent of the \"del acl\" command from the stats socket, but\n      can be triggered by an http request.\n\n    - \"del-map\" is used to delete an entry from a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it takes one argument: \"file name\" it is the equivalent of the \"del map\"\n      command from the stats socket, but can be triggered by an http request.\n\n    - \"set-map\" is used to add a new entry into a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes 2 arguments: <key fmt>,\n      which follows log-format rules, used to collect map key, and <value fmt>,\n      which follows log-format rules, used to collect content for the new entry.\n      it performs a lookup in the map before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"set map\" command from the\n      stats socket, but can be triggered by an http request.\n\n    - capture <sample> [ len <length> | id <id> ] :\n      captures sample expression <sample> from the request buffer, and converts\n      it to a string of at most <len> characters. the resulting string is\n      stored into the next request \"capture\" slot, so it will possibly appear\n      next to some captured http headers. it will then automatically appear in\n      the logs, and it will be possible to extract it using sample fetch rules\n      to feed it into headers or anything. the length should be limited given\n      that this size will be allocated for each capture during the whole\n      session life. please check section 7.3 (fetching samples) and \"capture\n      request header\" for more information.\n\n      if the keyword \"id\" is used instead of \"len\", the action tries to store\n      the captured string in a previously declared capture slot. this is useful\n      to run captures in backends. the slot id can be declared by a previous\n      directive \"http-request capture\" or with the \"declare capture\" keyword.\n\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] :\n      enables tracking of sticky counters from current request. these rules\n      do not stop evaluation and do not change default action. three sets of\n      counters may be simultaneously tracked by the same connection. the first\n      \"track-sc0\" rule executed enables tracking of the counters of the\n      specified table as the first set. the first \"track-sc1\" rule executed\n      enables tracking of the counters of the specified table as the second\n      set. the first \"track-sc2\" rule executed enables tracking of the\n      counters of the specified table as the third set. it is a recommended\n      practice to use the first set of counters for the per-frontend counters\n      and the second set for the per-backend ones. but this is just a\n      guideline, all may be used everywhere.\n\n      these actions take one or two arguments :\n        <key>   is mandatory, and is a sample expression rule as described\n                in section 7.3\\. it describes what elements of the incoming\n                request or connection will be analysed, extracted, combined,\n                and used to select which table entry to update the counters.\n\n        <table> is an optional table to be used instead of the default one,\n                which is the stick-table declared in the current proxy. all\n                the counters for the matches and updates for the key will\n                then be performed in that table until the session ends.\n\n      once a \"track-sc*\" rule is executed, the key is looked up in the table\n      and if it is not found, an entry is allocated for it. then a pointer to\n      that entry is kept during all the session's life, and this entry's\n      counters are updated as often as possible, every time the session's\n      counters are updated, and also systematically when the session ends.\n      counters are only updated for events that happen after the tracking has\n      been started. as an exception, connection counters and request counters\n      are systematically updated so that they reflect useful information.\n\n      if the entry tracks concurrent connection counters, one connection is\n      counted for as long as the entry is tracked, and the entry will not\n      expire during that time. tracking counters also provides a performance\n      advantage over just checking the keys, because only one table lookup is\n      performed for all acl checks that make use of it.\n\n    - \"lua\" is used to run a lua function if the action is executed. the single\n      parameter is the name of the function to run. the prototype of the\n      function is documented in the api documentation.\n\n    - set-var(<var-name>) <expr> :\n      is used to set the contents of a variable. the variable is declared\n      inline.\n\n        <var-name> the name of the variable starts by an indication about its\n                   scope. the allowed scopes are:\n                     \"sess\" : the variable is shared with all the session,\n                     \"txn\"  : the variable is shared with all the transaction\n                              (request and response)\n                     \"req\"  : the variable is shared only during the request\n                              processing\n                     \"res\"  : the variable is shared only during the response\n                              processing.\n                   this prefix is followed by a name. the separator is a '.'.\n                   the name may only contain characters 'a-z', 'a-z', '0-9',\n                   and '_'.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-request set-var(req.my_var) req.fhdr(user-agent),lower\n\n    - set-src <expr> :\n      is used to set the source ip address to the value of specified\n      expression. useful when a proxy in front of haproxy rewrites source ip,\n      but provides the correct ip in a http header; or you want to mask\n      source ip for privacy.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-request set-src hdr(x-forwarded-for)\n         http-request set-src src,ipmask(24)\n\n      when set-src is successful, the source port is set to 0.\n\n  there is no limit to the number of http-request statements per instance.\n\n  it is important to know that http-request rules are processed very early in\n  the http processing, just after \"block\" rules and before \"reqdel\" or \"reqrep\"\n  rules. that way, headers added by \"add-header\"/\"set-header\" are visible by\n  almost all further acl rules.\n\n  example:\n        acl nagios src 192.168.129.3\n        acl local_net src 192.168.0.0/16\n        acl auth_ok http_auth(l1)\n\n        http-request allow if nagios\n        http-request allow if local_net auth_ok\n        http-request auth realm gimme if local_net auth_ok\n        http-request deny\n\n  example:\n        acl auth_ok http_auth_group(l1) g1\n        http-request auth unless auth_ok\n\n  example:\n        http-request set-header x-haproxy-current-date %t\n        http-request set-header x-ssl                  %[ssl_fc]\n        http-request set-header x-ssl-session_id       %[ssl_fc_session_id]\n        http-request set-header x-ssl-client-verify    %[ssl_c_verify]\n        http-request set-header x-ssl-client-dn        %{+q}[ssl_c_s_dn]\n        http-request set-header x-ssl-client-cn        %{+q}[ssl_c_s_dn(cn)]\n        http-request set-header x-ssl-issuer           %{+q}[ssl_c_i_dn]\n        http-request set-header x-ssl-client-notbefore %{+q}[ssl_c_notbefore]\n        http-request set-header x-ssl-client-notafter  %{+q}[ssl_c_notafter]\n\n  example:\n        acl key req.hdr(x-add-acl-key) -m found\n        acl add path /addacl\n        acl del path /delacl\n\n        acl myhost hdr(host) -f myhost.lst\n\n        http-request add-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key add\n        http-request del-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key del\n\n  example:\n        acl value  req.hdr(x-value) -m found\n        acl setmap path /setmap\n        acl delmap path /delmap\n\n        use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\n        http-request set-map(map.lst) %[src] %[req.hdr(x-value)] if setmap value\n        http-request del-map(map.lst) %[src]                     if delmap\n\n  see also : \"stats http-request\", section 3.4 about userlists and section 7\n             about acl usage.\n\nhttp-response { allow | deny | add-header <name> <fmt> | set-nice <nice> |\n                capture <sample> id <id> | redirect <rule> |\n                set-header <name> <fmt> | del-header <name> |\n                replace-header <name> <regex-match> <replace-fmt> |\n                replace-value <name> <regex-match> <replace-fmt> |\n                set-log-level <level> | set-mark <mark> | set-tos <tos> |\n                add-acl(<file name>) <key fmt> |\n                del-acl(<file name>) <key fmt> |\n                del-map(<file name>) <key fmt> |\n                set-map(<file name>) <key fmt> <value fmt> |\n                set-var(<var-name>) <expr> |\n                lua <function name>\n              }\n              [ { if | unless } <condition> ]\n  access control for layer 7 responses\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    yes   |   yes  |   yes\n\n  the http-response statement defines a set of rules which apply to layer 7\n  processing. the rules are evaluated in their declaration order when they are\n  met in a frontend, listen or backend section. any rule may optionally be\n  followed by an acl-based condition, in which case it will only be evaluated\n  if the condition is true. since these rules apply on responses, the backend\n  rules are applied first, followed by the frontend's rules.\n\n  the first keyword is the rule's action. currently supported actions include :\n    - \"allow\" : this stops the evaluation of the rules and lets the response\n      pass the check. no further \"http-response\" rules are evaluated for the\n      current section.\n\n    - \"deny\" : this stops the evaluation of the rules and immediately rejects\n      the response and emits an http 502 error. no further \"http-response\"\n      rules are evaluated.\n\n    - \"add-header\" appends an http header field whose name is specified in\n      <name> and whose value is defined by <fmt> which follows the log-format\n      rules (see custom log format in section 8.2.4). this may be used to send\n      a cookie to a client for example, or to pass some internal information.\n      this rule is not final, so it is possible to add other similar rules.\n      note that header addition is performed immediately, so one rule might\n      reuse the resulting header from a previous rule.\n\n    - \"set-header\" does the same as \"add-header\" except that the header name\n      is first removed if it existed. this is useful when passing security\n      information to the server, where the header must not be manipulated by\n      external users.\n\n    - \"del-header\" removes all http header fields whose name is specified in\n      <name>.\n\n    - \"replace-header\" matches the regular expression in all occurrences of\n      header field <name> according to <match-regex>, and replaces them with\n      the <replace-fmt> argument. format characters are allowed in replace-fmt\n      and work like in <fmt> arguments in \"add-header\". the match is only\n      case-sensitive. it is important to understand that this action only\n      considers whole header lines, regardless of the number of values they\n      may contain. this usage is suited to headers naturally containing commas\n      in their value, such as set-cookie, expires and so on.\n\n      example:\n\n        http-response replace-header set-cookie (c=[^;]*);(.*) \\1;ip=%bi;\\2\n\n      applied to:\n\n        set-cookie: c=1; expires=tue, 14-jun-2016 01:40:45 gmt\n\n      outputs:\n\n        set-cookie: c=1;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt\n\n      assuming the backend ip is 192.168.1.20.\n\n    - \"replace-value\" works like \"replace-header\" except that it matches the\n      regex against every comma-delimited value of the header field <name>\n      instead of the entire header. this is suited for all headers which are\n      allowed to carry more than one value. an example could be the accept\n      header.\n\n      example:\n\n        http-response replace-value cache-control ^public$ private\n\n      applied to:\n\n        cache-control: max-age=3600, public\n\n      outputs:\n\n        cache-control: max-age=3600, private\n\n    - \"set-nice\" sets the \"nice\" factor of the current request being processed.\n      it only has effect against the other requests being processed at the same\n      time. the default value is 0, unless altered by the \"nice\" setting on the\n      \"bind\" line. the accepted range is -1024..1024\\. the higher the value, the\n      nicest the request will be. lower values will make the request more\n      important than other ones. this can be useful to improve the speed of\n      some requests, or lower the priority of non-important requests. using\n      this setting without prior experimentation can cause some major slowdown.\n\n    - \"set-log-level\" is used to change the log level of the current request\n      when a certain condition is met. valid levels are the 8 syslog levels\n      (see the \"log\" keyword) plus the special level \"silent\" which disables\n      logging for this request. this rule is not final so the last matching\n      rule wins. this rule can be useful to disable health checks coming from\n      another equipment.\n\n    - \"set-tos\" is used to set the tos or dscp field value of packets sent to\n      the client to the value passed in <tos> on platforms which support this.\n      this value represents the whole 8 bits of the ip tos field, and can be\n      expressed both in decimal or hexadecimal format (prefixed by \"0x\"). note\n      that only the 6 higher bits are used in dscp or tos, and the two lower\n      bits are always 0\\. this can be used to adjust some routing behaviour on\n      border routers based on some information from the request. see rfc 2474,\n      2597, 3260 and 4594 for more information.\n\n    - \"set-mark\" is used to set the netfilter mark on all packets sent to the\n      client to the value passed in <mark> on platforms which support it. this\n      value is an unsigned 32 bit value which can be matched by netfilter and\n      by the routing table. it can be expressed both in decimal or hexadecimal\n      format (prefixed by \"0x\"). this can be useful to force certain packets to\n      take a different route (for example a cheaper network path for bulk\n      downloads). this works on linux kernels 2.6.32 and above and requires\n      admin privileges.\n\n    - \"add-acl\" is used to add a new entry into an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the new entry. it\n      performs a lookup in the acl before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"add acl\" command from the\n      stats socket, but can be triggered by an http response.\n\n    - \"del-acl\" is used to delete an entry from an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it is the equivalent of the \"del acl\" command from the stats socket, but\n      can be triggered by an http response.\n\n    - \"del-map\" is used to delete an entry from a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it takes one argument: \"file name\" it is the equivalent of the \"del map\"\n      command from the stats socket, but can be triggered by an http response.\n\n    - \"set-map\" is used to add a new entry into a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes 2 arguments: <key fmt>,\n      which follows log-format rules, used to collect map key, and <value fmt>,\n      which follows log-format rules, used to collect content for the new entry.\n      it performs a lookup in the map before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"set map\" command from the\n      stats socket, but can be triggered by an http response.\n\n    - \"lua\" is used to run a lua function if the action is executed. the single\n      parameter is the name of the function to run. the prototype of the\n      function is documented in the api documentation.\n\n    - capture <sample> id <id> :\n      captures sample expression <sample> from the response buffer, and converts\n      it to a string. the resulting string is stored into the next request\n      \"capture\" slot, so it will possibly appear next to some captured http\n      headers. it will then automatically appear in the logs, and it will be\n      possible to extract it using sample fetch rules to feed it into headers or\n      anything. please check section 7.3 (fetching samples) and \"capture\n      response header\" for more information.\n\n      the keyword \"id\" is the id of the capture slot which is used for storing\n      the string. the capture slot must be defined in an associated frontend.\n      this is useful to run captures in backends. the slot id can be declared by\n      a previous directive \"http-response capture\" or with the \"declare capture\"\n      keyword.\n\n    - \"redirect\" : this performs an http redirection based on a redirect rule.\n      this supports a format string similarly to \"http-request redirect\" rules,\n      with the exception that only the \"location\" type of redirect is possible\n      on the response. see the \"redirect\" keyword for the rule's syntax. when\n      a redirect rule is applied during a response, connections to the server\n      are closed so that no data can be forwarded from the server to the client.\n\n    - set-var(<var-name>) expr:\n      is used to set the contents of a variable. the variable is declared\n      inline.\n\n        <var-name> the name of the variable starts by an indication about its\n                   scope. the allowed scopes are:\n                     \"sess\" : the variable is shared with all the session,\n                     \"txn\"  : the variable is shared with all the transaction\n                              (request and response)\n                     \"req\"  : the variable is shared only during the request\n                              processing\n                     \"res\"  : the variable is shared only during the response\n                              processing.\n                   this prefix is followed by a name. the separator is a '.'.\n                   the name may only contain characters 'a-z', 'a-z', '0-9',\n                   and '_'.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-response set-var(sess.last_redir) res.hdr(location)\n\n  there is no limit to the number of http-response statements per instance.\n\n  it is important to know that http-response rules are processed very early in\n  the http processing, before \"reqdel\" or \"reqrep\" rules. that way, headers\n  added by \"add-header\"/\"set-header\" are visible by almost all further acl\n  rules.\n\n  example:\n         acl key_acl res.hdr(x-acl-key) -m found\n\n         acl myhost hdr(host) -f myhost.lst\n\n         http-response add-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n         http-response del-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n\n  example:\n         acl value  res.hdr(x-value) -m found\n\n         use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\n         http-response set-map(map.lst) %[src] %[res.hdr(x-value)] if value\n         http-response del-map(map.lst) %[src]                     if ! value\n\n  see also : \"http-request\", section 3.4 about userlists and section 7 about\n             acl usage.\n\nhttp-send-name-header [<header>]\n  add the server name to a request. use the header string given by <header>\n\n  may be used in sections:   defaults | frontend | listen | backend\n                               yes    |    no    |   yes  |   yes\n\n  arguments :\n\n    <header>  the header string to use to send the server name\n\n  the \"http-send-name-header\" statement causes the name of the target\n  server to be added to the headers of an http request.  the name\n  is added with the header string proved.\n\n  see also : \"server\"\n\nid <value>\n  set a persistent id to a proxy.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n  arguments : none\n\n  set a persistent id for the proxy. this id must be unique and positive.\n  an unused id will automatically be assigned if unset. the first assigned\n  value will be 1\\. this id is currently only returned in statistics.\n\nignore-persist { if | unless } <condition>\n  declare a condition to ignore persistence\n  may be used in sections:    defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n\n  by default, when cookie persistence is enabled, every requests containing\n  the cookie are unconditionally persistent (assuming the target server is up\n  and running).\n\n  the \"ignore-persist\" statement allows one to declare various acl-based\n  conditions which, when met, will cause a request to ignore persistence.\n  this is sometimes useful to load balance requests for static files, which\n  often don't require persistence. this can also be used to fully disable\n  persistence for a specific user-agent (for example, some web crawler bots).\n\n  combined with \"appsession\", it can also help reduce haproxy memory usage, as\n  the appsession table won't grow if persistence is ignored.\n\n  the persistence is ignored when an \"if\" condition is met, or unless an\n  \"unless\" condition is met.\n\n  see also : \"force-persist\", \"cookie\", and section 7 about acl usage.\n\nlog global\nlog <address> [len <length>] <facility> [<level> [<minlevel>]]\nno log\n  enable per-instance logging of events and traffic.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  prefix :\n    no         should be used when the logger list must be flushed. for example,\n               if you don't want to inherit from the default logger list. this\n               prefix does not allow arguments.\n\n  arguments :\n    global     should be used when the instance's logging parameters are the\n               same as the global ones. this is the most common usage. \"global\"\n               replaces <address>, <facility> and <level> with those of the log\n               entries found in the \"global\" section. only one \"log global\"\n               statement may be used per instance, and this form takes no other\n               parameter.\n\n    <address>  indicates where to send the logs. it takes the same format as\n               for the \"global\" section's logs, and can be one of :\n\n               - an ipv4 address optionally followed by a colon (':') and a udp\n                 port. if no port is specified, 514 is used by default (the\n                 standard syslog port).\n\n               - an ipv6 address followed by a colon (':') and optionally a udp\n                 port. if no port is specified, 514 is used by default (the\n                 standard syslog port).\n\n               - a filesystem path to a unix domain socket, keeping in mind\n                 considerations for chroot (be sure the path is accessible\n                 inside the chroot) and uid/gid (be sure the path is\n                 appropriately writeable).\n\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment variables.\n\n    <length>   is an optional maximum line length. log lines larger than this\n               value will be truncated before being sent. the reason is that\n               syslog servers act differently on log line length. all servers\n               support the default value of 1024, but some servers simply drop\n               larger lines while others do log them. if a server supports long\n               lines, it may make sense to set this value here in order to avoid\n               truncating long lines. similarly, if a server drops long lines,\n               it is preferable to truncate them before sending them. accepted\n               values are 80 to 65535 inclusive. the default value of 1024 is\n               generally fine for all standard usages. some specific cases of\n               long captures or json-formated logs may require larger values.\n\n    <facility> must be one of the 24 standard syslog facilities :\n\n                 kern   user   mail   daemon auth   syslog lpr    news\n                 uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n                 local0 local1 local2 local3 local4 local5 local6 local7\n\n    <level>    is optional and can be specified to filter outgoing messages. by\n               default, all messages are sent. if a level is specified, only\n               messages with a severity at least as important as this level\n               will be sent. an optional minimum level can be specified. if it\n               is set, logs emitted with a more severe level than this one will\n               be capped to this level. this is used to avoid sending \"emerg\"\n               messages on all terminals on some default syslog configurations.\n               eight levels are known :\n\n                 emerg  alert  crit   err    warning notice info  debug\n\n  it is important to keep in mind that it is the frontend which decides what to\n  log from a connection, and that in case of content switching, the log entries\n  from the backend will be ignored. connections are logged at level \"info\".\n\n  however, backend log declaration define how and where servers status changes\n  will be logged. level \"notice\" will be used to indicate a server going up,\n  \"warning\" will be used for termination signals and definitive service\n  termination, and \"alert\" will be used for when a server goes down.\n\n  note : according to rfc3164, messages are truncated to 1024 bytes before\n         being emitted.\n\n  example :\n    log global\n    log 127.0.0.1:514 local0 notice         # only send important events\n    log 127.0.0.1:514 local0 notice notice  # same but limit output level\n    log \"${local_syslog}:514\" local0 notice   # send to local server\n\nlog-format <string>\n  specifies the log format string to use for traffic logs\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |    no\n\n  this directive specifies the log format string that will be used for all logs\n  resulting from traffic passing through the frontend using this line. if the\n  directive is used in a defaults section, all subsequent frontends will use\n  the same log format. please see section 8.2.4 which covers the log format\n  string in depth.\n\nlog-tag <string>\n  specifies the log tag to use for all outgoing logs\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  sets the tag field in the syslog header to this string. it defaults to the\n  log-tag set in the global section, otherwise the program name as launched\n  from the command line, which usually is \"haproxy\". sometimes it can be useful\n  to differentiate between multiple processes running on the same host, or to\n  differentiate customer instances running in the same process. in the backend,\n  logs about servers up/down will use this tag. as a hint, it can be convenient\n  to set a log-tag related to a hosted customer in a defaults section then put\n  all the frontends and backends for that customer, then start another customer\n  in a new defaults section. see also the global \"log-tag\" directive.\n\nmax-keep-alive-queue <value>\n  set the maximum server queue size for maintaining keep-alive connections\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n\n  http keep-alive tries to reuse the same server connection whenever possible,\n  but sometimes it can be counter-productive, for example if a server has a lot\n  of connections while other ones are idle. this is especially true for static\n  servers.\n\n  the purpose of this setting is to set a threshold on the number of queued\n  connections at which haproxy stops trying to reuse the same server and prefers\n  to find another one. the default value, -1, means there is no limit. a value\n  of zero means that keep-alive requests will never be queued. for very close\n  servers which can be reached with a low latency and which are not sensible to\n  breaking keep-alive, a low value is recommended (eg: local static server can\n  use a value of 10 or less). for remote servers suffering from a high latency,\n  higher values might be needed to cover for the latency and/or the cost of\n  picking a different server.\n\n  note that this has no impact on responses which are maintained to the same\n  server consecutively to a 401 response. they will still go to the same server\n  even if they have to be queued.\n\n  see also : \"option http-server-close\", \"option prefer-last-server\", server\n             \"maxconn\" and cookie persistence.\n\nmaxconn <conns>\n  fix the maximum number of concurrent connections on a frontend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <conns>   is the maximum number of concurrent connections the frontend will\n              accept to serve. excess connections will be queued by the system\n              in the socket's listen queue and will be served once a connection\n              closes.\n\n  if the system supports it, it can be useful on big sites to raise this limit\n  very high so that haproxy manages connection queues, instead of leaving the\n  clients with unanswered connection attempts. this value should not exceed the\n  global maxconn. also, keep in mind that a connection contains two buffers\n  of 8kb each, as well as some other data resulting in about 17 kb of ram being\n  consumed per established connection. that means that a medium system equipped\n  with 1gb of ram can withstand around 40000-50000 concurrent connections if\n  properly tuned.\n\n  also, when <conns> is set to large values, it is possible that the servers\n  are not sized to accept such loads, and for this reason it is generally wise\n  to assign them some reasonable connection limits.\n\n  by default, this value is set to 2000.\n\n  see also : \"server\", global section's \"maxconn\", \"fullconn\"\n\nmode { tcp|http|health }\n  set the running mode or protocol of the instance\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    tcp       the instance will work in pure tcp mode. a full-duplex connection\n              will be established between clients and servers, and no layer 7\n              examination will be performed. this is the default mode. it\n              should be used for ssl, ssh, smtp, ...\n\n    http      the instance will work in http mode. the client request will be\n              analyzed in depth before connecting to any server. any request\n              which is not rfc-compliant will be rejected. layer 7 filtering,\n              processing and switching will be possible. this is the mode which\n              brings haproxy most of its value.\n\n    health    the instance will work in \"health\" mode. it will just reply \"ok\"\n              to incoming connections and close the connection. alternatively,\n              if the \"httpchk\" option is set, \"http/1.0 200 ok\" will be sent\n              instead. nothing will be logged in either case. this mode is used\n              to reply to external components health checks. this mode is\n              deprecated and should not be used anymore as it is possible to do\n              the same and even better by combining tcp or http modes with the\n              \"monitor\" keyword.\n\n  when doing content switching, it is mandatory that the frontend and the\n  backend are in the same mode (generally http), otherwise the configuration\n  will be refused.\n\n  example :\n     defaults http_instances\n         mode http\n\n  see also : \"monitor\", \"monitor-net\"\n\nmonitor fail { if | unless } <condition>\n  add a condition to report a failure to a monitor http request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments :\n    if <cond>     the monitor request will fail if the condition is satisfied,\n                  and will succeed otherwise. the condition should describe a\n                  combined test which must induce a failure if all conditions\n                  are met, for instance a low number of servers both in a\n                  backend and its backup.\n\n    unless <cond> the monitor request will succeed only if the condition is\n                  satisfied, and will fail otherwise. such a condition may be\n                  based on a test on the presence of a minimum number of active\n                  servers in a list of backends.\n\n  this statement adds a condition which can force the response to a monitor\n  request to report a failure. by default, when an external component queries\n  the uri dedicated to monitoring, a 200 response is returned. when one of the\n  conditions above is met, haproxy will return 503 instead of 200\\. this is\n  very useful to report a site failure to an external component which may base\n  routing advertisements between multiple sites on the availability reported by\n  haproxy. in this case, one would rely on an acl involving the \"nbsrv\"\n  criterion. note that \"monitor fail\" only works in http mode. both status\n  messages may be tweaked using \"errorfile\" or \"errorloc\" if needed.\n\n  example:\n     frontend www\n        mode http\n        acl site_dead nbsrv(dynamic) lt 2\n        acl site_dead nbsrv(static)  lt 2\n        monitor-uri   /site_alive\n        monitor fail  if site_dead\n\n  see also : \"monitor-net\", \"monitor-uri\", \"errorfile\", \"errorloc\"\n\nmonitor-net <source>\n  declare a source network which is limited to monitor requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <source>  is the source ipv4 address or network which will only be able to\n              get monitor responses to any request. it can be either an ipv4\n              address, a host name, or an address followed by a slash ('/')\n              followed by a mask.\n\n  in tcp mode, any connection coming from a source matching <source> will cause\n  the connection to be immediately closed without any log. this allows another\n  equipment to probe the port and verify that it is still listening, without\n  forwarding the connection to a remote server.\n\n  in http mode, a connection coming from a source matching <source> will be\n  accepted, the following response will be sent without waiting for a request,\n  then the connection will be closed : \"http/1.0 200 ok\". this is normally\n  enough for any front-end http probe to detect that the service is up and\n  running without forwarding the request to a backend server. note that this\n  response is sent in raw format, without any transformation. this is important\n  as it means that it will not be ssl-encrypted on ssl listeners.\n\n  monitor requests are processed very early, just after tcp-request connection\n  acls which are the only ones able to block them. these connections are short\n  lived and never wait for any data from the client. they cannot be logged, and\n  it is the intended purpose. they are only used to report haproxy's health to\n  an upper component, nothing more. please note that \"monitor fail\" rules do\n  not apply to connections intercepted by \"monitor-net\".\n\n  last, please note that only one \"monitor-net\" statement can be specified in\n  a frontend. if more than one is found, only the last one will be considered.\n\n  example :\n    # addresses .252 and .253 are just probing us.\n    frontend www\n        monitor-net 192.168.0.252/31\n\n  see also : \"monitor fail\", \"monitor-uri\"\n\nmonitor-uri <uri>\n  intercept a uri used by external components' monitor requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <uri>     is the exact uri which we want to intercept to return haproxy's\n              health status instead of forwarding the request.\n\n  when an http request referencing <uri> will be received on a frontend,\n  haproxy will not forward it nor log it, but instead will return either\n  \"http/1.0 200 ok\" or \"http/1.0 503 service unavailable\", depending on failure\n  conditions defined with \"monitor fail\". this is normally enough for any\n  front-end http probe to detect that the service is up and running without\n  forwarding the request to a backend server. note that the http method, the\n  version and all headers are ignored, but the request must at least be valid\n  at the http level. this keyword may only be used with an http-mode frontend.\n\n  monitor requests are processed very early. it is not possible to block nor\n  divert them using acls. they cannot be logged either, and it is the intended\n  purpose. they are only used to report haproxy's health to an upper component,\n  nothing more. however, it is possible to add any number of conditions using\n  \"monitor fail\" and acls so that the result can be adjusted to whatever check\n  can be imagined (most often the number of available servers in a backend).\n\n  example :\n    # use /haproxy_test to report haproxy's status\n    frontend www\n        mode http\n        monitor-uri /haproxy_test\n\n  see also : \"monitor fail\", \"monitor-net\"\n\noption abortonclose\nno option abortonclose\n  enable or disable early dropping of aborted requests pending in queues.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  in presence of very high loads, the servers will take some time to respond.\n  the per-instance connection queue will inflate, and the response time will\n  increase respective to the size of the queue times the average per-session\n  response time. when clients will wait for more than a few seconds, they will\n  often hit the \"stop\" button on their browser, leaving a useless request in\n  the queue, and slowing down other users, and the servers as well, because the\n  request will eventually be served, then aborted at the first error\n  encountered while delivering the response.\n\n  as there is no way to distinguish between a full stop and a simple output\n  close on the client side, http agents should be conservative and consider\n  that the client might only have closed its output channel while waiting for\n  the response. however, this introduces risks of congestion when lots of users\n  do the same, and is completely useless nowadays because probably no client at\n  all will close the session while waiting for the response. some http agents\n  support this behaviour (squid, apache, haproxy), and others do not (tux, most\n  hardware-based load balancers). so the probability for a closed input channel\n  to represent a user hitting the \"stop\" button is close to 100%, and the risk\n  of being the single component to break rare but valid traffic is extremely\n  low, which adds to the temptation to be able to abort a session early while\n  still not served and not pollute the servers.\n\n  in haproxy, the user can choose the desired behaviour using the option\n  \"abortonclose\". by default (without the option) the behaviour is http\n  compliant and aborted requests will be served. but when the option is\n  specified, a session with an incoming channel closed will be aborted while\n  it is still possible, either pending in the queue for a connection slot, or\n  during the connection establishment if the server has not yet acknowledged\n  the connection request. this considerably reduces the queue size and the load\n  on saturated servers when users are tempted to click on stop, which in turn\n  reduces the response time for other users.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"timeout queue\" and server's \"maxconn\" and \"maxqueue\" parameters\n\noption accept-invalid-http-request\nno option accept-invalid-http-request\n  enable or disable relaxing of http request parsing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, haproxy complies with rfc7230 in terms of message parsing. this\n  means that invalid characters in header names are not permitted and cause an\n  error to be returned to the client. this is the desired behaviour as such\n  forbidden characters are essentially used to build attacks exploiting server\n  weaknesses, and bypass security filtering. sometimes, a buggy browser or\n  server will emit invalid header names for whatever reason (configuration,\n  implementation) and the issue will not be immediately fixed. in such a case,\n  it is possible to relax haproxy's header name parser to accept any character\n  even if that does not make sense, by specifying this option. similarly, the\n  list of characters allowed to appear in a uri is well defined by rfc3986, and\n  chars 0-31, 32 (space), 34 ('\"'), 60 ('<'), 62 ('>'), 92 ('\\'), 94 ('^'), 96\n  ('`'), 123 ('{'), 124 ('|'), 125 ('}'), 127 (delete) and anything above are\n  not allowed at all. haproxy always blocks a number of them (0..32, 127). the\n  remaining ones are blocked by default unless this option is enabled. this\n  option also relaxes the test on the http version, it allows http/0.9 requests\n  to pass through (no version specified) and multiple digits for both the major\n  and the minor version.\n\n  this option should never be enabled by default as it hides application bugs\n  and open security breaches. it should only be deployed after a problem has\n  been confirmed.\n\n  when this option is enabled, erroneous header names will still be accepted in\n  requests, but the complete request will be captured in order to permit later\n  analysis using the \"show errors\" request on the unix stats socket. similarly,\n  requests containing invalid chars in the uri part will be logged. doing this\n  also helps confirming that the issue has been solved.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option accept-invalid-http-response\" and \"show errors\" on the\n             stats socket.\n\noption accept-invalid-http-response\nno option accept-invalid-http-response\n  enable or disable relaxing of http response parsing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  by default, haproxy complies with rfc7230 in terms of message parsing. this\n  means that invalid characters in header names are not permitted and cause an\n  error to be returned to the client. this is the desired behaviour as such\n  forbidden characters are essentially used to build attacks exploiting server\n  weaknesses, and bypass security filtering. sometimes, a buggy browser or\n  server will emit invalid header names for whatever reason (configuration,\n  implementation) and the issue will not be immediately fixed. in such a case,\n  it is possible to relax haproxy's header name parser to accept any character\n  even if that does not make sense, by specifying this option. this option also\n  relaxes the test on the http version format, it allows multiple digits for\n  both the major and the minor version.\n\n  this option should never be enabled by default as it hides application bugs\n  and open security breaches. it should only be deployed after a problem has\n  been confirmed.\n\n  when this option is enabled, erroneous header names will still be accepted in\n  responses, but the complete response will be captured in order to permit\n  later analysis using the \"show errors\" request on the unix stats socket.\n  doing this also helps confirming that the issue has been solved.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option accept-invalid-http-request\" and \"show errors\" on the\n             stats socket.\n\noption allbackups\nno option allbackups\n  use either all backup servers at a time or only the first one\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  by default, the first operational backup server gets all traffic when normal\n  servers are all down. sometimes, it may be preferred to use multiple backups\n  at once, because one will not be enough. when \"option allbackups\" is enabled,\n  the load balancing will be performed among all backup servers when all normal\n  ones are unavailable. the same load balancing algorithm will be used and the\n  servers' weights will be respected. thus, there will not be any priority\n  order between the backup servers anymore.\n\n  this option is mostly used with static server farms dedicated to return a\n  \"sorry\" page when an application is completely offline.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption checkcache\nno option checkcache\n  analyze all server responses and block responses with cacheable cookies\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  some high-level frameworks set application cookies everywhere and do not\n  always let enough control to the developer to manage how the responses should\n  be cached. when a session cookie is returned on a cacheable object, there is a\n  high risk of session crossing or stealing between users traversing the same\n  caches. in some situations, it is better to block the response than to let\n  some sensitive session information go in the wild.\n\n  the option \"checkcache\" enables deep inspection of all server responses for\n  strict compliance with http specification in terms of cacheability. it\n  carefully checks \"cache-control\", \"pragma\" and \"set-cookie\" headers in server\n  response to check if there's a risk of caching a cookie on a client-side\n  proxy. when this option is enabled, the only responses which can be delivered\n  to the client are :\n    - all those without \"set-cookie\" header ;\n    - all those with a return code other than 200, 203, 206, 300, 301, 410,\n      provided that the server has not set a \"cache-control: public\" header ;\n    - all those that come from a post request, provided that the server has not\n      set a 'cache-control: public' header ;\n    - those with a 'pragma: no-cache' header\n    - those with a 'cache-control: private' header\n    - those with a 'cache-control: no-store' header\n    - those with a 'cache-control: max-age=0' header\n    - those with a 'cache-control: s-maxage=0' header\n    - those with a 'cache-control: no-cache' header\n    - those with a 'cache-control: no-cache=\"set-cookie\"' header\n    - those with a 'cache-control: no-cache=\"set-cookie,' header\n      (allowing other fields after set-cookie)\n\n  if a response doesn't respect these requirements, then it will be blocked\n  just as if it was from an \"rspdeny\" filter, with an \"http 502 bad gateway\".\n  the session state shows \"ph--\" meaning that the proxy blocked the response\n  during headers processing. additionally, an alert will be sent in the logs so\n  that admins are informed that there's something to be fixed.\n\n  due to the high impact on the application, the application should be tested\n  in depth with the option enabled before going to production. it is also a\n  good practice to always activate it during tests, even if it is not used in\n  production, as it will report potentially dangerous application behaviours.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption clitcpka\nno option clitcpka\n  enable or disable the sending of tcp keepalive packets on the client side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"clitcpka\" enables the emission of tcp keep-alive probes on the\n  client side of a connection, which should help when session expirations are\n  noticed between haproxy and a client.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option srvtcpka\", \"option tcpka\"\n\noption contstats\n  enable continuous traffic statistics updates\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, counters used for statistics calculation are incremented\n  only when a session finishes. it works quite well when serving small\n  objects, but with big ones (for example large images or archives) or\n  with a/v streaming, a graph generated from haproxy counters looks like\n  a hedgehog. with this option enabled counters get incremented continuously,\n  during a whole session. recounting touches a hotpath directly so\n  it is not enabled by default, as it has small performance impact (~0.5%).\n\noption dontlog-normal\nno option dontlog-normal\n  enable or disable logging of normal, successful connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  there are large sites dealing with several thousand connections per second\n  and for which logging is a major pain. some of them are even forced to turn\n  logs off and cannot debug production issues. setting this option ensures that\n  normal connections, those which experience no error, no timeout, no retry nor\n  redispatch, will not be logged. this leaves disk space for anomalies. in http\n  mode, the response status code is checked and return codes 5xx will still be\n  logged.\n\n  it is strongly discouraged to use this option as most of the time, the key to\n  complex issues is in the normal logs which will not be logged here. if you\n  need to separate logs, see the \"log-separate-errors\" option instead.\n\n  see also : \"log\", \"dontlognull\", \"log-separate-errors\" and section 8 about\n             logging.\n\noption dontlognull\nno option dontlognull\n  enable or disable logging of null connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  in certain environments, there are components which will regularly connect to\n  various systems to ensure that they are still alive. it can be the case from\n  another load balancer as well as from monitoring systems. by default, even a\n  simple port probe or scan will produce a log. if those connections pollute\n  the logs too much, it is possible to enable option \"dontlognull\" to indicate\n  that a connection on which no data has been transferred will not be logged,\n  which typically corresponds to those probes. note that errors will still be\n  returned to the client and accounted for in the stats. if this is not what is\n  desired, option http-ignore-probes can be used instead.\n\n  it is generally recommended not to use this option in uncontrolled\n  environments (eg: internet), otherwise scans and other malicious activities\n  would not be logged.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"log\", \"http-ignore-probes\", \"monitor-net\", \"monitor-uri\", and\n             section 8 about logging.\n\noption forceclose\nno option forceclose\n  enable or disable active connection closing after response is transferred.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  some http servers do not necessarily close the connections when they receive\n  the \"connection: close\" set by \"option httpclose\", and if the client does not\n  close either, then the connection remains open till the timeout expires. this\n  causes high number of simultaneous connections on the servers and shows high\n  global session times in the logs.\n\n  when this happens, it is possible to use \"option forceclose\". it will\n  actively close the outgoing server channel as soon as the server has finished\n  to respond and release some resources earlier than with \"option httpclose\".\n\n  this option may also be combined with \"option http-pretend-keepalive\", which\n  will disable sending of the \"connection: close\" header, but will still cause\n  the connection to be closed once the whole response is received.\n\n  this option disables and replaces any previous \"option httpclose\", \"option\n  http-server-close\", \"option http-keep-alive\", or \"option http-tunnel\".\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option httpclose\" and \"option http-pretend-keepalive\"\n\noption forwardfor [ except <network> ] [ header <name> ] [ if-none ]\n  enable insertion of the x-forwarded-for header to requests sent to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <network> is an optional argument used to disable this option for sources\n              matching <network>\n    <name>    an optional argument to specify a different \"x-forwarded-for\"\n              header name.\n\n  since haproxy works in reverse-proxy mode, the servers see its ip address as\n  their client address. this is sometimes annoying when the client's ip address\n  is expected in server logs. to solve this problem, the well-known http header\n  \"x-forwarded-for\" may be added by haproxy to all requests sent to the server.\n  this header contains a value representing the client's ip address. since this\n  header is always appended at the end of the existing header list, the server\n  must be configured to always use the last occurrence of this header only. see\n  the server's manual to find how to enable use of this standard header. note\n  that only the last occurrence of the header must be used, since it is really\n  possible that the client has already brought one.\n\n  the keyword \"header\" may be used to supply a different header name to replace\n  the default \"x-forwarded-for\". this can be useful where you might already\n  have a \"x-forwarded-for\" header from a different application (eg: stunnel),\n  and you need preserve it. also if your backend server doesn't use the\n  \"x-forwarded-for\" header and requires different one (eg: zeus web servers\n  require \"x-cluster-client-ip\").\n\n  sometimes, a same haproxy instance may be shared between a direct client\n  access and a reverse-proxy access (for instance when an ssl reverse-proxy is\n  used to decrypt https traffic). it is possible to disable the addition of the\n  header for a known source address or network by adding the \"except\" keyword\n  followed by the network address. in this case, any source ip matching the\n  network will not cause an addition of this header. most common uses are with\n  private networks or 127.0.0.1.\n\n  alternatively, the keyword \"if-none\" states that the header will only be\n  added if it is not present. this should only be used in perfectly trusted\n  environment, as this might cause a security issue if headers reaching haproxy\n  are under the control of the end-user.\n\n  this option may be specified either in the frontend or in the backend. if at\n  least one of them uses it, the header will be added. note that the backend's\n  setting of the header subargument takes precedence over the frontend's if\n  both are defined. in the case of the \"if-none\" argument, if at least one of\n  the frontend or the backend does not specify it, it wants the addition to be\n  mandatory, so it wins.\n\n  examples :\n    # public http address also used by stunnel on the same machine\n    frontend www\n        mode http\n        option forwardfor except 127.0.0.1  # stunnel already adds the header\n\n    # those servers want the ip address in x-client\n    backend www\n        mode http\n        option forwardfor header x-client\n\n  see also : \"option httpclose\", \"option http-server-close\",\n             \"option forceclose\", \"option http-keep-alive\"\n\noption http-buffer-request\nno option http-buffer-request\n  enable or disable waiting for whole http request body before proceeding\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  it is sometimes desirable to wait for the body of an http request before\n  taking a decision. this is what is being done by \"balance url_param\" for\n  example. the first use case is to buffer requests from slow clients before\n  connecting to the server. another use case consists in taking the routing\n  decision based on the request body's contents. this option placed in a\n  frontend or backend forces the http processing to wait until either the whole\n  body is received, or the request buffer is full, or the first chunk is\n  complete in case of chunked encoding. it can have undesired side effects with\n  some applications abusing http by expecting unbufferred transmissions between\n  the frontend and the backend, so this should definitely not be used by\n  default.\n\n  see also : \"option http-no-delay\"\n\noption http-ignore-probes\nno option http-ignore-probes\n  enable or disable logging of null connections and request timeouts\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  recently some browsers started to implement a \"pre-connect\" feature\n  consisting in speculatively connecting to some recently visited web sites\n  just in case the user would like to visit them. this results in many\n  connections being established to web sites, which end up in 408 request\n  timeout if the timeout strikes first, or 400 bad request when the browser\n  decides to close them first. these ones pollute the log and feed the error\n  counters. there was already \"option dontlognull\" but it's insufficient in\n  this case. instead, this option does the following things :\n     - prevent any 400/408 message from being sent to the client if nothing\n       was received over a connection before it was closed ;\n     - prevent any log from being emitted in this situation ;\n     - prevent any error counter from being incremented\n\n  that way the empty connection is silently ignored. note that it is better\n  not to use this unless it is clear that it is needed, because it will hide\n  real problems. the most common reason for not receiving a request and seeing\n  a 408 is due to an mtu inconsistency between the client and an intermediary\n  element such as a vpn, which blocks too large packets. these issues are\n  generally seen with post requests as well as get with large cookies. the logs\n  are often the only way to detect them.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"log\", \"dontlognull\", \"errorfile\", and section 8 about logging.\n\noption http-keep-alive\nno option http-keep-alive\n  enable or disable http keep-alive from client to server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and the\n  start of a new request. this mode may be changed by several options such as\n  \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\". this option allows to set back the keep-alive mode,\n  which can be useful when another mode was used in a defaults section.\n\n  setting \"option http-keep-alive\" enables http keep-alive mode on the client-\n  and server- sides. this provides the lowest latency on the client side (slow\n  network) and the fastest session reuse on the server side at the expense\n  of maintaining idle connections to the servers. in general, it is possible\n  with this option to achieve approximately twice the request rate that the\n  \"http-server-close\" option achieves on small objects. there are mainly two\n  situations where this option may be useful :\n\n    - when the server is non-http compliant and authenticates the connection\n      instead of requests (eg: ntlm authentication)\n\n    - when the cost of establishing the connection to the server is significant\n      compared to the cost of retrieving the associated object from the server.\n\n  this last case can happen when the server is a fast static server of cache.\n  in this case, the server will need to be properly tuned to support high enough\n  connection counts because connections will last until the client sends another\n  request.\n\n  if the client request has to go to another backend or another server due to\n  content switching or the load balancing algorithm, the idle connection will\n  immediately be closed and a new one re-opened. option \"prefer-last-server\" is\n  available to try optimize server selection so that if the server currently\n  attached to an idle connection is usable, it will be used.\n\n  in general it is preferred to use \"option http-server-close\" with application\n  servers, and some static servers might benefit from \"option http-keep-alive\".\n\n  at the moment, logs will not indicate whether requests came from the same\n  session or not. the accept date reported in the logs corresponds to the end\n  of the previous request, and the request time corresponds to the time spent\n  waiting for a new request. the keep-alive request time is still bound to the\n  timeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\n  not set.\n\n  this option disables and replaces any previous \"option httpclose\", \"option\n  http-server-close\", \"option forceclose\" or \"option http-tunnel\". when backend\n  and frontend options differ, all of these 4 options have precedence over\n  \"option http-keep-alive\".\n\n  see also : \"option forceclose\", \"option http-server-close\",\n             \"option prefer-last-server\", \"option http-pretend-keepalive\",\n             \"option httpclose\", and \"1.1\\. the http transaction model\".\n\noption http-no-delay\nno option http-no-delay\n  instruct the system to favor low interactive delays over performance in http\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  in http, each payload is unidirectional and has no notion of interactivity.\n  any agent is expected to queue data somewhat for a reasonably low delay.\n  there are some very rare server-to-server applications that abuse the http\n  protocol and expect the payload phase to be highly interactive, with many\n  interleaved data chunks in both directions within a single request. this is\n  absolutely not supported by the http specification and will not work across\n  most proxies or servers. when such applications attempt to do this through\n  haproxy, it works but they will experience high delays due to the network\n  optimizations which favor performance by instructing the system to wait for\n  enough data to be available in order to only send full packets. typical\n  delays are around 200 ms per round trip. note that this only happens with\n  abnormal uses. normal uses such as connect requests nor websockets are not\n  affected.\n\n  when \"option http-no-delay\" is present in either the frontend or the backend\n  used by a connection, all such optimizations will be disabled in order to\n  make the exchanges as fast as possible. of course this offers no guarantee on\n  the functionality, as it may break at any other place. but if it works via\n  haproxy, it will work as fast as possible. this option should never be used\n  by default, and should never be used at all unless such a buggy application\n  is discovered. the impact of using this option is an increase of bandwidth\n  usage and cpu usage, which may significantly lower performance in high\n  latency environments.\n\n  see also : \"option http-buffer-request\"\n\noption http-pretend-keepalive\nno option http-pretend-keepalive\n  define whether haproxy will announce keepalive to the server or not\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when running with \"option http-server-close\" or \"option forceclose\", haproxy\n  adds a \"connection: close\" header to the request forwarded to the server.\n  unfortunately, when some servers see this header, they automatically refrain\n  from using the chunked encoding for responses of unknown length, while this\n  is totally unrelated. the immediate effect is that this prevents haproxy from\n  maintaining the client connection alive. a second effect is that a client or\n  a cache could receive an incomplete response without being aware of it, and\n  consider the response complete.\n\n  by setting \"option http-pretend-keepalive\", haproxy will make the server\n  believe it will keep the connection alive. the server will then not fall back\n  to the abnormal undesired above. when haproxy gets the whole response, it\n  will close the connection with the server just as it would do with the\n  \"forceclose\" option. that way the client gets a normal response and the\n  connection is correctly closed on the server side.\n\n  it is recommended not to enable this option by default, because most servers\n  will more efficiently close the connection themselves after the last packet,\n  and release its buffers slightly earlier. also, the added packet on the\n  network could slightly reduce the overall peak performance. however it is\n  worth noting that when this option is enabled, haproxy will have slightly\n  less work to do. so if haproxy is the bottleneck on the whole architecture,\n  enabling this option might save a few cpu cycles.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  this option may be combined with \"option httpclose\", which will cause\n  keepalive to be announced to the server and close to be announced to the\n  client. this practice is discouraged though.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\", and\n             \"option http-keep-alive\"\n\noption http-server-close\nno option http-server-close\n  enable or disable http connection closing on the server side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\". setting \"option http-server-close\" enables http\n  connection-close mode on the server side while keeping the ability to support\n  http keep-alive and pipelining on the client side.  this provides the lowest\n  latency on the client side (slow network) and the fastest session reuse on\n  the server side to save server resources, similarly to \"option forceclose\".\n  it also permits non-keepalive capable servers to be served in keep-alive mode\n  to the clients if they conform to the requirements of rfc2616\\. please note\n  that some servers do not always conform to those requirements when they see\n  \"connection: close\" in the request. the effect will be that keep-alive will\n  never be used. a workaround consists in enabling \"option\n  http-pretend-keepalive\".\n\n  at the moment, logs will not indicate whether requests came from the same\n  session or not. the accept date reported in the logs corresponds to the end\n  of the previous request, and the request time corresponds to the time spent\n  waiting for a new request. the keep-alive request time is still bound to the\n  timeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\n  not set.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  it disables and replaces any previous \"option httpclose\", \"option forceclose\",\n  \"option http-tunnel\" or \"option http-keep-alive\". please check section 4\n  (\"proxies\") to see how this option combines with others when frontend and\n  backend options differ.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-pretend-keepalive\",\n             \"option httpclose\", \"option http-keep-alive\", and\n             \"1.1\\. the http transaction model\".\n\noption http-tunnel\nno option http-tunnel\n  disable or enable http connection processing after first transaction\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\".\n\n  option \"http-tunnel\" disables any http processing past the first request and\n  the first response. this is the mode which was used by default in versions\n  1.0 to 1.5-dev21\\. it is the mode with the lowest processing overhead, which\n  is normally not needed anymore unless in very specific cases such as when\n  using an in-house protocol that looks like http but is not compatible, or\n  just to log one request per client in order to reduce log size. note that\n  everything which works at the http level, including header parsing/addition,\n  cookie processing or content switching will only work for the first request\n  and will be ignored after the first response.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\",\n             \"option httpclose\", \"option http-keep-alive\", and\n             \"1.1\\. the http transaction model\".\n\noption http-use-proxy-header\nno option http-use-proxy-header\n  make use of non-standard proxy-connection header instead of connection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  while rfc2616 explicitly states that http/1.1 agents must use the\n  connection header to indicate their wish of persistent or non-persistent\n  connections, both browsers and proxies ignore this header for proxied\n  connections and make use of the undocumented, non-standard proxy-connection\n  header instead. the issue begins when trying to put a load balancer between\n  browsers and such proxies, because there will be a difference between what\n  haproxy understands and what the client and the proxy agree on.\n\n  by setting this option in a frontend, haproxy can automatically switch to use\n  that non-standard header if it sees proxied requests. a proxied request is\n  defined here as one where the uri begins with neither a '/' nor a '*'. the\n  choice of header only affects requests passing through proxies making use of\n  one of the \"httpclose\", \"forceclose\" and \"http-server-close\" options. note\n  that this option can only be specified in a frontend and will affect the\n  request along its whole life.\n\n  also, when this option is set, a request which requires authentication will\n  automatically switch to use proxy authentication headers if it is itself a\n  proxied request. that makes it possible to check or enforce authentication in\n  front of an existing proxy.\n\n  this option should normally never be used, except in front of a proxy.\n\n  see also : \"option httpclose\", \"option forceclose\" and \"option\n             http-server-close\".\n\noption httpchk\noption httpchk <uri>\noption httpchk <method> <uri>\noption httpchk <method> <uri> <version>\n  enable http protocol to check on the servers health\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <method>  is the optional http method used with the requests. when not set,\n              the \"options\" method is used, as it generally requires low server\n              processing and is easy to filter out from the logs. any method\n              may be used, though it is not recommended to invent non-standard\n              ones.\n\n    <uri>     is the uri referenced in the http requests. it defaults to \" / \"\n              which is accessible by default on almost any server, but may be\n              changed to any other uri. query strings are permitted.\n\n    <version> is the optional http version string. it defaults to \"http/1.0\"\n              but some servers might behave incorrectly in http 1.0, so turning\n              it to http/1.1 may sometimes help. note that the host field is\n              mandatory in http/1.1, and as a trick, it is possible to pass it\n              after \"\\r\\n\" following the version string.\n\n  by default, server health checks only consist in trying to establish a tcp\n  connection. when \"option httpchk\" is specified, a complete http request is\n  sent once the tcp connection is established, and responses 2xx and 3xx are\n  considered valid, while all other ones indicate a server failure, including\n  the lack of any response.\n\n  the port and interval are specified in the server configuration.\n\n  this option does not necessarily require an http backend, it also works with\n  plain tcp backends. this is particularly useful to check simple scripts bound\n  to some dedicated ports using the inetd daemon.\n\n  examples :\n      # relay https traffic to apache instance and check service availability\n      # using http request \"options * http/1.1\" on port 80.\n      backend https_relay\n          mode tcp\n          option httpchk options * http/1.1\\r\\nhost:\\ www\n          server apache1 192.168.1.1:443 check port 80\n\n  see also : \"option ssl-hello-chk\", \"option smtpchk\", \"option mysql-check\",\n             \"option pgsql-check\", \"http-check\" and the \"check\", \"port\" and\n             \"inter\" server options.\n\noption httpclose\nno option httpclose\n  enable or disable passive http connection closing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\".\n\n  if \"option httpclose\" is set, haproxy will work in http tunnel mode and check\n  if a \"connection: close\" header is already set in each direction, and will\n  add one if missing. each end should react to this by actively closing the tcp\n  connection after each transfer, thus resulting in a switch to the http close\n  mode. any \"connection\" header different from \"close\" will also be removed.\n  note that this option is deprecated since what it does is very cheap but not\n  reliable. using \"option http-server-close\" or \"option forceclose\" is strongly\n  recommended instead.\n\n  it seldom happens that some servers incorrectly ignore this header and do not\n  close the connection even though they reply \"connection: close\". for this\n  reason, they are not compatible with older http 1.0 browsers. if this happens\n  it is possible to use the \"option forceclose\" which actively closes the\n  request connection once the server responds. option \"forceclose\" also\n  releases the server connection earlier because it does not have to wait for\n  the client to acknowledge it.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  it disables and replaces any previous \"option http-server-close\",\n  \"option forceclose\", \"option http-keep-alive\" or \"option http-tunnel\". please\n  check section 4 (\"proxies\") to see how this option combines with others when\n  frontend and backend options differ.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\" and\n             \"1.1\\. the http transaction model\".\n\noption httplog [ clf ]\n  enable logging of http request, session state and timers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    clf       if the \"clf\" argument is added, then the output format will be\n              the clf format instead of haproxy's default http format. you can\n              use this when you need to feed haproxy's logs through a specific\n              log analyser which only support the clf format and which is not\n              extensible.\n\n  by default, the log output format is very poor, as it only contains the\n  source and destination addresses, and the instance name. by specifying\n  \"option httplog\", each log line turns into a much richer format including,\n  but not limited to, the http request, the connection timers, the session\n  status, the connections numbers, the captured headers and cookies, the\n  frontend, backend and server name, and of course the source address and\n  ports.\n\n  this option may be set either in the frontend or the backend.\n\n  specifying only \"option httplog\" will automatically clear the 'clf' mode\n  if it was set by default.\n\n  see also :  section 8 about logging.\n\noption http_proxy\nno option http_proxy\n  enable or disable plain http proxy mode\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  it sometimes happens that people need a pure http proxy which understands\n  basic proxy requests without caching nor any fancy feature. in this case,\n  it may be worth setting up an haproxy instance with the \"option http_proxy\"\n  set. in this mode, no server is declared, and the connection is forwarded to\n  the ip address and port found in the url after the \"http://\" scheme.\n\n  no host address resolution is performed, so this only works when pure ip\n  addresses are passed. since this option's usage perimeter is rather limited,\n  it will probably be used only by experts who know they need exactly it. last,\n  if the clients are susceptible of sending keep-alive requests, it will be\n  needed to add \"option httpclose\" to ensure that all requests will correctly\n  be analyzed.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  example :\n    # this backend understands http proxy requests and forwards them directly.\n    backend direct_forward\n        option httpclose\n        option http_proxy\n\n  see also : \"option httpclose\"\n\noption independent-streams\nno option independent-streams\n  enable or disable independent timeout processing for both directions\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |  yes\n  arguments : none\n\n  by default, when data is sent over a socket, both the write timeout and the\n  read timeout for that socket are refreshed, because we consider that there is\n  activity on that socket, and we have no other means of guessing if we should\n  receive data or not.\n\n  while this default behaviour is desirable for almost all applications, there\n  exists a situation where it is desirable to disable it, and only refresh the\n  read timeout if there are incoming data. this happens on sessions with large\n  timeouts and low amounts of exchanged data such as telnet session. if the\n  server suddenly disappears, the output data accumulates in the system's\n  socket buffers, both timeouts are correctly refreshed, and there is no way\n  to know the server does not receive them, so we don't timeout. however, when\n  the underlying protocol always echoes sent data, it would be enough by itself\n  to detect the issue using the read timeout. note that this problem does not\n  happen with more verbose protocols because data won't accumulate long in the\n  socket buffers.\n\n  when this option is set on the frontend, it will disable read timeout updates\n  on data sent to the client. there probably is little use of this case. when\n  the option is set on the backend, it will disable read timeout updates on\n  data sent to the server. doing so will typically break large http posts from\n  slow lines, so use it with caution.\n\n  note: older versions used to call this setting \"option independent-streams\"\n        with a spelling mistake. this spelling is still supported but\n        deprecated.\n\n  see also : \"timeout client\", \"timeout server\" and \"timeout tunnel\"\n\noption ldap-check\n  use ldapv3 health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  it is possible to test that the server correctly talks ldapv3 instead of just\n  testing that it accepts the tcp connection. when this option is set, an\n  ldapv3 anonymous simple bind message is sent to the server, and the response\n  is analyzed to find an ldapv3 bind response message.\n\n  the server is considered valid only when the ldap response contains success\n  resultcode (http://tools.ietf.org/html/rfc4511#section-4.1.9).\n\n  logging of bind requests is server dependent see your documentation how to\n  configure it.\n\n  example :\n        option ldap-check\n\n  see also : \"option httpchk\"\n\noption external-check\n  use external processes for server health checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  it is possible to test the health of a server using an external command.\n  this is achieved by running the executable set using \"external-check\n  command\".\n\n  requires the \"external-check\" global to be set.\n\n  see also : \"external-check\", \"external-check command\", \"external-check path\"\n\noption log-health-checks\nno option log-health-checks\n  enable or disable logging of health checks status updates\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |  yes\n  arguments : none\n\n  by default, failed health check are logged if server is up and successful\n  health checks are logged if server is down, so the amount of additional\n  information is limited.\n\n  when this option is enabled, any change of the health check status or to\n  the server's health will be logged, so that it becomes possible to know\n  that a server was failing occasional checks before crashing, or exactly when\n  it failed to respond a valid http status, then when the port started to\n  reject connections, then when the server stopped responding at all.\n\n  note that status changes not caused by health checks (eg: enable/disable on\n  the cli) are intentionally not logged by this option.\n\n  see also: \"option httpchk\", \"option ldap-check\", \"option mysql-check\",\n            \"option pgsql-check\", \"option redis-check\", \"option smtpchk\",\n            \"option tcp-check\", \"log\" and section 8 about logging.\n\noption log-separate-errors\nno option log-separate-errors\n  change log level for non-completely successful connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  sometimes looking for errors in logs is not easy. this option makes haproxy\n  raise the level of logs containing potentially interesting information such\n  as errors, timeouts, retries, redispatches, or http status codes 5xx. the\n  level changes from \"info\" to \"err\". this makes it possible to log them\n  separately to a different file with most syslog daemons. be careful not to\n  remove them from the original file, otherwise you would lose ordering which\n  provides very important information.\n\n  using this option, large sites dealing with several thousand connections per\n  second may log normal traffic to a rotating buffer and only archive smaller\n  error logs.\n\n  see also : \"log\", \"dontlognull\", \"dontlog-normal\" and section 8 about\n             logging.\n\noption logasap\nno option logasap\n  enable or disable early logging of http requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, http requests are logged upon termination so that the total\n  transfer time and the number of bytes appear in the logs. when large objects\n  are being transferred, it may take a while before the request appears in the\n  logs. using \"option logasap\", the request gets logged as soon as the server\n  sends the complete headers. the only missing information in the logs will be\n  the total number of bytes which will indicate everything except the amount\n  of data transferred, and the total time which will not take the transfer\n  time into account. in such a situation, it's a good practice to capture the\n  \"content-length\" response header so that the logs at least indicate how many\n  bytes are expected to be transferred.\n\n  examples :\n      listen http_proxy 0.0.0.0:80\n          mode http\n          option httplog\n          option logasap\n          log 192.168.2.200 local3\n\n    >>> feb  6 12:14:14 localhost \\\n          haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n          static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \\\n          \"get /image.iso http/1.0\"\n\n  see also : \"option httplog\", \"capture response header\", and section 8 about\n             logging.\n\noption mysql-check [ user <username> [ post-41 ] ]\n  use mysql health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <username> this is the username which will be used when connecting to mysql\n               server.\n    post-41    send post v4.1 client compatible checks\n\n  if you specify a username, the check consists of sending two mysql packet,\n  one client authentication packet, and one quit packet, to correctly close\n  mysql session. we then parse the mysql handshake initialisation packet and/or\n  error packet. it is a basic but useful test which does not produce error nor\n  aborted connect on the server. however, it requires adding an authorization\n  in the mysql table, like this :\n\n      use mysql;\n      insert into user (host,user) values ('<ip_of_haproxy>','<username>');\n      flush privileges;\n\n  if you don't specify a username (it is deprecated and not recommended), the\n  check only consists in parsing the mysql handshake initialisation packet or\n  error packet, we don't send anything in this mode. it was reported that it\n  can generate lockout if check is too frequent and/or if there is not enough\n  traffic. in fact, you need in this case to check mysql \"max_connect_errors\"\n  value as if a connection is established successfully within fewer than mysql\n  \"max_connect_errors\" attempts after a previous connection was interrupted,\n  the error count for the host is cleared to zero. if haproxy's server get\n  blocked, the \"flush hosts\" statement is the only way to unblock it.\n\n  remember that this does not check database presence nor database consistency.\n  to do this, you can use an external check with xinetd for example.\n\n  the check requires mysql >=3.22, for older version, please use tcp check.\n\n  most often, an incoming mysql server needs to see the client's ip address for\n  various purposes, including ip privilege matching and connection logging.\n  when possible, it is often wise to masquerade the client's ip address when\n  connecting to the server using the \"usesrc\" argument of the \"source\" keyword,\n  which requires the cttproxy feature to be compiled in, and the mysql server\n  to route the client via the machine hosting haproxy.\n\n  see also: \"option httpchk\"\n\noption nolinger\nno option nolinger\n  enable or disable immediate session resource cleaning after close\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when clients or servers abort connections in a dirty way (eg: they are\n  physically disconnected), the session timeouts triggers and the session is\n  closed. but it will remain in fin_wait1 state for some time in the system,\n  using some resources and possibly limiting the ability to establish newer\n  connections.\n\n  when this happens, it is possible to activate \"option nolinger\" which forces\n  the system to immediately remove any socket's pending data on close. thus,\n  the session is instantly purged from the system's tables. this usually has\n  side effects such as increased number of tcp resets due to old retransmits\n  getting immediately rejected. some firewalls may sometimes complain about\n  this too.\n\n  for this reason, it is not recommended to use this option when not absolutely\n  needed. you know that you need it when you have thousands of fin_wait1\n  sessions on your system (time_wait ones do not count).\n\n  this option may be used both on frontends and backends, depending on the side\n  where it is required. use it on the frontend for clients, and on the backend\n  for servers.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption originalto [ except <network> ] [ header <name> ]\n  enable insertion of the x-original-to header to requests sent to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <network> is an optional argument used to disable this option for sources\n              matching <network>\n    <name>    an optional argument to specify a different \"x-original-to\"\n              header name.\n\n  since haproxy can work in transparent mode, every request from a client can\n  be redirected to the proxy and haproxy itself can proxy every request to a\n  complex squid environment and the destination host from so_original_dst will\n  be lost. this is annoying when you want access rules based on destination ip\n  addresses. to solve this problem, a new http header \"x-original-to\" may be\n  added by haproxy to all requests sent to the server. this header contains a\n  value representing the original destination ip address. since this must be\n  configured to always use the last occurrence of this header only. note that\n  only the last occurrence of the header must be used, since it is really\n  possible that the client has already brought one.\n\n  the keyword \"header\" may be used to supply a different header name to replace\n  the default \"x-original-to\". this can be useful where you might already\n  have a \"x-original-to\" header from a different application, and you need\n  preserve it. also if your backend server doesn't use the \"x-original-to\"\n  header and requires different one.\n\n  sometimes, a same haproxy instance may be shared between a direct client\n  access and a reverse-proxy access (for instance when an ssl reverse-proxy is\n  used to decrypt https traffic). it is possible to disable the addition of the\n  header for a known source address or network by adding the \"except\" keyword\n  followed by the network address. in this case, any source ip matching the\n  network will not cause an addition of this header. most common uses are with\n  private networks or 127.0.0.1.\n\n  this option may be specified either in the frontend or in the backend. if at\n  least one of them uses it, the header will be added. note that the backend's\n  setting of the header subargument takes precedence over the frontend's if\n  both are defined.\n\n  examples :\n    # original destination address\n    frontend www\n        mode http\n        option originalto except 127.0.0.1\n\n    # those servers want the ip address in x-client-dst\n    backend www\n        mode http\n        option originalto header x-client-dst\n\n  see also : \"option httpclose\", \"option http-server-close\",\n             \"option forceclose\"\n\noption persist\nno option persist\n  enable or disable forced persistence on down servers\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when an http request reaches a backend with a cookie which references a dead\n  server, by default it is redispatched to another server. it is possible to\n  force the request to be sent to the dead server first using \"option persist\"\n  if absolutely needed. a common use case is when servers are under extreme\n  load and spend their time flapping. in this case, the users would still be\n  directed to the server they opened the session on, in the hope they would be\n  correctly served. it is recommended to use \"option redispatch\" in conjunction\n  with this option so that in the event it would not be possible to connect to\n  the server at all (server definitely dead), the client would finally be\n  redirected to another valid server.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option redispatch\", \"retries\", \"force-persist\"\n\noption pgsql-check [ user <username> ]\n  use postgresql health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <username> this is the username which will be used when connecting to\n               postgresql server.\n\n  the check sends a postgresql startupmessage and waits for either\n  authentication request or errorresponse message. it is a basic but useful\n  test which does not produce error nor aborted connect on the server.\n  this check is identical with the \"mysql-check\".\n\n  see also: \"option httpchk\"\n\noption prefer-last-server\nno option prefer-last-server\n  allow multiple load balanced requests to remain on the same server\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when the load balancing algorithm in use is not deterministic, and a previous\n  request was sent to a server to which haproxy still holds a connection, it is\n  sometimes desirable that subsequent requests on a same session go to the same\n  server as much as possible. note that this is different from persistence, as\n  we only indicate a preference which haproxy tries to apply without any form\n  of warranty. the real use is for keep-alive connections sent to servers. when\n  this option is used, haproxy will try to reuse the same connection that is\n  attached to the server instead of rebalancing to another server, causing a\n  close of the connection. this can make sense for static file servers. it does\n  not make much sense to use this in combination with hashing algorithms. note,\n  haproxy already automatically tries to stick to a server which sends a 401 or\n  to a proxy which sends a 407 (authentication required). this is mandatory for\n  use with the broken ntlm authentication challenge, and significantly helps in\n  troubleshooting some faulty applications. option prefer-last-server might be\n  desirable in these environments as well, to avoid redistributing the traffic\n  after every other response.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also: \"option http-keep-alive\"\n\noption redispatch\noption redispatch <interval>\nno option redispatch\n  enable or disable session redistribution in case of connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <interval> the optional integer value that controls how often redispatches\n               occur when retrying connections. positive value p indicates a\n               redispatch is desired on every pth retry, and negative value\n               n indicate a redispath is desired on the nth retry prior to the\n               last retry. for example, the default of -1 preserves the\n               historical behaviour of redispatching on the last retry, a\n               positive value of 1 would indicate a redispatch on every retry,\n               and a positive value of 3 would indicate a redispatch on every\n               third retry. you can disable redispatches with a value of 0.\n\n  in http mode, if a server designated by a cookie is down, clients may\n  definitely stick to it because they cannot flush the cookie, so they will not\n  be able to access the service anymore.\n\n  specifying \"option redispatch\" will allow the proxy to break their\n  persistence and redistribute them to a working server.\n\n  it also allows to retry connections to another server in case of multiple\n  connection failures. of course, it requires having \"retries\" set to a nonzero\n  value.\n\n  this form is the preferred form, which replaces both the \"redispatch\" and\n  \"redisp\" keywords.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"redispatch\", \"retries\", \"force-persist\"\n\noption redis-check\n  use redis health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  it is possible to test that the server correctly talks redis protocol instead\n  of just testing that it accepts the tcp connection. when this option is set,\n  a ping redis command is sent to the server, and the response is analyzed to\n  find the \"+pong\" response message.\n\n  example :\n        option redis-check\n\n  see also : \"option httpchk\"\n\noption smtpchk\noption smtpchk <hello> <domain>\n  use smtp health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <hello>   is an optional argument. it is the \"hello\" command to use. it can\n              be either \"helo\" (for smtp) or \"ehlo\" (for estmp). all other\n              values will be turned into the default command (\"helo\").\n\n    <domain>  is the domain name to present to the server. it may only be\n              specified (and is mandatory) if the hello command has been\n              specified. by default, \"localhost\" is used.\n\n  when \"option smtpchk\" is set, the health checks will consist in tcp\n  connections followed by an smtp command. by default, this command is\n  \"helo localhost\". the server's return code is analyzed and only return codes\n  starting with a \"2\" will be considered as valid. all other responses,\n  including a lack of response will constitute an error and will indicate a\n  dead server.\n\n  this test is meant to be used with smtp servers or relays. depending on the\n  request, it is possible that some servers do not log each connection attempt,\n  so you may want to experiment to improve the behaviour. using telnet on port\n  25 is often easier than adjusting the configuration.\n\n  most often, an incoming smtp server needs to see the client's ip address for\n  various purposes, including spam filtering, anti-spoofing and logging. when\n  possible, it is often wise to masquerade the client's ip address when\n  connecting to the server using the \"usesrc\" argument of the \"source\" keyword,\n  which requires the cttproxy feature to be compiled in.\n\n  example :\n        option smtpchk helo mydomain.org\n\n  see also : \"option httpchk\", \"source\"\n\noption socket-stats\nno option socket-stats\n\n  enable or disable collecting & providing separate statistics for each socket.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n\n  arguments : none\n\noption splice-auto\nno option splice-auto\n  enable or disable automatic kernel acceleration on sockets in both directions\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will automatically evaluate the opportunity to use kernel tcp splicing to\n  forward data between the client and the server, in either direction. haproxy\n  uses heuristics to estimate if kernel splicing might improve performance or\n  not. both directions are handled independently. note that the heuristics used\n  are not much aggressive in order to limit excessive use of splicing. this\n  option requires splicing to be enabled at compile time, and may be globally\n  disabled with the global option \"nosplice\". since splice uses pipes, using it\n  requires that there are enough spare pipes.\n\n  important note: kernel-based tcp splicing is a linux-specific feature which\n  first appeared in kernel 2.6.25\\. it offers kernel-based acceleration to\n  transfer data between sockets without copying these data to user-space, thus\n  providing noticeable performance gains and cpu cycles savings. since many\n  early implementations are buggy, corrupt data and/or are inefficient, this\n  feature is not enabled by default, and it should be used with extreme care.\n  while it is not possible to detect the correctness of an implementation,\n  2.6.29 is the first version offering a properly working implementation. in\n  case of doubt, splicing may be globally disabled using the global \"nosplice\"\n  keyword.\n\n  example :\n        option splice-auto\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-request\", \"option splice-response\", and global\n             options \"nosplice\" and \"maxpipes\"\n\noption splice-request\nno option splice-request\n  enable or disable automatic kernel acceleration on sockets for requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will use kernel tcp splicing whenever possible to forward data going from\n  the client to the server. it might still use the recv/send scheme if there\n  are no spare pipes left. this option requires splicing to be enabled at\n  compile time, and may be globally disabled with the global option \"nosplice\".\n  since splice uses pipes, using it requires that there are enough spare pipes.\n\n  important note: see \"option splice-auto\" for usage limitations.\n\n  example :\n        option splice-request\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-auto\", \"option splice-response\", and global options\n             \"nosplice\" and \"maxpipes\"\n\noption splice-response\nno option splice-response\n  enable or disable automatic kernel acceleration on sockets for responses\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will use kernel tcp splicing whenever possible to forward data going from\n  the server to the client. it might still use the recv/send scheme if there\n  are no spare pipes left. this option requires splicing to be enabled at\n  compile time, and may be globally disabled with the global option \"nosplice\".\n  since splice uses pipes, using it requires that there are enough spare pipes.\n\n  important note: see \"option splice-auto\" for usage limitations.\n\n  example :\n        option splice-response\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-auto\", \"option splice-request\", and global options\n             \"nosplice\" and \"maxpipes\"\n\noption srvtcpka\nno option srvtcpka\n  enable or disable the sending of tcp keepalive packets on the server side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"srvtcpka\" enables the emission of tcp keep-alive probes on the\n  server side of a connection, which should help when session expirations are\n  noticed between haproxy and a server.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option clitcpka\", \"option tcpka\"\n\noption ssl-hello-chk\n  use sslv3 client hello health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when some ssl-based protocols are relayed in tcp mode through haproxy, it is\n  possible to test that the server correctly talks ssl instead of just testing\n  that it accepts the tcp connection. when \"option ssl-hello-chk\" is set, pure\n  sslv3 client hello messages are sent once the connection is established to\n  the server, and the response is analyzed to find an ssl server hello message.\n  the server is considered valid only when the response contains this server\n  hello message.\n\n  all servers tested till there correctly reply to sslv3 client hello messages,\n  and most servers tested do not even log the requests containing only hello\n  messages, which is appreciable.\n\n  note that this check works even when ssl support was not built into haproxy\n  because it forges the ssl message. when ssl support is available, it is best\n  to use native ssl health checks instead of this one.\n\n  see also: \"option httpchk\", \"check-ssl\"\n\noption tcp-check\n  perform health checks using tcp-check send/expect sequences\n  may be used in sections:   defaults | frontend | listen | backend\n                               yes    |    no    |   yes  |   yes\n\n  this health check method is intended to be combined with \"tcp-check\" command\n  lists in order to support send/expect types of health check sequences.\n\n  tcp checks currently support 4 modes of operations :\n    - no \"tcp-check\" directive : the health check only consists in a connection\n      attempt, which remains the default mode.\n\n    - \"tcp-check send\" or \"tcp-check send-binary\" only is mentioned : this is\n      used to send a string along with a connection opening. with some\n      protocols, it helps sending a \"quit\" message for example that prevents\n      the server from logging a connection error for each health check. the\n      check result will still be based on the ability to open the connection\n      only.\n\n    - \"tcp-check expect\" only is mentioned : this is used to test a banner.\n      the connection is opened and haproxy waits for the server to present some\n      contents which must validate some rules. the check result will be based\n      on the matching between the contents and the rules. this is suited for\n      pop, imap, smtp, ftp, ssh, telnet.\n\n    - both \"tcp-check send\" and \"tcp-check expect\" are mentioned : this is\n      used to test a hello-type protocol. haproxy sends a message, the server\n      responds and its response is analysed. the check result will be based on\n      the matching between the response contents and the rules. this is often\n      suited for protocols which require a binding or a request/response model.\n      ldap, mysql, redis and ssl are example of such protocols, though they\n      already all have their dedicated checks with a deeper understanding of\n      the respective protocols.\n      in this mode, many questions may be sent and many answers may be\n      analysed.\n\n    a fifth mode can be used to insert comments in different steps of the\n    script.\n\n    for each tcp-check rule you create, you can add a \"comment\" directive,\n    followed by a string. this string will be reported in the log and stderr\n    in debug mode. it is useful to make user-friendly error reporting.\n    the \"comment\" is of course optional.\n\n  examples :\n         # perform a pop check (analyse only server's banner)\n         option tcp-check\n         tcp-check expect string +ok\\ pop3\\ ready comment pop\\ protocol\n\n         # perform an imap check (analyse only server's banner)\n         option tcp-check\n         tcp-check expect string *\\ ok\\ imap4\\ ready comment imap\\ protocol\n\n         # look for the redis master server after ensuring it speaks well\n         # redis protocol, then it exits properly.\n         # (send a command then analyse the response 3 times)\n         option tcp-check\n         tcp-check comment ping\\ phase\n         tcp-check send ping\\r\\n\n         tcp-check expect +ponge\n         tcp-check comment role\\ check\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n         tcp-check comment quit\\ phase\n         tcp-check send quit\\r\\n\n         tcp-check expect string +ok\n\n         forge a http request, then analyse the response\n         (send many headers before analyzing)\n         option tcp-check\n         tcp-check comment forge\\ and\\ send\\ http\\ request\n         tcp-check send head\\ /\\ http/1.1\\r\\n\n         tcp-check send host:\\ www.mydomain.com\\r\\n\n         tcp-check send user-agent:\\ haproxy\\ tcpcheck\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring http/1\\..\\ (2..|3..) comment check\\ http\\ response\n\n  see also : \"tcp-check expect\", \"tcp-check send\"\n\noption tcp-smart-accept\nno option tcp-smart-accept\n  enable or disable the saving of one ack packet during the accept sequence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |    no\n  arguments : none\n\n  when an http connection request comes in, the system acknowledges it on\n  behalf of haproxy, then the client immediately sends its request, and the\n  system acknowledges it too while it is notifying haproxy about the new\n  connection. haproxy then reads the request and responds. this means that we\n  have one tcp ack sent by the system for nothing, because the request could\n  very well be acknowledged by haproxy when it sends its response.\n\n  for this reason, in http mode, haproxy automatically asks the system to avoid\n  sending this useless ack on platforms which support it (currently at least\n  linux). it must not cause any problem, because the system will send it anyway\n  after 40 ms if the response takes more time than expected to come.\n\n  during complex network debugging sessions, it may be desirable to disable\n  this optimization because delayed acks can make troubleshooting more complex\n  when trying to identify where packets are delayed. it is then possible to\n  fall back to normal behaviour by specifying \"no option tcp-smart-accept\".\n\n  it is also possible to force it for non-http proxies by simply specifying\n  \"option tcp-smart-accept\". for instance, it can make sense with some services\n  such as smtp where the server speaks first.\n\n  it is recommended to avoid forcing this option in a defaults section. in case\n  of doubt, consider setting it back to automatic values by prepending the\n  \"default\" keyword before it, or disabling it using the \"no\" keyword.\n\n  see also : \"option tcp-smart-connect\"\n\noption tcp-smart-connect\nno option tcp-smart-connect\n  enable or disable the saving of one ack packet during the connect sequence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  on certain systems (at least linux), haproxy can ask the kernel not to\n  immediately send an empty ack upon a connection request, but to directly\n  send the buffer request instead. this saves one packet on the network and\n  thus boosts performance. it can also be useful for some servers, because they\n  immediately get the request along with the incoming connection.\n\n  this feature is enabled when \"option tcp-smart-connect\" is set in a backend.\n  it is not enabled by default because it makes network troubleshooting more\n  complex.\n\n  it only makes sense to enable it with protocols where the client speaks first\n  such as http. in other situations, if there is no data to send in place of\n  the ack, a normal ack is sent.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option tcp-smart-accept\"\n\noption tcpka\n  enable or disable the sending of tcp keepalive packets on both sides\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"tcpka\" enables the emission of tcp keep-alive probes on both\n  the client and server sides of a connection. note that this is meaningful\n  only in \"defaults\" or \"listen\" sections. if this option is used in a\n  frontend, only the client side will get keep-alives, and if this option is\n  used in a backend, only the server side will get keep-alives. for this\n  reason, it is strongly recommended to explicitly use \"option clitcpka\" and\n  \"option srvtcpka\" when the configuration is split between frontends and\n  backends.\n\n  see also : \"option clitcpka\", \"option srvtcpka\"\n\noption tcplog\n  enable advanced logging of tcp connections with session state and timers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default, the log output format is very poor, as it only contains the\n  source and destination addresses, and the instance name. by specifying\n  \"option tcplog\", each log line turns into a much richer format including, but\n  not limited to, the connection timers, the session status, the connections\n  numbers, the frontend, backend and server name, and of course the source\n  address and ports. this option is useful for pure tcp proxies in order to\n  find which of the client or server disconnects or times out. for normal http\n  proxies, it's better to use \"option httplog\" which is even more complete.\n\n  this option may be set either in the frontend or the backend.\n\n  see also :  \"option httplog\", and section 8 about logging.\n\noption transparent\nno option transparent\n  enable client-side transparent proxying\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  this option was introduced in order to provide layer 7 persistence to layer 3\n  load balancers. the idea is to use the os's ability to redirect an incoming\n  connection for a remote address to a local process (here haproxy), and let\n  this process know what address was initially requested. when this option is\n  used, sessions without cookies will be forwarded to the original destination\n  ip address of the incoming request (which should match that of another\n  equipment), while requests with cookies will still be forwarded to the\n  appropriate server.\n\n  note that contrary to a common belief, this option does not make haproxy\n  present the client's ip to the server when establishing the connection.\n\n  see also: the \"usesrc\" argument of the \"source\" keyword, and the\n            \"transparent\" option of the \"bind\" keyword.\n\nexternal-check command <command>\n  executable to run when performing an external-check\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  arguments :\n    <command> is the external command to run\n\n  the arguments passed to the to the command are:\n\n  <proxy_address> <proxy_port> <server_address> <server_port>\n\n  the <proxy_address> and <proxy_port> are derived from the first listener\n  that is either ipv4, ipv6 or a unix socket. in the case of a unix socket\n  listener the proxy_address will be the path of the socket and the\n  <proxy_port> will be the string \"not_used\". in a backend section, it's not\n  possible to determine a listener, and both <proxy_address> and <proxy_port>\n  will have the string value \"not_used\".\n\n  some values are also provided through environment variables.\n\n  environment variables :\n    haproxy_proxy_addr      the first bind address if available (or empty if not\n                            applicable, for example in a \"backend\" section).\n\n    haproxy_proxy_id        the backend id.\n\n    haproxy_proxy_name      the backend name.\n\n    haproxy_proxy_port      the first bind port if available (or empty if not\n                            applicable, for example in a \"backend\" section or\n                            for a unix socket).\n\n    haproxy_server_addr     the server address.\n\n    haproxy_server_curconn  the current number of connections on the server.\n\n    haproxy_server_id       the server id.\n\n    haproxy_server_maxconn  the server max connections.\n\n    haproxy_server_name     the server name.\n\n    haproxy_server_port     the server port if available (or empty for a unix\n                            socket).\n\n    path                    the path environment variable used when executing\n                            the command may be set using \"external-check path\".\n\n  if the command executed and exits with a zero status then the check is\n  considered to have passed, otherwise the check is considered to have\n  failed.\n\n  example :\n        external-check command /bin/true\n\n  see also : \"external-check\", \"option external-check\", \"external-check path\"\n\nexternal-check path <path>\n  the value of the path environment variable used when running an external-check\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  arguments :\n    <path> is the path used when executing external command to run\n\n  the default path is \"\".\n\n  example :\n        external-check path \"/usr/bin:/bin\"\n\n  see also : \"external-check\", \"option external-check\",\n             \"external-check command\"\n\npersist rdp-cookie\npersist rdp-cookie(<name>)\n  enable rdp cookie-based persistence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <name>    is the optional name of the rdp cookie to check. if omitted, the\n              default cookie name \"msts\" will be used. there currently is no\n              valid reason to change this name.\n\n  this statement enables persistence based on an rdp cookie. the rdp cookie\n  contains all information required to find the server in the list of known\n  servers. so when this option is set in the backend, the request is analysed\n  and if an rdp cookie is found, it is decoded. if it matches a known server\n  which is still up (or if \"option persist\" is set), then the connection is\n  forwarded to this server.\n\n  note that this only makes sense in a tcp backend, but for this to work, the\n  frontend must have waited long enough to ensure that an rdp cookie is present\n  in the request buffer. this is the same requirement as with the \"rdp-cookie\"\n  load-balancing method. thus it is highly recommended to put all statements in\n  a single \"listen\" section.\n\n  also, it is important to understand that the terminal server will emit this\n  rdp cookie only if it is configured for \"token redirection mode\", which means\n  that the \"ip address redirection\" option is disabled.\n\n  example :\n        listen tse-farm\n            bind :3389\n            # wait up to 5s for an rdp cookie in the request\n            tcp-request inspect-delay 5s\n            tcp-request content accept if rdp_cookie\n            # apply rdp cookie persistence\n            persist rdp-cookie\n            # if server is unknown, let's balance on the same cookie.\n            # alternatively, \"balance leastconn\" may be useful too.\n            balance rdp-cookie\n            server srv1 1.1.1.1:3389\n            server srv2 1.1.1.2:3389\n\n  see also : \"balance rdp-cookie\", \"tcp-request\", the \"req_rdp_cookie\" acl and\n  the rdp_cookie pattern fetch function.\n\nrate-limit sessions <rate>\n  set a limit on the number of new sessions accepted per second on a frontend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <rate>    the <rate> parameter is an integer designating the maximum number\n              of new sessions per second to accept on the frontend.\n\n  when the frontend reaches the specified number of new sessions per second, it\n  stops accepting new connections until the rate drops below the limit again.\n  during this time, the pending sessions will be kept in the socket's backlog\n  (in system buffers) and haproxy will not even be aware that sessions are\n  pending. when applying very low limit on a highly loaded service, it may make\n  sense to increase the socket's backlog using the \"backlog\" keyword.\n\n  this feature is particularly efficient at blocking connection-based attacks\n  or service abuse on fragile servers. since the session rate is measured every\n  millisecond, it is extremely accurate. also, the limit applies immediately,\n  no delay is needed at all to detect the threshold.\n\n  example : limit the connection rate on smtp to 10 per second max\n        listen smtp\n            mode tcp\n            bind :25\n            rate-limit sessions 10\n            server 127.0.0.1:1025\n\n  note : when the maximum rate is reached, the frontend's status is not changed\n         but its sockets appear as \"waiting\" in the statistics if the\n         \"socket-stats\" option is enabled.\n\n  see also : the \"backlog\" keyword and the \"fe_sess_rate\" acl criterion.\n\nredirect location <loc> [code <code>] <option> [{if | unless} <condition>]\nredirect prefix   <pfx> [code <code>] <option> [{if | unless} <condition>]\nredirect scheme   <sch> [code <code>] <option> [{if | unless} <condition>]\n  return an http redirection if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  if/unless the condition is matched, the http request will lead to a redirect\n  response. if no condition is specified, the redirect applies unconditionally.\n\n  arguments :\n    <loc>     with \"redirect location\", the exact value in <loc> is placed into\n              the http \"location\" header. when used in an \"http-request\" rule,\n              <loc> value follows the log-format rules and can include some\n              dynamic values (see custom log format in section 8.2.4).\n\n    <pfx>     with \"redirect prefix\", the \"location\" header is built from the\n              concatenation of <pfx> and the complete uri path, including the\n              query string, unless the \"drop-query\" option is specified (see\n              below). as a special case, if <pfx> equals exactly \"/\", then\n              nothing is inserted before the original uri. it allows one to\n              redirect to the same url (for instance, to insert a cookie). when\n              used in an \"http-request\" rule, <pfx> value follows the log-format\n              rules and can include some dynamic values (see custom log format\n              in section 8.2.4).\n\n    <sch>     with \"redirect scheme\", then the \"location\" header is built by\n              concatenating <sch> with \"://\" then the first occurrence of the\n              \"host\" header, and then the uri path, including the query string\n              unless the \"drop-query\" option is specified (see below). if no\n              path is found or if the path is \"*\", then \"/\" is used instead. if\n              no \"host\" header is found, then an empty host component will be\n              returned, which most recent browsers interpret as redirecting to\n              the same host. this directive is mostly used to redirect http to\n              https. when used in an \"http-request\" rule, <sch> value follows\n              the log-format rules and can include some dynamic values (see\n              custom log format in section 8.2.4).\n\n    <code>    the code is optional. it indicates which type of http redirection\n              is desired. only codes 301, 302, 303, 307 and 308 are supported,\n              with 302 used by default if no code is specified. 301 means\n              \"moved permanently\", and a browser may cache the location. 302\n              means \"moved permanently\" and means that the browser should not\n              cache the redirection. 303 is equivalent to 302 except that the\n              browser will fetch the location with a get method. 307 is just\n              like 302 but makes it clear that the same method must be reused.\n              likewise, 308 replaces 301 if the same method must be used.\n\n    <option>  there are several options which can be specified to adjust the\n              expected behaviour of a redirection :\n\n      - \"drop-query\"\n        when this keyword is used in a prefix-based redirection, then the\n        location will be set without any possible query-string, which is useful\n        for directing users to a non-secure page for instance. it has no effect\n        with a location-type redirect.\n\n      - \"append-slash\"\n        this keyword may be used in conjunction with \"drop-query\" to redirect\n        users who use a url not ending with a '/' to the same one with the '/'.\n        it can be useful to ensure that search engines will only see one url.\n        for this, a return code 301 is preferred.\n\n      - \"set-cookie name[=value]\"\n        a \"set-cookie\" header will be added with name (and optionally \"=value\")\n        to the response. this is sometimes used to indicate that a user has\n        been seen, for instance to protect against some types of dos. no other\n        cookie option is added, so the cookie will be a session cookie. note\n        that for a browser, a sole cookie name without an equal sign is\n        different from a cookie with an equal sign.\n\n      - \"clear-cookie name[=]\"\n        a \"set-cookie\" header will be added with name (and optionally \"=\"), but\n        with the \"max-age\" attribute set to zero. this will tell the browser to\n        delete this cookie. it is useful for instance on logout pages. it is\n        important to note that clearing the cookie \"name\" will not remove a\n        cookie set with \"name=value\". you have to clear the cookie \"name=\" for\n        that, because the browser makes the difference.\n\n  example: move the login url only to https.\n        acl clear      dst_port  80\n        acl secure     dst_port  8080\n        acl login_page url_beg   /login\n        acl logout     url_beg   /logout\n        acl uid_given  url_reg   /login?userid=[^&]+\n        acl cookie_set hdr_sub(cookie) seen=1\n\n        redirect prefix   https://mysite.com set-cookie seen=1 if !cookie_set\n        redirect prefix   https://mysite.com           if login_page !secure\n        redirect prefix   http://mysite.com drop-query if login_page !uid_given\n        redirect location http://mysite.com/           if !login_page secure\n        redirect location / clear-cookie userid=       if logout\n\n  example: send redirects for request for articles without a '/'.\n        acl missing_slash path_reg ^/article/[^/]*$\n        redirect code 301 prefix / drop-query append-slash if missing_slash\n\n  example: redirect all http traffic to https when ssl is handled by haproxy.\n        redirect scheme https if !{ ssl_fc }\n\n  example: append 'www.' prefix in front of all hosts not having it\n        http-request redirect code 301 location www.%[hdr(host)]%[req.uri] \\\n          unless { hdr_beg(host) -i www }\n\n  see section 7 about acl usage.\n\nredisp (deprecated)\nredispatch (deprecated)\n  enable or disable session redistribution in case of connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  in http mode, if a server designated by a cookie is down, clients may\n  definitely stick to it because they cannot flush the cookie, so they will not\n  be able to access the service anymore.\n\n  specifying \"redispatch\" will allow the proxy to break their persistence and\n  redistribute them to a working server.\n\n  it also allows to retry last connection to another server in case of multiple\n  connection failures. of course, it requires having \"retries\" set to a nonzero\n  value.\n\n  this form is deprecated, do not use it in any new configuration, use the new\n  \"option redispatch\" instead.\n\n  see also : \"option redispatch\"\n\nreqadd  <string> [{if | unless} <cond>]\n  add a header at the end of the http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a new line consisting in <string> followed by a line feed will be added after\n  the last header of an http request.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses.\n\n  example : add \"x-proto: ssl\" to requests coming via port 81\n     acl is-ssl  dst_port       81\n     reqadd      x-proto:\\ ssl  if is-ssl\n\n  see also: \"rspadd\", section 6 about http header manipulation, and section 7\n            about acls.\n\nreqallow  <search> [{if | unless} <cond>]\nreqiallow <search> [{if | unless} <cond>] (ignore case)\n  definitely allow an http request if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqallow\" keyword strictly matches case while \"reqiallow\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will mark the request as allowed, even if any later test would\n  result in a deny. the test applies both to the request line and to request\n  headers. keep in mind that urls in request line are case-sensitive while\n  header names are not.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # allow www.* but refuse *.local\n     reqiallow ^host:\\ www\\.\n     reqideny  ^host:\\ .*\\.local\n\n  see also: \"reqdeny\", \"block\", section 6 about http header manipulation, and\n            section 7 about acls.\n\nreqdel  <search> [{if | unless} <cond>]\nreqidel <search> [{if | unless} <cond>]  (ignore case)\n  delete all headers matching a regular expression in an http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the \"reqdel\"\n              keyword strictly matches case while \"reqidel\" ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any header line matching extended regular expression <search> in the request\n  will be completely deleted. most common use of this is to remove unwanted\n  and/or dangerous headers or cookies from a request before passing it to the\n  next servers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. keep in mind that header names are not case-sensitive.\n\n  example :\n     # remove x-forwarded-for header and server cookie\n     reqidel ^x-forwarded-for:.*\n     reqidel ^cookie:.*server=\n\n  see also: \"reqadd\", \"reqrep\", \"rspdel\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqdeny  <search> [{if | unless} <cond>]\nreqideny <search> [{if | unless} <cond>]  (ignore case)\n  deny an http request if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqdeny\" keyword strictly matches case while \"reqideny\" ignores\n              case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will mark the request as denied, even if any later test would\n  result in an allow. the test applies both to the request line and to request\n  headers. keep in mind that urls in request line are case-sensitive while\n  header names are not.\n\n  a denied request will generate an \"http 403 forbidden\" response once the\n  complete request has been parsed. this is consistent with what is practiced\n  using acls.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # refuse *.local, then allow www.*\n     reqideny  ^host:\\ .*\\.local\n     reqiallow ^host:\\ www\\.\n\n  see also: \"reqallow\", \"rspdeny\", \"block\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqpass  <search> [{if | unless} <cond>]\nreqipass <search> [{if | unless} <cond>]  (ignore case)\n  ignore any http request line matching a regular expression in next rules\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqpass\" keyword strictly matches case while \"reqipass\" ignores\n              case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will skip next rules, without assigning any deny or allow verdict.\n  the test applies both to the request line and to request headers. keep in\n  mind that urls in request line are case-sensitive while header names are not.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # refuse *.local, then allow www.*, but ignore \"www.private.local\"\n     reqipass  ^host:\\ www.private\\.local\n     reqideny  ^host:\\ .*\\.local\n     reqiallow ^host:\\ www\\.\n\n  see also: \"reqallow\", \"reqdeny\", \"block\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqrep  <search> <string> [{if | unless} <cond>]\nreqirep <search> <string> [{if | unless} <cond>]   (ignore case)\n  replace a regular expression with a string in an http request line\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the \"reqrep\"\n              keyword strictly matches case while \"reqirep\" ignores case.\n\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). references to matched\n              pattern groups are possible using the common \\n form, with n\n              being a single digit between 0 and 9\\. please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any line matching extended regular expression <search> in the request (both\n  the request line and header lines) will be completely replaced with <string>.\n  most common use of this is to rewrite urls or domain names in \"host\" headers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. note that for increased readability, it is suggested to add enough\n  spaces between the request and the response. keep in mind that urls in\n  request line are case-sensitive while header names are not.\n\n  example :\n     # replace \"/static/\" with \"/\" at the beginning of any request path.\n     reqrep ^([^\\ :]*)\\ /static/(.*)     \\1\\ /\\2\n     # replace \"www.mydomain.com\" with \"www\" in the host name.\n     reqirep ^host:\\ www.mydomain.com   host:\\ www\n\n  see also: \"reqadd\", \"reqdel\", \"rsprep\", \"tune.bufsize\", section 6 about\n            http header manipulation, and section 7 about acls.\n\nreqtarpit  <search> [{if | unless} <cond>]\nreqitarpit <search> [{if | unless} <cond>]  (ignore case)\n  tarpit an http request containing a line matching a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqtarpit\" keyword strictly matches case while \"reqitarpit\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will be tarpitted, which means that it will connect to nowhere, will\n  be kept open for a pre-defined time, then will return an http error 500 so\n  that the attacker does not suspect it has been tarpitted. the status 500 will\n  be reported in the logs, but the completion flags will indicate \"pt\". the\n  delay is defined by \"timeout tarpit\", or \"timeout connect\" if the former is\n  not set.\n\n  the goal of the tarpit is to slow down robots attacking servers with\n  identifiable requests. many robots limit their outgoing number of connections\n  and stay connected waiting for a reply which can take several minutes to\n  come. depending on the environment and attack, it may be particularly\n  efficient at reducing the load on the network and firewalls.\n\n  examples :\n     # ignore user-agents reporting any flavour of \"mozilla\" or \"msie\", but\n     # block all others.\n     reqipass   ^user-agent:\\.*(mozilla|msie)\n     reqitarpit ^user-agent:\n\n     # block bad guys\n     acl badguys src 10.1.0.3 172.16.13.20/28\n     reqitarpit . if badguys\n\n  see also: \"reqallow\", \"reqdeny\", \"reqpass\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nretries <value>\n  set the number of retries to perform on a server after a connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <value>   is the number of times a connection attempt should be retried on\n              a server when a connection either is refused or times out. the\n              default value is 3.\n\n  it is important to understand that this value applies to the number of\n  connection attempts, not full requests. when a connection has effectively\n  been established to a server, there will be no more retry.\n\n  in order to avoid immediate reconnections to a server which is restarting,\n  a turn-around timer of min(\"timeout connect\", one second) is applied before\n  a retry occurs.\n\n  when \"option redispatch\" is set, the last retry may be performed on another\n  server even if a cookie references a different server.\n\n  see also : \"option redispatch\"\n\nrspadd <string> [{if | unless} <cond>]\n  add a header at the end of the http response\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a new line consisting in <string> followed by a line feed will be added after\n  the last header of an http response.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses.\n\n  see also: \"reqadd\", section 6 about http header manipulation, and section 7\n            about acls.\n\nrspdel  <search> [{if | unless} <cond>]\nrspidel <search> [{if | unless} <cond>]  (ignore case)\n  delete all headers matching a regular expression in an http response\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rspdel\" keyword strictly matches case while \"rspidel\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any header line matching extended regular expression <search> in the response\n  will be completely deleted. most common use of this is to remove unwanted\n  and/or sensitive headers or cookies from a response before passing it to the\n  client.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. keep in mind that header names are not case-sensitive.\n\n  example :\n     # remove the server header from responses\n     rspidel ^server:.*\n\n  see also: \"rspadd\", \"rsprep\", \"reqdel\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nrspdeny  <search> [{if | unless} <cond>]\nrspideny <search> [{if | unless} <cond>]  (ignore case)\n  block an http response if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rspdeny\" keyword strictly matches case while \"rspideny\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a response containing any line which matches extended regular expression\n  <search> will mark the request as denied. the test applies both to the\n  response line and to response headers. keep in mind that header names are not\n  case-sensitive.\n\n  main use of this keyword is to prevent sensitive information leak and to\n  block the response before it reaches the client. if a response is denied, it\n  will be replaced with an http 502 error so that the client never retrieves\n  any sensitive data.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  rspdeny should be avoided in new designs.\n\n  example :\n     # ensure that no content type matching ms-word will leak\n     rspideny  ^content-type:\\.*/ms-word\n\n  see also: \"reqdeny\", \"acl\", \"block\", section 6 about http header manipulation\n            and section 7 about acls.\n\nrsprep  <search> <string> [{if | unless} <cond>]\nrspirep <search> <string> [{if | unless} <cond>]  (ignore case)\n  replace a regular expression with a string in an http response line\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rsprep\" keyword strictly matches case while \"rspirep\"\n              ignores case.\n\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). references to matched\n              pattern groups are possible using the common \\n form, with n\n              being a single digit between 0 and 9\\. please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any line matching extended regular expression <search> in the response (both\n  the response line and header lines) will be completely replaced with\n  <string>. most common use of this is to rewrite location headers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. note that for increased readability, it is suggested to add enough\n  spaces between the request and the response. keep in mind that header names\n  are not case-sensitive.\n\n  example :\n     # replace \"location: 127.0.0.1:8080\" with \"location: www.mydomain.com\"\n     rspirep ^location:\\ 127.0.0.1:8080    location:\\ www.mydomain.com\n\n  see also: \"rspadd\", \"rspdel\", \"reqrep\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nserver <name> <address>[:[port]] [param*]\n  declare a server in a backend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <name>    is the internal name assigned to this server. this name will\n              appear in logs and alerts.  if \"http-send-name-header\" is\n              set, it will be added to the request header sent to the server.\n\n    <address> is the ipv4 or ipv6 address of the server. alternatively, a\n              resolvable hostname is supported, but this name will be resolved\n              during start-up. address \"0.0.0.0\" or \"*\" has a special meaning.\n              it indicates that the connection will be forwarded to the same ip\n              address as the one from the client connection. this is useful in\n              transparent proxy architectures where the client's connection is\n              intercepted and haproxy must forward to the original destination\n              address. this is more or less what the \"transparent\" keyword does\n              except that with a server it's possible to limit concurrency and\n              to report statistics. optionally, an address family prefix may be\n              used before the address to force the family regardless of the\n              address format, which can be useful to specify a path to a unix\n              socket with no slash ('/'). currently supported prefixes are :\n                    - 'ipv4@'  -> address is always ipv4\n                    - 'ipv6@'  -> address is always ipv6\n                    - 'unix@'  -> address is a path to a local unix socket\n                    - 'abns@'  -> address is in abstract namespace (linux only)\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment\n              variables.\n\n    <port>    is an optional port specification. if set, all connections will\n              be sent to this port. if unset, the same port the client\n              connected to will be used. the port may also be prefixed by a \"+\"\n              or a \"-\". in this case, the server's port will be determined by\n              adding this value to the client's port.\n\n    <param*>  is a list of parameters for this server. the \"server\" keywords\n              accepts an important number of options and has a complete section\n              dedicated to it. please refer to section 5 for more details.\n\n  examples :\n        server first  10.1.1.1:1080 cookie first  check inter 1000\n        server second 10.1.1.2:1080 cookie second check inter 1000\n        server transp ipv4@\n        server backup \"${srv_backup}:1080\" backup\n        server www1_dc1 \"${lan_dc1}.101:80\"\n        server www1_dc2 \"${lan_dc2}.101:80\"\n\n  see also: \"default-server\", \"http-send-name-header\" and section 5 about\n             server options\n\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | client | clientip } ]\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]\nsource <addr>[:<port>] [interface <name>]\n  set the source address for outgoing connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <addr>    is the ipv4 address haproxy will bind to before connecting to a\n              server. this address is also used as a source for health checks.\n\n              the default value of 0.0.0.0 means that the system will select\n              the most appropriate address to reach its destination. optionally\n              an address family prefix may be used before the address to force\n              the family regardless of the address format, which can be useful\n              to specify a path to a unix socket with no slash ('/'). currently\n              supported prefixes are :\n                - 'ipv4@' -> address is always ipv4\n                - 'ipv6@' -> address is always ipv6\n                - 'unix@' -> address is a path to a local unix socket\n                - 'abns@' -> address is in abstract namespace (linux only)\n              you may want to reference some environment variables in the address\n              parameter, see section 2.3 about environment variables.\n\n    <port>    is an optional port. it is normally not needed but may be useful\n              in some very specific contexts. the default value of zero means\n              the system will select a free port. note that port ranges are not\n              supported in the backend. if you want to force port ranges, you\n              have to specify them on each \"server\" line.\n\n    <addr2>   is the ip address to present to the server when connections are\n              forwarded in full transparent proxy mode. this is currently only\n              supported on some patched linux kernels. when this address is\n              specified, clients connecting to the server will be presented\n              with this address, while health checks will still use the address\n              <addr>.\n\n    <port2>   is the optional port to present to the server when connections\n              are forwarded in full transparent proxy mode (see <addr2> above).\n              the default value of zero means the system will select a free\n              port.\n\n    <hdr>     is the name of a http header in which to fetch the ip to bind to.\n              this is the name of a comma-separated header list which can\n              contain multiple ip addresses. by default, the last occurrence is\n              used. this is designed to work with the x-forwarded-for header\n              and to automatically bind to the client's ip address as seen\n              by previous proxy, typically stunnel. in order to use another\n              occurrence from the last one, please see the <occ> parameter\n              below. when the header (or occurrence) is not found, no binding\n              is performed so that the proxy's default ip address is used. also\n              keep in mind that the header name is case insensitive, as for any\n              http header.\n\n    <occ>     is the occurrence number of a value to be used in a multi-value\n              header. this is to be used in conjunction with \"hdr_ip(<hdr>)\",\n              in order to specify which occurrence to use for the source ip\n              address. positive values indicate a position from the first\n              occurrence, 1 being the first one. negative values indicate\n              positions relative to the last one, -1 being the last one. this\n              is helpful for situations where an x-forwarded-for header is set\n              at the entry point of an infrastructure and must be used several\n              proxy layers away. when this value is not specified, -1 is\n              assumed. passing a zero here disables the feature.\n\n    <name>    is an optional interface name to which to bind to for outgoing\n              traffic. on systems supporting this features (currently, only\n              linux), this allows one to bind all traffic to the server to\n              this interface even if it is not the one the system would select\n              based on routing tables. this should be used with extreme care.\n              note that using this option requires root privileges.\n\n  the \"source\" keyword is useful in complex environments where a specific\n  address only is allowed to connect to the servers. it may be needed when a\n  private address must be used through a public gateway for instance, and it is\n  known that the system cannot determine the adequate source address by itself.\n\n  an extension which is available on certain patched linux kernels may be used\n  through the \"usesrc\" optional keyword. it makes it possible to connect to the\n  servers with an ip address which does not belong to the system itself. this\n  is called \"full transparent proxy mode\". for this to work, the destination\n  servers have to route their traffic back to this address through the machine\n  running haproxy, and ip forwarding must generally be enabled on this machine.\n\n  in this \"full transparent proxy\" mode, it is possible to force a specific ip\n  address to be presented to the servers. this is not much used in fact. a more\n  common use is to tell haproxy to present the client's ip address. for this,\n  there are two methods :\n\n    - present the client's ip and port addresses. this is the most transparent\n      mode, but it can cause problems when ip connection tracking is enabled on\n      the machine, because a same connection may be seen twice with different\n      states. however, this solution presents the huge advantage of not\n      limiting the system to the 64k outgoing address+port couples, because all\n      of the client ranges may be used.\n\n    - present only the client's ip address and select a spare port. this\n      solution is still quite elegant but slightly less transparent (downstream\n      firewalls logs will not match upstream's). it also presents the downside\n      of limiting the number of concurrent connections to the usual 64k ports.\n      however, since the upstream and downstream ports are different, local ip\n      connection tracking on the machine will not be upset by the reuse of the\n      same session.\n\n  note that depending on the transparent proxy technology used, it may be\n  required to force the source address. in fact, cttproxy version 2 requires an\n  ip address in <addr> above, and does not support setting of \"0.0.0.0\" as the\n  ip address because it creates nat entries which much match the exact outgoing\n  address. tproxy version 4 and some other kernel patches which work in pure\n  forwarding mode generally will not have this limitation.\n\n  this option sets the default source for all servers in the backend. it may\n  also be specified in a \"defaults\" section. finer source address specification\n  is possible at the server level using the \"source\" server option. refer to\n  section 5 for more information.\n\n  in order to work, \"usesrc\" requires root privileges.\n\n  examples :\n        backend private\n            # connect to the servers using our 192.168.1.200 source address\n            source 192.168.1.200\n\n        backend transparent_ssl1\n            # connect to the ssl farm from the client's source address\n            source 192.168.1.200 usesrc clientip\n\n        backend transparent_ssl2\n            # connect to the ssl farm from the client's source address and port\n            # not recommended if ip conntrack is present on the local machine.\n            source 192.168.1.200 usesrc client\n\n        backend transparent_ssl3\n            # connect to the ssl farm from the client's source address. it\n            # is more conntrack-friendly.\n            source 192.168.1.200 usesrc clientip\n\n        backend transparent_smtp\n            # connect to the smtp farm from the client's source address/port\n            # with tproxy version 4.\n            source 0.0.0.0 usesrc clientip\n\n        backend transparent_http\n            # connect to the servers using the client's ip as seen by previous\n            # proxy.\n            source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)\n\n  see also : the \"source\" server option in section 5, the tproxy patches for\n             the linux kernel on www.balabit.com, the \"bind\" keyword.\n\nsrvtimeout <timeout> (deprecated)\n  set the maximum inactivity time on the server side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase of the server's response, when it has to send the\n  headers, as it directly represents the server's processing time for the\n  request. to find out what value to put there, it's often good to start with\n  what would be considered as unacceptable response times, then check the logs\n  to observe the response time distribution, and adjust the value accordingly.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. in tcp mode (and to a lesser extent, in http mode), it is highly\n  recommended that the client timeout remains equal to the server timeout in\n  order to avoid complex situations to debug. whatever the expected server\n  response times, it is a good practice to cover at least one or several tcp\n  packet losses by specifying timeouts that are slightly above multiples of 3\n  seconds (eg: 4 or 5 seconds minimum).\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for compatibility but is currently deprecated.\n  please use \"timeout server\" instead.\n\n  see also : \"timeout server\", \"timeout tunnel\", \"timeout client\" and\n             \"clitimeout\".\n\nstats admin { if | unless } <cond>\n  enable statistics admin level if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  this statement enables the statistics admin level if/unless a condition is\n  matched.\n\n  the admin level allows to enable/disable servers from the web interface. by\n  default, statistics page is read-only for security reasons.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  currently, the post request is limited to the buffer size minus the reserved\n  buffer space, which means that if the list of servers is too long, the\n  request won't be processed. it is recommended to alter few servers at a\n  time.\n\n  example :\n    # statistics admin level only for localhost\n    backend stats_localhost\n        stats enable\n        stats admin if localhost\n\n  example :\n    # statistics admin level always enabled because of the authentication\n    backend stats_auth\n        stats enable\n        stats auth  admin:admin123\n        stats admin if true\n\n  example :\n    # statistics admin level depends on the authenticated user\n    userlist stats-auth\n        group admin    users admin\n        user  admin    insecure-password admin123\n        group readonly users haproxy\n        user  haproxy  insecure-password haproxy\n\n    backend stats_auth\n        stats enable\n        acl auth       http_auth(stats-auth)\n        acl auth_admin http_auth_group(stats-auth) admin\n        stats http-request auth unless auth\n        stats admin if auth_admin\n\n  see also : \"stats enable\", \"stats auth\", \"stats http-request\", \"nbproc\",\n             \"bind-process\", section 3.4 about userlists and section 7 about\n             acl usage.\n\nstats auth <user>:<passwd>\n  enable statistics with authentication and grant access to an account\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <user>    is a user name to grant access to\n\n    <passwd>  is the cleartext password associated to this user\n\n  this statement enables statistics with default settings, and restricts access\n  to declared users only. it may be repeated as many times as necessary to\n  allow as many users as desired. when a user tries to access the statistics\n  without a valid account, a \"401 forbidden\" response will be returned so that\n  the browser asks the user to provide a valid user and password. the real\n  which will be returned to the browser is configurable using \"stats realm\".\n\n  since the authentication method is http basic authentication, the passwords\n  circulate in cleartext on the network. thus, it was decided that the\n  configuration file would also use cleartext passwords to remind the users\n  that those ones should not be sensitive and not shared with any other account.\n\n  it is also possible to reduce the scope of the proxies which appear in the\n  report using \"stats scope\".\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats enable\", \"stats realm\", \"stats scope\", \"stats uri\"\n\nstats enable\n  enable statistics reporting with default settings\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  this statement enables statistics reporting with default settings defined\n  at build time. unless stated otherwise, these settings are used :\n    - stats uri   : /haproxy?stats\n    - stats realm : \"haproxy statistics\"\n    - stats auth  : no authentication\n    - stats scope : no restriction\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats realm\", \"stats uri\"\n\nstats hide-version\n  enable statistics and hide haproxy version reporting\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default, the stats page reports some useful status information along with\n  the statistics. among them is haproxy's version. however, it is generally\n  considered dangerous to report precise version to anyone, as it can help them\n  target known weaknesses with specific attacks. the \"stats hide-version\"\n  statement removes the version from the statistics report. this is recommended\n  for public sites or any site with a weak login/password.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats http-request { allow | deny | auth [realm <realm>] }\n             [ { if | unless } <condition> ]\n  access control for statistics\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    no    |   yes  |   yes\n\n  as \"http-request\", these set of options allow to fine control access to\n  statistics. each option may be followed by if/unless and acl.\n  first option with matched condition (or option without condition) is final.\n  for \"deny\" a 403 error will be returned, for \"allow\" normal processing is\n  performed, for \"auth\" a 401/407 error code is returned so the client\n  should be asked to enter a username and password.\n\n  there is no fixed limit to the number of http-request statements per\n  instance.\n\n  see also : \"http-request\", section 3.4 about userlists and section 7\n             about acl usage.\n\nstats realm <realm>\n  enable statistics and set authentication realm\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <realm>   is the name of the http basic authentication realm reported to\n              the browser. the browser uses it to display it in the pop-up\n              inviting the user to enter a valid username and password.\n\n  the realm is read as a single word, so any spaces in it should be escaped\n  using a backslash ('\\').\n\n  this statement is useful only in conjunction with \"stats auth\" since it is\n  only related to authentication.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats uri\"\n\nstats refresh <delay>\n  enable statistics with automatic refresh\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <delay>   is the suggested refresh delay, specified in seconds, which will\n              be returned to the browser consulting the report page. while the\n              browser is free to apply any delay, it will generally respect it\n              and refresh the page this every seconds. the refresh interval may\n              be specified in any other non-default time unit, by suffixing the\n              unit after the value, as explained at the top of this document.\n\n  this statement is useful on monitoring displays with a permanent page\n  reporting the load balancer's activity. when set, the html report page will\n  include a link \"refresh\"/\"stop refresh\" so that the user can select whether\n  he wants automatic refresh of the page or not.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats scope { <name> | \".\" }\n  enable statistics and limit access scope\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <name>    is the name of a listen, frontend or backend section to be\n              reported. the special name \".\" (a single dot) designates the\n              section in which the statement appears.\n\n  when this statement is specified, only the sections enumerated with this\n  statement will appear in the report. all other ones will be hidden. this\n  statement may appear as many times as needed if multiple sections need to be\n  reported. please note that the name checking is performed as simple string\n  comparisons, and that it is never checked that a give section name really\n  exists.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats show-desc [ <desc> ]\n  enable reporting of a description on the statistics page.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n    <desc>    is an optional description to be reported. if unspecified, the\n              description from global section is automatically used instead.\n\n  this statement is useful for users that offer shared services to their\n  customers, where node or description should be different for each customer.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.  by default description is not shown.\n\n  example :\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats show-desc master node for europe, asia, africa\n        stats uri       /admin?stats\n        stats refresh   5s\n\n  see also: \"show-node\", \"stats enable\", \"stats uri\" and \"description\" in\n            global section.\n\nstats show-legends\n  enable reporting additional information on the statistics page\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  enable reporting additional information on the statistics page :\n    - cap: capabilities (proxy)\n    - mode: one of tcp, http or health (proxy)\n    - id: snmp id (proxy, socket, server)\n    - ip (socket, server)\n    - cookie (backend, server)\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.  default behaviour is not to show this information.\n\n  see also: \"stats enable\", \"stats uri\".\n\nstats show-node [ <name> ]\n  enable reporting of a host name on the statistics page.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments:\n    <name>    is an optional name to be reported. if unspecified, the\n              node name from global section is automatically used instead.\n\n  this statement is useful for users that offer shared services to their\n  customers, where node or description might be different on a stats page\n  provided for each customer.  default behaviour is not to show host name.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example:\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats show-node europe-1\n        stats uri       /admin?stats\n        stats refresh   5s\n\n  see also: \"show-desc\", \"stats enable\", \"stats uri\", and \"node\" in global\n            section.\n\nstats uri <prefix>\n  enable statistics and define the uri prefix to access them\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <prefix>  is the prefix of any uri which will be redirected to stats. this\n              prefix may contain a question mark ('?') to indicate part of a\n              query string.\n\n  the statistics uri is intercepted on the relayed traffic, so it appears as a\n  page within the normal application. it is strongly advised to ensure that the\n  selected uri will never appear in the application, otherwise it will never be\n  possible to reach it in the application.\n\n  the default uri compiled in haproxy is \"/haproxy?stats\", but this may be\n  changed at build time, so it's better to always explicitly specify it here.\n  it is generally a good idea to include a question mark in the uri so that\n  intermediate proxies refrain from caching the results. also, since any string\n  beginning with the prefix will be accepted as a stats request, the question\n  mark helps ensuring that no valid uri will begin with the same words.\n\n  it is sometimes very convenient to use \"/\" as the uri prefix, and put that\n  statement in a \"listen\" instance of its own. that makes it easy to dedicate\n  an address or a port to statistics only.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\"\n\nstick match <pattern> [table <table>] [{if | unless} <cond>]\n  define a request pattern matching condition to stick a user to a server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the incoming request or connection\n               will be analysed in the hope to find a matching entry in a\n               stickiness table. this rule is mandatory.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional matching condition. it makes it possible to match\n               on a certain criterion only when other conditions are met (or\n               not met). for instance, it could be used to match on a source ip\n               address except when a request passes through a known proxy, in\n               which case we'd match on a header containing that ip address.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick match\" statement\n  describes a rule to extract the stickiness criterion from an incoming request\n  or connection. see section 7 for a complete list of possible patterns and\n  transformation rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick match\" statement\n  will apply, using \"if\" or \"unless\" followed by a condition. see section 7 for\n  acl based conditions.\n\n  there is no limit on the number of \"stick match\" statements. the first that\n  applies and matches will cause the request to be directed to the same server\n  as was used for the request which created the entry. that way, multiple\n  matches can be used as fallbacks.\n\n  the stick rules are checked after the persistence cookies, so they will not\n  affect stickiness if a cookie has already been used to select a server. that\n  way, it becomes very easy to insert cookies and match on ip addresses in\n  order to maintain stickiness between http and https.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n    # forward smtp users to the same server they just used for pop in the\n    # last 30 minutes\n    backend pop\n        mode tcp\n        balance roundrobin\n        stick store-request src\n        stick-table type ip size 200k expire 30m\n        server s1 192.168.1.1:110\n        server s2 192.168.1.1:110\n\n    backend smtp\n        mode tcp\n        balance roundrobin\n        stick match src table pop\n        server s1 192.168.1.1:25\n        server s2 192.168.1.1:25\n\n  see also : \"stick-table\", \"stick on\", \"nbproc\", \"bind-process\" and section 7\n             about acls and samples fetching.\n\nstick on <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern to associate a user to a server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  note : this form is exactly equivalent to \"stick match\" followed by\n         \"stick store-request\", all with the same arguments. please refer\n         to both keywords for details. it is only provided as a convenience\n         for writing more maintainable configurations.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  examples :\n    # the following form ...\n    stick on src table pop if !localhost\n\n    # ...is strictly equivalent to this one :\n    stick match src table pop if !localhost\n    stick store-request src table pop if !localhost\n\n    # use cookie persistence for http, and stick on source address for https as\n    # well as http without cookie. share the same table between both accesses.\n    backend http\n        mode http\n        balance roundrobin\n        stick on src table https\n        cookie srv insert indirect nocache\n        server s1 192.168.1.1:80 cookie s1\n        server s2 192.168.1.1:80 cookie s2\n\n    backend https\n        mode tcp\n        balance roundrobin\n        stick-table type ip size 200k expire 30m\n        stick on src\n        server s1 192.168.1.1:443\n        server s2 192.168.1.1:443\n\n  see also : \"stick match\", \"stick store-request\", \"nbproc\" and \"bind-process\".\n\nstick store-request <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern used to create an entry in a stickiness table\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the incoming request or connection\n               will be analysed, extracted and stored in the table once a\n               server is selected.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional storage condition. it makes it possible to store\n               certain criteria only when some conditions are met (or not met).\n               for instance, it could be used to store the source ip address\n               except when the request passes through a known proxy, in which\n               case we'd store a converted form of a header containing that ip\n               address.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick store-request\" statement\n  describes a rule to decide what to extract from the request and when to do\n  it, in order to store it into a stickiness table for further requests to\n  match it using the \"stick match\" statement. obviously the extracted part must\n  make sense and have a chance to be matched in a further request. storing a\n  client's ip address for instance often makes sense. storing an id found in a\n  url parameter also makes sense. storing a source port will almost never make\n  any sense because it will be randomly matched. see section 7 for a complete\n  list of possible patterns and transformation rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick store-request\"\n  statement will apply, using \"if\" or \"unless\" followed by a condition. this\n  condition will be evaluated while parsing the request, so any criteria can be\n  used. see section 7 for acl based conditions.\n\n  there is no limit on the number of \"stick store-request\" statements, but\n  there is a limit of 8 simultaneous stores per request or response. this\n  makes it possible to store up to 8 criteria, all extracted from either the\n  request or the response, regardless of the number of rules. only the 8 first\n  ones which match will be kept. using this, it is possible to feed multiple\n  tables at once in the hope to increase the chance to recognize a user on\n  another protocol or access method. using multiple store-request rules with\n  the same table is possible and may be used to find the best criterion to rely\n  on, by arranging the rules by decreasing preference order. only the first\n  extracted criterion for a given table will be stored. all subsequent store-\n  request rules referencing the same table will be skipped and their acls will\n  not be evaluated.\n\n  the \"store-request\" rules are evaluated once the server connection has been\n  established, so that the table will contain the real server that processed\n  the request.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n    # forward smtp users to the same server they just used for pop in the\n    # last 30 minutes\n    backend pop\n        mode tcp\n        balance roundrobin\n        stick store-request src\n        stick-table type ip size 200k expire 30m\n        server s1 192.168.1.1:110\n        server s2 192.168.1.1:110\n\n    backend smtp\n        mode tcp\n        balance roundrobin\n        stick match src table pop\n        server s1 192.168.1.1:25\n        server s2 192.168.1.1:25\n\n  see also : \"stick-table\", \"stick on\", \"nbproc\", \"bind-process\" and section 7\n             about acls and sample fetching.\n\nstick-table type {ip | integer | string [len <length>] | binary [len <length>]}\n            size <size> [expire <expire>] [nopurge] [peers <peersect>]\n            [store <data_type>]*\n  configure the stickiness table for the current section\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  arguments :\n    ip         a table declared with \"type ip\" will only store ipv4 addresses.\n               this form is very compact (about 50 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. this\n               is mainly used to store client source ip addresses.\n\n    ipv6       a table declared with \"type ipv6\" will only store ipv6 addresses.\n               this form is very compact (about 60 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. this\n               is mainly used to store client source ip addresses.\n\n    integer    a table declared with \"type integer\" will store 32bit integers\n               which can represent a client identifier found in a request for\n               instance.\n\n    string     a table declared with \"type string\" will store substrings of up\n               to <len> characters. if the string provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. during matching, at most <len> characters will be\n               compared between the string in the table and the extracted\n               pattern. when not specified, the string is automatically limited\n               to 32 characters.\n\n    binary     a table declared with \"type binary\" will store binary blocks\n               of <len> bytes. if the block provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. if the block provided by the sample expression\n               is shorter than <len>, it will be padded by 0\\. when not\n               specified, the block is automatically limited to 32 bytes.\n\n    <length>   is the maximum number of characters that will be stored in a\n               \"string\" type table (see type \"string\" above). or the number\n               of bytes of the block in \"binary\" type table. be careful when\n               changing this parameter as memory usage will proportionally\n               increase.\n\n    <size>     is the maximum number of entries that can fit in the table. this\n               value directly impacts memory usage. count approximately\n               50 bytes per entry, plus the size of a string if any. the size\n               supports suffixes \"k\", \"m\", \"g\" for 2^10, 2^20 and 2^30 factors.\n\n    [nopurge]  indicates that we refuse to purge older entries when the table\n               is full. when not specified and the table is full when haproxy\n               wants to store an entry in it, it will flush a few of the oldest\n               entries in order to release some space for the new ones. this is\n               most often the desired behaviour. in some specific cases, it\n               be desirable to refuse new entries instead of purging the older\n               ones. that may be the case when the amount of data to store is\n               far above the hardware limits and we prefer not to offer access\n               to new clients than to reject the ones already connected. when\n               using this parameter, be sure to properly set the \"expire\"\n               parameter (see below).\n\n    <peersect> is the name of the peers section to use for replication. entries\n               which associate keys to server ids are kept synchronized with\n               the remote peers declared in this section. all entries are also\n               automatically learned from the local peer (old process) during a\n               soft restart.\n\n               note : each peers section may be referenced only by tables\n                      belonging to the same unique process.\n\n    <expire>   defines the maximum duration of an entry in the table since it\n               was last created, refreshed or matched. the expiration delay is\n               defined using the standard time format, similarly as the various\n               timeouts. the maximum duration is slightly above 24 days. see\n               section 2.2 for more information. if this delay is not specified,\n               the session won't automatically expire, but older entries will\n               be removed once full. be sure not to use the \"nopurge\" parameter\n               if not expiration delay is specified.\n\n   <data_type> is used to store additional information in the stick-table. this\n               may be used by acls in order to control various criteria related\n               to the activity of the client matching the stick-table. for each\n               item specified here, the size of each entry will be inflated so\n               that the additional data can fit. several data types may be\n               stored with an entry. multiple data types may be specified after\n               the \"store\" keyword, as a comma-separated list. alternatively,\n               it is possible to repeat the \"store\" keyword followed by one or\n               several data types. except for the \"server_id\" type which is\n               automatically detected and enabled, all data types must be\n               explicitly declared to be stored. if an acl references a data\n               type which is not stored, the acl will simply not match. some\n               data types require an argument which must be passed just after\n               the type between parenthesis. see below for the supported data\n               types and their arguments.\n\n  the data types that can be stored with an entry are the following :\n    - server_id : this is an integer which holds the numeric id of the server a\n      request was assigned to. it is used by the \"stick match\", \"stick store\",\n      and \"stick on\" rules. it is automatically enabled when referenced.\n\n    - gpc0 : first general purpose counter. it is a positive 32-bit integer\n      integer which may be used for anything. most of the time it will be used\n      to put a special tag on some entries, for instance to note that a\n      specific behaviour was detected and must be known for future matches.\n\n    - gpc0_rate(<period>) : increment rate of the first general purpose counter\n      over a period. it is a positive 32-bit integer integer which may be used\n      for anything. just like <gpc0>, it counts events, but instead of keeping\n      a cumulative count, it maintains the rate at which the counter is\n      incremented. most of the time it will be used to measure the frequency of\n      occurrence of certain events (eg: requests to a specific url).\n\n    - conn_cnt : connection count. it is a positive 32-bit integer which counts\n      the absolute number of connections received from clients which matched\n      this entry. it does not mean the connections were accepted, just that\n      they were received.\n\n    - conn_cur : current connections. it is a positive 32-bit integer which\n      stores the concurrent connection counts for the entry. it is incremented\n      once an incoming connection matches the entry, and decremented once the\n      connection leaves. that way it is possible to know at any time the exact\n      number of concurrent connections for an entry.\n\n    - conn_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming connection rate over that period, in connections per period. the\n      result is an integer which can be matched using acls.\n\n    - sess_cnt : session count. it is a positive 32-bit integer which counts\n      the absolute number of sessions received from clients which matched this\n      entry. a session is a connection that was accepted by the layer 4 rules.\n\n    - sess_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming session rate over that period, in sessions per period. the\n      result is an integer which can be matched using acls.\n\n    - http_req_cnt : http request count. it is a positive 32-bit integer which\n      counts the absolute number of http requests received from clients which\n      matched this entry. it does not matter whether they are valid requests or\n      not. note that this is different from sessions when keep-alive is used on\n      the client side.\n\n    - http_req_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      http request rate over that period, in requests per period. the result is\n      an integer which can be matched using acls. it does not matter whether\n      they are valid requests or not. note that this is different from sessions\n      when keep-alive is used on the client side.\n\n    - http_err_cnt : http error count. it is a positive 32-bit integer which\n      counts the absolute number of http requests errors induced by clients\n      which matched this entry. errors are counted on invalid and truncated\n      requests, as well as on denied or tarpitted requests, and on failed\n      authentications. if the server responds with 4xx, then the request is\n      also counted as an error since it's an error triggered by the client\n      (eg: vulnerability scan).\n\n    - http_err_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      http request error rate over that period, in requests per period (see\n      http_err_cnt above for what is accounted as an error). the result is an\n      integer which can be matched using acls.\n\n    - bytes_in_cnt : client to server byte count. it is a positive 64-bit\n      integer which counts the cumulated amount of bytes received from clients\n      which matched this entry. headers are included in the count. this may be\n      used to limit abuse of upload features on photo or video servers.\n\n    - bytes_in_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming bytes rate over that period, in bytes per period. it may be used\n      to detect users which upload too much and too fast. warning: with large\n      uploads, it is possible that the amount of uploaded data will be counted\n      once upon termination, thus causing spikes in the average transfer speed\n      instead of having a smooth one. this may partially be smoothed with\n      \"option contstats\" though this is not perfect yet. use of byte_in_cnt is\n      recommended for better fairness.\n\n    - bytes_out_cnt : server to client byte count. it is a positive 64-bit\n      integer which counts the cumulated amount of bytes sent to clients which\n      matched this entry. headers are included in the count. this may be used\n      to limit abuse of bots sucking the whole site.\n\n    - bytes_out_rate(<period>) : frequency counter (takes 12 bytes). it takes\n      an integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      outgoing bytes rate over that period, in bytes per period. it may be used\n      to detect users which download too much and too fast. warning: with large\n      transfers, it is possible that the amount of transferred data will be\n      counted once upon termination, thus causing spikes in the average\n      transfer speed instead of having a smooth one. this may partially be\n      smoothed with \"option contstats\" though this is not perfect yet. use of\n      byte_out_cnt is recommended for better fairness.\n\n  there is only one stick-table per proxy. at the moment of writing this doc,\n  it does not seem useful to have multiple tables per proxy. if this happens\n  to be required, simply create a dummy backend with a stick-table in it and\n  reference it.\n\n  it is important to understand that stickiness based on learning information\n  has some limitations, including the fact that all learned associations are\n  lost upon restart. in general it can be good as a complement but not always\n  as an exclusive stickiness.\n\n  last, memory requirements may be important when storing many data types.\n  indeed, storing all indicators above at once in each entry requires 116 bytes\n  per entry, or 116 mb for a 1-million entries table. this is definitely not\n  something that can be ignored.\n\n  example:\n        # keep track of counters of up to 1 million ip addresses over 5 minutes\n        # and store a general purpose counter and the average connection rate\n        # computed over a sliding window of 30 seconds.\n        stick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)\n\n  see also : \"stick match\", \"stick on\", \"stick store-request\", section 2.2\n             about time format and section 7 about acls.\n\nstick store-response <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern used to create an entry in a stickiness table\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the response or connection will\n               be analysed, extracted and stored in the table once a\n               server is selected.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional storage condition. it makes it possible to store\n               certain criteria only when some conditions are met (or not met).\n               for instance, it could be used to store the ssl session id only\n               when the response is a ssl server hello.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick store-response\"\n  statement  describes a rule to decide what to extract from the response and\n  when to do it, in order to store it into a stickiness table for further\n  requests to match it using the \"stick match\" statement. obviously the\n  extracted part must make sense and have a chance to be matched in a further\n  request. storing an id found in a header of a response makes sense.\n  see section 7 for a complete list of possible patterns and transformation\n  rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick store-response\"\n  statement will apply, using \"if\" or \"unless\" followed by a condition. this\n  condition will be evaluated while parsing the response, so any criteria can\n  be used. see section 7 for acl based conditions.\n\n  there is no limit on the number of \"stick store-response\" statements, but\n  there is a limit of 8 simultaneous stores per request or response. this\n  makes it possible to store up to 8 criteria, all extracted from either the\n  request or the response, regardless of the number of rules. only the 8 first\n  ones which match will be kept. using this, it is possible to feed multiple\n  tables at once in the hope to increase the chance to recognize a user on\n  another protocol or access method. using multiple store-response rules with\n  the same table is possible and may be used to find the best criterion to rely\n  on, by arranging the rules by decreasing preference order. only the first\n  extracted criterion for a given table will be stored. all subsequent store-\n  response rules referencing the same table will be skipped and their acls will\n  not be evaluated. however, even if a store-request rule references a table, a\n  store-response rule may also use the same table. this means that each table\n  may learn exactly one element from the request and one element from the\n  response at once.\n\n  the table will contain the real server that processed the request.\n\n  example :\n    # learn ssl session id from both request and response and create affinity.\n    backend https\n        mode tcp\n        balance roundrobin\n        # maximum ssl session id length is 32 bytes.\n        stick-table type binary len 32 size 30k expire 30m\n\n        acl clienthello req_ssl_hello_type 1\n        acl serverhello rep_ssl_hello_type 2\n\n        # use tcp content accepts to detects ssl client and server hello.\n        tcp-request inspect-delay 5s\n        tcp-request content accept if clienthello\n\n        # no timeout on response inspect delay by default.\n        tcp-response content accept if serverhello\n\n        # ssl session id (sslid) may be present on a client or server hello.\n        # its length is coded on 1 byte at offset 43 and its value starts\n        # at offset 44.\n\n        # match and learn on request if client hello.\n        stick on payload_lv(43,1) if clienthello\n\n        # learn on response if server hello.\n        stick store-response payload_lv(43,1) if serverhello\n\n        server s1 192.168.1.1:443\n        server s2 192.168.1.1:443\n\n  see also : \"stick-table\", \"stick on\", and section 7 about acls and pattern\n             extraction.\n\ntcp-check connect [params*]\n  opens a new connection\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n  when an application lies on more than a single tcp port or when haproxy\n  load-balance many services in a single backend, it makes sense to probe all\n  the services individually before considering a server as operational.\n\n  when there are no tcp port configured on the server line neither server port\n  directive, then the 'tcp-check connect port <port>' must be the first step\n  of the sequence.\n\n  in a tcp-check ruleset a 'connect' is required, it is also mandatory to start\n  the ruleset with a 'connect' rule. purpose is to ensure admin know what they\n  do.\n\n  parameters :\n    they are optional and can be used to describe how haproxy should open and\n    use the tcp connection.\n\n    port      if not set, check port or server port is used.\n              it tells haproxy where to open the connection to.\n              <port> must be a valid tcp port source integer, from 1 to 65535.\n\n    send-proxy   send a proxy protocol string\n\n    ssl          opens a ciphered connection\n\n    examples:\n         # check http and https services on a server.\n         # first open port 80 thanks to server line port directive, then\n         # tcp-check opens port 443, ciphered and run a request on it:\n         option tcp-check\n         tcp-check connect\n         tcp-check send get\\ /\\ http/1.0\\r\\n\n         tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring (2..|3..)\n         tcp-check connect port 443 ssl\n         tcp-check send get\\ /\\ http/1.0\\r\\n\n         tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring (2..|3..)\n         server www 10.0.0.1 check port 80\n\n         # check both pop and imap from a single server:\n         option tcp-check\n         tcp-check connect port 110\n         tcp-check expect string +ok\\ pop3\\ ready\n         tcp-check connect port 143\n         tcp-check expect string *\\ ok\\ imap4\\ ready\n         server mail 10.0.0.1 check\n\n  see also : \"option tcp-check\", \"tcp-check send\", \"tcp-check expect\"\n\ntcp-check expect [!] <match> <pattern>\n  specify data to be collected and analysed during a generic health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n  arguments :\n    <match>   is a keyword indicating how to look for a specific pattern in the\n              response. the keyword may be one of \"string\", \"rstring\" or\n              binary.\n              the keyword may be preceded by an exclamation mark (\"!\") to negate\n              the match. spaces are allowed between the exclamation mark and the\n              keyword. see below for more details on the supported keywords.\n\n    <pattern> is the pattern to look for. it may be a string or a regular\n              expression. if the pattern contains spaces, they must be escaped\n              with the usual backslash ('\\').\n              if the match is set to binary, then the pattern must be passed as\n              a serie of hexadecimal digits in an even number. each sequence of\n              two digits will represent a byte. the hexadecimal digits may be\n              used upper or lower case.\n\n  the available matches are intentionally similar to their http-check cousins :\n\n    string <string> : test the exact string matches in the response buffer.\n                      a health check response will be considered valid if the\n                      response's buffer contains this exact string. if the\n                      \"string\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body contains this\n                      string. this can be used to look for a mandatory pattern\n                      in a protocol response, or to detect a failure when a\n                      specific error appears in a protocol banner.\n\n    rstring <regex> : test a regular expression on the response buffer.\n                      a health check response will be considered valid if the\n                      response's buffer matches this expression. if the\n                      \"rstring\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body matches the\n                      expression.\n\n    binary <hexstring> : test the exact string in its hexadecimal form matches\n                         in the response buffer. a health check response will\n                         be considered valid if the response's buffer contains\n                         this exact hexadecimal string.\n                         purpose is to match data on binary protocols.\n\n  it is important to note that the responses will be limited to a certain size\n  defined by the global \"tune.chksize\" option, which defaults to 16384 bytes.\n  thus, too large responses may not contain the mandatory pattern when using\n  \"string\", \"rstring\" or binary. if a large response is absolutely required, it\n  is possible to change the default max size by setting the global variable.\n  however, it is worth keeping in mind that parsing very large responses can\n  waste some cpu cycles, especially when regular expressions are used, and that\n  it is always better to focus the checks on smaller resources. also, in its\n  current state, the check will not find any string nor regex past a null\n  character in the response. similarly it is not possible to request matching\n  the null character.\n\n  examples :\n         # perform a pop check\n         option tcp-check\n         tcp-check expect string +ok\\ pop3\\ ready\n\n         # perform an imap check\n         option tcp-check\n         tcp-check expect string *\\ ok\\ imap4\\ ready\n\n         # look for the redis master server\n         option tcp-check\n         tcp-check send ping\\r\\n\n         tcp-check expect +pong\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n         tcp-check send quit\\r\\n\n         tcp-check expect string +ok\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check send\",\n             \"tcp-check send-binary\", \"http-check expect\", tune.chksize\n\ntcp-check send <data>\n  specify a string to be sent as a question during a generic health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n    <data> : the data to be sent as a question during a generic health check\n             session. for now, <data> must be a string.\n\n  examples :\n         # look for the redis master server\n         option tcp-check\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check expect\",\n             \"tcp-check send-binary\", tune.chksize\n\ntcp-check send-binary <hexastring>\n  specify an hexa digits string to be sent as a binary question during a raw\n  tcp health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n    <data> : the data to be sent as a question during a generic health check\n             session. for now, <data> must be a string.\n    <hexastring> : test the exact string in its hexadecimal form matches in the\n                   response buffer. a health check response will be considered\n                   valid if the response's buffer contains this exact\n                   hexadecimal string.\n                   purpose is to send binary data to ask on binary protocols.\n\n  examples :\n         # redis check in binary\n         option tcp-check\n         tcp-check send-binary 50494e470d0a # ping\\r\\n\n         tcp-check expect binary 2b504f4e47 # +pong\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check expect\",\n             \"tcp-check send\", tune.chksize\n\ntcp-request connection <action> [{if | unless} <condition>]\n  perform an action on an incoming connection depending on a layer 4 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"reject\", \"track-sc0\", \"track-sc1\",\n                \"track-sc2\", and \"expect-proxy\". see below for more details.\n\n    <condition> is a standard layer4-only acl-based condition (see section 7).\n\n  immediately after acceptance of a new incoming connection, it is possible to\n  evaluate some conditions to decide whether this connection must be accepted\n  or dropped or have its counters tracked. those conditions cannot make use of\n  any data contents because the connection has not been read from yet, and the\n  buffers are not yet allocated. this is used to selectively and very quickly\n  accept or drop connections from various sources with a very low overhead. if\n  some contents need to be inspected in order to take the decision, the\n  \"tcp-request content\" statements must be used instead.\n\n  the \"tcp-request connection\" rules are evaluated in their exact declaration\n  order. if no rule matches or if there is no rule, the default action is to\n  accept the incoming connection. there is no specific limit to the number of\n  rules which may be inserted.\n\n  four types of actions are supported :\n    - accept :\n        accepts the connection if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation.\n\n    - reject :\n        rejects the connection if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation. rejected connections do not even become a\n        session, which is why they are accounted separately for in the stats,\n        as \"denied connections\". they are not considered for the session\n        rate-limit and are not logged either. the reason is that these rules\n        should only be used to filter extremely high connection rates such as\n        the ones encountered during a massive ddos attack. under these extreme\n        conditions, the simple action of logging each event would make the\n        system collapse and would considerably lower the filtering capacity. if\n        logging is absolutely desired, then \"tcp-request content\" rules should\n        be used instead.\n\n    - expect-proxy layer4 :\n        configures the client-facing connection to receive a proxy protocol\n        header before any byte is read from the socket. this is equivalent to\n        having the \"accept-proxy\" keyword on the \"bind\" line, except that using\n        the tcp rule allows the proxy protocol to be accepted only for certain\n        ip address ranges using an acl. this is convenient when multiple layers\n        of load balancers are passed through by traffic coming from public\n        hosts.\n\n    - capture <sample> len <length> :\n        this only applies to \"tcp-request content\" rules. it captures sample\n        expression <sample> from the request buffer, and converts it to a\n        string of at most <len> characters. the resulting string is stored into\n        the next request \"capture\" slot, so it will possibly appear next to\n        some captured http headers. it will then automatically appear in the\n        logs, and it will be possible to extract it using sample fetch rules to\n        feed it into headers or anything. the length should be limited given\n        that this size will be allocated for each capture during the whole\n        session life. please check section 7.3 (fetching samples) and \"capture\n        request header\" for more information.\n\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] :\n        enables tracking of sticky counters from current connection. these\n        rules do not stop evaluation and do not change default action. 3 sets\n        of counters may be simultaneously tracked by the same connection. the\n        first \"track-sc0\" rule executed enables tracking of the counters of the\n        specified table as the first set. the first \"track-sc1\" rule executed\n        enables tracking of the counters of the specified table as the second\n        set. the first \"track-sc2\" rule executed enables tracking of the\n        counters of the specified table as the third set. it is a recommended\n        practice to use the first set of counters for the per-frontend counters\n        and the second set for the per-backend ones. but this is just a\n        guideline, all may be used everywhere.\n\n        these actions take one or two arguments :\n          <key>   is mandatory, and is a sample expression rule as described\n                  in section 7.3\\. it describes what elements of the incoming\n                  request or connection will be analysed, extracted, combined,\n                  and used to select which table entry to update the counters.\n                  note that \"tcp-request connection\" cannot use content-based\n                  fetches.\n\n         <table>  is an optional table to be used instead of the default one,\n                  which is the stick-table declared in the current proxy. all\n                  the counters for the matches and updates for the key will\n                  then be performed in that table until the session ends.\n\n        once a \"track-sc*\" rule is executed, the key is looked up in the table\n        and if it is not found, an entry is allocated for it. then a pointer to\n        that entry is kept during all the session's life, and this entry's\n        counters are updated as often as possible, every time the session's\n        counters are updated, and also systematically when the session ends.\n        counters are only updated for events that happen after the tracking has\n        been started. for example, connection counters will not be updated when\n        tracking layer 7 information, since the connection event happens before\n        layer7 information is extracted.\n\n        if the entry tracks concurrent connection counters, one connection is\n        counted for as long as the entry is tracked, and the entry will not\n        expire during that time. tracking counters also provides a performance\n        advantage over just checking the keys, because only one table lookup is\n        performed for all acl checks that make use of it.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  \"track-sc*\" actions as well as for changing the default action to a reject.\n\n  example: accept all connections from white-listed hosts, reject too fast\n           connection without counting them, and track accepted connections.\n           this results in connection rate being capped from abusive sources.\n\n        tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\n        tcp-request connection reject if { src_conn_rate gt 10 }\n        tcp-request connection track-sc0 src\n\n  example: accept all connections from white-listed hosts, count all other\n           connections and reject too fast ones. this results in abusive ones\n           being blocked as long as they don't slow down.\n\n        tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\n        tcp-request connection track-sc0 src\n        tcp-request connection reject if { sc0_conn_rate gt 10 }\n\n  example: enable the proxy protocol for traffic coming from all known proxies.\n\n        tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request content\", \"stick-table\"\n\ntcp-request content <action> [{if | unless} <condition>]\n  perform an action on a new session depending on a layer 4-7 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"reject\", \"track-sc0\", \"track-sc1\",\n                \"track-sc2\", \"capture\" and \"lua\". see \"tcp-request connection\"\n                above for their signification.\n\n    <condition> is a standard layer 4-7 acl-based condition (see section 7).\n\n  a request's contents can be analysed at an early stage of request processing\n  called \"tcp content inspection\". during this stage, acl-based rules are\n  evaluated every time the request contents are updated, until either an\n  \"accept\" or a \"reject\" rule matches, or the tcp request inspection delay\n  expires with no matching rule.\n\n  the first difference between these rules and \"tcp-request connection\" rules\n  is that \"tcp-request content\" rules can make use of contents to take a\n  decision. most often, these decisions will consider a protocol recognition or\n  validity. the second difference is that content-based rules can be used in\n  both frontends and backends. in case of http keep-alive with the client, all\n  tcp-request content rules are evaluated again, so haproxy keeps a record of\n  what sticky counters were assigned by a \"tcp-request connection\" versus a\n  \"tcp-request content\" rule, and flushes all the content-related ones after\n  processing an http request, so that they may be evaluated again by the rules\n  being evaluated again for the next request. this is of particular importance\n  when the rule tracks some l7 information or when it is conditioned by an\n  l7-based acl, since tracking may change between requests.\n\n  content-based rules are evaluated in their exact declaration order. if no\n  rule matches or if there is no rule, the default action is to accept the\n  contents. there is no specific limit to the number of rules which may be\n  inserted.\n\n  four types of actions are supported :\n    - accept : the request is accepted\n    - reject : the request is rejected and the connection is closed\n    - capture : the specified sample expression is captured\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>]\n    - lua <function>\n    - set-var(<var-name>) <expr>\n\n  they have the same meaning as their counter-parts in \"tcp-request connection\"\n  so please refer to that section for a complete description.\n\n  while there is nothing mandatory about it, it is recommended to use the\n  track-sc0 in \"tcp-request connection\" rules, track-sc1 for \"tcp-request\n  content\" rules in the frontend, and track-sc2 for \"tcp-request content\"\n  rules in the backend, because that makes the configuration more readable\n  and easier to troubleshoot, but this is just a guideline and all counters\n  may be used everywhere.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  \"track-sc*\" actions as well as for changing the default action to a reject.\n\n  it is perfectly possible to match layer 7 contents with \"tcp-request content\"\n  rules, since http-specific acl matches are able to preliminarily parse the\n  contents of a buffer before extracting the required data. if the buffered\n  contents do not parse as a valid http message, then the acl does not match.\n  the parser which is involved there is exactly the same as for all other http\n  processing, so there is no risk of parsing something differently. in an http\n  backend connected to from an http frontend, it is guaranteed that http\n  contents will always be immediately present when the rule is evaluated first.\n\n  tracking layer7 information is also possible provided that the information\n  are present when the rule is processed. the rule processing engine is able to\n  wait until the inspect delay expires when the data to be tracked is not yet\n  available.\n\n  the \"lua\" keyword is followed by a lua function name. it is used to run a lua\n  function if the action is executed. the single parameter is the name of the\n  function to run. the prototype of the function is documented in the api\n  documentation.\n\n  the \"set-var\" is used to set the content of a variable. the variable is\n  declared inline.\n\n    <var-name> the name of the variable starts by an indication about its scope.\n               the allowed scopes are:\n                 \"sess\" : the variable is shared with all the session,\n                 \"txn\"  : the variable is shared with all the transaction\n                          (request and response)\n                 \"req\"  : the variable is shared only during the request\n                          processing\n                 \"res\"  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a '.'.\n               the name may only contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n    <expr>     is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n        tcp-request content set-var(sess.my_var) src\n\n  example:\n        # accept http requests containing a host header saying \"example.com\"\n        # and reject everything else.\n        acl is_host_com hdr(host) -i example.com\n        tcp-request inspect-delay 30s\n        tcp-request content accept if is_host_com\n        tcp-request content reject\n\n  example:\n        # reject smtp connection if client speaks first\n        tcp-request inspect-delay 30s\n        acl content_present req_len gt 0\n        tcp-request content reject if content_present\n\n        # forward https connection only if client speaks\n        tcp-request inspect-delay 30s\n        acl content_present req_len gt 0\n        tcp-request content accept if content_present\n        tcp-request content reject\n\n  example:\n        # track the last ip from x-forwarded-for\n        tcp-request inspect-delay 10s\n        tcp-request content track-sc0 hdr(x-forwarded-for,-1)\n\n  example:\n        # track request counts per \"base\" (concatenation of host+url)\n        tcp-request inspect-delay 10s\n        tcp-request content track-sc0 base table req-rate\n\n  example: track per-frontend and per-backend counters, block abusers at the\n           frontend when the backend detects abuse.\n\n        frontend http\n            # use general purpose couter 0 in sc0 as a global abuse counter\n            # protecting all our sites\n            stick-table type ip size 1m expire 5m store gpc0\n            tcp-request connection track-sc0 src\n            tcp-request connection reject if { sc0_get_gpc0 gt 0 }\n            ...\n            use_backend http_dynamic if { path_end .php }\n\n        backend http_dynamic\n            # if a source makes too fast requests to this dynamic site (tracked\n            # by sc1), block it globally in the frontend.\n            stick-table type ip size 1m expire 5m store http_req_rate(10s)\n            acl click_too_fast sc1_http_req_rate gt 10\n            acl mark_as_abuser sc0_inc_gpc0 gt 0\n            tcp-request content track-sc1 src\n            tcp-request content reject if click_too_fast mark_as_abuser\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request connection\", \"tcp-request inspect-delay\"\n\ntcp-request inspect-delay <timeout>\n  set the maximum allowed time to wait for data during content inspection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  people using haproxy primarily as a tcp relay are often worried about the\n  risk of passing any type of protocol to a server without any analysis. in\n  order to be able to analyze the request contents, we must first withhold\n  the data then analyze them. this statement simply enables withholding of\n  data for at most the specified amount of time.\n\n  tcp content inspection applies very early when a connection reaches a\n  frontend, then very early when the connection is forwarded to a backend. this\n  means that a connection may experience a first delay in the frontend and a\n  second delay in the backend if both have tcp-request rules.\n\n  note that when performing content inspection, haproxy will evaluate the whole\n  rules for every new chunk which gets in, taking into account the fact that\n  those data are partial. if no rule matches before the aforementioned delay,\n  a last check is performed upon expiration, this time considering that the\n  contents are definitive. if no delay is set, haproxy will not wait at all\n  and will immediately apply a verdict based on the available information.\n  obviously this is unlikely to be very useful and might even be racy, so such\n  setups are not recommended.\n\n  as soon as a rule matches, the request is released and continues as usual. if\n  the timeout is reached and no rule matches, the default policy will be to let\n  it pass through unaffected.\n\n  for most protocols, it is enough to set it to a few seconds, as most clients\n  send the full request immediately upon connection. add 3 or more seconds to\n  cover tcp retransmits but that's all. for some protocols, it may make sense\n  to use large values, for instance to ensure that the client never talks\n  before the server (eg: smtp), or to wait for a client to talk before passing\n  data to the server (eg: ssl). note that the client timeout must cover at\n  least the inspection delay, otherwise it will expire first. if the client\n  closes the connection or if the buffer is full, the delay immediately expires\n  since the contents will not be able to change anymore.\n\n  see also : \"tcp-request content accept\", \"tcp-request content reject\",\n             \"timeout client\".\n\ntcp-response content <action> [{if | unless} <condition>]\n  perform an action on a session response depending on a layer 4-7 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"close\", \"reject\", \"lua\".\n\n    <condition> is a standard layer 4-7 acl-based condition (see section 7).\n\n  response contents can be analysed at an early stage of response processing\n  called \"tcp content inspection\". during this stage, acl-based rules are\n  evaluated every time the response contents are updated, until either an\n  \"accept\", \"close\" or a \"reject\" rule matches, or a tcp response inspection\n  delay is set and expires with no matching rule.\n\n  most often, these decisions will consider a protocol recognition or validity.\n\n  content-based rules are evaluated in their exact declaration order. if no\n  rule matches or if there is no rule, the default action is to accept the\n  contents. there is no specific limit to the number of rules which may be\n  inserted.\n\n  two types of actions are supported :\n    - accept :\n        accepts the response if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation.\n\n    - close :\n        immediately closes the connection with the server if the condition is\n        true (when used with \"if\"), or false (when used with \"unless\"). the\n        first such rule executed ends the rules evaluation. the main purpose of\n        this action is to force a connection to be finished between a client\n        and a server after an exchange when the application protocol expects\n        some long time outs to elapse first. the goal is to eliminate idle\n        connections which take significant resources on servers with certain\n        protocols.\n\n    - reject :\n        rejects the response if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation. rejected session are immediately closed.\n\n    - lua <function>\n        executes lua.\n\n    - set-var(<var-name>) <expr>\n        sets a variable.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  for changing the default action to a reject.\n\n  it is perfectly possible to match layer 7 contents with \"tcp-response\n  content\" rules, but then it is important to ensure that a full response has\n  been buffered, otherwise no contents will match. in order to achieve this,\n  the best solution involves detecting the http protocol during the inspection\n  period.\n\n  the \"lua\" keyword is followed by a lua function name. it is used to run a lua\n  function if the action is executed. the single parameter is the name of the\n  function to run. the prototype of the function is documented in the api\n  documentation.\n\n  the \"set-var\" is used to set the content of a variable. the variable is\n  declared inline.\n\n    <var-name> the name of the variable starts by an indication about its scope.\n               the allowed scopes are:\n                 \"sess\" : the variable is shared with all the session,\n                 \"txn\"  : the variable is shared with all the transaction\n                          (request and response)\n                 \"req\"  : the variable is shared only during the request\n                          processing\n                 \"res\"  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a '.'.\n               the name may only contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n    <expr>     is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n        tcp-request content set-var(sess.my_var) src\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request content\", \"tcp-response inspect-delay\"\n\ntcp-response inspect-delay <timeout>\n  set the maximum allowed time to wait for a response during content inspection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  see also : \"tcp-response content\", \"tcp-request inspect-delay\".\n\ntimeout check <timeout>\n  set additional check timeout, but only after a connection has been already\n  established.\n\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments:\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if set, haproxy uses min(\"timeout connect\", \"inter\") as a connect timeout\n  for check and \"timeout check\" as an additional read timeout. the \"min\" is\n  used so that people running with *very* long \"timeout connect\" (eg. those\n  who needed this due to the queue or tarpit) do not slow down their checks.\n  (please also note that there is no valid reason to have such long connect\n  timeouts, because \"timeout queue\" and \"timeout tarpit\" can always be used to\n  avoid that).\n\n  if \"timeout check\" is not set haproxy uses \"inter\" for complete check\n  timeout (connect + read) exactly like all <1.3.15 version.\n\n  in most cases check request is much simpler and faster to handle than normal\n  requests and people may want to kick out laggy servers so this timeout should\n  be smaller than \"timeout server\".\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it.\n\n  see also: \"timeout connect\", \"timeout queue\", \"timeout server\",\n            \"timeout tarpit\".\n\ntimeout client <timeout>\ntimeout clitimeout <timeout> (deprecated)\n  set the maximum inactivity time on the client side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase, when the client sends the request, and during the\n  response while it is reading data sent by the server. the value is specified\n  in milliseconds by default, but can be in any other unit if the number is\n  suffixed by the unit, as specified at the top of this document. in tcp mode\n  (and to a lesser extent, in http mode), it is highly recommended that the\n  client timeout remains equal to the server timeout in order to avoid complex\n  situations to debug. it is a good practice to cover one or several tcp packet\n  losses by specifying timeouts that are slightly above multiples of 3 seconds\n  (eg: 4 or 5 seconds). if some long-lived sessions are mixed with short-lived\n  sessions (eg: websocket and http), it's worth considering \"timeout tunnel\",\n  which overrides \"timeout client\" and \"timeout server\" for tunnels, as well as\n  \"timeout client-fin\" for half-closed connections.\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"clitimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout clitimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also : \"clitimeout\", \"timeout server\", \"timeout tunnel\".\n\ntimeout client-fin <timeout>\n  set the inactivity timeout on the client side for half-closed connections.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data while one direction is already shut down. this timeout is different\n  from \"timeout client\" in that it only applies to connections which are closed\n  in one direction. this is particularly useful to avoid keeping connections in\n  fin_wait state for too long when clients do not disconnect cleanly. this\n  problem is particularly common long connections such as rdp or websocket.\n  note that this timeout can override \"timeout tunnel\" when a connection shuts\n  down in one direction.\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. by default it is not set, so half-closed connections\n  will use the other timeouts (timeout.client or timeout.tunnel).\n\n  see also : \"timeout client\", \"timeout server-fin\", and \"timeout tunnel\".\n\ntimeout connect <timeout>\ntimeout contimeout <timeout> (deprecated)\n  set the maximum time to wait for a connection attempt to a server to succeed.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if the server is located on the same lan as haproxy, the connection should be\n  immediate (less than a few milliseconds). anyway, it is a good practice to\n  cover one or several tcp packet losses by specifying timeouts that are\n  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the\n  connect timeout also presets both queue and tarpit timeouts to the same value\n  if these have not been specified.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of failed sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"contimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout contimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also: \"timeout check\", \"timeout queue\", \"timeout server\", \"contimeout\",\n            \"timeout tarpit\".\n\ntimeout http-keep-alive <timeout>\n  set the maximum allowed time to wait for a new http request to appear\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  by default, the time to wait for a new request in case of keep-alive is set\n  by \"timeout http-request\". however this is not always convenient because some\n  people want very short keep-alive timeouts in order to release connections\n  faster, and others prefer to have larger ones but still have short timeouts\n  once the request has started to present itself.\n\n  the \"http-keep-alive\" timeout covers these needs. it will define how long to\n  wait for a new http request to start coming after a response was sent. once\n  the first byte of request has been seen, the \"http-request\" timeout is used\n  to wait for the complete request to come. note that empty lines prior to a\n  new request do not refresh the timeout and are not counted as a new request.\n\n  there is also another difference between the two timeouts : when a connection\n  expires during timeout http-keep-alive, no error is returned, the connection\n  just closes. if the connection expires in \"http-request\" while waiting for a\n  connection to complete, a http 408 error is returned.\n\n  in general it is optimal to set this value to a few tens to hundreds of\n  milliseconds, to allow users to fetch all objects of a page at once but\n  without waiting for further clicks. also, if set to a very small value (eg:\n  1 millisecond) it will probably only accept pipelined requests but not the\n  non-pipelined ones. it may be a nice trade-off for very large sites running\n  with tens to hundreds of thousands of clients.\n\n  if this parameter is not set, the \"http-request\" timeout applies, and if both\n  are not set, \"timeout client\" still applies at the lower level. it should be\n  set in the frontend to take effect, unless the frontend is in tcp mode, in\n  which case the http backend's timeout will be used.\n\n  see also : \"timeout http-request\", \"timeout client\".\n\ntimeout http-request <timeout>\n  set the maximum allowed time to wait for a complete http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  in order to offer dos protection, it may be required to lower the maximum\n  accepted time to receive a complete http request without affecting the client\n  timeout. this helps protecting against established connections on which\n  nothing is sent. the client timeout cannot offer a good protection against\n  this abuse because it is an inactivity timeout, which means that if the\n  attacker sends one character every now and then, the timeout will not\n  trigger. with the http request timeout, no matter what speed the client\n  types, the request will be aborted if it does not complete in time. when the\n  timeout expires, an http 408 response is sent to the client to inform it\n  about the problem, and the connection is closed. the logs will report\n  termination codes \"cr\". some recent browsers are having problems with this\n  standard, well-documented behaviour, so it might be needed to hide the 408\n  code using \"option http-ignore-probes\" or \"errorfile 408 /dev/null\". see\n  more details in the explanations of the \"cr\" termination code in section 8.5.\n\n  note that this timeout only applies to the header part of the request, and\n  not to any data. as soon as the empty line is received, this timeout is not\n  used anymore. it is used again on keep-alive connections to wait for a second\n  request if \"timeout http-keep-alive\" is not set.\n\n  generally it is enough to set it to a few seconds, as most clients send the\n  full request immediately upon connection. add 3 or more seconds to cover tcp\n  retransmits but that's all. setting it to very low values (eg: 50 ms) will\n  generally work on local networks as long as there are no packet losses. this\n  will prevent people from sending bare http requests using telnet.\n\n  if this parameter is not set, the client timeout still applies between each\n  chunk of the incoming request. it should be set in the frontend to take\n  effect, unless the frontend is in tcp mode, in which case the http backend's\n  timeout will be used.\n\n  see also : \"errorfile\", \"http-ignore-probes\", \"timeout http-keep-alive\", and\n             \"timeout client\".\n\ntimeout queue <timeout>\n  set the maximum time to wait in the queue for a connection slot to be free\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  when a server's maxconn is reached, connections are left pending in a queue\n  which may be server-specific or global to the backend. in order not to wait\n  indefinitely, a timeout is applied to requests pending in the queue. if the\n  timeout is reached, it is considered that the request will almost never be\n  served, so it is dropped and a 503 error is returned to the client.\n\n  the \"timeout queue\" statement allows to fix the maximum time for a request to\n  be left pending in a queue. if unspecified, the same value as the backend's\n  connection timeout (\"timeout connect\") is used, for backwards compatibility\n  with older versions with no \"timeout queue\" parameter.\n\n  see also : \"timeout connect\", \"contimeout\".\n\ntimeout server <timeout>\ntimeout srvtimeout <timeout> (deprecated)\n  set the maximum inactivity time on the server side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase of the server's response, when it has to send the\n  headers, as it directly represents the server's processing time for the\n  request. to find out what value to put there, it's often good to start with\n  what would be considered as unacceptable response times, then check the logs\n  to observe the response time distribution, and adjust the value accordingly.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. in tcp mode (and to a lesser extent, in http mode), it is highly\n  recommended that the client timeout remains equal to the server timeout in\n  order to avoid complex situations to debug. whatever the expected server\n  response times, it is a good practice to cover at least one or several tcp\n  packet losses by specifying timeouts that are slightly above multiples of 3\n  seconds (eg: 4 or 5 seconds minimum). if some long-lived sessions are mixed\n  with short-lived sessions (eg: websocket and http), it's worth considering\n  \"timeout tunnel\", which overrides \"timeout client\" and \"timeout server\" for\n  tunnels.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"srvtimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout srvtimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also : \"srvtimeout\", \"timeout client\" and \"timeout tunnel\".\n\ntimeout server-fin <timeout>\n  set the inactivity timeout on the server side for half-closed connections.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data while one direction is already shut down. this timeout is different\n  from \"timeout server\" in that it only applies to connections which are closed\n  in one direction. this is particularly useful to avoid keeping connections in\n  fin_wait state for too long when a remote server does not disconnect cleanly.\n  this problem is particularly common long connections such as rdp or websocket.\n  note that this timeout can override \"timeout tunnel\" when a connection shuts\n  down in one direction. this setting was provided for completeness, but in most\n  situations, it should not be needed.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. by default it is not set, so half-closed connections\n  will use the other timeouts (timeout.server or timeout.tunnel).\n\n  see also : \"timeout client-fin\", \"timeout server\", and \"timeout tunnel\".\n\ntimeout tarpit <timeout>\n  set the duration for which tarpitted connections will be maintained\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the tarpit duration specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  when a connection is tarpitted using \"reqtarpit\", it is maintained open with\n  no activity for a certain amount of time, then closed. \"timeout tarpit\"\n  defines how long it will be maintained open.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. if unspecified, the same value as the backend's connection timeout\n  (\"timeout connect\") is used, for backwards compatibility with older versions\n  with no \"timeout tarpit\" parameter.\n\n  see also : \"timeout connect\", \"contimeout\".\n\ntimeout tunnel <timeout>\n  set the maximum inactivity time on the client and server side for tunnels.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the tunnel timeout applies when a bidirectional connection is established\n  between a client and a server, and the connection remains inactive in both\n  directions. this timeout supersedes both the client and server timeouts once\n  the connection becomes a tunnel. in tcp, this timeout is used as soon as no\n  analyser remains attached to either connection (eg: tcp content rules are\n  accepted). in http, this timeout is used when a connection is upgraded (eg:\n  when switching to the websocket protocol, or forwarding a connect request\n  to a proxy), or after the first response when no keepalive/close option is\n  specified.\n\n  since this timeout is usually used in conjunction with long-lived connections,\n  it usually is a good idea to also set \"timeout client-fin\" to handle the\n  situation where a client suddenly disappears from the net and does not\n  acknowledge a close, or sends a shutdown and does not acknowledge pending\n  data anymore. this can happen in lossy networks where firewalls are present,\n  and is detected by the presence of large amounts of sessions in a fin_wait\n  state.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. whatever the expected normal idle time, it is a good practice to\n  cover at least one or several tcp packet losses by specifying timeouts that\n  are slightly above multiples of 3 seconds (eg: 4 or 5 seconds minimum).\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it.\n\n  example :\n        defaults http\n            option http-server-close\n            timeout connect 5s\n            timeout client 30s\n            timeout client-fin 30s\n            timeout server 30s\n            timeout tunnel  1h    # timeout to use with websocket and connect\n\n  see also : \"timeout client\", \"timeout client-fin\", \"timeout server\".\n\ntransparent (deprecated)\n  enable client-side transparent proxying\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  this keyword was introduced in order to provide layer 7 persistence to layer\n  3 load balancers. the idea is to use the os's ability to redirect an incoming\n  connection for a remote address to a local process (here haproxy), and let\n  this process know what address was initially requested. when this option is\n  used, sessions without cookies will be forwarded to the original destination\n  ip address of the incoming request (which should match that of another\n  equipment), while requests with cookies will still be forwarded to the\n  appropriate server.\n\n  the \"transparent\" keyword is deprecated, use \"option transparent\" instead.\n\n  note that contrary to a common belief, this option does not make haproxy\n  present the client's ip to the server when establishing the connection.\n\n  see also: \"option transparent\"\n\nunique-id-format <string>\n  generate a unique id for each request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  yes  |    yes   |   yes  |   no\n  arguments :\n    <string>   is a log-format string.\n\n  this keyword creates a id for each request using the custom log format. a\n  unique id is useful to trace a request passing through many components of\n  a complex infrastructure. the newly created id may also be logged using the\n  %id tag the log-format string.\n\n  the format should be composed from elements that are guaranteed to be\n  unique when combined together. for instance, if multiple haproxy instances\n  are involved, it might be important to include the node name. it is often\n  needed to log the incoming connection's source and destination addresses\n  and ports. note that since multiple requests may be performed over the same\n  connection, including a request counter may help differentiate them.\n  similarly, a timestamp may protect against a rollover of the counter.\n  logging the process id will avoid collisions after a service restart.\n\n  it is recommended to use hexadecimal notation for many fields since it\n  makes them more compact and saves space in logs.\n\n  example:\n\n        unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n\n        will generate:\n\n               7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\n  see also: \"unique-id-header\"\n\nunique-id-header <name>\n  add a unique id header in the http request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  yes  |    yes   |   yes  |   no\n  arguments :\n    <name>   is the name of the header.\n\n  add a unique-id header in the http request sent to the server, using the\n  unique-id-format. it can't work if the unique-id-format doesn't exist.\n\n  example:\n\n        unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n        unique-id-header x-unique-id\n\n        will generate:\n\n           x-unique-id: 7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\n    see also: \"unique-id-format\"\n\nuse_backend <backend> [{if | unless} <condition>]\n  switch to a specific backend if/unless an acl-based condition is matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <backend>   is the name of a valid backend or \"listen\" section, or a\n                \"log-format\" string resolving to a backend name.\n\n    <condition> is a condition composed of acls, as described in section 7\\. if\n                it is omitted, the rule is unconditionally applied.\n\n  when doing content-switching, connections arrive on a frontend and are then\n  dispatched to various backends depending on a number of conditions. the\n  relation between the conditions and the backends is described with the\n  \"use_backend\" keyword. while it is normally used with http processing, it can\n  also be used in pure tcp, either without content using stateless acls (eg:\n  source address validation) or combined with a \"tcp-request\" rule to wait for\n  some payload.\n\n  there may be as many \"use_backend\" rules as desired. all of these rules are\n  evaluated in their declaration order, and the first one which matches will\n  assign the backend.\n\n  in the first form, the backend will be used if the condition is met. in the\n  second form, the backend will be used if the condition is not met. if no\n  condition is valid, the backend defined with \"default_backend\" will be used.\n  if no default backend is defined, either the servers in the same section are\n  used (in case of a \"listen\" section) or, in case of a frontend, no server is\n  used and a 503 service unavailable response is returned.\n\n  note that it is possible to switch from a tcp frontend to an http backend. in\n  this case, either the frontend has already checked that the protocol is http,\n  and backend processing will immediately follow, or the backend will wait for\n  a complete http request to get in. this feature is useful when a frontend\n  must decode several protocols on a unique port, one of them being http.\n\n  when <backend> is a simple name, it is resolved at configuration time, and an\n  error is reported if the specified backend does not exist. if <backend> is\n  a log-format string instead, no check may be done at configuration time, so\n  the backend name is resolved dynamically at run time. if the resulting\n  backend name does not correspond to any valid backend, no other rule is\n  evaluated, and the default_backend directive is applied instead. note that\n  when using dynamic backend names, it is highly recommended to use a prefix\n  that no other backend uses in order to ensure that an unauthorized backend\n  cannot be forced from the request.\n\n  it is worth mentioning that \"use_backend\" rules with an explicit name are\n  used to detect the association between frontends and backends to compute the\n  backend's \"fullconn\" setting. this cannot be done for dynamic names.\n\n  see also: \"default_backend\", \"tcp-request\", \"fullconn\", \"log-format\", and\n            section 7 about acls.\n\nuse-server <server> if <condition>\nuse-server <server> unless <condition>\n  only use a specific server if/unless an acl-based condition is matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    no    |   yes  |   yes\n  arguments :\n    <server>    is the name of a valid server in the same backend section.\n\n    <condition> is a condition composed of acls, as described in section 7.\n\n  by default, connections which arrive to a backend are load-balanced across\n  the available servers according to the configured algorithm, unless a\n  persistence mechanism such as a cookie is used and found in the request.\n\n  sometimes it is desirable to forward a particular request to a specific\n  server without having to declare a dedicated backend for this server. this\n  can be achieved using the \"use-server\" rules. these rules are evaluated after\n  the \"redirect\" rules and before evaluating cookies, and they have precedence\n  on them. there may be as many \"use-server\" rules as desired. all of these\n  rules are evaluated in their declaration order, and the first one which\n  matches will assign the server.\n\n  if a rule designates a server which is down, and \"option persist\" is not used\n  and no force-persist rule was validated, it is ignored and evaluation goes on\n  with the next rules until one matches.\n\n  in the first form, the server will be used if the condition is met. in the\n  second form, the server will be used if the condition is not met. if no\n  condition is valid, the processing continues and the server will be assigned\n  according to other persistence mechanisms.\n\n  note that even if a rule is matched, cookie processing is still performed but\n  does not assign the server. this allows prefixed cookies to have their prefix\n  stripped.\n\n  the \"use-server\" statement works both in http and tcp mode. this makes it\n  suitable for use with content-based inspection. for instance, a server could\n  be selected in a farm according to the tls sni field. and if these servers\n  have their weight set to zero, they will not be used for other traffic.\n\n  example :\n     # intercept incoming tls requests based on the sni field\n     use-server www if { req_ssl_sni -i www.example.com }\n     server     www 192.168.0.1:443 weight 0\n     use-server mail if { req_ssl_sni -i mail.example.com }\n     server     mail 192.168.0.1:587 weight 0\n     use-server imap if { req_ssl_sni -i imap.example.com }\n     server     mail 192.168.0.1:993 weight 0\n     # all the rest is forwarded to this server\n     server  default 192.168.0.2:443 check\n\n  see also: \"use_backend\", section 5 about server and section 7 about acls.\n\n5\\. bind and server options\n--------------------------\n\nthe \"bind\", \"server\" and \"default-server\" keywords support a number of settings\ndepending on some build options and on the system haproxy was built on. these\nsettings generally each consist in one word sometimes followed by a value,\nwritten on the same line as the \"bind\" or \"server\" line. all these options are\ndescribed in this section.\n\n5.1\\. bind options\n-----------------\n\nthe \"bind\" keyword supports a certain number of settings which are all passed\nas arguments on the same line. the order in which those arguments appear makes\nno importance, provided that they appear after the bind address. all of these\nparameters are optional. some of them consist in a single words (booleans),\nwhile other ones expect a value after them. in this case, the value must be\nprovided immediately after the setting name.\n\nthe currently supported settings are the following ones.\n\naccept-proxy\n  enforces the use of the proxy protocol over any connection accepted by any of\n  the sockets declared on the same line. versions 1 and 2 of the proxy protocol\n  are supported and correctly detected. the proxy protocol dictates the layer\n  3/4 addresses of the incoming connection to be used everywhere an address is\n  used, with the only exception of \"tcp-request connection\" rules which will\n  only see the real connection address. logs will reflect the addresses\n  indicated in the protocol, unless it is violated, in which case the real\n  address will still be used.  this keyword combined with support from external\n  components can be used as an efficient and reliable alternative to the\n  x-forwarded-for mechanism which is not always reliable and not even always\n  usable. see also \"tcp-request connection expect-proxy\" for a finer-grained\n  setting of which client is allowed to use the protocol.\n\nalpn <protocols>\n  this enables the tls alpn extension and advertises the specified protocol\n  list as supported on top of alpn. the protocol list consists in a comma-\n  delimited list of protocol names, for instance: \"http/1.1,http/1.0\" (without\n  quotes). this requires that the ssl library is build with support for tls\n  extensions enabled (check with haproxy -vv). the alpn extension replaces the\n  initial npn extension.\n\nbacklog <backlog>\n  sets the socket's backlog to this value. if unspecified, the frontend's\n  backlog is used instead, which generally defaults to the maxconn value.\n\necdhe <named curve>\n  this setting is only available when support for openssl was built in. it sets\n  the named curve (rfc 4492) used to generate ecdh ephemeral keys. by default,\n  used named curve is prime256v1.\n\nca-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load ca certificates used to verify\n  client's certificate.\n\nca-ignore-err [all|<errorid>,...]\n  this setting is only available when support for openssl was built in.\n  sets a comma separated list of errorids to ignore during verify at depth > 0.\n  if set to 'all', all errors are ignored. ssl handshake is not aborted if an\n  error is ignored.\n\nca-sign-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file containing both the ca certificate and the ca private\n  key used to create and sign server's certificates. this is a mandatory\n  setting when the dynamic generation of certificates is enabled. see\n  'generate-certificates' for details.\n\nca-sign-passphrase <passphrase>\n  this setting is only available when support for openssl was built in. it is\n  the ca private key passphrase. this setting is optional and used only when\n  the dynamic generation of certificates is enabled. see\n  'generate-certificates' for details.\n\nciphers <ciphers>\n  this setting is only available when support for openssl was built in. it sets\n  the string describing the list of cipher algorithms (\"cipher suite\") that are\n  negotiated during the ssl/tls handshake. the format of the string is defined\n  in \"man 1 ciphers\" from openssl man pages, and can be for instance a string\n  such as \"aes:all:!anull:!enull:+rc4:@strength\" (without quotes).\n\ncrl-file <crlfile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load certificate revocation list used\n  to verify client's certificate.\n\ncrt <cert>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file containing both the required certificates and any\n  associated private keys. this file can be built by concatenating multiple\n  pem files into one (e.g. cat cert.pem key.pem > combined.pem). if your ca\n  requires an intermediate certificate, this can also be concatenated into this\n  file.\n\n  if the openssl used supports diffie-hellman, parameters present in this file\n  are loaded.\n\n  if a directory name is used instead of a pem file, then all files found in\n  that directory will be loaded in alphabetic order unless their name ends with\n  '.issuer', '.ocsp' or '.sctl' (reserved extensions). this directive may be\n  specified multiple times in order to load certificates from multiple files or\n  directories. the certificates will be presented to clients who provide a\n  valid tls server name indication field matching one of their cn or alt\n  subjects.  wildcards are supported, where a wildcard character '*' is used\n  instead of the first hostname component (eg: *.example.org matches\n  www.example.org but not www.sub.example.org).\n\n  if no sni is provided by the client or if the ssl library does not support\n  tls extensions, or if the client provides an sni hostname which does not\n  match any certificate, then the first loaded certificate will be presented.\n  this means that when loading certificates from a directory, it is highly\n  recommended to load the default one first as a file or to ensure that it will\n  always be the first one in the directory.\n\n  note that the same cert may be loaded multiple times without side effects.\n\n  some cas (such as godaddy) offer a drop down list of server types that do not\n  include haproxy when obtaining a certificate. if this happens be sure to\n  choose a webserver that the ca believes requires an intermediate ca (for\n  godaddy, selection apache tomcat will get the correct bundle, but many\n  others, e.g. nginx, result in a wrong bundle that will not work for some\n  clients).\n\n  for each pem file, haproxy checks for the presence of file at the same path\n  suffixed by \".ocsp\". if such file is found, support for the tls certificate\n  status request extension (also known as \"ocsp stapling\") is automatically\n  enabled. the content of this file is optional. if not empty, it must contain\n  a valid ocsp response in der format. in order to be valid an ocsp response\n  must comply with the following rules: it has to indicate a good status,\n  it has to be a single response for the certificate of the pem file, and it\n  has to be valid at the moment of addition. if these rules are not respected\n  the ocsp response is ignored and a warning is emitted. in order to  identify\n  which certificate an ocsp response applies to, the issuer's certificate is\n  necessary. if the issuer's certificate is not found in the pem file, it will\n  be loaded from a file at the same path as the pem file suffixed by \".issuer\"\n  if it exists otherwise it will fail with an error.\n\n  for each pem file, haproxy also checks for the presence of file at the same\n  path suffixed by \".sctl\". if such file is found, support for certificate\n  transparency (rfc6962) tls extension is enabled. the file must contain a\n  valid signed certificate timestamp list, as described in rfc. file is parsed\n  to check basic syntax, but no signatures are verified.\n\ncrt-ignore-err <errors>\n  this setting is only available when support for openssl was built in. sets a\n  comma separated list of errorids to ignore during verify at depth == 0\\.  if\n  set to 'all', all errors are ignored. ssl handshake is not aborted if an error\n  is ignored.\n\ncrt-list <file>\n  this setting is only available when support for openssl was built in. it\n  designates a list of pem file with an optional list of sni filter per\n  certificate, with the following format for each line :\n\n        <crtfile> [[!]<snifilter> ...]\n\n  wildcards are supported in the sni filter. negative filter are also supported,\n  only useful in combination with a wildcard filter to exclude a particular sni.\n  the certificates will be presented to clients who provide a valid tls server\n  name indication field matching one of the sni filters. if no sni filter is\n  specified, the cn and alt subjects are used. this directive may be specified\n  multiple times. see the \"crt\" option for more information. the default\n  certificate is still needed to meet openssl expectations. if it is not used,\n  the 'strict-sni' option may be used.\n\ndefer-accept\n  is an optional keyword which is supported only on certain linux kernels. it\n  states that a connection will only be accepted once some data arrive on it,\n  or at worst after the first retransmit. this should be used only on protocols\n  for which the client talks first (eg: http). it can slightly improve\n  performance by ensuring that most of the request is already available when\n  the connection is accepted. on the other hand, it will not be able to detect\n  connections which don't talk. it is important to note that this option is\n  broken in all kernels up to 2.6.31, as the connection is never accepted until\n  the client talks. this can cause issues with front firewalls which would see\n  an established connection while the proxy will only see it in syn_recv. this\n  option is only supported on tcpv4/tcpv6 sockets and ignored by other ones.\n\nforce-sslv3\n  this option enforces use of sslv3 only on ssl connections instantiated from\n  this listener. sslv3 is generally less expensive than the tls counterparts\n  for high connection rates. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\" and \"no-sslv3\".\n\nforce-tlsv10\n  this option enforces use of tlsv1.0 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\" and \"no-sslv3\".\n\nforce-tlsv11\n  this option enforces use of tlsv1.1 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\", and \"no-sslv3\".\n\nforce-tlsv12\n  this option enforces use of tlsv1.2 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\", and \"no-sslv3\".\n\ngenerate-certificates\n  this setting is only available when support for openssl was built in. it\n  enables the dynamic ssl certificates generation. a ca certificate and its\n  private key are necessary (see 'ca-sign-file'). when haproxy is configured as\n  a transparent forward proxy, ssl requests generate errors because of a common\n  name mismatch on the certificate presented to the client. with this option\n  enabled, haproxy will try to forge a certificate using the sni hostname\n  indicated by the client. this is done only if no certificate matches the sni\n  hostname (see 'crt-list'). if an error occurs, the default certificate is\n  used, else the 'strict-sni' option is set.\n  it can also be used when haproxy is configured as a reverse proxy to ease the\n  deployment of an architecture with many backends.\n\n  creating a ssl certificate is an expensive operation, so a lru cache is used\n  to store forged certificates (see 'tune.ssl.ssl-ctx-cache-size'). it\n  increases the haproxy's memroy footprint to reduce latency when the same\n  certificate is used many times.\n\ngid <gid>\n  sets the group of the unix sockets to the designated system gid. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"group\"\n  setting except that the group id is used instead of its name. this setting is\n  ignored by non unix sockets.\n\ngroup <group>\n  sets the group of the unix sockets to the designated system group. it can\n  also be set by default in the global section's \"unix-bind\" statement. note\n  that some platforms simply ignore this. this setting is equivalent to the\n  \"gid\" setting except that the group name is used instead of its gid. this\n  setting is ignored by non unix sockets.\n\nid <id>\n  fixes the socket id. by default, socket ids are automatically assigned, but\n  sometimes it is more convenient to fix them to ease monitoring. this value\n  must be strictly positive and unique within the listener/frontend. this\n  option can only be used when defining only a single socket.\n\ninterface <interface>\n  restricts the socket to a specific interface. when specified, only packets\n  received from that particular interface are processed by the socket. this is\n  currently only supported on linux. the interface must be a primary system\n  interface, not an aliased interface. it is also possible to bind multiple\n  frontends to the same address if they are bound to different interfaces. note\n  that binding to a network interface requires root privileges. this parameter\n  is only compatible with tcpv4/tcpv6 sockets.\n\nlevel <level>\n  this setting is used with the stats sockets only to restrict the nature of\n  the commands that can be issued on the socket. it is ignored by other\n  sockets. <level> can be one of :\n  - \"user\" is the least privileged level ; only non-sensitive stats can be\n    read, and no change is allowed. it would make sense on systems where it\n    is not easy to restrict access to the socket.\n  - \"operator\" is the default level and fits most common uses. all data can\n    be read, and only non-sensitive changes are permitted (eg: clear max\n    counters).\n  - \"admin\" should be used with care, as everything is permitted (eg: clear\n    all counters).\n\nmaxconn <maxconn>\n  limits the sockets to this number of concurrent connections. extraneous\n  connections will remain in the system's backlog until a connection is\n  released. if unspecified, the limit will be the same as the frontend's\n  maxconn. note that in case of port ranges or multiple addresses, the same\n  value will be applied to each socket. this setting enables different\n  limitations on expensive sockets, for instance ssl entries which may easily\n  eat all memory.\n\nmode <mode>\n  sets the octal mode used to define access permissions on the unix socket. it\n  can also be set by default in the global section's \"unix-bind\" statement.\n  note that some platforms simply ignore this. this setting is ignored by non\n  unix sockets.\n\nmss <maxseg>\n  sets the tcp maximum segment size (mss) value to be advertised on incoming\n  connections. this can be used to force a lower mss for certain specific\n  ports, for instance for connections passing through a vpn. note that this\n  relies on a kernel feature which is theoretically supported under linux but\n  was buggy in all versions prior to 2.6.28\\. it may or may not work on other\n  operating systems. it may also not change the advertised value but change the\n  effective size of outgoing segments. the commonly advertised value for tcpv4\n  over ethernet networks is 1460 = 1500(mtu) - 40(ip+tcp). if this value is\n  positive, it will be used as the advertised mss. if it is negative, it will\n  indicate by how much to reduce the incoming connection's advertised mss for\n  outgoing segments. this parameter is only compatible with tcp v4/v6 sockets.\n\nname <name>\n  sets an optional name for these sockets, which will be reported on the stats\n  page.\n\nnice <nice>\n  sets the 'niceness' of connections initiated from the socket. value must be\n  in the range -1024..1024 inclusive, and defaults to zero. positive values\n  means that such connections are more friendly to others and easily offer\n  their place in the scheduler. on the opposite, negative values mean that\n  connections want to run with a higher priority than others. the difference\n  only happens under high loads when the system is close to saturation.\n  negative values are appropriate for low-latency or administration services,\n  and high values are generally recommended for cpu intensive tasks such as ssl\n  processing or bulk transfers which are less sensible to latency. for example,\n  it may make sense to use a positive value for an smtp socket and a negative\n  one for an rdp socket.\n\nno-sslv3\n  this setting is only available when support for openssl was built in. it\n  disables support for sslv3 on any sockets instantiated from the listener when\n  ssl is supported. note that sslv2 is forced disabled in the code and cannot\n  be enabled using any configuration option. this option is also available on\n  global statement \"ssl-default-bind-options\". see also \"force-tls*\",\n  and \"force-sslv3\".\n\nno-tls-tickets\n  this setting is only available when support for openssl was built in. it\n  disables the stateless session resumption (rfc 5077 tls ticket\n  extension) and force to use stateful session resumption. stateless\n  session resumption is more expensive in cpu usage. this option is also\n  available on global statement \"ssl-default-bind-options\".\n\nno-tlsv10\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.0 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nno-tlsv11\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.1 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nno-tlsv12\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.2 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nnpn <protocols>\n  this enables the npn tls extension and advertises the specified protocol list\n  as supported on top of npn. the protocol list consists in a comma-delimited\n  list of protocol names, for instance: \"http/1.1,http/1.0\" (without quotes).\n  this requires that the ssl library is build with support for tls extensions\n  enabled (check with haproxy -vv). note that the npn extension has been\n  replaced with the alpn extension (see the \"alpn\" keyword).\n\nprocess [ all | odd | even | <number 1-64>[-<number 1-64>] ]\n  this restricts the list of processes on which this listener is allowed to\n  run. it does not enforce any process but eliminates those which do not match.\n  if the frontend uses a \"bind-process\" setting, the intersection between the\n  two is applied. if in the end the listener is not allowed to run on any\n  remaining process, a warning is emitted, and the listener will either run on\n  the first process of the listener if a single process was specified, or on\n  all of its processes if multiple processes were specified. for the unlikely\n  case where several ranges are needed, this directive may be repeated. the\n  main purpose of this directive is to be used with the stats sockets and have\n  one different socket per process. the second purpose is to have multiple bind\n  lines sharing the same ip:port but not the same process in a listener, so\n  that the system can distribute the incoming connections into multiple queues\n  and allow a smoother inter-process load balancing. currently linux 3.9 and\n  above is known for supporting this. see also \"bind-process\" and \"nbproc\".\n\nssl\n  this setting is only available when support for openssl was built in. it\n  enables ssl deciphering on connections instantiated from this listener. a\n  certificate is necessary (see \"crt\" above). all contents in the buffers will\n  appear in clear text, so that acls and http processing will only have access\n  to deciphered contents.\n\nstrict-sni\n  this setting is only available when support for openssl was built in. the\n  ssl/tls negotiation is allow only if the client provided an sni which match\n  a certificate. the default certificate is not used.\n  see the \"crt\" option for more information.\n\ntcp-ut <delay>\n  sets the tcp user timeout for all incoming connections instanciated from this\n  listening socket. this option is available on linux since version 2.6.37\\. it\n  allows haproxy to configure a timeout for sockets which contain data not\n  receiving an acknoledgement for the configured delay. this is especially\n  useful on long-lived connections experiencing long idle periods such as\n  remote terminals or database connection pools, where the client and server\n  timeouts must remain high to allow a long period of idle, but where it is\n  important to detect that the client has disappeared in order to release all\n  resources associated with its connection (and the server's session). the\n  argument is a delay expressed in milliseconds by default. this only works\n  for regular tcp connections, and is ignored for other protocols.\n\ntfo\n  is an optional keyword which is supported only on linux kernels >= 3.7\\. it\n  enables tcp fast open on the listening socket, which means that clients which\n  support this feature will be able to send a request and receive a response\n  during the 3-way handshake starting from second connection, thus saving one\n  round-trip after the first connection. this only makes sense with protocols\n  that use high connection rates and where each round trip matters. this can\n  possibly cause issues with many firewalls which do not accept data on syn\n  packets, so this option should only be enabled once well tested. this option\n  is only supported on tcpv4/tcpv6 sockets and ignored by other ones. you may\n  need to build haproxy with use_tfo=1 if your libc doesn't define\n  tcp_fastopen.\n\ntls-ticket-keys <keyfile>\n  sets the tls ticket keys file to load the keys from. the keys need to be 48\n  bytes long, encoded with base64 (ex. openssl rand -base64 48). number of keys\n  is specified by the tls_tickets_no build option (default 3) and at least as\n  many keys need to be present in the file. last tls_tickets_no keys will be\n  used for decryption and the penultimate one for encryption. this enables easy\n  key rotation by just appending new key to the file and reloading the process.\n  keys must be periodically rotated (ex. every 12h) or perfect forward secrecy\n  is compromised. it is also a good idea to keep the keys off any permanent\n  storage such as hard drives (hint: use tmpfs and don't swap those files).\n  lifetime hint can be changed using tune.ssl.timeout.\n\ntransparent\n  is an optional keyword which is supported only on certain linux kernels. it\n  indicates that the addresses will be bound even if they do not belong to the\n  local machine, and that packets targeting any of these addresses will be\n  intercepted just as if the addresses were locally configured. this normally\n  requires that ip forwarding is enabled. caution! do not use this with the\n  default address '*', as it would redirect any traffic for the specified port.\n  this keyword is available only when haproxy is built with use_linux_tproxy=1.\n  this parameter is only compatible with tcpv4 and tcpv6 sockets, depending on\n  kernel version. some distribution kernels include backports of the feature,\n  so check for support with your vendor.\n\nv4v6\n  is an optional keyword which is supported only on most recent systems\n  including linux kernels >= 2.4.21\\. it is used to bind a socket to both ipv4\n  and ipv6 when it uses the default address. doing so is sometimes necessary\n  on systems which bind to ipv6 only by default. it has no effect on non-ipv6\n  sockets, and is overridden by the \"v6only\" option.\n\nv6only\n  is an optional keyword which is supported only on most recent systems\n  including linux kernels >= 2.4.21\\. it is used to bind a socket to ipv6 only\n  when it uses the default address. doing so is sometimes preferred to doing it\n  system-wide as it is per-listener. it has no effect on non-ipv6 sockets and\n  has precedence over the \"v4v6\" option.\n\nuid <uid>\n  sets the owner of the unix sockets to the designated system uid. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"user\"\n  setting except that the user numeric id is used instead of its name. this\n  setting is ignored by non unix sockets.\n\nuser <user>\n  sets the owner of the unix sockets to the designated system user. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"uid\"\n  setting except that the user name is used instead of its uid. this setting is\n  ignored by non unix sockets.\n\nverify [none|optional|required]\n  this setting is only available when support for openssl was built in. if set\n  to 'none', client certificate is not requested. this is the default. in other\n  cases, a client certificate is requested. if the client does not provide a\n  certificate after the request and if 'verify' is set to 'required', then the\n  handshake is aborted, while it would have succeeded if set to 'optional'. the\n  certificate provided by the client is always verified using cas from\n  'ca-file' and optional crls from 'crl-file'. on verify failure the handshake\n  is aborted, regardless of the 'verify' option, unless the error code exactly\n  matches one of those listed with 'ca-ignore-err' or 'crt-ignore-err'.\n\n5.2\\. server and default-server options\n------------------------------------\n\nthe \"server\" and \"default-server\" keywords support a certain number of settings\nwhich are all passed as arguments on the server line. the order in which those\narguments appear does not count, and they are all optional. some of those\nsettings are single words (booleans) while others expect one or several values\nafter them. in this case, the values must immediately follow the setting name.\nexcept default-server, all those settings must be specified after the server's\naddress if they are used:\n\n  server <name> <address>[:port] [settings ...]\n  default-server [settings ...]\n\nthe currently supported settings are the following ones.\n\naddr <ipv4|ipv6>\n  using the \"addr\" parameter, it becomes possible to use a different ip address\n  to send health-checks. on some servers, it may be desirable to dedicate an ip\n  address to specific component able to perform complex tests which are more\n  suitable to health-checks than the application. this parameter is ignored if\n  the \"check\" parameter is not set. see also the \"port\" parameter.\n\n  supported in default-server: no\n\nagent-check\n  enable an auxiliary agent check which is run independently of a regular\n  health check. an agent health check is performed by making a tcp connection\n  to the port set by the \"agent-port\" parameter and reading an ascii string.\n  the string is made of a series of words delimited by spaces, tabs or commas\n  in any order, optionally terminated by '\\r' and/or '\\n', each consisting of :\n\n  - an ascii representation of a positive integer percentage, e.g. \"75%\".\n    values in this format will set the weight proportional to the initial\n    weight of a server as configured when haproxy starts. note that a zero\n    weight is reported on the stats page as \"drain\" since it has the same\n    effect on the server (it's removed from the lb farm).\n\n  - the word \"ready\". this will turn the server's administrative state to the\n    ready mode, thus cancelling any drain or maint state\n\n  - the word \"drain\". this will turn the server's administrative state to the\n    drain mode, thus it will not accept any new connections other than those\n    that are accepted via persistence.\n\n  - the word \"maint\". this will turn the server's administrative state to the\n    maint mode, thus it will not accept any new connections at all, and health\n    checks will be stopped.\n\n  - the words \"down\", \"failed\", or \"stopped\", optionally followed by a\n    description string after a sharp ('#'). all of these mark the server's\n    operating state as down, but since the word itself is reported on the stats\n    page, the difference allows an administrator to know if the situation was\n    expected or not : the service may intentionally be stopped, may appear up\n    but fail some validity tests, or may be seen as down (eg: missing process,\n    or port not responding).\n\n  - the word \"up\" sets back the server's operating state as up if health checks\n    also report that the service is accessible.\n\n  parameters which are not advertised by the agent are not changed. for\n  example, an agent might be designed to monitor cpu usage and only report a\n  relative weight and never interact with the operating status. similarly, an\n  agent could be designed as an end-user interface with 3 radio buttons\n  allowing an administrator to change only the administrative state. however,\n  it is important to consider that only the agent may revert its own actions,\n  so if a server is set to drain mode or to down state using the agent, the\n  agent must implement the other equivalent actions to bring the service into\n  operations again.\n\n  failure to connect to the agent is not considered an error as connectivity\n  is tested by the regular health check which is enabled by the \"check\"\n  parameter. warning though, it is not a good idea to stop an agent after it\n  reports \"down\", since only an agent reporting \"up\" will be able to turn the\n  server up again. note that the cli on the unix stats socket is also able to\n  force an agent's result in order to workaround a bogus agent if needed.\n\n  requires the \"agent-port\" parameter to be set. see also the \"agent-inter\"\n  parameter.\n\n  supported in default-server: no\n\nagent-inter <delay>\n  the \"agent-inter\" parameter sets the interval between two agent checks\n  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.\n\n  just as with every other time-based parameter, it may be entered in any\n  other explicit unit among { us, ms, s, m, h, d }. the \"agent-inter\"\n  parameter also serves as a timeout for agent checks \"timeout check\" is\n  not set. in order to reduce \"resonance\" effects when multiple servers are\n  hosted on the same hardware, the agent and health checks of all servers\n  are started with a small time offset between them. it is also possible to\n  add some random noise in the agent and health checks interval using the\n  global \"spread-checks\" keyword. this makes sense for instance when a lot\n  of backends use the same servers.\n\n  see also the \"agent-check\" and \"agent-port\" parameters.\n\n  supported in default-server: yes\n\nagent-port <port>\n  the \"agent-port\" parameter sets the tcp port used for agent checks.\n\n  see also the \"agent-check\" and \"agent-inter\" parameters.\n\n  supported in default-server: yes\n\nbackup\n  when \"backup\" is present on a server line, the server is only used in load\n  balancing when all other non-backup servers are unavailable. requests coming\n  with a persistence cookie referencing the server will always be served\n  though. by default, only the first operational backup server is used, unless\n  the \"allbackups\" option is set in the backend. see also the \"allbackups\"\n  option.\n\n  supported in default-server: no\n\nca-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load ca certificates used to verify\n  server's certificate.\n\n  supported in default-server: no\n\ncheck\n  this option enables health checks on the server. by default, a server is\n  always considered available. if \"check\" is set, the server is available when\n  accepting periodic tcp connections, to ensure that it is really able to serve\n  requests. the default address and port to send the tests to are those of the\n  server, and the default source is the same as the one defined in the\n  backend. it is possible to change the address using the \"addr\" parameter, the\n  port using the \"port\" parameter, the source address using the \"source\"\n  address, and the interval and timers using the \"inter\", \"rise\" and \"fall\"\n  parameters. the request method is define in the backend using the \"httpchk\",\n  \"smtpchk\", \"mysql-check\", \"pgsql-check\" and \"ssl-hello-chk\" options. please\n  refer to those options and parameters for more information.\n\n  supported in default-server: no\n\ncheck-send-proxy\n  this option forces emission of a proxy protocol line with outgoing health\n  checks, regardless of whether the server uses send-proxy or not for the\n  normal traffic. by default, the proxy protocol is enabled for health checks\n  if it is already enabled for normal traffic and if no \"port\" nor \"addr\"\n  directive is present. however, if such a directive is present, the\n  \"check-send-proxy\" option needs to be used to force the use of the\n  protocol. see also the \"send-proxy\" option for more information.\n\n  supported in default-server: no\n\ncheck-ssl\n  this option forces encryption of all health checks over ssl, regardless of\n  whether the server uses ssl or not for the normal traffic. this is generally\n  used when an explicit \"port\" or \"addr\" directive is specified and ssl health\n  checks are not inherited. it is important to understand that this option\n  inserts an ssl transport layer below the checks, so that a simple tcp connect\n  check becomes an ssl connect, which replaces the old ssl-hello-chk. the most\n  common use is to send https checks by combining \"httpchk\" with ssl checks.\n  all ssl settings are common to health checks and traffic (eg: ciphers).\n  see the \"ssl\" option for more information.\n\n  supported in default-server: no\n\nciphers <ciphers>\n  this option sets the string describing the list of cipher algorithms that is\n  is negotiated during the ssl/tls handshake with the server. the format of the\n  string is defined in \"man 1 ciphers\". when ssl is used to communicate with\n  servers on the local network, it is common to see a weaker set of algorithms\n  than what is used over the internet. doing so reduces cpu usage on both the\n  server and haproxy while still keeping it compatible with deployed software.\n  some algorithms such as rc4-sha1 are reasonably cheap. if no security at all\n  is needed and just connectivity, using des can be appropriate.\n\n  supported in default-server: no\n\ncookie <value>\n  the \"cookie\" parameter sets the cookie value assigned to the server to\n  <value>. this value will be checked in incoming requests, and the first\n  operational server possessing the same value will be selected. in return, in\n  cookie insertion or rewrite modes, this value will be assigned to the cookie\n  sent to the client. there is nothing wrong in having several servers sharing\n  the same cookie value, and it is in fact somewhat common between normal and\n  backup servers. see also the \"cookie\" keyword in backend section.\n\n  supported in default-server: no\n\ncrl-file <crlfile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load certificate revocation list used\n  to verify server's certificate.\n\n  supported in default-server: no\n\ncrt <cert>\n  this setting is only available when support for openssl was built in.\n  it designates a pem file from which to load both a certificate and the\n  associated private key. this file can be built by concatenating both pem\n  files into one. this certificate will be sent if the server send a client\n  certificate request.\n\n  supported in default-server: no\n\ndisabled\n  the \"disabled\" keyword starts the server in the \"disabled\" state. that means\n  that it is marked down in maintenance mode, and no connection other than the\n  ones allowed by persist mode will reach it. it is very well suited to setup\n  new servers, because normal traffic will never reach them, while it is still\n  possible to test the service by making use of the force-persist mechanism.\n\n  supported in default-server: no\n\nerror-limit <count>\n  if health observing is enabled, the \"error-limit\" parameter specifies the\n  number of consecutive errors that triggers event selected by the \"on-error\"\n  option. by default it is set to 10 consecutive errors.\n\n  supported in default-server: yes\n\n  see also the \"check\", \"error-limit\" and \"on-error\".\n\nfall <count>\n  the \"fall\" parameter states that a server will be considered as dead after\n  <count> consecutive unsuccessful health checks. this value defaults to 3 if\n  unspecified. see also the \"check\", \"inter\" and \"rise\" parameters.\n\n  supported in default-server: yes\n\nforce-sslv3\n  this option enforces use of sslv3 only when ssl is used to communicate with\n  the server. sslv3 is generally less expensive than the tls counterparts for\n  high connection rates. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv10\n  this option enforces use of tlsv1.0 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv11\n  this option enforces use of tlsv1.1 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv12\n  this option enforces use of tlsv1.2 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nid <value>\n  set a persistent id for the server. this id must be positive and unique for\n  the proxy. an unused id will automatically be assigned if unset. the first\n  assigned value will be 1\\. this id is currently only returned in statistics.\n\n  supported in default-server: no\n\ninter <delay>\nfastinter <delay>\ndowninter <delay>\n  the \"inter\" parameter sets the interval between two consecutive health checks\n  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.\n  it is also possible to use \"fastinter\" and \"downinter\" to optimize delays\n  between checks depending on the server state :\n\n             server state            |             interval used\n    ---------------------------------+-----------------------------------------\n     up 100% (non-transitional)      | \"inter\"\n    ---------------------------------+-----------------------------------------\n     transitionally up (going down), |\n     transitionally down (going up), | \"fastinter\" if set, \"inter\" otherwise.\n     or yet unchecked.               |\n    ---------------------------------+-----------------------------------------\n     down 100% (non-transitional)    | \"downinter\" if set, \"inter\" otherwise.\n    ---------------------------------+-----------------------------------------\n\n  just as with every other time-based parameter, they can be entered in any\n  other explicit unit among { us, ms, s, m, h, d }. the \"inter\" parameter also\n  serves as a timeout for health checks sent to servers if \"timeout check\" is\n  not set. in order to reduce \"resonance\" effects when multiple servers are\n  hosted on the same hardware, the agent and health checks of all servers\n  are started with a small time offset between them. it is also possible to\n  add some random noise in the agent and health checks interval using the\n  global \"spread-checks\" keyword. this makes sense for instance when a lot\n  of backends use the same servers.\n\n  supported in default-server: yes\n\nmaxconn <maxconn>\n  the \"maxconn\" parameter specifies the maximal number of concurrent\n  connections that will be sent to this server. if the number of incoming\n  concurrent requests goes higher than this value, they will be queued, waiting\n  for a connection to be released. this parameter is very important as it can\n  save fragile servers from going down under extreme loads. if a \"minconn\"\n  parameter is specified, the limit becomes dynamic. the default value is \"0\"\n  which means unlimited. see also the \"minconn\" and \"maxqueue\" parameters, and\n  the backend's \"fullconn\" keyword.\n\n  supported in default-server: yes\n\nmaxqueue <maxqueue>\n  the \"maxqueue\" parameter specifies the maximal number of connections which\n  will wait in the queue for this server. if this limit is reached, next\n  requests will be redispatched to other servers instead of indefinitely\n  waiting to be served. this will break persistence but may allow people to\n  quickly re-log in when the server they try to connect to is dying. the\n  default value is \"0\" which means the queue is unlimited. see also the\n  \"maxconn\" and \"minconn\" parameters.\n\n  supported in default-server: yes\n\nminconn <minconn>\n  when the \"minconn\" parameter is set, the maxconn limit becomes a dynamic\n  limit following the backend's load. the server will always accept at least\n  <minconn> connections, never more than <maxconn>, and the limit will be on\n  the ramp between both values when the backend has less than <fullconn>\n  concurrent connections. this makes it possible to limit the load on the\n  server during normal loads, but push it further for important loads without\n  overloading the server during exceptional loads. see also the \"maxconn\"\n  and \"maxqueue\" parameters, as well as the \"fullconn\" backend keyword.\n\n  supported in default-server: yes\n\nno-ssl-reuse\n  this option disables ssl session reuse when ssl is used to communicate with\n  the server. it will force the server to perform a full handshake for every\n  new connection. it's probably only useful for benchmarking, troubleshooting,\n  and for paranoid users.\n\n  supported in default-server: no\n\nno-sslv3\n  this option disables support for sslv3 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tls-tickets\n  this setting is only available when support for openssl was built in. it\n  disables the stateless session resumption (rfc 5077 tls ticket\n  extension) and force to use stateful session resumption. stateless\n  session resumption is more expensive in cpu usage for servers. this option\n  is also available on global statement \"ssl-default-server-options\".\n\n  supported in default-server: no\n\nno-tlsv10\n  this option disables support for tlsv1.0 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tlsv11\n  this option disables support for tlsv1.1 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tlsv12\n  this option disables support for tlsv1.2 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nnon-stick\n  never add connections allocated to this sever to a stick-table.\n  this may be used in conjunction with backup to ensure that\n  stick-table persistence is disabled for backup servers.\n\n  supported in default-server: no\n\nobserve <mode>\n  this option enables health adjusting based on observing communication with\n  the server. by default this functionality is disabled and enabling it also\n  requires to enable health checks. there are two supported modes: \"layer4\" and\n  \"layer7\". in layer4 mode, only successful/unsuccessful tcp connections are\n  significant. in layer7, which is only allowed for http proxies, responses\n  received from server are verified, like valid/wrong http code, unparsable\n  headers, a timeout, etc. valid status codes include 100 to 499, 501 and 505.\n\n  supported in default-server: no\n\n  see also the \"check\", \"on-error\" and \"error-limit\".\n\non-error <mode>\n  select what should happen when enough consecutive errors are detected.\n  currently, four modes are available:\n  - fastinter: force fastinter\n  - fail-check: simulate a failed check, also forces fastinter (default)\n  - sudden-death: simulate a pre-fatal failed health check, one more failed\n    check will mark a server down, forces fastinter\n  - mark-down: mark the server immediately down and force fastinter\n\n  supported in default-server: yes\n\n  see also the \"check\", \"observe\" and \"error-limit\".\n\non-marked-down <action>\n  modify what occurs when a server is marked down.\n  currently one action is available:\n  - shutdown-sessions: shutdown peer sessions. when this setting is enabled,\n    all connections to the server are immediately terminated when the server\n    goes down. it might be used if the health check detects more complex cases\n    than a simple connection status, and long timeouts would cause the service\n    to remain unresponsive for too long a time. for instance, a health check\n    might detect that a database is stuck and that there's no chance to reuse\n    existing connections anymore. connections killed this way are logged with\n    a 'd' termination code (for \"down\").\n\n  actions are disabled by default\n\n  supported in default-server: yes\n\non-marked-up <action>\n  modify what occurs when a server is marked up.\n  currently one action is available:\n  - shutdown-backup-sessions: shutdown sessions on all backup servers. this is\n    done only if the server is not in backup state and if it is not disabled\n    (it must have an effective weight > 0). this can be used sometimes to force\n    an active server to take all the traffic back after recovery when dealing\n    with long sessions (eg: ldap, sql, ...). doing this can cause more trouble\n    than it tries to solve (eg: incomplete transactions), so use this feature\n    with extreme care. sessions killed because a server comes up are logged\n    with an 'u' termination code (for \"up\").\n\n  actions are disabled by default\n\n  supported in default-server: yes\n\nport <port>\n  using the \"port\" parameter, it becomes possible to use a different port to\n  send health-checks. on some servers, it may be desirable to dedicate a port\n  to a specific component able to perform complex tests which are more suitable\n  to health-checks than the application. it is common to run a simple script in\n  inetd for instance. this parameter is ignored if the \"check\" parameter is not\n  set. see also the \"addr\" parameter.\n\n  supported in default-server: yes\n\nredir <prefix>\n  the \"redir\" parameter enables the redirection mode for all get and head\n  requests addressing this server. this means that instead of having haproxy\n  forward the request to the server, it will send an \"http 302\" response with\n  the \"location\" header composed of this prefix immediately followed by the\n  requested uri beginning at the leading '/' of the path component. that means\n  that no trailing slash should be used after <prefix>. all invalid requests\n  will be rejected, and all non-get or head requests will be normally served by\n  the server. note that since the response is completely forged, no header\n  mangling nor cookie insertion is possible in the response. however, cookies in\n  requests are still analysed, making this solution completely usable to direct\n  users to a remote location in case of local disaster. main use consists in\n  increasing bandwidth for static servers by having the clients directly\n  connect to them. note: never use a relative location here, it would cause a\n  loop between the client and haproxy!\n\n  example :  server srv1 192.168.1.1:80 redir http://image1.mydomain.com check\n\n  supported in default-server: no\n\nrise <count>\n  the \"rise\" parameter states that a server will be considered as operational\n  after <count> consecutive successful health checks. this value defaults to 2\n  if unspecified. see also the \"check\", \"inter\" and \"fall\" parameters.\n\n  supported in default-server: yes\n\nresolve-prefer <family>\n  when dns resolution is enabled for a server and multiple ip addresses from\n  different families are returned, haproxy will prefer using an ip address\n  from the family mentioned in the \"resolve-prefer\" parameter.\n  available families: \"ipv4\" and \"ipv6\"\n\n  default value: ipv4\n\n  example: server s1 app1.domain.com:80 resolvers mydns resolve-prefer ipv6\n\nresolvers <id>\n  points to an existing \"resolvers\" section to resolve current server's\n  hostname.\n\n  example: server s1 app1.domain.com:80 resolvers mydns\n\n  see also chapter 5.3\n\nsend-proxy\n  the \"send-proxy\" parameter enforces use of the proxy protocol over any\n  connection established to this server. the proxy protocol informs the other\n  end about the layer 3/4 addresses of the incoming connection, so that it can\n  know the client's address or the public address it accessed to, whatever the\n  upper layer protocol. for connections accepted by an \"accept-proxy\" listener,\n  the advertised address will be used. only tcpv4 and tcpv6 address families\n  are supported. other families such as unix sockets, will report an unknown\n  family. servers using this option can fully be chained to another instance of\n  haproxy listening with an \"accept-proxy\" setting. this setting must not be\n  used if the server isn't aware of the protocol. when health checks are sent\n  to the server, the proxy protocol is automatically used when this option is\n  set, unless there is an explicit \"port\" or \"addr\" directive, in which case an\n  explicit \"check-send-proxy\" directive would also be needed to use the proxy\n  protocol. see also the \"accept-proxy\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2\n  the \"send-proxy-v2\" parameter enforces use of the proxy protocol version 2\n  over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. this setting must not be used if the\n  server isn't aware of this version of the protocol. see also the \"send-proxy\"\n  option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2-ssl\n  the \"send-proxy-v2-ssl\" parameter enforces use of the proxy protocol version\n  2 over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. in addition, the ssl information extension\n  of the proxy protocol is added to the proxy protocol header. this setting\n  must not be used if the server isn't aware of this version of the protocol.\n  see also the \"send-proxy-v2\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2-ssl-cn\n  the \"send-proxy-v2-ssl\" parameter enforces use of the proxy protocol version\n  2 over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. in addition, the ssl information extension\n  of the proxy protocol, along along with the common name from the subject of\n  the client certificate (if any), is added to the proxy protocol header. this\n  setting must not be used if the server isn't aware of this version of the\n  protocol. see also the \"send-proxy-v2\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nslowstart <start_time_in_ms>\n  the \"slowstart\" parameter for a server accepts a value in milliseconds which\n  indicates after how long a server which has just come back up will run at\n  full speed. just as with every other time-based parameter, it can be entered\n  in any other explicit unit among { us, ms, s, m, h, d }. the speed grows\n  linearly from 0 to 100% during this time. the limitation applies to two\n  parameters :\n\n  - maxconn: the number of connections accepted by the server will grow from 1\n    to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).\n\n  - weight: when the backend uses a dynamic weighted algorithm, the weight\n    grows linearly from 1 to 100%. in this case, the weight is updated at every\n    health-check. for this reason, it is important that the \"inter\" parameter\n    is smaller than the \"slowstart\", in order to maximize the number of steps.\n\n  the slowstart never applies when haproxy starts, otherwise it would cause\n  trouble to running servers. it only applies when a server has been previously\n  seen as failed.\n\n  supported in default-server: yes\n\nsni <expression>\n  the \"sni\" parameter evaluates the sample fetch expression, converts it to a\n  string and uses the result as the host name sent in the sni tls extension to\n  the server. a typical use case is to send the sni received from the client in\n  a bridged https scenario, using the \"ssl_fc_sni\" sample fetch for the\n  expression, though alternatives such as req.hdr(host) can also make sense.\n\n  supported in default-server: no\n\nsource <addr>[:<pl>[-<ph>]] [usesrc { <addr2>[:<port2>] | client | clientip } ]\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]\nsource <addr>[:<pl>[-<ph>]] [interface <name>] ...\n  the \"source\" parameter sets the source address which will be used when\n  connecting to the server. it follows the exact same parameters and principle\n  as the backend \"source\" keyword, except that it only applies to the server\n  referencing it. please consult the \"source\" keyword for details.\n\n  additionally, the \"source\" statement on a server line allows one to specify a\n  source port range by indicating the lower and higher bounds delimited by a\n  dash ('-'). some operating systems might require a valid ip address when a\n  source port range is specified. it is permitted to have the same ip/range for\n  several servers. doing so makes it possible to bypass the maximum of 64k\n  total concurrent connections. the limit will then reach 64k connections per\n  server.\n\n  supported in default-server: no\n\nssl\n  this option enables ssl ciphering on outgoing connections to the server. it\n  is critical to verify server certificates using \"verify\" when using ssl to\n  connect to servers, otherwise the communication is prone to trivial man in\n  the-middle attacks rendering ssl useless. when this option is used, health\n  checks are automatically sent in ssl too unless there is a \"port\" or an\n  \"addr\" directive indicating the check should be sent to a different location.\n  see the \"check-ssl\" option to force ssl health checks.\n\n  supported in default-server: no\n\ntrack [<proxy>/]<server>\n  this option enables ability to set the current state of the server by tracking\n  another one. it is possible to track a server which itself tracks another\n  server, provided that at the end of the chain, a server has health checks\n  enabled. if <proxy> is omitted the current one is used. if disable-on-404 is\n  used, it has to be enabled on both proxies.\n\n  supported in default-server: no\n\nverify [none|required]\n  this setting is only available when support for openssl was built in. if set\n  to 'none', server certificate is not verified. in the other case, the\n  certificate provided by the server is verified using cas from 'ca-file'\n  and optional crls from 'crl-file'. if 'ssl_server_verify' is not specified\n  in global  section, this is the default. on verify failure the handshake\n  is aborted. it is critically important to verify server certificates when\n  using ssl to connect to servers, otherwise the communication is prone to\n  trivial man-in-the-middle attacks rendering ssl totally useless.\n\n  supported in default-server: no\n\nverifyhost <hostname>\n  this setting is only available when support for openssl was built in, and\n  only takes effect if 'verify required' is also specified. when set, the\n  hostnames in the subject and subjectalternatenames of the certificate\n  provided by the server are checked. if none of the hostnames in the\n  certificate match the specified hostname, the handshake is aborted. the\n  hostnames in the server-provided certificate may include wildcards.\n\n  supported in default-server: no\n\nweight <weight>\n  the \"weight\" parameter is used to adjust the server's weight relative to\n  other servers. all servers will receive a load proportional to their weight\n  relative to the sum of all weights, so the higher the weight, the higher the\n  load. the default weight is 1, and the maximal value is 256\\. a value of 0\n  means the server will not participate in load-balancing but will still accept\n  persistent connections. if this parameter is used to distribute the load\n  according to server's capacity, it is recommended to start with values which\n  can both grow and shrink, for instance between 10 and 100 to leave enough\n  room above and below for later adjustments.\n\n  supported in default-server: yes\n\n5.3\\. server ip address resolution using dns\n-------------------------------------------\n\nhaproxy allows using a host name to be resolved to find out what is the server\nip address. by default, haproxy resolves the name when parsing the\nconfiguration, at startup.\nthis is not sufficient in some cases, such as in amazon where a server's ip\ncan change after a reboot or an elb virtual ip can change based on current\nworkload.\nthis chapter describes how haproxy can be configured to process server's name\nresolution at run time.\nwhether run time server name resolution has been enable or not, haproxy will\ncarry on doing the first resolution when parsing the configuration.\n\n5.3.1\\. global overview\n----------------------\n\nas we've seen in introduction, name resolution in haproxy occurs at two\ndifferent steps of the process life:\n\n  1\\. when starting up, haproxy parses the server line definition and matches a\n     host name. it uses libc functions to get the host name resolved. this\n     resolution relies on /etc/resolv.conf file.\n\n  2\\. at run time, when haproxy gets prepared to run a health check on a server,\n     it verifies if the current name resolution is still considered as valid.\n     if not, it processes a new resolution, in parallel of the health check.\n\na few other events can trigger a name resolution at run time:\n  - when a server's health check ends up in a connection timeout: this may be\n    because the server has a new ip address. so we need to trigger a name\n    resolution to know this new ip.\n\na few things important to notice:\n  - all the name servers are queried in the mean time. haproxy will process the\n    first valid response.\n\n  - a resolution is considered as invalid (nx, timeout, refused), when all the\n    servers return an error.\n\n5.3.2\\. the resolvers section\n----------------------------\n\nthis section is dedicated to host information related to name resolution in\nhaproxy.\nthere can be as many as resolvers section as needed. each section can contain\nmany name servers.\n\nresolvers <resolvers id>\n  creates a new name server list labelled <resolvers id>\n\na resolvers section accept the following parameters:\n\nnameserver <id> <ip>:<port>\n  dns server description:\n    <id>   : label of the server, should be unique\n    <ip>   : ip address of the server\n    <port> : port where the dns service actually runs\n\nhold <status> <period>\n  defines <period> during which the last name resolution should be kept based\n  on last resolution <status>\n    <status> : last name resolution status. only \"valid\" is accepted for now.\n    <period> : interval between two successive name resolution when the last\n               answer was in <status>. it follows the haproxy time format.\n               <period> is in milliseconds by default.\n\n  default value is 10s for \"valid\".\n\n  note: since the name resolution is triggered by the health checks, a new\n        resolution is triggered after <period> modulo the <inter> parameter of\n        the healch check.\n\nresolve_retries <nb>\n  defines the number <nb> of queries to send to resolve a server name before\n  giving up.\n  default value: 3\n\ntimeout <event> <time>\n  defines timeouts related to name resolution\n     <event> : the event on which the <time> timeout period applies to.\n               events available are:\n               - retry: time between two dns queries, when no response have\n                        been received.\n                        default value: 1s\n     <time>  : time related to the event. it follows the haproxy time format.\n               <time> is expressed in milliseconds.\n\nexample of a resolvers section (with default values):\n\n   resolvers mydns\n     nameserver dns1 10.0.0.1:53\n     nameserver dns2 10.0.0.2:53\n     resolve_retries       3\n     timeout retry         1s\n     hold valid           10s\n\n6\\. http header manipulation\n---------------------------\n\nin http mode, it is possible to rewrite, add or delete some of the request and\nresponse headers based on regular expressions. it is also possible to block a\nrequest or a response if a particular header matches a regular expression,\nwhich is enough to stop most elementary protocol attacks, and to protect\nagainst information leak from the internal network.\n\nif haproxy encounters an \"informational response\" (status code 1xx), it is able\nto process all rsp* rules which can allow, deny, rewrite or delete a header,\nbut it will refuse to add a header to any such messages as this is not\nhttp-compliant. the reason for still processing headers in such responses is to\nstop and/or fix any possible information leak which may happen, for instance\nbecause another downstream equipment would unconditionally add a header, or if\na server name appears there. when such messages are seen, normal processing\nstill occurs on the next non-informational messages.\n\nthis section covers common usage of the following keywords, described in detail\nin section 4.2 :\n\n  - reqadd     <string>\n  - reqallow   <search>\n  - reqiallow  <search>\n  - reqdel     <search>\n  - reqidel    <search>\n  - reqdeny    <search>\n  - reqideny   <search>\n  - reqpass    <search>\n  - reqipass   <search>\n  - reqrep     <search> <replace>\n  - reqirep    <search> <replace>\n  - reqtarpit  <search>\n  - reqitarpit <search>\n  - rspadd     <string>\n  - rspdel     <search>\n  - rspidel    <search>\n  - rspdeny    <search>\n  - rspideny   <search>\n  - rsprep     <search> <replace>\n  - rspirep    <search> <replace>\n\nwith all these keywords, the same conventions are used. the <search> parameter\nis a posix extended regular expression (regex) which supports grouping through\nparenthesis (without the backslash). spaces and other delimiters must be\nprefixed with a backslash ('\\') to avoid confusion with a field delimiter.\nother characters may be prefixed with a backslash to change their meaning :\n\n  \\t   for a tab\n  \\r   for a carriage return (cr)\n  \\n   for a new line (lf)\n  \\    to mark a space and differentiate it from a delimiter\n  \\#   to mark a sharp and differentiate it from a comment\n  \\\\   to use a backslash in a regex\n  \\\\\\\\ to use a backslash in the text (*2 for regex, *2 for haproxy)\n  \\xxx to write the ascii hex code xx as in the c language\n\nthe <replace> parameter contains the string to be used to replace the largest\nportion of text matching the regex. it can make use of the special characters\nabove, and can reference a substring which is delimited by parenthesis in the\nregex, by writing a backslash ('\\') immediately followed by one digit from 0 to\n9 indicating the group position (0 designating the entire line). this practice\nis very common to users of the \"sed\" program.\n\nthe <string> parameter represents the string which will systematically be added\nafter the last header line. it can also use special character sequences above.\n\nnotes related to these keywords :\n---------------------------------\n  - these keywords are not always convenient to allow/deny based on header\n    contents. it is strongly recommended to use acls with the \"block\" keyword\n    instead, resulting in far more flexible and manageable rules.\n\n  - lines are always considered as a whole. it is not possible to reference\n    a header name only or a value only. this is important because of the way\n    headers are written (notably the number of spaces after the colon).\n\n  - the first line is always considered as a header, which makes it possible to\n    rewrite or filter http requests uris or response codes, but in turn makes\n    it harder to distinguish between headers and request line. the regex prefix\n    ^[^\\ \\t]*[\\ \\t] matches any http method followed by a space, and the prefix\n    ^[^ \\t:]*: matches any header name followed by a colon.\n\n  - for performances reasons, the number of characters added to a request or to\n    a response is limited at build time to values between 1 and 4 kb. this\n    should normally be far more than enough for most usages. if it is too short\n    on occasional usages, it is possible to gain some space by removing some\n    useless headers before adding new ones.\n\n  - keywords beginning with \"reqi\" and \"rspi\" are the same as their counterpart\n    without the 'i' letter except that they ignore case when matching patterns.\n\n  - when a request passes through a frontend then a backend, all req* rules\n    from the frontend will be evaluated, then all req* rules from the backend\n    will be evaluated. the reverse path is applied to responses.\n\n  - req* statements are applied after \"block\" statements, so that \"block\" is\n    always the first one, but before \"use_backend\" in order to permit rewriting\n    before switching.\n\n7\\. using acls and fetching samples\n----------------------------------\n\nhaproxy is capable of extracting data from request or response streams, from\nclient or server information, from tables, environmental information etc...\nthe action of extracting such data is called fetching a sample. once retrieved,\nthese samples may be used for various purposes such as a key to a stick-table,\nbut most common usages consist in matching them against predefined constant\ndata called patterns.\n\n7.1\\. acl basics\n---------------\n\nthe use of access control lists (acl) provides a flexible solution to perform\ncontent switching and generally to take decisions based on content extracted\nfrom the request, the response or any environmental status. the principle is\nsimple :\n\n  - extract a data sample from a stream, table or the environment\n  - optionally apply some format conversion to the extracted sample\n  - apply one or multiple pattern matching methods on this sample\n  - perform actions only when a pattern matches the sample\n\nthe actions generally consist in blocking a request, selecting a backend, or\nadding a header.\n\nin order to define a test, the \"acl\" keyword is used. the syntax is :\n\n   acl <aclname> <criterion> [flags] [operator] [<value>] ...\n\nthis creates a new acl <aclname> or completes an existing one with new tests.\nthose tests apply to the portion of request/response specified in <criterion>\nand may be adjusted with optional flags [flags]. some criteria also support\nan operator which may be specified before the set of values. optionally some\nconversion operators may be applied to the sample, and they will be specified\nas a comma-delimited list of keywords just after the first keyword. the values\nare of the type supported by the criterion, and are separated by spaces.\n\nacl names must be formed from upper and lower case letters, digits, '-' (dash),\n'_' (underscore) , '.' (dot) and ':' (colon). acl names are case-sensitive,\nwhich means that \"my_acl\" and \"my_acl\" are two different acls.\n\nthere is no enforced limit to the number of acls. the unused ones do not affect\nperformance, they just consume a small amount of memory.\n\nthe criterion generally is the name of a sample fetch method, or one of its acl\nspecific declinations. the default test method is implied by the output type of\nthis sample fetch method. the acl declinations can describe alternate matching\nmethods of a same sample fetch method. the sample fetch methods are the only\nones supporting a conversion.\n\nsample fetch methods return data which can be of the following types :\n  - boolean\n  - integer (signed or unsigned)\n  - ipv4 or ipv6 address\n  - string\n  - data block\n\nconverters transform any of these data into any of these. for example, some\nconverters might convert a string to a lower-case string while other ones\nwould turn a string to an ipv4 address, or apply a netmask to an ip address.\nthe resulting sample is of the type of the last converter applied to the list,\nwhich defaults to the type of the sample fetch method.\n\neach sample or converter returns data of a specific type, specified with its\nkeyword in this documentation. when an acl is declared using a standard sample\nfetch method, certain types automatically involved a default matching method\nwhich are summarized in the table below :\n\n   +---------------------+-----------------+\n   | sample or converter | default         |\n   |    output type      | matching method |\n   +---------------------+-----------------+\n   | boolean             | bool            |\n   +---------------------+-----------------+\n   | integer             | int             |\n   +---------------------+-----------------+\n   | ip                  | ip              |\n   +---------------------+-----------------+\n   | string              | str             |\n   +---------------------+-----------------+\n   | binary              | none, use \"-m\"  |\n   +---------------------+-----------------+\n\nnote that in order to match a binary samples, it is mandatory to specify a\nmatching method, see below.\n\nthe acl engine can match these types against patterns of the following types :\n  - boolean\n  - integer or integer range\n  - ip address / network\n  - string (exact, substring, suffix, prefix, subdir, domain)\n  - regular expression\n  - hex block\n\nthe following acl flags are currently supported :\n\n   -i : ignore case during matching of all subsequent patterns.\n   -f : load patterns from a file.\n   -m : use a specific pattern matching method\n   -n : forbid the dns resolutions\n   -m : load the file pointed by -f like a map file.\n   -u : force the unique id of the acl\n   -- : force end of flags. useful when a string looks like one of the flags.\n\nthe \"-f\" flag is followed by the name of a file from which all lines will be\nread as individual values. it is even possible to pass multiple \"-f\" arguments\nif the patterns are to be loaded from multiple files. empty lines as well as\nlines beginning with a sharp ('#') will be ignored. all leading spaces and tabs\nwill be stripped. if it is absolutely necessary to insert a valid pattern\nbeginning with a sharp, just prefix it with a space so that it is not taken for\na comment. depending on the data type and match method, haproxy may load the\nlines into a binary tree, allowing very fast lookups. this is true for ipv4 and\nexact string matching. in this case, duplicates will automatically be removed.\n\nthe \"-m\" flag allows an acl to use a map file. if this flag is set, the file is\nparsed as two column file. the first column contains the patterns used by the\nacl, and the second column contain the samples. the sample can be used later by\na map. this can be useful in some rare cases where an acl would just be used to\ncheck for the existence of a pattern in a map before a mapping is applied.\n\nthe \"-u\" flag forces the unique id of the acl. this unique id is used with the\nsocket interface to identify acl and dynamically change its values. note that a\nfile is always identified by its name even if an id is set.\n\nalso, note that the \"-i\" flag applies to subsequent entries and not to entries\nloaded from files preceding it. for instance :\n\n    acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test\n\nin this example, each line of \"exact-ua.lst\" will be exactly matched against\nthe \"user-agent\" header of the request. then each line of \"generic-ua\" will be\ncase-insensitively matched. then the word \"test\" will be insensitively matched\nas well.\n\nthe \"-m\" flag is used to select a specific pattern matching method on the input\nsample. all acl-specific criteria imply a pattern matching method and generally\ndo not need this flag. however, this flag is useful with generic sample fetch\nmethods to describe how they're going to be matched against the patterns. this\nis required for sample fetches which return data type for which there is no\nobvious matching method (eg: string or binary). when \"-m\" is specified and\nfollowed by a pattern matching method name, this method is used instead of the\ndefault one for the criterion. this makes it possible to match contents in ways\nthat were not initially planned, or with sample fetch methods which return a\nstring. the matching method also affects the way the patterns are parsed.\n\nthe \"-n\" flag forbids the dns resolutions. it is used with the load of ip files.\nby default, if the parser cannot parse ip address it considers that the parsed\nstring is maybe a domain name and try dns resolution. the flag \"-n\" disable this\nresolution. it is useful for detecting malformed ip lists. note that if the dns\nserver is not reachable, the haproxy configuration parsing may last many minutes\nwaiting fir the timeout. during this time no error messages are displayed. the\nflag \"-n\" disable this behavior. note also that during the runtime, this\nfunction is disabled for the dynamic acl modifications.\n\nthere are some restrictions however. not all methods can be used with all\nsample fetch methods. also, if \"-m\" is used in conjunction with \"-f\", it must\nbe placed first. the pattern matching method must be one of the following :\n\n  - \"found\" : only check if the requested sample could be found in the stream,\n              but do not compare it against any pattern. it is recommended not\n              to pass any pattern to avoid confusion. this matching method is\n              particularly useful to detect presence of certain contents such\n              as headers, cookies, etc... even if they are empty and without\n              comparing them to anything nor counting them.\n\n  - \"bool\"  : check the value as a boolean. it can only be applied to fetches\n              which return a boolean or integer value, and takes no pattern.\n              value zero or false does not match, all other values do match.\n\n  - \"int\"   : match the value as an integer. it can be used with integer and\n              boolean samples. boolean false is integer 0, true is integer 1.\n\n  - \"ip\"    : match the value as an ipv4 or ipv6 address. it is compatible\n              with ip address samples only, so it is implied and never needed.\n\n  - \"bin\"   : match the contents against an hexadecimal string representing a\n              binary sequence. this may be used with binary or string samples.\n\n  - \"len\"   : match the sample's length as an integer. this may be used with\n              binary or string samples.\n\n  - \"str\"   : exact match : match the contents against a string. this may be\n              used with binary or string samples.\n\n  - \"sub\"   : substring match : check that the contents contain at least one of\n              the provided string patterns. this may be used with binary or\n              string samples.\n\n  - \"reg\"   : regex match : match the contents against a list of regular\n              expressions. this may be used with binary or string samples.\n\n  - \"beg\"   : prefix match : check that the contents begin like the provided\n              string patterns. this may be used with binary or string samples.\n\n  - \"end\"   : suffix match : check that the contents end like the provided\n              string patterns. this may be used with binary or string samples.\n\n  - \"dir\"   : subdir match : check that a slash-delimited portion of the\n              contents exactly matches one of the provided string patterns.\n              this may be used with binary or string samples.\n\n  - \"dom\"   : domain match : check that a dot-delimited portion of the contents\n              exactly match one of the provided string patterns. this may be\n              used with binary or string samples.\n\nfor example, to quickly detect the presence of cookie \"jsessionid\" in an http\nrequest, it is possible to do :\n\n    acl jsess_present cook(jsessionid) -m found\n\nin order to apply a regular expression on the 500 first bytes of data in the\nbuffer, one would use the following acl :\n\n    acl script_tag payload(0,500) -m reg -i <script>\n\non systems where the regex library is much slower when using \"-i\", it is\npossible to convert the sample to lowercase before matching, like this :\n\n    acl script_tag payload(0,500),lower -m reg <script>\n\nall acl-specific criteria imply a default matching method. most often, these\ncriteria are composed by concatenating the name of the original sample fetch\nmethod and the matching method. for example, \"hdr_beg\" applies the \"beg\" match\nto samples retrieved using the \"hdr\" fetch method. since all acl-specific\ncriteria rely on a sample fetch method, it is always possible instead to use\nthe original sample fetch method and the explicit matching method using \"-m\".\n\nif an alternate match is specified using \"-m\" on an acl-specific criterion,\nthe matching method is simply applied to the underlying sample fetch method.\nfor example, all acls below are exact equivalent :\n\n    acl short_form  hdr_beg(host)        www.\n    acl alternate1  hdr_beg(host) -m beg www.\n    acl alternate2  hdr_dom(host) -m beg www.\n    acl alternate3  hdr(host)     -m beg www.\n\nthe table below summarizes the compatibility matrix between sample or converter\ntypes and the pattern types to fetch against. it indicates for each compatible\ncombination the name of the matching method to be used, surrounded with angle\nbrackets \">\" and \"<\" when the method is the default one and will work by\ndefault without \"-m\".\n\n                           +-------------------------------------------------+\n                           |                input sample type                |\n    +----------------------+---------+---------+---------+---------+---------+\n    |     pattern type     | boolean | integer |   ip    | string  | binary  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (presence only) |  found  |  found  |  found  |  found  |  found  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (boolean value) |>  bool <|   bool  |         |   bool  |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (value)      |   int   |>  int  <|   int   |   int   |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (length)     |   len   |   len   |   len   |   len   |   len   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | ip address           |         |         |>   ip  <|    ip   |    ip   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | exact string         |   str   |   str   |   str   |>  str  <|   str   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | suffix               |   end   |   end   |   end   |   end   |   end   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | substring            |   sub   |   sub   |   sub   |   sub   |   sub   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | domain               |   dom   |   dom   |   dom   |   dom   |   dom   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | regex                |   reg   |   reg   |   reg   |   reg   |   reg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | hex block            |         |         |         |   bin   |   bin   |\n    +----------------------+---------+---------+---------+---------+---------+\n\n7.1.1\\. matching booleans\n------------------------\n\nin order to match a boolean, no value is needed and all values are ignored.\nboolean matching is used by default for all fetch methods of type \"boolean\".\nwhen boolean matching is used, the fetched value is returned as-is, which means\nthat a boolean \"true\" will always match and a boolean \"false\" will never match.\n\nboolean matching may also be enforced using \"-m bool\" on fetch methods which\nreturn an integer value. then, integer value 0 is converted to the boolean\n\"false\" and all other values are converted to \"true\".\n\n7.1.2\\. matching integers\n------------------------\n\ninteger matching applies by default to integer fetch methods. it can also be\nenforced on boolean fetches using \"-m int\". in this case, \"false\" is converted\nto the integer 0, and \"true\" is converted to the integer 1.\n\ninteger matching also supports integer ranges and operators. note that integer\nmatching only applies to positive values. a range is a value expressed with a\nlower and an upper bound separated with a colon, both of which may be omitted.\n\nfor instance, \"1024:65535\" is a valid range to represent a range of\nunprivileged ports, and \"1024:\" would also work. \"0:1023\" is a valid\nrepresentation of privileged ports, and \":1023\" would also work.\n\nas a special case, some acl functions support decimal numbers which are in fact\ntwo integers separated by a dot. this is used with some version checks for\ninstance. all integer properties apply to those decimal numbers, including\nranges and operators.\n\nfor an easier usage, comparison operators are also supported. note that using\noperators with ranges does not make much sense and is strongly discouraged.\nsimilarly, it does not make much sense to perform order comparisons with a set\nof values.\n\navailable operators for integer matching are :\n\n  eq : true if the tested value equals at least one value\n  ge : true if the tested value is greater than or equal to at least one value\n  gt : true if the tested value is greater than at least one value\n  le : true if the tested value is less than or equal to at least one value\n  lt : true if the tested value is less than at least one value\n\nfor instance, the following acl matches any negative content-length header :\n\n  acl negative-length hdr_val(content-length) lt 0\n\nthis one matches ssl versions between 3.0 and 3.1 (inclusive) :\n\n  acl sslv3 req_ssl_ver 3:3.1\n\n7.1.3\\. matching strings\n-----------------------\n\nstring matching applies to string or binary fetch methods, and exists in 6\ndifferent forms :\n\n  - exact match     (-m str) : the extracted string must exactly match the\n    patterns ;\n\n  - substring match (-m sub) : the patterns are looked up inside the\n    extracted string, and the acl matches if any of them is found inside ;\n\n  - prefix match    (-m beg) : the patterns are compared with the beginning of\n    the extracted string, and the acl matches if any of them matches.\n\n  - suffix match    (-m end) : the patterns are compared with the end of the\n    extracted string, and the acl matches if any of them matches.\n\n  - subdir match    (-m sub) : the patterns are looked up inside the extracted\n    string, delimited with slashes (\"/\"), and the acl matches if any of them\n    matches.\n\n  - domain match    (-m dom) : the patterns are looked up inside the extracted\n    string, delimited with dots (\".\"), and the acl matches if any of them\n    matches.\n\nstring matching applies to verbatim strings as they are passed, with the\nexception of the backslash (\"\\\") which makes it possible to escape some\ncharacters such as the space. if the \"-i\" flag is passed before the first\nstring, then the matching will be performed ignoring the case. in order\nto match the string \"-i\", either set it second, or pass the \"--\" flag\nbefore the first string. same applies of course to match the string \"--\".\n\n7.1.4\\. matching regular expressions (regexes)\n---------------------------------------------\n\njust like with string matching, regex matching applies to verbatim strings as\nthey are passed, with the exception of the backslash (\"\\\") which makes it\npossible to escape some characters such as the space. if the \"-i\" flag is\npassed before the first regex, then the matching will be performed ignoring\nthe case. in order to match the string \"-i\", either set it second, or pass\nthe \"--\" flag before the first string. same principle applies of course to\nmatch the string \"--\".\n\n7.1.5\\. matching arbitrary data blocks\n-------------------------------------\n\nit is possible to match some extracted samples against a binary block which may\nnot safely be represented as a string. for this, the patterns must be passed as\na series of hexadecimal digits in an even number, when the match method is set\nto binary. each sequence of two digits will represent a byte. the hexadecimal\ndigits may be used upper or lower case.\n\nexample :\n    # match \"hello\\n\" in the input stream (\\x48 \\x65 \\x6c \\x6c \\x6f \\x0a)\n    acl hello payload(0,6) -m bin 48656c6c6f0a\n\n7.1.6\\. matching ipv4 and ipv6 addresses\n---------------------------------------\n\nipv4 addresses values can be specified either as plain addresses or with a\nnetmask appended, in which case the ipv4 address matches whenever it is\nwithin the network. plain addresses may also be replaced with a resolvable\nhost name, but this practice is generally discouraged as it makes it more\ndifficult to read and debug configurations. if hostnames are used, you should\nat least ensure that they are present in /etc/hosts so that the configuration\ndoes not depend on any random dns match at the moment the configuration is\nparsed.\n\nipv6 may be entered in their usual form, with or without a netmask appended.\nonly bit counts are accepted for ipv6 netmasks. in order to avoid any risk of\ntrouble with randomly resolved ip addresses, host names are never allowed in\nipv6 patterns.\n\nhaproxy is also able to match ipv4 addresses with ipv6 addresses in the\nfollowing situations :\n  - tested address is ipv4, pattern address is ipv4, the match applies\n    in ipv4 using the supplied mask if any.\n  - tested address is ipv6, pattern address is ipv6, the match applies\n    in ipv6 using the supplied mask if any.\n  - tested address is ipv6, pattern address is ipv4, the match applies in ipv4\n    using the pattern's mask if the ipv6 address matches with 2002:ipv4::,\n    ::ipv4 or ::ffff:ipv4, otherwise it fails.\n  - tested address is ipv4, pattern address is ipv6, the ipv4 address is first\n    converted to ipv6 by prefixing ::ffff: in front of it, then the match is\n    applied in ipv6 using the supplied ipv6 mask.\n\n7.2\\. using acls to form conditions\n----------------------------------\n\nsome actions are only performed upon a valid condition. a condition is a\ncombination of acls with operators. 3 operators are supported :\n\n  - and (implicit)\n  - or  (explicit with the \"or\" keyword or the \"||\" operator)\n  - negation with the exclamation mark (\"!\")\n\na condition is formed as a disjunctive form:\n\n   [!]acl1 [!]acl2 ... [!]acln  { or [!]acl1 [!]acl2 ... [!]acln } ...\n\nsuch conditions are generally used after an \"if\" or \"unless\" statement,\nindicating when the condition will trigger the action.\n\nfor instance, to block http requests to the \"*\" url with methods other than\n\"options\", as well as post requests without content-length, and get or head\nrequests with a content-length greater than 0, and finally every request which\nis not either get/head/post/options !\n\n   acl missing_cl hdr_cnt(content-length) eq 0\n   block if http_url_star !meth_options || meth_post missing_cl\n   block if meth_get http_content\n   block unless meth_get or meth_post or meth_options\n\nto select a different backend for requests to static contents on the \"www\" site\nand to every request on the \"img\", \"video\", \"download\" and \"ftp\" hosts :\n\n   acl url_static  path_beg         /static /images /img /css\n   acl url_static  path_end         .gif .png .jpg .css .js\n   acl host_www    hdr_beg(host) -i www\n   acl host_static hdr_beg(host) -i img. video. download. ftp.\n\n   # now use backend \"static\" for all static-only hosts, and for static urls\n   # of host \"www\". use backend \"www\" for the rest.\n   use_backend static if host_static or host_www url_static\n   use_backend www    if host_www\n\nit is also possible to form rules using \"anonymous acls\". those are unnamed acl\nexpressions that are built on the fly without needing to be declared. they must\nbe enclosed between braces, with a space before and after each brace (because\nthe braces must be seen as independent words). example :\n\n   the following rule :\n\n       acl missing_cl hdr_cnt(content-length) eq 0\n       block if meth_post missing_cl\n\n   can also be written that way :\n\n       block if meth_post { hdr_cnt(content-length) eq 0 }\n\nit is generally not recommended to use this construct because it's a lot easier\nto leave errors in the configuration when written that way. however, for very\nsimple rules matching only one source ip address for instance, it can make more\nsense to use them than to declare acls with random names. another example of\ngood use is the following :\n\n   with named acls :\n\n        acl site_dead nbsrv(dynamic) lt 2\n        acl site_dead nbsrv(static)  lt 2\n        monitor fail  if site_dead\n\n   with anonymous acls :\n\n        monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }\n\nsee section 4.2 for detailed help on the \"block\" and \"use_backend\" keywords.\n\n7.3\\. fetching samples\n---------------------\n\nhistorically, sample fetch methods were only used to retrieve data to match\nagainst patterns using acls. with the arrival of stick-tables, a new class of\nsample fetch methods was created, most often sharing the same syntax as their\nacl counterpart. these sample fetch methods are also known as \"fetches\". as\nof now, acls and fetches have converged. all acl fetch methods have been made\navailable as fetch methods, and acls may use any sample fetch method as well.\n\nthis section details all available sample fetch methods and their output type.\nsome sample fetch methods have deprecated aliases that are used to maintain\ncompatibility with existing configurations. they are then explicitly marked as\ndeprecated and should not be used in new setups.\n\nthe acl derivatives are also indicated when available, with their respective\nmatching methods. these ones all have a well defined default pattern matching\nmethod, so it is never necessary (though allowed) to pass the \"-m\" option to\nindicate how the sample will be matched using acls.\n\nas indicated in the sample type versus matching compatibility matrix above,\nwhen using a generic sample fetch method in an acl, the \"-m\" option is\nmandatory unless the sample type is one of boolean, integer, ipv4 or ipv6\\. when\nthe same keyword exists as an acl keyword and as a standard fetch method, the\nacl engine will automatically pick the acl-only one by default.\n\nsome of these keywords support one or multiple mandatory arguments, and one or\nmultiple optional arguments. these arguments are strongly typed and are checked\nwhen the configuration is parsed so that there is no risk of running with an\nincorrect argument (eg: an unresolved backend name). fetch function arguments\nare passed between parenthesis and are delimited by commas.  when an argument\nis optional, it will be indicated below between square brackets ('[ ]'). when\nall arguments are optional, the parenthesis may be omitted.\n\nthus, the syntax of a standard sample fetch method is one of the following :\n   - name\n   - name(arg1)\n   - name(arg1,arg2)\n\n7.3.1\\. converters\n-----------------\n\nsample fetch methods may be combined with transformations to be applied on top\nof the fetched sample (also called \"converters\"). these combinations form what\nis called \"sample expressions\" and the result is a \"sample\". initially this\nwas only supported by \"stick on\" and \"stick store-request\" directives but this\nhas now be extended to all places where samples may be used (acls, log-format,\nunique-id-format, add-header, ...).\n\nthese transformations are enumerated as a series of specific keywords after the\nsample fetch method. these keywords may equally be appended immediately after\nthe fetch keyword's argument, delimited by a comma. these keywords can also\nsupport some arguments (eg: a netmask) which must be passed in parenthesis.\n\na certain category of converters are bitwise and arithmetic operators which\nsupport performing basic operations on integers. some bitwise operations are\nsupported (and, or, xor, cpl) and some arithmetic operations are supported\n(add, sub, mul, div, mod, neg). some comparators are provided (odd, even, not,\nbool) which make it possible to report a match without having to write an acl.\n\nthe currently available list of transformation keywords include :\n\nadd(<value>)\n  adds <value> to the input value of type signed integer, and returns the\n  result as a signed integer. <value> can be a numeric value or a variable\n  name. the name of the variable starts by an indication about its scope. the\n  allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nand(<value>)\n  performs a bitwise \"and\" between <value> and the input value of type signed\n  integer, and returns the result as an signed integer. <value> can be a\n  numeric value or a variable name. the name of the variable starts by an\n  indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nbase64\n  converts a binary input sample to a base64 string. it is used to log or\n  transfer binary content in a way that can be reliably transferred (eg:\n  an ssl id can be copied in a header).\n\nbool\n  returns a boolean true if the input value of type signed integer is\n  non-null, otherwise returns false. used in conjunction with and(), it can be\n  used to report true/false for bit testing on input values (eg: verify the\n  presence of a flag).\n\nbytes(<offset>[,<length>])\n  extracts some bytes from an input binary sample. the result is a binary\n  sample starting at an offset (in bytes) of the original sample and\n  optionnaly truncated at the given length.\n\ncpl\n  takes the input value of type signed integer, applies a ones-complement\n  (flips all bits) and returns the result as an signed integer.\n\ncrc32([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the crc32\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  provided for compatibility with other software which want a crc32 to be\n  computed on some input keys, so it follows the most common implementation as\n  found in ethernet, gzip, png, etc... it is slower than the other algorithms\n  but may provide a better or at least less predictable distribution. it must\n  not be used for security purposes as a 32-bit hash is trivial to break. see\n  also \"djb2\", \"sdbm\", \"wt6\" and the \"hash-type\" directive.\n\nda-csv(<prop>[,<prop>*])\n  asks the deviceatlas converter to identify the user agent string passed on\n  input, and to emit a string made of the concatenation of the properties\n  enumerated in argument, delimited by the separator defined by the global\n  keyword \"deviceatlas-property-separator\", or by default the pipe character\n  ('|'). there's a limit of 5 different properties imposed by the haproxy\n  configuration language.\n\n  example:\n    frontend www\n\tbind *:8881\n\tdefault_backend servers\n\thttp-request set-header x-deviceatlas-data %[req.fhdr(user-agent),da-csv(primaryhardwaretype,osname,osversion,browsername,browserversion)]\n\ndebug\n  this converter is used as debug tool. it dumps on screen the content and the\n  type of the input sample. the sample is returned as is on its output. this\n  converter only exists when haproxy was built with debugging enabled.\n\ndiv(<value>)\n  divides the input value of type signed integer by <value>, and returns the\n  result as an signed integer. if <value> is null, the largest unsigned\n  integer is returned (typically 2^63-1). <value> can be a numeric value or a\n  variable name. the name of the variable starts by an indication about it\n  scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\ndjb2([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the djb2\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"sdbm\", \"wt6\" and the\n  \"hash-type\" directive.\n\neven\n  returns a boolean true if the input value of type signed integer is even\n  otherwise returns false. it is functionally equivalent to \"not,and(1),bool\".\n\nfield(<index>,<delimiters>)\n  extracts the substring at the given index considering given delimiters from\n  an input string. indexes start at 1 and delimiters are a string formatted\n  list of chars.\n\nhex\n  converts a binary input sample to an hex string containing two hex digits per\n  input byte. it is used to log or transfer hex dumps of some binary input data\n  in a way that can be reliably transferred (eg: an ssl id can be copied in a\n  header).\n\nhttp_date([<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in a format suitable for use in http header fields. if\n  an offset value is specified, then it is a number of seconds that is added to\n  the date before the conversion is operated. this is particularly useful to\n  emit date header fields, expires values in responses when combined with a\n  positive offset, or last-modified values when the offset is negative.\n\nin_table(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, a boolean false\n  is returned. otherwise a boolean true is returned. this can be used to verify\n  the presence of a certain key in a table tracking some elements (eg: whether\n  or not a source ip address or an authorization header was already seen).\n\nipmask(<mask>)\n  apply a mask to an ipv4 address, and use the result for lookups and storage.\n  this can be used to make all hosts within a certain mask to share the same\n  table entries and as such use the same server. the mask can be passed in\n  dotted form (eg: 255.255.255.0) or in cidr form (eg: 24).\n\njson([<input-code>])\n  escapes the input string and produces an ascii ouput string ready to use as a\n  json string. the converter tries to decode the input string according to the\n  <input-code> parameter. it can be \"ascii\", \"utf8\", \"utf8s\", \"utf8\"\" or\n  \"utf8ps\". the \"ascii\" decoder never fails. the \"utf8\" decoder detects 3 types\n  of errors:\n   - bad utf-8 sequence (lone continuation byte, bad number of continuation\n     bytes, ...)\n   - invalid range (the decoded value is within a utf-8 prohibited range),\n   - code overlong (the value is encoded with more bytes than necessary).\n\n  the utf-8 json encoding can produce a \"too long value\" error when the utf-8\n  character is greater than 0xffff because the json string escape specification\n  only authorizes 4 hex digits for the value encoding. the utf-8 decoder exists\n  in 4 variants designated by a combination of two suffix letters : \"p\" for\n  \"permissive\" and \"s\" for \"silently ignore\". the behaviors of the decoders\n  are :\n   - \"ascii\"  : never fails ;\n   - \"utf8\"   : fails on any detected errors ;\n   - \"utf8s\"  : never fails, but removes characters corresponding to errors ;\n   - \"utf8p\"  : accepts and fixes the overlong errors, but fails on any other\n                error ;\n   - \"utf8ps\" : never fails, accepts and fixes the overlong errors, but removes\n                characters corresponding to the other errors.\n\n  this converter is particularly useful for building properly escaped json for\n  logging to servers which consume json-formated traffic logs.\n\n  example:\n     capture request header user-agent len 150\n     capture request header host len 15\n     log-format {\"ip\":\"%[src]\",\"user-agent\":\"%[capture.req.hdr(1),json]\"}\n\n  input request from client 127.0.0.1:\n     get / http/1.0\n     user-agent: very \"ugly\" ua 1/2\n\n  output log:\n     {\"ip\":\"127.0.0.1\",\"user-agent\":\"very \\\"ugly\\\" ua 1\\/2\"}\n\nlanguage(<value>[,<default>])\n  returns the value with the highest q-factor from a list as extracted from the\n  \"accept-language\" header using \"req.fhdr\". values with no q-factor have a\n  q-factor of 1\\. values with a q-factor of 0 are dropped. only values which\n  belong to the list of semi-colon delimited <values> will be considered. the\n  argument <value> syntax is \"lang[;lang[;lang[;...]]]\". if no value matches the\n  given list and a default value is provided, it is returned. note that language\n  names may have a variant after a dash ('-'). if this variant is present in the\n  list, it will be matched, but if it is not, only the base language is checked.\n  the match is case-sensitive, and the output string is always one of those\n  provided in arguments.  the ordering of arguments is meaningless, only the\n  ordering of the values in the request counts, as the first value among\n  multiple sharing the same q-factor is used.\n\n  example :\n\n    # this configuration switches to the backend matching a\n    # given language based on the request :\n\n    acl es req.fhdr(accept-language),language(es;fr;en) -m str es\n    acl fr req.fhdr(accept-language),language(es;fr;en) -m str fr\n    acl en req.fhdr(accept-language),language(es;fr;en) -m str en\n    use_backend spanish if es\n    use_backend french  if fr\n    use_backend english if en\n    default_backend choose_your_language\n\nlower\n  convert a string sample to lower case. this can only be placed after a string\n  sample fetch function or after a transformation keyword returning a string\n  type. the result is of type string.\n\nltime(<format>[,<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in local time using a format defined by the <format>\n  string using strftime(3). the purpose is to allow any date format to be used\n  in logs. an optional <offset> in seconds may be applied to the input date\n  (positive or negative). see the strftime() man page for the format supported\n  by your operating system. see also the utime converter.\n\n  example :\n\n      # emit two colons, one with the local time and another with ip:port\n      # eg:  20140710162350 127.0.0.1:57325\n      log-format %[date,ltime(%y%m%d%h%m%s)]\\ %ci:%cp\n\nmap(<map_file>[,<default_value>])\nmap_<match_type>(<map_file>[,<default_value>])\nmap_<match_type>_<output_type>(<map_file>[,<default_value>])\n  search the input value from <map_file> using the <match_type> matching method,\n  and return the associated value converted to the type <output_type>. if the\n  input value cannot be found in the <map_file>, the converter returns the\n  <default_value>. if the <default_value> is not set, the converter fails and\n  acts as if no input value could be fetched. if the <match_type> is not set, it\n  defaults to \"str\". likewise, if the <output_type> is not set, it defaults to\n  \"str\". for convenience, the \"map\" keyword is an alias for \"map_str\" and maps a\n  string to another string.\n\n  it is important to avoid overlapping between the keys : ip addresses and\n  strings are stored in trees, so the first of the finest match will be used.\n  other keys are stored in lists, so the first matching occurrence will be used.\n\n  the following array contains the list of all map functions avalaible sorted by\n  input type, match type and output type.\n\n  input type | match method | output type str | output type int | output type ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | str          | map_str         | map_str_int     | map_str_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | beg          | map_beg         | map_beg_int     | map_end_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | sub          | map_sub         | map_sub_int     | map_sub_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | dir          | map_dir         | map_dir_int     | map_dir_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | dom          | map_dom         | map_dom_int     | map_dom_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | end          | map_end         | map_end_int     | map_end_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | reg          | map_reg         | map_reg_int     | map_reg_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    int      | int          | map_int         | map_int_int     | map_int_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    ip       | ip           | map_ip          | map_ip_int      | map_ip_ip\n  -----------+--------------+-----------------+-----------------+---------------\n\n  the file contains one key + value per line. lines which start with '#' are\n  ignored, just like empty lines. leading tabs and spaces are stripped. the key\n  is then the first \"word\" (series of non-space/tabs characters), and the value\n  is what follows this series of space/tab till the end of the line excluding\n  trailing spaces/tabs.\n\n  example :\n\n     # this is a comment and is ignored\n        2.22.246.0/23    united kingdom      \\n\n     <-><-----------><--><------------><---->\n      |       |       |         |        `- trailing spaces ignored\n      |       |       |         `---------- value\n      |       |       `-------------------- middle spaces ignored\n      |       `---------------------------- key\n      `------------------------------------ leading spaces ignored\n\nmod(<value>)\n  divides the input value of type signed integer by <value>, and returns the\n  remainder as an signed integer. if <value> is null, then zero is returned.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nmul(<value>)\n  multiplies the input value of type signed integer by <value>, and returns\n  the product as an signed integer. in case of overflow, the largest possible\n  value for the sign is returned so that the operation doesn't wrap around.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nneg\n  takes the input value of type signed integer, computes the opposite value,\n  and returns the remainder as an signed integer. 0 is identity. this operator\n  is provided for reversed subtracts : in order to subtract the input from a\n  constant, simply perform a \"neg,add(value)\".\n\nnot\n  returns a boolean false if the input value of type signed integer is\n  non-null, otherwise returns true. used in conjunction with and(), it can be\n  used to report true/false for bit testing on input values (eg: verify the\n  absence of a flag).\n\nodd\n  returns a boolean true if the input value of type signed integer is odd\n  otherwise returns false. it is functionally equivalent to \"and(1),bool\".\n\nor(<value>)\n  performs a bitwise \"or\" between <value> and the input value of type signed\n  integer, and returns the result as an signed integer. <value> can be a\n  numeric value or a variable name. the name of the variable starts by an\n  indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nregsub(<regex>,<subst>[,<flags>])\n  applies a regex-based substitution to the input string. it does the same\n  operation as the well-known \"sed\" utility with \"s/<regex>/<subst>/\". by\n  default it will replace in the input string the first occurrence of the\n  largest part matching the regular expression <regex> with the substitution\n  string <subst>. it is possible to replace all occurrences instead by adding\n  the flag \"g\" in the third argument <flags>. it is also possible to make the\n  regex case insensitive by adding the flag \"i\" in <flags>. since <flags> is a\n  string, it is made up from the concatenation of all desired flags. thus if\n  both \"i\" and \"g\" are desired, using \"gi\" or \"ig\" will have the same effect.\n  it is important to note that due to the current limitations of the\n  configuration parser, some characters such as closing parenthesis or comma\n  are not possible to use in the arguments. the first use of this converter is\n  to replace certain characters or sequence of characters with other ones.\n\n  example :\n\n     # de-duplicate \"/\" in header \"x-path\".\n     # input:  x-path: /////a///b/c/xzxyz/\n     # output: x-path: /a/b/c/xzxyz/\n     http-request set-header x-path %[hdr(x-path),regsub(/+,/,g)]\n\ncapture-req(<id>)\n  capture the string entry in the request slot <id> and returns the entry as\n  is. if the slot doesn't exist, the capture fails silently.\n\n  see also: \"declare capture\", \"http-request capture\",\n            \"http-response capture\", \"req.hdr.capture\" and\n            \"res.hdr.capture\" (sample fetches).\n\ncapture-res(<id>)\n  capture the string entry in the response slot <id> and returns the entry as\n  is. if the slot doesn't exist, the capture fails silently.\n\n  see also: \"declare capture\", \"http-request capture\",\n            \"http-response capture\", \"req.hdr.capture\" and\n            \"res.hdr.capture\" (sample fetches).\n\nsdbm([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the sdbm\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"djb2\", \"wt6\" and the\n  \"hash-type\" directive.\n\nset-var(<var name>)\n  sets a variable with the input content and return the content on the output as\n  is. the variable keep the value and the associated input type. the name of the\n  variable starts by an indication about it scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nsub(<value>)\n  subtracts <value> from the input value of type signed integer, and returns\n  the result as an signed integer. note: in order to subtract the input from\n  a constant, simply perform a \"neg,add(value)\". <value> can be a numeric value\n  or a variable name. the name of the variable starts by an indication about its\n  scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\ntable_bytes_in_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average client-to-server\n  bytes rate associated with the input sample in the designated table, measured\n  in amount of bytes over the period configured in the table. see also the\n  sc_bytes_in_rate sample fetch keyword.\n\ntable_bytes_out_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average server-to-client\n  bytes rate associated with the input sample in the designated table, measured\n  in amount of bytes over the period configured in the table. see also the\n  sc_bytes_out_rate sample fetch keyword.\n\ntable_conn_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of incoming\n  connections associated with the input sample in the designated table. see\n  also the sc_conn_cnt sample fetch keyword.\n\ntable_conn_cur(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current amount of concurrent\n  tracked connections associated with the input sample in the designated table.\n  see also the sc_conn_cur sample fetch keyword.\n\ntable_conn_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average incoming connection\n  rate associated with the input sample in the designated table. see also the\n  sc_conn_rate sample fetch keyword.\n\ntable_gpc0(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current value of the first\n  general purpose counter associated with the input sample in the designated\n  table. see also the sc_get_gpc0 sample fetch keyword.\n\ntable_gpc0_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the frequency which the gpc0\n  counter was incremented over the configured period in the table, associated\n  with the input sample in the designated table. see also the sc_get_gpc0_rate\n  sample fetch keyword.\n\ntable_http_err_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of http\n  errors associated with the input sample in the designated table. see also the\n  sc_http_err_cnt sample fetch keyword.\n\ntable_http_err_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the average rate of http errors associated with the\n  input sample in the designated table, measured in amount of errors over the\n  period configured in the table. see also the sc_http_err_rate sample fetch\n  keyword.\n\ntable_http_req_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of http\n  requests associated with the input sample in the designated table. see also\n  the sc_http_req_cnt sample fetch keyword.\n\ntable_http_req_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the average rate of http requests associated with the\n  input sample in the designated table, measured in amount of requests over the\n  period configured in the table. see also the sc_http_req_rate sample fetch\n  keyword.\n\ntable_kbytes_in(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of client-\n  to-server data associated with the input sample in the designated table,\n  measured in kilobytes. the test is currently performed on 32-bit integers,\n  which limits values to 4 terabytes. see also the sc_kbytes_in sample fetch\n  keyword.\n\ntable_kbytes_out(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of server-\n  to-client data associated with the input sample in the designated table,\n  measured in kilobytes. the test is currently performed on 32-bit integers,\n  which limits values to 4 terabytes. see also the sc_kbytes_out sample fetch\n  keyword.\n\ntable_server_id(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the server id associated with\n  the input sample in the designated table. a server id is associated to a\n  sample by a \"stick\" rule when a connection to a server succeeds. a server id\n  zero means that no server is associated with this key.\n\ntable_sess_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of incoming\n  sessions associated with the input sample in the designated table. note that\n  a session here refers to an incoming connection being accepted by the\n  \"tcp-request connection\" rulesets. see also the sc_sess_cnt sample fetch\n  keyword.\n\ntable_sess_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average incoming session\n  rate associated with the input sample in the designated table. note that a\n  session here refers to an incoming connection being accepted by the\n  \"tcp-request connection\" rulesets. see also the sc_sess_rate sample fetch\n  keyword.\n\ntable_trackers(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current amount of concurrent\n  connections tracking the same key as the input sample in the designated\n  table. it differs from table_conn_cur in that it does not rely on any stored\n  information but on the table's reference count (the \"use\" value which is\n  returned by \"show table\" on the cli). this may sometimes be more suited for\n  layer7 tracking. it can be used to tell a server how many concurrent\n  connections there are from a given address for example. see also the\n  sc_trackers sample fetch keyword.\n\nupper\n  convert a string sample to upper case. this can only be placed after a string\n  sample fetch function or after a transformation keyword returning a string\n  type. the result is of type string.\n\nurl_dec\n  takes an url-encoded string provided as input and returns the decoded\n  version as output. the input and the output are of type string.\n\nutime(<format>[,<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in utc time using a format defined by the <format>\n  string using strftime(3). the purpose is to allow any date format to be used\n  in logs. an optional <offset> in seconds may be applied to the input date\n  (positive or negative). see the strftime() man page for the format supported\n  by your operating system. see also the ltime converter.\n\n  example :\n\n      # emit two colons, one with the utc time and another with ip:port\n      # eg:  20140710162350 127.0.0.1:57325\n      log-format %[date,utime(%y%m%d%h%m%s)]\\ %ci:%cp\n\nword(<index>,<delimiters>)\n  extracts the nth word considering given delimiters from an input string.\n  indexes start at 1 and delimiters are a string formatted list of chars.\n\nwt6([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the wt6\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"djb2\", \"sdbm\", and the\n  \"hash-type\" directive.\n\nxor(<value>)\n  performs a bitwise \"xor\" (exclusive or) between <value> and the input value\n  of type signed integer, and returns the result as an signed integer.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n7.3.2\\. fetching samples from internal states\n--------------------------------------------\n\na first set of sample fetch methods applies to internal information which does\nnot even relate to any client information. these ones are sometimes used with\n\"monitor-fail\" directives to report an internal status to external watchers.\nthe sample fetch methods described in this section are usable anywhere.\n\nalways_false : boolean\n  always returns the boolean \"false\" value. it may be used with acls as a\n  temporary replacement for another one when adjusting configurations.\n\nalways_true : boolean\n  always returns the boolean \"true\" value. it may be used with acls as a\n  temporary replacement for another one when adjusting configurations.\n\navg_queue([<backend>]) : integer\n  returns the total number of queued connections of the designated backend\n  divided by the number of active servers. the current backend is used if no\n  backend is specified. this is very similar to \"queue\" except that the size of\n  the farm is considered, in order to give a more accurate measurement of the\n  time it may take for a new connection to be processed. the main usage is with\n  acl to return a sorry page to new users when it becomes certain they will get\n  a degraded service, or to pass to the backend servers in a header so that\n  they decide to work in degraded mode or to disable some functions to speed up\n  the processing a bit. note that in the event there would not be any active\n  server anymore, twice the number of queued connections would be considered as\n  the measured value. this is a fair estimate, as we expect one server to get\n  back soon anyway, but we still prefer to send new traffic to another backend\n  if in better shape. see also the \"queue\", \"be_conn\", and \"be_sess_rate\"\n  sample fetches.\n\nbe_conn([<backend>]) : integer\n  applies to the number of currently established connections on the backend,\n  possibly including the connection being evaluated. if no backend name is\n  specified, the current one is used. but it is also possible to check another\n  backend. it can be used to use a specific farm when the nominal one is full.\n  see also the \"fe_conn\", \"queue\" and \"be_sess_rate\" criteria.\n\nbe_sess_rate([<backend>]) : integer\n  returns an integer value corresponding to the sessions creation rate on the\n  backend, in number of new sessions per second. this is used with acls to\n  switch to an alternate backend when an expensive or fragile one reaches too\n  high a session rate, or to limit abuse of service (eg. prevent sucking of an\n  online dictionary). it can also be useful to add this element to logs using a\n  log-format directive.\n\n  example :\n        # redirect to an error page if the dictionary is requested too often\n        backend dynamic\n            mode http\n            acl being_scanned be_sess_rate gt 100\n            redirect location /denied.html if being_scanned\n\nbin(<hexa>) : bin\n  returns a binary chain. the input is the hexadecimal representation\n  of the string.\n\nbool(<bool>) : bool\n  returns a boolean value. <bool> can be 'true', 'false', '1' or '0'.\n  'false' and '0' are the same. 'true' and '1' are the same.\n\nconnslots([<backend>]) : integer\n  returns an integer value corresponding to the number of connection slots\n  still available in the backend, by totaling the maximum amount of\n  connections on all servers and the maximum queue size. this is probably only\n  used with acls.\n\n  the basic idea here is to be able to measure the number of connection \"slots\"\n  still available (connection + queue), so that anything beyond that (intended\n  usage; see \"use_backend\" keyword) can be redirected to a different backend.\n\n  'connslots' = number of available server connection slots, + number of\n  available server queue slots.\n\n  note that while \"fe_conn\" may be used, \"connslots\" comes in especially\n  useful when you have a case of traffic going to one single ip, splitting into\n  multiple backends (perhaps using acls to do name-based load balancing) and\n  you want to be able to differentiate between different backends, and their\n  available \"connslots\".  also, whereas \"nbsrv\" only measures servers that are\n  actually *down*, this fetch is more fine-grained and looks into the number of\n  available connection slots as well. see also \"queue\" and \"avg_queue\".\n\n  other caveats and notes: at this point in time, the code does not take care\n  of dynamic connections. also, if any of the server maxconn, or maxqueue is 0,\n  then this fetch clearly does not make sense, in which case the value returned\n  will be -1.\n\ndate([<offset>]) : integer\n  returns the current date as the epoch (number of seconds since 01/01/1970).\n  if an offset value is specified, then it is a number of seconds that is added\n  to the current date before returning the value. this is particularly useful\n  to compute relative dates, as both positive and negative offsets are allowed.\n  it is useful combined with the http_date converter.\n\n  example :\n\n     # set an expires header to now+1 hour in every response\n     http-response set-header expires %[date(3600),http_date]\n\nenv(<name>) : string\n  returns a string containing the value of environment variable <name>. as a\n  reminder, environment variables are per-process and are sampled when the\n  process starts. this can be useful to pass some information to a next hop\n  server, or with acls to take specific action when the process is started a\n  certain way.\n\n  examples :\n      # pass the via header to next hop with the local hostname in it\n      http-request add-header via 1.1\\ %[env(hostname)]\n\n      # reject cookie-less requests when the stop environment variable is set\n      http-request deny if !{ cook(sessionid) -m found } { env(stop) -m found }\n\nfe_conn([<frontend>]) : integer\n  returns the number of currently established connections on the frontend,\n  possibly including the connection being evaluated. if no frontend name is\n  specified, the current one is used. but it is also possible to check another\n  frontend. it can be used to return a sorry page before hard-blocking, or to\n  use a specific backend to drain new requests when the farm is considered\n  full.  this is mostly used with acls but can also be used to pass some\n  statistics to servers in http headers. see also the \"dst_conn\", \"be_conn\",\n  \"fe_sess_rate\" fetches.\n\nfe_sess_rate([<frontend>]) : integer\n  returns an integer value corresponding to the sessions creation rate on the\n  frontend, in number of new sessions per second. this is used with acls to\n  limit the incoming session rate to an acceptable range in order to prevent\n  abuse of service at the earliest moment, for example when combined with other\n  layer 4 acls in order to force the clients to wait a bit for the rate to go\n  down below the limit. it can also be useful to add this element to logs using\n  a log-format directive. see also the \"rate-limit sessions\" directive for use\n  in frontends.\n\n  example :\n        # this frontend limits incoming mails to 10/s with a max of 100\n        # concurrent connections. we accept any connection below 10/s, and\n        # force excess clients to wait for 100 ms. since clients are limited to\n        # 100 max, there cannot be more than 10 incoming mails per second.\n        frontend mail\n            bind :25\n            mode tcp\n            maxconn 100\n            acl too_fast fe_sess_rate ge 10\n            tcp-request inspect-delay 100ms\n            tcp-request content accept if ! too_fast\n            tcp-request content accept if wait_end\n\nint(<integer>) : signed integer\n  returns a signed integer.\n\nipv4(<ipv4>) : ipv4\n  returns an ipv4.\n\nipv6(<ipv6>) : ipv6\n  returns an ipv6.\n\nmeth(<method>) : method\n  returns a method.\n\nnbproc : integer\n  returns an integer value corresponding to the number of processes that were\n  started (it equals the global \"nbproc\" setting). this is useful for logging\n  and debugging purposes.\n\nnbsrv([<backend>]) : integer\n  returns an integer value corresponding to the number of usable servers of\n  either the current backend or the named backend. this is mostly used with\n  acls but can also be useful when added to logs. this is normally used to\n  switch to an alternate backend when the number of servers is too low to\n  to handle some load. it is useful to report a failure when combined with\n  \"monitor fail\".\n\nproc : integer\n  returns an integer value corresponding to the position of the process calling\n  the function, between 1 and global.nbproc. this is useful for logging and\n  debugging purposes.\n\nqueue([<backend>]) : integer\n  returns the total number of queued connections of the designated backend,\n  including all the connections in server queues. if no backend name is\n  specified, the current one is used, but it is also possible to check another\n  one. this is useful with acls or to pass statistics to backend servers. this\n  can be used to take actions when queuing goes above a known level, generally\n  indicating a surge of traffic or a massive slowdown on the servers. one\n  possible action could be to reject new users but still accept old ones. see\n  also the \"avg_queue\", \"be_conn\", and \"be_sess_rate\" fetches.\n\nrand([<range>]) : integer\n  returns a random integer value within a range of <range> possible values,\n  starting at zero. if the range is not specified, it defaults to 2^32, which\n  gives numbers between 0 and 4294967295\\. it can be useful to pass some values\n  needed to take some routing decisions for example, or just for debugging\n  purposes. this random must not be used for security purposes.\n\nsrv_conn([<backend>/]<server>) : integer\n  returns an integer value corresponding to the number of currently established\n  connections on the designated server, possibly including the connection being\n  evaluated. if <backend> is omitted, then the server is looked up in the\n  current backend. it can be used to use a specific farm when one server is\n  full, or to inform the server about our view of the number of active\n  connections with it. see also the \"fe_conn\", \"be_conn\" and \"queue\" fetch\n  methods.\n\nsrv_is_up([<backend>/]<server>) : boolean\n  returns true when the designated server is up, and false when it is either\n  down or in maintenance mode. if <backend> is omitted, then the server is\n  looked up in the current backend. it is mainly used to take action based on\n  an external status reported via a health check (eg: a geographical site's\n  availability). another possible use which is more of a hack consists in\n  using dummy servers as boolean variables that can be enabled or disabled from\n  the cli, so that rules depending on those acls can be tweaked in realtime.\n\nsrv_sess_rate([<backend>/]<server>) : integer\n  returns an integer corresponding to the sessions creation rate on the\n  designated server, in number of new sessions per second. if <backend> is\n  omitted, then the server is looked up in the current backend. this is mostly\n  used with acls but can make sense with logs too. this is used to switch to an\n  alternate backend when an expensive or fragile one reaches too high a session\n  rate, or to limit abuse of service (eg. prevent latent requests from\n  overloading servers).\n\n  example :\n        # redirect to a separate back\n        acl srv1_full srv_sess_rate(be1/srv1) gt 50\n        acl srv2_full srv_sess_rate(be1/srv2) gt 50\n        use_backend be2 if srv1_full or srv2_full\n\nstopping : boolean\n  returns true if the process calling the function is currently stopping. this\n  can be useful for logging, or for relaxing certain checks or helping close\n  certain connections upon graceful shutdown.\n\nstr(<string>) : string\n  returns a string.\n\ntable_avl([<table>]) : integer\n  returns the total number of available entries in the current proxy's\n  stick-table or in the designated stick-table. see also table_cnt.\n\ntable_cnt([<table>]) : integer\n  returns the total number of entries currently in use in the current proxy's\n  stick-table or in the designated stick-table. see also src_conn_cnt and\n  table_avl for other entry counting methods.\n\nvar(<var-name>) : undefined\n  returns a variable with the stored type. if the variable is not set, the\n  sample fetch fails. the name of the variable starts by an indication about its\n  scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n7.3.3\\. fetching samples at layer 4\n----------------------------------\n\nthe layer 4 usually describes just the transport layer which in haproxy is\nclosest to the connection, where no content is yet made available. the fetch\nmethods described here are usable as low as the \"tcp-request connection\" rule\nsets unless they require some future information. those generally include\ntcp/ip addresses and ports, as well as elements from stick-tables related to\nthe incoming connection. for retrieving a value from a sticky counters, the\ncounter number can be explicitly set as 0, 1, or 2 using the pre-defined\n\"sc0_\", \"sc1_\", or \"sc2_\" prefix, or it can be specified as the first integer\nargument when using the \"sc_\" prefix. an optional table may be specified with\nthe \"sc*\" form, in which case the currently tracked key will be looked up into\nthis alternate table instead of the table currently being tracked.\n\nbe_id : integer\n  returns an integer containing the current backend's id. it can be used in\n  frontends with responses to check which backend processed the request.\n\ndst : ip\n  this is the destination ipv4 address of the connection on the client side,\n  which is the address the client connected to. it can be useful when running\n  in transparent mode. it is of type ip and works on both ipv4 and ipv6 tables.\n  on ipv6 tables, ipv4 address is mapped to its ipv6 equivalent, according to\n  rfc 4291.\n\ndst_conn : integer\n  returns an integer value corresponding to the number of currently established\n  connections on the same socket including the one being evaluated. it is\n  normally used with acls but can as well be used to pass the information to\n  servers in an http header or in logs. it can be used to either return a sorry\n  page before hard-blocking, or to use a specific backend to drain new requests\n  when the socket is considered saturated. this offers the ability to assign\n  different limits to different listening ports or addresses. see also the\n  \"fe_conn\" and \"be_conn\" fetches.\n\ndst_port : integer\n  returns an integer value corresponding to the destination tcp port of the\n  connection on the client side, which is the port the client connected to.\n  this might be used when running in transparent mode, when assigning dynamic\n  ports to some clients for a whole application session, to stick all users to\n  a same server, or to pass the destination port information to a server using\n  an http header.\n\nfe_id : integer\n  returns an integer containing the current frontend's id. it can be used in\n  backends to check from which backend it was called, or to stick all users\n  coming via a same frontend to the same server.\n\nsc_bytes_in_rate(<ctr>[,<table>]) : integer\nsc0_bytes_in_rate([<table>]) : integer\nsc1_bytes_in_rate([<table>]) : integer\nsc2_bytes_in_rate([<table>]) : integer\n  returns the average client-to-server bytes rate from the currently tracked\n  counters, measured in amount of bytes over the period configured in the\n  table. see also src_bytes_in_rate.\n\nsc_bytes_out_rate(<ctr>[,<table>]) : integer\nsc0_bytes_out_rate([<table>]) : integer\nsc1_bytes_out_rate([<table>]) : integer\nsc2_bytes_out_rate([<table>]) : integer\n  returns the average server-to-client bytes rate from the currently tracked\n  counters, measured in amount of bytes over the period configured in the\n  table. see also src_bytes_out_rate.\n\nsc_clr_gpc0(<ctr>[,<table>]) : integer\nsc0_clr_gpc0([<table>]) : integer\nsc1_clr_gpc0([<table>]) : integer\nsc2_clr_gpc0([<table>]) : integer\n  clears the first general purpose counter associated to the currently tracked\n  counters, and returns its previous value. before the first invocation, the\n  stored value is zero, so first invocation will always return zero. this is\n  typically used as a second acl in an expression in order to mark a connection\n  when a first acl was verified :\n\n        # block if 5 consecutive requests continue to come faster than 10 sess\n        # per second, and reset the counter as soon as the traffic slows down.\n        acl abuse sc0_http_req_rate gt 10\n        acl kill  sc0_inc_gpc0 gt 5\n        acl save  sc0_clr_gpc0 ge 0\n        tcp-request connection accept if !abuse save\n        tcp-request connection reject if abuse kill\n\nsc_conn_cnt(<ctr>[,<table>]) : integer\nsc0_conn_cnt([<table>]) : integer\nsc1_conn_cnt([<table>]) : integer\nsc2_conn_cnt([<table>]) : integer\n  returns the cumulated number of incoming connections from currently tracked\n  counters. see also src_conn_cnt.\n\nsc_conn_cur(<ctr>[,<table>]) : integer\nsc0_conn_cur([<table>]) : integer\nsc1_conn_cur([<table>]) : integer\nsc2_conn_cur([<table>]) : integer\n  returns the current amount of concurrent connections tracking the same\n  tracked counters. this number is automatically incremented when tracking\n  begins and decremented when tracking stops. see also src_conn_cur.\n\nsc_conn_rate(<ctr>[,<table>]) : integer\nsc0_conn_rate([<table>]) : integer\nsc1_conn_rate([<table>]) : integer\nsc2_conn_rate([<table>]) : integer\n  returns the average connection rate from the currently tracked counters,\n  measured in amount of connections over the period configured in the table.\n  see also src_conn_rate.\n\nsc_get_gpc0(<ctr>[,<table>]) : integer\nsc0_get_gpc0([<table>]) : integer\nsc1_get_gpc0([<table>]) : integer\nsc2_get_gpc0([<table>]) : integer\n  returns the value of the first general purpose counter associated to the\n  currently tracked counters. see also src_get_gpc0 and sc/sc0/sc1/sc2_inc_gpc0.\n\nsc_gpc0_rate(<ctr>[,<table>]) : integer\nsc0_gpc0_rate([<table>]) : integer\nsc1_gpc0_rate([<table>]) : integer\nsc2_gpc0_rate([<table>]) : integer\n  returns the average increment rate of the first general purpose counter\n  associated to the currently tracked counters. it reports the frequency\n  which the gpc0 counter was incremented over the configured period. see also\n  src_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0\\. note\n  that the \"gpc0_rate\" counter must be stored in the stick-table for a value to\n  be returned, as \"gpc0\" only holds the event count.\n\nsc_http_err_cnt(<ctr>[,<table>]) : integer\nsc0_http_err_cnt([<table>]) : integer\nsc1_http_err_cnt([<table>]) : integer\nsc2_http_err_cnt([<table>]) : integer\n  returns the cumulated number of http errors from the currently tracked\n  counters. this includes the both request errors and 4xx error responses.\n  see also src_http_err_cnt.\n\nsc_http_err_rate(<ctr>[,<table>]) : integer\nsc0_http_err_rate([<table>]) : integer\nsc1_http_err_rate([<table>]) : integer\nsc2_http_err_rate([<table>]) : integer\n  returns the average rate of http errors from the currently tracked counters,\n  measured in amount of errors over the period configured in the table. this\n  includes the both request errors and 4xx error responses. see also\n  src_http_err_rate.\n\nsc_http_req_cnt(<ctr>[,<table>]) : integer\nsc0_http_req_cnt([<table>]) : integer\nsc1_http_req_cnt([<table>]) : integer\nsc2_http_req_cnt([<table>]) : integer\n  returns the cumulated number of http requests from the currently tracked\n  counters. this includes every started request, valid or not. see also\n  src_http_req_cnt.\n\nsc_http_req_rate(<ctr>[,<table>]) : integer\nsc0_http_req_rate([<table>]) : integer\nsc1_http_req_rate([<table>]) : integer\nsc2_http_req_rate([<table>]) : integer\n  returns the average rate of http requests from the currently tracked\n  counters, measured in amount of requests over the period configured in\n  the table. this includes every started request, valid or not. see also\n  src_http_req_rate.\n\nsc_inc_gpc0(<ctr>[,<table>]) : integer\nsc0_inc_gpc0([<table>]) : integer\nsc1_inc_gpc0([<table>]) : integer\nsc2_inc_gpc0([<table>]) : integer\n  increments the first general purpose counter associated to the currently\n  tracked counters, and returns its new value. before the first invocation,\n  the stored value is zero, so first invocation will increase it to 1 and will\n  return 1\\. this is typically used as a second acl in an expression in order\n  to mark a connection when a first acl was verified :\n\n        acl abuse sc0_http_req_rate gt 10\n        acl kill  sc0_inc_gpc0 gt 0\n        tcp-request connection reject if abuse kill\n\nsc_kbytes_in(<ctr>[,<table>]) : integer\nsc0_kbytes_in([<table>]) : integer\nsc1_kbytes_in([<table>]) : integer\nsc2_kbytes_in([<table>]) : integer\n  returns the total amount of client-to-server data from the currently tracked\n  counters, measured in kilobytes. the test is currently performed on 32-bit\n  integers, which limits values to 4 terabytes. see also src_kbytes_in.\n\nsc_kbytes_out(<ctr>[,<table>]) : integer\nsc0_kbytes_out([<table>]) : integer\nsc1_kbytes_out([<table>]) : integer\nsc2_kbytes_out([<table>]) : integer\n  returns the total amount of server-to-client data from the currently tracked\n  counters, measured in kilobytes. the test is currently performed on 32-bit\n  integers, which limits values to 4 terabytes. see also src_kbytes_out.\n\nsc_sess_cnt(<ctr>[,<table>]) : integer\nsc0_sess_cnt([<table>]) : integer\nsc1_sess_cnt([<table>]) : integer\nsc2_sess_cnt([<table>]) : integer\n  returns the cumulated number of incoming connections that were transformed\n  into sessions, which means that they were accepted by a \"tcp-request\n  connection\" rule, from the currently tracked counters. a backend may count\n  more sessions than connections because each connection could result in many\n  backend sessions if some http keep-alive is performed over the connection\n  with the client. see also src_sess_cnt.\n\nsc_sess_rate(<ctr>[,<table>]) : integer\nsc0_sess_rate([<table>]) : integer\nsc1_sess_rate([<table>]) : integer\nsc2_sess_rate([<table>]) : integer\n  returns the average session rate from the currently tracked counters,\n  measured in amount of sessions over the period configured in the table. a\n  session is a connection that got past the early \"tcp-request connection\"\n  rules. a backend may count more sessions than connections because each\n  connection could result in many backend sessions if some http keep-alive is\n  performed over the connection with the client. see also src_sess_rate.\n\nsc_tracked(<ctr>[,<table>]) : boolean\nsc0_tracked([<table>]) : boolean\nsc1_tracked([<table>]) : boolean\nsc2_tracked([<table>]) : boolean\n  returns true if the designated session counter is currently being tracked by\n  the current session. this can be useful when deciding whether or not we want\n  to set some values in a header passed to the server.\n\nsc_trackers(<ctr>[,<table>]) : integer\nsc0_trackers([<table>]) : integer\nsc1_trackers([<table>]) : integer\nsc2_trackers([<table>]) : integer\n  returns the current amount of concurrent connections tracking the same\n  tracked counters. this number is automatically incremented when tracking\n  begins and decremented when tracking stops. it differs from sc0_conn_cur in\n  that it does not rely on any stored information but on the table's reference\n  count (the \"use\" value which is returned by \"show table\" on the cli). this\n  may sometimes be more suited for layer7 tracking. it can be used to tell a\n  server how many concurrent connections there are from a given address for\n  example.\n\nso_id : integer\n  returns an integer containing the current listening socket's id. it is useful\n  in frontends involving many \"bind\" lines, or to stick all users coming via a\n  same socket to the same server.\n\nsrc : ip\n  this is the source ipv4 address of the client of the session.  it is of type\n  ip and works on both ipv4 and ipv6 tables. on ipv6 tables, ipv4 addresses are\n  mapped to their ipv6 equivalent, according to rfc 4291\\. note that it is the\n  tcp-level source address which is used, and not the address of a client\n  behind a proxy. however if the \"accept-proxy\" bind directive is used, it can\n  be the address of a client behind another proxy-protocol compatible component\n  for all rule sets except \"tcp-request connection\" which sees the real address.\n\n  example:\n       # add an http header in requests with the originating address' country\n       http-request set-header x-country %[src,map_ip(geoip.lst)]\n\nsrc_bytes_in_rate([<table>]) : integer\n  returns the average bytes rate from the incoming connection's source address\n  in the current proxy's stick-table or in the designated stick-table, measured\n  in amount of bytes over the period configured in the table. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_in_rate.\n\nsrc_bytes_out_rate([<table>]) : integer\n  returns the average bytes rate to the incoming connection's source address in\n  the current proxy's stick-table or in the designated stick-table, measured in\n  amount of bytes over the period configured in the table. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_out_rate.\n\nsrc_clr_gpc0([<table>]) : integer\n  clears the first general purpose counter associated to the incoming\n  connection's source address in the current proxy's stick-table or in the\n  designated stick-table, and returns its previous value. if the address is not\n  found, an entry is created and 0 is returned. this is typically used as a\n  second acl in an expression in order to mark a connection when a first acl\n  was verified :\n\n        # block if 5 consecutive requests continue to come faster than 10 sess\n        # per second, and reset the counter as soon as the traffic slows down.\n        acl abuse src_http_req_rate gt 10\n        acl kill  src_inc_gpc0 gt 5\n        acl save  src_clr_gpc0 ge 0\n        tcp-request connection accept if !abuse save\n        tcp-request connection reject if abuse kill\n\nsrc_conn_cnt([<table>]) : integer\n  returns the cumulated number of connections initiated from the current\n  incoming connection's source address in the current proxy's stick-table or in\n  the designated stick-table. if the address is not found, zero is returned.\n  see also sc/sc0/sc1/sc2_conn_cnt.\n\nsrc_conn_cur([<table>]) : integer\n  returns the current amount of concurrent connections initiated from the\n  current incoming connection's source address in the current proxy's\n  stick-table or in the designated stick-table. if the address is not found,\n  zero is returned. see also sc/sc0/sc1/sc2_conn_cur.\n\nsrc_conn_rate([<table>]) : integer\n  returns the average connection rate from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of connections over the period configured in the table. if\n  the address is not found, zero is returned. see also sc/sc0/sc1/sc2_conn_rate.\n\nsrc_get_gpc0([<table>]) : integer\n  returns the value of the first general purpose counter associated to the\n  incoming connection's source address in the current proxy's stick-table or in\n  the designated stick-table. if the address is not found, zero is returned.\n  see also sc/sc0/sc1/sc2_get_gpc0 and src_inc_gpc0.\n\nsrc_gpc0_rate([<table>]) : integer\n  returns the average increment rate of the first general purpose counter\n  associated to the incoming connection's source address in the current proxy's\n  stick-table or in the designated stick-table. it reports the frequency\n  which the gpc0 counter was incremented over the configured period. see also\n  sc/sc0/sc1/sc2_gpc0_rate, src_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0\\. note\n  that the \"gpc0_rate\" counter must be stored in the stick-table for a value to\n  be returned, as \"gpc0\" only holds the event count.\n\nsrc_http_err_cnt([<table>]) : integer\n  returns the cumulated number of http errors from the incoming connection's\n  source address in the current proxy's stick-table or in the designated\n  stick-table. this includes the both request errors and 4xx error responses.\n  see also sc/sc0/sc1/sc2_http_err_cnt. if the address is not found, zero is\n  returned.\n\nsrc_http_err_rate([<table>]) : integer\n  returns the average rate of http errors from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of errors over the period configured in the table. this\n  includes the both request errors and 4xx error responses. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_err_rate.\n\nsrc_http_req_cnt([<table>]) : integer\n  returns the cumulated number of http requests from the incoming connection's\n  source address in the current proxy's stick-table or in the designated stick-\n  table. this includes every started request, valid or not. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_cnt.\n\nsrc_http_req_rate([<table>]) : integer\n  returns the average rate of http requests from the incoming connection's\n  source address in the current proxy's stick-table or in the designated stick-\n  table, measured in amount of requests over the period configured in the\n  table. this includes every started request, valid or not. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_rate.\n\nsrc_inc_gpc0([<table>]) : integer\n  increments the first general purpose counter associated to the incoming\n  connection's source address in the current proxy's stick-table or in the\n  designated stick-table, and returns its new value. if the address is not\n  found, an entry is created and 1 is returned. see also sc0/sc2/sc2_inc_gpc0.\n  this is typically used as a second acl in an expression in order to mark a\n  connection when a first acl was verified :\n\n        acl abuse src_http_req_rate gt 10\n        acl kill  src_inc_gpc0 gt 0\n        tcp-request connection reject if abuse kill\n\nsrc_kbytes_in([<table>]) : integer\n  returns the total amount of data received from the incoming connection's\n  source address in the current proxy's stick-table or in the designated\n  stick-table, measured in kilobytes. if the address is not found, zero is\n  returned. the test is currently performed on 32-bit integers, which limits\n  values to 4 terabytes. see also sc/sc0/sc1/sc2_kbytes_in.\n\nsrc_kbytes_out([<table>]) : integer\n  returns the total amount of data sent to the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in kilobytes. if the address is not found, zero is returned. the\n  test is currently performed on 32-bit integers, which limits values to 4\n  terabytes. see also sc/sc0/sc1/sc2_kbytes_out.\n\nsrc_port : integer\n  returns an integer value corresponding to the tcp source port of the\n  connection on the client side, which is the port the client connected from.\n  usage of this function is very limited as modern protocols do not care much\n  about source ports nowadays.\n\nsrc_sess_cnt([<table>]) : integer\n  returns the cumulated number of connections initiated from the incoming\n  connection's source ipv4 address in the current proxy's stick-table or in the\n  designated stick-table, that were transformed into sessions, which means that\n  they were accepted by \"tcp-request\" rules. if the address is not found, zero\n  is returned. see also sc/sc0/sc1/sc2_sess_cnt.\n\nsrc_sess_rate([<table>]) : integer\n  returns the average session rate from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of sessions over the period configured in the table. a\n  session is a connection that went past the early \"tcp-request\" rules. if the\n  address is not found, zero is returned. see also sc/sc0/sc1/sc2_sess_rate.\n\nsrc_updt_conn_cnt([<table>]) : integer\n  creates or updates the entry associated to the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table.\n  this table must be configured to store the \"conn_cnt\" data type, otherwise\n  the match will be ignored. the current count is incremented by one, and the\n  expiration timer refreshed. the updated count is returned, so this match\n  can't return zero. this was used to reject service abusers based on their\n  source address. note: it is recommended to use the more complete \"track-sc*\"\n  actions in \"tcp-request\" rules instead.\n\n  example :\n        # this frontend limits incoming ssh connections to 3 per 10 second for\n        # each source address, and rejects excess connections until a 10 second\n        # silence is observed. at most 20 addresses are tracked.\n        listen ssh\n            bind :22\n            mode tcp\n            maxconn 100\n            stick-table type ip size 20 expire 10s store conn_cnt\n            tcp-request content reject if { src_updt_conn_cnt gt 3 }\n            server local 127.0.0.1:22\n\nsrv_id : integer\n  returns an integer containing the server's id when processing the response.\n  while it's almost only used with acls, it may be used for logging or\n  debugging.\n\n7.3.4\\. fetching samples at layer 5\n----------------------------------\n\nthe layer 5 usually describes just the session layer which in haproxy is\nclosest to the session once all the connection handshakes are finished, but\nwhen no content is yet made available. the fetch methods described here are\nusable as low as the \"tcp-request content\" rule sets unless they require some\nfuture information. those generally include the results of ssl negotiations.\n\nssl_bc : boolean\n  returns true when the back connection was made via an ssl/tls transport\n  layer and is locally deciphered. this means the outgoing connection was made\n  other a server with the \"ssl\" option.\n\nssl_bc_alg_keysize : integer\n  returns the symmetric cipher key size supported in bits when the outgoing\n  connection was made over an ssl/tls transport layer.\n\nssl_bc_cipher : string\n  returns the name of the used cipher when the outgoing connection was made\n  over an ssl/tls transport layer.\n\nssl_bc_protocol : string\n  returns the name of the used protocol when the outgoing connection was made\n  over an ssl/tls transport layer.\n\nssl_bc_unique_id : binary\n  when the outgoing connection was made over an ssl/tls transport layer,\n  returns the tls unique id as defined in rfc5929 section 3\\. the unique id\n  can be encoded to base64 using the converter: \"ssl_bc_unique_id,base64\".\n\nssl_bc_session_id : binary\n  returns the ssl id of the back connection when the outgoing connection was\n  made over an ssl/tls transport layer. it is useful to log if we want to know\n  if session was reused or not.\n\nssl_bc_use_keysize : integer\n  returns the symmetric cipher key size used in bits when the outgoing\n  connection was made over an ssl/tls transport layer.\n\nssl_c_ca_err : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the id of the first error detected during verification of the client\n  certificate at depth > 0, or 0 if no error was encountered during this\n  verification process. please refer to your ssl library's documentation to\n  find the exhaustive list of error codes.\n\nssl_c_ca_err_depth : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the depth in the ca chain of the first error detected during the\n  verification of the client certificate. if no error is encountered, 0 is\n  returned.\n\nssl_c_der : binary\n  returns the der formatted certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_c_err : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the id of the first error detected during verification at depth 0, or\n  0 if no error was encountered during this verification process. please refer\n  to your ssl library's documentation to find the exhaustive list of error\n  codes.\n\nssl_c_i_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the issuer of the certificate\n  presented by the client when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_c_i_dn(ou,2)\" the second organization unit, and\n  \"ssl_c_i_dn(cn)\" retrieves the common name.\n\nssl_c_key_alg : string\n  returns the name of the algorithm used to generate the key of the certificate\n  presented by the client when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_notafter : string\n  returns the end date presented by the client as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_notbefore : string\n  returns the start date presented by the client as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_s_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the subject of the certificate\n  presented by the client when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_c_s_dn(ou,2)\" the second organization unit, and\n  \"ssl_c_s_dn(cn)\" retrieves the common name.\n\nssl_c_serial : binary\n  returns the serial of the certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_c_sha1 : binary\n  returns the sha-1 fingerprint of the certificate presented by the client when\n  the incoming connection was made over an ssl/tls transport layer. this can be\n  used to stick a client to a server, or to pass this information to a server.\n  note that the output is binary, so if you want to pass that signature to the\n  server, you need to encode it in hex or base64, such as in the example below:\n\n     http-request set-header x-ssl-client-sha1 %[ssl_c_sha1,hex]\n\nssl_c_sig_alg : string\n  returns the name of the algorithm used to sign the certificate presented by\n  the client when the incoming connection was made over an ssl/tls transport\n  layer.\n\nssl_c_used : boolean\n  returns true if current ssl session uses a client certificate even if current\n  connection uses ssl session resumption. see also \"ssl_fc_has_crt\".\n\nssl_c_verify : integer\n  returns the verify result error id when the incoming connection was made over\n  an ssl/tls transport layer, otherwise zero if no error is encountered. please\n  refer to your ssl library's documentation for an exhaustive list of error\n  codes.\n\nssl_c_version : integer\n  returns the version of the certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer.\n\nssl_f_der : binary\n  returns the der formatted certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_f_i_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the issuer of the certificate\n  presented by the frontend when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_f_i_dn(ou,2)\" the second organization unit, and\n  \"ssl_f_i_dn(cn)\" retrieves the common name.\n\nssl_f_key_alg : string\n  returns the name of the algorithm used to generate the key of the certificate\n  presented by the frontend when the incoming connection was made over an\n  ssl/tls transport layer.\n\nssl_f_notafter : string\n  returns the end date presented by the frontend as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_f_notbefore : string\n  returns the start date presented by the frontend as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_f_s_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the subject of the certificate\n  presented by the frontend when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_f_s_dn(ou,2)\" the second organization unit, and\n  \"ssl_f_s_dn(cn)\" retrieves the common name.\n\nssl_f_serial : binary\n  returns the serial of the certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_f_sha1 : binary\n  returns the sha-1 fingerprint of the certificate presented by the frontend\n  when the incoming connection was made over an ssl/tls transport layer. this\n  can be used to know which certificate was chosen using sni.\n\nssl_f_sig_alg : string\n  returns the name of the algorithm used to sign the certificate presented by\n  the frontend when the incoming connection was made over an ssl/tls transport\n  layer.\n\nssl_f_version : integer\n  returns the version of the certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer.\n\nssl_fc : boolean\n  returns true when the front connection was made via an ssl/tls transport\n  layer and is locally deciphered. this means it has matched a socket declared\n  with a \"bind\" line having the \"ssl\" option.\n\n  example :\n        # this passes \"x-proto: https\" to servers when client connects over ssl\n        listen http-https\n            bind :80\n            bind :443 ssl crt /etc/haproxy.pem\n            http-request add-header x-proto https if { ssl_fc }\n\nssl_fc_alg_keysize : integer\n  returns the symmetric cipher key size supported in bits when the incoming\n  connection was made over an ssl/tls transport layer.\n\nssl_fc_alpn : string\n  this extracts the application layer protocol negotiation field from an\n  incoming connection made via a tls transport layer and locally deciphered by\n  haproxy. the result is a string containing the protocol name advertised by\n  the client. the ssl library must have been built with support for tls\n  extensions enabled (check haproxy -vv). note that the tls alpn extension is\n  not advertised unless the \"alpn\" keyword on the \"bind\" line specifies a\n  protocol list. also, nothing forces the client to pick a protocol from this\n  list, any other one may be requested. the tls alpn extension is meant to\n  replace the tls npn extension. see also \"ssl_fc_npn\".\n\nssl_fc_cipher : string\n  returns the name of the used cipher when the incoming connection was made\n  over an ssl/tls transport layer.\n\nssl_fc_has_crt : boolean\n  returns true if a client certificate is present in an incoming connection over\n  ssl/tls transport layer. useful if 'verify' statement is set to 'optional'.\n  note: on ssl session resumption with session id or tls ticket, client\n  certificate is not present in the current connection but may be retrieved\n  from the cache or the ticket. so prefer \"ssl_c_used\" if you want to check if\n  current ssl session uses a client certificate.\n\nssl_fc_has_sni : boolean\n  this checks for the presence of a server name indication tls extension (sni)\n  in an incoming connection was made over an ssl/tls transport layer. returns\n  true when the incoming connection presents a tls sni field. this requires\n  that the ssl library is build with support for tls extensions enabled (check\n  haproxy -vv).\n\nssl_fc_is_resumed: boolean\n  returns true if the ssl/tls session has been resumed through the use of\n  ssl session cache or tls tickets.\n\nssl_fc_npn : string\n  this extracts the next protocol negotiation field from an incoming connection\n  made via a tls transport layer and locally deciphered by haproxy. the result\n  is a string containing the protocol name advertised by the client. the ssl\n  library must have been built with support for tls extensions enabled (check\n  haproxy -vv). note that the tls npn extension is not advertised unless the\n  \"npn\" keyword on the \"bind\" line specifies a protocol list. also, nothing\n  forces the client to pick a protocol from this list, any other one may be\n  requested. please note that the tls npn extension was replaced with alpn.\n\nssl_fc_protocol : string\n  returns the name of the used protocol when the incoming connection was made\n  over an ssl/tls transport layer.\n\nssl_fc_unique_id : binary\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the tls unique id as defined in rfc5929 section 3\\. the unique id\n  can be encoded to base64 using the converter: \"ssl_bc_unique_id,base64\".\n\nssl_fc_session_id : binary\n  returns the ssl id of the front connection when the incoming connection was\n  made over an ssl/tls transport layer. it is useful to stick a given client to\n  a server. it is important to note that some browsers refresh their session id\n  every few minutes.\n\nssl_fc_sni : string\n  this extracts the server name indication tls extension (sni) field from an\n  incoming connection made via an ssl/tls transport layer and locally\n  deciphered by haproxy. the result (when present) typically is a string\n  matching the https host name (253 chars or less). the ssl library must have\n  been built with support for tls extensions enabled (check haproxy -vv).\n\n  this fetch is different from \"req_ssl_sni\" above in that it applies to the\n  connection being deciphered by haproxy and not to ssl contents being blindly\n  forwarded. see also \"ssl_fc_sni_end\" and \"ssl_fc_sni_reg\" below. this\n  requires that the ssl library is build with support for tls extensions\n  enabled (check haproxy -vv).\n\n  acl derivatives :\n    ssl_fc_sni_end : suffix match\n    ssl_fc_sni_reg : regex match\n\nssl_fc_use_keysize : integer\n  returns the symmetric cipher key size used in bits when the incoming\n  connection was made over an ssl/tls transport layer.\n\n7.3.5\\. fetching samples from buffer contents (layer 6)\n------------------------------------------------------\n\nfetching samples from buffer contents is a bit different from the previous\nsample fetches above because the sampled data are ephemeral. these data can\nonly be used when they're available and will be lost when they're forwarded.\nfor this reason, samples fetched from buffer contents during a request cannot\nbe used in a response for example. even while the data are being fetched, they\ncan change. sometimes it is necessary to set some delays or combine multiple\nsample fetch methods to ensure that the expected data are complete and usable,\nfor example through tcp request content inspection. please see the \"tcp-request\ncontent\" keyword for more detailed information on the subject.\n\npayload(<offset>,<length>) : binary (deprecated)\n  this is an alias for \"req.payload\" when used in the context of a request (eg:\n  \"stick on\", \"stick match\"), and for \"res.payload\" when used in the context of\n  a response such as in \"stick store response\".\n\npayload_lv(<offset1>,<length>[,<offset2>]) : binary (deprecated)\n  this is an alias for \"req.payload_lv\" when used in the context of a request\n  (eg: \"stick on\", \"stick match\"), and for \"res.payload_lv\" when used in the\n  context of a response such as in \"stick store response\".\n\nreq.len : integer\nreq_len : integer (deprecated)\n  returns an integer value corresponding to the number of bytes present in the\n  request buffer. this is mostly used in acl. it is important to understand\n  that this test does not return false as long as the buffer is changing. this\n  means that a check with equality to zero will almost always immediately match\n  at the beginning of the session, while a test for more data will wait for\n  that data to come in and return false only when haproxy is certain that no\n  more data will come in. this test was designed to be used with tcp request\n  content inspection.\n\nreq.payload(<offset>,<length>) : binary\n  this extracts a binary block of <length> bytes and starting at byte <offset>\n  in the request buffer. as a special case, if the <length> argument is zero,\n  the the whole buffer from <offset> to the end is extracted. this can be used\n  with acls in order to check for the presence of some content in a buffer at\n  any location.\n\n  acl alternatives :\n    payload(<offset>,<length>) : hex binary match\n\nreq.payload_lv(<offset1>,<length>[,<offset2>]) : binary\n  this extracts a binary block whose size is specified at <offset1> for <length>\n  bytes, and which starts at <offset2> if specified or just after the length in\n  the request buffer. the <offset2> parameter also supports relative offsets if\n  prepended with a '+' or '-' sign.\n\n  acl alternatives :\n    payload_lv(<offset1>,<length>[,<offset2>]) : hex binary match\n\n  example : please consult the example from the \"stick store-response\" keyword.\n\nreq.proto_http : boolean\nreq_proto_http : boolean (deprecated)\n  returns true when data in the request buffer look like http and correctly\n  parses as such. it is the same parser as the common http request parser which\n  is used so there should be no surprises. the test does not match until the\n  request is complete, failed or timed out. this test may be used to report the\n  protocol in tcp logs, but the biggest use is to block tcp request analysis\n  until a complete http request is present in the buffer, for example to track\n  a header.\n\n  example:\n        # track request counts per \"base\" (concatenation of host+url)\n        tcp-request inspect-delay 10s\n        tcp-request content reject if !http\n        tcp-request content track-sc0 base table req-rate\n\nreq.rdp_cookie([<name>]) : string\nrdp_cookie([<name>]) : string (deprecated)\n  when the request buffer looks like the rdp protocol, extracts the rdp cookie\n  <name>, or any cookie if unspecified. the parser only checks for the first\n  cookie, as illustrated in the rdp protocol specification. the cookie name is\n  case insensitive. generally the \"msts\" cookie name will be used, as it can\n  contain the user name of the client connecting to the server if properly\n  configured on the client. the \"mstshash\" cookie is often used as well for\n  session stickiness to servers.\n\n  this differs from \"balance rdp-cookie\" in that any balancing algorithm may be\n  used and thus the distribution of clients to backend servers is not linked to\n  a hash of the rdp cookie. it is envisaged that using a balancing algorithm\n  such as \"balance roundrobin\" or \"balance leastconn\" will lead to a more even\n  distribution of clients to backend servers than the hash used by \"balance\n  rdp-cookie\".\n\n  acl derivatives :\n    req_rdp_cookie([<name>]) : exact string match\n\n  example :\n   listen tse-farm\n       bind 0.0.0.0:3389\n       # wait up to 5s for an rdp cookie in the request\n       tcp-request inspect-delay 5s\n       tcp-request content accept if rdp_cookie\n       # apply rdp cookie persistence\n       persist rdp-cookie\n       # persist based on the mstshash cookie\n       # this is only useful makes sense if\n       # balance rdp-cookie is not used\n       stick-table type string size 204800\n       stick on req.rdp_cookie(mstshash)\n       server srv1 1.1.1.1:3389\n       server srv1 1.1.1.2:3389\n\n  see also : \"balance rdp-cookie\", \"persist rdp-cookie\", \"tcp-request\" and the\n  \"req_rdp_cookie\" acl.\n\nreq.rdp_cookie_cnt([name]) : integer\nrdp_cookie_cnt([name]) : integer (deprecated)\n  tries to parse the request buffer as rdp protocol, then returns an integer\n  corresponding to the number of rdp cookies found. if an optional cookie name\n  is passed, only cookies matching this name are considered. this is mostly\n  used in acl.\n\n  acl derivatives :\n    req_rdp_cookie_cnt([<name>]) : integer match\n\nreq.ssl_ec_ext : boolean\n  returns a boolean identifying if client sent the supported elliptic curves\n  extension as defined in rfc4492, section 5.1\\. within the ssl clienthello\n  message. this can be used to present ecc compatible clients with ec certificate\n  and to use rsa for all others, on the same ip address. note that this only\n  applies to raw contents found in the request buffer and not to contents\n  deciphered via an ssl data layer, so this will not work with \"bind\" lines\n  having the \"ssl\" option.\n\nreq.ssl_hello_type : integer\nreq_ssl_hello_type : integer (deprecated)\n  returns an integer value containing the type of the ssl hello message found\n  in the request buffer if the buffer contains data that parse as a complete\n  ssl (v3 or superior) client hello message. note that this only applies to raw\n  contents found in the request buffer and not to contents deciphered via an\n  ssl data layer, so this will not work with \"bind\" lines having the \"ssl\"\n  option. this is mostly used in acl to detect presence of an ssl hello message\n  that is supposed to contain an ssl session id usable for stickiness.\n\nreq.ssl_sni : string\nreq_ssl_sni : string (deprecated)\n  returns a string containing the value of the server name tls extension sent\n  by a client in a tls stream passing through the request buffer if the buffer\n  contains data that parse as a complete ssl (v3 or superior) client hello\n  message. note that this only applies to raw contents found in the request\n  buffer and not to contents deciphered via an ssl data layer, so this will not\n  work with \"bind\" lines having the \"ssl\" option. sni normally contains the\n  name of the host the client tries to connect to (for recent browsers). sni is\n  useful for allowing or denying access to certain hosts when ssl/tls is used\n  by the client. this test was designed to be used with tcp request content\n  inspection. if content switching is needed, it is recommended to first wait\n  for a complete client hello (type 1), like in the example below. see also\n  \"ssl_fc_sni\".\n\n  acl derivatives :\n    req_ssl_sni : exact string match\n\n  examples :\n     # wait for a client hello for at most 5 seconds\n     tcp-request inspect-delay 5s\n     tcp-request content accept if { req_ssl_hello_type 1 }\n     use_backend bk_allow if { req_ssl_sni -f allowed_sites }\n     default_backend bk_sorry_page\n\nres.ssl_hello_type : integer\nrep_ssl_hello_type : integer (deprecated)\n  returns an integer value containing the type of the ssl hello message found\n  in the response buffer if the buffer contains data that parses as a complete\n  ssl (v3 or superior) hello message. note that this only applies to raw\n  contents found in the response buffer and not to contents deciphered via an\n  ssl data layer, so this will not work with \"server\" lines having the \"ssl\"\n  option. this is mostly used in acl to detect presence of an ssl hello message\n  that is supposed to contain an ssl session id usable for stickiness.\n\nreq.ssl_ver : integer\nreq_ssl_ver : integer (deprecated)\n  returns an integer value containing the version of the ssl/tls protocol of a\n  stream present in the request buffer. both sslv2 hello messages and sslv3\n  messages are supported. tlsv1 is announced as ssl version 3.1\\. the value is\n  composed of the major version multiplied by 65536, added to the minor\n  version. note that this only applies to raw contents found in the request\n  buffer and not to contents deciphered via an ssl data layer, so this will not\n  work with \"bind\" lines having the \"ssl\" option. the acl version of the test\n  matches against a decimal notation in the form major.minor (eg: 3.1). this\n  fetch is mostly used in acl.\n\n  acl derivatives :\n    req_ssl_ver : decimal match\n\nres.len : integer\n  returns an integer value corresponding to the number of bytes present in the\n  response buffer. this is mostly used in acl. it is important to understand\n  that this test does not return false as long as the buffer is changing. this\n  means that a check with equality to zero will almost always immediately match\n  at the beginning of the session, while a test for more data will wait for\n  that data to come in and return false only when haproxy is certain that no\n  more data will come in. this test was designed to be used with tcp response\n  content inspection.\n\nres.payload(<offset>,<length>) : binary\n  this extracts a binary block of <length> bytes and starting at byte <offset>\n  in the response buffer. as a special case, if the <length> argument is zero,\n  the the whole buffer from <offset> to the end is extracted. this can be used\n  with acls in order to check for the presence of some content in a buffer at\n  any location.\n\nres.payload_lv(<offset1>,<length>[,<offset2>]) : binary\n  this extracts a binary block whose size is specified at <offset1> for <length>\n  bytes, and which starts at <offset2> if specified or just after the length in\n  the response buffer. the <offset2> parameter also supports relative offsets\n  if prepended with a '+' or '-' sign.\n\n  example : please consult the example from the \"stick store-response\" keyword.\n\nwait_end : boolean\n  this fetch either returns true when the inspection period is over, or does\n  not fetch. it is only used in acls, in conjunction with content analysis to\n  avoid returning a wrong verdict early.  it may also be used to delay some\n  actions, such as a delayed reject for some special addresses. since it either\n  stops the rules evaluation or immediately returns true, it is recommended to\n  use this acl as the last one in a rule.  please note that the default acl\n  \"wait_end\" is always usable without prior declaration. this test was designed\n  to be used with tcp request content inspection.\n\n  examples :\n     # delay every incoming request by 2 seconds\n     tcp-request inspect-delay 2s\n     tcp-request content accept if wait_end\n\n     # don't immediately tell bad guys they are rejected\n     tcp-request inspect-delay 10s\n     acl goodguys src 10.0.0.0/24\n     acl badguys  src 10.0.1.0/24\n     tcp-request content accept if goodguys\n     tcp-request content reject if badguys wait_end\n     tcp-request content reject\n\n7.3.6\\. fetching http samples (layer 7)\n--------------------------------------\n\nit is possible to fetch samples from http contents, requests and responses.\nthis application layer is also called layer 7\\. it is only possible to fetch the\ndata in this section when a full http request or response has been parsed from\nits respective request or response buffer. this is always the case with all\nhttp specific rules and for sections running with \"mode http\". when using tcp\ncontent inspection, it may be necessary to support an inspection delay in order\nto let the request or response come in first. these fetches may require a bit\nmore cpu resources than the layer 4 ones, but not much since the request and\nresponse are indexed.\n\nbase : string\n  this returns the concatenation of the first host header and the path part of\n  the request, which starts at the first slash and ends before the question\n  mark. it can be useful in virtual hosted environments to detect url abuses as\n  well as to improve shared caches efficiency. using this with a limited size\n  stick table also allows one to collect statistics about most commonly\n  requested objects by host/path. with acls it can allow simple content\n  switching rules involving the host and the path at the same time, such as\n  \"www.example.com/favicon.ico\". see also \"path\" and \"uri\".\n\n  acl derivatives :\n    base     : exact string match\n    base_beg : prefix match\n    base_dir : subdir match\n    base_dom : domain match\n    base_end : suffix match\n    base_len : length match\n    base_reg : regex match\n    base_sub : substring match\n\nbase32 : integer\n  this returns a 32-bit hash of the value returned by the \"base\" fetch method\n  above. this is useful to track per-url activity on high traffic sites without\n  having to store all urls. instead a shorter hash is stored, saving a lot of\n  memory. the output type is an unsigned integer. the hash function used is\n  sdbm with full avalanche on the output. technically, base32 is exactly equal\n  to \"base,sdbm(1)\".\n\nbase32+src : binary\n  this returns the concatenation of the base32 fetch above and the src fetch\n  below. the resulting type is of type binary, with a size of 8 or 20 bytes\n  depending on the source address family. this can be used to track per-ip,\n  per-url counters.\n\ncapture.req.hdr(<idx>) : string\n  this extracts the content of the header captured by the \"capture request\n  header\", idx is the position of the capture keyword in the configuration.\n  the first entry is an index of 0\\. see also: \"capture request header\".\n\ncapture.req.method : string\n  this extracts the method of an http request. it can be used in both request\n  and response. unlike \"method\", it can be used in both request and response\n  because it's allocated.\n\ncapture.req.uri : string\n  this extracts the request's uri, which starts at the first slash and ends\n  before the first space in the request (without the host part). unlike \"path\"\n  and \"url\", it can be used in both request and response because it's\n  allocated.\n\ncapture.req.ver : string\n  this extracts the request's http version and returns either \"http/1.0\" or\n  \"http/1.1\". unlike \"req.ver\", it can be used in both request, response, and\n  logs because it relies on a persistent flag.\n\ncapture.res.hdr(<idx>) : string\n  this extracts the content of the header captured by the \"capture response\n  header\", idx is the position of the capture keyword in the configuration.\n  the first entry is an index of 0.\n  see also: \"capture response header\"\n\ncapture.res.ver : string\n  this extracts the response's http version and returns either \"http/1.0\" or\n  \"http/1.1\". unlike \"res.ver\", it can be used in logs because it relies on a\n  persistent flag.\n\nreq.body : binary\n  this returns the http request's available body as a block of data. it\n  requires that the request body has been buffered made available using\n  \"option http-buffer-request\". in case of chunked-encoded body, currently only\n  the first chunk is analyzed.\n\nreq.body_param([<name>) : string\n  this fetch assumes that the body of the post request is url-encoded. the user\n  can check if the \"content-type\" contains the value\n  \"application/x-www-form-urlencoded\". this extracts the first occurrence of the\n  parameter <name> in the body, which ends before '&'. the parameter name is\n  case-sensitive. if no name is given, any parameter will match, and the first\n  one will be returned. the result is a string corresponding to the value of the\n  parameter <name> as presented in the request body (no url decoding is\n  performed). note that the acl version of this fetch iterates over multiple\n  parameters and will iteratively report all parameters values if no name is\n  given.\n\nreq.body_len : integer\n  this returns the length of the http request's available body in bytes. it may\n  be lower than the advertised length if the body is larger than the buffer. it\n  requires that the request body has been buffered made available using\n  \"option http-buffer-request\".\n\nreq.body_size : integer\n  this returns the advertised length of the http request's body in bytes. it\n  will represent the advertised content-length header, or the size of the first\n  chunk in case of chunked encoding. in order to parse the chunks, it requires\n  that the request body has been buffered made available using\n  \"option http-buffer-request\".\n\nreq.cook([<name>]) : string\ncook([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, and returns its value as string. if no name is\n  specified, the first cookie value is returned. when used with acls, all\n  matching cookies are evaluated. spaces around the name and the value are\n  ignored as requested by the cookie header specification (rfc6265). the cookie\n  name is case-sensitive. empty cookies are valid, so an empty cookie may very\n  well return an empty value if it is present. use the \"found\" match to detect\n  presence. use the res.cook() variant for response cookies sent by the server.\n\n  acl derivatives :\n    cook([<name>])     : exact string match\n    cook_beg([<name>]) : prefix match\n    cook_dir([<name>]) : subdir match\n    cook_dom([<name>]) : domain match\n    cook_end([<name>]) : suffix match\n    cook_len([<name>]) : length match\n    cook_reg([<name>]) : regex match\n    cook_sub([<name>]) : substring match\n\nreq.cook_cnt([<name>]) : integer\ncook_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of the cookie\n  <name> in the request, or all cookies if <name> is not specified.\n\nreq.cook_val([<name>]) : integer\ncook_val([<name>]) : integer (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, and converts its value to an integer which is\n  returned. if no name is specified, the first cookie value is returned. when\n  used in acls, all matching names are iterated over until a value matches.\n\ncookie([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, or a \"set-cookie\" header from the response, and\n  returns its value as a string. a typical use is to get multiple clients\n  sharing a same profile use the same server. this can be similar to what\n  \"appsession\" does with the \"request-learn\" statement, but with support for\n  multi-peer synchronization and state keeping across restarts. if no name is\n  specified, the first cookie value is returned. this fetch should not be used\n  anymore and should be replaced by req.cook() or res.cook() instead as it\n  ambiguously uses the direction based on the context where it is used.\n  see also : \"appsession\".\n\nhdr([<name>[,<occ>]]) : string\n  this is equivalent to req.hdr() when used on requests, and to res.hdr() when\n  used on responses. please refer to these respective fetches for more details.\n  in case of doubt about the fetch direction, please use the explicit ones.\n  note that contrary to the hdr() sample fetch method, the hdr_* acl keywords\n  unambiguously apply to the request headers.\n\nreq.fhdr(<name>[,<occ>]) : string\n  this extracts the last occurrence of header <name> in an http request. when\n  used from an acl, all occurrences are iterated over until a match is found.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. it differs from req.hdr() in that any commas\n  present in the value are returned and are not used as delimiters. this is\n  sometimes useful with headers such as user-agent.\n\nreq.fhdr_cnt([<name>]) : integer\n  returns an integer value representing the number of occurrences of request\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. contrary to its req.hdr_cnt() cousin, this function returns\n  the number of full line headers and does not stop on commas.\n\nreq.hdr([<name>[,<occ>]]) : string\n  this extracts the last occurrence of header <name> in an http request. when\n  used from an acl, all occurrences are iterated over until a match is found.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. a typical use is with the x-forwarded-for header\n  once converted to ip, associated with an ip stick-table. the function\n  considers any comma as a delimiter for distinct values. if full-line headers\n  are desired instead, use req.fhdr(). please carefully check rfc2616 to know\n  how certain headers are supposed to be parsed. also, some of them are case\n  insensitive (eg: connection).\n\n  acl derivatives :\n    hdr([<name>[,<occ>]])     : exact string match\n    hdr_beg([<name>[,<occ>]]) : prefix match\n    hdr_dir([<name>[,<occ>]]) : subdir match\n    hdr_dom([<name>[,<occ>]]) : domain match\n    hdr_end([<name>[,<occ>]]) : suffix match\n    hdr_len([<name>[,<occ>]]) : length match\n    hdr_reg([<name>[,<occ>]]) : regex match\n    hdr_sub([<name>[,<occ>]]) : substring match\n\nreq.hdr_cnt([<name>]) : integer\nhdr_cnt([<header>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of request\n  header field name <name>, or the total number of header field values if\n  <name> is not specified. it is important to remember that one header line may\n  count as several headers if it has several values. the function considers any\n  comma as a delimiter for distinct values. if full-line headers are desired\n  instead, req.fhdr_cnt() should be used instead. with acls, it can be used to\n  detect presence, absence or abuse of a specific header, as well as to block\n  request smuggling attacks by rejecting requests which contain more than one\n  of certain headers. see \"req.hdr\" for more information on header matching.\n\nreq.hdr_ip([<name>[,<occ>]]) : ip\nhdr_ip([<name>[,<occ>]]) : ip (deprecated)\n  this extracts the last occurrence of header <name> in an http request,\n  converts it to an ipv4 or ipv6 address and returns this address. when used\n  with acls, all occurrences are checked, and if <name> is omitted, every value\n  of every header is checked. optionally, a specific occurrence might be\n  specified as a position number. positive values indicate a position from the\n  first occurrence, with 1 being the first one.  negative values indicate\n  positions relative to the last one, with -1 being the last one. a typical use\n  is with the x-forwarded-for and x-client-ip headers.\n\nreq.hdr_val([<name>[,<occ>]]) : integer\nhdr_val([<name>[,<occ>]]) : integer (deprecated)\n  this extracts the last occurrence of header <name> in an http request, and\n  converts it to an integer value. when used with acls, all occurrences are\n  checked, and if <name> is omitted, every value of every header is checked.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. a typical use is with the x-forwarded-for header.\n\nhttp_auth(<userlist>) : boolean\n  returns a boolean indicating whether the authentication data received from\n  the client match a username & password stored in the specified userlist. this\n  fetch function is not really useful outside of acls. currently only http\n  basic auth is supported.\n\nhttp_auth_group(<userlist>) : string\n  returns a string corresponding to the user name found in the authentication\n  data received from the client if both the user name and password are valid\n  according to the specified userlist. the main purpose is to use it in acls\n  where it is then checked whether the user belongs to any group within a list.\n  this fetch function is not really useful outside of acls. currently only http\n  basic auth is supported.\n\n  acl derivatives :\n    http_auth_group(<userlist>) : group ...\n    returns true when the user extracted from the request and whose password is\n    valid according to the specified userlist belongs to at least one of the\n    groups.\n\nhttp_first_req : boolean\n  returns true when the request being processed is the first one of the\n  connection. this can be used to add or remove headers that may be missing\n  from some requests when a request is not the first one, or to help grouping\n  requests in the logs.\n\nmethod : integer + string\n  returns an integer value corresponding to the method in the http request. for\n  example, \"get\" equals 1 (check sources to establish the matching). value 9\n  means \"other method\" and may be converted to a string extracted from the\n  stream. this should not be used directly as a sample, this is only meant to\n  be used from acls, which transparently convert methods from patterns to these\n  integer + string values. some predefined acl already check for most common\n  methods.\n\n  acl derivatives :\n    method : case insensitive method match\n\n  example :\n      # only accept get and head requests\n      acl valid_method method get head\n      http-request deny if ! valid_method\n\npath : string\n  this extracts the request's url path, which starts at the first slash and\n  ends before the question mark (without the host part). a typical use is with\n  prefetch-capable caches, and with portals which need to aggregate multiple\n  information from databases and keep them in caches. note that with outgoing\n  caches, it would be wiser to use \"url\" instead. with acls, it's typically\n  used to match exact file names (eg: \"/login.php\"), or directory parts using\n  the derivative forms. see also the \"url\" and \"base\" fetch methods.\n\n  acl derivatives :\n    path     : exact string match\n    path_beg : prefix match\n    path_dir : subdir match\n    path_dom : domain match\n    path_end : suffix match\n    path_len : length match\n    path_reg : regex match\n    path_sub : substring match\n\nquery : string\n  this extracts the request's query string, which starts after the first\n  question mark. if no question mark is present, this fetch returns nothing. if\n  a question mark is present but nothing follows, it returns an empty string.\n  this means it's possible to easily know whether a query string is present\n  using the \"found\" matching method. this fetch is the completemnt of \"path\"\n  which stops before the question mark.\n\nreq.hdr_names([<delim>]) : string\n  this builds a string made from the concatenation of all header names as they\n  appear in the request when the rule is evaluated. the default delimiter is\n  the comma (',') but it may be overridden as an optional argument <delim>. in\n  this case, only the first character of <delim> is considered.\n\nreq.ver : string\nreq_ver : string (deprecated)\n  returns the version string from the http request, for example \"1.1\". this can\n  be useful for logs, but is mostly there for acl. some predefined acl already\n  check for versions 1.0 and 1.1.\n\n  acl derivatives :\n    req_ver : exact string match\n\nres.comp : boolean\n  returns the boolean \"true\" value if the response has been compressed by\n  haproxy, otherwise returns boolean \"false\". this may be used to add\n  information in the logs.\n\nres.comp_algo : string\n  returns a string containing the name of the algorithm used if the response\n  was compressed by haproxy, for example : \"deflate\". this may be used to add\n  some information in the logs.\n\nres.cook([<name>]) : string\nscook([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response, and returns its value as string. if no name is\n  specified, the first cookie value is returned.\n\n  acl derivatives :\n    scook([<name>] : exact string match\n\nres.cook_cnt([<name>]) : integer\nscook_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of the cookie\n  <name> in the response, or all cookies if <name> is not specified. this is\n  mostly useful when combined with acls to detect suspicious responses.\n\nres.cook_val([<name>]) : integer\nscook_val([<name>]) : integer (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response, and converts its value to an integer which is\n  returned. if no name is specified, the first cookie value is returned.\n\nres.fhdr([<name>[,<occ>]]) : string\n  this extracts the last occurrence of header <name> in an http response, or of\n  the last header if no <name> is specified. optionally, a specific occurrence\n  might be specified as a position number. positive values indicate a position\n  from the first occurrence, with 1 being the first one. negative values\n  indicate positions relative to the last one, with -1 being the last one. it\n  differs from res.hdr() in that any commas present in the value are returned\n  and are not used as delimiters. if this is not desired, the res.hdr() fetch\n  should be used instead. this is sometimes useful with headers such as date or\n  expires.\n\nres.fhdr_cnt([<name>]) : integer\n  returns an integer value representing the number of occurrences of response\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. contrary to its res.hdr_cnt() cousin, this function returns\n  the number of full line headers and does not stop on commas. if this is not\n  desired, the res.hdr_cnt() fetch should be used instead.\n\nres.hdr([<name>[,<occ>]]) : string\nshdr([<name>[,<occ>]]) : string (deprecated)\n  this extracts the last occurrence of header <name> in an http response, or of\n  the last header if no <name> is specified. optionally, a specific occurrence\n  might be specified as a position number. positive values indicate a position\n  from the first occurrence, with 1 being the first one. negative values\n  indicate positions relative to the last one, with -1 being the last one. this\n  can be useful to learn some data into a stick-table. the function considers\n  any comma as a delimiter for distinct values. if this is not desired, the\n  res.fhdr() fetch should be used instead.\n\n  acl derivatives :\n    shdr([<name>[,<occ>]])     : exact string match\n    shdr_beg([<name>[,<occ>]]) : prefix match\n    shdr_dir([<name>[,<occ>]]) : subdir match\n    shdr_dom([<name>[,<occ>]]) : domain match\n    shdr_end([<name>[,<occ>]]) : suffix match\n    shdr_len([<name>[,<occ>]]) : length match\n    shdr_reg([<name>[,<occ>]]) : regex match\n    shdr_sub([<name>[,<occ>]]) : substring match\n\nres.hdr_cnt([<name>]) : integer\nshdr_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of response\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. the function considers any comma as a delimiter for distinct\n  values. if this is not desired, the res.fhdr_cnt() fetch should be used\n  instead.\n\nres.hdr_ip([<name>[,<occ>]]) : ip\nshdr_ip([<name>[,<occ>]]) : ip (deprecated)\n  this extracts the last occurrence of header <name> in an http response,\n  convert it to an ipv4 or ipv6 address and returns this address. optionally, a\n  specific occurrence might be specified as a position number. positive values\n  indicate a position from the first occurrence, with 1 being the first one.\n  negative values indicate positions relative to the last one, with -1 being\n  the last one. this can be useful to learn some data into a stick table.\n\nres.hdr_names([<delim>]) : string\n  this builds a string made from the concatenation of all header names as they\n  appear in the response when the rule is evaluated. the default delimiter is\n  the comma (',') but it may be overridden as an optional argument <delim>. in\n  this case, only the first character of <delim> is considered.\n\nres.hdr_val([<name>[,<occ>]]) : integer\nshdr_val([<name>[,<occ>]]) : integer (deprecated)\n  this extracts the last occurrence of header <name> in an http response, and\n  converts it to an integer value. optionally, a specific occurrence might be\n  specified as a position number. positive values indicate a position from the\n  first occurrence, with 1 being the first one. negative values indicate\n  positions relative to the last one, with -1 being the last one. this can be\n  useful to learn some data into a stick table.\n\nres.ver : string\nresp_ver : string (deprecated)\n  returns the version string from the http response, for example \"1.1\". this\n  can be useful for logs, but is mostly there for acl.\n\n  acl derivatives :\n    resp_ver : exact string match\n\nset-cookie([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response and uses the corresponding value to match. this\n  can be comparable to what \"appsession\" does with default options, but with\n  support for multi-peer synchronization and state keeping across restarts.\n\n  this fetch function is deprecated and has been superseded by the \"res.cook\"\n  fetch. this keyword will disappear soon.\n\n  see also : \"appsession\"\n\nstatus : integer\n  returns an integer containing the http status code in the http response, for\n  example, 302\\. it is mostly used within acls and integer ranges, for example,\n  to remove any location header if the response is not a 3xx.\n\nurl : string\n  this extracts the request's url as presented in the request. a typical use is\n  with prefetch-capable caches, and with portals which need to aggregate\n  multiple information from databases and keep them in caches. with acls, using\n  \"path\" is preferred over using \"url\", because clients may send a full url as\n  is normally done with proxies. the only real use is to match \"*\" which does\n  not match in \"path\", and for which there is already a predefined acl. see\n  also \"path\" and \"base\".\n\n  acl derivatives :\n    url     : exact string match\n    url_beg : prefix match\n    url_dir : subdir match\n    url_dom : domain match\n    url_end : suffix match\n    url_len : length match\n    url_reg : regex match\n    url_sub : substring match\n\nurl_ip : ip\n  this extracts the ip address from the request's url when the host part is\n  presented as an ip address. its use is very limited. for instance, a\n  monitoring system might use this field as an alternative for the source ip in\n  order to test what path a given source address would follow, or to force an\n  entry in a table for a given source address. with acls it can be used to\n  restrict access to certain systems through a proxy, for example when combined\n  with option \"http_proxy\".\n\nurl_port : integer\n  this extracts the port part from the request's url. note that if the port is\n  not specified in the request, port 80 is assumed. with acls it can be used to\n  restrict access to certain systems through a proxy, for example when combined\n  with option \"http_proxy\".\n\nurlp([<name>[,<delim>]]) : string\nurl_param([<name>[,<delim>]]) : string\n  this extracts the first occurrence of the parameter <name> in the query\n  string, which begins after either '?' or <delim>, and which ends before '&',\n  ';' or <delim>. the parameter name is case-sensitive. if no name is given,\n  any parameter will match, and the first one will be returned. the result is\n  a string corresponding to the value of the parameter <name> as presented in\n  the request (no url decoding is performed). this can be used for session\n  stickiness based on a client id, to extract an application cookie passed as a\n  url parameter, or in acls to apply some checks. note that the acl version of\n  this fetch iterates over multiple parameters and will iteratively report all\n  parameters values if no name is given\n\n  acl derivatives :\n    urlp(<name>[,<delim>])     : exact string match\n    urlp_beg(<name>[,<delim>]) : prefix match\n    urlp_dir(<name>[,<delim>]) : subdir match\n    urlp_dom(<name>[,<delim>]) : domain match\n    urlp_end(<name>[,<delim>]) : suffix match\n    urlp_len(<name>[,<delim>]) : length match\n    urlp_reg(<name>[,<delim>]) : regex match\n    urlp_sub(<name>[,<delim>]) : substring match\n\n  example :\n      # match http://example.com/foo?phpsessionid=some_id\n      stick on urlp(phpsessionid)\n      # match http://example.com/foo;jsessionid=some_id\n      stick on urlp(jsessionid,;)\n\nurlp_val([<name>[,<delim>])] : integer\n  see \"urlp\" above. this one extracts the url parameter <name> in the request\n  and converts it to an integer value. this can be used for session stickiness\n  based on a user id for example, or with acls to match a page number or price.\n\n7.4\\. pre-defined acls\n---------------------\n\nsome predefined acls are hard-coded so that they do not have to be declared in\nevery frontend which needs them. they all have their names in upper case in\norder to avoid confusion. their equivalence is provided below.\n\nacl name          equivalent to                usage\n---------------+-----------------------------+---------------------------------\nfalse            always_false                  never match\nhttp             req_proto_http                match if protocol is valid http\nhttp_1.0         req_ver 1.0                   match http version 1.0\nhttp_1.1         req_ver 1.1                   match http version 1.1\nhttp_content     hdr_val(content-length) gt 0  match an existing content-length\nhttp_url_abs     url_reg ^[^/:]*://            match absolute url with scheme\nhttp_url_slash   url_beg /                     match url beginning with \"/\"\nhttp_url_star    url     *                     match url equal to \"*\"\nlocalhost        src 127.0.0.1/8               match connection from local host\nmeth_connect     method  connect               match http connect method\nmeth_get         method  get head              match http get or head method\nmeth_head        method  head                  match http head method\nmeth_options     method  options               match http options method\nmeth_post        method  post                  match http post method\nmeth_trace       method  trace                 match http trace method\nrdp_cookie       req_rdp_cookie_cnt gt 0       match presence of an rdp cookie\nreq_content      req_len gt 0                  match data in the request buffer\ntrue             always_true                   always match\nwait_end         wait_end                      wait for end of content analysis\n---------------+-----------------------------+---------------------------------\n\n8\\. logging\n----------\n\none of haproxy's strong points certainly lies is its precise logs. it probably\nprovides the finest level of information available for such a product, which is\nvery important for troubleshooting complex environments. standard information\nprovided in logs include client ports, tcp/http state timers, precise session\nstate at termination and precise termination cause, information about decisions\nto direct traffic to a server, and of course the ability to capture arbitrary\nheaders.\n\nin order to improve administrators reactivity, it offers a great transparency\nabout encountered problems, both internal and external, and it is possible to\nsend logs to different sources at the same time with different level filters :\n\n  - global process-level logs (system errors, start/stop, etc..)\n  - per-instance system and internal errors (lack of resource, bugs, ...)\n  - per-instance external troubles (servers up/down, max connections)\n  - per-instance activity (client connections), either at the establishment or\n    at the termination.\n  - per-request control of log-level, eg:\n        http-request set-log-level silent if sensitive_request\n\nthe ability to distribute different levels of logs to different log servers\nallow several production teams to interact and to fix their problems as soon\nas possible. for example, the system team might monitor system-wide errors,\nwhile the application team might be monitoring the up/down for their servers in\nreal time, and the security team might analyze the activity logs with one hour\ndelay.\n\n8.1\\. log levels\n---------------\n\ntcp and http connections can be logged with information such as the date, time,\nsource ip address, destination address, connection duration, response times,\nhttp request, http return code, number of bytes transmitted, conditions\nin which the session ended, and even exchanged cookies values. for example\ntrack a particular user's problems. all messages may be sent to up to two\nsyslog servers. check the \"log\" keyword in section 4.2 for more information\nabout log facilities.\n\n8.2\\. log formats\n----------------\n\nhaproxy supports 5 log formats. several fields are common between these formats\nand will be detailed in the following sections. a few of them may vary\nslightly with the configuration, due to indicators specific to certain\noptions. the supported formats are as follows :\n\n  - the default format, which is very basic and very rarely used. it only\n    provides very basic information about the incoming connection at the moment\n    it is accepted : source ip:port, destination ip:port, and frontend-name.\n    this mode will eventually disappear so it will not be described to great\n    extents.\n\n  - the tcp format, which is more advanced. this format is enabled when \"option\n    tcplog\" is set on the frontend. haproxy will then usually wait for the\n    connection to terminate before logging. this format provides much richer\n    information, such as timers, connection counts, queue size, etc... this\n    format is recommended for pure tcp proxies.\n\n  - the http format, which is the most advanced for http proxying. this format\n    is enabled when \"option httplog\" is set on the frontend. it provides the\n    same information as the tcp format with some http-specific fields such as\n    the request, the status code, and captures of headers and cookies. this\n    format is recommended for http proxies.\n\n  - the clf http format, which is equivalent to the http format, but with the\n    fields arranged in the same order as the clf format. in this mode, all\n    timers, captures, flags, etc... appear one per field after the end of the\n    common fields, in the same order they appear in the standard http format.\n\n  - the custom log format, allows you to make your own log line.\n\nnext sections will go deeper into details for each of these formats. format\nspecification will be performed on a \"field\" basis. unless stated otherwise, a\nfield is a portion of text delimited by any number of spaces. since syslog\nservers are susceptible of inserting fields at the beginning of a line, it is\nalways assumed that the first field is the one containing the process name and\nidentifier.\n\nnote : since log lines may be quite long, the log examples in sections below\n       might be broken into multiple lines. the example log lines will be\n       prefixed with 3 closing angle brackets ('>>>') and each time a log is\n       broken into multiple lines, each non-final line will end with a\n       backslash ('\\') and the next line will start indented by two characters.\n\n8.2.1\\. default log format\n-------------------------\n\nthis format is used when no specific option is set. the log is emitted as soon\nas the connection is accepted. one should note that this currently is the only\nformat which logs the request's destination ip and ports.\n\n  example :\n        listen www\n            mode http\n            log global\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:12:09 localhost \\\n          haproxy[14385]: connect from 10.0.1.2:33312 to 10.0.3.31:8012 \\\n          (www/http)\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14385]:\n      2   'connect from'                                          connect from\n      3   source_ip ':' source_port                             10.0.1.2:33312\n      4   'to'                                                              to\n      5   destination_ip ':' destination_port                   10.0.3.31:8012\n      6   '(' frontend_name '/' mode ')'                            (www/http)\n\ndetailed fields description :\n  - \"source_ip\" is the ip address of the client which initiated the connection.\n  - \"source_port\" is the tcp port of the client which initiated the connection.\n  - \"destination_ip\" is the ip address the client connected to.\n  - \"destination_port\" is the tcp port the client connected to.\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n  - \"mode is the mode the frontend is operating (tcp or http).\n\nin case of a unix socket, the source and destination addresses are marked as\n\"unix:\" and the ports reflect the internal id of the socket which accepted the\nconnection (the same id as reported in the stats).\n\nit is advised not to use this deprecated format for newer installations as it\nwill eventually disappear.\n\n8.2.2\\. tcp log format\n---------------------\n\nthe tcp format is used when \"option tcplog\" is specified in the frontend, and\nis the recommended format for pure tcp proxies. it provides a lot of precious\ninformation for troubleshooting. since this format includes timers and byte\ncounts, the log is normally emitted at the end of the session. it can be\nemitted earlier if \"option logasap\" is specified, which makes sense in most\nenvironments with long sessions such as remote terminals. sessions which match\nthe \"monitor\" rules are never logged. it is also possible not to emit logs for\nsessions for which no data were exchanged between the client and the server, by\nspecifying \"option dontlognull\" in the frontend. successful connections will\nnot be logged if \"option dontlog-normal\" is specified in the frontend. a few\nfields may slightly vary depending on some configuration options, those are\nmarked with a star ('*') after the field name below.\n\n  example :\n        frontend fnt\n            mode tcp\n            option tcplog\n            log global\n            default_backend bck\n\n        backend bck\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:12:56 localhost \\\n          haproxy[14387]: 10.0.1.2:33313 [06/feb/2009:12:12:51.443] fnt \\\n          bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14387]:\n      2   client_ip ':' client_port                             10.0.1.2:33313\n      3   '[' accept_date ']'                       [06/feb/2009:12:12:51.443]\n      4   frontend_name                                                    fnt\n      5   backend_name '/' server_name                                bck/srv1\n      6   tw '/' tc '/' tt*                                           0/0/5007\n      7   bytes_read*                                                      212\n      8   termination_state                                                 --\n      9   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    0/0/0/0/3\n     10   srv_queue '/' backend_queue                                      0/0\n\ndetailed fields description :\n  - \"client_ip\" is the ip address of the client which initiated the tcp\n    connection to haproxy. if the connection was accepted on a unix socket\n    instead, the ip address would be replaced with the word \"unix\". note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the proxy protocol is correctly used, then the logs will reflect the\n    forwarded connection's information.\n\n  - \"client_port\" is the tcp port of the client which initiated the connection.\n    if the connection was accepted on a unix socket instead, the port would be\n    replaced with the id of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"accept_date\" is the exact date when the connection was received by haproxy\n    (which might be very slightly different from the date observed on the\n    network if there was some queuing in the system's backlog). this is usually\n    the same date which may appear in any upstream firewall's log.\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. this will be the same as the\n    frontend if no switching rule has been applied, which is common for tcp\n    applications.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. note that this server belongs to the backend\n    which processed the request. if the connection was aborted before reaching\n    a server, \"<nosrv>\" is indicated instead of a server name.\n\n  - \"tw\" is the total time in milliseconds spent waiting in the various queues.\n    it can be \"-1\" if the connection was aborted before reaching the queue.\n    see \"timers\" below for more details.\n\n  - \"tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. it can be \"-1\" if the\n    connection was aborted before a connection could be established. see\n    \"timers\" below for more details.\n\n  - \"tt\" is the total time in milliseconds elapsed between the accept and the\n    last close. it covers all possible processing. there is one exception, if\n    \"option logasap\" was specified, then the time counting stops at the moment\n    the log is emitted. in this case, a '+' sign is prepended before the value,\n    indicating that the final one will be larger. see \"timers\" below for more\n    details.\n\n  - \"bytes_read\" is the total number of bytes transmitted from the server to\n    the client when the log is emitted. if \"option logasap\" is specified, the\n    this value will be prefixed with a '+' sign indicating that the final one\n    may be larger. please note that this value is a 64-bit counter, so log\n    analysis tools must be able to handle it without overflowing.\n\n  - \"termination_state\" is the condition the session was in when the session\n    ended. this indicates the session state, which side caused the end of\n    session to happen, and for what reason (timeout, error, ...). the normal\n    flags should be \"--\", indicating the session was closed by either end with\n    no data remaining in buffers. see below \"session state at disconnection\"\n    for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the session was logged. it is useful to detect when some per-process system\n    limits have been reached. for instance, if actconn is close to 512 when\n    multiple connection errors occur, chances are high that the system limits\n    the process to use a maximum of 1024 file descriptors and that all of them\n    are used. see section 3 \"global parameters\" to find how to tune the system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the session was logged. it is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconn\"\n    has been reached. most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the session was logged. it includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. it is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the session was logged. it can never exceed the server's\n    configured \"maxconn\" parameter. if this value is very often close or equal\n    to the server's \"maxconn\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. when only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the connections to take longer to\n    be processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this session\n    when trying to connect to the server. it must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    frequent retries generally indicate either a network problem between\n    haproxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. this field may optionally be\n    prefixed with a '+' sign, indicating that the session has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. in this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. so as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queue\" is the total number of requests which were processed before\n    this one in the server queue. it is zero when the request has not gone\n    through the server queue. it makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. it is worth noting that if a session experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulated. a request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. it is zero when the request has not\n    gone through the global queue. it makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconn\" parameter. it is worth noting that if a\n    session experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulated. a request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n8.2.3\\. http log format\n----------------------\n\nthe http format is the most complete and the best suited for http proxies. it\nis enabled by when \"option httplog\" is specified in the frontend. it provides\nthe same level of information as the tcp format with additional features which\nare specific to the http protocol. just like the tcp format, the log is usually\nemitted at the end of the session, unless \"option logasap\" is specified, which\ngenerally only makes sense for download sites. a session which matches the\n\"monitor\" rules will never logged. it is also possible not to log sessions for\nwhich no data were sent by the client by specifying \"option dontlognull\" in the\nfrontend. successful connections will not be logged if \"option dontlog-normal\"\nis specified in the frontend.\n\nmost fields are shared with the tcp log, some being different. a few fields may\nslightly vary depending on some configuration options. those ones are marked\nwith a star ('*') after the field name below.\n\n  example :\n        frontend http-in\n            mode http\n            option httplog\n            log global\n            default_backend bck\n\n        backend static\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:14:14 localhost \\\n          haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n          static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n          {} \"get /index.html http/1.1\"\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14389]:\n      2   client_ip ':' client_port                             10.0.1.2:33317\n      3   '[' accept_date ']'                       [06/feb/2009:12:14:14.655]\n      4   frontend_name                                                http-in\n      5   backend_name '/' server_name                             static/srv1\n      6   tq '/' tw '/' tc '/' tr '/' tt*                       10/0/30/69/109\n      7   status_code                                                      200\n      8   bytes_read*                                                     2750\n      9   captured_request_cookie                                            -\n     10   captured_response_cookie                                           -\n     11   termination_state                                               ----\n     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    1/1/1/1/0\n     13   srv_queue '/' backend_queue                                      0/0\n     14   '{' captured_request_headers* '}'                   {haproxy.1wt.eu}\n     15   '{' captured_response_headers* '}'                                {}\n     16   '\"' http_request '\"'                      \"get /index.html http/1.1\"\n\ndetailed fields description :\n  - \"client_ip\" is the ip address of the client which initiated the tcp\n    connection to haproxy. if the connection was accepted on a unix socket\n    instead, the ip address would be replaced with the word \"unix\". note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the proxy protocol is correctly used, then the logs will reflect the\n    forwarded connection's information.\n\n  - \"client_port\" is the tcp port of the client which initiated the connection.\n    if the connection was accepted on a unix socket instead, the port would be\n    replaced with the id of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"accept_date\" is the exact date when the tcp connection was received by\n    haproxy (which might be very slightly different from the date observed on\n    the network if there was some queuing in the system's backlog). this is\n    usually the same date which may appear in any upstream firewall's log. this\n    does not depend on the fact that the client has sent the request or not.\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. this will be the same as the\n    frontend if no switching rule has been applied.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. note that this server belongs to the backend\n    which processed the request. if the request was aborted before reaching a\n    server, \"<nosrv>\" is indicated instead of a server name. if the request was\n    intercepted by the stats subsystem, \"<stats>\" is indicated instead.\n\n  - \"tq\" is the total time in milliseconds spent waiting for the client to send\n    a full http request, not counting data. it can be \"-1\" if the connection\n    was aborted before a complete request could be received. it should always\n    be very small because a request generally fits in one single packet. large\n    times here generally indicate network trouble between the client and\n    haproxy. see \"timers\" below for more details.\n\n  - \"tw\" is the total time in milliseconds spent waiting in the various queues.\n    it can be \"-1\" if the connection was aborted before reaching the queue.\n    see \"timers\" below for more details.\n\n  - \"tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. it can be \"-1\" if the\n    request was aborted before a connection could be established. see \"timers\"\n    below for more details.\n\n  - \"tr\" is the total time in milliseconds spent waiting for the server to send\n    a full http response, not counting data. it can be \"-1\" if the request was\n    aborted before a complete response could be received. it generally matches\n    the server's processing time for the request, though it may be altered by\n    the amount of data sent by the client to the server. large times here on\n    \"get\" requests generally indicate an overloaded server. see \"timers\" below\n    for more details.\n\n  - \"tt\" is the total time in milliseconds elapsed between the accept and the\n    last close. it covers all possible processing. there is one exception, if\n    \"option logasap\" was specified, then the time counting stops at the moment\n    the log is emitted. in this case, a '+' sign is prepended before the value,\n    indicating that the final one will be larger. see \"timers\" below for more\n    details.\n\n  - \"status_code\" is the http status code returned to the client. this status\n    is generally set by the server, but it might also be set by haproxy when\n    the server cannot be reached or when its response is blocked by haproxy.\n\n  - \"bytes_read\" is the total number of bytes transmitted to the client when\n    the log is emitted. this does include http headers. if \"option logasap\" is\n    specified, the this value will be prefixed with a '+' sign indicating that\n    the final one may be larger. please note that this value is a 64-bit\n    counter, so log analysis tools must be able to handle it without\n    overflowing.\n\n  - \"captured_request_cookie\" is an optional \"name=value\" entry indicating that\n    the client had this cookie in the request. the cookie name and its maximum\n    length are defined by the \"capture cookie\" statement in the frontend\n    configuration. the field is a single dash ('-') when the option is not\n    set. only one cookie may be captured, it is generally used to track session\n    id exchanges between a client and a server to detect session crossing\n    between clients due to application bugs. for more details, please consult\n    the section \"capturing http headers and cookies\" below.\n\n  - \"captured_response_cookie\" is an optional \"name=value\" entry indicating\n    that the server has returned a cookie with its response. the cookie name\n    and its maximum length are defined by the \"capture cookie\" statement in the\n    frontend configuration. the field is a single dash ('-') when the option is\n    not set. only one cookie may be captured, it is generally used to track\n    session id exchanges between a client and a server to detect session\n    crossing between clients due to application bugs. for more details, please\n    consult the section \"capturing http headers and cookies\" below.\n\n  - \"termination_state\" is the condition the session was in when the session\n    ended. this indicates the session state, which side caused the end of\n    session to happen, for what reason (timeout, error, ...), just like in tcp\n    logs, and information about persistence operations on cookies in the last\n    two characters. the normal flags should begin with \"--\", indicating the\n    session was closed by either end with no data remaining in buffers. see\n    below \"session state at disconnection\" for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the session was logged. it is useful to detect when some per-process system\n    limits have been reached. for instance, if actconn is close to 512 or 1024\n    when multiple connection errors occur, chances are high that the system\n    limits the process to use a maximum of 1024 file descriptors and that all\n    of them are used. see section 3 \"global parameters\" to find how to tune the\n    system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the session was logged. it is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconn\"\n    has been reached. most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the session was logged. it includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. it is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the session was logged. it can never exceed the server's\n    configured \"maxconn\" parameter. if this value is very often close or equal\n    to the server's \"maxconn\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. when only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the requests to take longer to be\n    processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this session\n    when trying to connect to the server. it must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    frequent retries generally indicate either a network problem between\n    haproxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. this field may optionally be\n    prefixed with a '+' sign, indicating that the session has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. in this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. so as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queue\" is the total number of requests which were processed before\n    this one in the server queue. it is zero when the request has not gone\n    through the server queue. it makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. it is worth noting that if a session experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulated. a request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. it is zero when the request has not\n    gone through the global queue. it makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconn\" parameter. it is worth noting that if a\n    session experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulated. a request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n  - \"captured_request_headers\" is a list of headers captured in the request due\n    to the presence of the \"capture request header\" statement in the frontend.\n    multiple headers can be captured, they will be delimited by a vertical bar\n    ('|'). when no capture is enabled, the braces do not appear, causing a\n    shift of remaining fields. it is important to note that this field may\n    contain spaces, and that using it requires a smarter log parser than when\n    it's not used. please consult the section \"capturing http headers and\n    cookies\" below for more details.\n\n  - \"captured_response_headers\" is a list of headers captured in the response\n    due to the presence of the \"capture response header\" statement in the\n    frontend. multiple headers can be captured, they will be delimited by a\n    vertical bar ('|'). when no capture is enabled, the braces do not appear,\n    causing a shift of remaining fields. it is important to note that this\n    field may contain spaces, and that using it requires a smarter log parser\n    than when it's not used. please consult the section \"capturing http headers\n    and cookies\" below for more details.\n\n  - \"http_request\" is the complete http request line, including the method,\n    request and http version string. non-printable characters are encoded (see\n    below the section \"non-printable characters\"). this is always the last\n    field, and it is always delimited by quotes and is the only one which can\n    contain quotes. if new fields are added to the log format, they will be\n    added before this field. this field might be truncated if the request is\n    huge and does not fit in the standard syslog buffer (1024 characters). this\n    is the reason why this field must always remain the last one.\n\n8.2.4\\. custom log format\n------------------------\n\nthe directive log-format allows you to customize the logs in http mode and tcp\nmode. it takes a string as argument.\n\nhaproxy understands some log format variables. % precedes log format variables.\nvariables can take arguments using braces ('{}'), and multiple arguments are\nseparated by commas within the braces. flags may be added or removed by\nprefixing them with a '+' or '-' sign.\n\nspecial variable \"%o\" may be used to propagate its flags to all other\nvariables on the same format string. this is particularly handy with quoted\nstring formats (\"q\").\n\nif a variable is named between square brackets ('[' .. ']') then it is used\nas a sample expression rule (see section 7.3). this it useful to add some\nless common information such as the client's ssl certificate's dn, or to log\nthe key that would be used to store an entry into a stick table.\n\nnote: spaces must be escaped. a space character is considered as a separator.\nin order to emit a verbatim '%', it must be preceded by another '%' resulting\nin '%%'. haproxy will automatically merge consecutive separators.\n\nflags are :\n  * q: quote a string\n  * x: hexadecimal representation (ips, ports, %ts, %rt, %pid)\n\n  example:\n\n    log-format %t\\ %t\\ some\\ text\n    log-format %{+q}o\\ %t\\ %s\\ %{-q}r\n\nat the moment, the default http format is defined this way :\n\n    log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tq/%tw/%tc/%tr/%tt\\ %st\\ %b\\ %cc\\ \\\n               %cs\\ %tsc\\ %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\\ %hr\\ %hs\\ %{+q}r\n\nthe default clf format is defined this way :\n\n    log-format %{+q}o\\ %{-q}ci\\ -\\ -\\ [%t]\\ %r\\ %st\\ %b\\ \\\"\\\"\\ \\\"\\\"\\ %cp\\ \\\n               %ms\\ %ft\\ %b\\ %s\\ \\%tq\\ %tw\\ %tc\\ %tr\\ %tt\\ %tsc\\ %ac\\ %fc\\ \\\n               %bc\\ %sc\\ %rc\\ %sq\\ %bq\\ %cc\\ %cs\\ \\%hrl\\ %hsl\n\nand the default tcp format is defined this way :\n\n    log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tw/%tc/%tt\\ %b\\ %ts\\ \\\n               %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\n\nplease refer to the table below for currently defined variables :\n\n  +---+------+-----------------------------------------------+-------------+\n  | r | var  | field name (8.2.2 and 8.2.3 for description)  | type        |\n  +---+------+-----------------------------------------------+-------------+\n  |   | %o   | special variable, apply flags on all next var |             |\n  +---+------+-----------------------------------------------+-------------+\n  |   | %b   | bytes_read           (from server to client)  | numeric     |\n  | h | %cc  | captured_request_cookie                       | string      |\n  | h | %cs  | captured_response_cookie                      | string      |\n  |   | %h   | hostname                                      | string      |\n  | h | %hm  | http method (ex: post)                        | string      |\n  | h | %hp  | http request uri without query string (path)  | string      |\n  | h | %hu  | http request uri (ex: /foo?bar=baz)           | string      |\n  | h | %hv  | http version (ex: http/1.0)                   | string      |\n  |   | %id  | unique-id                                     | string      |\n  |   | %st  | status_code                                   | numeric     |\n  |   | %t   | gmt_date_time                                 | date        |\n  |   | %tc  | tc                                            | numeric     |\n  |   | %tl  | local_date_time                               | date        |\n  | h | %tq  | tq                                            | numeric     |\n  | h | %tr  | tr                                            | numeric     |\n  |   | %ts  | timestamp                                     | numeric     |\n  |   | %tt  | tt                                            | numeric     |\n  |   | %tw  | tw                                            | numeric     |\n  |   | %u   | bytes_uploaded       (from client to server)  | numeric     |\n  |   | %ac  | actconn                                       | numeric     |\n  |   | %b   | backend_name                                  | string      |\n  |   | %bc  | beconn      (backend concurrent connections)  | numeric     |\n  |   | %bi  | backend_source_ip       (connecting address)  | ip          |\n  |   | %bp  | backend_source_port     (connecting address)  | numeric     |\n  |   | %bq  | backend_queue                                 | numeric     |\n  |   | %ci  | client_ip                 (accepted address)  | ip          |\n  |   | %cp  | client_port               (accepted address)  | numeric     |\n  |   | %f   | frontend_name                                 | string      |\n  |   | %fc  | feconn     (frontend concurrent connections)  | numeric     |\n  |   | %fi  | frontend_ip              (accepting address)  | ip          |\n  |   | %fp  | frontend_port            (accepting address)  | numeric     |\n  |   | %ft  | frontend_name_transport ('~' suffix for ssl)  | string      |\n  |   | %lc  | frontend_log_counter                          | numeric     |\n  |   | %hr  | captured_request_headers default style        | string      |\n  |   | %hrl | captured_request_headers clf style            | string list |\n  |   | %hs  | captured_response_headers default style       | string      |\n  |   | %hsl | captured_response_headers clf style           | string list |\n  |   | %ms  | accept date milliseconds                      | numeric     |\n  |   | %pid | pid                                           | numeric     |\n  | h | %r   | http_request                                  | string      |\n  |   | %rc  | retries                                       | numeric     |\n  |   | %rt  | request_counter (http req or tcp session)     | numeric     |\n  |   | %s   | server_name                                   | string      |\n  |   | %sc  | srv_conn     (server concurrent connections)  | numeric     |\n  |   | %si  | server_ip                   (target address)  | ip          |\n  |   | %sp  | server_port                 (target address)  | numeric     |\n  |   | %sq  | srv_queue                                     | numeric     |\n  | s | %sslc| ssl_ciphers (ex: aes-sha)                     | string      |\n  | s | %sslv| ssl_version (ex: tlsv1)                       | string      |\n  |   | %t   | date_time      (with millisecond resolution)  | date        |\n  |   | %ts  | termination_state                             | string      |\n  | h | %tsc | termination_state with cookie status          | string      |\n  +---+------+-----------------------------------------------+-------------+\n\n    r = restrictions : h = mode http only ; s = ssl only\n\n8.2.5\\. error log format\n-----------------------\n\nwhen an incoming connection fails due to an ssl handshake or an invalid proxy\nprotocol header, haproxy will log the event using a shorter, fixed line format.\nby default, logs are emitted at the log_info level, unless the option\n\"log-separate-errors\" is set in the backend, in which case the log_err level\nwill be used. connections on which no data are exchanged (eg: probes) are not\nlogged if the \"dontlognull\" option is set.\n\nthe format looks like this :\n\n    >>> dec  3 18:27:14 localhost \\\n          haproxy[6103]: 127.0.0.1:56059 [03/dec/2012:17:35:10.380] frt/f1: \\\n          connection error during ssl handshake\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                             haproxy[6103]:\n      2   client_ip ':' client_port                            127.0.0.1:56059\n      3   '[' accept_date ']'                       [03/dec/2012:17:35:10.380]\n      4   frontend_name \"/\" bind_name \":\"                              frt/f1:\n      5   message                        connection error during ssl handshake\n\nthese fields just provide minimal information to help debugging connection\nfailures.\n\n8.3\\. advanced logging options\n-----------------------------\n\nsome advanced logging options are often looked for but are not easy to find out\njust by looking at the various options. here is an entry point for the few\noptions which can enable better logging. please refer to the keywords reference\nfor more information about their usage.\n\n8.3.1\\. disabling logging of external tests\n------------------------------------------\n\nit is quite common to have some monitoring tools perform health checks on\nhaproxy. sometimes it will be a layer 3 load-balancer such as lvs or any\ncommercial load-balancer, and sometimes it will simply be a more complete\nmonitoring system such as nagios. when the tests are very frequent, users often\nask how to disable logging for those checks. there are three possibilities :\n\n  - if connections come from everywhere and are just tcp probes, it is often\n    desired to simply disable logging of connections without data exchange, by\n    setting \"option dontlognull\" in the frontend. it also disables logging of\n    port scans, which may or may not be desired.\n\n  - if the connection come from a known source network, use \"monitor-net\" to\n    declare this network as monitoring only. any host in this network will then\n    only be able to perform health checks, and their requests will not be\n    logged. this is generally appropriate to designate a list of equipment\n    such as other load-balancers.\n\n  - if the tests are performed on a known uri, use \"monitor-uri\" to declare\n    this uri as dedicated to monitoring. any host sending this request will\n    only get the result of a health-check, and the request will not be logged.\n\n8.3.2\\. logging before waiting for the session to terminate\n----------------------------------------------------------\n\nthe problem with logging at end of connection is that you have no clue about\nwhat is happening during very long sessions, such as remote terminal sessions\nor large file downloads. this problem can be worked around by specifying\n\"option logasap\" in the frontend. haproxy will then log as soon as possible,\njust before data transfer begins. this means that in case of tcp, it will still\nlog the connection status to the server, and in case of http, it will log just\nafter processing the server headers. in this case, the number of bytes reported\nis the number of header bytes sent to the client. in order to avoid confusion\nwith normal logs, the total time field and the number of bytes are prefixed\nwith a '+' sign which means that real numbers are certainly larger.\n\n8.3.3\\. raising log level upon errors\n------------------------------------\n\nsometimes it is more convenient to separate normal traffic from errors logs,\nfor instance in order to ease error monitoring from log files. when the option\n\"log-separate-errors\" is used, connections which experience errors, timeouts,\nretries, redispatches or http status codes 5xx will see their syslog level\nraised from \"info\" to \"err\". this will help a syslog daemon store the log in\na separate file. it is very important to keep the errors in the normal traffic\nfile too, so that log ordering is not altered. you should also be careful if\nyou already have configured your syslog daemon to store all logs higher than\n\"notice\" in an \"admin\" file, because the \"err\" level is higher than \"notice\".\n\n8.3.4\\. disabling logging of successful connections\n--------------------------------------------------\n\nalthough this may sound strange at first, some large sites have to deal with\nmultiple thousands of logs per second and are experiencing difficulties keeping\nthem intact for a long time or detecting errors within them. if the option\n\"dontlog-normal\" is set on the frontend, all normal connections will not be\nlogged. in this regard, a normal connection is defined as one without any\nerror, timeout, retry nor redispatch. in http, the status code is checked too,\nand a response with a status 5xx is not considered normal and will be logged\ntoo. of course, doing is is really discouraged as it will remove most of the\nuseful information from the logs. do this only if you have no other\nalternative.\n\n8.4\\. timing events\n------------------\n\ntimers provide a great help in troubleshooting network problems. all values are\nreported in milliseconds (ms). these timers should be used in conjunction with\nthe session termination flags. in tcp mode with \"option tcplog\" set on the\nfrontend, 3 control points are reported under the form \"tw/tc/tt\", and in http\nmode, 5 control points are reported under the form \"tq/tw/tc/tr/tt\" :\n\n  - tq: total time to get the client request (http mode only). it's the time\n    elapsed between the moment the client connection was accepted and the\n    moment the proxy received the last http header. the value \"-1\" indicates\n    that the end of headers (empty line) has never been seen. this happens when\n    the client closes prematurely or times out.\n\n  - tw: total time spent in the queues waiting for a connection slot. it\n    accounts for backend queue as well as the server queues, and depends on the\n    queue size, and the time needed for the server to complete previous\n    requests. the value \"-1\" means that the request was killed before reaching\n    the queue, which is generally what happens with invalid or denied requests.\n\n  - tc: total time to establish the tcp connection to the server. it's the time\n    elapsed between the moment the proxy sent the connection request, and the\n    moment it was acknowledged by the server, or between the tcp syn packet and\n    the matching syn/ack packet in return. the value \"-1\" means that the\n    connection never established.\n\n  - tr: server response time (http mode only). it's the time elapsed between\n    the moment the tcp connection was established to the server and the moment\n    the server sent its complete response headers. it purely shows its request\n    processing time, without the network overhead due to the data transmission.\n    it is worth noting that when the client has data to send to the server, for\n    instance during a post request, the time already runs, and this can distort\n    apparent response time. for this reason, it's generally wise not to trust\n    too much this field for post requests initiated from clients behind an\n    untrusted network. a value of \"-1\" here means that the last the response\n    header (empty line) was never seen, most likely because the server timeout\n    stroke before the server managed to process the request.\n\n  - tt: total session duration time, between the moment the proxy accepted it\n    and the moment both ends were closed. the exception is when the \"logasap\"\n    option is specified. in this case, it only equals (tq+tw+tc+tr), and is\n    prefixed with a '+' sign. from this field, we can deduce \"td\", the data\n    transmission time, by subtracting other timers when valid :\n\n        td = tt - (tq + tw + tc + tr)\n\n    timers with \"-1\" values have to be excluded from this equation. in tcp\n    mode, \"tq\" and \"tr\" have to be excluded too. note that \"tt\" can never be\n    negative.\n\nthese timers provide precious indications on trouble causes. since the tcp\nprotocol defines retransmit delays of 3, 6, 12... seconds, we know for sure\nthat timers close to multiples of 3s are nearly always related to lost packets\ndue to network problems (wires, negotiation, congestion). moreover, if \"tt\" is\nclose to a timeout value specified in the configuration, it often means that a\nsession has been aborted on timeout.\n\nmost common cases :\n\n  - if \"tq\" is close to 3000, a packet has probably been lost between the\n    client and the proxy. this is very rare on local networks but might happen\n    when clients are on far remote networks and send large requests. it may\n    happen that values larger than usual appear here without any network cause.\n    sometimes, during an attack or just after a resource starvation has ended,\n    haproxy may accept thousands of connections in a few milliseconds. the time\n    spent accepting these connections will inevitably slightly delay processing\n    of other connections, and it can happen that request times in the order of\n    a few tens of milliseconds are measured after a few thousands of new\n    connections have been accepted at once. setting \"option http-server-close\"\n    may display larger request times since \"tq\" also measures the time spent\n    waiting for additional requests.\n\n  - if \"tc\" is close to 3000, a packet has probably been lost between the\n    server and the proxy during the server connection phase. this value should\n    always be very low, such as 1 ms on local networks and less than a few tens\n    of ms on remote networks.\n\n  - if \"tr\" is nearly always lower than 3000 except some rare values which seem\n    to be the average majored by 3000, there are probably some packets lost\n    between the proxy and the server.\n\n  - if \"tt\" is large even for small byte counts, it generally is because\n    neither the client nor the server decides to close the connection, for\n    instance because both have agreed on a keep-alive connection mode. in order\n    to solve this issue, it will be needed to specify \"option httpclose\" on\n    either the frontend or the backend. if the problem persists, it means that\n    the server ignores the \"close\" connection mode and expects the client to\n    close. then it will be required to use \"option forceclose\". having the\n    smallest possible 'tt' is important when connection regulation is used with\n    the \"maxconn\" option on the servers, since no new connection will be sent\n    to the server until another one is released.\n\nother noticeable http log cases ('xx' means any value to be ignored) :\n\n  tq/tw/tc/tr/+tt  the \"option logasap\" is present on the frontend and the log\n                   was emitted before the data phase. all the timers are valid\n                   except \"tt\" which is shorter than reality.\n\n  -1/xx/xx/xx/tt   the client was not able to send a complete request in time\n                   or it aborted too early. check the session termination flags\n                   then \"timeout http-request\" and \"timeout client\" settings.\n\n  tq/-1/xx/xx/tt   it was not possible to process the request, maybe because\n                   servers were out of order, because the request was invalid\n                   or forbidden by acl rules. check the session termination\n                   flags.\n\n  tq/tw/-1/xx/tt   the connection could not establish on the server. either it\n                   actively refused it or it timed out after tt-(tq+tw) ms.\n                   check the session termination flags, then check the\n                   \"timeout connect\" setting. note that the tarpit action might\n                   return similar-looking patterns, with \"tw\" equal to the time\n                   the client connection was maintained open.\n\n  tq/tw/tc/-1/tt   the server has accepted the connection but did not return\n                   a complete response in time, or it closed its connection\n                   unexpectedly after tt-(tq+tw+tc) ms. check the session\n                   termination flags, then check the \"timeout server\" setting.\n\n8.5\\. session state at disconnection\n-----------------------------------\n\ntcp and http logs provide a session termination indicator in the\n\"termination_state\" field, just before the number of active connections. it is\n2-characters long in tcp mode, and is extended to 4 characters in http mode,\neach of which has a special meaning :\n\n  - on the first character, a code reporting the first event which caused the\n    session to terminate :\n\n        c : the tcp session was unexpectedly aborted by the client.\n\n        s : the tcp session was unexpectedly aborted by the server, or the\n            server explicitly refused it.\n\n        p : the session was prematurely aborted by the proxy, because of a\n            connection limit enforcement, because a deny filter was matched,\n            because of a security check which detected and blocked a dangerous\n            error in server response which might have caused information leak\n            (eg: cacheable cookie).\n\n        l : the session was locally processed by haproxy and was not passed to\n            a server. this is what happens for stats and redirects.\n\n        r : a resource on the proxy has been exhausted (memory, sockets, source\n            ports, ...). usually, this appears during the connection phase, and\n            system logs should contain a copy of the precise error. if this\n            happens, it must be considered as a very serious anomaly which\n            should be fixed as soon as possible by any means.\n\n        i : an internal error was identified by the proxy during a self-check.\n            this should never happen, and you are encouraged to report any log\n            containing this, because this would almost certainly be a bug. it\n            would be wise to preventively restart the process after such an\n            event too, in case it would be caused by memory corruption.\n\n        d : the session was killed by haproxy because the server was detected\n            as down and was configured to kill all connections when going down.\n\n        u : the session was killed by haproxy on this backup server because an\n            active server was detected as up and was configured to kill all\n            backup connections when going up.\n\n        k : the session was actively killed by an admin operating on haproxy.\n\n        c : the client-side timeout expired while waiting for the client to\n            send or receive data.\n\n        s : the server-side timeout expired while waiting for the server to\n            send or receive data.\n\n        - : normal session completion, both the client and the server closed\n            with nothing left in the buffers.\n\n  - on the second character, the tcp or http session state when it was closed :\n\n        r : the proxy was waiting for a complete, valid request from the client\n            (http mode only). nothing was sent to any server.\n\n        q : the proxy was waiting in the queue for a connection slot. this can\n            only happen when servers have a 'maxconn' parameter set. it can\n            also happen in the global queue after a redispatch consecutive to\n            a failed attempt to connect to a dying server. if no redispatch is\n            reported, then no connection attempt was made to any server.\n\n        c : the proxy was waiting for the connection to establish on the\n            server. the server might at most have noticed a connection attempt.\n\n        h : the proxy was waiting for complete, valid response headers from the\n            server (http only).\n\n        d : the session was in the data phase.\n\n        l : the proxy was still transmitting last data to the client while the\n            server had already finished. this one is very rare as it can only\n            happen when the client dies while receiving the last packets.\n\n        t : the request was tarpitted. it has been held open with the client\n            during the whole \"timeout tarpit\" duration or until the client\n            closed, both of which will be reported in the \"tw\" timer.\n\n        - : normal session completion after end of data transfer.\n\n  - the third character tells whether the persistence cookie was provided by\n    the client (only in http mode) :\n\n        n : the client provided no cookie. this is usually the case for new\n            visitors, so counting the number of occurrences of this flag in the\n            logs generally indicate a valid trend for the site frequentation.\n\n        i : the client provided an invalid cookie matching no known server.\n            this might be caused by a recent configuration change, mixed\n            cookies between http/https sites, persistence conditionally\n            ignored, or an attack.\n\n        d : the client provided a cookie designating a server which was down,\n            so either \"option persist\" was used and the client was sent to\n            this server, or it was not set and the client was redispatched to\n            another server.\n\n        v : the client provided a valid cookie, and was sent to the associated\n            server.\n\n        e : the client provided a valid cookie, but with a last date which was\n            older than what is allowed by the \"maxidle\" cookie parameter, so\n            the cookie is consider expired and is ignored. the request will be\n            redispatched just as if there was no cookie.\n\n        o : the client provided a valid cookie, but with a first date which was\n            older than what is allowed by the \"maxlife\" cookie parameter, so\n            the cookie is consider too old and is ignored. the request will be\n            redispatched just as if there was no cookie.\n\n        u : a cookie was present but was not used to select the server because\n            some other server selection mechanism was used instead (typically a\n            \"use-server\" rule).\n\n        - : does not apply (no cookie set in configuration).\n\n  - the last character reports what operations were performed on the persistence\n    cookie returned by the server (only in http mode) :\n\n        n : no cookie was provided by the server, and none was inserted either.\n\n        i : no cookie was provided by the server, and the proxy inserted one.\n            note that in \"cookie insert\" mode, if the server provides a cookie,\n            it will still be overwritten and reported as \"i\" here.\n\n        u : the proxy updated the last date in the cookie that was presented by\n            the client. this can only happen in insert mode with \"maxidle\". it\n            happens every time there is activity at a different date than the\n            date indicated in the cookie. if any other change happens, such as\n            a redispatch, then the cookie will be marked as inserted instead.\n\n        p : a cookie was provided by the server and transmitted as-is.\n\n        r : the cookie provided by the server was rewritten by the proxy, which\n            happens in \"cookie rewrite\" or \"cookie prefix\" modes.\n\n        d : the cookie provided by the server was deleted by the proxy.\n\n        - : does not apply (no cookie set in configuration).\n\nthe combination of the two first flags gives a lot of information about what\nwas happening when the session terminated, and why it did terminate. it can be\nhelpful to detect server saturation, network troubles, local system resource\nstarvation, attacks, etc...\n\nthe most common termination flags combinations are indicated below. they are\nalphabetically sorted, with the lowercase set just after the upper case for\neasier finding and understanding.\n\n  flags   reason\n\n     --   normal termination.\n\n     cc   the client aborted before the connection could be established to the\n          server. this can happen when haproxy tries to connect to a recently\n          dead (or unchecked) server, and the client aborts while haproxy is\n          waiting for the server to respond or for \"timeout connect\" to expire.\n\n     cd   the client unexpectedly aborted during data transfer. this can be\n          caused by a browser crash, by an intermediate equipment between the\n          client and haproxy which decided to actively break the connection,\n          by network routing issues between the client and haproxy, or by a\n          keep-alive session between the server and the client terminated first\n          by the client.\n\n     cd   the client did not send nor acknowledge any data for as long as the\n          \"timeout client\" delay. this is often caused by network failures on\n          the client side, or the client simply leaving the net uncleanly.\n\n     ch   the client aborted while waiting for the server to start responding.\n          it might be the server taking too long to respond or the client\n          clicking the 'stop' button too fast.\n\n     ch   the \"timeout client\" stroke while waiting for client data during a\n          post request. this is sometimes caused by too large tcp mss values\n          for pppoe networks which cannot transport full-sized packets. it can\n          also happen when client timeout is smaller than server timeout and\n          the server takes too long to respond.\n\n     cq   the client aborted while its session was queued, waiting for a server\n          with enough empty slots to accept it. it might be that either all the\n          servers were saturated or that the assigned server was taking too\n          long a time to respond.\n\n     cr   the client aborted before sending a full http request. most likely\n          the request was typed by hand using a telnet client, and aborted\n          too early. the http status code is likely a 400 here. sometimes this\n          might also be caused by an ids killing the connection between haproxy\n          and the client. \"option http-ignore-probes\" can be used to ignore\n          connections without any data transfer.\n\n     cr   the \"timeout http-request\" stroke before the client sent a full http\n          request. this is sometimes caused by too large tcp mss values on the\n          client side for pppoe networks which cannot transport full-sized\n          packets, or by clients sending requests by hand and not typing fast\n          enough, or forgetting to enter the empty line at the end of the\n          request. the http status code is likely a 408 here. note: recently,\n          some browsers started to implement a \"pre-connect\" feature consisting\n          in speculatively connecting to some recently visited web sites just\n          in case the user would like to visit them. this results in many\n          connections being established to web sites, which end up in 408\n          request timeout if the timeout strikes first, or 400 bad request when\n          the browser decides to close them first. these ones pollute the log\n          and feed the error counters. some versions of some browsers have even\n          been reported to display the error code. it is possible to work\n          around the undesirable effects of this behaviour by adding \"option\n          http-ignore-probes\" in the frontend, resulting in connections with\n          zero data transfer to be totally ignored. this will definitely hide\n          the errors of people experiencing connectivity issues though.\n\n     ct   the client aborted while its session was tarpitted. it is important to\n          check if this happens on valid requests, in order to be sure that no\n          wrong tarpit rules have been written. if a lot of them happen, it\n          might make sense to lower the \"timeout tarpit\" value to something\n          closer to the average reported \"tw\" timer, in order not to consume\n          resources for just a few attackers.\n\n     lr   the request was intercepted and locally handled by haproxy. generally\n          it means that this was a redirect or a stats request.\n\n     sc   the server or an equipment between it and haproxy explicitly refused\n          the tcp connection (the proxy received a tcp rst or an icmp message\n          in return). under some circumstances, it can also be the network\n          stack telling the proxy that the server is unreachable (eg: no route,\n          or no arp response on local network). when this happens in http mode,\n          the status code is likely a 502 or 503 here.\n\n     sc   the \"timeout connect\" stroke before a connection to the server could\n          complete. when this happens in http mode, the status code is likely a\n          503 or 504 here.\n\n     sd   the connection to the server died with an error during the data\n          transfer. this usually means that haproxy has received an rst from\n          the server or an icmp message from an intermediate equipment while\n          exchanging data with the server. this can be caused by a server crash\n          or by a network issue on an intermediate equipment.\n\n     sd   the server did not send nor acknowledge any data for as long as the\n          \"timeout server\" setting during the data phase. this is often caused\n          by too short timeouts on l4 equipments before the server (firewalls,\n          load-balancers, ...), as well as keep-alive sessions maintained\n          between the client and the server expiring first on haproxy.\n\n     sh   the server aborted before sending its full http response headers, or\n          it crashed while processing the request. since a server aborting at\n          this moment is very rare, it would be wise to inspect its logs to\n          control whether it crashed and why. the logged request may indicate a\n          small set of faulty requests, demonstrating bugs in the application.\n          sometimes this might also be caused by an ids killing the connection\n          between haproxy and the server.\n\n     sh   the \"timeout server\" stroke before the server could return its\n          response headers. this is the most common anomaly, indicating too\n          long transactions, probably caused by server or database saturation.\n          the immediate workaround consists in increasing the \"timeout server\"\n          setting, but it is important to keep in mind that the user experience\n          will suffer from these long response times. the only long term\n          solution is to fix the application.\n\n     sq   the session spent too much time in queue and has been expired. see\n          the \"timeout queue\" and \"timeout connect\" settings to find out how to\n          fix this if it happens too often. if it often happens massively in\n          short periods, it may indicate general problems on the affected\n          servers due to i/o or database congestion, or saturation caused by\n          external attacks.\n\n     pc   the proxy refused to establish a connection to the server because the\n          process' socket limit has been reached while attempting to connect.\n          the global \"maxconn\" parameter may be increased in the configuration\n          so that it does not happen anymore. this status is very rare and\n          might happen when the global \"ulimit-n\" parameter is forced by hand.\n\n     pd   the proxy blocked an incorrectly formatted chunked encoded message in\n          a request or a response, after the server has emitted its headers. in\n          most cases, this will indicate an invalid message from the server to\n          the client. haproxy supports chunk sizes of up to 2gb - 1 (2147483647\n          bytes). any larger size will be considered as an error.\n\n     ph   the proxy blocked the server's response, because it was invalid,\n          incomplete, dangerous (cache control), or matched a security filter.\n          in any case, an http 502 error is sent to the client. one possible\n          cause for this error is an invalid syntax in an http header name\n          containing unauthorized characters. it is also possible but quite\n          rare, that the proxy blocked a chunked-encoding request from the\n          client due to an invalid syntax, before the server responded. in this\n          case, an http 400 error is sent to the client and reported in the\n          logs.\n\n     pr   the proxy blocked the client's http request, either because of an\n          invalid http syntax, in which case it returned an http 400 error to\n          the client, or because a deny filter matched, in which case it\n          returned an http 403 error.\n\n     pt   the proxy blocked the client's request and has tarpitted its\n          connection before returning it a 500 server error. nothing was sent\n          to the server. the connection was maintained open for as long as\n          reported by the \"tw\" timer field.\n\n     rc   a local resource has been exhausted (memory, sockets, source ports)\n          preventing the connection to the server from establishing. the error\n          logs will tell precisely what was missing. this is very rare and can\n          only be solved by proper system tuning.\n\nthe combination of the two last flags gives a lot of information about how\npersistence was handled by the client, the server and by haproxy. this is very\nimportant to troubleshoot disconnections, when users complain they have to\nre-authenticate. the commonly encountered flags are :\n\n     --   persistence cookie is not enabled.\n\n     nn   no cookie was provided by the client, none was inserted in the\n          response. for instance, this can be in insert mode with \"postonly\"\n          set on a get request.\n\n     ii   a cookie designating an invalid server was provided by the client,\n          a valid one was inserted in the response. this typically happens when\n          a \"server\" entry is removed from the configuration, since its cookie\n          value can be presented by a client when no other server knows it.\n\n     ni   no cookie was provided by the client, one was inserted in the\n          response. this typically happens for first requests from every user\n          in \"insert\" mode, which makes it an easy way to count real users.\n\n     vn   a cookie was provided by the client, none was inserted in the\n          response. this happens for most responses for which the client has\n          already got a cookie.\n\n     vu   a cookie was provided by the client, with a last visit date which is\n          not completely up-to-date, so an updated cookie was provided in\n          response. this can also happen if there was no date at all, or if\n          there was a date but the \"maxidle\" parameter was not set, so that the\n          cookie can be switched to unlimited time.\n\n     ei   a cookie was provided by the client, with a last visit date which is\n          too old for the \"maxidle\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     oi   a cookie was provided by the client, with a first visit date which is\n          too old for the \"maxlife\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     di   the server designated by the cookie was down, a new server was\n          selected and a new cookie was emitted in the response.\n\n     vi   the server designated by the cookie was not marked dead but could not\n          be reached. a redispatch happened and selected another one, which was\n          then advertised in the response.\n\n8.6\\. non-printable characters\n-----------------------------\n\nin order not to cause trouble to log analysis tools or terminals during log\nconsulting, non-printable characters are not sent as-is into log files, but are\nconverted to the two-digits hexadecimal representation of their ascii code,\nprefixed by the character '#'. the only characters that can be logged without\nbeing escaped are comprised between 32 and 126 (inclusive). obviously, the\nescape character '#' itself is also encoded to avoid any ambiguity (\"#23\"). it\nis the same for the character '\"' which becomes \"#22\", as well as '{', '|' and\n'}' when logging headers.\n\nnote that the space character (' ') is not encoded in headers, which can cause\nissues for tools relying on space count to locate fields. a typical header\ncontaining spaces is \"user-agent\".\n\nlast, it has been observed that some syslog daemons such as syslog-ng escape\nthe quote ('\"') with a backslash ('\\'). the reverse operation can safely be\nperformed since no quote may appear anywhere else in the logs.\n\n8.7\\. capturing http cookies\n---------------------------\n\ncookie capture simplifies the tracking a complete user session. this can be\nachieved using the \"capture cookie\" statement in the frontend. please refer to\nsection 4.2 for more details. only one cookie can be captured, and the same\ncookie will simultaneously be checked in the request (\"cookie:\" header) and in\nthe response (\"set-cookie:\" header). the respective values will be reported in\nthe http logs at the \"captured_request_cookie\" and \"captured_response_cookie\"\nlocations (see section 8.2.3 about http log format). when either cookie is\nnot seen, a dash ('-') replaces the value. this way, it's easy to detect when a\nuser switches to a new session for example, because the server will reassign it\na new cookie. it is also possible to detect if a server unexpectedly sets a\nwrong cookie to a client, leading to session crossing.\n\n  examples :\n        # capture the first cookie whose name starts with \"aspsession\"\n        capture cookie aspsession len 32\n\n        # capture the first cookie whose name is exactly \"vgnvisitor\"\n        capture cookie vgnvisitor= len 32\n\n8.8\\. capturing http headers\n---------------------------\n\nheader captures are useful to track unique request identifiers set by an upper\nproxy, virtual host names, user-agents, post content-length, referrers, etc. in\nthe response, one can search for information about the response length, how the\nserver asked the cache to behave, or an object location during a redirection.\n\nheader captures are performed using the \"capture request header\" and \"capture\nresponse header\" statements in the frontend. please consult their definition in\nsection 4.2 for more details.\n\nit is possible to include both request headers and response headers at the same\ntime. non-existent headers are logged as empty strings, and if one header\nappears more than once, only its last occurrence will be logged. request headers\nare grouped within braces '{' and '}' in the same order as they were declared,\nand delimited with a vertical bar '|' without any space. response headers\nfollow the same representation, but are displayed after a space following the\nrequest headers block. these blocks are displayed just before the http request\nin the logs.\n\nas a special case, it is possible to specify an http header capture in a tcp\nfrontend. the purpose is to enable logging of headers which will be parsed in\nan http backend if the request is then switched to this http backend.\n\n  example :\n        # this instance chains to the outgoing proxy\n        listen proxy-out\n            mode http\n            option httplog\n            option logasap\n            log global\n            server cache1 192.168.1.1:3128\n\n            # log the name of the virtual server\n            capture request  header host len 20\n\n            # log the amount of data uploaded during a post\n            capture request  header content-length len 10\n\n            # log the beginning of the referrer\n            capture request  header referer len 20\n\n            # server name (useful for outgoing proxies only)\n            capture response header server len 20\n\n            # logging the content-length is useful with \"option logasap\"\n            capture response header content-length len 10\n\n            # log the expected cache behaviour on the response\n            capture response header cache-control len 8\n\n            # the via header will report the next proxy's name\n            capture response header via len 20\n\n            # log the url location during a redirection\n            capture response header location len 20\n\n    >>> aug  9 20:26:09 localhost \\\n          haproxy[2022]: 127.0.0.1:34014 [09/aug/2004:20:26:09] proxy-out \\\n          proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \\\n          {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \\\n          \"get http://fr.adserver.yahoo.com/\"\n\n    >>> aug  9 20:30:46 localhost \\\n          haproxy[2022]: 127.0.0.1:34020 [09/aug/2004:20:30:46] proxy-out \\\n          proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \\\n          {w.ods.org||} {formilux/0.1.8|3495|||} \\\n          \"get http://trafic.1wt.eu/ http/1.1\"\n\n    >>> aug  9 20:30:46 localhost \\\n          haproxy[2022]: 127.0.0.1:34028 [09/aug/2004:20:30:46] proxy-out \\\n          proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \\\n          {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \\\n          {apache|230|||http://www.sytadin.} \\\n          \"get http://www.sytadin.equipement.gouv.fr/ http/1.1\"\n\n8.9\\. examples of logs\n---------------------\n\nthese are real-world examples of logs accompanied with an explanation. some of\nthem have been made up by hand. the syslog part has been removed for better\nreading. their sole purpose is to explain how to decipher them.\n\n    >>> haproxy[674]: 127.0.0.1:33318 [15/oct/2003:08:31:57.130] px-http \\\n          px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \\\n          \"head / http/1.0\"\n\n    => long request (6.5s) entered by hand through 'telnet'. the server replied\n       in 147 ms, and the session ended normally ('----')\n\n    >>> haproxy[674]: 127.0.0.1:33319 [15/oct/2003:08:31:57.149] px-http \\\n          px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \\\n          0/9 \"head / http/1.0\"\n\n    => idem, but the request was queued in the global queue behind 9 other\n       requests, and waited there for 1230 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.654] px-http \\\n          px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \\\n          \"get /image.iso http/1.0\"\n\n    => request for a long data transfer. the \"logasap\" option was specified, so\n       the log was produced just before transferring data. the server replied in\n       14 ms, 243 bytes of headers were sent to the client, and total time from\n       accept to first data byte is 30 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.925] px-http \\\n          px-http/srv1 9/0/7/14/30 502 243 - - ph-- 3/2/2/0/0 0/0 \\\n          \"get /cgi-bin/bug.cgi? http/1.0\"\n\n    => the proxy blocked a server response either because of an \"rspdeny\" or\n       \"rspideny\" filter, or because the response was improperly formatted and\n       not http-compliant, or because it blocked sensitive information which\n       risked being cached. in this case, the response is replaced with a \"502\n       bad gateway\". the flags (\"ph--\") tell us that it was haproxy who decided\n       to return the 502 and not the server.\n\n    >>> haproxy[18113]: 127.0.0.1:34548 [15/oct/2003:15:18:55.798] px-http \\\n          px-http/<nosrv> -1/-1/-1/-1/8490 -1 0 - - cr-- 2/2/2/0/0 0/0 \"\"\n\n    => the client never completed its request and aborted itself (\"c---\") after\n       8.5s, while the proxy was waiting for the request headers (\"-r--\").\n       nothing was sent to any server.\n\n    >>> haproxy[18113]: 127.0.0.1:34549 [15/oct/2003:15:19:06.103] px-http \\\n         px-http/<nosrv> -1/-1/-1/-1/50001 408 0 - - cr-- 2/2/2/0/0 0/0 \"\"\n\n    => the client never completed its request, which was aborted by the\n       time-out (\"c---\") after 50s, while the proxy was waiting for the request\n       headers (\"-r--\").  nothing was sent to any server, but the proxy could\n       send a 408 return code to the client.\n\n    >>> haproxy[18989]: 127.0.0.1:34550 [15/oct/2003:15:24:28.312] px-tcp \\\n          px-tcp/srv1 0/0/5007 0 cd 0/0/0/0/0 0/0\n\n    => this log was produced with \"option tcplog\". the client timed out after\n       5 seconds (\"c----\").\n\n    >>> haproxy[18989]: 10.0.0.1:34552 [15/oct/2003:15:26:31.462] px-http \\\n          px-http/srv1 3183/-1/-1/-1/11215 503 0 - - sc-- 205/202/202/115/3 \\\n          0/0 \"head / http/1.0\"\n\n    => the request took 3s to complete (probably a network problem), and the\n       connection to the server failed ('sc--') after 4 attempts of 2 seconds\n       (config says 'retries 3'), and no redispatch (otherwise we would have\n       seen \"/+3\"). status code 503 was returned to the client. there were 115\n       connections on this server, 202 connections on this proxy, and 205 on\n       the global process. it is possible that the server refused the\n       connection because of too many already established.\n\n9\\. statistics and monitoring\n----------------------------\n\nit is possible to query haproxy about its status. the most commonly used\nmechanism is the http statistics page. this page also exposes an alternative\ncsv output format for monitoring tools. the same format is provided on the\nunix socket.\n\n9.1\\. csv format\n---------------\n\nthe statistics may be consulted either from the unix socket or from the http\npage. both means provide a csv format whose fields follow. the first line\nbegins with a sharp ('#') and has one word per comma-delimited field which\nrepresents the title of the column. all other lines starting at the second one\nuse a classical csv format using a comma as the delimiter, and the double quote\n('\"') as an optional text delimiter, but only if the enclosed text is ambiguous\n(if it contains a quote or a comma). the double-quote character ('\"') in the\ntext is doubled ('\"\"'), which is the format that most tools recognize. please\ndo not insert any column before these ones in order not to break tools which\nuse hard-coded column positions.\n\nin brackets after each field name are the types which may have a value for\nthat field. the types are l (listeners), f (frontends), b (backends), and\ns (servers).\n\n  0\\. pxname [lfbs]: proxy name\n  1\\. svname [lfbs]: service name (frontend for frontend, backend for backend,\n     any name for server/listener)\n  2\\. qcur [..bs]: current queued requests. for the backend this reports the\n     number queued without a server assigned.\n  3\\. qmax [..bs]: max value of qcur\n  4\\. scur [lfbs]: current sessions\n  5\\. smax [lfbs]: max sessions\n  6\\. slim [lfbs]: configured session limit\n  7\\. stot [lfbs]: cumulative number of connections\n  8\\. bin [lfbs]: bytes in\n  9\\. bout [lfbs]: bytes out\n 10\\. dreq [lfb.]: requests denied because of security concerns.\n     - for tcp this is because of a matched tcp-request content rule.\n     - for http this is because of a matched http-request or tarpit rule.\n 11\\. dresp [lfbs]: responses denied because of security concerns.\n     - for http this is because of a matched http-request rule, or\n       \"option checkcache\".\n 12\\. ereq [lf..]: request errors. some of the possible causes are:\n     - early termination from the client, before the request has been sent.\n     - read error from the client\n     - client timeout\n     - client closed connection\n     - various bad requests from the client.\n     - request was tarpitted.\n 13\\. econ [..bs]: number of requests that encountered an error trying to\n     connect to a backend server. the backend stat is the sum of the stat\n     for all servers of that backend, plus any connection errors not\n     associated with a particular server (such as the backend having no\n     active servers).\n 14\\. eresp [..bs]: response errors. srv_abrt will be counted here also.\n     some other errors are:\n     - write error on the client socket (won't be counted for the server stat)\n     - failure applying filters to the response.\n 15\\. wretr [..bs]: number of times a connection to a server was retried.\n 16\\. wredis [..bs]: number of times a request was redispatched to another\n     server. the server value counts the number of times that server was\n     switched away from.\n 17\\. status [lfbs]: status (up/down/nolb/maint/maint(via)...)\n 18\\. weight [..bs]: total weight (backend), server weight (server)\n 19\\. act [..bs]: number of active servers (backend), server is active (server)\n 20\\. bck [..bs]: number of backup servers (backend), server is backup (server)\n 21\\. chkfail [...s]: number of failed checks. (only counts checks failed when\n     the server is up.)\n 22\\. chkdown [..bs]: number of up->down transitions. the backend counter counts\n     transitions to the whole backend being down, rather than the sum of the\n     counters for each server.\n 23\\. lastchg [..bs]: number of seconds since the last up<->down transition\n 24\\. downtime [..bs]: total downtime (in seconds). the value for the backend\n     is the downtime for the whole backend, not the sum of the server downtime.\n 25\\. qlimit [...s]: configured maxqueue for the server, or nothing in the\n     value is 0 (default, meaning no limit)\n 26\\. pid [lfbs]: process id (0 for first instance, 1 for second, ...)\n 27\\. iid [lfbs]: unique proxy id\n 28\\. sid [l..s]: server id (unique inside a proxy)\n 29\\. throttle [...s]: current throttle percentage for the server, when\n     slowstart is active, or no value if not in slowstart.\n 30\\. lbtot [..bs]: total number of times a server was selected, either for new\n     sessions, or when re-dispatching. the server counter is the number\n     of times that server was selected.\n 31\\. tracked [...s]: id of proxy/server if tracking is enabled.\n 32\\. type [lfbs]: (0=frontend, 1=backend, 2=server, 3=socket/listener)\n 33\\. rate [.fbs]: number of sessions per second over last elapsed second\n 34\\. rate_lim [.f..]: configured limit on new sessions per second\n 35\\. rate_max [.fbs]: max number of new sessions per second\n 36\\. check_status [...s]: status of last health check, one of:\n        unk     -> unknown\n        ini     -> initializing\n        sockerr -> socket error\n        l4ok    -> check passed on layer 4, no upper layers testing enabled\n        l4tout  -> layer 1-4 timeout\n        l4con   -> layer 1-4 connection problem, for example\n                   \"connection refused\" (tcp rst) or \"no route to host\" (icmp)\n        l6ok    -> check passed on layer 6\n        l6tout  -> layer 6 (ssl) timeout\n        l6rsp   -> layer 6 invalid response - protocol error\n        l7ok    -> check passed on layer 7\n        l7okc   -> check conditionally passed on layer 7, for example 404 with\n                   disable-on-404\n        l7tout  -> layer 7 (http/smtp) timeout\n        l7rsp   -> layer 7 invalid response - protocol error\n        l7sts   -> layer 7 response error, for example http 5xx\n 37\\. check_code [...s]: layer5-7 code, if available\n 38\\. check_duration [...s]: time in ms took to finish last health check\n 39\\. hrsp_1xx [.fbs]: http responses with 1xx code\n 40\\. hrsp_2xx [.fbs]: http responses with 2xx code\n 41\\. hrsp_3xx [.fbs]: http responses with 3xx code\n 42\\. hrsp_4xx [.fbs]: http responses with 4xx code\n 43\\. hrsp_5xx [.fbs]: http responses with 5xx code\n 44\\. hrsp_other [.fbs]: http responses with other codes (protocol error)\n 45\\. hanafail [...s]: failed health checks details\n 46\\. req_rate [.f..]: http requests per second over last elapsed second\n 47\\. req_rate_max [.f..]: max number of http requests per second observed\n 48\\. req_tot [.f..]: total number of http requests received\n 49\\. cli_abrt [..bs]: number of data transfers aborted by the client\n 50\\. srv_abrt [..bs]: number of data transfers aborted by the server\n     (inc. in eresp)\n 51\\. comp_in [.fb.]: number of http response bytes fed to the compressor\n 52\\. comp_out [.fb.]: number of http response bytes emitted by the compressor\n 53\\. comp_byp [.fb.]: number of bytes that bypassed the http compressor\n     (cpu/bw limit)\n 54\\. comp_rsp [.fb.]: number of http responses that were compressed\n 55\\. lastsess [..bs]: number of seconds since last session assigned to\n     server/backend\n 56\\. last_chk [...s]: last health check contents or textual error\n 57\\. last_agt [...s]: last agent check contents or textual error\n 58\\. qtime [..bs]: the average queue time in ms over the 1024 last requests\n 59\\. ctime [..bs]: the average connect time in ms over the 1024 last requests\n 60\\. rtime [..bs]: the average response time in ms over the 1024 last requests\n     (0 for tcp)\n 61\\. ttime [..bs]: the average total session time in ms over the 1024 last\n     requests\n\n9.2\\. unix socket commands\n-------------------------\n\nthe stats socket is not enabled by default. in order to enable it, it is\nnecessary to add one line in the global section of the haproxy configuration.\na second line is recommended to set a larger timeout, always appreciated when\nissuing commands by hand :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats timeout 2m\n\nit is also possible to add multiple instances of the stats socket by repeating\nthe line, and make them listen to a tcp port instead of a unix socket. this is\nnever done by default because this is dangerous, but can be handy in some\nsituations :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats socket ipv4@192.168.0.1:9999 level admin\n        stats timeout 2m\n\nto access the socket, an external utility such as \"socat\" is required. socat is a\nswiss-army knife to connect anything to anything. we use it to connect terminals\nto the socket, or a couple of stdin/stdout pipes to it for scripts. the two main\nsyntaxes we'll use are the following :\n\n    # socat /var/run/haproxy.sock stdio\n    # socat /var/run/haproxy.sock readline\n\nthe first one is used with scripts. it is possible to send the output of a\nscript to haproxy, and pass haproxy's output to another script. that's useful\nfor retrieving counters or attack traces for example.\n\nthe second one is only useful for issuing commands by hand. it has the benefit\nthat the terminal is handled by the readline library which supports line\nediting and history, which is very convenient when issuing repeated commands\n(eg: watch a counter).\n\nthe socket supports two operation modes :\n  - interactive\n  - non-interactive\n\nthe non-interactive mode is the default when socat connects to the socket. in\nthis mode, a single line may be sent. it is processed as a whole, responses are\nsent back, and the connection closes after the end of the response. this is the\nmode that scripts and monitoring tools use. it is possible to send multiple\ncommands in this mode, they need to be delimited by a semi-colon (';'). for\nexample :\n\n    # echo \"show info;show stat;show table\" | socat /var/run/haproxy stdio\n\nthe interactive mode displays a prompt ('>') and waits for commands to be\nentered on the line, then processes them, and displays the prompt again to wait\nfor a new command. this mode is entered via the \"prompt\" command which must be\nsent on the first line in non-interactive mode. the mode is a flip switch, if\n\"prompt\" is sent in interactive mode, it is disabled and the connection closes\nafter processing the last command of the same line.\n\nfor this reason, when debugging by hand, it's quite common to start with the\n\"prompt\" command :\n\n   # socat /var/run/haproxy readline\n   prompt\n   > show info\n   ...\n   >\n\nsince multiple commands may be issued at once, haproxy uses the empty line as a\ndelimiter to mark an end of output for each command, and takes care of ensuring\nthat no command can emit an empty line on output. a script can thus easily\nparse the output even when multiple commands were pipelined on a single line.\n\nit is important to understand that when multiple haproxy processes are started\non the same sockets, any process may pick up the request and will output its\nown stats.\n\nthe list of commands currently supported on the stats socket is provided below.\nif an unknown command is sent, haproxy displays the usage message which reminds\nall supported commands. some commands support a more complex syntax, generally\nit will explain what part of the command is invalid when this happens.\n\nadd acl <acl> <pattern>\n  add an entry into the acl <acl>. <acl> is the #<id> or the <file> returned by\n  \"show acl\". this command does not verify if the entry already exists. this\n  command cannot be used if the reference <acl> is a file also used with a map.\n  in this case, you must use the command \"add map\" in place of \"add acl\".\n\nadd map <map> <key> <value>\n  add an entry into the map <map> to associate the value <value> to the key\n  <key>. this command does not verify if the entry already exists. it is\n  mainly used to fill a map after a clear operation. note that if the reference\n  <map> is a file and is shared with a map, this map will contain also a new\n  pattern entry.\n\nclear counters\n  clear the max values of the statistics counters in each proxy (frontend &\n  backend) and in each server. the cumulated counters are not affected. this\n  can be used to get clean counters after an incident, without having to\n  restart nor to clear traffic counters. this command is restricted and can\n  only be issued on sockets configured for levels \"operator\" or \"admin\".\n\nclear counters all\n  clear all statistics counters in each proxy (frontend & backend) and in each\n  server. this has the same effect as restarting. this command is restricted\n  and can only be issued on sockets configured for level \"admin\".\n\nclear acl <acl>\n  remove all entries from the acl <acl>. <acl> is the #<id> or the <file>\n  returned by \"show acl\". note that if the reference <acl> is a file and is\n  shared with a map, this map will be also cleared.\n\nclear map <map>\n  remove all entries from the map <map>. <map> is the #<id> or the <file>\n  returned by \"show map\". note that if the reference <map> is a file and is\n  shared with a acl, this acl will be also cleared.\n\nclear table <table> [ data.<type> <operator> <value> ] | [ key <key> ]\n  remove entries from the stick-table <table>.\n\n  this is typically used to unblock some users complaining they have been\n  abusively denied access to a service, but this can also be used to clear some\n  stickiness entries matching a server that is going to be replaced (see \"show\n  table\" below for details).  note that sometimes, removal of an entry will be\n  refused because it is currently tracked by a session. retrying a few seconds\n  later after the session ends is usual enough.\n\n  in the case where no options arguments are given all entries will be removed.\n\n  when the \"data.\" form is used entries matching a filter applied using the\n  stored data (see \"stick-table\" in section 4.2) are removed.  a stored data\n  type must be specified in <type>, and this data type must be stored in the\n  table otherwise an error is reported. the data is compared according to\n  <operator> with the 64-bit integer <value>.  operators are the same as with\n  the acls :\n\n    - eq : match entries whose data is equal to this value\n    - ne : match entries whose data is not equal to this value\n    - le : match entries whose data is less than or equal to this value\n    - ge : match entries whose data is greater than or equal to this value\n    - lt : match entries whose data is less than this value\n    - gt : match entries whose data is greater than this value\n\n  when the key form is used the entry <key> is removed.  the key must be of the\n  same type as the table, which currently is limited to ipv4, ipv6, integer and\n  string.\n\n  example :\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \\\n          bytes_out_rate(60000)=187\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"clear table http_proxy key 127.0.0.1\" | socat stdio /tmp/sock1\n\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:1\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n        $ echo \"clear table http_proxy data.gpc0 eq 1\" | socat stdio /tmp/sock1\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:1\n\ndel acl <acl> [<key>|#<ref>]\n  delete all the acl entries from the acl <acl> corresponding to the key <key>.\n  <acl> is the #<id> or the <file> returned by \"show acl\". if the <ref> is used,\n  this command delete only the listed reference. the reference can be found with\n  listing the content of the acl. note that if the reference <acl> is a file and\n  is shared with a map, the entry will be also deleted in the map.\n\ndel map <map> [<key>|#<ref>]\n  delete all the map entries from the map <map> corresponding to the key <key>.\n  <map> is the #<id> or the <file> returned by \"show map\". if the <ref> is used,\n  this command delete only the listed reference. the reference can be found with\n  listing the content of the map. note that if the reference <map> is a file and\n  is shared with a acl, the entry will be also deleted in the map.\n\ndisable agent <backend>/<server>\n  mark the auxiliary agent check as temporarily stopped.\n\n  in the case where an agent check is being run as a auxiliary check, due\n  to the agent-check parameter of a server directive, new checks are only\n  initialised when the agent is in the enabled. thus, disable agent will\n  prevent any new agent checks from begin initiated until the agent\n  re-enabled using enable agent.\n\n  when an agent is disabled the processing of an auxiliary agent check that\n  was initiated while the agent was set as enabled is as follows: all\n  results that would alter the weight, specifically \"drain\" or a weight\n  returned by the agent, are ignored. the processing of agent check is\n  otherwise unchanged.\n\n  the motivation for this feature is to allow the weight changing effects\n  of the agent checks to be paused to allow the weight of a server to be\n  configured using set weight without being overridden by the agent.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable frontend <frontend>\n  mark the frontend as temporarily stopped. this corresponds to the mode which\n  is used during a soft restart : the frontend releases the port but can be\n  enabled again if needed. this should be used with care as some non-linux oses\n  are unable to enable it back. this is intended to be used in environments\n  where stopping a proxy is not even imaginable but a misconfigured proxy must\n  be fixed. that way it's possible to release the port and bind it into another\n  process to restore operations. the frontend will appear with status \"stop\"\n  on the stats page.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable health <backend>/<server>\n  mark the primary health check as temporarily stopped. this will disable\n  sending of health checks, and the last health check result will be ignored.\n  the server will be in unchecked state and considered up unless an auxiliary\n  agent check forces it down.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable server <backend>/<server>\n  mark the server down for maintenance. in this mode, no more checks will be\n  performed on the server until it leaves maintenance.\n  if the server is tracked by other servers, those servers will be set to down\n  during the maintenance.\n\n  in the statistics page, a server down for maintenance will appear with a\n  \"maint\" status, its tracking servers with the \"maint(via)\" one.\n\n  both the backend and the server may be specified either by their name or by\n  their numeric id, prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable agent <backend>/<server>\n  resume auxiliary agent check that was temporarily stopped.\n\n  see \"disable agent\" for details of the effect of temporarily starting\n  and stopping an auxiliary agent.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable frontend <frontend>\n  resume a frontend which was temporarily stopped. it is possible that some of\n  the listening ports won't be able to bind anymore (eg: if another process\n  took them since the 'disable frontend' operation). if this happens, an error\n  is displayed. some operating systems might not be able to resume a frontend\n  which was disabled.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable health <backend>/<server>\n  resume a primary health check that was temporarily stopped. this will enable\n  sending of health checks again. please see \"disable health\" for details.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable server <backend>/<server>\n  if the server was previously marked as down for maintenance, this marks the\n  server up and checks are re-enabled.\n\n  both the backend and the server may be specified either by their name or by\n  their numeric id, prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nget map <map> <value>\nget acl <acl> <value>\n  lookup the value <value> in the map <map> or in the acl <acl>. <map> or <acl>\n  are the #<id> or the <file> returned by \"show map\" or \"show acl\". this command\n  returns all the matching patterns associated with this map. this is useful for\n  debugging maps and acls. the output format is composed by one line par\n  matching type. each line is composed by space-delimited series of words.\n\n  the first two words are:\n\n     <match method>:   the match method applied. it can be \"found\", \"bool\",\n                       \"int\", \"ip\", \"bin\", \"len\", \"str\", \"beg\", \"sub\", \"dir\",\n                       \"dom\", \"end\" or \"reg\".\n\n     <match result>:   the result. can be \"match\" or \"no-match\".\n\n  the following words are returned only if the pattern matches an entry.\n\n     <index type>:     \"tree\" or \"list\". the internal lookup algorithm.\n\n     <case>:           \"case-insensitive\" or \"case-sensitive\". the\n                       interpretation of the case.\n\n     <entry matched>:  match=\"<entry>\". return the matched pattern. it is\n                       useful with regular expressions.\n\n  the two last word are used to show the returned value and its type. with the\n  \"acl\" case, the pattern doesn't exist.\n\n     return=nothing:        no return because there are no \"map\".\n     return=\"<value>\":      the value returned in the string format.\n     return=cannot-display: the value cannot be converted as string.\n\n     type=\"<type>\":         the type of the returned sample.\n\nget weight <backend>/<server>\n  report the current weight and the initial weight of server <server> in\n  backend <backend> or an error if either doesn't exist. the initial weight is\n  the one that appears in the configuration file. both are normally equal\n  unless the current weight has been changed. both the backend and the server\n  may be specified either by their name or by their numeric id, prefixed with a\n  sharp ('#').\n\nhelp\n  print the list of known keywords and their basic usage. the same help screen\n  is also displayed for unknown commands.\n\nprompt\n  toggle the prompt at the beginning of the line and enter or leave interactive\n  mode. in interactive mode, the connection is not closed after a command\n  completes. instead, the prompt will appear again, indicating the user that\n  the interpreter is waiting for a new command. the prompt consists in a right\n  angle bracket followed by a space \"> \". this mode is particularly convenient\n  when one wants to periodically check information such as stats or errors.\n  it is also a good idea to enter interactive mode before issuing a \"help\"\n  command.\n\nquit\n  close the connection when in interactive mode.\n\nset map <map> [<key>|#<ref>] <value>\n  modify the value corresponding to each key <key> in a map <map>. <map> is the\n  #<id> or <file> returned by \"show map\". if the <ref> is used in place of\n  <key>, only the entry pointed by <ref> is changed. the new value is <value>.\n\nset maxconn frontend <frontend> <value>\n  dynamically change the specified frontend's maxconn setting. any positive\n  value is allowed including zero, but setting values larger than the global\n  maxconn does not make much sense. if the limit is increased and connections\n  were pending, they will immediately be accepted. if it is lowered to a value\n  below the current number of connections, new connections acceptation will be\n  delayed until the threshold is reached. the frontend might be specified by\n  either its name or its numeric id prefixed with a sharp ('#').\n\nset maxconn global <maxconn>\n  dynamically change the global maxconn setting within the range defined by the\n  initial global maxconn setting. if it is increased and connections were\n  pending, they will immediately be accepted. if it is lowered to a value below\n  the current number of connections, new connections acceptation will be\n  delayed until the threshold is reached. a value of zero restores the initial\n  setting.\n\nset rate-limit connections global <value>\n  change the process-wide connection rate limit, which is set by the global\n  'maxconnrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of connections per second.\n\nset rate-limit http-compression global <value>\n  change the maximum input compression rate, which is set by the global\n  'maxcomprate' setting. a value of zero disables the limitation. the value is\n  passed in number of kilobytes per second. the value is available in the \"show\n  info\" on the line \"compressbpsratelim\" in bytes.\n\nset rate-limit sessions global <value>\n  change the process-wide session rate limit, which is set by the global\n  'maxsessrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of sessions per second.\n\nset rate-limit ssl-sessions global <value>\n  change the process-wide ssl session rate limit, which is set by the global\n  'maxsslrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of sessions per second sent to the ssl stack. it applies\n  before the handshake in order to protect the stack against handshake abuses.\n\nset server <backend>/<server> addr <ip4 or ip6 address>\n  replace the current ip address of a server by the one provided.\n\nset server <backend>/<server> agent [ up | down ]\n  force a server's agent to a new state. this can be useful to immediately\n  switch a server's state regardless of some slow agent checks for example.\n  note that the change is propagated to tracking servers if any.\n\nset server <backend>/<server> health [ up | stopping | down ]\n  force a server's health to a new state. this can be useful to immediately\n  switch a server's state regardless of some slow health checks for example.\n  note that the change is propagated to tracking servers if any.\n\nset server <backend>/<server> state [ ready | drain | maint ]\n  force a server's administrative state to a new state. this can be useful to\n  disable load balancing and/or any traffic to a server. setting the state to\n  \"ready\" puts the server in normal mode, and the command is the equivalent of\n  the \"enable server\" command. setting the state to \"maint\" disables any traffic\n  to the server as well as any health checks. this is the equivalent of the\n  \"disable server\" command. setting the mode to \"drain\" only removes the server\n  from load balancing but still allows it to be checked and to accept new\n  persistent connections. changes are propagated to tracking servers if any.\n\nset server <backend>/<server> weight <weight>[%]\n  change a server's weight to the value passed in argument. this is the exact\n  equivalent of the \"set weight\" command below.\n\nset ssl ocsp-response <response>\n  this command is used to update an ocsp response for a certificate (see \"crt\"\n  on \"bind\" lines). same controls are performed as during the initial loading of\n  the response. the <response> must be passed as a base64 encoded string of the\n  der encoded response from the ocsp server.\n\n  example:\n    openssl ocsp -issuer issuer.pem -cert server.pem \\\n                 -host ocsp.issuer.com:80 -respout resp.der\n    echo \"set ssl ocsp-response $(base64 -w 10000 resp.der)\" | \\\n                 socat stdio /var/run/haproxy.stat\n\nset ssl tls-key <id> <tlskey>\n  set the next tls key for the <id> listener to <tlskey>. this key becomes the\n  ultimate key, while the penultimate one is used for encryption (others just\n  decrypt). the oldest tls key present is overwritten. <id> is either a numeric\n  #<id> or <file> returned by \"show tls-keys\". <tlskey> is a base64 encoded 48\n  bit tls ticket key (ex. openssl rand -base64 48).\n\nset table <table> key <key> [data.<data_type> <value>]*\n  create or update a stick-table entry in the table. if the key is not present,\n  an entry is inserted. see stick-table in section 4.2 to find all possible\n  values for <data_type>. the most likely use consists in dynamically entering\n  entries for source ip addresses, with a flag in gpc0 to dynamically block an\n  ip address or affect its quality of service. it is possible to pass multiple\n  data_types in a single call.\n\nset timeout cli <delay>\n  change the cli interface timeout for current connection. this can be useful\n  during long debugging sessions where the user needs to constantly inspect\n  some indicators without being disconnected. the delay is passed in seconds.\n\nset weight <backend>/<server> <weight>[%]\n  change a server's weight to the value passed in argument. if the value ends\n  with the '%' sign, then the new weight will be relative to the initially\n  configured weight.  absolute weights are permitted between 0 and 256.\n  relative weights must be positive with the resulting absolute weight is\n  capped at 256\\.  servers which are part of a farm running a static\n  load-balancing algorithm have stricter limitations because the weight\n  cannot change once set. thus for these servers, the only accepted values\n  are 0 and 100% (or 0 and the initial weight). changes take effect\n  immediately, though certain lb algorithms require a certain amount of\n  requests to consider changes. a typical usage of this command is to\n  disable a server during an update by setting its weight to zero, then to\n  enable it again after the update by setting it back to 100%. this command\n  is restricted and can only be issued on sockets configured for level\n  \"admin\". both the backend and the server may be specified either by their\n  name or by their numeric id, prefixed with a sharp ('#').\n\nshow errors [<iid>]\n  dump last known request and response errors collected by frontends and\n  backends. if <iid> is specified, the limit the dump to errors concerning\n  either frontend or backend whose id is <iid>. this command is restricted\n  and can only be issued on sockets configured for levels \"operator\" or\n  \"admin\".\n\n  the errors which may be collected are the last request and response errors\n  caused by protocol violations, often due to invalid characters in header\n  names. the report precisely indicates what exact character violated the\n  protocol. other important information such as the exact date the error was\n  detected, frontend and backend names, the server name (when known), the\n  internal session id and the source address which has initiated the session\n  are reported too.\n\n  all characters are returned, and non-printable characters are encoded. the\n  most common ones (\\t = 9, \\n = 10, \\r = 13 and \\e = 27) are encoded as one\n  letter following a backslash. the backslash itself is encoded as '\\\\' to\n  avoid confusion. other non-printable characters are encoded '\\xnn' where\n  nn is the two-digits hexadecimal representation of the character's ascii\n  code.\n\n  lines are prefixed with the position of their first character, starting at 0\n  for the beginning of the buffer. at most one input line is printed per line,\n  and large lines will be broken into multiple consecutive output lines so that\n  the output never goes beyond 79 characters wide. it is easy to detect if a\n  line was broken, because it will not end with '\\n' and the next line's offset\n  will be followed by a '+' sign, indicating it is a continuation of previous\n  line.\n\n  example :\n        $ echo \"show errors\" | socat stdio /tmp/sock1\n    >>> [04/mar/2009:15:46:56.081] backend http-in (#2) : invalid response\n          src 127.0.0.1, session #54, frontend fe-eth0 (#1), server s2 (#1)\n          response length 213 bytes, error at position 23:\n\n          00000  http/1.0 200 ok\\r\\n\n          00017  header/bizarre:blah\\r\\n\n          00038  location: blah\\r\\n\n          00054  long-line: this is a very long line which should b\n          00104+ e broken into multiple lines on the output buffer,\n          00154+  otherwise it would be too large to print in a ter\n          00204+ minal\\r\\n\n          00211  \\r\\n\n\n    in the example above, we see that the backend \"http-in\" which has internal\n    id 2 has blocked an invalid response from its server s2 which has internal\n    id 1\\. the request was on session 54 initiated by source 127.0.0.1 and\n    received by frontend fe-eth0 whose id is 1\\. the total response length was\n    213 bytes when the error was detected, and the error was at byte 23\\. this\n    is the slash ('/') in header name \"header/bizarre\", which is not a valid\n    http character for a header name.\n\nshow info\n  dump info about haproxy status on current process.\n\nshow map [<map>]\n  dump info about map converters. without argument, the list of all available\n  maps is returned. if a <map> is specified, its contents are dumped. <map> is\n  the #<id> or <file>. the first column is a unique identifier. it can be used\n  as reference for the operation \"del map\" and \"set map\". the second column is\n  the pattern and the third column is the sample if available. the data returned\n  are not directly a list of available maps, but are the list of all patterns\n  composing any map. many of these patterns can be shared with acl.\n\nshow acl [<acl>]\n  dump info about acl converters. without argument, the list of all available\n  acls is returned. if a <acl> is specified, its contents are dumped. <acl> if\n  the #<id> or <file>. the dump format is the same than the map even for the\n  sample value. the data returned are not a list of available acl, but are the\n  list of all patterns composing any acl. many of these patterns can be shared\n  with maps.\n\nshow pools\n  dump the status of internal memory pools. this is useful to track memory\n  usage when suspecting a memory leak for example. it does exactly the same\n  as the sigquit when running in foreground except that it does not flush\n  the pools.\n\nshow sess\n  dump all known sessions. avoid doing this on slow connections as this can\n  be huge. this command is restricted and can only be issued on sockets\n  configured for levels \"operator\" or \"admin\".\n\nshow sess <id>\n  display a lot of internal information about the specified session identifier.\n  this identifier is the first field at the beginning of the lines in the dumps\n  of \"show sess\" (it corresponds to the session pointer). those information are\n  useless to most users but may be used by haproxy developers to troubleshoot a\n  complex bug. the output format is intentionally not documented so that it can\n  freely evolve depending on demands. you may find a description of all fields\n  returned in src/dumpstats.c\n\n  the special id \"all\" dumps the states of all sessions, which must be avoided\n  as much as possible as it is highly cpu intensive and can take a lot of time.\n\nshow stat [<iid> <type> <sid>]\n  dump statistics in the csv format. by passing <id>, <type> and <sid>, it is\n  possible to dump only selected items :\n    - <iid> is a proxy id, -1 to dump everything\n    - <type> selects the type of dumpable objects : 1 for frontends, 2 for\n       backends, 4 for servers, -1 for everything. these values can be ored,\n       for example:\n          1 + 2     = 3   -> frontend + backend.\n          1 + 2 + 4 = 7   -> frontend + backend + server.\n    - <sid> is a server id, -1 to dump everything from the selected proxy.\n\n  example :\n        $ echo \"show info;show stat\" | socat stdio unix-connect:/tmp/sock1\n    >>> name: haproxy\n        version: 1.4-dev2-49\n        release_date: 2009/09/23\n        nbproc: 1\n        process_num: 1\n        (...)\n\n        # pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)\n        stats,frontend,,,0,0,1000,0,0,0,0,0,0,,,,,open,,,,,,,,,1,1,0, (...)\n        stats,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,0,0,0,,0,250,(...)\n        (...)\n        www1,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,1,1,0,,0,250, (...)\n\n        $\n\n    here, two commands have been issued at once. that way it's easy to find\n    which process the stats apply to in multi-process mode. notice the empty\n    line after the information output which marks the end of the first block.\n    a similar empty line appears at the end of the second block (stats) so that\n    the reader knows the output has not been truncated.\n\nshow stat resolvers <resolvers section id>\n  dump statistics for the given resolvers section.\n  for each name server, the following counters are reported:\n    sent: number of dns requests sent to this server\n    valid: number of dns valid responses received from this server\n    update: number of dns responses used to update the server's ip address\n    cname: number of cname responses\n    cname_error: cname errors encountered with this server\n    any_err: number of empty response (ie: server does not support any type)\n    nx: non existent domain response received from this server\n    timeout: how many time this server did not answer in time\n    refused: number of requests refused by this server\n    other: any other dns errors\n    invalid: invalid dns response (from a protocol point of view)\n    too_big: too big response\n    outdated: number of response arrived too late (after an other name server)\nshow table\n  dump general information on all known stick-tables. their name is returned\n  (the name of the proxy which holds them), their type (currently zero, always\n  ip), their size in maximum possible number of entries, and the number of\n  entries currently in use.\n\n  example :\n        $ echo \"show table\" | socat stdio /tmp/sock1\n    >>> # table: front_pub, type: ip, size:204800, used:171454\n    >>> # table: back_rdp, type: ip, size:204800, used:0\n\nshow table <name> [ data.<type> <operator> <value> ] | [ key <key> ]\n  dump contents of stick-table <name>. in this mode, a first line of generic\n  information about the table is reported as with \"show table\", then all\n  entries are dumped. since this can be quite heavy, it is possible to specify\n  a filter in order to specify what entries to display.\n\n  when the \"data.\" form is used the filter applies to the stored data (see\n  \"stick-table\" in section 4.2).  a stored data type must be specified\n  in <type>, and this data type must be stored in the table otherwise an\n  error is reported. the data is compared according to <operator> with the\n  64-bit integer <value>.  operators are the same as with the acls :\n\n    - eq : match entries whose data is equal to this value\n    - ne : match entries whose data is not equal to this value\n    - le : match entries whose data is less than or equal to this value\n    - ge : match entries whose data is greater than or equal to this value\n    - lt : match entries whose data is less than this value\n    - gt : match entries whose data is greater than this value\n\n  when the key form is used the entry <key> is shown.  the key must be of the\n  same type as the table, which currently is limited to ipv4, ipv6, integer,\n  and string.\n\n  example :\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \\\n          bytes_out_rate(60000)=187\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy data.gpc0 gt 0\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy data.conn_rate gt 5\" | \\\n            socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy key 127.0.0.2\" | \\\n            socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n  when the data criterion applies to a dynamic value dependent on time such as\n  a bytes rate, the value is dynamically computed during the evaluation of the\n  entry in order to decide whether it has to be dumped or not. this means that\n  such a filter could match for some time then not match anymore because as\n  time goes, the average event rate drops.\n\n  it is possible to use this to extract lists of ip addresses abusing the\n  service, in order to monitor them or even blacklist them in a firewall.\n  example :\n        $ echo \"show table http_proxy data.gpc0 gt 0\" \\\n          | socat stdio /tmp/sock1 \\\n          | fgrep 'key=' | cut -d' ' -f2 | cut -d= -f2 > abusers-ip.txt\n          ( or | awk '/key/{ print a[split($2,a,\"=\")]; }' )\n\nshow tls-keys\n  dump all loaded tls ticket keys. the tls ticket key reference id and the\n  file from which the keys have been loaded is shown. both of those can be\n  used to update the tls keys using \"set ssl tls-key\".\n\nshutdown frontend <frontend>\n  completely delete the specified frontend. all the ports it was bound to will\n  be released. it will not be possible to enable the frontend anymore after\n  this operation. this is intended to be used in environments where stopping a\n  proxy is not even imaginable but a misconfigured proxy must be fixed. that\n  way it's possible to release the port and bind it into another process to\n  restore operations. the frontend will not appear at all on the stats page\n  once it is terminated.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nshutdown session <id>\n  immediately terminate the session matching the specified session identifier.\n  this identifier is the first field at the beginning of the lines in the dumps\n  of \"show sess\" (it corresponds to the session pointer). this can be used to\n  terminate a long-running session without waiting for a timeout or when an\n  endless transfer is ongoing. such terminated sessions are reported with a 'k'\n  flag in the logs.\n\nshutdown sessions server <backend>/<server>\n  immediately terminate all the sessions attached to the specified server. this\n  can be used to terminate long-running sessions after a server is put into\n  maintenance mode, for instance. such terminated sessions are reported with a\n  'k' flag in the logs.\n\n/*\n * local variables:\n *  fill-column: 79\n * end:\n */","source":"_posts/Haproxy-Configuration.md","raw":"---\ntitle: Haproxy Configuration\ntags: []\ndate: 2015-07-27 15:52:00\n---\n\n----------------------\n                                haproxy\n                          configuration manual\n                         ----------------------\n                              version 1.6\n                             willy tarreau\n                              2015/07/22\n\nthis document covers the configuration language as implemented in the version\nspecified above. it does not provide any hint, example or advice. for such\ndocumentation, please refer to the reference manual or the architecture manual.\nthe summary below is meant to help you search sections by name and navigate\nthrough the document.\n\nnote to documentation contributors :\n    this document is formatted with 80 columns per line, with even number of\n    spaces for indentation and without tabs. please follow these rules strictly\n    so that it remains easily printable everywhere. if a line needs to be\n    printed verbatim and does not fit, please end each line with a backslash\n    ('\\') and continue on next line, indented by two characters. it is also\n    sometimes useful to prefix all output lines (logs, console outs) with 3\n    closing angle brackets ('>>>') in order to help get the difference between\n    inputs and outputs when it can become ambiguous. if you add sections,\n    please update the summary below for easier searching.\n\nsummary\n-------\n\n1\\.    quick reminder about http\n1.1\\.      the http transaction model\n1.2\\.      http request\n1.2.1\\.        the request line\n1.2.2\\.        the request headers\n1.3\\.      http response\n1.3.1\\.        the response line\n1.3.2\\.        the response headers\n\n2\\.    configuring haproxy\n2.1\\.      configuration file format\n2.2\\.      quoting and escaping\n2.3\\.      environment variables\n2.4\\.      time format\n2.5\\.      examples\n\n3\\.    global parameters\n3.1\\.      process management and security\n3.2\\.      performance tuning\n3.3\\.      debugging\n3.4\\.      userlists\n3.5\\.      peers\n\n4\\.    proxies\n4.1\\.      proxy keywords matrix\n4.2\\.      alphabetically sorted keywords reference\n\n5\\.    bind and server options\n5.1\\.      bind options\n5.2\\.      server and default-server options\n5.3\\.      server dns resolution\n5.3.1\\.      global overview\n5.3.2\\.      the resolvers section\n\n6\\.    http header manipulation\n\n7\\.    using acls and fetching samples\n7.1\\.      acl basics\n7.1.1\\.      matching booleans\n7.1.2\\.      matching integers\n7.1.3\\.      matching strings\n7.1.4\\.      matching regular expressions (regexes)\n7.1.5\\.      matching arbitrary data blocks\n7.1.6\\.      matching ipv4 and ipv6 addresses\n7.2\\.      using acls to form conditions\n7.3\\.      fetching samples\n7.3.1\\.        converters\n7.3.2\\.        fetching samples from internal states\n7.3.3\\.        fetching samples at layer 4\n7.3.4\\.        fetching samples at layer 5\n7.3.5\\.        fetching samples from buffer contents (layer 6)\n7.3.6\\.        fetching http samples (layer 7)\n7.4\\.      pre-defined acls\n\n8\\.    logging\n8.1\\.      log levels\n8.2\\.      log formats\n8.2.1\\.        default log format\n8.2.2\\.        tcp log format\n8.2.3\\.        http log format\n8.2.4\\.        custom log format\n8.2.5\\.        error log format\n8.3\\.      advanced logging options\n8.3.1\\.        disabling logging of external tests\n8.3.2\\.        logging before waiting for the session to terminate\n8.3.3\\.        raising log level upon errors\n8.3.4\\.        disabling logging of successful connections\n8.4\\.      timing events\n8.5\\.      session state at disconnection\n8.6\\.      non-printable characters\n8.7\\.      capturing http cookies\n8.8\\.      capturing http headers\n8.9\\.      examples of logs\n\n9\\.    statistics and monitoring\n9.1\\.      csv format\n9.2\\.      unix socket commands\n\n1\\. quick reminder about http\n----------------------------\n\nwhen haproxy is running in http mode, both the request and the response are\nfully analyzed and indexed, thus it becomes possible to build matching criteria\non almost anything found in the contents.\n\nhowever, it is important to understand how http requests and responses are\nformed, and how haproxy decomposes them. it will then become easier to write\ncorrect rules and to debug existing configurations.\n\n1.1\\. the http transaction model\n-------------------------------\n\nthe http protocol is transaction-driven. this means that each request will lead\nto one and only one response. traditionally, a tcp connection is established\nfrom the client to the server, a request is sent by the client on the\nconnection, the server responds and the connection is closed. a new request\nwill involve a new connection :\n\n  [con1] [req1] ... [resp1] [clo1] [con2] [req2] ... [resp2] [clo2] ...\n\nin this mode, called the \"http close\" mode, there are as many connection\nestablishments as there are http transactions. since the connection is closed\nby the server after the response, the client does not need to know the content\nlength.\n\ndue to the transactional nature of the protocol, it was possible to improve it\nto avoid closing a connection between two subsequent transactions. in this mode\nhowever, it is mandatory that the server indicates the content length for each\nresponse so that the client does not wait indefinitely. for this, a special\nheader is used: \"content-length\". this mode is called the \"keep-alive\" mode :\n\n  [con] [req1] ... [resp1] [req2] ... [resp2] [clo] ...\n\nits advantages are a reduced latency between transactions, and less processing\npower required on the server side. it is generally better than the close mode,\nbut not always because the clients often limit their concurrent connections to\na smaller value.\n\na last improvement in the communications is the pipelining mode. it still uses\nkeep-alive, but the client does not wait for the first response to send the\nsecond request. this is useful for fetching large number of images composing a\npage :\n\n  [con] [req1] [req2] ... [resp1] [resp2] [clo] ...\n\nthis can obviously have a tremendous benefit on performance because the network\nlatency is eliminated between subsequent requests. many http agents do not\ncorrectly support pipelining since there is no way to associate a response with\nthe corresponding request in http. for this reason, it is mandatory for the\nserver to reply in the exact same order as the requests were received.\n\nby default haproxy operates in keep-alive mode with regards to persistent\nconnections: for each connection it processes each request and response, and\nleaves the connection idle on both sides between the end of a response and the\nstart of a new request.\n\nhaproxy supports 5 connection modes :\n  - keep alive    : all requests and responses are processed (default)\n  - tunnel        : only the first request and response are processed,\n                    everything else is forwarded with no analysis.\n  - passive close : tunnel with \"connection: close\" added in both directions.\n  - server close  : the server-facing connection is closed after the response.\n  - forced close  : the connection is actively closed after end of response.\n\n1.2\\. http request\n-----------------\n\nfirst, let's consider this http request :\n\n  line     contents\n  number\n     1     get /serv/login.php?lang=en&profile=2 http/1.1\n     2     host: www.mydomain.com\n     3     user-agent: my small browser\n     4     accept: image/jpeg, image/gif\n     5     accept: image/png\n\n1.2.1\\. the request line\n-----------------------\n\nline 1 is the \"request line\". it is always composed of 3 fields :\n\n  - a method      : get\n  - a uri         : /serv/login.php?lang=en&profile=2\n  - a version tag : http/1.1\n\nall of them are delimited by what the standard calls lws (linear white spaces),\nwhich are commonly spaces, but can also be tabs or line feeds/carriage returns\nfollowed by spaces/tabs. the method itself cannot contain any colon (':') and\nis limited to alphabetic letters. all those various combinations make it\ndesirable that haproxy performs the splitting itself rather than leaving it to\nthe user to write a complex or inaccurate regular expression.\n\nthe uri itself can have several forms :\n\n  - a \"relative uri\" :\n\n      /serv/login.php?lang=en&profile=2\n\n    it is a complete url without the host part. this is generally what is\n    received by servers, reverse proxies and transparent proxies.\n\n  - an \"absolute uri\", also called a \"url\" :\n\n      http://192.168.0.12:8080/serv/login.php?lang=en&profile=2\n\n    it is composed of a \"scheme\" (the protocol name followed by '://'), a host\n    name or address, optionally a colon (':') followed by a port number, then\n    a relative uri beginning at the first slash ('/') after the address part.\n    this is generally what proxies receive, but a server supporting http/1.1\n    must accept this form too.\n\n  - a star ('*') : this form is only accepted in association with the options\n    method and is not relayable. it is used to inquiry a next hop's\n    capabilities.\n\n  - an address:port combination : 192.168.0.12:80\n    this is used with the connect method, which is used to establish tcp\n    tunnels through http proxies, generally for https, but sometimes for\n    other protocols too.\n\nin a relative uri, two sub-parts are identified. the part before the question\nmark is called the \"path\". it is typically the relative path to static objects\non the server. the part after the question mark is called the \"query string\".\nit is mostly used with get requests sent to dynamic scripts and is very\nspecific to the language, framework or application in use.\n\n1.2.2\\. the request headers\n--------------------------\n\nthe headers start at the second line. they are composed of a name at the\nbeginning of the line, immediately followed by a colon (':'). traditionally,\nan lws is added after the colon but that's not required. then come the values.\nmultiple identical headers may be folded into one single line, delimiting the\nvalues with commas, provided that their order is respected. this is commonly\nencountered in the \"cookie:\" field. a header may span over multiple lines if\nthe subsequent lines begin with an lws. in the example in 1.2, lines 4 and 5\ndefine a total of 3 values for the \"accept:\" header.\n\ncontrary to a common mis-conception, header names are not case-sensitive, and\ntheir values are not either if they refer to other header names (such as the\n\"connection:\" header).\n\nthe end of the headers is indicated by the first empty line. people often say\nthat it's a double line feed, which is not exact, even if a double line feed\nis one valid form of empty line.\n\nfortunately, haproxy takes care of all these complex combinations when indexing\nheaders, checking values and counting them, so there is no reason to worry\nabout the way they could be written, but it is important not to accuse an\napplication of being buggy if it does unusual, valid things.\n\nimportant note:\n   as suggested by rfc2616, haproxy normalizes headers by replacing line breaks\n   in the middle of headers by lws in order to join multi-line headers. this\n   is necessary for proper analysis and helps less capable http parsers to work\n   correctly and not to be fooled by such complex constructs.\n\n1.3\\. http response\n------------------\n\nan http response looks very much like an http request. both are called http\nmessages. let's consider this http response :\n\n  line     contents\n  number\n     1     http/1.1 200 ok\n     2     content-length: 350\n     3     content-type: text/html\n\nas a special case, http supports so called \"informational responses\" as status\ncodes 1xx. these messages are special in that they don't convey any part of the\nresponse, they're just used as sort of a signaling message to ask a client to\ncontinue to post its request for instance. in the case of a status 100 response\nthe requested information will be carried by the next non-100 response message\nfollowing the informational one. this implies that multiple responses may be\nsent to a single request, and that this only works when keep-alive is enabled\n(1xx messages are http/1.1 only). haproxy handles these messages and is able to\ncorrectly forward and skip them, and only process the next non-100 response. as\nsuch, these messages are neither logged nor transformed, unless explicitly\nstate otherwise. status 101 messages indicate that the protocol is changing\nover the same connection and that haproxy must switch to tunnel mode, just as\nif a connect had occurred. then the upgrade header would contain additional\ninformation about the type of protocol the connection is switching to.\n\n1.3.1\\. the response line\n------------------------\n\nline 1 is the \"response line\". it is always composed of 3 fields :\n\n  - a version tag : http/1.1\n  - a status code : 200\n  - a reason      : ok\n\nthe status code is always 3-digit. the first digit indicates a general status :\n - 1xx = informational message to be skipped (eg: 100, 101)\n - 2xx = ok, content is following   (eg: 200, 206)\n - 3xx = ok, no content following   (eg: 302, 304)\n - 4xx = error caused by the client (eg: 401, 403, 404)\n - 5xx = error caused by the server (eg: 500, 502, 503)\n\nplease refer to rfc2616 for the detailed meaning of all such codes. the\n\"reason\" field is just a hint, but is not parsed by clients. anything can be\nfound there, but it's a common practice to respect the well-established\nmessages. it can be composed of one or multiple words, such as \"ok\", \"found\",\nor \"authentication required\".\n\nhaproxy may emit the following status codes by itself :\n\n  code  when / reason\n   200  access to stats page, and when replying to monitoring requests\n   301  when performing a redirection, depending on the configured code\n   302  when performing a redirection, depending on the configured code\n   303  when performing a redirection, depending on the configured code\n   307  when performing a redirection, depending on the configured code\n   308  when performing a redirection, depending on the configured code\n   400  for an invalid or too large request\n   401  when an authentication is required to perform the action (when\n        accessing the stats page)\n   403  when a request is forbidden by a \"block\" acl or \"reqdeny\" filter\n   408  when the request timeout strikes before the request is complete\n   500  when haproxy encounters an unrecoverable internal error, such as a\n        memory allocation failure, which should never happen\n   502  when the server returns an empty, invalid or incomplete response, or\n        when an \"rspdeny\" filter blocks the response.\n   503  when no server was available to handle the request, or in response to\n        monitoring requests which match the \"monitor fail\" condition\n   504  when the response timeout strikes before the server responds\n\nthe error 4xx and 5xx codes above may be customized (see \"errorloc\" in section\n4.2).\n\n1.3.2\\. the response headers\n---------------------------\n\nresponse headers work exactly like request headers, and as such, haproxy uses\nthe same parsing function for both. please refer to paragraph 1.2.2 for more\ndetails.\n\n2\\. configuring haproxy\n----------------------\n\n2.1\\. configuration file format\n------------------------------\n\nhaproxy's configuration process involves 3 major sources of parameters :\n\n  - the arguments from the command-line, which always take precedence\n  - the \"global\" section, which sets process-wide parameters\n  - the proxies sections which can take form of \"defaults\", \"listen\",\n    \"frontend\" and \"backend\".\n\nthe configuration file syntax consists in lines beginning with a keyword\nreferenced in this manual, optionally followed by one or several parameters\ndelimited by spaces.\n\n2.2\\. quoting and escaping\n-------------------------\n\nhaproxy's configuration introduces a quoting and escaping system similar to\nmany programming languages. the configuration file supports 3 types: escaping\nwith a backslash, weak quoting with double quotes, and strong quoting with\nsingle quotes.\n\nif spaces have to be entered in strings, then they must be escaped by preceding\nthem by a backslash ('\\') or by quoting them. backslashes also have to be\nescaped by doubling or strong quoting them.\n\nescaping is achieved by preceding a special character by a backslash ('\\'):\n\n  \\    to mark a space and differentiate it from a delimiter\n  \\#   to mark a hash and differentiate it from a comment\n  \\\\   to use a backslash\n  \\'   to use a single quote and differentiate it from strong quoting\n  \\\"   to use a double quote and differentiate it from weak quoting\n\nweak quoting is achieved by using double quotes (\"\"). weak quoting prevents\nthe interpretation of:\n\n       space as a parameter separator\n  '    single quote as a strong quoting delimiter\n  #    hash as a comment start\n\nweak quoting permits the interpretation of variables, if you want to use a non\n-interpreted dollar within a double quoted string, you should escape it with a\nbackslash (\"\\$\"), it does not work outside weak quoting.\n\ninterpretation of escaping and special characters are not prevented by weak\nquoting.\n\nstrong quoting is achieved by using single quotes (''). inside single quotes,\nnothing is interpreted, it's the efficient way to quote regexes.\n\nquoted and escaped strings are replaced in memory by their interpreted\nequivalent, it allows you to perform concatenation.\n\n  example:\n      # those are equivalents:\n      log-format %{+q}o\\ %t\\ %s\\ %{-q}r\n      log-format \"%{+q}o %t %s %{-q}r\"\n      log-format '%{+q}o %t %s %{-q}r'\n      log-format \"%{+q}o %t\"' %s %{-q}r'\n      log-format \"%{+q}o %t\"' %s'\\ %{-q}r\n\n      # those are equivalents:\n      reqrep \"^([^\\ :]*)\\ /static/(.*)\"     \\1\\ /\\2\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     '\\1 /\\2'\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     \"\\1 /\\2\"\n      reqrep \"^([^ :]*)\\ /static/(.*)\"     \"\\1\\ /\\2\"\n\n2.3\\. environment variables\n--------------------------\n\nhaproxy's configuration supports environment variables. those variables are\ninterpreted only within double quotes. variables are expanded during the\nconfiguration parsing. variable names must be preceded by a dollar (\"$\") and\noptionally enclosed with braces (\"{}\") similarly to what is done in bourne\nshell. variable names can contain alphanumerical characters or the character\nunderscore (\"_\") but should not start with a digit.\n\n  example:\n\n      bind \"fd@${fd_app1}\"\n\n      log \"${local_syslog}:514\" local0 notice   # send to local server\n\n      user \"$haproxy_user\"\n\n2.4\\. time format\n----------------\n\nsome parameters involve values representing time, such as timeouts. these\nvalues are generally expressed in milliseconds (unless explicitly stated\notherwise) but may be expressed in any other unit by suffixing the unit to the\nnumeric value. it is important to consider this because it will not be repeated\nfor every keyword. supported units are :\n\n  - us : microseconds. 1 microsecond = 1/1000000 second\n  - ms : milliseconds. 1 millisecond = 1/1000 second. this is the default.\n  - s  : seconds. 1s = 1000ms\n  - m  : minutes. 1m = 60s = 60000ms\n  - h  : hours.   1h = 60m = 3600s = 3600000ms\n  - d  : days.    1d = 24h = 1440m = 86400s = 86400000ms\n\n2.4\\. examples\n-------------\n\n    # simple configuration for an http proxy listening on port 80 on all\n    # interfaces and forwarding requests to a single backend \"servers\" with a\n    # single server \"server1\" listening on 127.0.0.1:8000\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    frontend http-in\n        bind *:80\n        default_backend servers\n\n    backend servers\n        server server1 127.0.0.1:8000 maxconn 32\n\n    # the same configuration defined with a single listen block. shorter but\n    # less expressive, especially in http mode.\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    listen http-in\n        bind *:80\n        server server1 127.0.0.1:8000 maxconn 32\n\nassuming haproxy is in $path, test these configurations in a shell with:\n\n    $ sudo haproxy -f configuration.conf -c\n\n3\\. global parameters\n--------------------\n\nparameters in the \"global\" section are process-wide and often os-specific. they\nare generally set once for all and do not need being changed once correct. some\nof them have command-line equivalents.\n\nthe following keywords are supported in the \"global\" section :\n\n * process management and security\n   - ca-base\n   - chroot\n   - crt-base\n   - daemon\n   - external-check\n   - gid\n   - group\n   - log\n   - log-send-hostname\n   - nbproc\n   - pidfile\n   - uid\n   - ulimit-n\n   - user\n   - stats\n   - ssl-server-verify\n   - node\n   - description\n   - unix-bind\n   - 51degrees-data-file\n   - 51degrees-property-name-list\n   - 51degrees-property-separator\n   - 51degrees-cache-size\n\n * performance tuning\n   - max-spread-checks\n   - maxconn\n   - maxconnrate\n   - maxcomprate\n   - maxcompcpuusage\n   - maxpipes\n   - maxsessrate\n   - maxsslconn\n   - maxsslrate\n   - noepoll\n   - nokqueue\n   - nopoll\n   - nosplice\n   - nogetaddrinfo\n   - spread-checks\n   - tune.bufsize\n   - tune.chksize\n   - tune.comp.maxlevel\n   - tune.http.cookielen\n   - tune.http.maxhdr\n   - tune.idletimer\n   - tune.lua.forced-yield\n   - tune.lua.maxmem\n   - tune.lua.session-timeout\n   - tune.lua.task-timeout\n   - tune.maxaccept\n   - tune.maxpollevents\n   - tune.maxrewrite\n   - tune.pattern.cache-size\n   - tune.pipesize\n   - tune.rcvbuf.client\n   - tune.rcvbuf.server\n   - tune.sndbuf.client\n   - tune.sndbuf.server\n   - tune.ssl.cachesize\n   - tune.ssl.lifetime\n   - tune.ssl.force-private-cache\n   - tune.ssl.maxrecord\n   - tune.ssl.default-dh-param\n   - tune.ssl.ssl-ctx-cache-size\n   - tune.vars.global-max-size\n   - tune.vars.reqres-max-size\n   - tune.vars.sess-max-size\n   - tune.vars.txn-max-size\n   - tune.zlib.memlevel\n   - tune.zlib.windowsize\n\n * debugging\n   - debug\n   - quiet\n\n3.1\\. process management and security\n------------------------------------\n\nca-base <dir>\n  assigns a default directory to fetch ssl ca certificates and crls from when a\n  relative path is used with \"ca-file\" or \"crl-file\" directives. absolute\n  locations specified in \"ca-file\" and \"crl-file\" prevail and ignore \"ca-base\".\n\nchroot <jail dir>\n  changes current directory to <jail dir> and performs a chroot() there before\n  dropping privileges. this increases the security level in case an unknown\n  vulnerability would be exploited, since it would make it very hard for the\n  attacker to exploit the system. this only works when the process is started\n  with superuser privileges. it is important to ensure that <jail_dir> is both\n  empty and unwritable to anyone.\n\ncpu-map <\"all\"|\"odd\"|\"even\"|process_num> <cpu-set>...\n  on linux 2.6 and above, it is possible to bind a process to a specific cpu\n  set. this means that the process will never run on other cpus. the \"cpu-map\"\n  directive specifies cpu sets for process sets. the first argument is the\n  process number to bind. this process must have a number between 1 and 32 or\n  64, depending on the machine's word size, and any process ids above nbproc\n  are ignored. it is possible to specify all processes at once using \"all\",\n  only odd numbers using \"odd\" or even numbers using \"even\", just like with the\n  \"bind-process\" directive. the second and forthcoming arguments are cpu sets.\n  each cpu set is either a unique number between 0 and 31 or 63 or a range with\n  two such numbers delimited by a dash ('-'). multiple cpu numbers or ranges\n  may be specified, and the processes will be allowed to bind to all of them.\n  obviously, multiple \"cpu-map\" directives may be specified. each \"cpu-map\"\n  directive will replace the previous ones when they overlap.\n\ncrt-base <dir>\n  assigns a default directory to fetch ssl certificates from when a relative\n  path is used with \"crtfile\" directives. absolute locations specified after\n  \"crtfile\" prevail and ignore \"crt-base\".\n\ndaemon\n  makes the process fork into background. this is the recommended mode of\n  operation. it is equivalent to the command line \"-d\" argument. it can be\n  disabled by the command line \"-db\" argument.\n\ndeviceatlas-json-file <path>\n  sets the path of the deviceatlas json data file to be loaded by the api.\n  the path must be a valid json data file and accessible by haproxy process.\n\ndeviceatlas-log-level <value>\n  sets the level of informations returned by the api. this directive is\n  optional and set to 0 by default if not set.\n\ndeviceatlas-separator <char>\n  sets the character separator for the api properties results. this directive\n  is optional and set to | by default if not set.\n\nexternal-check\n  allows the use of an external agent to perform health checks.\n  this is disabled by default as a security precaution.\n  see \"option external-check\".\n\ngid <number>\n  changes the process' group id to <number>. it is recommended that the group\n  id is dedicated to haproxy or to a small set of similar daemons. haproxy must\n  be started with a user belonging to this group, or with superuser privileges.\n  note that if haproxy is started from a user having supplementary groups, it\n  will only be able to drop these groups if started with superuser privileges.\n  see also \"group\" and \"uid\".\n\ngroup <group name>\n  similar to \"gid\" but uses the gid of group name <group name> from /etc/group.\n  see also \"gid\" and \"user\".\n\nlog <address> [len <length>] <facility> [max level [min level]]\n  adds a global syslog server. up to two global servers can be defined. they\n  will receive logs for startups and exits, as well as all logs from proxies\n  configured with \"log global\".\n\n  <address> can be one of:\n\n        - an ipv4 address optionally followed by a colon and a udp port. if\n          no port is specified, 514 is used by default (the standard syslog\n          port).\n\n        - an ipv6 address followed by a colon and optionally a udp port. if\n          no port is specified, 514 is used by default (the standard syslog\n          port).\n\n        - a filesystem path to a unix domain socket, keeping in mind\n          considerations for chroot (be sure the path is accessible inside\n          the chroot) and uid/gid (be sure the path is appropriately\n          writeable).\n\n        you may want to reference some environment variables in the address\n        parameter, see section 2.3 about environment variables.\n\n  <length> is an optional maximum line length. log lines larger than this value\n           will be truncated before being sent. the reason is that syslog\n           servers act differently on log line length. all servers support the\n           default value of 1024, but some servers simply drop larger lines\n           while others do log them. if a server supports long lines, it may\n           make sense to set this value here in order to avoid truncating long\n           lines. similarly, if a server drops long lines, it is preferable to\n           truncate them before sending them. accepted values are 80 to 65535\n           inclusive. the default value of 1024 is generally fine for all\n           standard usages. some specific cases of long captures or\n           json-formated logs may require larger values.\n\n  <facility> must be one of the 24 standard syslog facilities :\n\n          kern   user   mail   daemon auth   syslog lpr    news\n          uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n          local0 local1 local2 local3 local4 local5 local6 local7\n\n  an optional level can be specified to filter outgoing messages. by default,\n  all messages are sent. if a maximum level is specified, only messages with a\n  severity at least as important as this level will be sent. an optional minimum\n  level can be specified. if it is set, logs emitted with a more severe level\n  than this one will be capped to this level. this is used to avoid sending\n  \"emerg\" messages on all terminals on some default syslog configurations.\n  eight levels are known :\n\n          emerg  alert  crit   err    warning notice info  debug\n\nlog-send-hostname [<string>]\n  sets the hostname field in the syslog header. if optional \"string\" parameter\n  is set the header is set to the string contents, otherwise uses the hostname\n  of the system. generally used if one is not relaying logs through an\n  intermediate syslog server or for simply customizing the hostname printed in\n  the logs.\n\nlog-tag <string>\n  sets the tag field in the syslog header to this string. it defaults to the\n  program name as launched from the command line, which usually is \"haproxy\".\n  sometimes it can be useful to differentiate between multiple processes\n  running on the same host. see also the per-proxy \"log-tag\" directive.\n\nlua-load <file>\n  this global directive loads and executes a lua file. this directive can be\n  used multiple times.\n\nnbproc <number>\n  creates <number> processes when going daemon. this requires the \"daemon\"\n  mode. by default, only one process is created, which is the recommended mode\n  of operation. for systems limited to small sets of file descriptors per\n  process, it may be needed to fork multiple daemons. using multiple processes\n  is harder to debug and is really discouraged. see also \"daemon\".\n\npidfile <pidfile>\n  writes pids of all daemons into file <pidfile>. this option is equivalent to\n  the \"-p\" command line argument. the file must be accessible to the user\n  starting the process. see also \"daemon\".\n\nstats bind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] ...\n  limits the stats socket to a certain set of processes numbers. by default the\n  stats socket is bound to all processes, causing a warning to be emitted when\n  nbproc is greater than 1 because there is no way to select the target process\n  when connecting. however, by using this setting, it becomes possible to pin\n  the stats socket to a specific set of processes, typically the first one. the\n  warning will automatically be disabled when this setting is used, whatever\n  the number of processes used. the maximum process id depends on the machine's\n  word size (32 or 64). a better option consists in using the \"process\" setting\n  of the \"stats socket\" line to force the process on each line.\n\nssl-default-bind-ciphers <ciphers>\n  this setting is only available when support for openssl was built in. it sets\n  the default string describing the list of cipher algorithms (\"cipher suite\")\n  that are negotiated during the ssl/tls handshake for all \"bind\" lines which\n  do not explicitly define theirs. the format of the string is defined in\n  \"man 1 ciphers\" from openssl man pages, and can be for instance a string such\n  as \"aes:all:!anull:!enull:+rc4:@strength\" (without quotes). please check the\n  \"bind\" keyword for more information.\n\nssl-default-bind-options [<option>]...\n  this setting is only available when support for openssl was built in. it sets\n  default ssl-options to force on all \"bind\" lines. please check the \"bind\"\n  keyword to see available options.\n\n  example:\n        global\n           ssl-default-bind-options no-sslv3 no-tls-tickets\n\nssl-default-server-ciphers <ciphers>\n  this setting is only available when support for openssl was built in. it\n  sets the default string describing the list of cipher algorithms that are\n  negotiated during the ssl/tls handshake with the server, for all \"server\"\n  lines which do not explicitly define theirs. the format of the string is\n  defined in \"man 1 ciphers\". please check the \"server\" keyword for more\n  information.\n\nssl-default-server-options [<option>]...\n  this setting is only available when support for openssl was built in. it sets\n  default ssl-options to force on all \"server\" lines. please check the \"server\"\n  keyword to see available options.\n\nssl-dh-param-file <file>\n  this setting is only available when support for openssl was built in. it sets\n  the default dh parameters that are used during the ssl/tls handshake when\n  ephemeral diffie-hellman (dhe) key exchange is used, for all \"bind\" lines\n  which do not explicitely define theirs. it will be overridden by custom dh\n  parameters found in a bind certificate file if any. if custom dh parameters\n  are not specified either by using ssl-dh-param-file or by setting them directly\n  in the certificate file, pre-generated dh parameters of the size specified\n  by tune.ssl.default-dh-param will be used. custom parameters are known to be\n  more secure and therefore their use is recommended.\n  custom dh parameters may be generated by using the openssl command\n  \"openssl dhparam <size>\", where size should be at least 2048, as 1024-bit dh\n  parameters should not be considered secure anymore.\n\nssl-server-verify [none|required]\n  the default behavior for ssl verify on servers side. if specified to 'none',\n  servers certificates are not verified. the default is 'required' except if\n  forced using cmdline option '-dv'.\n\nstats socket [<address:port>|<path>] [param*]\n  binds a unix socket to <path> or a tcpv4/v6 address to <address:port>.\n  connections to this socket will return various statistics outputs and even\n  allow some commands to be issued to change some runtime settings. please\n  consult section 9.2 \"unix socket commands\" for more details.\n\n  all parameters supported by \"bind\" lines are supported, for instance to\n  restrict access to some users or their access rights. please consult\n  section 5.1 for more information.\n\nstats timeout <timeout, in milliseconds>\n  the default timeout on the stats socket is set to 10 seconds. it is possible\n  to change this value with \"stats timeout\". the value must be passed in\n  milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.\n\nstats maxconn <connections>\n  by default, the stats socket is limited to 10 concurrent connections. it is\n  possible to change this value with \"stats maxconn\".\n\nuid <number>\n  changes the process' user id to <number>. it is recommended that the user id\n  is dedicated to haproxy or to a small set of similar daemons. haproxy must\n  be started with superuser privileges in order to be able to switch to another\n  one. see also \"gid\" and \"user\".\n\nulimit-n <number>\n  sets the maximum number of per-process file-descriptors to <number>. by\n  default, it is automatically computed, so it is recommended not to use this\n  option.\n\nunix-bind [ prefix <prefix> ] [ mode <mode> ] [ user <user> ] [ uid <uid> ]\n          [ group <group> ] [ gid <gid> ]\n\n  fixes common settings to unix listening sockets declared in \"bind\" statements.\n  this is mainly used to simplify declaration of those unix sockets and reduce\n  the risk of errors, since those settings are most commonly required but are\n  also process-specific. the <prefix> setting can be used to force all socket\n  path to be relative to that directory. this might be needed to access another\n  component's chroot. note that those paths are resolved before haproxy chroots\n  itself, so they are absolute. the <mode>, <user>, <uid>, <group> and <gid>\n  all have the same meaning as their homonyms used by the \"bind\" statement. if\n  both are specified, the \"bind\" statement has priority, meaning that the\n  \"unix-bind\" settings may be seen as process-wide default settings.\n\nuser <user name>\n  similar to \"uid\" but uses the uid of user name <user name> from /etc/passwd.\n  see also \"uid\" and \"group\".\n\nnode <name>\n  only letters, digits, hyphen and underscore are allowed, like in dns names.\n\n  this statement is useful in ha configurations where two or more processes or\n  servers share the same ip address. by setting a different node-name on all\n  nodes, it becomes easy to immediately spot what server is handling the\n  traffic.\n\ndescription <text>\n  add a text that describes the instance.\n\n  please note that it is required to escape certain characters (# for example)\n  and this text is inserted into a html page so you should avoid using\n  \"<\" and \">\" characters.\n\n51degrees-data-file <file path>\n  the path of the 51degrees data file to provide device detection services. the\n  file should be unzipped and accessible by haproxy with relevavnt permissions.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-property-name-list [<string>]\n  a list of 51degrees property names to be load from the dataset. a full list\n  of names is available on the 51degrees website:\n  https://51degrees.com/resources/property-dictionary\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-property-separator <char>\n  a char that will be appended to every property value in a response header\n  containing 51degrees results. if not set that will be set as ','.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n51degrees-cache-size <number>\n  sets the size of the 51degrees converter cache to <number> entries. this\n  is an lru cache which reminds previous device detections and their results.\n  by default, this cache is disabled.\n\n  please note that this option is only available when haproxy has been\n  compiled with use_51degrees.\n\n3.2\\. performance tuning\n-----------------------\n\nmax-spread-checks <delay in milliseconds>\n  by default, haproxy tries to spread the start of health checks across the\n  smallest health check interval of all the servers in a farm. the principle is\n  to avoid hammering services running on the same server. but when using large\n  check intervals (10 seconds or more), the last servers in the farm take some\n  time before starting to be tested, which can be a problem. this parameter is\n  used to enforce an upper bound on delay between the first and the last check,\n  even if the servers' check intervals are larger. when servers run with\n  shorter intervals, their intervals will be respected though.\n\nmaxconn <number>\n  sets the maximum per-process number of concurrent connections to <number>. it\n  is equivalent to the command-line argument \"-n\". proxies will stop accepting\n  connections when this limit is reached. the \"ulimit-n\" parameter is\n  automatically adjusted according to this value. see also \"ulimit-n\". note:\n  the \"select\" poller cannot reliably use more than 1024 file descriptors on\n  some platforms. if your platform only supports select and reports \"select\n  failed\" on startup, you need to reduce maxconn until it works (slightly\n  below 500 in general). if this value is not set, it will default to the value\n  set in default_maxconn at build time (reported in haproxy -vv) if no memory\n  limit is enforced, or will be computed based on the memory limit, the buffer\n  size, memory allocated to compression, ssl cache size, and use or not of ssl\n  and the associated maxsslconn (which can also be automatic).\n\nmaxconnrate <number>\n  sets the maximum per-process number of connections per second to <number>.\n  proxies will stop accepting connections when this limit is reached. it can be\n  used to limit the global capacity regardless of each frontend capacity. it is\n  important to note that this can only be used as a service protection measure,\n  as there will not necessarily be a fair share between frontends when the\n  limit is reached, so it's a good idea to also limit each frontend to some\n  value close to its expected share. also, lowering tune.maxaccept can improve\n  fairness.\n\nmaxcomprate <number>\n  sets the maximum per-process input compression rate to <number> kilobytes\n  per second.  for each session, if the maximum is reached, the compression\n  level will be decreased during the session. if the maximum is reached at the\n  beginning of a session, the session will not compress at all. if the maximum\n  is not reached, the compression level will be increased up to\n  tune.comp.maxlevel.  a value of zero means there is no limit, this is the\n  default value.\n\nmaxcompcpuusage <number>\n  sets the maximum cpu usage haproxy can reach before stopping the compression\n  for new requests or decreasing the compression level of current requests.\n  it works like 'maxcomprate' but measures cpu usage instead of incoming data\n  bandwidth. the value is expressed in percent of the cpu used by haproxy. in\n  case of multiple processes (nbproc > 1), each process manages its individual\n  usage. a value of 100 disable the limit. the default value is 100\\. setting\n  a lower value will prevent the compression work from slowing the whole\n  process down and from introducing high latencies.\n\nmaxpipes <number>\n  sets the maximum per-process number of pipes to <number>. currently, pipes\n  are only used by kernel-based tcp splicing. since a pipe contains two file\n  descriptors, the \"ulimit-n\" value will be increased accordingly. the default\n  value is maxconn/4, which seems to be more than enough for most heavy usages.\n  the splice code dynamically allocates and releases pipes, and can fall back\n  to standard copy, so setting this value too low may only impact performance.\n\nmaxsessrate <number>\n  sets the maximum per-process number of sessions per second to <number>.\n  proxies will stop accepting connections when this limit is reached. it can be\n  used to limit the global capacity regardless of each frontend capacity. it is\n  important to note that this can only be used as a service protection measure,\n  as there will not necessarily be a fair share between frontends when the\n  limit is reached, so it's a good idea to also limit each frontend to some\n  value close to its expected share. also, lowering tune.maxaccept can improve\n  fairness.\n\nmaxsslconn <number>\n  sets the maximum per-process number of concurrent ssl connections to\n  <number>. by default there is no ssl-specific limit, which means that the\n  global maxconn setting will apply to all connections. setting this limit\n  avoids having openssl use too much memory and crash when malloc returns null\n  (since it unfortunately does not reliably check for such conditions). note\n  that the limit applies both to incoming and outgoing connections, so one\n  connection which is deciphered then ciphered accounts for 2 ssl connections.\n  if this value is not set, but a memory limit is enforced, this value will be\n  automatically computed based on the memory limit, maxconn,  the buffer size,\n  memory allocated to compression, ssl cache size, and use of ssl in either\n  frontends, backends or both. if neither maxconn nor maxsslconn are specified\n  when there is a memory limit, haproxy will automatically adjust these values\n  so that 100% of the connections can be made over ssl with no risk, and will\n  consider the sides where it is enabled (frontend, backend, both).\n\nmaxsslrate <number>\n  sets the maximum per-process number of ssl sessions per second to <number>.\n  ssl listeners will stop accepting connections when this limit is reached. it\n  can be used to limit the global ssl cpu usage regardless of each frontend\n  capacity. it is important to note that this can only be used as a service\n  protection measure, as there will not necessarily be a fair share between\n  frontends when the limit is reached, so it's a good idea to also limit each\n  frontend to some value close to its expected share. it is also important to\n  note that the sessions are accounted before they enter the ssl stack and not\n  after, which also protects the stack against bad handshakes. also, lowering\n  tune.maxaccept can improve fairness.\n\nmaxzlibmem <number>\n  sets the maximum amount of ram in megabytes per process usable by the zlib.\n  when the maximum amount is reached, future sessions will not compress as long\n  as ram is unavailable. when sets to 0, there is no limit.\n  the default value is 0\\. the value is available in bytes on the unix socket\n  with \"show info\" on the line \"maxzlibmemusage\", the memory used by zlib is\n  \"zlibmemusage\" in bytes.\n\nnoepoll\n  disables the use of the \"epoll\" event polling system on linux. it is\n  equivalent to the command-line argument \"-de\". the next polling system\n  used will generally be \"poll\". see also \"nopoll\".\n\nnokqueue\n  disables the use of the \"kqueue\" event polling system on bsd. it is\n  equivalent to the command-line argument \"-dk\". the next polling system\n  used will generally be \"poll\". see also \"nopoll\".\n\nnopoll\n  disables the use of the \"poll\" event polling system. it is equivalent to the\n  command-line argument \"-dp\". the next polling system used will be \"select\".\n  it should never be needed to disable \"poll\" since it's available on all\n  platforms supported by haproxy. see also \"nokqueue\" and \"noepoll\".\n\nnosplice\n  disables the use of kernel tcp splicing between sockets on linux. it is\n  equivalent to the command line argument \"-ds\".  data will then be copied\n  using conventional and more portable recv/send calls. kernel tcp splicing is\n  limited to some very recent instances of kernel 2.6\\. most versions between\n  2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not\n  be used. this option makes it easier to globally disable kernel splicing in\n  case of doubt. see also \"option splice-auto\", \"option splice-request\" and\n  \"option splice-response\".\n\nnogetaddrinfo\n  disables the use of getaddrinfo(3) for name resolving. it is equivalent to\n  the command line argument \"-dg\". deprecated gethostbyname(3) will be used.\n\nspread-checks <0..50, in percent>\n  sometimes it is desirable to avoid sending agent and health checks to\n  servers at exact intervals, for instance when many logical servers are\n  located on the same physical server. with the help of this parameter, it\n  becomes possible to add some randomness in the check interval between 0\n  and +/- 50%. a value between 2 and 5 seems to show good results. the\n  default value remains at 0.\n\ntune.buffers.limit <number>\n  sets a hard limit on the number of buffers which may be allocated per process.\n  the default value is zero which means unlimited. the minimum non-zero value\n  will always be greater than \"tune.buffers.reserve\" and should ideally always\n  be about twice as large. forcing this value can be particularly useful to\n  limit the amount of memory a process may take, while retaining a sane\n  behaviour. when this limit is reached, sessions which need a buffer wait for\n  another one to be released by another session. since buffers are dynamically\n  allocated and released, the waiting time is very short and not perceptible\n  provided that limits remain reasonable. in fact sometimes reducing the limit\n  may even increase performance by increasing the cpu cache's efficiency. tests\n  have shown good results on average http traffic with a limit to 1/10 of the\n  expected global maxconn setting, which also significantly reduces memory\n  usage. the memory savings come from the fact that a number of connections\n  will not allocate 2*tune.bufsize. it is best not to touch this value unless\n  advised to do so by an haproxy core developer.\n\ntune.buffers.reserve <number>\n  sets the number of buffers which are pre-allocated and reserved for use only\n  during memory shortage conditions resulting in failed memory allocations. the\n  minimum value is 2 and is also the default. there is no reason a user would\n  want to change this value, it's mostly aimed at haproxy core developers.\n\ntune.bufsize <number>\n  sets the buffer size to this size (in bytes). lower values allow more\n  sessions to coexist in the same amount of ram, and higher values allow some\n  applications with very large cookies to work. the default value is 16384 and\n  can be changed at build time. it is strongly recommended not to change this\n  from the default value, as very low values will break some services such as\n  statistics, and values larger than default size will increase memory usage,\n  possibly causing the system to run out of memory. at least the global maxconn\n  parameter should be decreased by the same factor as this one is increased.\n  if http request is larger than (tune.bufsize - tune.maxrewrite), haproxy will\n  return http 400 (bad request) error. similarly if an http response is larger\n  than this size, haproxy will return http 502 (bad gateway).\n\ntune.chksize <number>\n  sets the check buffer size to this size (in bytes). higher values may help\n  find string or regex patterns in very large pages, though doing so may imply\n  more memory and cpu usage. the default value is 16384 and can be changed at\n  build time. it is not recommended to change this value, but to use better\n  checks whenever possible.\n\ntune.comp.maxlevel <number>\n  sets the maximum compression level. the compression level affects cpu\n  usage during compression. this value affects cpu usage during compression.\n  each session using compression initializes the compression algorithm with\n  this value. the default value is 1.\n\ntune.http.cookielen <number>\n  sets the maximum length of captured cookies. this is the maximum value that\n  the \"capture cookie xxx len yyy\" will be allowed to take, and any upper value\n  will automatically be truncated to this one. it is important not to set too\n  high a value because all cookie captures still allocate this size whatever\n  their configured value (they share a same pool). this value is per request\n  per response, so the memory allocated is twice this value per connection.\n  when not specified, the limit is set to 63 characters. it is recommended not\n  to change this value.\n\ntune.http.maxhdr <number>\n  sets the maximum number of headers in a request. when a request comes with a\n  number of headers greater than this value (including the first line), it is\n  rejected with a \"400 bad request\" status code. similarly, too large responses\n  are blocked with \"502 bad gateway\". the default value is 101, which is enough\n  for all usages, considering that the widely deployed apache server uses the\n  same limit. it can be useful to push this limit further to temporarily allow\n  a buggy application to work by the time it gets fixed. keep in mind that each\n  new header consumes 32bits of memory for each session, so don't push this\n  limit too high.\n\ntune.idletimer <timeout>\n  sets the duration after which haproxy will consider that an empty buffer is\n  probably associated with an idle stream. this is used to optimally adjust\n  some packet sizes while forwarding large and small data alternatively. the\n  decision to use splice() or to send large buffers in ssl is modulated by this\n  parameter. the value is in milliseconds between 0 and 65535\\. a value of zero\n  means that haproxy will not try to detect idle streams. the default is 1000,\n  which seems to correctly detect end user pauses (eg: read a page before\n  clicking). there should be not reason for changing this value. please check\n  tune.ssl.maxrecord below.\n\ntune.lua.forced-yield <number>\n  this directive forces the lua engine to execute a yield each <number> of\n  instructions executed. this permits interruptng a long script and allows the\n  haproxy scheduler to process other tasks like accepting connections or\n  forwarding traffic. the default value is 10000 instructions. if haproxy often\n  executes some lua code but more reactivity is required, this value can be\n  lowered. if the lua code is quite long and its result is absolutely required\n  to process the data, the <number> can be increased.\n\ntune.lua.maxmem\n  sets the maximum amount of ram in megabytes per process usable by lua. by\n  default it is zero which means unlimited. it is important to set a limit to\n  ensure that a bug in a script will not result in the system running out of\n  memory.\n\ntune.lua.session-timeout <timeout>\n  this is the execution timeout for the lua sessions. this is useful for\n  preventing infinite loops or spending too much time in lua. this timeout has a\n  priority over other timeouts. for example, if this timeout is set to 4s and\n  you run a 5s sleep, the code will be interrupted with an error after waiting\n  4s.\n\ntune.lua.task-timeout <timeout>\n  purpose is the same as \"tune.lua.session-timeout\", but this timeout is\n  dedicated to the tasks. by default, this timeout isn't set because a task may\n  remain alive during of the lifetime of haproxy. for example, a task used to\n  check servers.\n\ntune.maxaccept <number>\n  sets the maximum number of consecutive connections a process may accept in a\n  row before switching to other work. in single process mode, higher numbers\n  give better performance at high connection rates. however in multi-process\n  modes, keeping a bit of fairness between processes generally is better to\n  increase performance. this value applies individually to each listener, so\n  that the number of processes a listener is bound to is taken into account.\n  this value defaults to 64\\. in multi-process mode, it is divided by twice\n  the number of processes the listener is bound to. setting this value to -1\n  completely disables the limitation. it should normally not be needed to tweak\n  this value.\n\ntune.maxpollevents <number>\n  sets the maximum amount of events that can be processed at once in a call to\n  the polling system. the default value is adapted to the operating system. it\n  has been noticed that reducing it below 200 tends to slightly decrease\n  latency at the expense of network bandwidth, and increasing it above 200\n  tends to trade latency for slightly increased bandwidth.\n\ntune.maxrewrite <number>\n  sets the reserved buffer space to this size in bytes. the reserved space is\n  used for header rewriting or appending. the first reads on sockets will never\n  fill more than bufsize-maxrewrite. historically it has defaulted to half of\n  bufsize, though that does not make much sense since there are rarely large\n  numbers of headers to add. setting it too high prevents processing of large\n  requests or responses. setting it too low prevents addition of new headers\n  to already large requests or to post requests. it is generally wise to set it\n  to about 1024\\. it is automatically readjusted to half of bufsize if it is\n  larger than that. this means you don't have to worry about it when changing\n  bufsize.\n\ntune.pattern.cache-size <number>\n  sets the size of the pattern lookup cache to <number> entries. this is an lru\n  cache which reminds previous lookups and their results. it is used by acls\n  and maps on slow pattern lookups, namely the ones using the \"sub\", \"reg\",\n  \"dir\", \"dom\", \"end\", \"bin\" match methods as well as the case-insensitive\n  strings. it applies to pattern expressions which means that it will be able\n  to memorize the result of a lookup among all the patterns specified on a\n  configuration line (including all those loaded from files). it automatically\n  invalidates entries which are updated using http actions or on the cli. the\n  default cache size is set to 10000 entries, which limits its footprint to\n  about 5 mb on 32-bit systems and 8 mb on 64-bit systems. there is a very low\n  risk of collision in this cache, which is in the order of the size of the\n  cache divided by 2^64\\. typically, at 10000 requests per second with the\n  default cache size of 10000 entries, there's 1% chance that a brute force\n  attack could cause a single collision after 60 years, or 0.1% after 6 years.\n  this is considered much lower than the risk of a memory corruption caused by\n  aging components. if this is not acceptable, the cache can be disabled by\n  setting this parameter to 0.\n\ntune.pipesize <number>\n  sets the kernel pipe buffer size to this size (in bytes). by default, pipes\n  are the default size for the system. but sometimes when using tcp splicing,\n  it can improve performance to increase pipe sizes, especially if it is\n  suspected that pipes are not filled and that many calls to splice() are\n  performed. this has an impact on the kernel's memory footprint, so this must\n  not be changed if impacts are not understood.\n\ntune.rcvbuf.client <number>\ntune.rcvbuf.server <number>\n  forces the kernel socket receive buffer size on the client or the server side\n  to the specified value in bytes. this value applies to all tcp/http frontends\n  and backends. it should normally never be set, and the default size (0) lets\n  the kernel autotune this value depending on the amount of available memory.\n  however it can sometimes help to set it to very low values (eg: 4096) in\n  order to save kernel memory by preventing it from buffering too large amounts\n  of received data. lower values will significantly increase cpu usage though.\n\ntune.sndbuf.client <number>\ntune.sndbuf.server <number>\n  forces the kernel socket send buffer size on the client or the server side to\n  the specified value in bytes. this value applies to all tcp/http frontends\n  and backends. it should normally never be set, and the default size (0) lets\n  the kernel autotune this value depending on the amount of available memory.\n  however it can sometimes help to set it to very low values (eg: 4096) in\n  order to save kernel memory by preventing it from buffering too large amounts\n  of received data. lower values will significantly increase cpu usage though.\n  another use case is to prevent write timeouts with extremely slow clients due\n  to the kernel waiting for a large part of the buffer to be read before\n  notifying haproxy again.\n\ntune.ssl.cachesize <number>\n  sets the size of the global ssl session cache, in a number of blocks. a block\n  is large enough to contain an encoded session without peer certificate.\n  an encoded session with peer certificate is stored in multiple blocks\n  depending on the size of the peer certificate. a block uses approximately\n  200 bytes of memory. the default value may be forced at build time, otherwise\n  defaults to 20000\\.  when the cache is full, the most idle entries are purged\n  and reassigned. higher values reduce the occurrence of such a purge, hence\n  the number of cpu-intensive ssl handshakes by ensuring that all users keep\n  their session as long as possible. all entries are pre-allocated upon startup\n  and are shared between all processes if \"nbproc\" is greater than 1\\. setting\n  this value to 0 disables the ssl session cache.\n\ntune.ssl.force-private-cache\n  this boolean disables ssl session cache sharing between all processes. it\n  should normally not be used since it will force many renegotiations due to\n  clients hitting a random process. but it may be required on some operating\n  systems where none of the ssl cache synchronization method may be used. in\n  this case, adding a first layer of hash-based load balancing before the ssl\n  layer might limit the impact of the lack of session sharing.\n\ntune.ssl.lifetime <timeout>\n  sets how long a cached ssl session may remain valid. this time is expressed\n  in seconds and defaults to 300 (5 min). it is important to understand that it\n  does not guarantee that sessions will last that long, because if the cache is\n  full, the longest idle sessions will be purged despite their configured\n  lifetime. the real usefulness of this setting is to prevent sessions from\n  being used for too long.\n\ntune.ssl.maxrecord <number>\n  sets the maximum amount of bytes passed to ssl_write() at a time. default\n  value 0 means there is no limit. over ssl/tls, the client can decipher the\n  data only once it has received a full record. with large records, it means\n  that clients might have to download up to 16kb of data before starting to\n  process them. limiting the value can improve page load times on browsers\n  located over high latency or low bandwidth networks. it is suggested to find\n  optimal values which fit into 1 or 2 tcp segments (generally 1448 bytes over\n  ethernet with tcp timestamps enabled, or 1460 when timestamps are disabled),\n  keeping in mind that ssl/tls add some overhead. typical values of 1419 and\n  2859 gave good results during tests. use \"strace -e trace=write\" to find the\n  best value. haproxy will automatically switch to this setting after an idle\n  stream has been detected (see tune.idletimer above).\n\ntune.ssl.default-dh-param <number>\n  sets the maximum size of the diffie-hellman parameters used for generating\n  the ephemeral/temporary diffie-hellman key in case of dhe key exchange. the\n  final size will try to match the size of the server's rsa (or dsa) key (e.g,\n  a 2048 bits temporary dh key for a 2048 bits rsa key), but will not exceed\n  this maximum value. default value if 1024\\. only 1024 or higher values are\n  allowed. higher values will increase the cpu load, and values greater than\n  1024 bits are not supported by java 7 and earlier clients. this value is not\n  used if static diffie-hellman parameters are supplied either directly\n  in the certificate file or by using the ssl-dh-param-file parameter.\n\ntune.ssl.ssl-ctx-cache-size <number>\n  sets the size of the cache used to store generated certificates to <number>\n  entries. this is a lru cache. because generating a ssl certificate\n  dynamically is expensive, they are cached. the default cache size is set to\n  1000 entries.\n\ntune.vars.global-max-size <size>\ntune.vars.reqres-max-size <size>\ntune.vars.sess-max-size <size>\ntune.vars.txn-max-size <size>\n  these four tunes helps to manage the allowed amount of memory used by the\n  variables system. \"global\" limits the memory for all the systems. \"sess\" limit\n  the memory by session, \"txn\" limits the memory by transaction and \"reqres\"\n  limits the memory for each request or response processing. during the\n  accounting, \"sess\" embbed \"txn\" and \"txn\" embed \"reqres\".\n\n  by example, we considers that \"tune.vars.sess-max-size\" is fixed to 100,\n  \"tune.vars.txn-max-size\" is fixed to 100, \"tune.vars.reqres-max-size\" is\n  also fixed to 100\\. if we create a variable \"txn.var\" that contains 100 bytes,\n  we cannot create any more variable in the other contexts.\n\ntune.zlib.memlevel <number>\n  sets the memlevel parameter in zlib initialization for each session. it\n  defines how much memory should be allocated for the internal compression\n  state. a value of 1 uses minimum memory but is slow and reduces compression\n  ratio, a value of 9 uses maximum memory for optimal speed.  can be a value\n  between 1 and 9\\. the default value is 8.\n\ntune.zlib.windowsize <number>\n  sets the window size (the size of the history buffer) as a parameter of the\n  zlib initialization for each session. larger values of this parameter result\n  in better compression at the expense of memory usage.  can be a value between\n  8 and 15\\.  the default value is 15.\n\n3.3\\. debugging\n--------------\n\ndebug\n  enables debug mode which dumps to stdout all exchanges, and disables forking\n  into background. it is the equivalent of the command-line argument \"-d\". it\n  should never be used in a production configuration since it may prevent full\n  system startup.\n\nquiet\n  do not display any message during startup. it is equivalent to the command-\n  line argument \"-q\".\n\n3.4\\. userlists\n--------------\nit is possible to control access to frontend/backend/listen sections or to\nhttp stats by allowing only authenticated and authorized users. to do this,\nit is required to create at least one userlist and to define users.\n\nuserlist <listname>\n  creates new userlist with name <listname>. many independent userlists can be\n  used to store authentication & authorization data for independent customers.\n\ngroup <groupname> [users <user>,<user>,(...)]\n  adds group <groupname> to the current userlist. it is also possible to\n  attach users to this group by using a comma separated list of names\n  proceeded by \"users\" keyword.\n\nuser <username> [password|insecure-password <password>]\n                [groups <group>,<group>,(...)]\n  adds user <username> to the current userlist. both secure (encrypted) and\n  insecure (unencrypted) passwords can be used. encrypted passwords are\n  evaluated using the crypt(3) function so depending of the system's\n  capabilities, different algorithms are supported. for example modern glibc\n  based linux system supports md5, sha-256, sha-512 and of course classic,\n  des-based method of encrypting passwords.\n\n  example:\n        userlist l1\n          group g1 users tiger,scott\n          group g2 users xdb,scott\n\n          user tiger password $6$k6y3o.ep$jlkbx9za9667qe4(...)xhswrv6j.c0/d7cv91\n          user scott insecure-password elgato\n          user xdb insecure-password hello\n\n        userlist l2\n          group g1\n          group g2\n\n          user tiger password $6$k6y3o.ep$jlkbx(...)xhswrv6j.c0/d7cv91 groups g1\n          user scott insecure-password elgato groups g1,g2\n          user xdb insecure-password hello groups g2\n\n  please note that both lists are functionally identical.\n\n3.5\\. peers\n----------\nit is possible to propagate entries of any data-types in stick-tables between\nseveral haproxy instances over tcp connections in a multi-master fashion. each\ninstance pushes its local updates and insertions to remote peers. the pushed\nvalues overwrite remote ones without aggregation. interrupted exchanges are\nautomatically detected and recovered from the last known point.\nin addition, during a soft restart, the old process connects to the new one\nusing such a tcp connection to push all its entries before the new process\ntries to connect to other peers. that ensures very fast replication during a\nreload, it typically takes a fraction of a second even for large tables.\nnote that server ids are used to identify servers remotely, so it is important\nthat configurations look similar or at least that the same ids are forced on\neach server on all participants.\n\npeers <peersect>\n  creates a new peer list with name <peersect>. it is an independent section,\n  which is referenced by one or more stick-tables.\n\ndisabled\n  disables a peers section. it disables both listening and any synchronization\n  related to this section. this is provided to disable synchronization of stick\n  tables without having to comment out all \"peers\" references.\n\nenable\n  this re-enables a disabled peers section which was previously disabled.\n\npeer <peername> <ip>:<port>\n  defines a peer inside a peers section.\n  if <peername> is set to the local peer name (by default hostname, or forced\n  using \"-l\" command line option), haproxy will listen for incoming remote peer\n  connection on <ip>:<port>. otherwise, <ip>:<port> defines where to connect to\n  to join the remote peer, and <peername> is used at the protocol level to\n  identify and validate the remote peer on the server side.\n\n  during a soft restart, local peer <ip>:<port> is used by the old instance to\n  connect the new one and initiate a complete replication (teaching process).\n\n  it is strongly recommended to have the exact same peers declaration on all\n  peers and to only rely on the \"-l\" command line argument to change the local\n  peer name. this makes it easier to maintain coherent configuration files\n  across all peers.\n\n  you may want to reference some environment variables in the address\n  parameter, see section 2.3 about environment variables.\n\n  example:\n    peers mypeers\n        peer haproxy1 192.168.0.1:1024\n        peer haproxy2 192.168.0.2:1024\n        peer haproxy3 10.2.0.1:1024\n\n    backend mybackend\n        mode tcp\n        balance roundrobin\n        stick-table type ip size 20k peers mypeers\n        stick on src\n\n        server srv1 192.168.0.30:80\n        server srv2 192.168.0.31:80\n\n3.6\\. mailers\n------------\nit is possible to send email alerts when the state of servers changes.\nif configured email alerts are sent to each mailer that is configured\nin a mailers section. email is sent to mailers using smtp.\n\nmailer <mailersect>\n  creates a new mailer list with the name <mailersect>. it is an\n  independent section which is referenced by one or more proxies.\n\nmailer <mailername> <ip>:<port>\n  defines a mailer inside a mailers section.\n\n  example:\n    mailers mymailers\n        mailer smtp1 192.168.0.1:587\n        mailer smtp2 192.168.0.2:587\n\n    backend mybackend\n        mode tcp\n        balance roundrobin\n\n        email-alert mailers mymailers\n        email-alert from test1@horms.org\n        email-alert to test2@horms.org\n\n        server srv1 192.168.0.30:80\n        server srv2 192.168.0.31:80\n\n4\\. proxies\n----------\n\nproxy configuration can be located in a set of sections :\n - defaults [<name>]\n - frontend <name>\n - backend  <name>\n - listen   <name>\n\na \"defaults\" section sets default parameters for all other sections following\nits declaration. those default parameters are reset by the next \"defaults\"\nsection. see below for the list of parameters which can be set in a \"defaults\"\nsection. the name is optional but its use is encouraged for better readability.\n\na \"frontend\" section describes a set of listening sockets accepting client\nconnections.\n\na \"backend\" section describes a set of servers to which the proxy will connect\nto forward incoming connections.\n\na \"listen\" section defines a complete proxy with its frontend and backend\nparts combined in one section. it is generally useful for tcp-only traffic.\n\nall proxy names must be formed from upper and lower case letters, digits,\n'-' (dash), '_' (underscore) , '.' (dot) and ':' (colon). acl names are\ncase-sensitive, which means that \"www\" and \"www\" are two different proxies.\n\nhistorically, all proxy names could overlap, it just caused troubles in the\nlogs. since the introduction of content switching, it is mandatory that two\nproxies with overlapping capabilities (frontend/backend) have different names.\nhowever, it is still permitted that a frontend and a backend share the same\nname, as this configuration seems to be commonly encountered.\n\nright now, two major proxy modes are supported : \"tcp\", also known as layer 4,\nand \"http\", also known as layer 7\\. in layer 4 mode, haproxy simply forwards\nbidirectional traffic between two sides. in layer 7 mode, haproxy analyzes the\nprotocol, and can interact with it by allowing, blocking, switching, adding,\nmodifying, or removing arbitrary contents in requests or responses, based on\narbitrary criteria.\n\nin http mode, the processing applied to requests and responses flowing over\na connection depends in the combination of the frontend's http options and\nthe backend's. haproxy supports 5 connection modes :\n\n  - kal : keep alive (\"option http-keep-alive\") which is the default mode : all\n    requests and responses are processed, and connections remain open but idle\n    between responses and new requests.\n\n  - tun: tunnel (\"option http-tunnel\") : this was the default mode for versions\n    1.0 to 1.5-dev21 : only the first request and response are processed, and\n    everything else is forwarded with no analysis at all. this mode should not\n    be used as it creates lots of trouble with logging and http processing.\n\n  - pcl: passive close (\"option httpclose\") : exactly the same as tunnel mode,\n    but with \"connection: close\" appended in both directions to try to make\n    both ends close after the first request/response exchange.\n\n  - scl: server close (\"option http-server-close\") : the server-facing\n    connection is closed after the end of the response is received, but the\n    client-facing connection remains open.\n\n  - fcl: forced close (\"option forceclose\") : the connection is actively closed\n    after the end of the response.\n\nthe effective mode that will be applied to a connection passing through a\nfrontend and a backend can be determined by both proxy modes according to the\nfollowing matrix, but in short, the modes are symmetric, keep-alive is the\nweakest option and force close is the strongest.\n\n                          backend mode\n\n                | kal | tun | pcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            kal | kal | tun | pcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            tun | tun | tun | pcl | scl | fcl\n frontend   ----+-----+-----+-----+-----+----\n   mode     pcl | pcl | pcl | pcl | fcl | fcl\n            ----+-----+-----+-----+-----+----\n            scl | scl | scl | fcl | scl | fcl\n            ----+-----+-----+-----+-----+----\n            fcl | fcl | fcl | fcl | fcl | fcl\n\n4.1\\. proxy keywords matrix\n--------------------------\n\nthe following list of keywords is supported. most of them may only be used in a\nlimited set of section types. some of them are marked as \"deprecated\" because\nthey are inherited from an old syntax which may be confusing or functionally\nlimited, and there are new recommended keywords to replace them. keywords\nmarked with \"(*)\" can be optionally inverted using the \"no\" prefix, eg. \"no\noption contstats\". this makes sense when the option has been enabled by default\nand must be disabled for a specific instance. such options may also be prefixed\nwith \"default\" in order to restore default settings regardless of what has been\nspecified in a previous \"defaults\" section.\n\n keyword                              defaults   frontend   listen    backend\n------------------------------------+----------+----------+---------+---------\nacl                                       -          x         x         x\nappsession                                -          -         x         x\nbacklog                                   x          x         x         -\nbalance                                   x          -         x         x\nbind                                      -          x         x         -\nbind-process                              x          x         x         x\nblock                                     -          x         x         x\ncapture cookie                            -          x         x         -\ncapture request header                    -          x         x         -\ncapture response header                   -          x         x         -\nclitimeout                  (deprecated)  x          x         x         -\ncompression                               x          x         x         x\ncontimeout                  (deprecated)  x          -         x         x\ncookie                                    x          -         x         x\ndeclare capture                           -          x         x         -\ndefault-server                            x          -         x         x\ndefault_backend                           x          x         x         -\ndescription                               -          x         x         x\ndisabled                                  x          x         x         x\ndispatch                                  -          -         x         x\nemail-alert from                          x          x         x         x\nemail-alert level                         x          x         x         x\nemail-alert mailers                       x          x         x         x\nemail-alert myhostname                    x          x         x         x\nemail-alert to                            x          x         x         x\nenabled                                   x          x         x         x\nerrorfile                                 x          x         x         x\nerrorloc                                  x          x         x         x\nerrorloc302                               x          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nerrorloc303                               x          x         x         x\nforce-persist                             -          x         x         x\nfullconn                                  x          -         x         x\ngrace                                     x          x         x         x\nhash-type                                 x          -         x         x\nhttp-check disable-on-404                 x          -         x         x\nhttp-check expect                         -          -         x         x\nhttp-check send-state                     x          -         x         x\nhttp-request                              -          x         x         x\nhttp-response                             -          x         x         x\nhttp-send-name-header                     -          -         x         x\nid                                        -          x         x         x\nignore-persist                            -          x         x         x\nlog                                  (*)  x          x         x         x\nlog-format                                x          x         x         -\nlog-tag                                   x          x         x         x\nmax-keep-alive-queue                      x          -         x         x\nmaxconn                                   x          x         x         -\nmode                                      x          x         x         x\nmonitor fail                              -          x         x         -\nmonitor-net                               x          x         x         -\nmonitor-uri                               x          x         x         -\noption abortonclose                  (*)  x          -         x         x\noption accept-invalid-http-request   (*)  x          x         x         -\noption accept-invalid-http-response  (*)  x          -         x         x\noption allbackups                    (*)  x          -         x         x\noption checkcache                    (*)  x          -         x         x\noption clitcpka                      (*)  x          x         x         -\noption contstats                     (*)  x          x         x         -\noption dontlog-normal                (*)  x          x         x         -\noption dontlognull                   (*)  x          x         x         -\noption forceclose                    (*)  x          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\noption forwardfor                         x          x         x         x\noption http-buffer-request           (*)  x          x         x         x\noption http-ignore-probes            (*)  x          x         x         -\noption http-keep-alive               (*)  x          x         x         x\noption http-no-delay                 (*)  x          x         x         x\noption http-pretend-keepalive        (*)  x          x         x         x\noption http-server-close             (*)  x          x         x         x\noption http-tunnel                   (*)  x          x         x         x\noption http-use-proxy-header         (*)  x          x         x         -\noption httpchk                            x          -         x         x\noption httpclose                     (*)  x          x         x         x\noption httplog                            x          x         x         x\noption http_proxy                    (*)  x          x         x         x\noption independent-streams           (*)  x          x         x         x\noption ldap-check                         x          -         x         x\noption external-check                     x          -         x         x\noption log-health-checks             (*)  x          -         x         x\noption log-separate-errors           (*)  x          x         x         -\noption logasap                       (*)  x          x         x         -\noption mysql-check                        x          -         x         x\noption pgsql-check                        x          -         x         x\noption nolinger                      (*)  x          x         x         x\noption originalto                         x          x         x         x\noption persist                       (*)  x          -         x         x\noption redispatch                    (*)  x          -         x         x\noption redis-check                        x          -         x         x\noption smtpchk                            x          -         x         x\noption socket-stats                  (*)  x          x         x         -\noption splice-auto                   (*)  x          x         x         x\noption splice-request                (*)  x          x         x         x\noption splice-response               (*)  x          x         x         x\noption srvtcpka                      (*)  x          -         x         x\noption ssl-hello-chk                      x          -         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\noption tcp-check                          x          -         x         x\noption tcp-smart-accept              (*)  x          x         x         -\noption tcp-smart-connect             (*)  x          -         x         x\noption tcpka                              x          x         x         x\noption tcplog                             x          x         x         x\noption transparent                   (*)  x          -         x         x\nexternal-check command                    x          -         x         x\nexternal-check path                       x          -         x         x\npersist rdp-cookie                        x          -         x         x\nrate-limit sessions                       x          x         x         -\nredirect                                  -          x         x         x\nredisp                      (deprecated)  x          -         x         x\nredispatch                  (deprecated)  x          -         x         x\nreqadd                                    -          x         x         x\nreqallow                                  -          x         x         x\nreqdel                                    -          x         x         x\nreqdeny                                   -          x         x         x\nreqiallow                                 -          x         x         x\nreqidel                                   -          x         x         x\nreqideny                                  -          x         x         x\nreqipass                                  -          x         x         x\nreqirep                                   -          x         x         x\nreqitarpit                                -          x         x         x\nreqpass                                   -          x         x         x\nreqrep                                    -          x         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nreqtarpit                                 -          x         x         x\nretries                                   x          -         x         x\nrspadd                                    -          x         x         x\nrspdel                                    -          x         x         x\nrspdeny                                   -          x         x         x\nrspidel                                   -          x         x         x\nrspideny                                  -          x         x         x\nrspirep                                   -          x         x         x\nrsprep                                    -          x         x         x\nserver                                    -          -         x         x\nsource                                    x          -         x         x\nsrvtimeout                  (deprecated)  x          -         x         x\nstats admin                               -          -         x         x\nstats auth                                x          -         x         x\nstats enable                              x          -         x         x\nstats hide-version                        x          -         x         x\nstats http-request                        -          -         x         x\nstats realm                               x          -         x         x\nstats refresh                             x          -         x         x\nstats scope                               x          -         x         x\nstats show-desc                           x          -         x         x\nstats show-legends                        x          -         x         x\nstats show-node                           x          -         x         x\nstats uri                                 x          -         x         x\n-- keyword -------------------------- defaults - frontend - listen -- backend -\nstick match                               -          -         x         x\nstick on                                  -          -         x         x\nstick store-request                       -          -         x         x\nstick store-response                      -          -         x         x\nstick-table                               -          -         x         x\ntcp-check connect                         -          -         x         x\ntcp-check expect                          -          -         x         x\ntcp-check send                            -          -         x         x\ntcp-check send-binary                     -          -         x         x\ntcp-request connection                    -          x         x         -\ntcp-request content                       -          x         x         x\ntcp-request inspect-delay                 -          x         x         x\ntcp-response content                      -          -         x         x\ntcp-response inspect-delay                -          -         x         x\ntimeout check                             x          -         x         x\ntimeout client                            x          x         x         -\ntimeout client-fin                        x          x         x         -\ntimeout clitimeout          (deprecated)  x          x         x         -\ntimeout connect                           x          -         x         x\ntimeout contimeout          (deprecated)  x          -         x         x\ntimeout http-keep-alive                   x          x         x         x\ntimeout http-request                      x          x         x         x\ntimeout queue                             x          -         x         x\ntimeout server                            x          -         x         x\ntimeout server-fin                        x          -         x         x\ntimeout srvtimeout          (deprecated)  x          -         x         x\ntimeout tarpit                            x          x         x         x\ntimeout tunnel                            x          -         x         x\ntransparent                 (deprecated)  x          -         x         x\nunique-id-format                          x          x         x         -\nunique-id-header                          x          x         x         -\nuse_backend                               -          x         x         -\nuse-server                                -          -         x         x\n------------------------------------+----------+----------+---------+---------\n keyword                              defaults   frontend   listen    backend\n\n4.2\\. alphabetically sorted keywords reference\n---------------------------------------------\n\nthis section provides a description of each keyword and its usage.\n\nacl <aclname> <criterion> [flags] [operator] <value> ...\n  declare or complete an access list.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  example:\n        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3\n        acl invalid_src  src_port     0:1023\n        acl local_dst    hdr(host) -i localhost\n\n  see section 7 about acl usage.\n\nappsession <cookie> len <length> timeout <holdtime>\n           [request-learn] [prefix] [mode <path-parameters|query-string>]\n  define session stickiness on an existing application cookie.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <cookie>   this is the name of the cookie used by the application and which\n               haproxy will have to learn for each new session.\n\n    <length>   this is the max number of characters that will be memorized and\n               checked in each cookie value.\n\n    <holdtime> this is the time after which the cookie will be removed from\n               memory if unused. if no unit is specified, this time is in\n               milliseconds.\n\n    request-learn\n               if this option is specified, then haproxy will be able to learn\n               the cookie found in the request in case the server does not\n               specify any in response. this is typically what happens with\n               phpsessid cookies, or when haproxy's session expires before\n               the application's session and the correct server is selected.\n               it is recommended to specify this option to improve reliability.\n\n    prefix     when this option is specified, haproxy will match on the cookie\n               prefix (or url parameter prefix). the appsession value is the\n               data following this prefix.\n\n               example :\n               appsession aspsessionid len 64 timeout 3h prefix\n\n               this will match the cookie aspsessionidxxxx=xxxxx,\n               the appsession value will be xxxx=xxxxx.\n\n    mode       this option allows to change the url parser mode.\n               2 modes are currently supported :\n               - path-parameters :\n                 the parser looks for the appsession in the path parameters\n                 part (each parameter is separated by a semi-colon), which is\n                 convenient for jsessionid for example.\n                 this is the default mode if the option is not set.\n               - query-string :\n                 in this mode, the parser will look for the appsession in the\n                 query string.\n\n  when an application cookie is defined in a backend, haproxy will check when\n  the server sets such a cookie, and will store its value in a table, and\n  associate it with the server's identifier. up to <length> characters from\n  the value will be retained. on each connection, haproxy will look for this\n  cookie both in the \"cookie:\" headers, and as a url parameter (depending on\n  the mode used). if a known value is found, the client will be directed to the\n  server associated with this value. otherwise, the load balancing algorithm is\n  applied. cookies are automatically removed from memory when they have been\n  unused for a duration longer than <holdtime>.\n\n  the definition of an application cookie is limited to one per backend.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n        appsession jsessionid len 52 timeout 3h\n\n  see also : \"cookie\", \"capture cookie\", \"balance\", \"stick\", \"stick-table\",\n             \"ignore-persist\", \"nbproc\" and \"bind-process\".\n\nbacklog <conns>\n  give hints to the system about the approximate listen backlog desired size\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <conns>   is the number of pending connections. depending on the operating\n              system, it may represent the number of already acknowledged\n              connections, of non-acknowledged ones, or both.\n\n  in order to protect against syn flood attacks, one solution is to increase\n  the system's syn backlog size. depending on the system, sometimes it is just\n  tunable via a system parameter, sometimes it is not adjustable at all, and\n  sometimes the system relies on hints given by the application at the time of\n  the listen() syscall. by default, haproxy passes the frontend's maxconn value\n  to the listen() syscall. on systems which can make use of this value, it can\n  sometimes be useful to be able to specify a different value, hence this\n  backlog parameter.\n\n  on linux 2.4, the parameter is ignored by the system. on linux 2.6, it is\n  used as a hint and the system accepts up to the smallest greater power of\n  two, and never more than some limits (usually 32768).\n\n  see also : \"maxconn\" and the target operating system's tuning guide.\n\nbalance <algorithm> [ <arguments> ]\nbalance url_param <param> [check_post]\n  define the load balancing algorithm to be used in a backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <algorithm> is the algorithm used to select a server when doing load\n                balancing. this only applies when no persistence information\n                is available, or when a connection is redispatched to another\n                server. <algorithm> may be one of the following :\n\n      roundrobin  each server is used in turns, according to their weights.\n                  this is the smoothest and fairest algorithm when the server's\n                  processing time remains equally distributed. this algorithm\n                  is dynamic, which means that server weights may be adjusted\n                  on the fly for slow starts for instance. it is limited by\n                  design to 4095 active servers per backend. note that in some\n                  large farms, when a server becomes up after having been down\n                  for a very short time, it may sometimes take a few hundreds\n                  requests for it to be re-integrated into the farm and start\n                  receiving traffic. this is normal, though very rare. it is\n                  indicated here in case you would have the chance to observe\n                  it, so that you don't worry.\n\n      static-rr   each server is used in turns, according to their weights.\n                  this algorithm is as similar to roundrobin except that it is\n                  static, which means that changing a server's weight on the\n                  fly will have no effect. on the other hand, it has no design\n                  limitation on the number of servers, and when a server goes\n                  up, it is always immediately reintroduced into the farm, once\n                  the full map is recomputed. it also uses slightly less cpu to\n                  run (around -1%).\n\n      leastconn   the server with the lowest number of connections receives the\n                  connection. round-robin is performed within groups of servers\n                  of the same load to ensure that all servers will be used. use\n                  of this algorithm is recommended where very long sessions are\n                  expected, such as ldap, sql, tse, etc... but is not very well\n                  suited for protocols using short sessions such as http. this\n                  algorithm is dynamic, which means that server weights may be\n                  adjusted on the fly for slow starts for instance.\n\n      first       the first server with available connection slots receives the\n                  connection. the servers are chosen from the lowest numeric\n                  identifier to the highest (see server parameter \"id\"), which\n                  defaults to the server's position in the farm. once a server\n                  reaches its maxconn value, the next server is used. it does\n                  not make sense to use this algorithm without setting maxconn.\n                  the purpose of this algorithm is to always use the smallest\n                  number of servers so that extra servers can be powered off\n                  during non-intensive hours. this algorithm ignores the server\n                  weight, and brings more benefit to long session such as rdp\n                  or imap than http, though it can be useful there too. in\n                  order to use this algorithm efficiently, it is recommended\n                  that a cloud controller regularly checks server usage to turn\n                  them off when unused, and regularly checks backend queue to\n                  turn new servers on when the queue inflates. alternatively,\n                  using \"http-check send-state\" may inform servers on the load.\n\n      source      the source ip address is hashed and divided by the total\n                  weight of the running servers to designate which server will\n                  receive the request. this ensures that the same client ip\n                  address will always reach the same server as long as no\n                  server goes down or up. if the hash result changes due to the\n                  number of running servers changing, many clients will be\n                  directed to a different server. this algorithm is generally\n                  used in tcp mode where no cookie may be inserted. it may also\n                  be used on the internet to provide a best-effort stickiness\n                  to clients which refuse session cookies. this algorithm is\n                  static by default, which means that changing a server's\n                  weight on the fly will have no effect, but this can be\n                  changed using \"hash-type\".\n\n      uri         this algorithm hashes either the left part of the uri (before\n                  the question mark) or the whole uri (if the \"whole\" parameter\n                  is present) and divides the hash value by the total weight of\n                  the running servers. the result designates which server will\n                  receive the request. this ensures that the same uri will\n                  always be directed to the same server as long as no server\n                  goes up or down. this is used with proxy caches and\n                  anti-virus proxies in order to maximize the cache hit rate.\n                  note that this algorithm may only be used in an http backend.\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n                  this algorithm supports two optional parameters \"len\" and\n                  \"depth\", both followed by a positive integer number. these\n                  options may be helpful when it is needed to balance servers\n                  based on the beginning of the uri only. the \"len\" parameter\n                  indicates that the algorithm should only consider that many\n                  characters at the beginning of the uri to compute the hash.\n                  note that having \"len\" set to 1 rarely makes sense since most\n                  uris start with a leading \"/\".\n\n                  the \"depth\" parameter indicates the maximum directory depth\n                  to be used to compute the hash. one level is counted for each\n                  slash in the request. if both parameters are specified, the\n                  evaluation stops when either is reached.\n\n      url_param   the url parameter specified in argument will be looked up in\n                  the query string of each http get request.\n\n                  if the modifier \"check_post\" is used, then an http post\n                  request entity will be searched for the parameter argument,\n                  when it is not found in a query string after a question mark\n                  ('?') in the url. the message body will only start to be\n                  analyzed once either the advertised amount of data has been\n                  received or the request buffer is full. in the unlikely event\n                  that chunked encoding is used, only the first chunk is\n                  scanned. parameter values separated by a chunk boundary, may\n                  be randomly balanced if at all. this keyword used to support\n                  an optional <max_wait> parameter which is now ignored.\n\n                  if the parameter is found followed by an equal sign ('=') and\n                  a value, then the value is hashed and divided by the total\n                  weight of the running servers. the result designates which\n                  server will receive the request.\n\n                  this is used to track user identifiers in requests and ensure\n                  that a same user id will always be sent to the same server as\n                  long as no server goes up or down. if no value is found or if\n                  the parameter is not found, then a round robin algorithm is\n                  applied. note that this algorithm may only be used in an http\n                  backend. this algorithm is static by default, which means\n                  that changing a server's weight on the fly will have no\n                  effect, but this can be changed using \"hash-type\".\n\n      hdr(<name>) the http header <name> will be looked up in each http\n                  request. just as with the equivalent acl 'hdr()' function,\n                  the header name in parenthesis is not case sensitive. if the\n                  header is absent or if it does not contain any value, the\n                  roundrobin algorithm is applied instead.\n\n                  an optional 'use_domain_only' parameter is available, for\n                  reducing the hash algorithm to the main domain part with some\n                  specific headers such as 'host'. for instance, in the host\n                  value \"haproxy.1wt.eu\", only \"1wt\" will be considered.\n\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n      rdp-cookie\n      rdp-cookie(<name>)\n                  the rdp cookie <name> (or \"mstshash\" if omitted) will be\n                  looked up and hashed for each incoming tcp request. just as\n                  with the equivalent acl 'req_rdp_cookie()' function, the name\n                  is not case-sensitive. this mechanism is useful as a degraded\n                  persistence mode, as it makes it possible to always send the\n                  same user (or the same session id) to the same server. if the\n                  cookie is not found, the normal roundrobin algorithm is\n                  used instead.\n\n                  note that for this to work, the frontend must ensure that an\n                  rdp cookie is already present in the request buffer. for this\n                  you must use 'tcp-request content accept' rule combined with\n                  a 'req_rdp_cookie_cnt' acl.\n\n                  this algorithm is static by default, which means that\n                  changing a server's weight on the fly will have no effect,\n                  but this can be changed using \"hash-type\".\n\n                  see also the rdp_cookie pattern fetch function.\n\n    <arguments> is an optional list of arguments which may be needed by some\n                algorithms. right now, only \"url_param\" and \"uri\" support an\n                optional argument.\n\n  the load balancing algorithm of a backend is set to roundrobin when no other\n  algorithm, mode nor option have been set. the algorithm may only be set once\n  for each backend.\n\n  examples :\n        balance roundrobin\n        balance url_param userid\n        balance url_param session_id check_post 64\n        balance hdr(user-agent)\n        balance hdr(host)\n        balance hdr(host) use_domain_only\n\n  note: the following caveats and limitations on using the \"check_post\"\n  extension with \"url_param\" must be considered :\n\n    - all post requests are eligible for consideration, because there is no way\n      to determine if the parameters will be found in the body or entity which\n      may contain binary data. therefore another method may be required to\n      restrict consideration of post requests that have no url parameters in\n      the body. (see acl reqideny http_end)\n\n    - using a <max_wait> value larger than the request buffer size does not\n      make sense and is useless. the buffer size is set at build time, and\n      defaults to 16 kb.\n\n    - content-encoding is not supported, the parameter search will probably\n      fail; and load balancing will fall back to round robin.\n\n    - expect: 100-continue is not supported, load balancing will fall back to\n      round robin.\n\n    - transfer-encoding (rfc2616 3.6.1) is only supported in the first chunk.\n      if the entire parameter value is not present in the first chunk, the\n      selection of server is undefined (actually, defined by how little\n      actually appeared in the first chunk).\n\n    - this feature does not support generation of a 100, 411 or 501 response.\n\n    - in some cases, requesting \"check_post\" may attempt to scan the entire\n      contents of a message body. scanning normally terminates when linear\n      white space or control characters are found, indicating the end of what\n      might be a url parameter list. this is probably not a concern with sgml\n      type message bodies.\n\n  see also : \"dispatch\", \"cookie\", \"appsession\", \"transparent\", \"hash-type\" and\n             \"http_proxy\".\n\nbind [<address>]:<port_range> [, ...] [param*]\nbind /<path> [, ...] [param*]\n  define one or several listening addresses and/or ports in a frontend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <address>     is optional and can be a host name, an ipv4 address, an ipv6\n                  address, or '*'. it designates the address the frontend will\n                  listen on. if unset, all ipv4 addresses of the system will be\n                  listened on. the same will apply for '*' or the system's\n                  special address \"0.0.0.0\". the ipv6 equivalent is '::'.\n                  optionally, an address family prefix may be used before the\n                  address to force the family regardless of the address format,\n                  which can be useful to specify a path to a unix socket with\n                  no slash ('/'). currently supported prefixes are :\n                    - 'ipv4@'  -> address is always ipv4\n                    - 'ipv6@'  -> address is always ipv6\n                    - 'unix@'  -> address is a path to a local unix socket\n                    - 'abns@'  -> address is in abstract namespace (linux only).\n                      note: since abstract sockets are not \"rebindable\", they\n                            do not cope well with multi-process mode during\n                            soft-restart, so it is better to avoid them if\n                            nbproc is greater than 1\\. the effect is that if the\n                            new process fails to start, only one of the old ones\n                            will be able to rebind to the socket.\n                    - 'fd@<n>' -> use file descriptor <n> inherited from the\n                      parent. the fd must be bound and may or may not already\n                      be listening.\n                  you may want to reference some environment variables in the\n                  address parameter, see section 2.3 about environment\n                  variables.\n\n    <port_range>  is either a unique tcp port, or a port range for which the\n                  proxy will accept connections for the ip address specified\n                  above. the port is mandatory for tcp listeners. note that in\n                  the case of an ipv6 address, the port is always the number\n                  after the last colon (':'). a range can either be :\n                   - a numerical port (ex: '80')\n                   - a dash-delimited ports range explicitly stating the lower\n                     and upper bounds (ex: '2000-2100') which are included in\n                     the range.\n\n                  particular care must be taken against port ranges, because\n                  every <address:port> couple consumes one socket (= a file\n                  descriptor), so it's easy to consume lots of descriptors\n                  with a simple range, and to run out of sockets. also, each\n                  <address:port> couple must be used only once among all\n                  instances running on a same system. please note that binding\n                  to ports lower than 1024 generally require particular\n                  privileges to start the program, which are independent of\n                  the 'uid' parameter.\n\n    <path>        is a unix socket path beginning with a slash ('/'). this is\n                  alternative to the tcp listening port. haproxy will then\n                  receive unix connections on the socket located at this place.\n                  the path must begin with a slash and by default is absolute.\n                  it can be relative to the prefix defined by \"unix-bind\" in\n                  the global section. note that the total length of the prefix\n                  followed by the socket path cannot exceed some system limits\n                  for unix sockets, which commonly are set to 107 characters.\n\n    <param*>      is a list of parameters common to all sockets declared on the\n                  same line. these numerous parameters depend on os and build\n                  options and have a complete section dedicated to them. please\n                  refer to section 5 to for more details.\n\n  it is possible to specify a list of address:port combinations delimited by\n  commas. the frontend will then listen on all of these addresses. there is no\n  fixed limit to the number of addresses and ports which can be listened on in\n  a frontend, as well as there is no limit to the number of \"bind\" statements\n  in a frontend.\n\n  example :\n        listen http_proxy\n            bind :80,:443\n            bind 10.0.0.1:10080,10.0.0.1:10443\n            bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy\n\n        listen http_https_proxy\n            bind :80\n            bind :443 ssl crt /etc/haproxy/site.pem\n\n        listen http_https_proxy_explicit\n            bind ipv6@:80\n            bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem\n            bind unix@ssl-frontend.sock user root mode 600 accept-proxy\n\n        listen external_bind_app1\n            bind \"fd@${fd_app1}\"\n\n  see also : \"source\", \"option forwardfor\", \"unix-bind\" and the proxy protocol\n             documentation, and section 5 about bind options.\n\nbind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] ...\n  limit visibility of an instance to a certain set of processes numbers.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    all           all process will see this instance. this is the default. it\n                  may be used to override a default value.\n\n    odd           this instance will be enabled on processes 1,3,5,...63\\. this\n                  option may be combined with other numbers.\n\n    even          this instance will be enabled on processes 2,4,6,...64\\. this\n                  option may be combined with other numbers. do not use it\n                  with less than 2 processes otherwise some instances might be\n                  missing from all processes.\n\n    number        the instance will be enabled on this process number or range,\n                  whose values must all be between 1 and 32 or 64 depending on\n                  the machine's word size. if a proxy is bound to process\n                  numbers greater than the configured global.nbproc, it will\n                  either be forced to process #1 if a single process was\n                  specified, or to all processes otherwise.\n\n  this keyword limits binding of certain instances to certain processes. this\n  is useful in order not to have too many processes listening to the same\n  ports. for instance, on a dual-core machine, it might make sense to set\n  'nbproc 2' in the global section, then distributes the listeners among 'odd'\n  and 'even' instances.\n\n  at the moment, it is not possible to reference more than 32 or 64 processes\n  using this keyword, but this should be more than enough for most setups.\n  please note that 'all' really means all processes regardless of the machine's\n  word size, and is not limited to the first 32 or 64.\n\n  each \"bind\" line may further be limited to a subset of the proxy's processes,\n  please consult the \"process\" bind keyword in section 5.1.\n\n  when a frontend has no explicit \"bind-process\" line, it tries to bind to all\n  the processes referenced by its \"bind\" lines. that means that frontends can\n  easily adapt to their listeners' processes.\n\n  if some backends are referenced by frontends bound to other processes, the\n  backend automatically inherits the frontend's processes.\n\n  example :\n        listen app_ip1\n            bind 10.0.0.1:80\n            bind-process odd\n\n        listen app_ip2\n            bind 10.0.0.2:80\n            bind-process even\n\n        listen management\n            bind 10.0.0.3:80\n            bind-process 1 2 3 4\n\n        listen management\n            bind 10.0.0.4:80\n            bind-process 1-4\n\n  see also : \"nbproc\" in global section, and \"process\" in section 5.1.\n\nblock { if | unless } <condition>\n  block a layer 7 request if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  the http request will be blocked very early in the layer 7 processing\n  if/unless <condition> is matched. a 403 error will be returned if the request\n  is blocked. the condition has to reference acls (see section 7). this is\n  typically used to deny access to certain sensitive resources if some\n  conditions are met or not met. there is no fixed limit to the number of\n  \"block\" statements per instance.\n\n  example:\n        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3\n        acl invalid_src  src_port     0:1023\n        acl local_dst    hdr(host) -i localhost\n        block if invalid_src || local_dst\n\n  see section 7 about acl usage.\n\ncapture cookie <name> len <length>\n  capture and log a cookie in the request and in the response.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the beginning of the name of the cookie to capture. in order\n              to match the exact name, simply suffix the name with an equal\n              sign ('='). the full name will appear in the logs, which is\n              useful with application servers which adjust both the cookie name\n              and value (eg: aspsessionxxxxx).\n\n    <length>  is the maximum number of characters to report in the logs, which\n              include the cookie name, the equal sign and the value, all in the\n              standard \"name=value\" form. the string will be truncated on the\n              right if it exceeds <length>.\n\n  only the first cookie is captured. both the \"cookie\" request headers and the\n  \"set-cookie\" response headers are monitored. this is particularly useful to\n  check for application bugs causing session crossing or stealing between\n  users, because generally the user's cookies can only change on a login page.\n\n  when the cookie was not presented by the client, the associated log column\n  will report \"-\". when a request does not cause a cookie to be assigned by the\n  server, a \"-\" is reported in the response column.\n\n  the capture is performed in the frontend only because it is necessary that\n  the log format does not change for a given frontend depending on the\n  backends. this may change in the future. note that there can be only one\n  \"capture cookie\" statement in a frontend. the maximum capture length is set\n  by the global \"tune.http.cookielen\" setting and defaults to 63 characters. it\n  is not possible to specify a capture in a \"defaults\" section.\n\n  example:\n        capture cookie aspsession len 32\n\n  see also : \"capture request header\", \"capture response header\" as well as\n            section 8 about logging.\n\ncapture request header <name> len <length>\n  capture and log the last occurrence of the specified request header.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the name of the header to capture. the header names are not\n              case-sensitive, but it is a common practice to write them as they\n              appear in the requests, with the first letter of each word in\n              upper case. the header name will not appear in the logs, only the\n              value is reported, but the position in the logs is respected.\n\n    <length>  is the maximum number of characters to extract from the value and\n              report in the logs. the string will be truncated on the right if\n              it exceeds <length>.\n\n  the complete value of the last occurrence of the header is captured. the\n  value will be added to the logs between braces ('{}'). if multiple headers\n  are captured, they will be delimited by a vertical bar ('|') and will appear\n  in the same order they were declared in the configuration. non-existent\n  headers will be logged just as an empty string. common uses for request\n  header captures include the \"host\" field in virtual hosting environments, the\n  \"content-length\" when uploads are supported, \"user-agent\" to quickly\n  differentiate between real users and robots, and \"x-forwarded-for\" in proxied\n  environments to find where the request came from.\n\n  note that when capturing headers such as \"user-agent\", some spaces may be\n  logged, making the log analysis more difficult. thus be careful about what\n  you log if you know your log parser is not smart enough to rely on the\n  braces.\n\n  there is no limit to the number of captured request headers nor to their\n  length, though it is wise to keep them low to limit memory usage per session.\n  in order to keep log format consistent for a same frontend, header captures\n  can only be declared in a frontend. it is not possible to specify a capture\n  in a \"defaults\" section.\n\n  example:\n        capture request header host len 15\n        capture request header x-forwarded-for len 15\n        capture request header referrer len 15\n\n  see also : \"capture cookie\", \"capture response header\" as well as section 8\n             about logging.\n\ncapture response header <name> len <length>\n  capture and log the last occurrence of the specified response header.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <name>    is the name of the header to capture. the header names are not\n              case-sensitive, but it is a common practice to write them as they\n              appear in the response, with the first letter of each word in\n              upper case. the header name will not appear in the logs, only the\n              value is reported, but the position in the logs is respected.\n\n    <length>  is the maximum number of characters to extract from the value and\n              report in the logs. the string will be truncated on the right if\n              it exceeds <length>.\n\n  the complete value of the last occurrence of the header is captured. the\n  result will be added to the logs between braces ('{}') after the captured\n  request headers. if multiple headers are captured, they will be delimited by\n  a vertical bar ('|') and will appear in the same order they were declared in\n  the configuration. non-existent headers will be logged just as an empty\n  string. common uses for response header captures include the \"content-length\"\n  header which indicates how many bytes are expected to be returned, the\n  \"location\" header to track redirections.\n\n  there is no limit to the number of captured response headers nor to their\n  length, though it is wise to keep them low to limit memory usage per session.\n  in order to keep log format consistent for a same frontend, header captures\n  can only be declared in a frontend. it is not possible to specify a capture\n  in a \"defaults\" section.\n\n  example:\n        capture response header content-length len 9\n        capture response header location len 15\n\n  see also : \"capture cookie\", \"capture request header\" as well as section 8\n             about logging.\n\nclitimeout <timeout> (deprecated)\n  set the maximum inactivity time on the client side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value is specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase, when the client sends the request, and during the\n  response while it is reading data sent by the server. the value is specified\n  in milliseconds by default, but can be in any other unit if the number is\n  suffixed by the unit, as specified at the top of this document. in tcp mode\n  (and to a lesser extent, in http mode), it is highly recommended that the\n  client timeout remains equal to the server timeout in order to avoid complex\n  situations to debug. it is a good practice to cover one or several tcp packet\n  losses by specifying timeouts that are slightly above multiples of 3 seconds\n  (eg: 4 or 5 seconds).\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for compatibility but is currently deprecated.\n  please use \"timeout client\" instead.\n\n  see also : \"timeout client\", \"timeout http-request\", \"timeout server\", and\n             \"srvtimeout\".\n\ncompression algo <algorithm> ...\ncompression type <mime type> ...\ncompression offload\n  enable http compression.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    algo     is followed by the list of supported compression algorithms.\n    type     is followed by the list of mime types that will be compressed.\n    offload  makes haproxy work as a compression offloader only (see notes).\n\n  the currently supported algorithms are :\n    identity     this is mostly for debugging, and it was useful for developing\n                 the compression feature. identity does not apply any change on\n                 data.\n\n    gzip         applies gzip compression. this setting is only available when\n                 support for zlib was built in.\n\n    deflate      same as \"gzip\", but with deflate algorithm and zlib format.\n                 note that this algorithm has ambiguous support on many\n                 browsers and no support at all from recent ones. it is\n                 strongly recommended not to use it for anything else than\n                 experimentation. this setting is only available when support\n                 for zlib was built in.\n\n    raw-deflate  same as \"deflate\" without the zlib wrapper, and used as an\n                 alternative when the browser wants \"deflate\". all major\n                 browsers understand it and despite violating the standards,\n                 it is known to work better than \"deflate\", at least on msie\n                 and some versions of safari. do not use it in conjunction\n                 with \"deflate\", use either one or the other since both react\n                 to the same accept-encoding token. this setting is only\n                 available when support for zlib was built in.\n\n  compression will be activated depending on the accept-encoding request\n  header. with identity, it does not take care of that header.\n  if backend servers support http compression, these directives\n  will be no-op: haproxy will see the compressed response and will not\n  compress again. if backend servers do not support http compression and\n  there is accept-encoding header in request, haproxy will compress the\n  matching response.\n\n  the \"offload\" setting makes haproxy remove the accept-encoding header to\n  prevent backend servers from compressing responses. it is strongly\n  recommended not to do this because this means that all the compression work\n  will be done on the single point where haproxy is located. however in some\n  deployment scenarios, haproxy may be installed in front of a buggy gateway\n  with broken http compression implementation which can't be turned off.\n  in that case haproxy can be used to prevent that gateway from emitting\n  invalid payloads. in this case, simply removing the header in the\n  configuration does not work because it applies before the header is parsed,\n  so that prevents haproxy from compressing. the \"offload\" setting should\n  then be used for such scenarios. note: for now, the \"offload\" setting is\n  ignored when set in a defaults section.\n\n  compression is disabled when:\n    * the request does not advertise a supported compression algorithm in the\n      \"accept-encoding\" header\n    * the response message is not http/1.1\n    * http status code is not 200\n    * response header \"transfer-encoding\" contains \"chunked\" (temporary\n      workaround)\n    * response contain neither a \"content-length\" header nor a\n      \"transfer-encoding\" whose last value is \"chunked\"\n    * response contains a \"content-type\" header whose first value starts with\n      \"multipart\"\n    * the response contains the \"no-transform\" value in the \"cache-control\"\n      header\n    * user-agent matches \"mozilla/4\" unless it is msie 6 with xp sp2, or msie 7\n      and later\n    * the response contains a \"content-encoding\" header, indicating that the\n      response is already compressed (see compression offload)\n\n  note: the compression does not rewrite etag headers, and does not emit the\n        warning header.\n\n  examples :\n        compression algo gzip\n        compression type text/html text/plain\n\ncontimeout <timeout> (deprecated)\n  set the maximum time to wait for a connection attempt to a server to succeed.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value is specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if the server is located on the same lan as haproxy, the connection should be\n  immediate (less than a few milliseconds). anyway, it is a good practice to\n  cover one or several tcp packet losses by specifying timeouts that are\n  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the\n  connect timeout also presets the queue timeout to the same value if this one\n  has not been specified. historically, the contimeout was also used to set the\n  tarpit timeout in a listen section, which is not possible in a pure frontend.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of failed sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for backwards compatibility but is currently\n  deprecated. please use \"timeout connect\", \"timeout queue\" or \"timeout tarpit\"\n  instead.\n\n  see also : \"timeout connect\", \"timeout queue\", \"timeout tarpit\",\n             \"timeout server\", \"contimeout\".\n\ncookie <name> [ rewrite | insert | prefix ] [ indirect ] [ nocache ]\n              [ postonly ] [ preserve ] [ httponly ] [ secure ]\n              [ domain <domain> ]* [ maxidle <idle> ] [ maxlife <life> ]\n  enable cookie-based persistence in a backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <name>    is the name of the cookie which will be monitored, modified or\n              inserted in order to bring persistence. this cookie is sent to\n              the client via a \"set-cookie\" header in the response, and is\n              brought back by the client in a \"cookie\" header in all requests.\n              special care should be taken to choose a name which does not\n              conflict with any likely application cookie. also, if the same\n              backends are subject to be used by the same clients (eg:\n              http/https), care should be taken to use different cookie names\n              between all backends if persistence between them is not desired.\n\n    rewrite   this keyword indicates that the cookie will be provided by the\n              server and that haproxy will have to modify its value to set the\n              server's identifier in it. this mode is handy when the management\n              of complex combinations of \"set-cookie\" and \"cache-control\"\n              headers is left to the application. the application can then\n              decide whether or not it is appropriate to emit a persistence\n              cookie. since all responses should be monitored, this mode only\n              works in http close mode. unless the application behaviour is\n              very complex and/or broken, it is advised not to start with this\n              mode for new deployments. this keyword is incompatible with\n              \"insert\" and \"prefix\".\n\n    insert    this keyword indicates that the persistence cookie will have to\n              be inserted by haproxy in server responses if the client did not\n\n              already have a cookie that would have permitted it to access this\n              server. when used without the \"preserve\" option, if the server\n              emits a cookie with the same name, it will be remove before\n              processing.  for this reason, this mode can be used to upgrade\n              existing configurations running in the \"rewrite\" mode. the cookie\n              will only be a session cookie and will not be stored on the\n              client's disk. by default, unless the \"indirect\" option is added,\n              the server will see the cookies emitted by the client. due to\n              caching effects, it is generally wise to add the \"nocache\" or\n              \"postonly\" keywords (see below). the \"insert\" keyword is not\n              compatible with \"rewrite\" and \"prefix\".\n\n    prefix    this keyword indicates that instead of relying on a dedicated\n              cookie for the persistence, an existing one will be completed.\n              this may be needed in some specific environments where the client\n              does not support more than one single cookie and the application\n              already needs it. in this case, whenever the server sets a cookie\n              named <name>, it will be prefixed with the server's identifier\n              and a delimiter. the prefix will be removed from all client\n              requests so that the server still finds the cookie it emitted.\n              since all requests and responses are subject to being modified,\n              this mode requires the http close mode. the \"prefix\" keyword is\n              not compatible with \"rewrite\" and \"insert\". note: it is highly\n              recommended not to use \"indirect\" with \"prefix\", otherwise server\n              cookie updates would not be sent to clients.\n\n    indirect  when this option is specified, no cookie will be emitted to a\n              client which already has a valid one for the server which has\n              processed the request. if the server sets such a cookie itself,\n              it will be removed, unless the \"preserve\" option is also set. in\n              \"insert\" mode, this will additionally remove cookies from the\n              requests transmitted to the server, making the persistence\n              mechanism totally transparent from an application point of view.\n              note: it is highly recommended not to use \"indirect\" with\n              \"prefix\", otherwise server cookie updates would not be sent to\n              clients.\n\n    nocache   this option is recommended in conjunction with the insert mode\n              when there is a cache between the client and haproxy, as it\n              ensures that a cacheable response will be tagged non-cacheable if\n              a cookie needs to be inserted. this is important because if all\n              persistence cookies are added on a cacheable home page for\n              instance, then all customers will then fetch the page from an\n              outer cache and will all share the same persistence cookie,\n              leading to one server receiving much more traffic than others.\n              see also the \"insert\" and \"postonly\" options.\n\n    postonly  this option ensures that cookie insertion will only be performed\n              on responses to post requests. it is an alternative to the\n              \"nocache\" option, because post responses are not cacheable, so\n              this ensures that the persistence cookie will never get cached.\n              since most sites do not need any sort of persistence before the\n              first post which generally is a login request, this is a very\n              efficient method to optimize caching without risking to find a\n              persistence cookie in the cache.\n              see also the \"insert\" and \"nocache\" options.\n\n    preserve  this option may only be used with \"insert\" and/or \"indirect\". it\n              allows the server to emit the persistence cookie itself. in this\n              case, if a cookie is found in the response, haproxy will leave it\n              untouched. this is useful in order to end persistence after a\n              logout request for instance. for this, the server just has to\n              emit a cookie with an invalid value (eg: empty) or with a date in\n              the past. by combining this mechanism with the \"disable-on-404\"\n              check option, it is possible to perform a completely graceful\n              shutdown because users will definitely leave the server after\n              they logout.\n\n    httponly  this option tells haproxy to add an \"httponly\" cookie attribute\n              when a cookie is inserted. this attribute is used so that a\n              user agent doesn't share the cookie with non-http components.\n              please check rfc6265 for more information on this attribute.\n\n    secure    this option tells haproxy to add a \"secure\" cookie attribute when\n              a cookie is inserted. this attribute is used so that a user agent\n              never emits this cookie over non-secure channels, which means\n              that a cookie learned with this flag will be presented only over\n              ssl/tls connections. please check rfc6265 for more information on\n              this attribute.\n\n    domain    this option allows to specify the domain at which a cookie is\n              inserted. it requires exactly one parameter: a valid domain\n              name. if the domain begins with a dot, the browser is allowed to\n              use it for any host ending with that name. it is also possible to\n              specify several domain names by invoking this option multiple\n              times. some browsers might have small limits on the number of\n              domains, so be careful when doing that. for the record, sending\n              10 domains to msie 6 or firefox 2 works as expected.\n\n    maxidle   this option allows inserted cookies to be ignored after some idle\n              time. it only works with insert-mode cookies. when a cookie is\n              sent to the client, the date this cookie was emitted is sent too.\n              upon further presentations of this cookie, if the date is older\n              than the delay indicated by the parameter (in seconds), it will\n              be ignored. otherwise, it will be refreshed if needed when the\n              response is sent to the client. this is particularly useful to\n              prevent users who never close their browsers from remaining for\n              too long on the same server (eg: after a farm size change). when\n              this option is set and a cookie has no date, it is always\n              accepted, but gets refreshed in the response. this maintains the\n              ability for admins to access their sites. cookies that have a\n              date in the future further than 24 hours are ignored. doing so\n              lets admins fix timezone issues without risking kicking users off\n              the site.\n\n    maxlife   this option allows inserted cookies to be ignored after some life\n              time, whether they're in use or not. it only works with insert\n              mode cookies. when a cookie is first sent to the client, the date\n              this cookie was emitted is sent too. upon further presentations\n              of this cookie, if the date is older than the delay indicated by\n              the parameter (in seconds), it will be ignored. if the cookie in\n              the request has no date, it is accepted and a date will be set.\n              cookies that have a date in the future further than 24 hours are\n              ignored. doing so lets admins fix timezone issues without risking\n              kicking users off the site. contrary to maxidle, this value is\n              not refreshed, only the first visit date counts. both maxidle and\n              maxlife may be used at the time. this is particularly useful to\n              prevent users who never close their browsers from remaining for\n              too long on the same server (eg: after a farm size change). this\n              is stronger than the maxidle method in that it forces a\n              redispatch after some absolute delay.\n\n  there can be only one persistence cookie per http backend, and it can be\n  declared in a defaults section. the value of the cookie will be the value\n  indicated after the \"cookie\" keyword in a \"server\" statement. if no cookie\n  is declared for a given server, the cookie is not set.\n\n  examples :\n        cookie jsessionid prefix\n        cookie srv insert indirect nocache\n        cookie srv insert postonly indirect\n        cookie srv insert indirect nocache maxidle 30m maxlife 8h\n\n  see also : \"appsession\", \"balance source\", \"capture cookie\", \"server\"\n             and \"ignore-persist\".\n\ndeclare capture [ request | response ] len <length>\n  declares a capture slot.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments:\n    <length> is the length allowed for the capture.\n\n  this declaration is only available in the frontend or listen section, but the\n  reserved slot can be used in the backends. the \"request\" keyword allocates a\n  capture slot for use in the request, and \"response\" allocates a capture slot\n  for use in the response.\n\n  see also: \"capture-req\", \"capture-res\" (sample converters),\n            \"http-request capture\" and \"http-response capture\".\n\ndefault-server [param*]\n  change default options for a server in a backend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments:\n    <param*>  is a list of parameters for this server. the \"default-server\"\n              keyword accepts an important number of options and has a complete\n              section dedicated to it. please refer to section 5 for more\n              details.\n\n  example :\n        default-server inter 1000 weight 13\n\n  see also: \"server\" and section 5 about server options\n\ndefault_backend <backend>\n  specify the backend to use when no \"use_backend\" rule has been matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <backend> is the name of the backend to use.\n\n  when doing content-switching between frontend and backends using the\n  \"use_backend\" keyword, it is often useful to indicate which backend will be\n  used when no rule has matched. it generally is the dynamic backend which\n  will catch all undetermined requests.\n\n  example :\n\n        use_backend     dynamic  if  url_dyn\n        use_backend     static   if  url_css url_img extension_img\n        default_backend dynamic\n\n  see also : \"use_backend\"\n\ndescription <string>\n  describe a listen, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments : string\n\n  allows to add a sentence to describe the related object in the haproxy html\n  stats page. the description will be printed on the right of the object name\n  it describes.\n  no need to backslash spaces in the <string> arguments.\n\ndisabled\n  disable a proxy, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  the \"disabled\" keyword is used to disable an instance, mainly in order to\n  liberate a listening port or to temporarily disable a service. the instance\n  will still be created and its configuration will be checked, but it will be\n  created in the \"stopped\" state and will appear as such in the statistics. it\n  will not receive any traffic nor will it send any health-checks or logs. it\n  is possible to disable many instances at once by adding the \"disabled\"\n  keyword in a \"defaults\" section.\n\n  see also : \"enabled\"\n\ndispatch <address>:<port>\n  set a default server address\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n\n    <address> is the ipv4 address of the default server. alternatively, a\n              resolvable hostname is supported, but this name will be resolved\n              during start-up.\n\n    <ports>   is a mandatory port specification. all connections will be sent\n              to this port, and it is not permitted to use port offsets as is\n              possible with normal servers.\n\n  the \"dispatch\" keyword designates a default server for use when no other\n  server can take the connection. in the past it was used to forward non\n  persistent connections to an auxiliary load balancer. due to its simple\n  syntax, it has also been used for simple tcp relays. it is recommended not to\n  use it for more clarity, and to use the \"server\" directive instead.\n\n  see also : \"server\"\n\nenabled\n  enable a proxy, frontend or backend.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  the \"enabled\" keyword is used to explicitly enable an instance, when the\n  defaults has been set to \"disabled\". this is very rarely used.\n\n  see also : \"disabled\"\n\nerrorfile <code> <file>\n  return a file contents instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 200, 400, 403, 405, 408, 429, 500, 502, 503, and\n              504.\n\n    <file>    designates a file containing the full http response. it is\n              recommended to follow the common practice of appending \".http\" to\n              the filename so that people do not confuse the response with html\n              error pages, and to use absolute paths, since files are read\n              before any chroot is performed.\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  the files are returned verbatim on the tcp socket. this allows any trick such\n  as redirections to another url or site, as well as tricks to clean cookies,\n  force enable or disable caching, etc... the package provides default error\n  files returning the same contents as default errors.\n\n  the files should not exceed the configured buffer size (bufsize), which\n  generally is 8 or 16 kb, otherwise they will be truncated. it is also wise\n  not to put any reference to local contents (eg: images) in order to avoid\n  loops between the client and haproxy when all servers are down, causing an\n  error to be returned instead of an image. for better http compliance, it is\n  recommended that all header lines end with cr-lf and not lf alone.\n\n  the files are read at the same time as the configuration and kept in memory.\n  for this reason, the errors continue to be returned even when the process is\n  chrooted, and no file change is considered while the process is running. a\n  simple method for developing those files consists in associating them to the\n  403 status code and interrogating a blocked url.\n\n  see also : \"errorloc\", \"errorloc302\", \"errorloc303\"\n\n  example :\n        errorfile 400 /etc/haproxy/errorfiles/400badreq.http\n        errorfile 408 /dev/null  # workaround chrome pre-connect bug\n        errorfile 403 /etc/haproxy/errorfiles/403forbid.http\n        errorfile 503 /etc/haproxy/errorfiles/503sorry.http\n\nerrorloc <code> <url>\nerrorloc302 <code> <url>\n  return an http redirection to a url instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 200, 400, 403, 408, 500, 502, 503, and 504.\n\n    <url>     it is the exact contents of the \"location\" header. it may contain\n              either a relative uri to an error page hosted on the same site,\n              or an absolute uri designating an error page on another site.\n              special care should be given to relative uris to avoid redirect\n              loops if the uri itself may generate the same error (eg: 500).\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  note that both keyword return the http 302 status code, which tells the\n  client to fetch the designated url using the same http method. this can be\n  quite problematic in case of non-get methods such as post, because the url\n  sent to the client might not be allowed for something other than get. to\n  workaround this problem, please use \"errorloc303\" which send the http 303\n  status code, indicating to the client that the url must be fetched with a get\n  request.\n\n  see also : \"errorfile\", \"errorloc303\"\n\nerrorloc303 <code> <url>\n  return an http redirection to a url instead of errors generated by haproxy\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <code>    is the http status code. currently, haproxy is capable of\n              generating codes 400, 403, 408, 500, 502, 503, and 504.\n\n    <url>     it is the exact contents of the \"location\" header. it may contain\n              either a relative uri to an error page hosted on the same site,\n              or an absolute uri designating an error page on another site.\n              special care should be given to relative uris to avoid redirect\n              loops if the uri itself may generate the same error (eg: 500).\n\n  it is important to understand that this keyword is not meant to rewrite\n  errors returned by the server, but errors detected and returned by haproxy.\n  this is why the list of supported errors is limited to a small set.\n\n  code 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\n  note that both keyword return the http 303 status code, which tells the\n  client to fetch the designated url using the same http get method. this\n  solves the usual problems associated with \"errorloc\" and the 302 code. it is\n  possible that some very old browsers designed before http/1.1 do not support\n  it, but no such problem has been reported till now.\n\n  see also : \"errorfile\", \"errorloc\", \"errorloc302\"\n\nemail-alert from <emailaddr>\n  declare the from email address to be used in both the envelope and header\n  of email alerts.  this is the address that email alerts are sent from.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the from email address to use when sending email alerts\n\n  also requires \"email-alert mailers\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert level\", \"email-alert mailers\",\n             \"email-alert myhostname\", \"email-alert to\", section 3.6 about mailers.\n\nemail-alert level <level>\n  declare the maximum log level of messages for which email alerts will be\n  sent. this acts as a filter on the sending of email alerts.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <level> one of the 8 syslog levels:\n              emerg alert crit err warning notice info  debug\n            the above syslog levels are ordered from lowest to highest.\n\n  by default level is alert\n\n  also requires \"email-alert from\", \"email-alert mailers\" and\n  \"email-alert to\" to be set and if so sending email alerts is enabled\n  for the proxy.\n\n  alerts are sent when :\n\n  * an un-paused server is marked as down and <level> is alert or lower\n  * a paused server is marked as down and <level> is notice or lower\n  * a server is marked as up or enters the drain state and <level>\n    is notice or lower\n  * \"option log-health-checks\" is enabled, <level> is info or lower,\n     and a health check status update occurs\n\n  see also : \"email-alert from\", \"email-alert mailers\",\n             \"email-alert myhostname\", \"email-alert to\",\n             section 3.6 about mailers.\n\nemail-alert mailers <mailersect>\n  declare the mailers to be used when sending email alerts\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <mailersect> is the name of the mailers section to send email alerts.\n\n  also requires \"email-alert from\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert myhostname\",\n             \"email-alert to\", section 3.6 about mailers.\n\nemail-alert myhostname <hostname>\n  declare the to hostname address to be used when communicating with\n  mailers.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the to email address to use when sending email alerts\n\n  by default the systems hostname is used.\n\n  also requires \"email-alert from\", \"email-alert mailers\" and\n  \"email-alert to\" to be set and if so sending email alerts is enabled\n  for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert mailers\",\n             \"email-alert to\", section 3.6 about mailers.\n\nemail-alert to <emailaddr>\n  declare both the recipent address in the envelope and to address in the\n  header of email alerts. this is the address that email alerts are sent to.\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  arguments :\n\n    <emailaddr> is the to email address to use when sending email alerts\n\n  also requires \"email-alert mailers\" and \"email-alert to\" to be set\n  and if so sending email alerts is enabled for the proxy.\n\n  see also : \"email-alert from\", \"email-alert level\", \"email-alert mailers\",\n             \"email-alert myhostname\", section 3.6 about mailers.\n\nforce-persist { if | unless } <condition>\n  declare a condition to force persistence on down servers\n  may be used in sections:    defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n\n  by default, requests are not dispatched to down servers. it is possible to\n  force this using \"option persist\", but it is unconditional and redispatches\n  to a valid server if \"option redispatch\" is set. that leaves with very little\n  possibilities to force some requests to reach a server which is artificially\n  marked down for maintenance operations.\n\n  the \"force-persist\" statement allows one to declare various acl-based\n  conditions which, when met, will cause a request to ignore the down status of\n  a server and still try to connect to it. that makes it possible to start a\n  server, still replying an error to the health checks, and run a specially\n  configured browser to test the service. among the handy methods, one could\n  use a specific source ip address, or a specific cookie. the cookie also has\n  the advantage that it can easily be added/removed on the browser from a test\n  page. once the service is validated, it is then possible to open the service\n  to the world by returning a valid response to health checks.\n\n  the forced persistence is enabled when an \"if\" condition is met, or unless an\n  \"unless\" condition is met. the final redispatch is always disabled when this\n  is used.\n\n  see also : \"option redispatch\", \"ignore-persist\", \"persist\",\n             and section 7 about acl usage.\n\nfullconn <conns>\n  specify at what backend load the servers will reach their maxconn\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <conns>   is the number of connections on the backend which will make the\n              servers use the maximal number of connections.\n\n  when a server has a \"maxconn\" parameter specified, it means that its number\n  of concurrent connections will never go higher. additionally, if it has a\n  \"minconn\" parameter, it indicates a dynamic limit following the backend's\n  load. the server will then always accept at least <minconn> connections,\n  never more than <maxconn>, and the limit will be on the ramp between both\n  values when the backend has less than <conns> concurrent connections. this\n  makes it possible to limit the load on the servers during normal loads, but\n  push it further for important loads without overloading the servers during\n  exceptional loads.\n\n  since it's hard to get this value right, haproxy automatically sets it to\n  10% of the sum of the maxconns of all frontends that may branch to this\n  backend (based on \"use_backend\" and \"default_backend\" rules). that way it's\n  safe to leave it unset. however, \"use_backend\" involving dynamic names are\n  not counted since there is no way to know if they could match or not.\n\n  example :\n     # the servers will accept between 100 and 1000 concurrent connections each\n     # and the maximum of 1000 will be reached when the backend reaches 10000\n     # connections.\n     backend dynamic\n        fullconn   10000\n        server     srv1   dyn1:80 minconn 100 maxconn 1000\n        server     srv2   dyn2:80 minconn 100 maxconn 1000\n\n  see also : \"maxconn\", \"server\"\n\ngrace <time>\n  maintain a proxy operational for some time after a soft stop\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <time>    is the time (by default in milliseconds) for which the instance\n              will remain operational with the frontend sockets still listening\n              when a soft-stop is received via the sigusr1 signal.\n\n  this may be used to ensure that the services disappear in a certain order.\n  this was designed so that frontends which are dedicated to monitoring by an\n  external equipment fail immediately while other ones remain up for the time\n  needed by the equipment to detect the failure.\n\n  note that currently, there is very little benefit in using this parameter,\n  and it may in fact complicate the soft-reconfiguration process more than\n  simplify it.\n\nhash-type <method> <function> <modifier>\n  specify a method to use for mapping hashes to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <method> is the method used to select a server from the hash computed by\n             the <function> :\n\n      map-based   the hash table is a static array containing all alive servers.\n                  the hashes will be very smooth, will consider weights, but\n                  will be static in that weight changes while a server is up\n                  will be ignored. this means that there will be no slow start.\n                  also, since a server is selected by its position in the array,\n                  most mappings are changed when the server count changes. this\n                  means that when a server goes up or down, or when a server is\n                  added to a farm, most connections will be redistributed to\n                  different servers. this can be inconvenient with caches for\n                  instance.\n\n      consistent  the hash table is a tree filled with many occurrences of each\n                  server. the hash key is looked up in the tree and the closest\n                  server is chosen. this hash is dynamic, it supports changing\n                  weights while the servers are up, so it is compatible with the\n                  slow start feature. it has the advantage that when a server\n                  goes up or down, only its associations are moved. when a\n                  server is added to the farm, only a few part of the mappings\n                  are redistributed, making it an ideal method for caches.\n                  however, due to its principle, the distribution will never be\n                  very smooth and it may sometimes be necessary to adjust a\n                  server's weight or its id to get a more balanced distribution.\n                  in order to get the same distribution on multiple load\n                  balancers, it is important that all servers have the exact\n                  same ids. note: consistent hash uses sdbm and avalanche if no\n                  hash function is specified.\n\n    <function> is the hash function to be used :\n\n       sdbm   this function was created initially for sdbm (a public-domain\n              reimplementation of ndbm) database library. it was found to do\n              well in scrambling bits, causing better distribution of the keys\n              and fewer splits. it also happens to be a good general hashing\n              function with good distribution, unless the total server weight\n              is a multiple of 64, in which case applying the avalanche\n              modifier may help.\n\n       djb2   this function was first proposed by dan bernstein many years ago\n              on comp.lang.c. studies have shown that for certain workload this\n              function provides a better distribution than sdbm. it generally\n              works well with text-based inputs though it can perform extremely\n              poorly with numeric-only input or when the total server weight is\n              a multiple of 33, unless the avalanche modifier is also used.\n\n       wt6    this function was designed for haproxy while testing other\n              functions in the past. it is not as smooth as the other ones, but\n              is much less sensible to the input data set or to the number of\n              servers. it can make sense as an alternative to sdbm+avalanche or\n              djb2+avalanche for consistent hashing or when hashing on numeric\n              data such as a source ip address or a visitor identifier in a url\n              parameter.\n\n       crc32  this is the most common crc32 implementation as used in ethernet,\n              gzip, png, etc. it is slower than the other ones but may provide\n              a better distribution or less predictable results especially when\n              used on strings.\n\n    <modifier> indicates an optional method applied after hashing the key :\n\n       avalanche   this directive indicates that the result from the hash\n                   function above should not be used in its raw form but that\n                   a 4-byte full avalanche hash must be applied first. the\n                   purpose of this step is to mix the resulting bits from the\n                   previous hash in order to avoid any undesired effect when\n                   the input contains some limited values or when the number of\n                   servers is a multiple of one of the hash's components (64\n                   for sdbm, 33 for djb2). enabling avalanche tends to make the\n                   result less predictable, but it's also not as smooth as when\n                   using the original function. some testing might be needed\n                   with some workloads. this hash is one of the many proposed\n                   by bob jenkins.\n\n  the default hash type is \"map-based\" and is recommended for most usages. the\n  default function is \"sdbm\", the selection of a function should be based on\n  the range of the values being hashed.\n\n  see also : \"balance\", \"server\"\n\nhttp-check disable-on-404\n  enable a maintenance mode upon http/404 response to health-checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when this option is set, a server which returns an http code 404 will be\n  excluded from further load-balancing, but will still receive persistent\n  connections. this provides a very convenient method for web administrators\n  to perform a graceful shutdown of their servers. it is also important to note\n  that a server which is detected as failed while it was in this mode will not\n  generate an alert, just a notice. if the server responds 2xx or 3xx again, it\n  will immediately be reinserted into the farm. the status on the stats page\n  reports \"nolb\" for a server in this mode. it is important to note that this\n  option only works in conjunction with the \"httpchk\" option. if this option\n  is used with \"http-check expect\", then it has precedence over it so that 404\n  responses will still be considered as soft-stop.\n\n  see also : \"option httpchk\", \"http-check expect\"\n\nhttp-check expect [!] <match> <pattern>\n  make http health checks consider response contents or specific status codes\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <match>   is a keyword indicating how to look for a specific pattern in the\n              response. the keyword may be one of \"status\", \"rstatus\",\n              \"string\", or \"rstring\". the keyword may be preceded by an\n              exclamation mark (\"!\") to negate the match. spaces are allowed\n              between the exclamation mark and the keyword. see below for more\n              details on the supported keywords.\n\n    <pattern> is the pattern to look for. it may be a string or a regular\n              expression. if the pattern contains spaces, they must be escaped\n              with the usual backslash ('\\').\n\n  by default, \"option httpchk\" considers that response statuses 2xx and 3xx\n  are valid, and that others are invalid. when \"http-check expect\" is used,\n  it defines what is considered valid or invalid. only one \"http-check\"\n  statement is supported in a backend. if a server fails to respond or times\n  out, the check obviously fails. the available matches are :\n\n    status <string> : test the exact string match for the http status code.\n                      a health check response will be considered valid if the\n                      response's status code is exactly this string. if the\n                      \"status\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the status code matches.\n\n    rstatus <regex> : test a regular expression for the http status code.\n                      a health check response will be considered valid if the\n                      response's status code matches the expression. if the\n                      \"rstatus\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the status code matches.\n                      this is mostly used to check for multiple codes.\n\n    string <string> : test the exact string match in the http response body.\n                      a health check response will be considered valid if the\n                      response's body contains this exact string. if the\n                      \"string\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body contains this\n                      string. this can be used to look for a mandatory word at\n                      the end of a dynamic page, or to detect a failure when a\n                      specific error appears on the check page (eg: a stack\n                      trace).\n\n    rstring <regex> : test a regular expression on the http response body.\n                      a health check response will be considered valid if the\n                      response's body matches this expression. if the \"rstring\"\n                      keyword is prefixed with \"!\", then the response will be\n                      considered invalid if the body matches the expression.\n                      this can be used to look for a mandatory word at the end\n                      of a dynamic page, or to detect a failure when a specific\n                      error appears on the check page (eg: a stack trace).\n\n  it is important to note that the responses will be limited to a certain size\n  defined by the global \"tune.chksize\" option, which defaults to 16384 bytes.\n  thus, too large responses may not contain the mandatory pattern when using\n  \"string\" or \"rstring\". if a large response is absolutely required, it is\n  possible to change the default max size by setting the global variable.\n  however, it is worth keeping in mind that parsing very large responses can\n  waste some cpu cycles, especially when regular expressions are used, and that\n  it is always better to focus the checks on smaller resources.\n\n  also \"http-check expect\" doesn't support http keep-alive. keep in mind that it\n  will automatically append a \"connection: close\" header, meaning that this\n  header should not be present in the request provided by \"option httpchk\".\n\n  last, if \"http-check expect\" is combined with \"http-check disable-on-404\",\n  then this last one has precedence when the server responds with 404.\n\n  examples :\n         # only accept status 200 as valid\n         http-check expect status 200\n\n         # consider sql errors as errors\n         http-check expect ! string sql\\ error\n\n         # consider status 5xx only as errors\n         http-check expect ! rstatus ^5\n\n         # check that we have a correct hexadecimal tag before /html\n         http-check expect rstring <!--tag:[0-9a-f]*</html>\n\n  see also : \"option httpchk\", \"http-check disable-on-404\"\n\nhttp-check send-state\n  enable emission of a state header with http health checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when this option is set, haproxy will systematically send a special header\n  \"x-haproxy-server-state\" with a list of parameters indicating to each server\n  how they are seen by haproxy. this can be used for instance when a server is\n  manipulated without access to haproxy and the operator needs to know whether\n  haproxy still sees it up or not, or if the server is the last one in a farm.\n\n  the header is composed of fields delimited by semi-colons, the first of which\n  is a word (\"up\", \"down\", \"nolb\"), possibly followed by a number of valid\n  checks on the total number before transition, just as appears in the stats\n  interface. next headers are in the form \"<variable>=<value>\", indicating in\n  no specific order some values available in the stats interface :\n    - a variable \"address\", containing the address of the backend server.\n      this corresponds to the <address> field in the server declaration. for\n      unix domain sockets, it will read \"unix\".\n\n    - a variable \"port\", containing the port of the backend server. this\n      corresponds to the <port> field in the server declaration. for unix\n      domain sockets, it will read \"unix\".\n\n    - a variable \"name\", containing the name of the backend followed by a slash\n      (\"/\") then the name of the server. this can be used when a server is\n      checked in multiple backends.\n\n    - a variable \"node\" containing the name of the haproxy node, as set in the\n      global \"node\" variable, otherwise the system's hostname if unspecified.\n\n    - a variable \"weight\" indicating the weight of the server, a slash (\"/\")\n      and the total weight of the farm (just counting usable servers). this\n      helps to know if other servers are available to handle the load when this\n      one fails.\n\n    - a variable \"scur\" indicating the current number of concurrent connections\n      on the server, followed by a slash (\"/\") then the total number of\n      connections on all servers of the same backend.\n\n    - a variable \"qcur\" indicating the current number of requests in the\n      server's queue.\n\n  example of a header received by the application server :\n    >>>  x-haproxy-server-state: up 2/3; name=bck/srv2; node=lb1; weight=1/2; \\\n           scur=13/22; qcur=0\n\n  see also : \"option httpchk\", \"http-check disable-on-404\"\n\nhttp-request { allow | deny | tarpit | auth [realm <realm>] | redirect <rule> |\n              add-header <name> <fmt> | set-header <name> <fmt> |\n              capture <sample> [ len <length> | id <id> ] |\n              del-header <name> | set-nice <nice> | set-log-level <level> |\n              replace-header <name> <match-regex> <replace-fmt> |\n              replace-value <name> <match-regex> <replace-fmt> |\n              set-method <fmt> | set-path <fmt> | set-query <fmt> |\n              set-uri <fmt> | set-tos <tos> | set-mark <mark> |\n              add-acl(<file name>) <key fmt> |\n              del-acl(<file name>) <key fmt> |\n              del-map(<file name>) <key fmt> |\n              set-map(<file name>) <key fmt> <value fmt> |\n              set-var(<var name>) <expr> |\n              { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] |\n              lua <function name>\n             }\n             [ { if | unless } <condition> ]\n  access control for layer 7 requests\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    yes   |   yes  |   yes\n\n  the http-request statement defines a set of rules which apply to layer 7\n  processing. the rules are evaluated in their declaration order when they are\n  met in a frontend, listen or backend section. any rule may optionally be\n  followed by an acl-based condition, in which case it will only be evaluated\n  if the condition is true.\n\n  the first keyword is the rule's action. currently supported actions include :\n    - \"allow\" : this stops the evaluation of the rules and lets the request\n      pass the check. no further \"http-request\" rules are evaluated.\n\n    - \"deny\" : this stops the evaluation of the rules and immediately rejects\n      the request and emits an http 403 error. no further \"http-request\" rules\n      are evaluated.\n\n    - \"tarpit\" : this stops the evaluation of the rules and immediately blocks\n      the request without responding for a delay specified by \"timeout tarpit\"\n      or \"timeout connect\" if the former is not set. after that delay, if the\n      client is still connected, an http error 500 is returned so that the\n      client does not suspect it has been tarpitted. logs will report the flags\n      \"pt\". the goal of the tarpit rule is to slow down robots during an attack\n      when they're limited on the number of concurrent requests. it can be very\n      efficient against very dumb robots, and will significantly reduce the\n      load on firewalls compared to a \"deny\" rule. but when facing \"correctly\"\n      developed robots, it can make things worse by forcing haproxy and the\n      front firewall to support insane number of concurrent connections.\n\n    - \"auth\" : this stops the evaluation of the rules and immediately responds\n      with an http 401 or 407 error code to invite the user to present a valid\n      user name and password. no further \"http-request\" rules are evaluated. an\n      optional \"realm\" parameter is supported, it sets the authentication realm\n      that is returned with the response (typically the application's name).\n\n    - \"redirect\" : this performs an http redirection based on a redirect rule.\n      this is exactly the same as the \"redirect\" statement except that it\n      inserts a redirect rule which can be processed in the middle of other\n      \"http-request\" rules and that these rules use the \"log-format\" strings.\n      see the \"redirect\" keyword for the rule's syntax.\n\n    - \"add-header\" appends an http header field whose name is specified in\n      <name> and whose value is defined by <fmt> which follows the log-format\n      rules (see custom log format in section 8.2.4). this is particularly\n      useful to pass connection-specific information to the server (eg: the\n      client's ssl certificate), or to combine several headers into one. this\n      rule is not final, so it is possible to add other similar rules. note\n      that header addition is performed immediately, so one rule might reuse\n      the resulting header from a previous rule.\n\n    - \"set-header\" does the same as \"add-header\" except that the header name\n      is first removed if it existed. this is useful when passing security\n      information to the server, where the header must not be manipulated by\n      external users. note that the new value is computed before the removal so\n      it is possible to concatenate a value to an existing header.\n\n    - \"del-header\" removes all http header fields whose name is specified in\n      <name>.\n\n    - \"replace-header\" matches the regular expression in all occurrences of\n      header field <name> according to <match-regex>, and replaces them with\n      the <replace-fmt> argument. format characters are allowed in replace-fmt\n      and work like in <fmt> arguments in \"add-header\". the match is only\n      case-sensitive. it is important to understand that this action only\n      considers whole header lines, regardless of the number of values they\n      may contain. this usage is suited to headers naturally containing commas\n      in their value, such as if-modified-since and so on.\n\n      example:\n\n        http-request replace-header cookie foo=([^;]*);(.*) foo=\\1;ip=%bi;\\2\n\n      applied to:\n\n        cookie: foo=foobar; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n      outputs:\n\n        cookie: foo=foobar;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n      assuming the backend ip is 192.168.1.20\n\n    - \"replace-value\" works like \"replace-header\" except that it matches the\n      regex against every comma-delimited value of the header field <name>\n      instead of the entire header. this is suited for all headers which are\n      allowed to carry more than one value. an example could be the accept\n      header.\n\n      example:\n\n        http-request replace-value x-forwarded-for ^192\\.168\\.(.*)$ 172.16.\\1\n\n      applied to:\n\n        x-forwarded-for: 192.168.10.1, 192.168.13.24, 10.0.0.37\n\n      outputs:\n\n        x-forwarded-for: 172.16.10.1, 172.16.13.24, 10.0.0.37\n\n    - \"set-method\" rewrites the request method with the result of the\n      evaluation of format string <fmt>. there should be very few valid reasons\n      for having to do so as this is more likely to break something than to fix\n      it.\n\n    - \"set-path\" rewrites the request path with the result of the evaluation of\n      format string <fmt>. the query string, if any, is left intact. if a\n      scheme and authority is found before the path, they are left intact as\n      well. if the request doesn't have a path (\"*\"), this one is replaced with\n      the format. this can be used to prepend a directory component in front of\n      a path for example. see also \"set-query\" and \"set-uri\".\n\n      example :\n          # prepend the host name before the path\n          http-request set-path /%[hdr(host)]%[path]\n\n    - \"set-query\" rewrites the request's query string which appears after the\n      first question mark (\"?\") with the result of the evaluation of format\n      string <fmt>. the part prior to the question mark is left intact. if the\n      request doesn't contain a question mark and the new value is not empty,\n      then one is added at the end of the uri, followed by the new value. if\n      a question mark was present, it will never be removed even if the value\n      is empty. this can be used to add or remove parameters from the query\n      string. see also \"set-query\" and \"set-uri\".\n\n      example :\n          # replace \"%3d\" with \"=\" in the query string\n          http-request set-query %[query,regsub(%3d,=,g)]\n\n    - \"set-uri\" rewrites the request uri with the result of the evaluation of\n      format string <fmt>. the scheme, authority, path and query string are all\n      replaced at once. this can be used to rewrite hosts in front of proxies,\n      or to perform complex modifications to the uri such as moving parts\n      between the path and the query string. see also \"set-path\" and\n      \"set-query\".\n\n    - \"set-nice\" sets the \"nice\" factor of the current request being processed.\n      it only has effect against the other requests being processed at the same\n      time. the default value is 0, unless altered by the \"nice\" setting on the\n      \"bind\" line. the accepted range is -1024..1024\\. the higher the value, the\n      nicest the request will be. lower values will make the request more\n      important than other ones. this can be useful to improve the speed of\n      some requests, or lower the priority of non-important requests. using\n      this setting without prior experimentation can cause some major slowdown.\n\n    - \"set-log-level\" is used to change the log level of the current request\n      when a certain condition is met. valid levels are the 8 syslog levels\n      (see the \"log\" keyword) plus the special level \"silent\" which disables\n      logging for this request. this rule is not final so the last matching\n      rule wins. this rule can be useful to disable health checks coming from\n      another equipment.\n\n    - \"set-tos\" is used to set the tos or dscp field value of packets sent to\n      the client to the value passed in <tos> on platforms which support this.\n      this value represents the whole 8 bits of the ip tos field, and can be\n      expressed both in decimal or hexadecimal format (prefixed by \"0x\"). note\n      that only the 6 higher bits are used in dscp or tos, and the two lower\n      bits are always 0\\. this can be used to adjust some routing behaviour on\n      border routers based on some information from the request. see rfc 2474,\n      2597, 3260 and 4594 for more information.\n\n    - \"set-mark\" is used to set the netfilter mark on all packets sent to the\n      client to the value passed in <mark> on platforms which support it. this\n      value is an unsigned 32 bit value which can be matched by netfilter and\n      by the routing table. it can be expressed both in decimal or hexadecimal\n      format (prefixed by \"0x\"). this can be useful to force certain packets to\n      take a different route (for example a cheaper network path for bulk\n      downloads). this works on linux kernels 2.6.32 and above and requires\n      admin privileges.\n\n    - \"add-acl\" is used to add a new entry into an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the new entry. it\n      performs a lookup in the acl before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"add acl\" command from the\n      stats socket, but can be triggered by an http request.\n\n    - \"del-acl\" is used to delete an entry from an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it is the equivalent of the \"del acl\" command from the stats socket, but\n      can be triggered by an http request.\n\n    - \"del-map\" is used to delete an entry from a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it takes one argument: \"file name\" it is the equivalent of the \"del map\"\n      command from the stats socket, but can be triggered by an http request.\n\n    - \"set-map\" is used to add a new entry into a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes 2 arguments: <key fmt>,\n      which follows log-format rules, used to collect map key, and <value fmt>,\n      which follows log-format rules, used to collect content for the new entry.\n      it performs a lookup in the map before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"set map\" command from the\n      stats socket, but can be triggered by an http request.\n\n    - capture <sample> [ len <length> | id <id> ] :\n      captures sample expression <sample> from the request buffer, and converts\n      it to a string of at most <len> characters. the resulting string is\n      stored into the next request \"capture\" slot, so it will possibly appear\n      next to some captured http headers. it will then automatically appear in\n      the logs, and it will be possible to extract it using sample fetch rules\n      to feed it into headers or anything. the length should be limited given\n      that this size will be allocated for each capture during the whole\n      session life. please check section 7.3 (fetching samples) and \"capture\n      request header\" for more information.\n\n      if the keyword \"id\" is used instead of \"len\", the action tries to store\n      the captured string in a previously declared capture slot. this is useful\n      to run captures in backends. the slot id can be declared by a previous\n      directive \"http-request capture\" or with the \"declare capture\" keyword.\n\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] :\n      enables tracking of sticky counters from current request. these rules\n      do not stop evaluation and do not change default action. three sets of\n      counters may be simultaneously tracked by the same connection. the first\n      \"track-sc0\" rule executed enables tracking of the counters of the\n      specified table as the first set. the first \"track-sc1\" rule executed\n      enables tracking of the counters of the specified table as the second\n      set. the first \"track-sc2\" rule executed enables tracking of the\n      counters of the specified table as the third set. it is a recommended\n      practice to use the first set of counters for the per-frontend counters\n      and the second set for the per-backend ones. but this is just a\n      guideline, all may be used everywhere.\n\n      these actions take one or two arguments :\n        <key>   is mandatory, and is a sample expression rule as described\n                in section 7.3\\. it describes what elements of the incoming\n                request or connection will be analysed, extracted, combined,\n                and used to select which table entry to update the counters.\n\n        <table> is an optional table to be used instead of the default one,\n                which is the stick-table declared in the current proxy. all\n                the counters for the matches and updates for the key will\n                then be performed in that table until the session ends.\n\n      once a \"track-sc*\" rule is executed, the key is looked up in the table\n      and if it is not found, an entry is allocated for it. then a pointer to\n      that entry is kept during all the session's life, and this entry's\n      counters are updated as often as possible, every time the session's\n      counters are updated, and also systematically when the session ends.\n      counters are only updated for events that happen after the tracking has\n      been started. as an exception, connection counters and request counters\n      are systematically updated so that they reflect useful information.\n\n      if the entry tracks concurrent connection counters, one connection is\n      counted for as long as the entry is tracked, and the entry will not\n      expire during that time. tracking counters also provides a performance\n      advantage over just checking the keys, because only one table lookup is\n      performed for all acl checks that make use of it.\n\n    - \"lua\" is used to run a lua function if the action is executed. the single\n      parameter is the name of the function to run. the prototype of the\n      function is documented in the api documentation.\n\n    - set-var(<var-name>) <expr> :\n      is used to set the contents of a variable. the variable is declared\n      inline.\n\n        <var-name> the name of the variable starts by an indication about its\n                   scope. the allowed scopes are:\n                     \"sess\" : the variable is shared with all the session,\n                     \"txn\"  : the variable is shared with all the transaction\n                              (request and response)\n                     \"req\"  : the variable is shared only during the request\n                              processing\n                     \"res\"  : the variable is shared only during the response\n                              processing.\n                   this prefix is followed by a name. the separator is a '.'.\n                   the name may only contain characters 'a-z', 'a-z', '0-9',\n                   and '_'.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-request set-var(req.my_var) req.fhdr(user-agent),lower\n\n    - set-src <expr> :\n      is used to set the source ip address to the value of specified\n      expression. useful when a proxy in front of haproxy rewrites source ip,\n      but provides the correct ip in a http header; or you want to mask\n      source ip for privacy.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-request set-src hdr(x-forwarded-for)\n         http-request set-src src,ipmask(24)\n\n      when set-src is successful, the source port is set to 0.\n\n  there is no limit to the number of http-request statements per instance.\n\n  it is important to know that http-request rules are processed very early in\n  the http processing, just after \"block\" rules and before \"reqdel\" or \"reqrep\"\n  rules. that way, headers added by \"add-header\"/\"set-header\" are visible by\n  almost all further acl rules.\n\n  example:\n        acl nagios src 192.168.129.3\n        acl local_net src 192.168.0.0/16\n        acl auth_ok http_auth(l1)\n\n        http-request allow if nagios\n        http-request allow if local_net auth_ok\n        http-request auth realm gimme if local_net auth_ok\n        http-request deny\n\n  example:\n        acl auth_ok http_auth_group(l1) g1\n        http-request auth unless auth_ok\n\n  example:\n        http-request set-header x-haproxy-current-date %t\n        http-request set-header x-ssl                  %[ssl_fc]\n        http-request set-header x-ssl-session_id       %[ssl_fc_session_id]\n        http-request set-header x-ssl-client-verify    %[ssl_c_verify]\n        http-request set-header x-ssl-client-dn        %{+q}[ssl_c_s_dn]\n        http-request set-header x-ssl-client-cn        %{+q}[ssl_c_s_dn(cn)]\n        http-request set-header x-ssl-issuer           %{+q}[ssl_c_i_dn]\n        http-request set-header x-ssl-client-notbefore %{+q}[ssl_c_notbefore]\n        http-request set-header x-ssl-client-notafter  %{+q}[ssl_c_notafter]\n\n  example:\n        acl key req.hdr(x-add-acl-key) -m found\n        acl add path /addacl\n        acl del path /delacl\n\n        acl myhost hdr(host) -f myhost.lst\n\n        http-request add-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key add\n        http-request del-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key del\n\n  example:\n        acl value  req.hdr(x-value) -m found\n        acl setmap path /setmap\n        acl delmap path /delmap\n\n        use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\n        http-request set-map(map.lst) %[src] %[req.hdr(x-value)] if setmap value\n        http-request del-map(map.lst) %[src]                     if delmap\n\n  see also : \"stats http-request\", section 3.4 about userlists and section 7\n             about acl usage.\n\nhttp-response { allow | deny | add-header <name> <fmt> | set-nice <nice> |\n                capture <sample> id <id> | redirect <rule> |\n                set-header <name> <fmt> | del-header <name> |\n                replace-header <name> <regex-match> <replace-fmt> |\n                replace-value <name> <regex-match> <replace-fmt> |\n                set-log-level <level> | set-mark <mark> | set-tos <tos> |\n                add-acl(<file name>) <key fmt> |\n                del-acl(<file name>) <key fmt> |\n                del-map(<file name>) <key fmt> |\n                set-map(<file name>) <key fmt> <value fmt> |\n                set-var(<var-name>) <expr> |\n                lua <function name>\n              }\n              [ { if | unless } <condition> ]\n  access control for layer 7 responses\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    yes   |   yes  |   yes\n\n  the http-response statement defines a set of rules which apply to layer 7\n  processing. the rules are evaluated in their declaration order when they are\n  met in a frontend, listen or backend section. any rule may optionally be\n  followed by an acl-based condition, in which case it will only be evaluated\n  if the condition is true. since these rules apply on responses, the backend\n  rules are applied first, followed by the frontend's rules.\n\n  the first keyword is the rule's action. currently supported actions include :\n    - \"allow\" : this stops the evaluation of the rules and lets the response\n      pass the check. no further \"http-response\" rules are evaluated for the\n      current section.\n\n    - \"deny\" : this stops the evaluation of the rules and immediately rejects\n      the response and emits an http 502 error. no further \"http-response\"\n      rules are evaluated.\n\n    - \"add-header\" appends an http header field whose name is specified in\n      <name> and whose value is defined by <fmt> which follows the log-format\n      rules (see custom log format in section 8.2.4). this may be used to send\n      a cookie to a client for example, or to pass some internal information.\n      this rule is not final, so it is possible to add other similar rules.\n      note that header addition is performed immediately, so one rule might\n      reuse the resulting header from a previous rule.\n\n    - \"set-header\" does the same as \"add-header\" except that the header name\n      is first removed if it existed. this is useful when passing security\n      information to the server, where the header must not be manipulated by\n      external users.\n\n    - \"del-header\" removes all http header fields whose name is specified in\n      <name>.\n\n    - \"replace-header\" matches the regular expression in all occurrences of\n      header field <name> according to <match-regex>, and replaces them with\n      the <replace-fmt> argument. format characters are allowed in replace-fmt\n      and work like in <fmt> arguments in \"add-header\". the match is only\n      case-sensitive. it is important to understand that this action only\n      considers whole header lines, regardless of the number of values they\n      may contain. this usage is suited to headers naturally containing commas\n      in their value, such as set-cookie, expires and so on.\n\n      example:\n\n        http-response replace-header set-cookie (c=[^;]*);(.*) \\1;ip=%bi;\\2\n\n      applied to:\n\n        set-cookie: c=1; expires=tue, 14-jun-2016 01:40:45 gmt\n\n      outputs:\n\n        set-cookie: c=1;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt\n\n      assuming the backend ip is 192.168.1.20.\n\n    - \"replace-value\" works like \"replace-header\" except that it matches the\n      regex against every comma-delimited value of the header field <name>\n      instead of the entire header. this is suited for all headers which are\n      allowed to carry more than one value. an example could be the accept\n      header.\n\n      example:\n\n        http-response replace-value cache-control ^public$ private\n\n      applied to:\n\n        cache-control: max-age=3600, public\n\n      outputs:\n\n        cache-control: max-age=3600, private\n\n    - \"set-nice\" sets the \"nice\" factor of the current request being processed.\n      it only has effect against the other requests being processed at the same\n      time. the default value is 0, unless altered by the \"nice\" setting on the\n      \"bind\" line. the accepted range is -1024..1024\\. the higher the value, the\n      nicest the request will be. lower values will make the request more\n      important than other ones. this can be useful to improve the speed of\n      some requests, or lower the priority of non-important requests. using\n      this setting without prior experimentation can cause some major slowdown.\n\n    - \"set-log-level\" is used to change the log level of the current request\n      when a certain condition is met. valid levels are the 8 syslog levels\n      (see the \"log\" keyword) plus the special level \"silent\" which disables\n      logging for this request. this rule is not final so the last matching\n      rule wins. this rule can be useful to disable health checks coming from\n      another equipment.\n\n    - \"set-tos\" is used to set the tos or dscp field value of packets sent to\n      the client to the value passed in <tos> on platforms which support this.\n      this value represents the whole 8 bits of the ip tos field, and can be\n      expressed both in decimal or hexadecimal format (prefixed by \"0x\"). note\n      that only the 6 higher bits are used in dscp or tos, and the two lower\n      bits are always 0\\. this can be used to adjust some routing behaviour on\n      border routers based on some information from the request. see rfc 2474,\n      2597, 3260 and 4594 for more information.\n\n    - \"set-mark\" is used to set the netfilter mark on all packets sent to the\n      client to the value passed in <mark> on platforms which support it. this\n      value is an unsigned 32 bit value which can be matched by netfilter and\n      by the routing table. it can be expressed both in decimal or hexadecimal\n      format (prefixed by \"0x\"). this can be useful to force certain packets to\n      take a different route (for example a cheaper network path for bulk\n      downloads). this works on linux kernels 2.6.32 and above and requires\n      admin privileges.\n\n    - \"add-acl\" is used to add a new entry into an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the new entry. it\n      performs a lookup in the acl before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"add acl\" command from the\n      stats socket, but can be triggered by an http response.\n\n    - \"del-acl\" is used to delete an entry from an acl. the acl must be loaded\n      from a file (even a dummy empty file). the file name of the acl to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it is the equivalent of the \"del acl\" command from the stats socket, but\n      can be triggered by an http response.\n\n    - \"del-map\" is used to delete an entry from a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes one argument: <key fmt>,\n      which follows log-format rules, to collect content of the entry to delete.\n      it takes one argument: \"file name\" it is the equivalent of the \"del map\"\n      command from the stats socket, but can be triggered by an http response.\n\n    - \"set-map\" is used to add a new entry into a map. the map must be loaded\n      from a file (even a dummy empty file). the file name of the map to be\n      updated is passed between parentheses. it takes 2 arguments: <key fmt>,\n      which follows log-format rules, used to collect map key, and <value fmt>,\n      which follows log-format rules, used to collect content for the new entry.\n      it performs a lookup in the map before insertion, to avoid duplicated (or\n      more) values. this lookup is done by a linear search and can be expensive\n      with large lists! it is the equivalent of the \"set map\" command from the\n      stats socket, but can be triggered by an http response.\n\n    - \"lua\" is used to run a lua function if the action is executed. the single\n      parameter is the name of the function to run. the prototype of the\n      function is documented in the api documentation.\n\n    - capture <sample> id <id> :\n      captures sample expression <sample> from the response buffer, and converts\n      it to a string. the resulting string is stored into the next request\n      \"capture\" slot, so it will possibly appear next to some captured http\n      headers. it will then automatically appear in the logs, and it will be\n      possible to extract it using sample fetch rules to feed it into headers or\n      anything. please check section 7.3 (fetching samples) and \"capture\n      response header\" for more information.\n\n      the keyword \"id\" is the id of the capture slot which is used for storing\n      the string. the capture slot must be defined in an associated frontend.\n      this is useful to run captures in backends. the slot id can be declared by\n      a previous directive \"http-response capture\" or with the \"declare capture\"\n      keyword.\n\n    - \"redirect\" : this performs an http redirection based on a redirect rule.\n      this supports a format string similarly to \"http-request redirect\" rules,\n      with the exception that only the \"location\" type of redirect is possible\n      on the response. see the \"redirect\" keyword for the rule's syntax. when\n      a redirect rule is applied during a response, connections to the server\n      are closed so that no data can be forwarded from the server to the client.\n\n    - set-var(<var-name>) expr:\n      is used to set the contents of a variable. the variable is declared\n      inline.\n\n        <var-name> the name of the variable starts by an indication about its\n                   scope. the allowed scopes are:\n                     \"sess\" : the variable is shared with all the session,\n                     \"txn\"  : the variable is shared with all the transaction\n                              (request and response)\n                     \"req\"  : the variable is shared only during the request\n                              processing\n                     \"res\"  : the variable is shared only during the response\n                              processing.\n                   this prefix is followed by a name. the separator is a '.'.\n                   the name may only contain characters 'a-z', 'a-z', '0-9',\n                   and '_'.\n\n         <expr>    is a standard haproxy expression formed by a sample-fetch\n                   followed by some converters.\n\n      example:\n\n         http-response set-var(sess.last_redir) res.hdr(location)\n\n  there is no limit to the number of http-response statements per instance.\n\n  it is important to know that http-response rules are processed very early in\n  the http processing, before \"reqdel\" or \"reqrep\" rules. that way, headers\n  added by \"add-header\"/\"set-header\" are visible by almost all further acl\n  rules.\n\n  example:\n         acl key_acl res.hdr(x-acl-key) -m found\n\n         acl myhost hdr(host) -f myhost.lst\n\n         http-response add-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n         http-response del-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n\n  example:\n         acl value  res.hdr(x-value) -m found\n\n         use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\n         http-response set-map(map.lst) %[src] %[res.hdr(x-value)] if value\n         http-response del-map(map.lst) %[src]                     if ! value\n\n  see also : \"http-request\", section 3.4 about userlists and section 7 about\n             acl usage.\n\nhttp-send-name-header [<header>]\n  add the server name to a request. use the header string given by <header>\n\n  may be used in sections:   defaults | frontend | listen | backend\n                               yes    |    no    |   yes  |   yes\n\n  arguments :\n\n    <header>  the header string to use to send the server name\n\n  the \"http-send-name-header\" statement causes the name of the target\n  server to be added to the headers of an http request.  the name\n  is added with the header string proved.\n\n  see also : \"server\"\n\nid <value>\n  set a persistent id to a proxy.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n  arguments : none\n\n  set a persistent id for the proxy. this id must be unique and positive.\n  an unused id will automatically be assigned if unset. the first assigned\n  value will be 1\\. this id is currently only returned in statistics.\n\nignore-persist { if | unless } <condition>\n  declare a condition to ignore persistence\n  may be used in sections:    defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   yes\n\n  by default, when cookie persistence is enabled, every requests containing\n  the cookie are unconditionally persistent (assuming the target server is up\n  and running).\n\n  the \"ignore-persist\" statement allows one to declare various acl-based\n  conditions which, when met, will cause a request to ignore persistence.\n  this is sometimes useful to load balance requests for static files, which\n  often don't require persistence. this can also be used to fully disable\n  persistence for a specific user-agent (for example, some web crawler bots).\n\n  combined with \"appsession\", it can also help reduce haproxy memory usage, as\n  the appsession table won't grow if persistence is ignored.\n\n  the persistence is ignored when an \"if\" condition is met, or unless an\n  \"unless\" condition is met.\n\n  see also : \"force-persist\", \"cookie\", and section 7 about acl usage.\n\nlog global\nlog <address> [len <length>] <facility> [<level> [<minlevel>]]\nno log\n  enable per-instance logging of events and traffic.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  prefix :\n    no         should be used when the logger list must be flushed. for example,\n               if you don't want to inherit from the default logger list. this\n               prefix does not allow arguments.\n\n  arguments :\n    global     should be used when the instance's logging parameters are the\n               same as the global ones. this is the most common usage. \"global\"\n               replaces <address>, <facility> and <level> with those of the log\n               entries found in the \"global\" section. only one \"log global\"\n               statement may be used per instance, and this form takes no other\n               parameter.\n\n    <address>  indicates where to send the logs. it takes the same format as\n               for the \"global\" section's logs, and can be one of :\n\n               - an ipv4 address optionally followed by a colon (':') and a udp\n                 port. if no port is specified, 514 is used by default (the\n                 standard syslog port).\n\n               - an ipv6 address followed by a colon (':') and optionally a udp\n                 port. if no port is specified, 514 is used by default (the\n                 standard syslog port).\n\n               - a filesystem path to a unix domain socket, keeping in mind\n                 considerations for chroot (be sure the path is accessible\n                 inside the chroot) and uid/gid (be sure the path is\n                 appropriately writeable).\n\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment variables.\n\n    <length>   is an optional maximum line length. log lines larger than this\n               value will be truncated before being sent. the reason is that\n               syslog servers act differently on log line length. all servers\n               support the default value of 1024, but some servers simply drop\n               larger lines while others do log them. if a server supports long\n               lines, it may make sense to set this value here in order to avoid\n               truncating long lines. similarly, if a server drops long lines,\n               it is preferable to truncate them before sending them. accepted\n               values are 80 to 65535 inclusive. the default value of 1024 is\n               generally fine for all standard usages. some specific cases of\n               long captures or json-formated logs may require larger values.\n\n    <facility> must be one of the 24 standard syslog facilities :\n\n                 kern   user   mail   daemon auth   syslog lpr    news\n                 uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n                 local0 local1 local2 local3 local4 local5 local6 local7\n\n    <level>    is optional and can be specified to filter outgoing messages. by\n               default, all messages are sent. if a level is specified, only\n               messages with a severity at least as important as this level\n               will be sent. an optional minimum level can be specified. if it\n               is set, logs emitted with a more severe level than this one will\n               be capped to this level. this is used to avoid sending \"emerg\"\n               messages on all terminals on some default syslog configurations.\n               eight levels are known :\n\n                 emerg  alert  crit   err    warning notice info  debug\n\n  it is important to keep in mind that it is the frontend which decides what to\n  log from a connection, and that in case of content switching, the log entries\n  from the backend will be ignored. connections are logged at level \"info\".\n\n  however, backend log declaration define how and where servers status changes\n  will be logged. level \"notice\" will be used to indicate a server going up,\n  \"warning\" will be used for termination signals and definitive service\n  termination, and \"alert\" will be used for when a server goes down.\n\n  note : according to rfc3164, messages are truncated to 1024 bytes before\n         being emitted.\n\n  example :\n    log global\n    log 127.0.0.1:514 local0 notice         # only send important events\n    log 127.0.0.1:514 local0 notice notice  # same but limit output level\n    log \"${local_syslog}:514\" local0 notice   # send to local server\n\nlog-format <string>\n  specifies the log format string to use for traffic logs\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |    no\n\n  this directive specifies the log format string that will be used for all logs\n  resulting from traffic passing through the frontend using this line. if the\n  directive is used in a defaults section, all subsequent frontends will use\n  the same log format. please see section 8.2.4 which covers the log format\n  string in depth.\n\nlog-tag <string>\n  specifies the log tag to use for all outgoing logs\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n  sets the tag field in the syslog header to this string. it defaults to the\n  log-tag set in the global section, otherwise the program name as launched\n  from the command line, which usually is \"haproxy\". sometimes it can be useful\n  to differentiate between multiple processes running on the same host, or to\n  differentiate customer instances running in the same process. in the backend,\n  logs about servers up/down will use this tag. as a hint, it can be convenient\n  to set a log-tag related to a hosted customer in a defaults section then put\n  all the frontends and backends for that customer, then start another customer\n  in a new defaults section. see also the global \"log-tag\" directive.\n\nmax-keep-alive-queue <value>\n  set the maximum server queue size for maintaining keep-alive connections\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n\n  http keep-alive tries to reuse the same server connection whenever possible,\n  but sometimes it can be counter-productive, for example if a server has a lot\n  of connections while other ones are idle. this is especially true for static\n  servers.\n\n  the purpose of this setting is to set a threshold on the number of queued\n  connections at which haproxy stops trying to reuse the same server and prefers\n  to find another one. the default value, -1, means there is no limit. a value\n  of zero means that keep-alive requests will never be queued. for very close\n  servers which can be reached with a low latency and which are not sensible to\n  breaking keep-alive, a low value is recommended (eg: local static server can\n  use a value of 10 or less). for remote servers suffering from a high latency,\n  higher values might be needed to cover for the latency and/or the cost of\n  picking a different server.\n\n  note that this has no impact on responses which are maintained to the same\n  server consecutively to a 401 response. they will still go to the same server\n  even if they have to be queued.\n\n  see also : \"option http-server-close\", \"option prefer-last-server\", server\n             \"maxconn\" and cookie persistence.\n\nmaxconn <conns>\n  fix the maximum number of concurrent connections on a frontend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <conns>   is the maximum number of concurrent connections the frontend will\n              accept to serve. excess connections will be queued by the system\n              in the socket's listen queue and will be served once a connection\n              closes.\n\n  if the system supports it, it can be useful on big sites to raise this limit\n  very high so that haproxy manages connection queues, instead of leaving the\n  clients with unanswered connection attempts. this value should not exceed the\n  global maxconn. also, keep in mind that a connection contains two buffers\n  of 8kb each, as well as some other data resulting in about 17 kb of ram being\n  consumed per established connection. that means that a medium system equipped\n  with 1gb of ram can withstand around 40000-50000 concurrent connections if\n  properly tuned.\n\n  also, when <conns> is set to large values, it is possible that the servers\n  are not sized to accept such loads, and for this reason it is generally wise\n  to assign them some reasonable connection limits.\n\n  by default, this value is set to 2000.\n\n  see also : \"server\", global section's \"maxconn\", \"fullconn\"\n\nmode { tcp|http|health }\n  set the running mode or protocol of the instance\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    tcp       the instance will work in pure tcp mode. a full-duplex connection\n              will be established between clients and servers, and no layer 7\n              examination will be performed. this is the default mode. it\n              should be used for ssl, ssh, smtp, ...\n\n    http      the instance will work in http mode. the client request will be\n              analyzed in depth before connecting to any server. any request\n              which is not rfc-compliant will be rejected. layer 7 filtering,\n              processing and switching will be possible. this is the mode which\n              brings haproxy most of its value.\n\n    health    the instance will work in \"health\" mode. it will just reply \"ok\"\n              to incoming connections and close the connection. alternatively,\n              if the \"httpchk\" option is set, \"http/1.0 200 ok\" will be sent\n              instead. nothing will be logged in either case. this mode is used\n              to reply to external components health checks. this mode is\n              deprecated and should not be used anymore as it is possible to do\n              the same and even better by combining tcp or http modes with the\n              \"monitor\" keyword.\n\n  when doing content switching, it is mandatory that the frontend and the\n  backend are in the same mode (generally http), otherwise the configuration\n  will be refused.\n\n  example :\n     defaults http_instances\n         mode http\n\n  see also : \"monitor\", \"monitor-net\"\n\nmonitor fail { if | unless } <condition>\n  add a condition to report a failure to a monitor http request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments :\n    if <cond>     the monitor request will fail if the condition is satisfied,\n                  and will succeed otherwise. the condition should describe a\n                  combined test which must induce a failure if all conditions\n                  are met, for instance a low number of servers both in a\n                  backend and its backup.\n\n    unless <cond> the monitor request will succeed only if the condition is\n                  satisfied, and will fail otherwise. such a condition may be\n                  based on a test on the presence of a minimum number of active\n                  servers in a list of backends.\n\n  this statement adds a condition which can force the response to a monitor\n  request to report a failure. by default, when an external component queries\n  the uri dedicated to monitoring, a 200 response is returned. when one of the\n  conditions above is met, haproxy will return 503 instead of 200\\. this is\n  very useful to report a site failure to an external component which may base\n  routing advertisements between multiple sites on the availability reported by\n  haproxy. in this case, one would rely on an acl involving the \"nbsrv\"\n  criterion. note that \"monitor fail\" only works in http mode. both status\n  messages may be tweaked using \"errorfile\" or \"errorloc\" if needed.\n\n  example:\n     frontend www\n        mode http\n        acl site_dead nbsrv(dynamic) lt 2\n        acl site_dead nbsrv(static)  lt 2\n        monitor-uri   /site_alive\n        monitor fail  if site_dead\n\n  see also : \"monitor-net\", \"monitor-uri\", \"errorfile\", \"errorloc\"\n\nmonitor-net <source>\n  declare a source network which is limited to monitor requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <source>  is the source ipv4 address or network which will only be able to\n              get monitor responses to any request. it can be either an ipv4\n              address, a host name, or an address followed by a slash ('/')\n              followed by a mask.\n\n  in tcp mode, any connection coming from a source matching <source> will cause\n  the connection to be immediately closed without any log. this allows another\n  equipment to probe the port and verify that it is still listening, without\n  forwarding the connection to a remote server.\n\n  in http mode, a connection coming from a source matching <source> will be\n  accepted, the following response will be sent without waiting for a request,\n  then the connection will be closed : \"http/1.0 200 ok\". this is normally\n  enough for any front-end http probe to detect that the service is up and\n  running without forwarding the request to a backend server. note that this\n  response is sent in raw format, without any transformation. this is important\n  as it means that it will not be ssl-encrypted on ssl listeners.\n\n  monitor requests are processed very early, just after tcp-request connection\n  acls which are the only ones able to block them. these connections are short\n  lived and never wait for any data from the client. they cannot be logged, and\n  it is the intended purpose. they are only used to report haproxy's health to\n  an upper component, nothing more. please note that \"monitor fail\" rules do\n  not apply to connections intercepted by \"monitor-net\".\n\n  last, please note that only one \"monitor-net\" statement can be specified in\n  a frontend. if more than one is found, only the last one will be considered.\n\n  example :\n    # addresses .252 and .253 are just probing us.\n    frontend www\n        monitor-net 192.168.0.252/31\n\n  see also : \"monitor fail\", \"monitor-uri\"\n\nmonitor-uri <uri>\n  intercept a uri used by external components' monitor requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <uri>     is the exact uri which we want to intercept to return haproxy's\n              health status instead of forwarding the request.\n\n  when an http request referencing <uri> will be received on a frontend,\n  haproxy will not forward it nor log it, but instead will return either\n  \"http/1.0 200 ok\" or \"http/1.0 503 service unavailable\", depending on failure\n  conditions defined with \"monitor fail\". this is normally enough for any\n  front-end http probe to detect that the service is up and running without\n  forwarding the request to a backend server. note that the http method, the\n  version and all headers are ignored, but the request must at least be valid\n  at the http level. this keyword may only be used with an http-mode frontend.\n\n  monitor requests are processed very early. it is not possible to block nor\n  divert them using acls. they cannot be logged either, and it is the intended\n  purpose. they are only used to report haproxy's health to an upper component,\n  nothing more. however, it is possible to add any number of conditions using\n  \"monitor fail\" and acls so that the result can be adjusted to whatever check\n  can be imagined (most often the number of available servers in a backend).\n\n  example :\n    # use /haproxy_test to report haproxy's status\n    frontend www\n        mode http\n        monitor-uri /haproxy_test\n\n  see also : \"monitor fail\", \"monitor-net\"\n\noption abortonclose\nno option abortonclose\n  enable or disable early dropping of aborted requests pending in queues.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  in presence of very high loads, the servers will take some time to respond.\n  the per-instance connection queue will inflate, and the response time will\n  increase respective to the size of the queue times the average per-session\n  response time. when clients will wait for more than a few seconds, they will\n  often hit the \"stop\" button on their browser, leaving a useless request in\n  the queue, and slowing down other users, and the servers as well, because the\n  request will eventually be served, then aborted at the first error\n  encountered while delivering the response.\n\n  as there is no way to distinguish between a full stop and a simple output\n  close on the client side, http agents should be conservative and consider\n  that the client might only have closed its output channel while waiting for\n  the response. however, this introduces risks of congestion when lots of users\n  do the same, and is completely useless nowadays because probably no client at\n  all will close the session while waiting for the response. some http agents\n  support this behaviour (squid, apache, haproxy), and others do not (tux, most\n  hardware-based load balancers). so the probability for a closed input channel\n  to represent a user hitting the \"stop\" button is close to 100%, and the risk\n  of being the single component to break rare but valid traffic is extremely\n  low, which adds to the temptation to be able to abort a session early while\n  still not served and not pollute the servers.\n\n  in haproxy, the user can choose the desired behaviour using the option\n  \"abortonclose\". by default (without the option) the behaviour is http\n  compliant and aborted requests will be served. but when the option is\n  specified, a session with an incoming channel closed will be aborted while\n  it is still possible, either pending in the queue for a connection slot, or\n  during the connection establishment if the server has not yet acknowledged\n  the connection request. this considerably reduces the queue size and the load\n  on saturated servers when users are tempted to click on stop, which in turn\n  reduces the response time for other users.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"timeout queue\" and server's \"maxconn\" and \"maxqueue\" parameters\n\noption accept-invalid-http-request\nno option accept-invalid-http-request\n  enable or disable relaxing of http request parsing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, haproxy complies with rfc7230 in terms of message parsing. this\n  means that invalid characters in header names are not permitted and cause an\n  error to be returned to the client. this is the desired behaviour as such\n  forbidden characters are essentially used to build attacks exploiting server\n  weaknesses, and bypass security filtering. sometimes, a buggy browser or\n  server will emit invalid header names for whatever reason (configuration,\n  implementation) and the issue will not be immediately fixed. in such a case,\n  it is possible to relax haproxy's header name parser to accept any character\n  even if that does not make sense, by specifying this option. similarly, the\n  list of characters allowed to appear in a uri is well defined by rfc3986, and\n  chars 0-31, 32 (space), 34 ('\"'), 60 ('<'), 62 ('>'), 92 ('\\'), 94 ('^'), 96\n  ('`'), 123 ('{'), 124 ('|'), 125 ('}'), 127 (delete) and anything above are\n  not allowed at all. haproxy always blocks a number of them (0..32, 127). the\n  remaining ones are blocked by default unless this option is enabled. this\n  option also relaxes the test on the http version, it allows http/0.9 requests\n  to pass through (no version specified) and multiple digits for both the major\n  and the minor version.\n\n  this option should never be enabled by default as it hides application bugs\n  and open security breaches. it should only be deployed after a problem has\n  been confirmed.\n\n  when this option is enabled, erroneous header names will still be accepted in\n  requests, but the complete request will be captured in order to permit later\n  analysis using the \"show errors\" request on the unix stats socket. similarly,\n  requests containing invalid chars in the uri part will be logged. doing this\n  also helps confirming that the issue has been solved.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option accept-invalid-http-response\" and \"show errors\" on the\n             stats socket.\n\noption accept-invalid-http-response\nno option accept-invalid-http-response\n  enable or disable relaxing of http response parsing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  by default, haproxy complies with rfc7230 in terms of message parsing. this\n  means that invalid characters in header names are not permitted and cause an\n  error to be returned to the client. this is the desired behaviour as such\n  forbidden characters are essentially used to build attacks exploiting server\n  weaknesses, and bypass security filtering. sometimes, a buggy browser or\n  server will emit invalid header names for whatever reason (configuration,\n  implementation) and the issue will not be immediately fixed. in such a case,\n  it is possible to relax haproxy's header name parser to accept any character\n  even if that does not make sense, by specifying this option. this option also\n  relaxes the test on the http version format, it allows multiple digits for\n  both the major and the minor version.\n\n  this option should never be enabled by default as it hides application bugs\n  and open security breaches. it should only be deployed after a problem has\n  been confirmed.\n\n  when this option is enabled, erroneous header names will still be accepted in\n  responses, but the complete response will be captured in order to permit\n  later analysis using the \"show errors\" request on the unix stats socket.\n  doing this also helps confirming that the issue has been solved.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option accept-invalid-http-request\" and \"show errors\" on the\n             stats socket.\n\noption allbackups\nno option allbackups\n  use either all backup servers at a time or only the first one\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  by default, the first operational backup server gets all traffic when normal\n  servers are all down. sometimes, it may be preferred to use multiple backups\n  at once, because one will not be enough. when \"option allbackups\" is enabled,\n  the load balancing will be performed among all backup servers when all normal\n  ones are unavailable. the same load balancing algorithm will be used and the\n  servers' weights will be respected. thus, there will not be any priority\n  order between the backup servers anymore.\n\n  this option is mostly used with static server farms dedicated to return a\n  \"sorry\" page when an application is completely offline.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption checkcache\nno option checkcache\n  analyze all server responses and block responses with cacheable cookies\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |     no   |   yes  |   yes\n  arguments : none\n\n  some high-level frameworks set application cookies everywhere and do not\n  always let enough control to the developer to manage how the responses should\n  be cached. when a session cookie is returned on a cacheable object, there is a\n  high risk of session crossing or stealing between users traversing the same\n  caches. in some situations, it is better to block the response than to let\n  some sensitive session information go in the wild.\n\n  the option \"checkcache\" enables deep inspection of all server responses for\n  strict compliance with http specification in terms of cacheability. it\n  carefully checks \"cache-control\", \"pragma\" and \"set-cookie\" headers in server\n  response to check if there's a risk of caching a cookie on a client-side\n  proxy. when this option is enabled, the only responses which can be delivered\n  to the client are :\n    - all those without \"set-cookie\" header ;\n    - all those with a return code other than 200, 203, 206, 300, 301, 410,\n      provided that the server has not set a \"cache-control: public\" header ;\n    - all those that come from a post request, provided that the server has not\n      set a 'cache-control: public' header ;\n    - those with a 'pragma: no-cache' header\n    - those with a 'cache-control: private' header\n    - those with a 'cache-control: no-store' header\n    - those with a 'cache-control: max-age=0' header\n    - those with a 'cache-control: s-maxage=0' header\n    - those with a 'cache-control: no-cache' header\n    - those with a 'cache-control: no-cache=\"set-cookie\"' header\n    - those with a 'cache-control: no-cache=\"set-cookie,' header\n      (allowing other fields after set-cookie)\n\n  if a response doesn't respect these requirements, then it will be blocked\n  just as if it was from an \"rspdeny\" filter, with an \"http 502 bad gateway\".\n  the session state shows \"ph--\" meaning that the proxy blocked the response\n  during headers processing. additionally, an alert will be sent in the logs so\n  that admins are informed that there's something to be fixed.\n\n  due to the high impact on the application, the application should be tested\n  in depth with the option enabled before going to production. it is also a\n  good practice to always activate it during tests, even if it is not used in\n  production, as it will report potentially dangerous application behaviours.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption clitcpka\nno option clitcpka\n  enable or disable the sending of tcp keepalive packets on the client side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"clitcpka\" enables the emission of tcp keep-alive probes on the\n  client side of a connection, which should help when session expirations are\n  noticed between haproxy and a client.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option srvtcpka\", \"option tcpka\"\n\noption contstats\n  enable continuous traffic statistics updates\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, counters used for statistics calculation are incremented\n  only when a session finishes. it works quite well when serving small\n  objects, but with big ones (for example large images or archives) or\n  with a/v streaming, a graph generated from haproxy counters looks like\n  a hedgehog. with this option enabled counters get incremented continuously,\n  during a whole session. recounting touches a hotpath directly so\n  it is not enabled by default, as it has small performance impact (~0.5%).\n\noption dontlog-normal\nno option dontlog-normal\n  enable or disable logging of normal, successful connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  there are large sites dealing with several thousand connections per second\n  and for which logging is a major pain. some of them are even forced to turn\n  logs off and cannot debug production issues. setting this option ensures that\n  normal connections, those which experience no error, no timeout, no retry nor\n  redispatch, will not be logged. this leaves disk space for anomalies. in http\n  mode, the response status code is checked and return codes 5xx will still be\n  logged.\n\n  it is strongly discouraged to use this option as most of the time, the key to\n  complex issues is in the normal logs which will not be logged here. if you\n  need to separate logs, see the \"log-separate-errors\" option instead.\n\n  see also : \"log\", \"dontlognull\", \"log-separate-errors\" and section 8 about\n             logging.\n\noption dontlognull\nno option dontlognull\n  enable or disable logging of null connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  in certain environments, there are components which will regularly connect to\n  various systems to ensure that they are still alive. it can be the case from\n  another load balancer as well as from monitoring systems. by default, even a\n  simple port probe or scan will produce a log. if those connections pollute\n  the logs too much, it is possible to enable option \"dontlognull\" to indicate\n  that a connection on which no data has been transferred will not be logged,\n  which typically corresponds to those probes. note that errors will still be\n  returned to the client and accounted for in the stats. if this is not what is\n  desired, option http-ignore-probes can be used instead.\n\n  it is generally recommended not to use this option in uncontrolled\n  environments (eg: internet), otherwise scans and other malicious activities\n  would not be logged.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"log\", \"http-ignore-probes\", \"monitor-net\", \"monitor-uri\", and\n             section 8 about logging.\n\noption forceclose\nno option forceclose\n  enable or disable active connection closing after response is transferred.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  some http servers do not necessarily close the connections when they receive\n  the \"connection: close\" set by \"option httpclose\", and if the client does not\n  close either, then the connection remains open till the timeout expires. this\n  causes high number of simultaneous connections on the servers and shows high\n  global session times in the logs.\n\n  when this happens, it is possible to use \"option forceclose\". it will\n  actively close the outgoing server channel as soon as the server has finished\n  to respond and release some resources earlier than with \"option httpclose\".\n\n  this option may also be combined with \"option http-pretend-keepalive\", which\n  will disable sending of the \"connection: close\" header, but will still cause\n  the connection to be closed once the whole response is received.\n\n  this option disables and replaces any previous \"option httpclose\", \"option\n  http-server-close\", \"option http-keep-alive\", or \"option http-tunnel\".\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option httpclose\" and \"option http-pretend-keepalive\"\n\noption forwardfor [ except <network> ] [ header <name> ] [ if-none ]\n  enable insertion of the x-forwarded-for header to requests sent to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <network> is an optional argument used to disable this option for sources\n              matching <network>\n    <name>    an optional argument to specify a different \"x-forwarded-for\"\n              header name.\n\n  since haproxy works in reverse-proxy mode, the servers see its ip address as\n  their client address. this is sometimes annoying when the client's ip address\n  is expected in server logs. to solve this problem, the well-known http header\n  \"x-forwarded-for\" may be added by haproxy to all requests sent to the server.\n  this header contains a value representing the client's ip address. since this\n  header is always appended at the end of the existing header list, the server\n  must be configured to always use the last occurrence of this header only. see\n  the server's manual to find how to enable use of this standard header. note\n  that only the last occurrence of the header must be used, since it is really\n  possible that the client has already brought one.\n\n  the keyword \"header\" may be used to supply a different header name to replace\n  the default \"x-forwarded-for\". this can be useful where you might already\n  have a \"x-forwarded-for\" header from a different application (eg: stunnel),\n  and you need preserve it. also if your backend server doesn't use the\n  \"x-forwarded-for\" header and requires different one (eg: zeus web servers\n  require \"x-cluster-client-ip\").\n\n  sometimes, a same haproxy instance may be shared between a direct client\n  access and a reverse-proxy access (for instance when an ssl reverse-proxy is\n  used to decrypt https traffic). it is possible to disable the addition of the\n  header for a known source address or network by adding the \"except\" keyword\n  followed by the network address. in this case, any source ip matching the\n  network will not cause an addition of this header. most common uses are with\n  private networks or 127.0.0.1.\n\n  alternatively, the keyword \"if-none\" states that the header will only be\n  added if it is not present. this should only be used in perfectly trusted\n  environment, as this might cause a security issue if headers reaching haproxy\n  are under the control of the end-user.\n\n  this option may be specified either in the frontend or in the backend. if at\n  least one of them uses it, the header will be added. note that the backend's\n  setting of the header subargument takes precedence over the frontend's if\n  both are defined. in the case of the \"if-none\" argument, if at least one of\n  the frontend or the backend does not specify it, it wants the addition to be\n  mandatory, so it wins.\n\n  examples :\n    # public http address also used by stunnel on the same machine\n    frontend www\n        mode http\n        option forwardfor except 127.0.0.1  # stunnel already adds the header\n\n    # those servers want the ip address in x-client\n    backend www\n        mode http\n        option forwardfor header x-client\n\n  see also : \"option httpclose\", \"option http-server-close\",\n             \"option forceclose\", \"option http-keep-alive\"\n\noption http-buffer-request\nno option http-buffer-request\n  enable or disable waiting for whole http request body before proceeding\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  it is sometimes desirable to wait for the body of an http request before\n  taking a decision. this is what is being done by \"balance url_param\" for\n  example. the first use case is to buffer requests from slow clients before\n  connecting to the server. another use case consists in taking the routing\n  decision based on the request body's contents. this option placed in a\n  frontend or backend forces the http processing to wait until either the whole\n  body is received, or the request buffer is full, or the first chunk is\n  complete in case of chunked encoding. it can have undesired side effects with\n  some applications abusing http by expecting unbufferred transmissions between\n  the frontend and the backend, so this should definitely not be used by\n  default.\n\n  see also : \"option http-no-delay\"\n\noption http-ignore-probes\nno option http-ignore-probes\n  enable or disable logging of null connections and request timeouts\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  recently some browsers started to implement a \"pre-connect\" feature\n  consisting in speculatively connecting to some recently visited web sites\n  just in case the user would like to visit them. this results in many\n  connections being established to web sites, which end up in 408 request\n  timeout if the timeout strikes first, or 400 bad request when the browser\n  decides to close them first. these ones pollute the log and feed the error\n  counters. there was already \"option dontlognull\" but it's insufficient in\n  this case. instead, this option does the following things :\n     - prevent any 400/408 message from being sent to the client if nothing\n       was received over a connection before it was closed ;\n     - prevent any log from being emitted in this situation ;\n     - prevent any error counter from being incremented\n\n  that way the empty connection is silently ignored. note that it is better\n  not to use this unless it is clear that it is needed, because it will hide\n  real problems. the most common reason for not receiving a request and seeing\n  a 408 is due to an mtu inconsistency between the client and an intermediary\n  element such as a vpn, which blocks too large packets. these issues are\n  generally seen with post requests as well as get with large cookies. the logs\n  are often the only way to detect them.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"log\", \"dontlognull\", \"errorfile\", and section 8 about logging.\n\noption http-keep-alive\nno option http-keep-alive\n  enable or disable http keep-alive from client to server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and the\n  start of a new request. this mode may be changed by several options such as\n  \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\". this option allows to set back the keep-alive mode,\n  which can be useful when another mode was used in a defaults section.\n\n  setting \"option http-keep-alive\" enables http keep-alive mode on the client-\n  and server- sides. this provides the lowest latency on the client side (slow\n  network) and the fastest session reuse on the server side at the expense\n  of maintaining idle connections to the servers. in general, it is possible\n  with this option to achieve approximately twice the request rate that the\n  \"http-server-close\" option achieves on small objects. there are mainly two\n  situations where this option may be useful :\n\n    - when the server is non-http compliant and authenticates the connection\n      instead of requests (eg: ntlm authentication)\n\n    - when the cost of establishing the connection to the server is significant\n      compared to the cost of retrieving the associated object from the server.\n\n  this last case can happen when the server is a fast static server of cache.\n  in this case, the server will need to be properly tuned to support high enough\n  connection counts because connections will last until the client sends another\n  request.\n\n  if the client request has to go to another backend or another server due to\n  content switching or the load balancing algorithm, the idle connection will\n  immediately be closed and a new one re-opened. option \"prefer-last-server\" is\n  available to try optimize server selection so that if the server currently\n  attached to an idle connection is usable, it will be used.\n\n  in general it is preferred to use \"option http-server-close\" with application\n  servers, and some static servers might benefit from \"option http-keep-alive\".\n\n  at the moment, logs will not indicate whether requests came from the same\n  session or not. the accept date reported in the logs corresponds to the end\n  of the previous request, and the request time corresponds to the time spent\n  waiting for a new request. the keep-alive request time is still bound to the\n  timeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\n  not set.\n\n  this option disables and replaces any previous \"option httpclose\", \"option\n  http-server-close\", \"option forceclose\" or \"option http-tunnel\". when backend\n  and frontend options differ, all of these 4 options have precedence over\n  \"option http-keep-alive\".\n\n  see also : \"option forceclose\", \"option http-server-close\",\n             \"option prefer-last-server\", \"option http-pretend-keepalive\",\n             \"option httpclose\", and \"1.1\\. the http transaction model\".\n\noption http-no-delay\nno option http-no-delay\n  instruct the system to favor low interactive delays over performance in http\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  in http, each payload is unidirectional and has no notion of interactivity.\n  any agent is expected to queue data somewhat for a reasonably low delay.\n  there are some very rare server-to-server applications that abuse the http\n  protocol and expect the payload phase to be highly interactive, with many\n  interleaved data chunks in both directions within a single request. this is\n  absolutely not supported by the http specification and will not work across\n  most proxies or servers. when such applications attempt to do this through\n  haproxy, it works but they will experience high delays due to the network\n  optimizations which favor performance by instructing the system to wait for\n  enough data to be available in order to only send full packets. typical\n  delays are around 200 ms per round trip. note that this only happens with\n  abnormal uses. normal uses such as connect requests nor websockets are not\n  affected.\n\n  when \"option http-no-delay\" is present in either the frontend or the backend\n  used by a connection, all such optimizations will be disabled in order to\n  make the exchanges as fast as possible. of course this offers no guarantee on\n  the functionality, as it may break at any other place. but if it works via\n  haproxy, it will work as fast as possible. this option should never be used\n  by default, and should never be used at all unless such a buggy application\n  is discovered. the impact of using this option is an increase of bandwidth\n  usage and cpu usage, which may significantly lower performance in high\n  latency environments.\n\n  see also : \"option http-buffer-request\"\n\noption http-pretend-keepalive\nno option http-pretend-keepalive\n  define whether haproxy will announce keepalive to the server or not\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when running with \"option http-server-close\" or \"option forceclose\", haproxy\n  adds a \"connection: close\" header to the request forwarded to the server.\n  unfortunately, when some servers see this header, they automatically refrain\n  from using the chunked encoding for responses of unknown length, while this\n  is totally unrelated. the immediate effect is that this prevents haproxy from\n  maintaining the client connection alive. a second effect is that a client or\n  a cache could receive an incomplete response without being aware of it, and\n  consider the response complete.\n\n  by setting \"option http-pretend-keepalive\", haproxy will make the server\n  believe it will keep the connection alive. the server will then not fall back\n  to the abnormal undesired above. when haproxy gets the whole response, it\n  will close the connection with the server just as it would do with the\n  \"forceclose\" option. that way the client gets a normal response and the\n  connection is correctly closed on the server side.\n\n  it is recommended not to enable this option by default, because most servers\n  will more efficiently close the connection themselves after the last packet,\n  and release its buffers slightly earlier. also, the added packet on the\n  network could slightly reduce the overall peak performance. however it is\n  worth noting that when this option is enabled, haproxy will have slightly\n  less work to do. so if haproxy is the bottleneck on the whole architecture,\n  enabling this option might save a few cpu cycles.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  this option may be combined with \"option httpclose\", which will cause\n  keepalive to be announced to the server and close to be announced to the\n  client. this practice is discouraged though.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\", and\n             \"option http-keep-alive\"\n\noption http-server-close\nno option http-server-close\n  enable or disable http connection closing on the server side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\". setting \"option http-server-close\" enables http\n  connection-close mode on the server side while keeping the ability to support\n  http keep-alive and pipelining on the client side.  this provides the lowest\n  latency on the client side (slow network) and the fastest session reuse on\n  the server side to save server resources, similarly to \"option forceclose\".\n  it also permits non-keepalive capable servers to be served in keep-alive mode\n  to the clients if they conform to the requirements of rfc2616\\. please note\n  that some servers do not always conform to those requirements when they see\n  \"connection: close\" in the request. the effect will be that keep-alive will\n  never be used. a workaround consists in enabling \"option\n  http-pretend-keepalive\".\n\n  at the moment, logs will not indicate whether requests came from the same\n  session or not. the accept date reported in the logs corresponds to the end\n  of the previous request, and the request time corresponds to the time spent\n  waiting for a new request. the keep-alive request time is still bound to the\n  timeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\n  not set.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  it disables and replaces any previous \"option httpclose\", \"option forceclose\",\n  \"option http-tunnel\" or \"option http-keep-alive\". please check section 4\n  (\"proxies\") to see how this option combines with others when frontend and\n  backend options differ.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-pretend-keepalive\",\n             \"option httpclose\", \"option http-keep-alive\", and\n             \"1.1\\. the http transaction model\".\n\noption http-tunnel\nno option http-tunnel\n  disable or enable http connection processing after first transaction\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\".\n\n  option \"http-tunnel\" disables any http processing past the first request and\n  the first response. this is the mode which was used by default in versions\n  1.0 to 1.5-dev21\\. it is the mode with the lowest processing overhead, which\n  is normally not needed anymore unless in very specific cases such as when\n  using an in-house protocol that looks like http but is not compatible, or\n  just to log one request per client in order to reduce log size. note that\n  everything which works at the http level, including header parsing/addition,\n  cookie processing or content switching will only work for the first request\n  and will be ignored after the first response.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\",\n             \"option httpclose\", \"option http-keep-alive\", and\n             \"1.1\\. the http transaction model\".\n\noption http-use-proxy-header\nno option http-use-proxy-header\n  make use of non-standard proxy-connection header instead of connection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  while rfc2616 explicitly states that http/1.1 agents must use the\n  connection header to indicate their wish of persistent or non-persistent\n  connections, both browsers and proxies ignore this header for proxied\n  connections and make use of the undocumented, non-standard proxy-connection\n  header instead. the issue begins when trying to put a load balancer between\n  browsers and such proxies, because there will be a difference between what\n  haproxy understands and what the client and the proxy agree on.\n\n  by setting this option in a frontend, haproxy can automatically switch to use\n  that non-standard header if it sees proxied requests. a proxied request is\n  defined here as one where the uri begins with neither a '/' nor a '*'. the\n  choice of header only affects requests passing through proxies making use of\n  one of the \"httpclose\", \"forceclose\" and \"http-server-close\" options. note\n  that this option can only be specified in a frontend and will affect the\n  request along its whole life.\n\n  also, when this option is set, a request which requires authentication will\n  automatically switch to use proxy authentication headers if it is itself a\n  proxied request. that makes it possible to check or enforce authentication in\n  front of an existing proxy.\n\n  this option should normally never be used, except in front of a proxy.\n\n  see also : \"option httpclose\", \"option forceclose\" and \"option\n             http-server-close\".\n\noption httpchk\noption httpchk <uri>\noption httpchk <method> <uri>\noption httpchk <method> <uri> <version>\n  enable http protocol to check on the servers health\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <method>  is the optional http method used with the requests. when not set,\n              the \"options\" method is used, as it generally requires low server\n              processing and is easy to filter out from the logs. any method\n              may be used, though it is not recommended to invent non-standard\n              ones.\n\n    <uri>     is the uri referenced in the http requests. it defaults to \" / \"\n              which is accessible by default on almost any server, but may be\n              changed to any other uri. query strings are permitted.\n\n    <version> is the optional http version string. it defaults to \"http/1.0\"\n              but some servers might behave incorrectly in http 1.0, so turning\n              it to http/1.1 may sometimes help. note that the host field is\n              mandatory in http/1.1, and as a trick, it is possible to pass it\n              after \"\\r\\n\" following the version string.\n\n  by default, server health checks only consist in trying to establish a tcp\n  connection. when \"option httpchk\" is specified, a complete http request is\n  sent once the tcp connection is established, and responses 2xx and 3xx are\n  considered valid, while all other ones indicate a server failure, including\n  the lack of any response.\n\n  the port and interval are specified in the server configuration.\n\n  this option does not necessarily require an http backend, it also works with\n  plain tcp backends. this is particularly useful to check simple scripts bound\n  to some dedicated ports using the inetd daemon.\n\n  examples :\n      # relay https traffic to apache instance and check service availability\n      # using http request \"options * http/1.1\" on port 80.\n      backend https_relay\n          mode tcp\n          option httpchk options * http/1.1\\r\\nhost:\\ www\n          server apache1 192.168.1.1:443 check port 80\n\n  see also : \"option ssl-hello-chk\", \"option smtpchk\", \"option mysql-check\",\n             \"option pgsql-check\", \"http-check\" and the \"check\", \"port\" and\n             \"inter\" server options.\n\noption httpclose\nno option httpclose\n  enable or disable passive http connection closing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default haproxy operates in keep-alive mode with regards to persistent\n  connections: for each connection it processes each request and response, and\n  leaves the connection idle on both sides between the end of a response and\n  the start of a new request. this mode may be changed by several options such\n  as \"option http-server-close\", \"option forceclose\", \"option httpclose\" or\n  \"option http-tunnel\".\n\n  if \"option httpclose\" is set, haproxy will work in http tunnel mode and check\n  if a \"connection: close\" header is already set in each direction, and will\n  add one if missing. each end should react to this by actively closing the tcp\n  connection after each transfer, thus resulting in a switch to the http close\n  mode. any \"connection\" header different from \"close\" will also be removed.\n  note that this option is deprecated since what it does is very cheap but not\n  reliable. using \"option http-server-close\" or \"option forceclose\" is strongly\n  recommended instead.\n\n  it seldom happens that some servers incorrectly ignore this header and do not\n  close the connection even though they reply \"connection: close\". for this\n  reason, they are not compatible with older http 1.0 browsers. if this happens\n  it is possible to use the \"option forceclose\" which actively closes the\n  request connection once the server responds. option \"forceclose\" also\n  releases the server connection earlier because it does not have to wait for\n  the client to acknowledge it.\n\n  this option may be set both in a frontend and in a backend. it is enabled if\n  at least one of the frontend or backend holding a connection has it enabled.\n  it disables and replaces any previous \"option http-server-close\",\n  \"option forceclose\", \"option http-keep-alive\" or \"option http-tunnel\". please\n  check section 4 (\"proxies\") to see how this option combines with others when\n  frontend and backend options differ.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option forceclose\", \"option http-server-close\" and\n             \"1.1\\. the http transaction model\".\n\noption httplog [ clf ]\n  enable logging of http request, session state and timers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    clf       if the \"clf\" argument is added, then the output format will be\n              the clf format instead of haproxy's default http format. you can\n              use this when you need to feed haproxy's logs through a specific\n              log analyser which only support the clf format and which is not\n              extensible.\n\n  by default, the log output format is very poor, as it only contains the\n  source and destination addresses, and the instance name. by specifying\n  \"option httplog\", each log line turns into a much richer format including,\n  but not limited to, the http request, the connection timers, the session\n  status, the connections numbers, the captured headers and cookies, the\n  frontend, backend and server name, and of course the source address and\n  ports.\n\n  this option may be set either in the frontend or the backend.\n\n  specifying only \"option httplog\" will automatically clear the 'clf' mode\n  if it was set by default.\n\n  see also :  section 8 about logging.\n\noption http_proxy\nno option http_proxy\n  enable or disable plain http proxy mode\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  it sometimes happens that people need a pure http proxy which understands\n  basic proxy requests without caching nor any fancy feature. in this case,\n  it may be worth setting up an haproxy instance with the \"option http_proxy\"\n  set. in this mode, no server is declared, and the connection is forwarded to\n  the ip address and port found in the url after the \"http://\" scheme.\n\n  no host address resolution is performed, so this only works when pure ip\n  addresses are passed. since this option's usage perimeter is rather limited,\n  it will probably be used only by experts who know they need exactly it. last,\n  if the clients are susceptible of sending keep-alive requests, it will be\n  needed to add \"option httpclose\" to ensure that all requests will correctly\n  be analyzed.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  example :\n    # this backend understands http proxy requests and forwards them directly.\n    backend direct_forward\n        option httpclose\n        option http_proxy\n\n  see also : \"option httpclose\"\n\noption independent-streams\nno option independent-streams\n  enable or disable independent timeout processing for both directions\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |  yes\n  arguments : none\n\n  by default, when data is sent over a socket, both the write timeout and the\n  read timeout for that socket are refreshed, because we consider that there is\n  activity on that socket, and we have no other means of guessing if we should\n  receive data or not.\n\n  while this default behaviour is desirable for almost all applications, there\n  exists a situation where it is desirable to disable it, and only refresh the\n  read timeout if there are incoming data. this happens on sessions with large\n  timeouts and low amounts of exchanged data such as telnet session. if the\n  server suddenly disappears, the output data accumulates in the system's\n  socket buffers, both timeouts are correctly refreshed, and there is no way\n  to know the server does not receive them, so we don't timeout. however, when\n  the underlying protocol always echoes sent data, it would be enough by itself\n  to detect the issue using the read timeout. note that this problem does not\n  happen with more verbose protocols because data won't accumulate long in the\n  socket buffers.\n\n  when this option is set on the frontend, it will disable read timeout updates\n  on data sent to the client. there probably is little use of this case. when\n  the option is set on the backend, it will disable read timeout updates on\n  data sent to the server. doing so will typically break large http posts from\n  slow lines, so use it with caution.\n\n  note: older versions used to call this setting \"option independent-streams\"\n        with a spelling mistake. this spelling is still supported but\n        deprecated.\n\n  see also : \"timeout client\", \"timeout server\" and \"timeout tunnel\"\n\noption ldap-check\n  use ldapv3 health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  it is possible to test that the server correctly talks ldapv3 instead of just\n  testing that it accepts the tcp connection. when this option is set, an\n  ldapv3 anonymous simple bind message is sent to the server, and the response\n  is analyzed to find an ldapv3 bind response message.\n\n  the server is considered valid only when the ldap response contains success\n  resultcode (http://tools.ietf.org/html/rfc4511#section-4.1.9).\n\n  logging of bind requests is server dependent see your documentation how to\n  configure it.\n\n  example :\n        option ldap-check\n\n  see also : \"option httpchk\"\n\noption external-check\n  use external processes for server health checks\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  it is possible to test the health of a server using an external command.\n  this is achieved by running the executable set using \"external-check\n  command\".\n\n  requires the \"external-check\" global to be set.\n\n  see also : \"external-check\", \"external-check command\", \"external-check path\"\n\noption log-health-checks\nno option log-health-checks\n  enable or disable logging of health checks status updates\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |  yes\n  arguments : none\n\n  by default, failed health check are logged if server is up and successful\n  health checks are logged if server is down, so the amount of additional\n  information is limited.\n\n  when this option is enabled, any change of the health check status or to\n  the server's health will be logged, so that it becomes possible to know\n  that a server was failing occasional checks before crashing, or exactly when\n  it failed to respond a valid http status, then when the port started to\n  reject connections, then when the server stopped responding at all.\n\n  note that status changes not caused by health checks (eg: enable/disable on\n  the cli) are intentionally not logged by this option.\n\n  see also: \"option httpchk\", \"option ldap-check\", \"option mysql-check\",\n            \"option pgsql-check\", \"option redis-check\", \"option smtpchk\",\n            \"option tcp-check\", \"log\" and section 8 about logging.\n\noption log-separate-errors\nno option log-separate-errors\n  change log level for non-completely successful connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  sometimes looking for errors in logs is not easy. this option makes haproxy\n  raise the level of logs containing potentially interesting information such\n  as errors, timeouts, retries, redispatches, or http status codes 5xx. the\n  level changes from \"info\" to \"err\". this makes it possible to log them\n  separately to a different file with most syslog daemons. be careful not to\n  remove them from the original file, otherwise you would lose ordering which\n  provides very important information.\n\n  using this option, large sites dealing with several thousand connections per\n  second may log normal traffic to a rotating buffer and only archive smaller\n  error logs.\n\n  see also : \"log\", \"dontlognull\", \"dontlog-normal\" and section 8 about\n             logging.\n\noption logasap\nno option logasap\n  enable or disable early logging of http requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments : none\n\n  by default, http requests are logged upon termination so that the total\n  transfer time and the number of bytes appear in the logs. when large objects\n  are being transferred, it may take a while before the request appears in the\n  logs. using \"option logasap\", the request gets logged as soon as the server\n  sends the complete headers. the only missing information in the logs will be\n  the total number of bytes which will indicate everything except the amount\n  of data transferred, and the total time which will not take the transfer\n  time into account. in such a situation, it's a good practice to capture the\n  \"content-length\" response header so that the logs at least indicate how many\n  bytes are expected to be transferred.\n\n  examples :\n      listen http_proxy 0.0.0.0:80\n          mode http\n          option httplog\n          option logasap\n          log 192.168.2.200 local3\n\n    >>> feb  6 12:14:14 localhost \\\n          haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n          static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \\\n          \"get /image.iso http/1.0\"\n\n  see also : \"option httplog\", \"capture response header\", and section 8 about\n             logging.\n\noption mysql-check [ user <username> [ post-41 ] ]\n  use mysql health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <username> this is the username which will be used when connecting to mysql\n               server.\n    post-41    send post v4.1 client compatible checks\n\n  if you specify a username, the check consists of sending two mysql packet,\n  one client authentication packet, and one quit packet, to correctly close\n  mysql session. we then parse the mysql handshake initialisation packet and/or\n  error packet. it is a basic but useful test which does not produce error nor\n  aborted connect on the server. however, it requires adding an authorization\n  in the mysql table, like this :\n\n      use mysql;\n      insert into user (host,user) values ('<ip_of_haproxy>','<username>');\n      flush privileges;\n\n  if you don't specify a username (it is deprecated and not recommended), the\n  check only consists in parsing the mysql handshake initialisation packet or\n  error packet, we don't send anything in this mode. it was reported that it\n  can generate lockout if check is too frequent and/or if there is not enough\n  traffic. in fact, you need in this case to check mysql \"max_connect_errors\"\n  value as if a connection is established successfully within fewer than mysql\n  \"max_connect_errors\" attempts after a previous connection was interrupted,\n  the error count for the host is cleared to zero. if haproxy's server get\n  blocked, the \"flush hosts\" statement is the only way to unblock it.\n\n  remember that this does not check database presence nor database consistency.\n  to do this, you can use an external check with xinetd for example.\n\n  the check requires mysql >=3.22, for older version, please use tcp check.\n\n  most often, an incoming mysql server needs to see the client's ip address for\n  various purposes, including ip privilege matching and connection logging.\n  when possible, it is often wise to masquerade the client's ip address when\n  connecting to the server using the \"usesrc\" argument of the \"source\" keyword,\n  which requires the cttproxy feature to be compiled in, and the mysql server\n  to route the client via the machine hosting haproxy.\n\n  see also: \"option httpchk\"\n\noption nolinger\nno option nolinger\n  enable or disable immediate session resource cleaning after close\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when clients or servers abort connections in a dirty way (eg: they are\n  physically disconnected), the session timeouts triggers and the session is\n  closed. but it will remain in fin_wait1 state for some time in the system,\n  using some resources and possibly limiting the ability to establish newer\n  connections.\n\n  when this happens, it is possible to activate \"option nolinger\" which forces\n  the system to immediately remove any socket's pending data on close. thus,\n  the session is instantly purged from the system's tables. this usually has\n  side effects such as increased number of tcp resets due to old retransmits\n  getting immediately rejected. some firewalls may sometimes complain about\n  this too.\n\n  for this reason, it is not recommended to use this option when not absolutely\n  needed. you know that you need it when you have thousands of fin_wait1\n  sessions on your system (time_wait ones do not count).\n\n  this option may be used both on frontends and backends, depending on the side\n  where it is required. use it on the frontend for clients, and on the backend\n  for servers.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\noption originalto [ except <network> ] [ header <name> ]\n  enable insertion of the x-original-to header to requests sent to servers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <network> is an optional argument used to disable this option for sources\n              matching <network>\n    <name>    an optional argument to specify a different \"x-original-to\"\n              header name.\n\n  since haproxy can work in transparent mode, every request from a client can\n  be redirected to the proxy and haproxy itself can proxy every request to a\n  complex squid environment and the destination host from so_original_dst will\n  be lost. this is annoying when you want access rules based on destination ip\n  addresses. to solve this problem, a new http header \"x-original-to\" may be\n  added by haproxy to all requests sent to the server. this header contains a\n  value representing the original destination ip address. since this must be\n  configured to always use the last occurrence of this header only. note that\n  only the last occurrence of the header must be used, since it is really\n  possible that the client has already brought one.\n\n  the keyword \"header\" may be used to supply a different header name to replace\n  the default \"x-original-to\". this can be useful where you might already\n  have a \"x-original-to\" header from a different application, and you need\n  preserve it. also if your backend server doesn't use the \"x-original-to\"\n  header and requires different one.\n\n  sometimes, a same haproxy instance may be shared between a direct client\n  access and a reverse-proxy access (for instance when an ssl reverse-proxy is\n  used to decrypt https traffic). it is possible to disable the addition of the\n  header for a known source address or network by adding the \"except\" keyword\n  followed by the network address. in this case, any source ip matching the\n  network will not cause an addition of this header. most common uses are with\n  private networks or 127.0.0.1.\n\n  this option may be specified either in the frontend or in the backend. if at\n  least one of them uses it, the header will be added. note that the backend's\n  setting of the header subargument takes precedence over the frontend's if\n  both are defined.\n\n  examples :\n    # original destination address\n    frontend www\n        mode http\n        option originalto except 127.0.0.1\n\n    # those servers want the ip address in x-client-dst\n    backend www\n        mode http\n        option originalto header x-client-dst\n\n  see also : \"option httpclose\", \"option http-server-close\",\n             \"option forceclose\"\n\noption persist\nno option persist\n  enable or disable forced persistence on down servers\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when an http request reaches a backend with a cookie which references a dead\n  server, by default it is redispatched to another server. it is possible to\n  force the request to be sent to the dead server first using \"option persist\"\n  if absolutely needed. a common use case is when servers are under extreme\n  load and spend their time flapping. in this case, the users would still be\n  directed to the server they opened the session on, in the hope they would be\n  correctly served. it is recommended to use \"option redispatch\" in conjunction\n  with this option so that in the event it would not be possible to connect to\n  the server at all (server definitely dead), the client would finally be\n  redirected to another valid server.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option redispatch\", \"retries\", \"force-persist\"\n\noption pgsql-check [ user <username> ]\n  use postgresql health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <username> this is the username which will be used when connecting to\n               postgresql server.\n\n  the check sends a postgresql startupmessage and waits for either\n  authentication request or errorresponse message. it is a basic but useful\n  test which does not produce error nor aborted connect on the server.\n  this check is identical with the \"mysql-check\".\n\n  see also: \"option httpchk\"\n\noption prefer-last-server\nno option prefer-last-server\n  allow multiple load balanced requests to remain on the same server\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when the load balancing algorithm in use is not deterministic, and a previous\n  request was sent to a server to which haproxy still holds a connection, it is\n  sometimes desirable that subsequent requests on a same session go to the same\n  server as much as possible. note that this is different from persistence, as\n  we only indicate a preference which haproxy tries to apply without any form\n  of warranty. the real use is for keep-alive connections sent to servers. when\n  this option is used, haproxy will try to reuse the same connection that is\n  attached to the server instead of rebalancing to another server, causing a\n  close of the connection. this can make sense for static file servers. it does\n  not make much sense to use this in combination with hashing algorithms. note,\n  haproxy already automatically tries to stick to a server which sends a 401 or\n  to a proxy which sends a 407 (authentication required). this is mandatory for\n  use with the broken ntlm authentication challenge, and significantly helps in\n  troubleshooting some faulty applications. option prefer-last-server might be\n  desirable in these environments as well, to avoid redistributing the traffic\n  after every other response.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also: \"option http-keep-alive\"\n\noption redispatch\noption redispatch <interval>\nno option redispatch\n  enable or disable session redistribution in case of connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <interval> the optional integer value that controls how often redispatches\n               occur when retrying connections. positive value p indicates a\n               redispatch is desired on every pth retry, and negative value\n               n indicate a redispath is desired on the nth retry prior to the\n               last retry. for example, the default of -1 preserves the\n               historical behaviour of redispatching on the last retry, a\n               positive value of 1 would indicate a redispatch on every retry,\n               and a positive value of 3 would indicate a redispatch on every\n               third retry. you can disable redispatches with a value of 0.\n\n  in http mode, if a server designated by a cookie is down, clients may\n  definitely stick to it because they cannot flush the cookie, so they will not\n  be able to access the service anymore.\n\n  specifying \"option redispatch\" will allow the proxy to break their\n  persistence and redistribute them to a working server.\n\n  it also allows to retry connections to another server in case of multiple\n  connection failures. of course, it requires having \"retries\" set to a nonzero\n  value.\n\n  this form is the preferred form, which replaces both the \"redispatch\" and\n  \"redisp\" keywords.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"redispatch\", \"retries\", \"force-persist\"\n\noption redis-check\n  use redis health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  it is possible to test that the server correctly talks redis protocol instead\n  of just testing that it accepts the tcp connection. when this option is set,\n  a ping redis command is sent to the server, and the response is analyzed to\n  find the \"+pong\" response message.\n\n  example :\n        option redis-check\n\n  see also : \"option httpchk\"\n\noption smtpchk\noption smtpchk <hello> <domain>\n  use smtp health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <hello>   is an optional argument. it is the \"hello\" command to use. it can\n              be either \"helo\" (for smtp) or \"ehlo\" (for estmp). all other\n              values will be turned into the default command (\"helo\").\n\n    <domain>  is the domain name to present to the server. it may only be\n              specified (and is mandatory) if the hello command has been\n              specified. by default, \"localhost\" is used.\n\n  when \"option smtpchk\" is set, the health checks will consist in tcp\n  connections followed by an smtp command. by default, this command is\n  \"helo localhost\". the server's return code is analyzed and only return codes\n  starting with a \"2\" will be considered as valid. all other responses,\n  including a lack of response will constitute an error and will indicate a\n  dead server.\n\n  this test is meant to be used with smtp servers or relays. depending on the\n  request, it is possible that some servers do not log each connection attempt,\n  so you may want to experiment to improve the behaviour. using telnet on port\n  25 is often easier than adjusting the configuration.\n\n  most often, an incoming smtp server needs to see the client's ip address for\n  various purposes, including spam filtering, anti-spoofing and logging. when\n  possible, it is often wise to masquerade the client's ip address when\n  connecting to the server using the \"usesrc\" argument of the \"source\" keyword,\n  which requires the cttproxy feature to be compiled in.\n\n  example :\n        option smtpchk helo mydomain.org\n\n  see also : \"option httpchk\", \"source\"\n\noption socket-stats\nno option socket-stats\n\n  enable or disable collecting & providing separate statistics for each socket.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n\n  arguments : none\n\noption splice-auto\nno option splice-auto\n  enable or disable automatic kernel acceleration on sockets in both directions\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will automatically evaluate the opportunity to use kernel tcp splicing to\n  forward data between the client and the server, in either direction. haproxy\n  uses heuristics to estimate if kernel splicing might improve performance or\n  not. both directions are handled independently. note that the heuristics used\n  are not much aggressive in order to limit excessive use of splicing. this\n  option requires splicing to be enabled at compile time, and may be globally\n  disabled with the global option \"nosplice\". since splice uses pipes, using it\n  requires that there are enough spare pipes.\n\n  important note: kernel-based tcp splicing is a linux-specific feature which\n  first appeared in kernel 2.6.25\\. it offers kernel-based acceleration to\n  transfer data between sockets without copying these data to user-space, thus\n  providing noticeable performance gains and cpu cycles savings. since many\n  early implementations are buggy, corrupt data and/or are inefficient, this\n  feature is not enabled by default, and it should be used with extreme care.\n  while it is not possible to detect the correctness of an implementation,\n  2.6.29 is the first version offering a properly working implementation. in\n  case of doubt, splicing may be globally disabled using the global \"nosplice\"\n  keyword.\n\n  example :\n        option splice-auto\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-request\", \"option splice-response\", and global\n             options \"nosplice\" and \"maxpipes\"\n\noption splice-request\nno option splice-request\n  enable or disable automatic kernel acceleration on sockets for requests\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will use kernel tcp splicing whenever possible to forward data going from\n  the client to the server. it might still use the recv/send scheme if there\n  are no spare pipes left. this option requires splicing to be enabled at\n  compile time, and may be globally disabled with the global option \"nosplice\".\n  since splice uses pipes, using it requires that there are enough spare pipes.\n\n  important note: see \"option splice-auto\" for usage limitations.\n\n  example :\n        option splice-request\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-auto\", \"option splice-response\", and global options\n             \"nosplice\" and \"maxpipes\"\n\noption splice-response\nno option splice-response\n  enable or disable automatic kernel acceleration on sockets for responses\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when this option is enabled either on a frontend or on a backend, haproxy\n  will use kernel tcp splicing whenever possible to forward data going from\n  the server to the client. it might still use the recv/send scheme if there\n  are no spare pipes left. this option requires splicing to be enabled at\n  compile time, and may be globally disabled with the global option \"nosplice\".\n  since splice uses pipes, using it requires that there are enough spare pipes.\n\n  important note: see \"option splice-auto\" for usage limitations.\n\n  example :\n        option splice-response\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option splice-auto\", \"option splice-request\", and global options\n             \"nosplice\" and \"maxpipes\"\n\noption srvtcpka\nno option srvtcpka\n  enable or disable the sending of tcp keepalive packets on the server side\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"srvtcpka\" enables the emission of tcp keep-alive probes on the\n  server side of a connection, which should help when session expirations are\n  noticed between haproxy and a server.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option clitcpka\", \"option tcpka\"\n\noption ssl-hello-chk\n  use sslv3 client hello health checks for server testing\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  when some ssl-based protocols are relayed in tcp mode through haproxy, it is\n  possible to test that the server correctly talks ssl instead of just testing\n  that it accepts the tcp connection. when \"option ssl-hello-chk\" is set, pure\n  sslv3 client hello messages are sent once the connection is established to\n  the server, and the response is analyzed to find an ssl server hello message.\n  the server is considered valid only when the response contains this server\n  hello message.\n\n  all servers tested till there correctly reply to sslv3 client hello messages,\n  and most servers tested do not even log the requests containing only hello\n  messages, which is appreciable.\n\n  note that this check works even when ssl support was not built into haproxy\n  because it forges the ssl message. when ssl support is available, it is best\n  to use native ssl health checks instead of this one.\n\n  see also: \"option httpchk\", \"check-ssl\"\n\noption tcp-check\n  perform health checks using tcp-check send/expect sequences\n  may be used in sections:   defaults | frontend | listen | backend\n                               yes    |    no    |   yes  |   yes\n\n  this health check method is intended to be combined with \"tcp-check\" command\n  lists in order to support send/expect types of health check sequences.\n\n  tcp checks currently support 4 modes of operations :\n    - no \"tcp-check\" directive : the health check only consists in a connection\n      attempt, which remains the default mode.\n\n    - \"tcp-check send\" or \"tcp-check send-binary\" only is mentioned : this is\n      used to send a string along with a connection opening. with some\n      protocols, it helps sending a \"quit\" message for example that prevents\n      the server from logging a connection error for each health check. the\n      check result will still be based on the ability to open the connection\n      only.\n\n    - \"tcp-check expect\" only is mentioned : this is used to test a banner.\n      the connection is opened and haproxy waits for the server to present some\n      contents which must validate some rules. the check result will be based\n      on the matching between the contents and the rules. this is suited for\n      pop, imap, smtp, ftp, ssh, telnet.\n\n    - both \"tcp-check send\" and \"tcp-check expect\" are mentioned : this is\n      used to test a hello-type protocol. haproxy sends a message, the server\n      responds and its response is analysed. the check result will be based on\n      the matching between the response contents and the rules. this is often\n      suited for protocols which require a binding or a request/response model.\n      ldap, mysql, redis and ssl are example of such protocols, though they\n      already all have their dedicated checks with a deeper understanding of\n      the respective protocols.\n      in this mode, many questions may be sent and many answers may be\n      analysed.\n\n    a fifth mode can be used to insert comments in different steps of the\n    script.\n\n    for each tcp-check rule you create, you can add a \"comment\" directive,\n    followed by a string. this string will be reported in the log and stderr\n    in debug mode. it is useful to make user-friendly error reporting.\n    the \"comment\" is of course optional.\n\n  examples :\n         # perform a pop check (analyse only server's banner)\n         option tcp-check\n         tcp-check expect string +ok\\ pop3\\ ready comment pop\\ protocol\n\n         # perform an imap check (analyse only server's banner)\n         option tcp-check\n         tcp-check expect string *\\ ok\\ imap4\\ ready comment imap\\ protocol\n\n         # look for the redis master server after ensuring it speaks well\n         # redis protocol, then it exits properly.\n         # (send a command then analyse the response 3 times)\n         option tcp-check\n         tcp-check comment ping\\ phase\n         tcp-check send ping\\r\\n\n         tcp-check expect +ponge\n         tcp-check comment role\\ check\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n         tcp-check comment quit\\ phase\n         tcp-check send quit\\r\\n\n         tcp-check expect string +ok\n\n         forge a http request, then analyse the response\n         (send many headers before analyzing)\n         option tcp-check\n         tcp-check comment forge\\ and\\ send\\ http\\ request\n         tcp-check send head\\ /\\ http/1.1\\r\\n\n         tcp-check send host:\\ www.mydomain.com\\r\\n\n         tcp-check send user-agent:\\ haproxy\\ tcpcheck\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring http/1\\..\\ (2..|3..) comment check\\ http\\ response\n\n  see also : \"tcp-check expect\", \"tcp-check send\"\n\noption tcp-smart-accept\nno option tcp-smart-accept\n  enable or disable the saving of one ack packet during the accept sequence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |    no\n  arguments : none\n\n  when an http connection request comes in, the system acknowledges it on\n  behalf of haproxy, then the client immediately sends its request, and the\n  system acknowledges it too while it is notifying haproxy about the new\n  connection. haproxy then reads the request and responds. this means that we\n  have one tcp ack sent by the system for nothing, because the request could\n  very well be acknowledged by haproxy when it sends its response.\n\n  for this reason, in http mode, haproxy automatically asks the system to avoid\n  sending this useless ack on platforms which support it (currently at least\n  linux). it must not cause any problem, because the system will send it anyway\n  after 40 ms if the response takes more time than expected to come.\n\n  during complex network debugging sessions, it may be desirable to disable\n  this optimization because delayed acks can make troubleshooting more complex\n  when trying to identify where packets are delayed. it is then possible to\n  fall back to normal behaviour by specifying \"no option tcp-smart-accept\".\n\n  it is also possible to force it for non-http proxies by simply specifying\n  \"option tcp-smart-accept\". for instance, it can make sense with some services\n  such as smtp where the server speaks first.\n\n  it is recommended to avoid forcing this option in a defaults section. in case\n  of doubt, consider setting it back to automatic values by prepending the\n  \"default\" keyword before it, or disabling it using the \"no\" keyword.\n\n  see also : \"option tcp-smart-connect\"\n\noption tcp-smart-connect\nno option tcp-smart-connect\n  enable or disable the saving of one ack packet during the connect sequence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  on certain systems (at least linux), haproxy can ask the kernel not to\n  immediately send an empty ack upon a connection request, but to directly\n  send the buffer request instead. this saves one packet on the network and\n  thus boosts performance. it can also be useful for some servers, because they\n  immediately get the request along with the incoming connection.\n\n  this feature is enabled when \"option tcp-smart-connect\" is set in a backend.\n  it is not enabled by default because it makes network troubleshooting more\n  complex.\n\n  it only makes sense to enable it with protocols where the client speaks first\n  such as http. in other situations, if there is no data to send in place of\n  the ack, a normal ack is sent.\n\n  if this option has been enabled in a \"defaults\" section, it can be disabled\n  in a specific instance by prepending the \"no\" keyword before it.\n\n  see also : \"option tcp-smart-accept\"\n\noption tcpka\n  enable or disable the sending of tcp keepalive packets on both sides\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  when there is a firewall or any session-aware component between a client and\n  a server, and when the protocol involves very long sessions with long idle\n  periods (eg: remote desktops), there is a risk that one of the intermediate\n  components decides to expire a session which has remained idle for too long.\n\n  enabling socket-level tcp keep-alives makes the system regularly send packets\n  to the other end of the connection, leaving it active. the delay between\n  keep-alive probes is controlled by the system only and depends both on the\n  operating system and its tuning parameters.\n\n  it is important to understand that keep-alive packets are neither emitted nor\n  received at the application level. it is only the network stacks which sees\n  them. for this reason, even if one side of the proxy already uses keep-alives\n  to maintain its connection alive, those keep-alive packets will not be\n  forwarded to the other side of the proxy.\n\n  please note that this has nothing to do with http keep-alive.\n\n  using option \"tcpka\" enables the emission of tcp keep-alive probes on both\n  the client and server sides of a connection. note that this is meaningful\n  only in \"defaults\" or \"listen\" sections. if this option is used in a\n  frontend, only the client side will get keep-alives, and if this option is\n  used in a backend, only the server side will get keep-alives. for this\n  reason, it is strongly recommended to explicitly use \"option clitcpka\" and\n  \"option srvtcpka\" when the configuration is split between frontends and\n  backends.\n\n  see also : \"option clitcpka\", \"option srvtcpka\"\n\noption tcplog\n  enable advanced logging of tcp connections with session state and timers\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default, the log output format is very poor, as it only contains the\n  source and destination addresses, and the instance name. by specifying\n  \"option tcplog\", each log line turns into a much richer format including, but\n  not limited to, the connection timers, the session status, the connections\n  numbers, the frontend, backend and server name, and of course the source\n  address and ports. this option is useful for pure tcp proxies in order to\n  find which of the client or server disconnects or times out. for normal http\n  proxies, it's better to use \"option httplog\" which is even more complete.\n\n  this option may be set either in the frontend or the backend.\n\n  see also :  \"option httplog\", and section 8 about logging.\n\noption transparent\nno option transparent\n  enable client-side transparent proxying\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  this option was introduced in order to provide layer 7 persistence to layer 3\n  load balancers. the idea is to use the os's ability to redirect an incoming\n  connection for a remote address to a local process (here haproxy), and let\n  this process know what address was initially requested. when this option is\n  used, sessions without cookies will be forwarded to the original destination\n  ip address of the incoming request (which should match that of another\n  equipment), while requests with cookies will still be forwarded to the\n  appropriate server.\n\n  note that contrary to a common belief, this option does not make haproxy\n  present the client's ip to the server when establishing the connection.\n\n  see also: the \"usesrc\" argument of the \"source\" keyword, and the\n            \"transparent\" option of the \"bind\" keyword.\n\nexternal-check command <command>\n  executable to run when performing an external-check\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  arguments :\n    <command> is the external command to run\n\n  the arguments passed to the to the command are:\n\n  <proxy_address> <proxy_port> <server_address> <server_port>\n\n  the <proxy_address> and <proxy_port> are derived from the first listener\n  that is either ipv4, ipv6 or a unix socket. in the case of a unix socket\n  listener the proxy_address will be the path of the socket and the\n  <proxy_port> will be the string \"not_used\". in a backend section, it's not\n  possible to determine a listener, and both <proxy_address> and <proxy_port>\n  will have the string value \"not_used\".\n\n  some values are also provided through environment variables.\n\n  environment variables :\n    haproxy_proxy_addr      the first bind address if available (or empty if not\n                            applicable, for example in a \"backend\" section).\n\n    haproxy_proxy_id        the backend id.\n\n    haproxy_proxy_name      the backend name.\n\n    haproxy_proxy_port      the first bind port if available (or empty if not\n                            applicable, for example in a \"backend\" section or\n                            for a unix socket).\n\n    haproxy_server_addr     the server address.\n\n    haproxy_server_curconn  the current number of connections on the server.\n\n    haproxy_server_id       the server id.\n\n    haproxy_server_maxconn  the server max connections.\n\n    haproxy_server_name     the server name.\n\n    haproxy_server_port     the server port if available (or empty for a unix\n                            socket).\n\n    path                    the path environment variable used when executing\n                            the command may be set using \"external-check path\".\n\n  if the command executed and exits with a zero status then the check is\n  considered to have passed, otherwise the check is considered to have\n  failed.\n\n  example :\n        external-check command /bin/true\n\n  see also : \"external-check\", \"option external-check\", \"external-check path\"\n\nexternal-check path <path>\n  the value of the path environment variable used when running an external-check\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n\n  arguments :\n    <path> is the path used when executing external command to run\n\n  the default path is \"\".\n\n  example :\n        external-check path \"/usr/bin:/bin\"\n\n  see also : \"external-check\", \"option external-check\",\n             \"external-check command\"\n\npersist rdp-cookie\npersist rdp-cookie(<name>)\n  enable rdp cookie-based persistence\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <name>    is the optional name of the rdp cookie to check. if omitted, the\n              default cookie name \"msts\" will be used. there currently is no\n              valid reason to change this name.\n\n  this statement enables persistence based on an rdp cookie. the rdp cookie\n  contains all information required to find the server in the list of known\n  servers. so when this option is set in the backend, the request is analysed\n  and if an rdp cookie is found, it is decoded. if it matches a known server\n  which is still up (or if \"option persist\" is set), then the connection is\n  forwarded to this server.\n\n  note that this only makes sense in a tcp backend, but for this to work, the\n  frontend must have waited long enough to ensure that an rdp cookie is present\n  in the request buffer. this is the same requirement as with the \"rdp-cookie\"\n  load-balancing method. thus it is highly recommended to put all statements in\n  a single \"listen\" section.\n\n  also, it is important to understand that the terminal server will emit this\n  rdp cookie only if it is configured for \"token redirection mode\", which means\n  that the \"ip address redirection\" option is disabled.\n\n  example :\n        listen tse-farm\n            bind :3389\n            # wait up to 5s for an rdp cookie in the request\n            tcp-request inspect-delay 5s\n            tcp-request content accept if rdp_cookie\n            # apply rdp cookie persistence\n            persist rdp-cookie\n            # if server is unknown, let's balance on the same cookie.\n            # alternatively, \"balance leastconn\" may be useful too.\n            balance rdp-cookie\n            server srv1 1.1.1.1:3389\n            server srv2 1.1.1.2:3389\n\n  see also : \"balance rdp-cookie\", \"tcp-request\", the \"req_rdp_cookie\" acl and\n  the rdp_cookie pattern fetch function.\n\nrate-limit sessions <rate>\n  set a limit on the number of new sessions accepted per second on a frontend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <rate>    the <rate> parameter is an integer designating the maximum number\n              of new sessions per second to accept on the frontend.\n\n  when the frontend reaches the specified number of new sessions per second, it\n  stops accepting new connections until the rate drops below the limit again.\n  during this time, the pending sessions will be kept in the socket's backlog\n  (in system buffers) and haproxy will not even be aware that sessions are\n  pending. when applying very low limit on a highly loaded service, it may make\n  sense to increase the socket's backlog using the \"backlog\" keyword.\n\n  this feature is particularly efficient at blocking connection-based attacks\n  or service abuse on fragile servers. since the session rate is measured every\n  millisecond, it is extremely accurate. also, the limit applies immediately,\n  no delay is needed at all to detect the threshold.\n\n  example : limit the connection rate on smtp to 10 per second max\n        listen smtp\n            mode tcp\n            bind :25\n            rate-limit sessions 10\n            server 127.0.0.1:1025\n\n  note : when the maximum rate is reached, the frontend's status is not changed\n         but its sockets appear as \"waiting\" in the statistics if the\n         \"socket-stats\" option is enabled.\n\n  see also : the \"backlog\" keyword and the \"fe_sess_rate\" acl criterion.\n\nredirect location <loc> [code <code>] <option> [{if | unless} <condition>]\nredirect prefix   <pfx> [code <code>] <option> [{if | unless} <condition>]\nredirect scheme   <sch> [code <code>] <option> [{if | unless} <condition>]\n  return an http redirection if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  if/unless the condition is matched, the http request will lead to a redirect\n  response. if no condition is specified, the redirect applies unconditionally.\n\n  arguments :\n    <loc>     with \"redirect location\", the exact value in <loc> is placed into\n              the http \"location\" header. when used in an \"http-request\" rule,\n              <loc> value follows the log-format rules and can include some\n              dynamic values (see custom log format in section 8.2.4).\n\n    <pfx>     with \"redirect prefix\", the \"location\" header is built from the\n              concatenation of <pfx> and the complete uri path, including the\n              query string, unless the \"drop-query\" option is specified (see\n              below). as a special case, if <pfx> equals exactly \"/\", then\n              nothing is inserted before the original uri. it allows one to\n              redirect to the same url (for instance, to insert a cookie). when\n              used in an \"http-request\" rule, <pfx> value follows the log-format\n              rules and can include some dynamic values (see custom log format\n              in section 8.2.4).\n\n    <sch>     with \"redirect scheme\", then the \"location\" header is built by\n              concatenating <sch> with \"://\" then the first occurrence of the\n              \"host\" header, and then the uri path, including the query string\n              unless the \"drop-query\" option is specified (see below). if no\n              path is found or if the path is \"*\", then \"/\" is used instead. if\n              no \"host\" header is found, then an empty host component will be\n              returned, which most recent browsers interpret as redirecting to\n              the same host. this directive is mostly used to redirect http to\n              https. when used in an \"http-request\" rule, <sch> value follows\n              the log-format rules and can include some dynamic values (see\n              custom log format in section 8.2.4).\n\n    <code>    the code is optional. it indicates which type of http redirection\n              is desired. only codes 301, 302, 303, 307 and 308 are supported,\n              with 302 used by default if no code is specified. 301 means\n              \"moved permanently\", and a browser may cache the location. 302\n              means \"moved permanently\" and means that the browser should not\n              cache the redirection. 303 is equivalent to 302 except that the\n              browser will fetch the location with a get method. 307 is just\n              like 302 but makes it clear that the same method must be reused.\n              likewise, 308 replaces 301 if the same method must be used.\n\n    <option>  there are several options which can be specified to adjust the\n              expected behaviour of a redirection :\n\n      - \"drop-query\"\n        when this keyword is used in a prefix-based redirection, then the\n        location will be set without any possible query-string, which is useful\n        for directing users to a non-secure page for instance. it has no effect\n        with a location-type redirect.\n\n      - \"append-slash\"\n        this keyword may be used in conjunction with \"drop-query\" to redirect\n        users who use a url not ending with a '/' to the same one with the '/'.\n        it can be useful to ensure that search engines will only see one url.\n        for this, a return code 301 is preferred.\n\n      - \"set-cookie name[=value]\"\n        a \"set-cookie\" header will be added with name (and optionally \"=value\")\n        to the response. this is sometimes used to indicate that a user has\n        been seen, for instance to protect against some types of dos. no other\n        cookie option is added, so the cookie will be a session cookie. note\n        that for a browser, a sole cookie name without an equal sign is\n        different from a cookie with an equal sign.\n\n      - \"clear-cookie name[=]\"\n        a \"set-cookie\" header will be added with name (and optionally \"=\"), but\n        with the \"max-age\" attribute set to zero. this will tell the browser to\n        delete this cookie. it is useful for instance on logout pages. it is\n        important to note that clearing the cookie \"name\" will not remove a\n        cookie set with \"name=value\". you have to clear the cookie \"name=\" for\n        that, because the browser makes the difference.\n\n  example: move the login url only to https.\n        acl clear      dst_port  80\n        acl secure     dst_port  8080\n        acl login_page url_beg   /login\n        acl logout     url_beg   /logout\n        acl uid_given  url_reg   /login?userid=[^&]+\n        acl cookie_set hdr_sub(cookie) seen=1\n\n        redirect prefix   https://mysite.com set-cookie seen=1 if !cookie_set\n        redirect prefix   https://mysite.com           if login_page !secure\n        redirect prefix   http://mysite.com drop-query if login_page !uid_given\n        redirect location http://mysite.com/           if !login_page secure\n        redirect location / clear-cookie userid=       if logout\n\n  example: send redirects for request for articles without a '/'.\n        acl missing_slash path_reg ^/article/[^/]*$\n        redirect code 301 prefix / drop-query append-slash if missing_slash\n\n  example: redirect all http traffic to https when ssl is handled by haproxy.\n        redirect scheme https if !{ ssl_fc }\n\n  example: append 'www.' prefix in front of all hosts not having it\n        http-request redirect code 301 location www.%[hdr(host)]%[req.uri] \\\n          unless { hdr_beg(host) -i www }\n\n  see section 7 about acl usage.\n\nredisp (deprecated)\nredispatch (deprecated)\n  enable or disable session redistribution in case of connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  in http mode, if a server designated by a cookie is down, clients may\n  definitely stick to it because they cannot flush the cookie, so they will not\n  be able to access the service anymore.\n\n  specifying \"redispatch\" will allow the proxy to break their persistence and\n  redistribute them to a working server.\n\n  it also allows to retry last connection to another server in case of multiple\n  connection failures. of course, it requires having \"retries\" set to a nonzero\n  value.\n\n  this form is deprecated, do not use it in any new configuration, use the new\n  \"option redispatch\" instead.\n\n  see also : \"option redispatch\"\n\nreqadd  <string> [{if | unless} <cond>]\n  add a header at the end of the http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a new line consisting in <string> followed by a line feed will be added after\n  the last header of an http request.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses.\n\n  example : add \"x-proto: ssl\" to requests coming via port 81\n     acl is-ssl  dst_port       81\n     reqadd      x-proto:\\ ssl  if is-ssl\n\n  see also: \"rspadd\", section 6 about http header manipulation, and section 7\n            about acls.\n\nreqallow  <search> [{if | unless} <cond>]\nreqiallow <search> [{if | unless} <cond>] (ignore case)\n  definitely allow an http request if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqallow\" keyword strictly matches case while \"reqiallow\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will mark the request as allowed, even if any later test would\n  result in a deny. the test applies both to the request line and to request\n  headers. keep in mind that urls in request line are case-sensitive while\n  header names are not.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # allow www.* but refuse *.local\n     reqiallow ^host:\\ www\\.\n     reqideny  ^host:\\ .*\\.local\n\n  see also: \"reqdeny\", \"block\", section 6 about http header manipulation, and\n            section 7 about acls.\n\nreqdel  <search> [{if | unless} <cond>]\nreqidel <search> [{if | unless} <cond>]  (ignore case)\n  delete all headers matching a regular expression in an http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the \"reqdel\"\n              keyword strictly matches case while \"reqidel\" ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any header line matching extended regular expression <search> in the request\n  will be completely deleted. most common use of this is to remove unwanted\n  and/or dangerous headers or cookies from a request before passing it to the\n  next servers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. keep in mind that header names are not case-sensitive.\n\n  example :\n     # remove x-forwarded-for header and server cookie\n     reqidel ^x-forwarded-for:.*\n     reqidel ^cookie:.*server=\n\n  see also: \"reqadd\", \"reqrep\", \"rspdel\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqdeny  <search> [{if | unless} <cond>]\nreqideny <search> [{if | unless} <cond>]  (ignore case)\n  deny an http request if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqdeny\" keyword strictly matches case while \"reqideny\" ignores\n              case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will mark the request as denied, even if any later test would\n  result in an allow. the test applies both to the request line and to request\n  headers. keep in mind that urls in request line are case-sensitive while\n  header names are not.\n\n  a denied request will generate an \"http 403 forbidden\" response once the\n  complete request has been parsed. this is consistent with what is practiced\n  using acls.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # refuse *.local, then allow www.*\n     reqideny  ^host:\\ .*\\.local\n     reqiallow ^host:\\ www\\.\n\n  see also: \"reqallow\", \"rspdeny\", \"block\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqpass  <search> [{if | unless} <cond>]\nreqipass <search> [{if | unless} <cond>]  (ignore case)\n  ignore any http request line matching a regular expression in next rules\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqpass\" keyword strictly matches case while \"reqipass\" ignores\n              case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will skip next rules, without assigning any deny or allow verdict.\n  the test applies both to the request line and to request headers. keep in\n  mind that urls in request line are case-sensitive while header names are not.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  reqdeny, reqallow and reqpass should be avoided in new designs.\n\n  example :\n     # refuse *.local, then allow www.*, but ignore \"www.private.local\"\n     reqipass  ^host:\\ www.private\\.local\n     reqideny  ^host:\\ .*\\.local\n     reqiallow ^host:\\ www\\.\n\n  see also: \"reqallow\", \"reqdeny\", \"block\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nreqrep  <search> <string> [{if | unless} <cond>]\nreqirep <search> <string> [{if | unless} <cond>]   (ignore case)\n  replace a regular expression with a string in an http request line\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the \"reqrep\"\n              keyword strictly matches case while \"reqirep\" ignores case.\n\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). references to matched\n              pattern groups are possible using the common \\n form, with n\n              being a single digit between 0 and 9\\. please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any line matching extended regular expression <search> in the request (both\n  the request line and header lines) will be completely replaced with <string>.\n  most common use of this is to rewrite urls or domain names in \"host\" headers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. note that for increased readability, it is suggested to add enough\n  spaces between the request and the response. keep in mind that urls in\n  request line are case-sensitive while header names are not.\n\n  example :\n     # replace \"/static/\" with \"/\" at the beginning of any request path.\n     reqrep ^([^\\ :]*)\\ /static/(.*)     \\1\\ /\\2\n     # replace \"www.mydomain.com\" with \"www\" in the host name.\n     reqirep ^host:\\ www.mydomain.com   host:\\ www\n\n  see also: \"reqadd\", \"reqdel\", \"rsprep\", \"tune.bufsize\", section 6 about\n            http header manipulation, and section 7 about acls.\n\nreqtarpit  <search> [{if | unless} <cond>]\nreqitarpit <search> [{if | unless} <cond>]  (ignore case)\n  tarpit an http request containing a line matching a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              request line. this is an extended regular expression. parenthesis\n              grouping is supported and no preliminary backslash is required.\n              any space or known delimiter must be escaped using a backslash\n              ('\\'). the pattern applies to a full line at a time. the\n              \"reqtarpit\" keyword strictly matches case while \"reqitarpit\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a request containing any line which matches extended regular expression\n  <search> will be tarpitted, which means that it will connect to nowhere, will\n  be kept open for a pre-defined time, then will return an http error 500 so\n  that the attacker does not suspect it has been tarpitted. the status 500 will\n  be reported in the logs, but the completion flags will indicate \"pt\". the\n  delay is defined by \"timeout tarpit\", or \"timeout connect\" if the former is\n  not set.\n\n  the goal of the tarpit is to slow down robots attacking servers with\n  identifiable requests. many robots limit their outgoing number of connections\n  and stay connected waiting for a reply which can take several minutes to\n  come. depending on the environment and attack, it may be particularly\n  efficient at reducing the load on the network and firewalls.\n\n  examples :\n     # ignore user-agents reporting any flavour of \"mozilla\" or \"msie\", but\n     # block all others.\n     reqipass   ^user-agent:\\.*(mozilla|msie)\n     reqitarpit ^user-agent:\n\n     # block bad guys\n     acl badguys src 10.1.0.3 172.16.13.20/28\n     reqitarpit . if badguys\n\n  see also: \"reqallow\", \"reqdeny\", \"reqpass\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nretries <value>\n  set the number of retries to perform on a server after a connection failure\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <value>   is the number of times a connection attempt should be retried on\n              a server when a connection either is refused or times out. the\n              default value is 3.\n\n  it is important to understand that this value applies to the number of\n  connection attempts, not full requests. when a connection has effectively\n  been established to a server, there will be no more retry.\n\n  in order to avoid immediate reconnections to a server which is restarting,\n  a turn-around timer of min(\"timeout connect\", one second) is applied before\n  a retry occurs.\n\n  when \"option redispatch\" is set, the last retry may be performed on another\n  server even if a cookie references a different server.\n\n  see also : \"option redispatch\"\n\nrspadd <string> [{if | unless} <cond>]\n  add a header at the end of the http response\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a new line consisting in <string> followed by a line feed will be added after\n  the last header of an http response.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses.\n\n  see also: \"reqadd\", section 6 about http header manipulation, and section 7\n            about acls.\n\nrspdel  <search> [{if | unless} <cond>]\nrspidel <search> [{if | unless} <cond>]  (ignore case)\n  delete all headers matching a regular expression in an http response\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rspdel\" keyword strictly matches case while \"rspidel\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any header line matching extended regular expression <search> in the response\n  will be completely deleted. most common use of this is to remove unwanted\n  and/or sensitive headers or cookies from a response before passing it to the\n  client.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. keep in mind that header names are not case-sensitive.\n\n  example :\n     # remove the server header from responses\n     rspidel ^server:.*\n\n  see also: \"rspadd\", \"rsprep\", \"reqdel\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nrspdeny  <search> [{if | unless} <cond>]\nrspideny <search> [{if | unless} <cond>]  (ignore case)\n  block an http response if a line matches a regular expression\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rspdeny\" keyword strictly matches case while \"rspideny\"\n              ignores case.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  a response containing any line which matches extended regular expression\n  <search> will mark the request as denied. the test applies both to the\n  response line and to response headers. keep in mind that header names are not\n  case-sensitive.\n\n  main use of this keyword is to prevent sensitive information leak and to\n  block the response before it reaches the client. if a response is denied, it\n  will be replaced with an http 502 error so that the client never retrieves\n  any sensitive data.\n\n  it is easier, faster and more powerful to use acls to write access policies.\n  rspdeny should be avoided in new designs.\n\n  example :\n     # ensure that no content type matching ms-word will leak\n     rspideny  ^content-type:\\.*/ms-word\n\n  see also: \"reqdeny\", \"acl\", \"block\", section 6 about http header manipulation\n            and section 7 about acls.\n\nrsprep  <search> <string> [{if | unless} <cond>]\nrspirep <search> <string> [{if | unless} <cond>]  (ignore case)\n  replace a regular expression with a string in an http response line\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <search>  is the regular expression applied to http headers and to the\n              response line. this is an extended regular expression, so\n              parenthesis grouping is supported and no preliminary backslash\n              is required. any space or known delimiter must be escaped using\n              a backslash ('\\'). the pattern applies to a full line at a time.\n              the \"rsprep\" keyword strictly matches case while \"rspirep\"\n              ignores case.\n\n    <string>  is the complete line to be added. any space or known delimiter\n              must be escaped using a backslash ('\\'). references to matched\n              pattern groups are possible using the common \\n form, with n\n              being a single digit between 0 and 9\\. please refer to section\n              6 about http header manipulation for more information.\n\n    <cond>    is an optional matching condition built from acls. it makes it\n              possible to ignore this rule when other conditions are not met.\n\n  any line matching extended regular expression <search> in the response (both\n  the response line and header lines) will be completely replaced with\n  <string>. most common use of this is to rewrite location headers.\n\n  header transformations only apply to traffic which passes through haproxy,\n  and not to traffic generated by haproxy, such as health-checks or error\n  responses. note that for increased readability, it is suggested to add enough\n  spaces between the request and the response. keep in mind that header names\n  are not case-sensitive.\n\n  example :\n     # replace \"location: 127.0.0.1:8080\" with \"location: www.mydomain.com\"\n     rspirep ^location:\\ 127.0.0.1:8080    location:\\ www.mydomain.com\n\n  see also: \"rspadd\", \"rspdel\", \"reqrep\", section 6 about http header\n            manipulation, and section 7 about acls.\n\nserver <name> <address>[:[port]] [param*]\n  declare a server in a backend\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <name>    is the internal name assigned to this server. this name will\n              appear in logs and alerts.  if \"http-send-name-header\" is\n              set, it will be added to the request header sent to the server.\n\n    <address> is the ipv4 or ipv6 address of the server. alternatively, a\n              resolvable hostname is supported, but this name will be resolved\n              during start-up. address \"0.0.0.0\" or \"*\" has a special meaning.\n              it indicates that the connection will be forwarded to the same ip\n              address as the one from the client connection. this is useful in\n              transparent proxy architectures where the client's connection is\n              intercepted and haproxy must forward to the original destination\n              address. this is more or less what the \"transparent\" keyword does\n              except that with a server it's possible to limit concurrency and\n              to report statistics. optionally, an address family prefix may be\n              used before the address to force the family regardless of the\n              address format, which can be useful to specify a path to a unix\n              socket with no slash ('/'). currently supported prefixes are :\n                    - 'ipv4@'  -> address is always ipv4\n                    - 'ipv6@'  -> address is always ipv6\n                    - 'unix@'  -> address is a path to a local unix socket\n                    - 'abns@'  -> address is in abstract namespace (linux only)\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment\n              variables.\n\n    <port>    is an optional port specification. if set, all connections will\n              be sent to this port. if unset, the same port the client\n              connected to will be used. the port may also be prefixed by a \"+\"\n              or a \"-\". in this case, the server's port will be determined by\n              adding this value to the client's port.\n\n    <param*>  is a list of parameters for this server. the \"server\" keywords\n              accepts an important number of options and has a complete section\n              dedicated to it. please refer to section 5 for more details.\n\n  examples :\n        server first  10.1.1.1:1080 cookie first  check inter 1000\n        server second 10.1.1.2:1080 cookie second check inter 1000\n        server transp ipv4@\n        server backup \"${srv_backup}:1080\" backup\n        server www1_dc1 \"${lan_dc1}.101:80\"\n        server www1_dc2 \"${lan_dc2}.101:80\"\n\n  see also: \"default-server\", \"http-send-name-header\" and section 5 about\n             server options\n\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | client | clientip } ]\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]\nsource <addr>[:<port>] [interface <name>]\n  set the source address for outgoing connections\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <addr>    is the ipv4 address haproxy will bind to before connecting to a\n              server. this address is also used as a source for health checks.\n\n              the default value of 0.0.0.0 means that the system will select\n              the most appropriate address to reach its destination. optionally\n              an address family prefix may be used before the address to force\n              the family regardless of the address format, which can be useful\n              to specify a path to a unix socket with no slash ('/'). currently\n              supported prefixes are :\n                - 'ipv4@' -> address is always ipv4\n                - 'ipv6@' -> address is always ipv6\n                - 'unix@' -> address is a path to a local unix socket\n                - 'abns@' -> address is in abstract namespace (linux only)\n              you may want to reference some environment variables in the address\n              parameter, see section 2.3 about environment variables.\n\n    <port>    is an optional port. it is normally not needed but may be useful\n              in some very specific contexts. the default value of zero means\n              the system will select a free port. note that port ranges are not\n              supported in the backend. if you want to force port ranges, you\n              have to specify them on each \"server\" line.\n\n    <addr2>   is the ip address to present to the server when connections are\n              forwarded in full transparent proxy mode. this is currently only\n              supported on some patched linux kernels. when this address is\n              specified, clients connecting to the server will be presented\n              with this address, while health checks will still use the address\n              <addr>.\n\n    <port2>   is the optional port to present to the server when connections\n              are forwarded in full transparent proxy mode (see <addr2> above).\n              the default value of zero means the system will select a free\n              port.\n\n    <hdr>     is the name of a http header in which to fetch the ip to bind to.\n              this is the name of a comma-separated header list which can\n              contain multiple ip addresses. by default, the last occurrence is\n              used. this is designed to work with the x-forwarded-for header\n              and to automatically bind to the client's ip address as seen\n              by previous proxy, typically stunnel. in order to use another\n              occurrence from the last one, please see the <occ> parameter\n              below. when the header (or occurrence) is not found, no binding\n              is performed so that the proxy's default ip address is used. also\n              keep in mind that the header name is case insensitive, as for any\n              http header.\n\n    <occ>     is the occurrence number of a value to be used in a multi-value\n              header. this is to be used in conjunction with \"hdr_ip(<hdr>)\",\n              in order to specify which occurrence to use for the source ip\n              address. positive values indicate a position from the first\n              occurrence, 1 being the first one. negative values indicate\n              positions relative to the last one, -1 being the last one. this\n              is helpful for situations where an x-forwarded-for header is set\n              at the entry point of an infrastructure and must be used several\n              proxy layers away. when this value is not specified, -1 is\n              assumed. passing a zero here disables the feature.\n\n    <name>    is an optional interface name to which to bind to for outgoing\n              traffic. on systems supporting this features (currently, only\n              linux), this allows one to bind all traffic to the server to\n              this interface even if it is not the one the system would select\n              based on routing tables. this should be used with extreme care.\n              note that using this option requires root privileges.\n\n  the \"source\" keyword is useful in complex environments where a specific\n  address only is allowed to connect to the servers. it may be needed when a\n  private address must be used through a public gateway for instance, and it is\n  known that the system cannot determine the adequate source address by itself.\n\n  an extension which is available on certain patched linux kernels may be used\n  through the \"usesrc\" optional keyword. it makes it possible to connect to the\n  servers with an ip address which does not belong to the system itself. this\n  is called \"full transparent proxy mode\". for this to work, the destination\n  servers have to route their traffic back to this address through the machine\n  running haproxy, and ip forwarding must generally be enabled on this machine.\n\n  in this \"full transparent proxy\" mode, it is possible to force a specific ip\n  address to be presented to the servers. this is not much used in fact. a more\n  common use is to tell haproxy to present the client's ip address. for this,\n  there are two methods :\n\n    - present the client's ip and port addresses. this is the most transparent\n      mode, but it can cause problems when ip connection tracking is enabled on\n      the machine, because a same connection may be seen twice with different\n      states. however, this solution presents the huge advantage of not\n      limiting the system to the 64k outgoing address+port couples, because all\n      of the client ranges may be used.\n\n    - present only the client's ip address and select a spare port. this\n      solution is still quite elegant but slightly less transparent (downstream\n      firewalls logs will not match upstream's). it also presents the downside\n      of limiting the number of concurrent connections to the usual 64k ports.\n      however, since the upstream and downstream ports are different, local ip\n      connection tracking on the machine will not be upset by the reuse of the\n      same session.\n\n  note that depending on the transparent proxy technology used, it may be\n  required to force the source address. in fact, cttproxy version 2 requires an\n  ip address in <addr> above, and does not support setting of \"0.0.0.0\" as the\n  ip address because it creates nat entries which much match the exact outgoing\n  address. tproxy version 4 and some other kernel patches which work in pure\n  forwarding mode generally will not have this limitation.\n\n  this option sets the default source for all servers in the backend. it may\n  also be specified in a \"defaults\" section. finer source address specification\n  is possible at the server level using the \"source\" server option. refer to\n  section 5 for more information.\n\n  in order to work, \"usesrc\" requires root privileges.\n\n  examples :\n        backend private\n            # connect to the servers using our 192.168.1.200 source address\n            source 192.168.1.200\n\n        backend transparent_ssl1\n            # connect to the ssl farm from the client's source address\n            source 192.168.1.200 usesrc clientip\n\n        backend transparent_ssl2\n            # connect to the ssl farm from the client's source address and port\n            # not recommended if ip conntrack is present on the local machine.\n            source 192.168.1.200 usesrc client\n\n        backend transparent_ssl3\n            # connect to the ssl farm from the client's source address. it\n            # is more conntrack-friendly.\n            source 192.168.1.200 usesrc clientip\n\n        backend transparent_smtp\n            # connect to the smtp farm from the client's source address/port\n            # with tproxy version 4.\n            source 0.0.0.0 usesrc clientip\n\n        backend transparent_http\n            # connect to the servers using the client's ip as seen by previous\n            # proxy.\n            source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)\n\n  see also : the \"source\" server option in section 5, the tproxy patches for\n             the linux kernel on www.balabit.com, the \"bind\" keyword.\n\nsrvtimeout <timeout> (deprecated)\n  set the maximum inactivity time on the server side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase of the server's response, when it has to send the\n  headers, as it directly represents the server's processing time for the\n  request. to find out what value to put there, it's often good to start with\n  what would be considered as unacceptable response times, then check the logs\n  to observe the response time distribution, and adjust the value accordingly.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. in tcp mode (and to a lesser extent, in http mode), it is highly\n  recommended that the client timeout remains equal to the server timeout in\n  order to avoid complex situations to debug. whatever the expected server\n  response times, it is a good practice to cover at least one or several tcp\n  packet losses by specifying timeouts that are slightly above multiples of 3\n  seconds (eg: 4 or 5 seconds minimum).\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter is provided for compatibility but is currently deprecated.\n  please use \"timeout server\" instead.\n\n  see also : \"timeout server\", \"timeout tunnel\", \"timeout client\" and\n             \"clitimeout\".\n\nstats admin { if | unless } <cond>\n  enable statistics admin level if/unless a condition is matched\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  this statement enables the statistics admin level if/unless a condition is\n  matched.\n\n  the admin level allows to enable/disable servers from the web interface. by\n  default, statistics page is read-only for security reasons.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  currently, the post request is limited to the buffer size minus the reserved\n  buffer space, which means that if the list of servers is too long, the\n  request won't be processed. it is recommended to alter few servers at a\n  time.\n\n  example :\n    # statistics admin level only for localhost\n    backend stats_localhost\n        stats enable\n        stats admin if localhost\n\n  example :\n    # statistics admin level always enabled because of the authentication\n    backend stats_auth\n        stats enable\n        stats auth  admin:admin123\n        stats admin if true\n\n  example :\n    # statistics admin level depends on the authenticated user\n    userlist stats-auth\n        group admin    users admin\n        user  admin    insecure-password admin123\n        group readonly users haproxy\n        user  haproxy  insecure-password haproxy\n\n    backend stats_auth\n        stats enable\n        acl auth       http_auth(stats-auth)\n        acl auth_admin http_auth_group(stats-auth) admin\n        stats http-request auth unless auth\n        stats admin if auth_admin\n\n  see also : \"stats enable\", \"stats auth\", \"stats http-request\", \"nbproc\",\n             \"bind-process\", section 3.4 about userlists and section 7 about\n             acl usage.\n\nstats auth <user>:<passwd>\n  enable statistics with authentication and grant access to an account\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <user>    is a user name to grant access to\n\n    <passwd>  is the cleartext password associated to this user\n\n  this statement enables statistics with default settings, and restricts access\n  to declared users only. it may be repeated as many times as necessary to\n  allow as many users as desired. when a user tries to access the statistics\n  without a valid account, a \"401 forbidden\" response will be returned so that\n  the browser asks the user to provide a valid user and password. the real\n  which will be returned to the browser is configurable using \"stats realm\".\n\n  since the authentication method is http basic authentication, the passwords\n  circulate in cleartext on the network. thus, it was decided that the\n  configuration file would also use cleartext passwords to remind the users\n  that those ones should not be sensitive and not shared with any other account.\n\n  it is also possible to reduce the scope of the proxies which appear in the\n  report using \"stats scope\".\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats enable\", \"stats realm\", \"stats scope\", \"stats uri\"\n\nstats enable\n  enable statistics reporting with default settings\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  this statement enables statistics reporting with default settings defined\n  at build time. unless stated otherwise, these settings are used :\n    - stats uri   : /haproxy?stats\n    - stats realm : \"haproxy statistics\"\n    - stats auth  : no authentication\n    - stats scope : no restriction\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats realm\", \"stats uri\"\n\nstats hide-version\n  enable statistics and hide haproxy version reporting\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  by default, the stats page reports some useful status information along with\n  the statistics. among them is haproxy's version. however, it is generally\n  considered dangerous to report precise version to anyone, as it can help them\n  target known weaknesses with specific attacks. the \"stats hide-version\"\n  statement removes the version from the statistics report. this is recommended\n  for public sites or any site with a weak login/password.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats http-request { allow | deny | auth [realm <realm>] }\n             [ { if | unless } <condition> ]\n  access control for statistics\n\n  may be used in sections:   defaults | frontend | listen | backend\n                                no    |    no    |   yes  |   yes\n\n  as \"http-request\", these set of options allow to fine control access to\n  statistics. each option may be followed by if/unless and acl.\n  first option with matched condition (or option without condition) is final.\n  for \"deny\" a 403 error will be returned, for \"allow\" normal processing is\n  performed, for \"auth\" a 401/407 error code is returned so the client\n  should be asked to enter a username and password.\n\n  there is no fixed limit to the number of http-request statements per\n  instance.\n\n  see also : \"http-request\", section 3.4 about userlists and section 7\n             about acl usage.\n\nstats realm <realm>\n  enable statistics and set authentication realm\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <realm>   is the name of the http basic authentication realm reported to\n              the browser. the browser uses it to display it in the pop-up\n              inviting the user to enter a valid username and password.\n\n  the realm is read as a single word, so any spaces in it should be escaped\n  using a backslash ('\\').\n\n  this statement is useful only in conjunction with \"stats auth\" since it is\n  only related to authentication.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats uri\"\n\nstats refresh <delay>\n  enable statistics with automatic refresh\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <delay>   is the suggested refresh delay, specified in seconds, which will\n              be returned to the browser consulting the report page. while the\n              browser is free to apply any delay, it will generally respect it\n              and refresh the page this every seconds. the refresh interval may\n              be specified in any other non-default time unit, by suffixing the\n              unit after the value, as explained at the top of this document.\n\n  this statement is useful on monitoring displays with a permanent page\n  reporting the load balancer's activity. when set, the html report page will\n  include a link \"refresh\"/\"stop refresh\" so that the user can select whether\n  he wants automatic refresh of the page or not.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats scope { <name> | \".\" }\n  enable statistics and limit access scope\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <name>    is the name of a listen, frontend or backend section to be\n              reported. the special name \".\" (a single dot) designates the\n              section in which the statement appears.\n\n  when this statement is specified, only the sections enumerated with this\n  statement will appear in the report. all other ones will be hidden. this\n  statement may appear as many times as needed if multiple sections need to be\n  reported. please note that the name checking is performed as simple string\n  comparisons, and that it is never checked that a give section name really\n  exists.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\", \"stats uri\"\n\nstats show-desc [ <desc> ]\n  enable reporting of a description on the statistics page.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n\n    <desc>    is an optional description to be reported. if unspecified, the\n              description from global section is automatically used instead.\n\n  this statement is useful for users that offer shared services to their\n  customers, where node or description should be different for each customer.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.  by default description is not shown.\n\n  example :\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats show-desc master node for europe, asia, africa\n        stats uri       /admin?stats\n        stats refresh   5s\n\n  see also: \"show-node\", \"stats enable\", \"stats uri\" and \"description\" in\n            global section.\n\nstats show-legends\n  enable reporting additional information on the statistics page\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments : none\n\n  enable reporting additional information on the statistics page :\n    - cap: capabilities (proxy)\n    - mode: one of tcp, http or health (proxy)\n    - id: snmp id (proxy, socket, server)\n    - ip (socket, server)\n    - cookie (backend, server)\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.  default behaviour is not to show this information.\n\n  see also: \"stats enable\", \"stats uri\".\n\nstats show-node [ <name> ]\n  enable reporting of a host name on the statistics page.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments:\n    <name>    is an optional name to be reported. if unspecified, the\n              node name from global section is automatically used instead.\n\n  this statement is useful for users that offer shared services to their\n  customers, where node or description might be different on a stats page\n  provided for each customer.  default behaviour is not to show host name.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example:\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats show-node europe-1\n        stats uri       /admin?stats\n        stats refresh   5s\n\n  see also: \"show-desc\", \"stats enable\", \"stats uri\", and \"node\" in global\n            section.\n\nstats uri <prefix>\n  enable statistics and define the uri prefix to access them\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <prefix>  is the prefix of any uri which will be redirected to stats. this\n              prefix may contain a question mark ('?') to indicate part of a\n              query string.\n\n  the statistics uri is intercepted on the relayed traffic, so it appears as a\n  page within the normal application. it is strongly advised to ensure that the\n  selected uri will never appear in the application, otherwise it will never be\n  possible to reach it in the application.\n\n  the default uri compiled in haproxy is \"/haproxy?stats\", but this may be\n  changed at build time, so it's better to always explicitly specify it here.\n  it is generally a good idea to include a question mark in the uri so that\n  intermediate proxies refrain from caching the results. also, since any string\n  beginning with the prefix will be accepted as a stats request, the question\n  mark helps ensuring that no valid uri will begin with the same words.\n\n  it is sometimes very convenient to use \"/\" as the uri prefix, and put that\n  statement in a \"listen\" instance of its own. that makes it easy to dedicate\n  an address or a port to statistics only.\n\n  though this statement alone is enough to enable statistics reporting, it is\n  recommended to set all other settings in order to avoid relying on default\n  unobvious parameters.\n\n  example :\n    # public access (limited to this backend only)\n    backend public_www\n        server srv1 192.168.0.1:80\n        stats enable\n        stats hide-version\n        stats scope   .\n        stats uri     /admin?stats\n        stats realm   haproxy\\ statistics\n        stats auth    admin1:admin123\n        stats auth    admin2:admin321\n\n    # internal monitoring access (unlimited)\n    backend private_monitoring\n        stats enable\n        stats uri     /admin?stats\n        stats refresh 5s\n\n  see also : \"stats auth\", \"stats enable\", \"stats realm\"\n\nstick match <pattern> [table <table>] [{if | unless} <cond>]\n  define a request pattern matching condition to stick a user to a server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the incoming request or connection\n               will be analysed in the hope to find a matching entry in a\n               stickiness table. this rule is mandatory.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional matching condition. it makes it possible to match\n               on a certain criterion only when other conditions are met (or\n               not met). for instance, it could be used to match on a source ip\n               address except when a request passes through a known proxy, in\n               which case we'd match on a header containing that ip address.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick match\" statement\n  describes a rule to extract the stickiness criterion from an incoming request\n  or connection. see section 7 for a complete list of possible patterns and\n  transformation rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick match\" statement\n  will apply, using \"if\" or \"unless\" followed by a condition. see section 7 for\n  acl based conditions.\n\n  there is no limit on the number of \"stick match\" statements. the first that\n  applies and matches will cause the request to be directed to the same server\n  as was used for the request which created the entry. that way, multiple\n  matches can be used as fallbacks.\n\n  the stick rules are checked after the persistence cookies, so they will not\n  affect stickiness if a cookie has already been used to select a server. that\n  way, it becomes very easy to insert cookies and match on ip addresses in\n  order to maintain stickiness between http and https.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n    # forward smtp users to the same server they just used for pop in the\n    # last 30 minutes\n    backend pop\n        mode tcp\n        balance roundrobin\n        stick store-request src\n        stick-table type ip size 200k expire 30m\n        server s1 192.168.1.1:110\n        server s2 192.168.1.1:110\n\n    backend smtp\n        mode tcp\n        balance roundrobin\n        stick match src table pop\n        server s1 192.168.1.1:25\n        server s2 192.168.1.1:25\n\n  see also : \"stick-table\", \"stick on\", \"nbproc\", \"bind-process\" and section 7\n             about acls and samples fetching.\n\nstick on <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern to associate a user to a server\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  note : this form is exactly equivalent to \"stick match\" followed by\n         \"stick store-request\", all with the same arguments. please refer\n         to both keywords for details. it is only provided as a convenience\n         for writing more maintainable configurations.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  examples :\n    # the following form ...\n    stick on src table pop if !localhost\n\n    # ...is strictly equivalent to this one :\n    stick match src table pop if !localhost\n    stick store-request src table pop if !localhost\n\n    # use cookie persistence for http, and stick on source address for https as\n    # well as http without cookie. share the same table between both accesses.\n    backend http\n        mode http\n        balance roundrobin\n        stick on src table https\n        cookie srv insert indirect nocache\n        server s1 192.168.1.1:80 cookie s1\n        server s2 192.168.1.1:80 cookie s2\n\n    backend https\n        mode tcp\n        balance roundrobin\n        stick-table type ip size 200k expire 30m\n        stick on src\n        server s1 192.168.1.1:443\n        server s2 192.168.1.1:443\n\n  see also : \"stick match\", \"stick store-request\", \"nbproc\" and \"bind-process\".\n\nstick store-request <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern used to create an entry in a stickiness table\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the incoming request or connection\n               will be analysed, extracted and stored in the table once a\n               server is selected.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional storage condition. it makes it possible to store\n               certain criteria only when some conditions are met (or not met).\n               for instance, it could be used to store the source ip address\n               except when the request passes through a known proxy, in which\n               case we'd store a converted form of a header containing that ip\n               address.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick store-request\" statement\n  describes a rule to decide what to extract from the request and when to do\n  it, in order to store it into a stickiness table for further requests to\n  match it using the \"stick match\" statement. obviously the extracted part must\n  make sense and have a chance to be matched in a further request. storing a\n  client's ip address for instance often makes sense. storing an id found in a\n  url parameter also makes sense. storing a source port will almost never make\n  any sense because it will be randomly matched. see section 7 for a complete\n  list of possible patterns and transformation rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick store-request\"\n  statement will apply, using \"if\" or \"unless\" followed by a condition. this\n  condition will be evaluated while parsing the request, so any criteria can be\n  used. see section 7 for acl based conditions.\n\n  there is no limit on the number of \"stick store-request\" statements, but\n  there is a limit of 8 simultaneous stores per request or response. this\n  makes it possible to store up to 8 criteria, all extracted from either the\n  request or the response, regardless of the number of rules. only the 8 first\n  ones which match will be kept. using this, it is possible to feed multiple\n  tables at once in the hope to increase the chance to recognize a user on\n  another protocol or access method. using multiple store-request rules with\n  the same table is possible and may be used to find the best criterion to rely\n  on, by arranging the rules by decreasing preference order. only the first\n  extracted criterion for a given table will be stored. all subsequent store-\n  request rules referencing the same table will be skipped and their acls will\n  not be evaluated.\n\n  the \"store-request\" rules are evaluated once the server connection has been\n  established, so that the table will contain the real server that processed\n  the request.\n\n  note : consider not using this feature in multi-process mode (nbproc > 1)\n         unless you know what you do : memory is not shared between the\n         processes, which can result in random behaviours.\n\n  example :\n    # forward smtp users to the same server they just used for pop in the\n    # last 30 minutes\n    backend pop\n        mode tcp\n        balance roundrobin\n        stick store-request src\n        stick-table type ip size 200k expire 30m\n        server s1 192.168.1.1:110\n        server s2 192.168.1.1:110\n\n    backend smtp\n        mode tcp\n        balance roundrobin\n        stick match src table pop\n        server s1 192.168.1.1:25\n        server s2 192.168.1.1:25\n\n  see also : \"stick-table\", \"stick on\", \"nbproc\", \"bind-process\" and section 7\n             about acls and sample fetching.\n\nstick-table type {ip | integer | string [len <length>] | binary [len <length>]}\n            size <size> [expire <expire>] [nopurge] [peers <peersect>]\n            [store <data_type>]*\n  configure the stickiness table for the current section\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n\n  arguments :\n    ip         a table declared with \"type ip\" will only store ipv4 addresses.\n               this form is very compact (about 50 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. this\n               is mainly used to store client source ip addresses.\n\n    ipv6       a table declared with \"type ipv6\" will only store ipv6 addresses.\n               this form is very compact (about 60 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. this\n               is mainly used to store client source ip addresses.\n\n    integer    a table declared with \"type integer\" will store 32bit integers\n               which can represent a client identifier found in a request for\n               instance.\n\n    string     a table declared with \"type string\" will store substrings of up\n               to <len> characters. if the string provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. during matching, at most <len> characters will be\n               compared between the string in the table and the extracted\n               pattern. when not specified, the string is automatically limited\n               to 32 characters.\n\n    binary     a table declared with \"type binary\" will store binary blocks\n               of <len> bytes. if the block provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. if the block provided by the sample expression\n               is shorter than <len>, it will be padded by 0\\. when not\n               specified, the block is automatically limited to 32 bytes.\n\n    <length>   is the maximum number of characters that will be stored in a\n               \"string\" type table (see type \"string\" above). or the number\n               of bytes of the block in \"binary\" type table. be careful when\n               changing this parameter as memory usage will proportionally\n               increase.\n\n    <size>     is the maximum number of entries that can fit in the table. this\n               value directly impacts memory usage. count approximately\n               50 bytes per entry, plus the size of a string if any. the size\n               supports suffixes \"k\", \"m\", \"g\" for 2^10, 2^20 and 2^30 factors.\n\n    [nopurge]  indicates that we refuse to purge older entries when the table\n               is full. when not specified and the table is full when haproxy\n               wants to store an entry in it, it will flush a few of the oldest\n               entries in order to release some space for the new ones. this is\n               most often the desired behaviour. in some specific cases, it\n               be desirable to refuse new entries instead of purging the older\n               ones. that may be the case when the amount of data to store is\n               far above the hardware limits and we prefer not to offer access\n               to new clients than to reject the ones already connected. when\n               using this parameter, be sure to properly set the \"expire\"\n               parameter (see below).\n\n    <peersect> is the name of the peers section to use for replication. entries\n               which associate keys to server ids are kept synchronized with\n               the remote peers declared in this section. all entries are also\n               automatically learned from the local peer (old process) during a\n               soft restart.\n\n               note : each peers section may be referenced only by tables\n                      belonging to the same unique process.\n\n    <expire>   defines the maximum duration of an entry in the table since it\n               was last created, refreshed or matched. the expiration delay is\n               defined using the standard time format, similarly as the various\n               timeouts. the maximum duration is slightly above 24 days. see\n               section 2.2 for more information. if this delay is not specified,\n               the session won't automatically expire, but older entries will\n               be removed once full. be sure not to use the \"nopurge\" parameter\n               if not expiration delay is specified.\n\n   <data_type> is used to store additional information in the stick-table. this\n               may be used by acls in order to control various criteria related\n               to the activity of the client matching the stick-table. for each\n               item specified here, the size of each entry will be inflated so\n               that the additional data can fit. several data types may be\n               stored with an entry. multiple data types may be specified after\n               the \"store\" keyword, as a comma-separated list. alternatively,\n               it is possible to repeat the \"store\" keyword followed by one or\n               several data types. except for the \"server_id\" type which is\n               automatically detected and enabled, all data types must be\n               explicitly declared to be stored. if an acl references a data\n               type which is not stored, the acl will simply not match. some\n               data types require an argument which must be passed just after\n               the type between parenthesis. see below for the supported data\n               types and their arguments.\n\n  the data types that can be stored with an entry are the following :\n    - server_id : this is an integer which holds the numeric id of the server a\n      request was assigned to. it is used by the \"stick match\", \"stick store\",\n      and \"stick on\" rules. it is automatically enabled when referenced.\n\n    - gpc0 : first general purpose counter. it is a positive 32-bit integer\n      integer which may be used for anything. most of the time it will be used\n      to put a special tag on some entries, for instance to note that a\n      specific behaviour was detected and must be known for future matches.\n\n    - gpc0_rate(<period>) : increment rate of the first general purpose counter\n      over a period. it is a positive 32-bit integer integer which may be used\n      for anything. just like <gpc0>, it counts events, but instead of keeping\n      a cumulative count, it maintains the rate at which the counter is\n      incremented. most of the time it will be used to measure the frequency of\n      occurrence of certain events (eg: requests to a specific url).\n\n    - conn_cnt : connection count. it is a positive 32-bit integer which counts\n      the absolute number of connections received from clients which matched\n      this entry. it does not mean the connections were accepted, just that\n      they were received.\n\n    - conn_cur : current connections. it is a positive 32-bit integer which\n      stores the concurrent connection counts for the entry. it is incremented\n      once an incoming connection matches the entry, and decremented once the\n      connection leaves. that way it is possible to know at any time the exact\n      number of concurrent connections for an entry.\n\n    - conn_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming connection rate over that period, in connections per period. the\n      result is an integer which can be matched using acls.\n\n    - sess_cnt : session count. it is a positive 32-bit integer which counts\n      the absolute number of sessions received from clients which matched this\n      entry. a session is a connection that was accepted by the layer 4 rules.\n\n    - sess_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming session rate over that period, in sessions per period. the\n      result is an integer which can be matched using acls.\n\n    - http_req_cnt : http request count. it is a positive 32-bit integer which\n      counts the absolute number of http requests received from clients which\n      matched this entry. it does not matter whether they are valid requests or\n      not. note that this is different from sessions when keep-alive is used on\n      the client side.\n\n    - http_req_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      http request rate over that period, in requests per period. the result is\n      an integer which can be matched using acls. it does not matter whether\n      they are valid requests or not. note that this is different from sessions\n      when keep-alive is used on the client side.\n\n    - http_err_cnt : http error count. it is a positive 32-bit integer which\n      counts the absolute number of http requests errors induced by clients\n      which matched this entry. errors are counted on invalid and truncated\n      requests, as well as on denied or tarpitted requests, and on failed\n      authentications. if the server responds with 4xx, then the request is\n      also counted as an error since it's an error triggered by the client\n      (eg: vulnerability scan).\n\n    - http_err_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      http request error rate over that period, in requests per period (see\n      http_err_cnt above for what is accounted as an error). the result is an\n      integer which can be matched using acls.\n\n    - bytes_in_cnt : client to server byte count. it is a positive 64-bit\n      integer which counts the cumulated amount of bytes received from clients\n      which matched this entry. headers are included in the count. this may be\n      used to limit abuse of upload features on photo or video servers.\n\n    - bytes_in_rate(<period>) : frequency counter (takes 12 bytes). it takes an\n      integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      incoming bytes rate over that period, in bytes per period. it may be used\n      to detect users which upload too much and too fast. warning: with large\n      uploads, it is possible that the amount of uploaded data will be counted\n      once upon termination, thus causing spikes in the average transfer speed\n      instead of having a smooth one. this may partially be smoothed with\n      \"option contstats\" though this is not perfect yet. use of byte_in_cnt is\n      recommended for better fairness.\n\n    - bytes_out_cnt : server to client byte count. it is a positive 64-bit\n      integer which counts the cumulated amount of bytes sent to clients which\n      matched this entry. headers are included in the count. this may be used\n      to limit abuse of bots sucking the whole site.\n\n    - bytes_out_rate(<period>) : frequency counter (takes 12 bytes). it takes\n      an integer parameter <period> which indicates in milliseconds the length\n      of the period over which the average is measured. it reports the average\n      outgoing bytes rate over that period, in bytes per period. it may be used\n      to detect users which download too much and too fast. warning: with large\n      transfers, it is possible that the amount of transferred data will be\n      counted once upon termination, thus causing spikes in the average\n      transfer speed instead of having a smooth one. this may partially be\n      smoothed with \"option contstats\" though this is not perfect yet. use of\n      byte_out_cnt is recommended for better fairness.\n\n  there is only one stick-table per proxy. at the moment of writing this doc,\n  it does not seem useful to have multiple tables per proxy. if this happens\n  to be required, simply create a dummy backend with a stick-table in it and\n  reference it.\n\n  it is important to understand that stickiness based on learning information\n  has some limitations, including the fact that all learned associations are\n  lost upon restart. in general it can be good as a complement but not always\n  as an exclusive stickiness.\n\n  last, memory requirements may be important when storing many data types.\n  indeed, storing all indicators above at once in each entry requires 116 bytes\n  per entry, or 116 mb for a 1-million entries table. this is definitely not\n  something that can be ignored.\n\n  example:\n        # keep track of counters of up to 1 million ip addresses over 5 minutes\n        # and store a general purpose counter and the average connection rate\n        # computed over a sliding window of 30 seconds.\n        stick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)\n\n  see also : \"stick match\", \"stick on\", \"stick store-request\", section 2.2\n             about time format and section 7 about acls.\n\nstick store-response <pattern> [table <table>] [{if | unless} <condition>]\n  define a request pattern used to create an entry in a stickiness table\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n\n  arguments :\n    <pattern>  is a sample expression rule as described in section 7.3\\. it\n               describes what elements of the response or connection will\n               be analysed, extracted and stored in the table once a\n               server is selected.\n\n    <table>    is an optional stickiness table name. if unspecified, the same\n               backend's table is used. a stickiness table is declared using\n               the \"stick-table\" statement.\n\n    <cond>     is an optional storage condition. it makes it possible to store\n               certain criteria only when some conditions are met (or not met).\n               for instance, it could be used to store the ssl session id only\n               when the response is a ssl server hello.\n\n  some protocols or applications require complex stickiness rules and cannot\n  always simply rely on cookies nor hashing. the \"stick store-response\"\n  statement  describes a rule to decide what to extract from the response and\n  when to do it, in order to store it into a stickiness table for further\n  requests to match it using the \"stick match\" statement. obviously the\n  extracted part must make sense and have a chance to be matched in a further\n  request. storing an id found in a header of a response makes sense.\n  see section 7 for a complete list of possible patterns and transformation\n  rules.\n\n  the table has to be declared using the \"stick-table\" statement. it must be of\n  a type compatible with the pattern. by default it is the one which is present\n  in the same backend. it is possible to share a table with other backends by\n  referencing it using the \"table\" keyword. if another table is referenced,\n  the server's id inside the backends are used. by default, all server ids\n  start at 1 in each backend, so the server ordering is enough. but in case of\n  doubt, it is highly recommended to force server ids using their \"id\" setting.\n\n  it is possible to restrict the conditions where a \"stick store-response\"\n  statement will apply, using \"if\" or \"unless\" followed by a condition. this\n  condition will be evaluated while parsing the response, so any criteria can\n  be used. see section 7 for acl based conditions.\n\n  there is no limit on the number of \"stick store-response\" statements, but\n  there is a limit of 8 simultaneous stores per request or response. this\n  makes it possible to store up to 8 criteria, all extracted from either the\n  request or the response, regardless of the number of rules. only the 8 first\n  ones which match will be kept. using this, it is possible to feed multiple\n  tables at once in the hope to increase the chance to recognize a user on\n  another protocol or access method. using multiple store-response rules with\n  the same table is possible and may be used to find the best criterion to rely\n  on, by arranging the rules by decreasing preference order. only the first\n  extracted criterion for a given table will be stored. all subsequent store-\n  response rules referencing the same table will be skipped and their acls will\n  not be evaluated. however, even if a store-request rule references a table, a\n  store-response rule may also use the same table. this means that each table\n  may learn exactly one element from the request and one element from the\n  response at once.\n\n  the table will contain the real server that processed the request.\n\n  example :\n    # learn ssl session id from both request and response and create affinity.\n    backend https\n        mode tcp\n        balance roundrobin\n        # maximum ssl session id length is 32 bytes.\n        stick-table type binary len 32 size 30k expire 30m\n\n        acl clienthello req_ssl_hello_type 1\n        acl serverhello rep_ssl_hello_type 2\n\n        # use tcp content accepts to detects ssl client and server hello.\n        tcp-request inspect-delay 5s\n        tcp-request content accept if clienthello\n\n        # no timeout on response inspect delay by default.\n        tcp-response content accept if serverhello\n\n        # ssl session id (sslid) may be present on a client or server hello.\n        # its length is coded on 1 byte at offset 43 and its value starts\n        # at offset 44.\n\n        # match and learn on request if client hello.\n        stick on payload_lv(43,1) if clienthello\n\n        # learn on response if server hello.\n        stick store-response payload_lv(43,1) if serverhello\n\n        server s1 192.168.1.1:443\n        server s2 192.168.1.1:443\n\n  see also : \"stick-table\", \"stick on\", and section 7 about acls and pattern\n             extraction.\n\ntcp-check connect [params*]\n  opens a new connection\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n  when an application lies on more than a single tcp port or when haproxy\n  load-balance many services in a single backend, it makes sense to probe all\n  the services individually before considering a server as operational.\n\n  when there are no tcp port configured on the server line neither server port\n  directive, then the 'tcp-check connect port <port>' must be the first step\n  of the sequence.\n\n  in a tcp-check ruleset a 'connect' is required, it is also mandatory to start\n  the ruleset with a 'connect' rule. purpose is to ensure admin know what they\n  do.\n\n  parameters :\n    they are optional and can be used to describe how haproxy should open and\n    use the tcp connection.\n\n    port      if not set, check port or server port is used.\n              it tells haproxy where to open the connection to.\n              <port> must be a valid tcp port source integer, from 1 to 65535.\n\n    send-proxy   send a proxy protocol string\n\n    ssl          opens a ciphered connection\n\n    examples:\n         # check http and https services on a server.\n         # first open port 80 thanks to server line port directive, then\n         # tcp-check opens port 443, ciphered and run a request on it:\n         option tcp-check\n         tcp-check connect\n         tcp-check send get\\ /\\ http/1.0\\r\\n\n         tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring (2..|3..)\n         tcp-check connect port 443 ssl\n         tcp-check send get\\ /\\ http/1.0\\r\\n\n         tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n         tcp-check send \\r\\n\n         tcp-check expect rstring (2..|3..)\n         server www 10.0.0.1 check port 80\n\n         # check both pop and imap from a single server:\n         option tcp-check\n         tcp-check connect port 110\n         tcp-check expect string +ok\\ pop3\\ ready\n         tcp-check connect port 143\n         tcp-check expect string *\\ ok\\ imap4\\ ready\n         server mail 10.0.0.1 check\n\n  see also : \"option tcp-check\", \"tcp-check send\", \"tcp-check expect\"\n\ntcp-check expect [!] <match> <pattern>\n  specify data to be collected and analysed during a generic health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n  arguments :\n    <match>   is a keyword indicating how to look for a specific pattern in the\n              response. the keyword may be one of \"string\", \"rstring\" or\n              binary.\n              the keyword may be preceded by an exclamation mark (\"!\") to negate\n              the match. spaces are allowed between the exclamation mark and the\n              keyword. see below for more details on the supported keywords.\n\n    <pattern> is the pattern to look for. it may be a string or a regular\n              expression. if the pattern contains spaces, they must be escaped\n              with the usual backslash ('\\').\n              if the match is set to binary, then the pattern must be passed as\n              a serie of hexadecimal digits in an even number. each sequence of\n              two digits will represent a byte. the hexadecimal digits may be\n              used upper or lower case.\n\n  the available matches are intentionally similar to their http-check cousins :\n\n    string <string> : test the exact string matches in the response buffer.\n                      a health check response will be considered valid if the\n                      response's buffer contains this exact string. if the\n                      \"string\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body contains this\n                      string. this can be used to look for a mandatory pattern\n                      in a protocol response, or to detect a failure when a\n                      specific error appears in a protocol banner.\n\n    rstring <regex> : test a regular expression on the response buffer.\n                      a health check response will be considered valid if the\n                      response's buffer matches this expression. if the\n                      \"rstring\" keyword is prefixed with \"!\", then the response\n                      will be considered invalid if the body matches the\n                      expression.\n\n    binary <hexstring> : test the exact string in its hexadecimal form matches\n                         in the response buffer. a health check response will\n                         be considered valid if the response's buffer contains\n                         this exact hexadecimal string.\n                         purpose is to match data on binary protocols.\n\n  it is important to note that the responses will be limited to a certain size\n  defined by the global \"tune.chksize\" option, which defaults to 16384 bytes.\n  thus, too large responses may not contain the mandatory pattern when using\n  \"string\", \"rstring\" or binary. if a large response is absolutely required, it\n  is possible to change the default max size by setting the global variable.\n  however, it is worth keeping in mind that parsing very large responses can\n  waste some cpu cycles, especially when regular expressions are used, and that\n  it is always better to focus the checks on smaller resources. also, in its\n  current state, the check will not find any string nor regex past a null\n  character in the response. similarly it is not possible to request matching\n  the null character.\n\n  examples :\n         # perform a pop check\n         option tcp-check\n         tcp-check expect string +ok\\ pop3\\ ready\n\n         # perform an imap check\n         option tcp-check\n         tcp-check expect string *\\ ok\\ imap4\\ ready\n\n         # look for the redis master server\n         option tcp-check\n         tcp-check send ping\\r\\n\n         tcp-check expect +pong\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n         tcp-check send quit\\r\\n\n         tcp-check expect string +ok\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check send\",\n             \"tcp-check send-binary\", \"http-check expect\", tune.chksize\n\ntcp-check send <data>\n  specify a string to be sent as a question during a generic health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n    <data> : the data to be sent as a question during a generic health check\n             session. for now, <data> must be a string.\n\n  examples :\n         # look for the redis master server\n         option tcp-check\n         tcp-check send info\\ replication\\r\\n\n         tcp-check expect string role:master\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check expect\",\n             \"tcp-check send-binary\", tune.chksize\n\ntcp-check send-binary <hexastring>\n  specify an hexa digits string to be sent as a binary question during a raw\n  tcp health check\n  may be used in sections:   defaults | frontend | listen | backend\n                               no     |    no    |   yes  |   yes\n\n    <data> : the data to be sent as a question during a generic health check\n             session. for now, <data> must be a string.\n    <hexastring> : test the exact string in its hexadecimal form matches in the\n                   response buffer. a health check response will be considered\n                   valid if the response's buffer contains this exact\n                   hexadecimal string.\n                   purpose is to send binary data to ask on binary protocols.\n\n  examples :\n         # redis check in binary\n         option tcp-check\n         tcp-check send-binary 50494e470d0a # ping\\r\\n\n         tcp-check expect binary 2b504f4e47 # +pong\n\n  see also : \"option tcp-check\", \"tcp-check connect\", \"tcp-check expect\",\n             \"tcp-check send\", tune.chksize\n\ntcp-request connection <action> [{if | unless} <condition>]\n  perform an action on an incoming connection depending on a layer 4 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   no\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"reject\", \"track-sc0\", \"track-sc1\",\n                \"track-sc2\", and \"expect-proxy\". see below for more details.\n\n    <condition> is a standard layer4-only acl-based condition (see section 7).\n\n  immediately after acceptance of a new incoming connection, it is possible to\n  evaluate some conditions to decide whether this connection must be accepted\n  or dropped or have its counters tracked. those conditions cannot make use of\n  any data contents because the connection has not been read from yet, and the\n  buffers are not yet allocated. this is used to selectively and very quickly\n  accept or drop connections from various sources with a very low overhead. if\n  some contents need to be inspected in order to take the decision, the\n  \"tcp-request content\" statements must be used instead.\n\n  the \"tcp-request connection\" rules are evaluated in their exact declaration\n  order. if no rule matches or if there is no rule, the default action is to\n  accept the incoming connection. there is no specific limit to the number of\n  rules which may be inserted.\n\n  four types of actions are supported :\n    - accept :\n        accepts the connection if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation.\n\n    - reject :\n        rejects the connection if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation. rejected connections do not even become a\n        session, which is why they are accounted separately for in the stats,\n        as \"denied connections\". they are not considered for the session\n        rate-limit and are not logged either. the reason is that these rules\n        should only be used to filter extremely high connection rates such as\n        the ones encountered during a massive ddos attack. under these extreme\n        conditions, the simple action of logging each event would make the\n        system collapse and would considerably lower the filtering capacity. if\n        logging is absolutely desired, then \"tcp-request content\" rules should\n        be used instead.\n\n    - expect-proxy layer4 :\n        configures the client-facing connection to receive a proxy protocol\n        header before any byte is read from the socket. this is equivalent to\n        having the \"accept-proxy\" keyword on the \"bind\" line, except that using\n        the tcp rule allows the proxy protocol to be accepted only for certain\n        ip address ranges using an acl. this is convenient when multiple layers\n        of load balancers are passed through by traffic coming from public\n        hosts.\n\n    - capture <sample> len <length> :\n        this only applies to \"tcp-request content\" rules. it captures sample\n        expression <sample> from the request buffer, and converts it to a\n        string of at most <len> characters. the resulting string is stored into\n        the next request \"capture\" slot, so it will possibly appear next to\n        some captured http headers. it will then automatically appear in the\n        logs, and it will be possible to extract it using sample fetch rules to\n        feed it into headers or anything. the length should be limited given\n        that this size will be allocated for each capture during the whole\n        session life. please check section 7.3 (fetching samples) and \"capture\n        request header\" for more information.\n\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] :\n        enables tracking of sticky counters from current connection. these\n        rules do not stop evaluation and do not change default action. 3 sets\n        of counters may be simultaneously tracked by the same connection. the\n        first \"track-sc0\" rule executed enables tracking of the counters of the\n        specified table as the first set. the first \"track-sc1\" rule executed\n        enables tracking of the counters of the specified table as the second\n        set. the first \"track-sc2\" rule executed enables tracking of the\n        counters of the specified table as the third set. it is a recommended\n        practice to use the first set of counters for the per-frontend counters\n        and the second set for the per-backend ones. but this is just a\n        guideline, all may be used everywhere.\n\n        these actions take one or two arguments :\n          <key>   is mandatory, and is a sample expression rule as described\n                  in section 7.3\\. it describes what elements of the incoming\n                  request or connection will be analysed, extracted, combined,\n                  and used to select which table entry to update the counters.\n                  note that \"tcp-request connection\" cannot use content-based\n                  fetches.\n\n         <table>  is an optional table to be used instead of the default one,\n                  which is the stick-table declared in the current proxy. all\n                  the counters for the matches and updates for the key will\n                  then be performed in that table until the session ends.\n\n        once a \"track-sc*\" rule is executed, the key is looked up in the table\n        and if it is not found, an entry is allocated for it. then a pointer to\n        that entry is kept during all the session's life, and this entry's\n        counters are updated as often as possible, every time the session's\n        counters are updated, and also systematically when the session ends.\n        counters are only updated for events that happen after the tracking has\n        been started. for example, connection counters will not be updated when\n        tracking layer 7 information, since the connection event happens before\n        layer7 information is extracted.\n\n        if the entry tracks concurrent connection counters, one connection is\n        counted for as long as the entry is tracked, and the entry will not\n        expire during that time. tracking counters also provides a performance\n        advantage over just checking the keys, because only one table lookup is\n        performed for all acl checks that make use of it.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  \"track-sc*\" actions as well as for changing the default action to a reject.\n\n  example: accept all connections from white-listed hosts, reject too fast\n           connection without counting them, and track accepted connections.\n           this results in connection rate being capped from abusive sources.\n\n        tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\n        tcp-request connection reject if { src_conn_rate gt 10 }\n        tcp-request connection track-sc0 src\n\n  example: accept all connections from white-listed hosts, count all other\n           connections and reject too fast ones. this results in abusive ones\n           being blocked as long as they don't slow down.\n\n        tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\n        tcp-request connection track-sc0 src\n        tcp-request connection reject if { sc0_conn_rate gt 10 }\n\n  example: enable the proxy protocol for traffic coming from all known proxies.\n\n        tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request content\", \"stick-table\"\n\ntcp-request content <action> [{if | unless} <condition>]\n  perform an action on a new session depending on a layer 4-7 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"reject\", \"track-sc0\", \"track-sc1\",\n                \"track-sc2\", \"capture\" and \"lua\". see \"tcp-request connection\"\n                above for their signification.\n\n    <condition> is a standard layer 4-7 acl-based condition (see section 7).\n\n  a request's contents can be analysed at an early stage of request processing\n  called \"tcp content inspection\". during this stage, acl-based rules are\n  evaluated every time the request contents are updated, until either an\n  \"accept\" or a \"reject\" rule matches, or the tcp request inspection delay\n  expires with no matching rule.\n\n  the first difference between these rules and \"tcp-request connection\" rules\n  is that \"tcp-request content\" rules can make use of contents to take a\n  decision. most often, these decisions will consider a protocol recognition or\n  validity. the second difference is that content-based rules can be used in\n  both frontends and backends. in case of http keep-alive with the client, all\n  tcp-request content rules are evaluated again, so haproxy keeps a record of\n  what sticky counters were assigned by a \"tcp-request connection\" versus a\n  \"tcp-request content\" rule, and flushes all the content-related ones after\n  processing an http request, so that they may be evaluated again by the rules\n  being evaluated again for the next request. this is of particular importance\n  when the rule tracks some l7 information or when it is conditioned by an\n  l7-based acl, since tracking may change between requests.\n\n  content-based rules are evaluated in their exact declaration order. if no\n  rule matches or if there is no rule, the default action is to accept the\n  contents. there is no specific limit to the number of rules which may be\n  inserted.\n\n  four types of actions are supported :\n    - accept : the request is accepted\n    - reject : the request is rejected and the connection is closed\n    - capture : the specified sample expression is captured\n    - { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>]\n    - lua <function>\n    - set-var(<var-name>) <expr>\n\n  they have the same meaning as their counter-parts in \"tcp-request connection\"\n  so please refer to that section for a complete description.\n\n  while there is nothing mandatory about it, it is recommended to use the\n  track-sc0 in \"tcp-request connection\" rules, track-sc1 for \"tcp-request\n  content\" rules in the frontend, and track-sc2 for \"tcp-request content\"\n  rules in the backend, because that makes the configuration more readable\n  and easier to troubleshoot, but this is just a guideline and all counters\n  may be used everywhere.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  \"track-sc*\" actions as well as for changing the default action to a reject.\n\n  it is perfectly possible to match layer 7 contents with \"tcp-request content\"\n  rules, since http-specific acl matches are able to preliminarily parse the\n  contents of a buffer before extracting the required data. if the buffered\n  contents do not parse as a valid http message, then the acl does not match.\n  the parser which is involved there is exactly the same as for all other http\n  processing, so there is no risk of parsing something differently. in an http\n  backend connected to from an http frontend, it is guaranteed that http\n  contents will always be immediately present when the rule is evaluated first.\n\n  tracking layer7 information is also possible provided that the information\n  are present when the rule is processed. the rule processing engine is able to\n  wait until the inspect delay expires when the data to be tracked is not yet\n  available.\n\n  the \"lua\" keyword is followed by a lua function name. it is used to run a lua\n  function if the action is executed. the single parameter is the name of the\n  function to run. the prototype of the function is documented in the api\n  documentation.\n\n  the \"set-var\" is used to set the content of a variable. the variable is\n  declared inline.\n\n    <var-name> the name of the variable starts by an indication about its scope.\n               the allowed scopes are:\n                 \"sess\" : the variable is shared with all the session,\n                 \"txn\"  : the variable is shared with all the transaction\n                          (request and response)\n                 \"req\"  : the variable is shared only during the request\n                          processing\n                 \"res\"  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a '.'.\n               the name may only contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n    <expr>     is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n        tcp-request content set-var(sess.my_var) src\n\n  example:\n        # accept http requests containing a host header saying \"example.com\"\n        # and reject everything else.\n        acl is_host_com hdr(host) -i example.com\n        tcp-request inspect-delay 30s\n        tcp-request content accept if is_host_com\n        tcp-request content reject\n\n  example:\n        # reject smtp connection if client speaks first\n        tcp-request inspect-delay 30s\n        acl content_present req_len gt 0\n        tcp-request content reject if content_present\n\n        # forward https connection only if client speaks\n        tcp-request inspect-delay 30s\n        acl content_present req_len gt 0\n        tcp-request content accept if content_present\n        tcp-request content reject\n\n  example:\n        # track the last ip from x-forwarded-for\n        tcp-request inspect-delay 10s\n        tcp-request content track-sc0 hdr(x-forwarded-for,-1)\n\n  example:\n        # track request counts per \"base\" (concatenation of host+url)\n        tcp-request inspect-delay 10s\n        tcp-request content track-sc0 base table req-rate\n\n  example: track per-frontend and per-backend counters, block abusers at the\n           frontend when the backend detects abuse.\n\n        frontend http\n            # use general purpose couter 0 in sc0 as a global abuse counter\n            # protecting all our sites\n            stick-table type ip size 1m expire 5m store gpc0\n            tcp-request connection track-sc0 src\n            tcp-request connection reject if { sc0_get_gpc0 gt 0 }\n            ...\n            use_backend http_dynamic if { path_end .php }\n\n        backend http_dynamic\n            # if a source makes too fast requests to this dynamic site (tracked\n            # by sc1), block it globally in the frontend.\n            stick-table type ip size 1m expire 5m store http_req_rate(10s)\n            acl click_too_fast sc1_http_req_rate gt 10\n            acl mark_as_abuser sc0_inc_gpc0 gt 0\n            tcp-request content track-sc1 src\n            tcp-request content reject if click_too_fast mark_as_abuser\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request connection\", \"tcp-request inspect-delay\"\n\ntcp-request inspect-delay <timeout>\n  set the maximum allowed time to wait for data during content inspection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  people using haproxy primarily as a tcp relay are often worried about the\n  risk of passing any type of protocol to a server without any analysis. in\n  order to be able to analyze the request contents, we must first withhold\n  the data then analyze them. this statement simply enables withholding of\n  data for at most the specified amount of time.\n\n  tcp content inspection applies very early when a connection reaches a\n  frontend, then very early when the connection is forwarded to a backend. this\n  means that a connection may experience a first delay in the frontend and a\n  second delay in the backend if both have tcp-request rules.\n\n  note that when performing content inspection, haproxy will evaluate the whole\n  rules for every new chunk which gets in, taking into account the fact that\n  those data are partial. if no rule matches before the aforementioned delay,\n  a last check is performed upon expiration, this time considering that the\n  contents are definitive. if no delay is set, haproxy will not wait at all\n  and will immediately apply a verdict based on the available information.\n  obviously this is unlikely to be very useful and might even be racy, so such\n  setups are not recommended.\n\n  as soon as a rule matches, the request is released and continues as usual. if\n  the timeout is reached and no rule matches, the default policy will be to let\n  it pass through unaffected.\n\n  for most protocols, it is enough to set it to a few seconds, as most clients\n  send the full request immediately upon connection. add 3 or more seconds to\n  cover tcp retransmits but that's all. for some protocols, it may make sense\n  to use large values, for instance to ensure that the client never talks\n  before the server (eg: smtp), or to wait for a client to talk before passing\n  data to the server (eg: ssl). note that the client timeout must cover at\n  least the inspection delay, otherwise it will expire first. if the client\n  closes the connection or if the buffer is full, the delay immediately expires\n  since the contents will not be able to change anymore.\n\n  see also : \"tcp-request content accept\", \"tcp-request content reject\",\n             \"timeout client\".\n\ntcp-response content <action> [{if | unless} <condition>]\n  perform an action on a session response depending on a layer 4-7 condition\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <action>    defines the action to perform if the condition applies. valid\n                actions include : \"accept\", \"close\", \"reject\", \"lua\".\n\n    <condition> is a standard layer 4-7 acl-based condition (see section 7).\n\n  response contents can be analysed at an early stage of response processing\n  called \"tcp content inspection\". during this stage, acl-based rules are\n  evaluated every time the response contents are updated, until either an\n  \"accept\", \"close\" or a \"reject\" rule matches, or a tcp response inspection\n  delay is set and expires with no matching rule.\n\n  most often, these decisions will consider a protocol recognition or validity.\n\n  content-based rules are evaluated in their exact declaration order. if no\n  rule matches or if there is no rule, the default action is to accept the\n  contents. there is no specific limit to the number of rules which may be\n  inserted.\n\n  two types of actions are supported :\n    - accept :\n        accepts the response if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation.\n\n    - close :\n        immediately closes the connection with the server if the condition is\n        true (when used with \"if\"), or false (when used with \"unless\"). the\n        first such rule executed ends the rules evaluation. the main purpose of\n        this action is to force a connection to be finished between a client\n        and a server after an exchange when the application protocol expects\n        some long time outs to elapse first. the goal is to eliminate idle\n        connections which take significant resources on servers with certain\n        protocols.\n\n    - reject :\n        rejects the response if the condition is true (when used with \"if\")\n        or false (when used with \"unless\"). the first such rule executed ends\n        the rules evaluation. rejected session are immediately closed.\n\n    - lua <function>\n        executes lua.\n\n    - set-var(<var-name>) <expr>\n        sets a variable.\n\n  note that the \"if/unless\" condition is optional. if no condition is set on\n  the action, it is simply performed unconditionally. that can be useful for\n  for changing the default action to a reject.\n\n  it is perfectly possible to match layer 7 contents with \"tcp-response\n  content\" rules, but then it is important to ensure that a full response has\n  been buffered, otherwise no contents will match. in order to achieve this,\n  the best solution involves detecting the http protocol during the inspection\n  period.\n\n  the \"lua\" keyword is followed by a lua function name. it is used to run a lua\n  function if the action is executed. the single parameter is the name of the\n  function to run. the prototype of the function is documented in the api\n  documentation.\n\n  the \"set-var\" is used to set the content of a variable. the variable is\n  declared inline.\n\n    <var-name> the name of the variable starts by an indication about its scope.\n               the allowed scopes are:\n                 \"sess\" : the variable is shared with all the session,\n                 \"txn\"  : the variable is shared with all the transaction\n                          (request and response)\n                 \"req\"  : the variable is shared only during the request\n                          processing\n                 \"res\"  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a '.'.\n               the name may only contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n    <expr>     is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n        tcp-request content set-var(sess.my_var) src\n\n  see section 7 about acl usage.\n\n  see also : \"tcp-request content\", \"tcp-response inspect-delay\"\n\ntcp-response inspect-delay <timeout>\n  set the maximum allowed time to wait for a response during content inspection\n  may be used in sections :   defaults | frontend | listen | backend\n                                 no    |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  see also : \"tcp-response content\", \"tcp-request inspect-delay\".\n\ntimeout check <timeout>\n  set additional check timeout, but only after a connection has been already\n  established.\n\n  may be used in sections:    defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments:\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if set, haproxy uses min(\"timeout connect\", \"inter\") as a connect timeout\n  for check and \"timeout check\" as an additional read timeout. the \"min\" is\n  used so that people running with *very* long \"timeout connect\" (eg. those\n  who needed this due to the queue or tarpit) do not slow down their checks.\n  (please also note that there is no valid reason to have such long connect\n  timeouts, because \"timeout queue\" and \"timeout tarpit\" can always be used to\n  avoid that).\n\n  if \"timeout check\" is not set haproxy uses \"inter\" for complete check\n  timeout (connect + read) exactly like all <1.3.15 version.\n\n  in most cases check request is much simpler and faster to handle than normal\n  requests and people may want to kick out laggy servers so this timeout should\n  be smaller than \"timeout server\".\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it.\n\n  see also: \"timeout connect\", \"timeout queue\", \"timeout server\",\n            \"timeout tarpit\".\n\ntimeout client <timeout>\ntimeout clitimeout <timeout> (deprecated)\n  set the maximum inactivity time on the client side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase, when the client sends the request, and during the\n  response while it is reading data sent by the server. the value is specified\n  in milliseconds by default, but can be in any other unit if the number is\n  suffixed by the unit, as specified at the top of this document. in tcp mode\n  (and to a lesser extent, in http mode), it is highly recommended that the\n  client timeout remains equal to the server timeout in order to avoid complex\n  situations to debug. it is a good practice to cover one or several tcp packet\n  losses by specifying timeouts that are slightly above multiples of 3 seconds\n  (eg: 4 or 5 seconds). if some long-lived sessions are mixed with short-lived\n  sessions (eg: websocket and http), it's worth considering \"timeout tunnel\",\n  which overrides \"timeout client\" and \"timeout server\" for tunnels, as well as\n  \"timeout client-fin\" for half-closed connections.\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"clitimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout clitimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also : \"clitimeout\", \"timeout server\", \"timeout tunnel\".\n\ntimeout client-fin <timeout>\n  set the inactivity timeout on the client side for half-closed connections.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   no\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the client is expected to acknowledge or\n  send data while one direction is already shut down. this timeout is different\n  from \"timeout client\" in that it only applies to connections which are closed\n  in one direction. this is particularly useful to avoid keeping connections in\n  fin_wait state for too long when clients do not disconnect cleanly. this\n  problem is particularly common long connections such as rdp or websocket.\n  note that this timeout can override \"timeout tunnel\" when a connection shuts\n  down in one direction.\n\n  this parameter is specific to frontends, but can be specified once for all in\n  \"defaults\" sections. by default it is not set, so half-closed connections\n  will use the other timeouts (timeout.client or timeout.tunnel).\n\n  see also : \"timeout client\", \"timeout server-fin\", and \"timeout tunnel\".\n\ntimeout connect <timeout>\ntimeout contimeout <timeout> (deprecated)\n  set the maximum time to wait for a connection attempt to a server to succeed.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  if the server is located on the same lan as haproxy, the connection should be\n  immediate (less than a few milliseconds). anyway, it is a good practice to\n  cover one or several tcp packet losses by specifying timeouts that are\n  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the\n  connect timeout also presets both queue and tarpit timeouts to the same value\n  if these have not been specified.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of failed sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"contimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout contimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also: \"timeout check\", \"timeout queue\", \"timeout server\", \"contimeout\",\n            \"timeout tarpit\".\n\ntimeout http-keep-alive <timeout>\n  set the maximum allowed time to wait for a new http request to appear\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  by default, the time to wait for a new request in case of keep-alive is set\n  by \"timeout http-request\". however this is not always convenient because some\n  people want very short keep-alive timeouts in order to release connections\n  faster, and others prefer to have larger ones but still have short timeouts\n  once the request has started to present itself.\n\n  the \"http-keep-alive\" timeout covers these needs. it will define how long to\n  wait for a new http request to start coming after a response was sent. once\n  the first byte of request has been seen, the \"http-request\" timeout is used\n  to wait for the complete request to come. note that empty lines prior to a\n  new request do not refresh the timeout and are not counted as a new request.\n\n  there is also another difference between the two timeouts : when a connection\n  expires during timeout http-keep-alive, no error is returned, the connection\n  just closes. if the connection expires in \"http-request\" while waiting for a\n  connection to complete, a http 408 error is returned.\n\n  in general it is optimal to set this value to a few tens to hundreds of\n  milliseconds, to allow users to fetch all objects of a page at once but\n  without waiting for further clicks. also, if set to a very small value (eg:\n  1 millisecond) it will probably only accept pipelined requests but not the\n  non-pipelined ones. it may be a nice trade-off for very large sites running\n  with tens to hundreds of thousands of clients.\n\n  if this parameter is not set, the \"http-request\" timeout applies, and if both\n  are not set, \"timeout client\" still applies at the lower level. it should be\n  set in the frontend to take effect, unless the frontend is in tcp mode, in\n  which case the http backend's timeout will be used.\n\n  see also : \"timeout http-request\", \"timeout client\".\n\ntimeout http-request <timeout>\n  set the maximum allowed time to wait for a complete http request\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  in order to offer dos protection, it may be required to lower the maximum\n  accepted time to receive a complete http request without affecting the client\n  timeout. this helps protecting against established connections on which\n  nothing is sent. the client timeout cannot offer a good protection against\n  this abuse because it is an inactivity timeout, which means that if the\n  attacker sends one character every now and then, the timeout will not\n  trigger. with the http request timeout, no matter what speed the client\n  types, the request will be aborted if it does not complete in time. when the\n  timeout expires, an http 408 response is sent to the client to inform it\n  about the problem, and the connection is closed. the logs will report\n  termination codes \"cr\". some recent browsers are having problems with this\n  standard, well-documented behaviour, so it might be needed to hide the 408\n  code using \"option http-ignore-probes\" or \"errorfile 408 /dev/null\". see\n  more details in the explanations of the \"cr\" termination code in section 8.5.\n\n  note that this timeout only applies to the header part of the request, and\n  not to any data. as soon as the empty line is received, this timeout is not\n  used anymore. it is used again on keep-alive connections to wait for a second\n  request if \"timeout http-keep-alive\" is not set.\n\n  generally it is enough to set it to a few seconds, as most clients send the\n  full request immediately upon connection. add 3 or more seconds to cover tcp\n  retransmits but that's all. setting it to very low values (eg: 50 ms) will\n  generally work on local networks as long as there are no packet losses. this\n  will prevent people from sending bare http requests using telnet.\n\n  if this parameter is not set, the client timeout still applies between each\n  chunk of the incoming request. it should be set in the frontend to take\n  effect, unless the frontend is in tcp mode, in which case the http backend's\n  timeout will be used.\n\n  see also : \"errorfile\", \"http-ignore-probes\", \"timeout http-keep-alive\", and\n             \"timeout client\".\n\ntimeout queue <timeout>\n  set the maximum time to wait in the queue for a connection slot to be free\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  when a server's maxconn is reached, connections are left pending in a queue\n  which may be server-specific or global to the backend. in order not to wait\n  indefinitely, a timeout is applied to requests pending in the queue. if the\n  timeout is reached, it is considered that the request will almost never be\n  served, so it is dropped and a 503 error is returned to the client.\n\n  the \"timeout queue\" statement allows to fix the maximum time for a request to\n  be left pending in a queue. if unspecified, the same value as the backend's\n  connection timeout (\"timeout connect\") is used, for backwards compatibility\n  with older versions with no \"timeout queue\" parameter.\n\n  see also : \"timeout connect\", \"contimeout\".\n\ntimeout server <timeout>\ntimeout srvtimeout <timeout> (deprecated)\n  set the maximum inactivity time on the server side.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data. in http mode, this timeout is particularly important to consider\n  during the first phase of the server's response, when it has to send the\n  headers, as it directly represents the server's processing time for the\n  request. to find out what value to put there, it's often good to start with\n  what would be considered as unacceptable response times, then check the logs\n  to observe the response time distribution, and adjust the value accordingly.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. in tcp mode (and to a lesser extent, in http mode), it is highly\n  recommended that the client timeout remains equal to the server timeout in\n  order to avoid complex situations to debug. whatever the expected server\n  response times, it is a good practice to cover at least one or several tcp\n  packet losses by specifying timeouts that are slightly above multiples of 3\n  seconds (eg: 4 or 5 seconds minimum). if some long-lived sessions are mixed\n  with short-lived sessions (eg: websocket and http), it's worth considering\n  \"timeout tunnel\", which overrides \"timeout client\" and \"timeout server\" for\n  tunnels.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it. an unspecified timeout results in an infinite timeout, which\n  is not recommended. such a usage is accepted and works but reports a warning\n  during startup because it may results in accumulation of expired sessions in\n  the system if the system's timeouts are not configured either.\n\n  this parameter replaces the old, deprecated \"srvtimeout\". it is recommended\n  to use it to write new configurations. the form \"timeout srvtimeout\" is\n  provided only by backwards compatibility but its use is strongly discouraged.\n\n  see also : \"srvtimeout\", \"timeout client\" and \"timeout tunnel\".\n\ntimeout server-fin <timeout>\n  set the inactivity timeout on the server side for half-closed connections.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the inactivity timeout applies when the server is expected to acknowledge or\n  send data while one direction is already shut down. this timeout is different\n  from \"timeout server\" in that it only applies to connections which are closed\n  in one direction. this is particularly useful to avoid keeping connections in\n  fin_wait state for too long when a remote server does not disconnect cleanly.\n  this problem is particularly common long connections such as rdp or websocket.\n  note that this timeout can override \"timeout tunnel\" when a connection shuts\n  down in one direction. this setting was provided for completeness, but in most\n  situations, it should not be needed.\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. by default it is not set, so half-closed connections\n  will use the other timeouts (timeout.server or timeout.tunnel).\n\n  see also : \"timeout client-fin\", \"timeout server\", and \"timeout tunnel\".\n\ntimeout tarpit <timeout>\n  set the duration for which tarpitted connections will be maintained\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    yes   |   yes  |   yes\n  arguments :\n    <timeout> is the tarpit duration specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  when a connection is tarpitted using \"reqtarpit\", it is maintained open with\n  no activity for a certain amount of time, then closed. \"timeout tarpit\"\n  defines how long it will be maintained open.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. if unspecified, the same value as the backend's connection timeout\n  (\"timeout connect\") is used, for backwards compatibility with older versions\n  with no \"timeout tarpit\" parameter.\n\n  see also : \"timeout connect\", \"contimeout\".\n\ntimeout tunnel <timeout>\n  set the maximum inactivity time on the client and server side for tunnels.\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments :\n    <timeout> is the timeout value specified in milliseconds by default, but\n              can be in any other unit if the number is suffixed by the unit,\n              as explained at the top of this document.\n\n  the tunnel timeout applies when a bidirectional connection is established\n  between a client and a server, and the connection remains inactive in both\n  directions. this timeout supersedes both the client and server timeouts once\n  the connection becomes a tunnel. in tcp, this timeout is used as soon as no\n  analyser remains attached to either connection (eg: tcp content rules are\n  accepted). in http, this timeout is used when a connection is upgraded (eg:\n  when switching to the websocket protocol, or forwarding a connect request\n  to a proxy), or after the first response when no keepalive/close option is\n  specified.\n\n  since this timeout is usually used in conjunction with long-lived connections,\n  it usually is a good idea to also set \"timeout client-fin\" to handle the\n  situation where a client suddenly disappears from the net and does not\n  acknowledge a close, or sends a shutdown and does not acknowledge pending\n  data anymore. this can happen in lossy networks where firewalls are present,\n  and is detected by the presence of large amounts of sessions in a fin_wait\n  state.\n\n  the value is specified in milliseconds by default, but can be in any other\n  unit if the number is suffixed by the unit, as specified at the top of this\n  document. whatever the expected normal idle time, it is a good practice to\n  cover at least one or several tcp packet losses by specifying timeouts that\n  are slightly above multiples of 3 seconds (eg: 4 or 5 seconds minimum).\n\n  this parameter is specific to backends, but can be specified once for all in\n  \"defaults\" sections. this is in fact one of the easiest solutions not to\n  forget about it.\n\n  example :\n        defaults http\n            option http-server-close\n            timeout connect 5s\n            timeout client 30s\n            timeout client-fin 30s\n            timeout server 30s\n            timeout tunnel  1h    # timeout to use with websocket and connect\n\n  see also : \"timeout client\", \"timeout client-fin\", \"timeout server\".\n\ntransparent (deprecated)\n  enable client-side transparent proxying\n  may be used in sections :   defaults | frontend | listen | backend\n                                 yes   |    no    |   yes  |   yes\n  arguments : none\n\n  this keyword was introduced in order to provide layer 7 persistence to layer\n  3 load balancers. the idea is to use the os's ability to redirect an incoming\n  connection for a remote address to a local process (here haproxy), and let\n  this process know what address was initially requested. when this option is\n  used, sessions without cookies will be forwarded to the original destination\n  ip address of the incoming request (which should match that of another\n  equipment), while requests with cookies will still be forwarded to the\n  appropriate server.\n\n  the \"transparent\" keyword is deprecated, use \"option transparent\" instead.\n\n  note that contrary to a common belief, this option does not make haproxy\n  present the client's ip to the server when establishing the connection.\n\n  see also: \"option transparent\"\n\nunique-id-format <string>\n  generate a unique id for each request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  yes  |    yes   |   yes  |   no\n  arguments :\n    <string>   is a log-format string.\n\n  this keyword creates a id for each request using the custom log format. a\n  unique id is useful to trace a request passing through many components of\n  a complex infrastructure. the newly created id may also be logged using the\n  %id tag the log-format string.\n\n  the format should be composed from elements that are guaranteed to be\n  unique when combined together. for instance, if multiple haproxy instances\n  are involved, it might be important to include the node name. it is often\n  needed to log the incoming connection's source and destination addresses\n  and ports. note that since multiple requests may be performed over the same\n  connection, including a request counter may help differentiate them.\n  similarly, a timestamp may protect against a rollover of the counter.\n  logging the process id will avoid collisions after a service restart.\n\n  it is recommended to use hexadecimal notation for many fields since it\n  makes them more compact and saves space in logs.\n\n  example:\n\n        unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n\n        will generate:\n\n               7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\n  see also: \"unique-id-header\"\n\nunique-id-header <name>\n  add a unique id header in the http request.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  yes  |    yes   |   yes  |   no\n  arguments :\n    <name>   is the name of the header.\n\n  add a unique-id header in the http request sent to the server, using the\n  unique-id-format. it can't work if the unique-id-format doesn't exist.\n\n  example:\n\n        unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n        unique-id-header x-unique-id\n\n        will generate:\n\n           x-unique-id: 7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\n    see also: \"unique-id-format\"\n\nuse_backend <backend> [{if | unless} <condition>]\n  switch to a specific backend if/unless an acl-based condition is matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    yes   |   yes  |   no\n  arguments :\n    <backend>   is the name of a valid backend or \"listen\" section, or a\n                \"log-format\" string resolving to a backend name.\n\n    <condition> is a condition composed of acls, as described in section 7\\. if\n                it is omitted, the rule is unconditionally applied.\n\n  when doing content-switching, connections arrive on a frontend and are then\n  dispatched to various backends depending on a number of conditions. the\n  relation between the conditions and the backends is described with the\n  \"use_backend\" keyword. while it is normally used with http processing, it can\n  also be used in pure tcp, either without content using stateless acls (eg:\n  source address validation) or combined with a \"tcp-request\" rule to wait for\n  some payload.\n\n  there may be as many \"use_backend\" rules as desired. all of these rules are\n  evaluated in their declaration order, and the first one which matches will\n  assign the backend.\n\n  in the first form, the backend will be used if the condition is met. in the\n  second form, the backend will be used if the condition is not met. if no\n  condition is valid, the backend defined with \"default_backend\" will be used.\n  if no default backend is defined, either the servers in the same section are\n  used (in case of a \"listen\" section) or, in case of a frontend, no server is\n  used and a 503 service unavailable response is returned.\n\n  note that it is possible to switch from a tcp frontend to an http backend. in\n  this case, either the frontend has already checked that the protocol is http,\n  and backend processing will immediately follow, or the backend will wait for\n  a complete http request to get in. this feature is useful when a frontend\n  must decode several protocols on a unique port, one of them being http.\n\n  when <backend> is a simple name, it is resolved at configuration time, and an\n  error is reported if the specified backend does not exist. if <backend> is\n  a log-format string instead, no check may be done at configuration time, so\n  the backend name is resolved dynamically at run time. if the resulting\n  backend name does not correspond to any valid backend, no other rule is\n  evaluated, and the default_backend directive is applied instead. note that\n  when using dynamic backend names, it is highly recommended to use a prefix\n  that no other backend uses in order to ensure that an unauthorized backend\n  cannot be forced from the request.\n\n  it is worth mentioning that \"use_backend\" rules with an explicit name are\n  used to detect the association between frontends and backends to compute the\n  backend's \"fullconn\" setting. this cannot be done for dynamic names.\n\n  see also: \"default_backend\", \"tcp-request\", \"fullconn\", \"log-format\", and\n            section 7 about acls.\n\nuse-server <server> if <condition>\nuse-server <server> unless <condition>\n  only use a specific server if/unless an acl-based condition is matched.\n  may be used in sections :   defaults | frontend | listen | backend\n                                  no   |    no    |   yes  |   yes\n  arguments :\n    <server>    is the name of a valid server in the same backend section.\n\n    <condition> is a condition composed of acls, as described in section 7.\n\n  by default, connections which arrive to a backend are load-balanced across\n  the available servers according to the configured algorithm, unless a\n  persistence mechanism such as a cookie is used and found in the request.\n\n  sometimes it is desirable to forward a particular request to a specific\n  server without having to declare a dedicated backend for this server. this\n  can be achieved using the \"use-server\" rules. these rules are evaluated after\n  the \"redirect\" rules and before evaluating cookies, and they have precedence\n  on them. there may be as many \"use-server\" rules as desired. all of these\n  rules are evaluated in their declaration order, and the first one which\n  matches will assign the server.\n\n  if a rule designates a server which is down, and \"option persist\" is not used\n  and no force-persist rule was validated, it is ignored and evaluation goes on\n  with the next rules until one matches.\n\n  in the first form, the server will be used if the condition is met. in the\n  second form, the server will be used if the condition is not met. if no\n  condition is valid, the processing continues and the server will be assigned\n  according to other persistence mechanisms.\n\n  note that even if a rule is matched, cookie processing is still performed but\n  does not assign the server. this allows prefixed cookies to have their prefix\n  stripped.\n\n  the \"use-server\" statement works both in http and tcp mode. this makes it\n  suitable for use with content-based inspection. for instance, a server could\n  be selected in a farm according to the tls sni field. and if these servers\n  have their weight set to zero, they will not be used for other traffic.\n\n  example :\n     # intercept incoming tls requests based on the sni field\n     use-server www if { req_ssl_sni -i www.example.com }\n     server     www 192.168.0.1:443 weight 0\n     use-server mail if { req_ssl_sni -i mail.example.com }\n     server     mail 192.168.0.1:587 weight 0\n     use-server imap if { req_ssl_sni -i imap.example.com }\n     server     mail 192.168.0.1:993 weight 0\n     # all the rest is forwarded to this server\n     server  default 192.168.0.2:443 check\n\n  see also: \"use_backend\", section 5 about server and section 7 about acls.\n\n5\\. bind and server options\n--------------------------\n\nthe \"bind\", \"server\" and \"default-server\" keywords support a number of settings\ndepending on some build options and on the system haproxy was built on. these\nsettings generally each consist in one word sometimes followed by a value,\nwritten on the same line as the \"bind\" or \"server\" line. all these options are\ndescribed in this section.\n\n5.1\\. bind options\n-----------------\n\nthe \"bind\" keyword supports a certain number of settings which are all passed\nas arguments on the same line. the order in which those arguments appear makes\nno importance, provided that they appear after the bind address. all of these\nparameters are optional. some of them consist in a single words (booleans),\nwhile other ones expect a value after them. in this case, the value must be\nprovided immediately after the setting name.\n\nthe currently supported settings are the following ones.\n\naccept-proxy\n  enforces the use of the proxy protocol over any connection accepted by any of\n  the sockets declared on the same line. versions 1 and 2 of the proxy protocol\n  are supported and correctly detected. the proxy protocol dictates the layer\n  3/4 addresses of the incoming connection to be used everywhere an address is\n  used, with the only exception of \"tcp-request connection\" rules which will\n  only see the real connection address. logs will reflect the addresses\n  indicated in the protocol, unless it is violated, in which case the real\n  address will still be used.  this keyword combined with support from external\n  components can be used as an efficient and reliable alternative to the\n  x-forwarded-for mechanism which is not always reliable and not even always\n  usable. see also \"tcp-request connection expect-proxy\" for a finer-grained\n  setting of which client is allowed to use the protocol.\n\nalpn <protocols>\n  this enables the tls alpn extension and advertises the specified protocol\n  list as supported on top of alpn. the protocol list consists in a comma-\n  delimited list of protocol names, for instance: \"http/1.1,http/1.0\" (without\n  quotes). this requires that the ssl library is build with support for tls\n  extensions enabled (check with haproxy -vv). the alpn extension replaces the\n  initial npn extension.\n\nbacklog <backlog>\n  sets the socket's backlog to this value. if unspecified, the frontend's\n  backlog is used instead, which generally defaults to the maxconn value.\n\necdhe <named curve>\n  this setting is only available when support for openssl was built in. it sets\n  the named curve (rfc 4492) used to generate ecdh ephemeral keys. by default,\n  used named curve is prime256v1.\n\nca-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load ca certificates used to verify\n  client's certificate.\n\nca-ignore-err [all|<errorid>,...]\n  this setting is only available when support for openssl was built in.\n  sets a comma separated list of errorids to ignore during verify at depth > 0.\n  if set to 'all', all errors are ignored. ssl handshake is not aborted if an\n  error is ignored.\n\nca-sign-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file containing both the ca certificate and the ca private\n  key used to create and sign server's certificates. this is a mandatory\n  setting when the dynamic generation of certificates is enabled. see\n  'generate-certificates' for details.\n\nca-sign-passphrase <passphrase>\n  this setting is only available when support for openssl was built in. it is\n  the ca private key passphrase. this setting is optional and used only when\n  the dynamic generation of certificates is enabled. see\n  'generate-certificates' for details.\n\nciphers <ciphers>\n  this setting is only available when support for openssl was built in. it sets\n  the string describing the list of cipher algorithms (\"cipher suite\") that are\n  negotiated during the ssl/tls handshake. the format of the string is defined\n  in \"man 1 ciphers\" from openssl man pages, and can be for instance a string\n  such as \"aes:all:!anull:!enull:+rc4:@strength\" (without quotes).\n\ncrl-file <crlfile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load certificate revocation list used\n  to verify client's certificate.\n\ncrt <cert>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file containing both the required certificates and any\n  associated private keys. this file can be built by concatenating multiple\n  pem files into one (e.g. cat cert.pem key.pem > combined.pem). if your ca\n  requires an intermediate certificate, this can also be concatenated into this\n  file.\n\n  if the openssl used supports diffie-hellman, parameters present in this file\n  are loaded.\n\n  if a directory name is used instead of a pem file, then all files found in\n  that directory will be loaded in alphabetic order unless their name ends with\n  '.issuer', '.ocsp' or '.sctl' (reserved extensions). this directive may be\n  specified multiple times in order to load certificates from multiple files or\n  directories. the certificates will be presented to clients who provide a\n  valid tls server name indication field matching one of their cn or alt\n  subjects.  wildcards are supported, where a wildcard character '*' is used\n  instead of the first hostname component (eg: *.example.org matches\n  www.example.org but not www.sub.example.org).\n\n  if no sni is provided by the client or if the ssl library does not support\n  tls extensions, or if the client provides an sni hostname which does not\n  match any certificate, then the first loaded certificate will be presented.\n  this means that when loading certificates from a directory, it is highly\n  recommended to load the default one first as a file or to ensure that it will\n  always be the first one in the directory.\n\n  note that the same cert may be loaded multiple times without side effects.\n\n  some cas (such as godaddy) offer a drop down list of server types that do not\n  include haproxy when obtaining a certificate. if this happens be sure to\n  choose a webserver that the ca believes requires an intermediate ca (for\n  godaddy, selection apache tomcat will get the correct bundle, but many\n  others, e.g. nginx, result in a wrong bundle that will not work for some\n  clients).\n\n  for each pem file, haproxy checks for the presence of file at the same path\n  suffixed by \".ocsp\". if such file is found, support for the tls certificate\n  status request extension (also known as \"ocsp stapling\") is automatically\n  enabled. the content of this file is optional. if not empty, it must contain\n  a valid ocsp response in der format. in order to be valid an ocsp response\n  must comply with the following rules: it has to indicate a good status,\n  it has to be a single response for the certificate of the pem file, and it\n  has to be valid at the moment of addition. if these rules are not respected\n  the ocsp response is ignored and a warning is emitted. in order to  identify\n  which certificate an ocsp response applies to, the issuer's certificate is\n  necessary. if the issuer's certificate is not found in the pem file, it will\n  be loaded from a file at the same path as the pem file suffixed by \".issuer\"\n  if it exists otherwise it will fail with an error.\n\n  for each pem file, haproxy also checks for the presence of file at the same\n  path suffixed by \".sctl\". if such file is found, support for certificate\n  transparency (rfc6962) tls extension is enabled. the file must contain a\n  valid signed certificate timestamp list, as described in rfc. file is parsed\n  to check basic syntax, but no signatures are verified.\n\ncrt-ignore-err <errors>\n  this setting is only available when support for openssl was built in. sets a\n  comma separated list of errorids to ignore during verify at depth == 0\\.  if\n  set to 'all', all errors are ignored. ssl handshake is not aborted if an error\n  is ignored.\n\ncrt-list <file>\n  this setting is only available when support for openssl was built in. it\n  designates a list of pem file with an optional list of sni filter per\n  certificate, with the following format for each line :\n\n        <crtfile> [[!]<snifilter> ...]\n\n  wildcards are supported in the sni filter. negative filter are also supported,\n  only useful in combination with a wildcard filter to exclude a particular sni.\n  the certificates will be presented to clients who provide a valid tls server\n  name indication field matching one of the sni filters. if no sni filter is\n  specified, the cn and alt subjects are used. this directive may be specified\n  multiple times. see the \"crt\" option for more information. the default\n  certificate is still needed to meet openssl expectations. if it is not used,\n  the 'strict-sni' option may be used.\n\ndefer-accept\n  is an optional keyword which is supported only on certain linux kernels. it\n  states that a connection will only be accepted once some data arrive on it,\n  or at worst after the first retransmit. this should be used only on protocols\n  for which the client talks first (eg: http). it can slightly improve\n  performance by ensuring that most of the request is already available when\n  the connection is accepted. on the other hand, it will not be able to detect\n  connections which don't talk. it is important to note that this option is\n  broken in all kernels up to 2.6.31, as the connection is never accepted until\n  the client talks. this can cause issues with front firewalls which would see\n  an established connection while the proxy will only see it in syn_recv. this\n  option is only supported on tcpv4/tcpv6 sockets and ignored by other ones.\n\nforce-sslv3\n  this option enforces use of sslv3 only on ssl connections instantiated from\n  this listener. sslv3 is generally less expensive than the tls counterparts\n  for high connection rates. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\" and \"no-sslv3\".\n\nforce-tlsv10\n  this option enforces use of tlsv1.0 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\" and \"no-sslv3\".\n\nforce-tlsv11\n  this option enforces use of tlsv1.1 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\", and \"no-sslv3\".\n\nforce-tlsv12\n  this option enforces use of tlsv1.2 only on ssl connections instantiated from\n  this listener. this option is also available on global statement\n  \"ssl-default-bind-options\". see also \"no-tlsv*\", and \"no-sslv3\".\n\ngenerate-certificates\n  this setting is only available when support for openssl was built in. it\n  enables the dynamic ssl certificates generation. a ca certificate and its\n  private key are necessary (see 'ca-sign-file'). when haproxy is configured as\n  a transparent forward proxy, ssl requests generate errors because of a common\n  name mismatch on the certificate presented to the client. with this option\n  enabled, haproxy will try to forge a certificate using the sni hostname\n  indicated by the client. this is done only if no certificate matches the sni\n  hostname (see 'crt-list'). if an error occurs, the default certificate is\n  used, else the 'strict-sni' option is set.\n  it can also be used when haproxy is configured as a reverse proxy to ease the\n  deployment of an architecture with many backends.\n\n  creating a ssl certificate is an expensive operation, so a lru cache is used\n  to store forged certificates (see 'tune.ssl.ssl-ctx-cache-size'). it\n  increases the haproxy's memroy footprint to reduce latency when the same\n  certificate is used many times.\n\ngid <gid>\n  sets the group of the unix sockets to the designated system gid. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"group\"\n  setting except that the group id is used instead of its name. this setting is\n  ignored by non unix sockets.\n\ngroup <group>\n  sets the group of the unix sockets to the designated system group. it can\n  also be set by default in the global section's \"unix-bind\" statement. note\n  that some platforms simply ignore this. this setting is equivalent to the\n  \"gid\" setting except that the group name is used instead of its gid. this\n  setting is ignored by non unix sockets.\n\nid <id>\n  fixes the socket id. by default, socket ids are automatically assigned, but\n  sometimes it is more convenient to fix them to ease monitoring. this value\n  must be strictly positive and unique within the listener/frontend. this\n  option can only be used when defining only a single socket.\n\ninterface <interface>\n  restricts the socket to a specific interface. when specified, only packets\n  received from that particular interface are processed by the socket. this is\n  currently only supported on linux. the interface must be a primary system\n  interface, not an aliased interface. it is also possible to bind multiple\n  frontends to the same address if they are bound to different interfaces. note\n  that binding to a network interface requires root privileges. this parameter\n  is only compatible with tcpv4/tcpv6 sockets.\n\nlevel <level>\n  this setting is used with the stats sockets only to restrict the nature of\n  the commands that can be issued on the socket. it is ignored by other\n  sockets. <level> can be one of :\n  - \"user\" is the least privileged level ; only non-sensitive stats can be\n    read, and no change is allowed. it would make sense on systems where it\n    is not easy to restrict access to the socket.\n  - \"operator\" is the default level and fits most common uses. all data can\n    be read, and only non-sensitive changes are permitted (eg: clear max\n    counters).\n  - \"admin\" should be used with care, as everything is permitted (eg: clear\n    all counters).\n\nmaxconn <maxconn>\n  limits the sockets to this number of concurrent connections. extraneous\n  connections will remain in the system's backlog until a connection is\n  released. if unspecified, the limit will be the same as the frontend's\n  maxconn. note that in case of port ranges or multiple addresses, the same\n  value will be applied to each socket. this setting enables different\n  limitations on expensive sockets, for instance ssl entries which may easily\n  eat all memory.\n\nmode <mode>\n  sets the octal mode used to define access permissions on the unix socket. it\n  can also be set by default in the global section's \"unix-bind\" statement.\n  note that some platforms simply ignore this. this setting is ignored by non\n  unix sockets.\n\nmss <maxseg>\n  sets the tcp maximum segment size (mss) value to be advertised on incoming\n  connections. this can be used to force a lower mss for certain specific\n  ports, for instance for connections passing through a vpn. note that this\n  relies on a kernel feature which is theoretically supported under linux but\n  was buggy in all versions prior to 2.6.28\\. it may or may not work on other\n  operating systems. it may also not change the advertised value but change the\n  effective size of outgoing segments. the commonly advertised value for tcpv4\n  over ethernet networks is 1460 = 1500(mtu) - 40(ip+tcp). if this value is\n  positive, it will be used as the advertised mss. if it is negative, it will\n  indicate by how much to reduce the incoming connection's advertised mss for\n  outgoing segments. this parameter is only compatible with tcp v4/v6 sockets.\n\nname <name>\n  sets an optional name for these sockets, which will be reported on the stats\n  page.\n\nnice <nice>\n  sets the 'niceness' of connections initiated from the socket. value must be\n  in the range -1024..1024 inclusive, and defaults to zero. positive values\n  means that such connections are more friendly to others and easily offer\n  their place in the scheduler. on the opposite, negative values mean that\n  connections want to run with a higher priority than others. the difference\n  only happens under high loads when the system is close to saturation.\n  negative values are appropriate for low-latency or administration services,\n  and high values are generally recommended for cpu intensive tasks such as ssl\n  processing or bulk transfers which are less sensible to latency. for example,\n  it may make sense to use a positive value for an smtp socket and a negative\n  one for an rdp socket.\n\nno-sslv3\n  this setting is only available when support for openssl was built in. it\n  disables support for sslv3 on any sockets instantiated from the listener when\n  ssl is supported. note that sslv2 is forced disabled in the code and cannot\n  be enabled using any configuration option. this option is also available on\n  global statement \"ssl-default-bind-options\". see also \"force-tls*\",\n  and \"force-sslv3\".\n\nno-tls-tickets\n  this setting is only available when support for openssl was built in. it\n  disables the stateless session resumption (rfc 5077 tls ticket\n  extension) and force to use stateful session resumption. stateless\n  session resumption is more expensive in cpu usage. this option is also\n  available on global statement \"ssl-default-bind-options\".\n\nno-tlsv10\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.0 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nno-tlsv11\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.1 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nno-tlsv12\n  this setting is only available when support for openssl was built in. it\n  disables support for tlsv1.2 on any sockets instantiated from the listener\n  when ssl is supported. note that sslv2 is forced disabled in the code and\n  cannot be enabled using any configuration option. this option is also\n  available on global statement \"ssl-default-bind-options\". see also\n  \"force-tlsv*\", and \"force-sslv3\".\n\nnpn <protocols>\n  this enables the npn tls extension and advertises the specified protocol list\n  as supported on top of npn. the protocol list consists in a comma-delimited\n  list of protocol names, for instance: \"http/1.1,http/1.0\" (without quotes).\n  this requires that the ssl library is build with support for tls extensions\n  enabled (check with haproxy -vv). note that the npn extension has been\n  replaced with the alpn extension (see the \"alpn\" keyword).\n\nprocess [ all | odd | even | <number 1-64>[-<number 1-64>] ]\n  this restricts the list of processes on which this listener is allowed to\n  run. it does not enforce any process but eliminates those which do not match.\n  if the frontend uses a \"bind-process\" setting, the intersection between the\n  two is applied. if in the end the listener is not allowed to run on any\n  remaining process, a warning is emitted, and the listener will either run on\n  the first process of the listener if a single process was specified, or on\n  all of its processes if multiple processes were specified. for the unlikely\n  case where several ranges are needed, this directive may be repeated. the\n  main purpose of this directive is to be used with the stats sockets and have\n  one different socket per process. the second purpose is to have multiple bind\n  lines sharing the same ip:port but not the same process in a listener, so\n  that the system can distribute the incoming connections into multiple queues\n  and allow a smoother inter-process load balancing. currently linux 3.9 and\n  above is known for supporting this. see also \"bind-process\" and \"nbproc\".\n\nssl\n  this setting is only available when support for openssl was built in. it\n  enables ssl deciphering on connections instantiated from this listener. a\n  certificate is necessary (see \"crt\" above). all contents in the buffers will\n  appear in clear text, so that acls and http processing will only have access\n  to deciphered contents.\n\nstrict-sni\n  this setting is only available when support for openssl was built in. the\n  ssl/tls negotiation is allow only if the client provided an sni which match\n  a certificate. the default certificate is not used.\n  see the \"crt\" option for more information.\n\ntcp-ut <delay>\n  sets the tcp user timeout for all incoming connections instanciated from this\n  listening socket. this option is available on linux since version 2.6.37\\. it\n  allows haproxy to configure a timeout for sockets which contain data not\n  receiving an acknoledgement for the configured delay. this is especially\n  useful on long-lived connections experiencing long idle periods such as\n  remote terminals or database connection pools, where the client and server\n  timeouts must remain high to allow a long period of idle, but where it is\n  important to detect that the client has disappeared in order to release all\n  resources associated with its connection (and the server's session). the\n  argument is a delay expressed in milliseconds by default. this only works\n  for regular tcp connections, and is ignored for other protocols.\n\ntfo\n  is an optional keyword which is supported only on linux kernels >= 3.7\\. it\n  enables tcp fast open on the listening socket, which means that clients which\n  support this feature will be able to send a request and receive a response\n  during the 3-way handshake starting from second connection, thus saving one\n  round-trip after the first connection. this only makes sense with protocols\n  that use high connection rates and where each round trip matters. this can\n  possibly cause issues with many firewalls which do not accept data on syn\n  packets, so this option should only be enabled once well tested. this option\n  is only supported on tcpv4/tcpv6 sockets and ignored by other ones. you may\n  need to build haproxy with use_tfo=1 if your libc doesn't define\n  tcp_fastopen.\n\ntls-ticket-keys <keyfile>\n  sets the tls ticket keys file to load the keys from. the keys need to be 48\n  bytes long, encoded with base64 (ex. openssl rand -base64 48). number of keys\n  is specified by the tls_tickets_no build option (default 3) and at least as\n  many keys need to be present in the file. last tls_tickets_no keys will be\n  used for decryption and the penultimate one for encryption. this enables easy\n  key rotation by just appending new key to the file and reloading the process.\n  keys must be periodically rotated (ex. every 12h) or perfect forward secrecy\n  is compromised. it is also a good idea to keep the keys off any permanent\n  storage such as hard drives (hint: use tmpfs and don't swap those files).\n  lifetime hint can be changed using tune.ssl.timeout.\n\ntransparent\n  is an optional keyword which is supported only on certain linux kernels. it\n  indicates that the addresses will be bound even if they do not belong to the\n  local machine, and that packets targeting any of these addresses will be\n  intercepted just as if the addresses were locally configured. this normally\n  requires that ip forwarding is enabled. caution! do not use this with the\n  default address '*', as it would redirect any traffic for the specified port.\n  this keyword is available only when haproxy is built with use_linux_tproxy=1.\n  this parameter is only compatible with tcpv4 and tcpv6 sockets, depending on\n  kernel version. some distribution kernels include backports of the feature,\n  so check for support with your vendor.\n\nv4v6\n  is an optional keyword which is supported only on most recent systems\n  including linux kernels >= 2.4.21\\. it is used to bind a socket to both ipv4\n  and ipv6 when it uses the default address. doing so is sometimes necessary\n  on systems which bind to ipv6 only by default. it has no effect on non-ipv6\n  sockets, and is overridden by the \"v6only\" option.\n\nv6only\n  is an optional keyword which is supported only on most recent systems\n  including linux kernels >= 2.4.21\\. it is used to bind a socket to ipv6 only\n  when it uses the default address. doing so is sometimes preferred to doing it\n  system-wide as it is per-listener. it has no effect on non-ipv6 sockets and\n  has precedence over the \"v4v6\" option.\n\nuid <uid>\n  sets the owner of the unix sockets to the designated system uid. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"user\"\n  setting except that the user numeric id is used instead of its name. this\n  setting is ignored by non unix sockets.\n\nuser <user>\n  sets the owner of the unix sockets to the designated system user. it can also\n  be set by default in the global section's \"unix-bind\" statement. note that\n  some platforms simply ignore this. this setting is equivalent to the \"uid\"\n  setting except that the user name is used instead of its uid. this setting is\n  ignored by non unix sockets.\n\nverify [none|optional|required]\n  this setting is only available when support for openssl was built in. if set\n  to 'none', client certificate is not requested. this is the default. in other\n  cases, a client certificate is requested. if the client does not provide a\n  certificate after the request and if 'verify' is set to 'required', then the\n  handshake is aborted, while it would have succeeded if set to 'optional'. the\n  certificate provided by the client is always verified using cas from\n  'ca-file' and optional crls from 'crl-file'. on verify failure the handshake\n  is aborted, regardless of the 'verify' option, unless the error code exactly\n  matches one of those listed with 'ca-ignore-err' or 'crt-ignore-err'.\n\n5.2\\. server and default-server options\n------------------------------------\n\nthe \"server\" and \"default-server\" keywords support a certain number of settings\nwhich are all passed as arguments on the server line. the order in which those\narguments appear does not count, and they are all optional. some of those\nsettings are single words (booleans) while others expect one or several values\nafter them. in this case, the values must immediately follow the setting name.\nexcept default-server, all those settings must be specified after the server's\naddress if they are used:\n\n  server <name> <address>[:port] [settings ...]\n  default-server [settings ...]\n\nthe currently supported settings are the following ones.\n\naddr <ipv4|ipv6>\n  using the \"addr\" parameter, it becomes possible to use a different ip address\n  to send health-checks. on some servers, it may be desirable to dedicate an ip\n  address to specific component able to perform complex tests which are more\n  suitable to health-checks than the application. this parameter is ignored if\n  the \"check\" parameter is not set. see also the \"port\" parameter.\n\n  supported in default-server: no\n\nagent-check\n  enable an auxiliary agent check which is run independently of a regular\n  health check. an agent health check is performed by making a tcp connection\n  to the port set by the \"agent-port\" parameter and reading an ascii string.\n  the string is made of a series of words delimited by spaces, tabs or commas\n  in any order, optionally terminated by '\\r' and/or '\\n', each consisting of :\n\n  - an ascii representation of a positive integer percentage, e.g. \"75%\".\n    values in this format will set the weight proportional to the initial\n    weight of a server as configured when haproxy starts. note that a zero\n    weight is reported on the stats page as \"drain\" since it has the same\n    effect on the server (it's removed from the lb farm).\n\n  - the word \"ready\". this will turn the server's administrative state to the\n    ready mode, thus cancelling any drain or maint state\n\n  - the word \"drain\". this will turn the server's administrative state to the\n    drain mode, thus it will not accept any new connections other than those\n    that are accepted via persistence.\n\n  - the word \"maint\". this will turn the server's administrative state to the\n    maint mode, thus it will not accept any new connections at all, and health\n    checks will be stopped.\n\n  - the words \"down\", \"failed\", or \"stopped\", optionally followed by a\n    description string after a sharp ('#'). all of these mark the server's\n    operating state as down, but since the word itself is reported on the stats\n    page, the difference allows an administrator to know if the situation was\n    expected or not : the service may intentionally be stopped, may appear up\n    but fail some validity tests, or may be seen as down (eg: missing process,\n    or port not responding).\n\n  - the word \"up\" sets back the server's operating state as up if health checks\n    also report that the service is accessible.\n\n  parameters which are not advertised by the agent are not changed. for\n  example, an agent might be designed to monitor cpu usage and only report a\n  relative weight and never interact with the operating status. similarly, an\n  agent could be designed as an end-user interface with 3 radio buttons\n  allowing an administrator to change only the administrative state. however,\n  it is important to consider that only the agent may revert its own actions,\n  so if a server is set to drain mode or to down state using the agent, the\n  agent must implement the other equivalent actions to bring the service into\n  operations again.\n\n  failure to connect to the agent is not considered an error as connectivity\n  is tested by the regular health check which is enabled by the \"check\"\n  parameter. warning though, it is not a good idea to stop an agent after it\n  reports \"down\", since only an agent reporting \"up\" will be able to turn the\n  server up again. note that the cli on the unix stats socket is also able to\n  force an agent's result in order to workaround a bogus agent if needed.\n\n  requires the \"agent-port\" parameter to be set. see also the \"agent-inter\"\n  parameter.\n\n  supported in default-server: no\n\nagent-inter <delay>\n  the \"agent-inter\" parameter sets the interval between two agent checks\n  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.\n\n  just as with every other time-based parameter, it may be entered in any\n  other explicit unit among { us, ms, s, m, h, d }. the \"agent-inter\"\n  parameter also serves as a timeout for agent checks \"timeout check\" is\n  not set. in order to reduce \"resonance\" effects when multiple servers are\n  hosted on the same hardware, the agent and health checks of all servers\n  are started with a small time offset between them. it is also possible to\n  add some random noise in the agent and health checks interval using the\n  global \"spread-checks\" keyword. this makes sense for instance when a lot\n  of backends use the same servers.\n\n  see also the \"agent-check\" and \"agent-port\" parameters.\n\n  supported in default-server: yes\n\nagent-port <port>\n  the \"agent-port\" parameter sets the tcp port used for agent checks.\n\n  see also the \"agent-check\" and \"agent-inter\" parameters.\n\n  supported in default-server: yes\n\nbackup\n  when \"backup\" is present on a server line, the server is only used in load\n  balancing when all other non-backup servers are unavailable. requests coming\n  with a persistence cookie referencing the server will always be served\n  though. by default, only the first operational backup server is used, unless\n  the \"allbackups\" option is set in the backend. see also the \"allbackups\"\n  option.\n\n  supported in default-server: no\n\nca-file <cafile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load ca certificates used to verify\n  server's certificate.\n\n  supported in default-server: no\n\ncheck\n  this option enables health checks on the server. by default, a server is\n  always considered available. if \"check\" is set, the server is available when\n  accepting periodic tcp connections, to ensure that it is really able to serve\n  requests. the default address and port to send the tests to are those of the\n  server, and the default source is the same as the one defined in the\n  backend. it is possible to change the address using the \"addr\" parameter, the\n  port using the \"port\" parameter, the source address using the \"source\"\n  address, and the interval and timers using the \"inter\", \"rise\" and \"fall\"\n  parameters. the request method is define in the backend using the \"httpchk\",\n  \"smtpchk\", \"mysql-check\", \"pgsql-check\" and \"ssl-hello-chk\" options. please\n  refer to those options and parameters for more information.\n\n  supported in default-server: no\n\ncheck-send-proxy\n  this option forces emission of a proxy protocol line with outgoing health\n  checks, regardless of whether the server uses send-proxy or not for the\n  normal traffic. by default, the proxy protocol is enabled for health checks\n  if it is already enabled for normal traffic and if no \"port\" nor \"addr\"\n  directive is present. however, if such a directive is present, the\n  \"check-send-proxy\" option needs to be used to force the use of the\n  protocol. see also the \"send-proxy\" option for more information.\n\n  supported in default-server: no\n\ncheck-ssl\n  this option forces encryption of all health checks over ssl, regardless of\n  whether the server uses ssl or not for the normal traffic. this is generally\n  used when an explicit \"port\" or \"addr\" directive is specified and ssl health\n  checks are not inherited. it is important to understand that this option\n  inserts an ssl transport layer below the checks, so that a simple tcp connect\n  check becomes an ssl connect, which replaces the old ssl-hello-chk. the most\n  common use is to send https checks by combining \"httpchk\" with ssl checks.\n  all ssl settings are common to health checks and traffic (eg: ciphers).\n  see the \"ssl\" option for more information.\n\n  supported in default-server: no\n\nciphers <ciphers>\n  this option sets the string describing the list of cipher algorithms that is\n  is negotiated during the ssl/tls handshake with the server. the format of the\n  string is defined in \"man 1 ciphers\". when ssl is used to communicate with\n  servers on the local network, it is common to see a weaker set of algorithms\n  than what is used over the internet. doing so reduces cpu usage on both the\n  server and haproxy while still keeping it compatible with deployed software.\n  some algorithms such as rc4-sha1 are reasonably cheap. if no security at all\n  is needed and just connectivity, using des can be appropriate.\n\n  supported in default-server: no\n\ncookie <value>\n  the \"cookie\" parameter sets the cookie value assigned to the server to\n  <value>. this value will be checked in incoming requests, and the first\n  operational server possessing the same value will be selected. in return, in\n  cookie insertion or rewrite modes, this value will be assigned to the cookie\n  sent to the client. there is nothing wrong in having several servers sharing\n  the same cookie value, and it is in fact somewhat common between normal and\n  backup servers. see also the \"cookie\" keyword in backend section.\n\n  supported in default-server: no\n\ncrl-file <crlfile>\n  this setting is only available when support for openssl was built in. it\n  designates a pem file from which to load certificate revocation list used\n  to verify server's certificate.\n\n  supported in default-server: no\n\ncrt <cert>\n  this setting is only available when support for openssl was built in.\n  it designates a pem file from which to load both a certificate and the\n  associated private key. this file can be built by concatenating both pem\n  files into one. this certificate will be sent if the server send a client\n  certificate request.\n\n  supported in default-server: no\n\ndisabled\n  the \"disabled\" keyword starts the server in the \"disabled\" state. that means\n  that it is marked down in maintenance mode, and no connection other than the\n  ones allowed by persist mode will reach it. it is very well suited to setup\n  new servers, because normal traffic will never reach them, while it is still\n  possible to test the service by making use of the force-persist mechanism.\n\n  supported in default-server: no\n\nerror-limit <count>\n  if health observing is enabled, the \"error-limit\" parameter specifies the\n  number of consecutive errors that triggers event selected by the \"on-error\"\n  option. by default it is set to 10 consecutive errors.\n\n  supported in default-server: yes\n\n  see also the \"check\", \"error-limit\" and \"on-error\".\n\nfall <count>\n  the \"fall\" parameter states that a server will be considered as dead after\n  <count> consecutive unsuccessful health checks. this value defaults to 3 if\n  unspecified. see also the \"check\", \"inter\" and \"rise\" parameters.\n\n  supported in default-server: yes\n\nforce-sslv3\n  this option enforces use of sslv3 only when ssl is used to communicate with\n  the server. sslv3 is generally less expensive than the tls counterparts for\n  high connection rates. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv10\n  this option enforces use of tlsv1.0 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv11\n  this option enforces use of tlsv1.1 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nforce-tlsv12\n  this option enforces use of tlsv1.2 only when ssl is used to communicate with\n  the server. this option is also available on global statement\n  \"ssl-default-server-options\". see also \"no-tlsv*\", \"no-sslv3\".\n\n  supported in default-server: no\n\nid <value>\n  set a persistent id for the server. this id must be positive and unique for\n  the proxy. an unused id will automatically be assigned if unset. the first\n  assigned value will be 1\\. this id is currently only returned in statistics.\n\n  supported in default-server: no\n\ninter <delay>\nfastinter <delay>\ndowninter <delay>\n  the \"inter\" parameter sets the interval between two consecutive health checks\n  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.\n  it is also possible to use \"fastinter\" and \"downinter\" to optimize delays\n  between checks depending on the server state :\n\n             server state            |             interval used\n    ---------------------------------+-----------------------------------------\n     up 100% (non-transitional)      | \"inter\"\n    ---------------------------------+-----------------------------------------\n     transitionally up (going down), |\n     transitionally down (going up), | \"fastinter\" if set, \"inter\" otherwise.\n     or yet unchecked.               |\n    ---------------------------------+-----------------------------------------\n     down 100% (non-transitional)    | \"downinter\" if set, \"inter\" otherwise.\n    ---------------------------------+-----------------------------------------\n\n  just as with every other time-based parameter, they can be entered in any\n  other explicit unit among { us, ms, s, m, h, d }. the \"inter\" parameter also\n  serves as a timeout for health checks sent to servers if \"timeout check\" is\n  not set. in order to reduce \"resonance\" effects when multiple servers are\n  hosted on the same hardware, the agent and health checks of all servers\n  are started with a small time offset between them. it is also possible to\n  add some random noise in the agent and health checks interval using the\n  global \"spread-checks\" keyword. this makes sense for instance when a lot\n  of backends use the same servers.\n\n  supported in default-server: yes\n\nmaxconn <maxconn>\n  the \"maxconn\" parameter specifies the maximal number of concurrent\n  connections that will be sent to this server. if the number of incoming\n  concurrent requests goes higher than this value, they will be queued, waiting\n  for a connection to be released. this parameter is very important as it can\n  save fragile servers from going down under extreme loads. if a \"minconn\"\n  parameter is specified, the limit becomes dynamic. the default value is \"0\"\n  which means unlimited. see also the \"minconn\" and \"maxqueue\" parameters, and\n  the backend's \"fullconn\" keyword.\n\n  supported in default-server: yes\n\nmaxqueue <maxqueue>\n  the \"maxqueue\" parameter specifies the maximal number of connections which\n  will wait in the queue for this server. if this limit is reached, next\n  requests will be redispatched to other servers instead of indefinitely\n  waiting to be served. this will break persistence but may allow people to\n  quickly re-log in when the server they try to connect to is dying. the\n  default value is \"0\" which means the queue is unlimited. see also the\n  \"maxconn\" and \"minconn\" parameters.\n\n  supported in default-server: yes\n\nminconn <minconn>\n  when the \"minconn\" parameter is set, the maxconn limit becomes a dynamic\n  limit following the backend's load. the server will always accept at least\n  <minconn> connections, never more than <maxconn>, and the limit will be on\n  the ramp between both values when the backend has less than <fullconn>\n  concurrent connections. this makes it possible to limit the load on the\n  server during normal loads, but push it further for important loads without\n  overloading the server during exceptional loads. see also the \"maxconn\"\n  and \"maxqueue\" parameters, as well as the \"fullconn\" backend keyword.\n\n  supported in default-server: yes\n\nno-ssl-reuse\n  this option disables ssl session reuse when ssl is used to communicate with\n  the server. it will force the server to perform a full handshake for every\n  new connection. it's probably only useful for benchmarking, troubleshooting,\n  and for paranoid users.\n\n  supported in default-server: no\n\nno-sslv3\n  this option disables support for sslv3 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tls-tickets\n  this setting is only available when support for openssl was built in. it\n  disables the stateless session resumption (rfc 5077 tls ticket\n  extension) and force to use stateful session resumption. stateless\n  session resumption is more expensive in cpu usage for servers. this option\n  is also available on global statement \"ssl-default-server-options\".\n\n  supported in default-server: no\n\nno-tlsv10\n  this option disables support for tlsv1.0 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tlsv11\n  this option disables support for tlsv1.1 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nno-tlsv12\n  this option disables support for tlsv1.2 when ssl is used to communicate with\n  the server. note that sslv2 is disabled in the code and cannot be enabled\n  using any configuration option. tlsv1 is more expensive than sslv3 so it\n  often makes sense to disable it when communicating with local servers. this\n  option is also available on global statement \"ssl-default-server-options\".\n  see also \"force-sslv3\", \"force-tlsv*\".\n\n  supported in default-server: no\n\nnon-stick\n  never add connections allocated to this sever to a stick-table.\n  this may be used in conjunction with backup to ensure that\n  stick-table persistence is disabled for backup servers.\n\n  supported in default-server: no\n\nobserve <mode>\n  this option enables health adjusting based on observing communication with\n  the server. by default this functionality is disabled and enabling it also\n  requires to enable health checks. there are two supported modes: \"layer4\" and\n  \"layer7\". in layer4 mode, only successful/unsuccessful tcp connections are\n  significant. in layer7, which is only allowed for http proxies, responses\n  received from server are verified, like valid/wrong http code, unparsable\n  headers, a timeout, etc. valid status codes include 100 to 499, 501 and 505.\n\n  supported in default-server: no\n\n  see also the \"check\", \"on-error\" and \"error-limit\".\n\non-error <mode>\n  select what should happen when enough consecutive errors are detected.\n  currently, four modes are available:\n  - fastinter: force fastinter\n  - fail-check: simulate a failed check, also forces fastinter (default)\n  - sudden-death: simulate a pre-fatal failed health check, one more failed\n    check will mark a server down, forces fastinter\n  - mark-down: mark the server immediately down and force fastinter\n\n  supported in default-server: yes\n\n  see also the \"check\", \"observe\" and \"error-limit\".\n\non-marked-down <action>\n  modify what occurs when a server is marked down.\n  currently one action is available:\n  - shutdown-sessions: shutdown peer sessions. when this setting is enabled,\n    all connections to the server are immediately terminated when the server\n    goes down. it might be used if the health check detects more complex cases\n    than a simple connection status, and long timeouts would cause the service\n    to remain unresponsive for too long a time. for instance, a health check\n    might detect that a database is stuck and that there's no chance to reuse\n    existing connections anymore. connections killed this way are logged with\n    a 'd' termination code (for \"down\").\n\n  actions are disabled by default\n\n  supported in default-server: yes\n\non-marked-up <action>\n  modify what occurs when a server is marked up.\n  currently one action is available:\n  - shutdown-backup-sessions: shutdown sessions on all backup servers. this is\n    done only if the server is not in backup state and if it is not disabled\n    (it must have an effective weight > 0). this can be used sometimes to force\n    an active server to take all the traffic back after recovery when dealing\n    with long sessions (eg: ldap, sql, ...). doing this can cause more trouble\n    than it tries to solve (eg: incomplete transactions), so use this feature\n    with extreme care. sessions killed because a server comes up are logged\n    with an 'u' termination code (for \"up\").\n\n  actions are disabled by default\n\n  supported in default-server: yes\n\nport <port>\n  using the \"port\" parameter, it becomes possible to use a different port to\n  send health-checks. on some servers, it may be desirable to dedicate a port\n  to a specific component able to perform complex tests which are more suitable\n  to health-checks than the application. it is common to run a simple script in\n  inetd for instance. this parameter is ignored if the \"check\" parameter is not\n  set. see also the \"addr\" parameter.\n\n  supported in default-server: yes\n\nredir <prefix>\n  the \"redir\" parameter enables the redirection mode for all get and head\n  requests addressing this server. this means that instead of having haproxy\n  forward the request to the server, it will send an \"http 302\" response with\n  the \"location\" header composed of this prefix immediately followed by the\n  requested uri beginning at the leading '/' of the path component. that means\n  that no trailing slash should be used after <prefix>. all invalid requests\n  will be rejected, and all non-get or head requests will be normally served by\n  the server. note that since the response is completely forged, no header\n  mangling nor cookie insertion is possible in the response. however, cookies in\n  requests are still analysed, making this solution completely usable to direct\n  users to a remote location in case of local disaster. main use consists in\n  increasing bandwidth for static servers by having the clients directly\n  connect to them. note: never use a relative location here, it would cause a\n  loop between the client and haproxy!\n\n  example :  server srv1 192.168.1.1:80 redir http://image1.mydomain.com check\n\n  supported in default-server: no\n\nrise <count>\n  the \"rise\" parameter states that a server will be considered as operational\n  after <count> consecutive successful health checks. this value defaults to 2\n  if unspecified. see also the \"check\", \"inter\" and \"fall\" parameters.\n\n  supported in default-server: yes\n\nresolve-prefer <family>\n  when dns resolution is enabled for a server and multiple ip addresses from\n  different families are returned, haproxy will prefer using an ip address\n  from the family mentioned in the \"resolve-prefer\" parameter.\n  available families: \"ipv4\" and \"ipv6\"\n\n  default value: ipv4\n\n  example: server s1 app1.domain.com:80 resolvers mydns resolve-prefer ipv6\n\nresolvers <id>\n  points to an existing \"resolvers\" section to resolve current server's\n  hostname.\n\n  example: server s1 app1.domain.com:80 resolvers mydns\n\n  see also chapter 5.3\n\nsend-proxy\n  the \"send-proxy\" parameter enforces use of the proxy protocol over any\n  connection established to this server. the proxy protocol informs the other\n  end about the layer 3/4 addresses of the incoming connection, so that it can\n  know the client's address or the public address it accessed to, whatever the\n  upper layer protocol. for connections accepted by an \"accept-proxy\" listener,\n  the advertised address will be used. only tcpv4 and tcpv6 address families\n  are supported. other families such as unix sockets, will report an unknown\n  family. servers using this option can fully be chained to another instance of\n  haproxy listening with an \"accept-proxy\" setting. this setting must not be\n  used if the server isn't aware of the protocol. when health checks are sent\n  to the server, the proxy protocol is automatically used when this option is\n  set, unless there is an explicit \"port\" or \"addr\" directive, in which case an\n  explicit \"check-send-proxy\" directive would also be needed to use the proxy\n  protocol. see also the \"accept-proxy\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2\n  the \"send-proxy-v2\" parameter enforces use of the proxy protocol version 2\n  over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. this setting must not be used if the\n  server isn't aware of this version of the protocol. see also the \"send-proxy\"\n  option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2-ssl\n  the \"send-proxy-v2-ssl\" parameter enforces use of the proxy protocol version\n  2 over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. in addition, the ssl information extension\n  of the proxy protocol is added to the proxy protocol header. this setting\n  must not be used if the server isn't aware of this version of the protocol.\n  see also the \"send-proxy-v2\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nsend-proxy-v2-ssl-cn\n  the \"send-proxy-v2-ssl\" parameter enforces use of the proxy protocol version\n  2 over any connection established to this server. the proxy protocol informs\n  the other end about the layer 3/4 addresses of the incoming connection, so\n  that it can know the client's address or the public address it accessed to,\n  whatever the upper layer protocol. in addition, the ssl information extension\n  of the proxy protocol, along along with the common name from the subject of\n  the client certificate (if any), is added to the proxy protocol header. this\n  setting must not be used if the server isn't aware of this version of the\n  protocol. see also the \"send-proxy-v2\" option of the \"bind\" keyword.\n\n  supported in default-server: no\n\nslowstart <start_time_in_ms>\n  the \"slowstart\" parameter for a server accepts a value in milliseconds which\n  indicates after how long a server which has just come back up will run at\n  full speed. just as with every other time-based parameter, it can be entered\n  in any other explicit unit among { us, ms, s, m, h, d }. the speed grows\n  linearly from 0 to 100% during this time. the limitation applies to two\n  parameters :\n\n  - maxconn: the number of connections accepted by the server will grow from 1\n    to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).\n\n  - weight: when the backend uses a dynamic weighted algorithm, the weight\n    grows linearly from 1 to 100%. in this case, the weight is updated at every\n    health-check. for this reason, it is important that the \"inter\" parameter\n    is smaller than the \"slowstart\", in order to maximize the number of steps.\n\n  the slowstart never applies when haproxy starts, otherwise it would cause\n  trouble to running servers. it only applies when a server has been previously\n  seen as failed.\n\n  supported in default-server: yes\n\nsni <expression>\n  the \"sni\" parameter evaluates the sample fetch expression, converts it to a\n  string and uses the result as the host name sent in the sni tls extension to\n  the server. a typical use case is to send the sni received from the client in\n  a bridged https scenario, using the \"ssl_fc_sni\" sample fetch for the\n  expression, though alternatives such as req.hdr(host) can also make sense.\n\n  supported in default-server: no\n\nsource <addr>[:<pl>[-<ph>]] [usesrc { <addr2>[:<port2>] | client | clientip } ]\nsource <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]\nsource <addr>[:<pl>[-<ph>]] [interface <name>] ...\n  the \"source\" parameter sets the source address which will be used when\n  connecting to the server. it follows the exact same parameters and principle\n  as the backend \"source\" keyword, except that it only applies to the server\n  referencing it. please consult the \"source\" keyword for details.\n\n  additionally, the \"source\" statement on a server line allows one to specify a\n  source port range by indicating the lower and higher bounds delimited by a\n  dash ('-'). some operating systems might require a valid ip address when a\n  source port range is specified. it is permitted to have the same ip/range for\n  several servers. doing so makes it possible to bypass the maximum of 64k\n  total concurrent connections. the limit will then reach 64k connections per\n  server.\n\n  supported in default-server: no\n\nssl\n  this option enables ssl ciphering on outgoing connections to the server. it\n  is critical to verify server certificates using \"verify\" when using ssl to\n  connect to servers, otherwise the communication is prone to trivial man in\n  the-middle attacks rendering ssl useless. when this option is used, health\n  checks are automatically sent in ssl too unless there is a \"port\" or an\n  \"addr\" directive indicating the check should be sent to a different location.\n  see the \"check-ssl\" option to force ssl health checks.\n\n  supported in default-server: no\n\ntrack [<proxy>/]<server>\n  this option enables ability to set the current state of the server by tracking\n  another one. it is possible to track a server which itself tracks another\n  server, provided that at the end of the chain, a server has health checks\n  enabled. if <proxy> is omitted the current one is used. if disable-on-404 is\n  used, it has to be enabled on both proxies.\n\n  supported in default-server: no\n\nverify [none|required]\n  this setting is only available when support for openssl was built in. if set\n  to 'none', server certificate is not verified. in the other case, the\n  certificate provided by the server is verified using cas from 'ca-file'\n  and optional crls from 'crl-file'. if 'ssl_server_verify' is not specified\n  in global  section, this is the default. on verify failure the handshake\n  is aborted. it is critically important to verify server certificates when\n  using ssl to connect to servers, otherwise the communication is prone to\n  trivial man-in-the-middle attacks rendering ssl totally useless.\n\n  supported in default-server: no\n\nverifyhost <hostname>\n  this setting is only available when support for openssl was built in, and\n  only takes effect if 'verify required' is also specified. when set, the\n  hostnames in the subject and subjectalternatenames of the certificate\n  provided by the server are checked. if none of the hostnames in the\n  certificate match the specified hostname, the handshake is aborted. the\n  hostnames in the server-provided certificate may include wildcards.\n\n  supported in default-server: no\n\nweight <weight>\n  the \"weight\" parameter is used to adjust the server's weight relative to\n  other servers. all servers will receive a load proportional to their weight\n  relative to the sum of all weights, so the higher the weight, the higher the\n  load. the default weight is 1, and the maximal value is 256\\. a value of 0\n  means the server will not participate in load-balancing but will still accept\n  persistent connections. if this parameter is used to distribute the load\n  according to server's capacity, it is recommended to start with values which\n  can both grow and shrink, for instance between 10 and 100 to leave enough\n  room above and below for later adjustments.\n\n  supported in default-server: yes\n\n5.3\\. server ip address resolution using dns\n-------------------------------------------\n\nhaproxy allows using a host name to be resolved to find out what is the server\nip address. by default, haproxy resolves the name when parsing the\nconfiguration, at startup.\nthis is not sufficient in some cases, such as in amazon where a server's ip\ncan change after a reboot or an elb virtual ip can change based on current\nworkload.\nthis chapter describes how haproxy can be configured to process server's name\nresolution at run time.\nwhether run time server name resolution has been enable or not, haproxy will\ncarry on doing the first resolution when parsing the configuration.\n\n5.3.1\\. global overview\n----------------------\n\nas we've seen in introduction, name resolution in haproxy occurs at two\ndifferent steps of the process life:\n\n  1\\. when starting up, haproxy parses the server line definition and matches a\n     host name. it uses libc functions to get the host name resolved. this\n     resolution relies on /etc/resolv.conf file.\n\n  2\\. at run time, when haproxy gets prepared to run a health check on a server,\n     it verifies if the current name resolution is still considered as valid.\n     if not, it processes a new resolution, in parallel of the health check.\n\na few other events can trigger a name resolution at run time:\n  - when a server's health check ends up in a connection timeout: this may be\n    because the server has a new ip address. so we need to trigger a name\n    resolution to know this new ip.\n\na few things important to notice:\n  - all the name servers are queried in the mean time. haproxy will process the\n    first valid response.\n\n  - a resolution is considered as invalid (nx, timeout, refused), when all the\n    servers return an error.\n\n5.3.2\\. the resolvers section\n----------------------------\n\nthis section is dedicated to host information related to name resolution in\nhaproxy.\nthere can be as many as resolvers section as needed. each section can contain\nmany name servers.\n\nresolvers <resolvers id>\n  creates a new name server list labelled <resolvers id>\n\na resolvers section accept the following parameters:\n\nnameserver <id> <ip>:<port>\n  dns server description:\n    <id>   : label of the server, should be unique\n    <ip>   : ip address of the server\n    <port> : port where the dns service actually runs\n\nhold <status> <period>\n  defines <period> during which the last name resolution should be kept based\n  on last resolution <status>\n    <status> : last name resolution status. only \"valid\" is accepted for now.\n    <period> : interval between two successive name resolution when the last\n               answer was in <status>. it follows the haproxy time format.\n               <period> is in milliseconds by default.\n\n  default value is 10s for \"valid\".\n\n  note: since the name resolution is triggered by the health checks, a new\n        resolution is triggered after <period> modulo the <inter> parameter of\n        the healch check.\n\nresolve_retries <nb>\n  defines the number <nb> of queries to send to resolve a server name before\n  giving up.\n  default value: 3\n\ntimeout <event> <time>\n  defines timeouts related to name resolution\n     <event> : the event on which the <time> timeout period applies to.\n               events available are:\n               - retry: time between two dns queries, when no response have\n                        been received.\n                        default value: 1s\n     <time>  : time related to the event. it follows the haproxy time format.\n               <time> is expressed in milliseconds.\n\nexample of a resolvers section (with default values):\n\n   resolvers mydns\n     nameserver dns1 10.0.0.1:53\n     nameserver dns2 10.0.0.2:53\n     resolve_retries       3\n     timeout retry         1s\n     hold valid           10s\n\n6\\. http header manipulation\n---------------------------\n\nin http mode, it is possible to rewrite, add or delete some of the request and\nresponse headers based on regular expressions. it is also possible to block a\nrequest or a response if a particular header matches a regular expression,\nwhich is enough to stop most elementary protocol attacks, and to protect\nagainst information leak from the internal network.\n\nif haproxy encounters an \"informational response\" (status code 1xx), it is able\nto process all rsp* rules which can allow, deny, rewrite or delete a header,\nbut it will refuse to add a header to any such messages as this is not\nhttp-compliant. the reason for still processing headers in such responses is to\nstop and/or fix any possible information leak which may happen, for instance\nbecause another downstream equipment would unconditionally add a header, or if\na server name appears there. when such messages are seen, normal processing\nstill occurs on the next non-informational messages.\n\nthis section covers common usage of the following keywords, described in detail\nin section 4.2 :\n\n  - reqadd     <string>\n  - reqallow   <search>\n  - reqiallow  <search>\n  - reqdel     <search>\n  - reqidel    <search>\n  - reqdeny    <search>\n  - reqideny   <search>\n  - reqpass    <search>\n  - reqipass   <search>\n  - reqrep     <search> <replace>\n  - reqirep    <search> <replace>\n  - reqtarpit  <search>\n  - reqitarpit <search>\n  - rspadd     <string>\n  - rspdel     <search>\n  - rspidel    <search>\n  - rspdeny    <search>\n  - rspideny   <search>\n  - rsprep     <search> <replace>\n  - rspirep    <search> <replace>\n\nwith all these keywords, the same conventions are used. the <search> parameter\nis a posix extended regular expression (regex) which supports grouping through\nparenthesis (without the backslash). spaces and other delimiters must be\nprefixed with a backslash ('\\') to avoid confusion with a field delimiter.\nother characters may be prefixed with a backslash to change their meaning :\n\n  \\t   for a tab\n  \\r   for a carriage return (cr)\n  \\n   for a new line (lf)\n  \\    to mark a space and differentiate it from a delimiter\n  \\#   to mark a sharp and differentiate it from a comment\n  \\\\   to use a backslash in a regex\n  \\\\\\\\ to use a backslash in the text (*2 for regex, *2 for haproxy)\n  \\xxx to write the ascii hex code xx as in the c language\n\nthe <replace> parameter contains the string to be used to replace the largest\nportion of text matching the regex. it can make use of the special characters\nabove, and can reference a substring which is delimited by parenthesis in the\nregex, by writing a backslash ('\\') immediately followed by one digit from 0 to\n9 indicating the group position (0 designating the entire line). this practice\nis very common to users of the \"sed\" program.\n\nthe <string> parameter represents the string which will systematically be added\nafter the last header line. it can also use special character sequences above.\n\nnotes related to these keywords :\n---------------------------------\n  - these keywords are not always convenient to allow/deny based on header\n    contents. it is strongly recommended to use acls with the \"block\" keyword\n    instead, resulting in far more flexible and manageable rules.\n\n  - lines are always considered as a whole. it is not possible to reference\n    a header name only or a value only. this is important because of the way\n    headers are written (notably the number of spaces after the colon).\n\n  - the first line is always considered as a header, which makes it possible to\n    rewrite or filter http requests uris or response codes, but in turn makes\n    it harder to distinguish between headers and request line. the regex prefix\n    ^[^\\ \\t]*[\\ \\t] matches any http method followed by a space, and the prefix\n    ^[^ \\t:]*: matches any header name followed by a colon.\n\n  - for performances reasons, the number of characters added to a request or to\n    a response is limited at build time to values between 1 and 4 kb. this\n    should normally be far more than enough for most usages. if it is too short\n    on occasional usages, it is possible to gain some space by removing some\n    useless headers before adding new ones.\n\n  - keywords beginning with \"reqi\" and \"rspi\" are the same as their counterpart\n    without the 'i' letter except that they ignore case when matching patterns.\n\n  - when a request passes through a frontend then a backend, all req* rules\n    from the frontend will be evaluated, then all req* rules from the backend\n    will be evaluated. the reverse path is applied to responses.\n\n  - req* statements are applied after \"block\" statements, so that \"block\" is\n    always the first one, but before \"use_backend\" in order to permit rewriting\n    before switching.\n\n7\\. using acls and fetching samples\n----------------------------------\n\nhaproxy is capable of extracting data from request or response streams, from\nclient or server information, from tables, environmental information etc...\nthe action of extracting such data is called fetching a sample. once retrieved,\nthese samples may be used for various purposes such as a key to a stick-table,\nbut most common usages consist in matching them against predefined constant\ndata called patterns.\n\n7.1\\. acl basics\n---------------\n\nthe use of access control lists (acl) provides a flexible solution to perform\ncontent switching and generally to take decisions based on content extracted\nfrom the request, the response or any environmental status. the principle is\nsimple :\n\n  - extract a data sample from a stream, table or the environment\n  - optionally apply some format conversion to the extracted sample\n  - apply one or multiple pattern matching methods on this sample\n  - perform actions only when a pattern matches the sample\n\nthe actions generally consist in blocking a request, selecting a backend, or\nadding a header.\n\nin order to define a test, the \"acl\" keyword is used. the syntax is :\n\n   acl <aclname> <criterion> [flags] [operator] [<value>] ...\n\nthis creates a new acl <aclname> or completes an existing one with new tests.\nthose tests apply to the portion of request/response specified in <criterion>\nand may be adjusted with optional flags [flags]. some criteria also support\nan operator which may be specified before the set of values. optionally some\nconversion operators may be applied to the sample, and they will be specified\nas a comma-delimited list of keywords just after the first keyword. the values\nare of the type supported by the criterion, and are separated by spaces.\n\nacl names must be formed from upper and lower case letters, digits, '-' (dash),\n'_' (underscore) , '.' (dot) and ':' (colon). acl names are case-sensitive,\nwhich means that \"my_acl\" and \"my_acl\" are two different acls.\n\nthere is no enforced limit to the number of acls. the unused ones do not affect\nperformance, they just consume a small amount of memory.\n\nthe criterion generally is the name of a sample fetch method, or one of its acl\nspecific declinations. the default test method is implied by the output type of\nthis sample fetch method. the acl declinations can describe alternate matching\nmethods of a same sample fetch method. the sample fetch methods are the only\nones supporting a conversion.\n\nsample fetch methods return data which can be of the following types :\n  - boolean\n  - integer (signed or unsigned)\n  - ipv4 or ipv6 address\n  - string\n  - data block\n\nconverters transform any of these data into any of these. for example, some\nconverters might convert a string to a lower-case string while other ones\nwould turn a string to an ipv4 address, or apply a netmask to an ip address.\nthe resulting sample is of the type of the last converter applied to the list,\nwhich defaults to the type of the sample fetch method.\n\neach sample or converter returns data of a specific type, specified with its\nkeyword in this documentation. when an acl is declared using a standard sample\nfetch method, certain types automatically involved a default matching method\nwhich are summarized in the table below :\n\n   +---------------------+-----------------+\n   | sample or converter | default         |\n   |    output type      | matching method |\n   +---------------------+-----------------+\n   | boolean             | bool            |\n   +---------------------+-----------------+\n   | integer             | int             |\n   +---------------------+-----------------+\n   | ip                  | ip              |\n   +---------------------+-----------------+\n   | string              | str             |\n   +---------------------+-----------------+\n   | binary              | none, use \"-m\"  |\n   +---------------------+-----------------+\n\nnote that in order to match a binary samples, it is mandatory to specify a\nmatching method, see below.\n\nthe acl engine can match these types against patterns of the following types :\n  - boolean\n  - integer or integer range\n  - ip address / network\n  - string (exact, substring, suffix, prefix, subdir, domain)\n  - regular expression\n  - hex block\n\nthe following acl flags are currently supported :\n\n   -i : ignore case during matching of all subsequent patterns.\n   -f : load patterns from a file.\n   -m : use a specific pattern matching method\n   -n : forbid the dns resolutions\n   -m : load the file pointed by -f like a map file.\n   -u : force the unique id of the acl\n   -- : force end of flags. useful when a string looks like one of the flags.\n\nthe \"-f\" flag is followed by the name of a file from which all lines will be\nread as individual values. it is even possible to pass multiple \"-f\" arguments\nif the patterns are to be loaded from multiple files. empty lines as well as\nlines beginning with a sharp ('#') will be ignored. all leading spaces and tabs\nwill be stripped. if it is absolutely necessary to insert a valid pattern\nbeginning with a sharp, just prefix it with a space so that it is not taken for\na comment. depending on the data type and match method, haproxy may load the\nlines into a binary tree, allowing very fast lookups. this is true for ipv4 and\nexact string matching. in this case, duplicates will automatically be removed.\n\nthe \"-m\" flag allows an acl to use a map file. if this flag is set, the file is\nparsed as two column file. the first column contains the patterns used by the\nacl, and the second column contain the samples. the sample can be used later by\na map. this can be useful in some rare cases where an acl would just be used to\ncheck for the existence of a pattern in a map before a mapping is applied.\n\nthe \"-u\" flag forces the unique id of the acl. this unique id is used with the\nsocket interface to identify acl and dynamically change its values. note that a\nfile is always identified by its name even if an id is set.\n\nalso, note that the \"-i\" flag applies to subsequent entries and not to entries\nloaded from files preceding it. for instance :\n\n    acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test\n\nin this example, each line of \"exact-ua.lst\" will be exactly matched against\nthe \"user-agent\" header of the request. then each line of \"generic-ua\" will be\ncase-insensitively matched. then the word \"test\" will be insensitively matched\nas well.\n\nthe \"-m\" flag is used to select a specific pattern matching method on the input\nsample. all acl-specific criteria imply a pattern matching method and generally\ndo not need this flag. however, this flag is useful with generic sample fetch\nmethods to describe how they're going to be matched against the patterns. this\nis required for sample fetches which return data type for which there is no\nobvious matching method (eg: string or binary). when \"-m\" is specified and\nfollowed by a pattern matching method name, this method is used instead of the\ndefault one for the criterion. this makes it possible to match contents in ways\nthat were not initially planned, or with sample fetch methods which return a\nstring. the matching method also affects the way the patterns are parsed.\n\nthe \"-n\" flag forbids the dns resolutions. it is used with the load of ip files.\nby default, if the parser cannot parse ip address it considers that the parsed\nstring is maybe a domain name and try dns resolution. the flag \"-n\" disable this\nresolution. it is useful for detecting malformed ip lists. note that if the dns\nserver is not reachable, the haproxy configuration parsing may last many minutes\nwaiting fir the timeout. during this time no error messages are displayed. the\nflag \"-n\" disable this behavior. note also that during the runtime, this\nfunction is disabled for the dynamic acl modifications.\n\nthere are some restrictions however. not all methods can be used with all\nsample fetch methods. also, if \"-m\" is used in conjunction with \"-f\", it must\nbe placed first. the pattern matching method must be one of the following :\n\n  - \"found\" : only check if the requested sample could be found in the stream,\n              but do not compare it against any pattern. it is recommended not\n              to pass any pattern to avoid confusion. this matching method is\n              particularly useful to detect presence of certain contents such\n              as headers, cookies, etc... even if they are empty and without\n              comparing them to anything nor counting them.\n\n  - \"bool\"  : check the value as a boolean. it can only be applied to fetches\n              which return a boolean or integer value, and takes no pattern.\n              value zero or false does not match, all other values do match.\n\n  - \"int\"   : match the value as an integer. it can be used with integer and\n              boolean samples. boolean false is integer 0, true is integer 1.\n\n  - \"ip\"    : match the value as an ipv4 or ipv6 address. it is compatible\n              with ip address samples only, so it is implied and never needed.\n\n  - \"bin\"   : match the contents against an hexadecimal string representing a\n              binary sequence. this may be used with binary or string samples.\n\n  - \"len\"   : match the sample's length as an integer. this may be used with\n              binary or string samples.\n\n  - \"str\"   : exact match : match the contents against a string. this may be\n              used with binary or string samples.\n\n  - \"sub\"   : substring match : check that the contents contain at least one of\n              the provided string patterns. this may be used with binary or\n              string samples.\n\n  - \"reg\"   : regex match : match the contents against a list of regular\n              expressions. this may be used with binary or string samples.\n\n  - \"beg\"   : prefix match : check that the contents begin like the provided\n              string patterns. this may be used with binary or string samples.\n\n  - \"end\"   : suffix match : check that the contents end like the provided\n              string patterns. this may be used with binary or string samples.\n\n  - \"dir\"   : subdir match : check that a slash-delimited portion of the\n              contents exactly matches one of the provided string patterns.\n              this may be used with binary or string samples.\n\n  - \"dom\"   : domain match : check that a dot-delimited portion of the contents\n              exactly match one of the provided string patterns. this may be\n              used with binary or string samples.\n\nfor example, to quickly detect the presence of cookie \"jsessionid\" in an http\nrequest, it is possible to do :\n\n    acl jsess_present cook(jsessionid) -m found\n\nin order to apply a regular expression on the 500 first bytes of data in the\nbuffer, one would use the following acl :\n\n    acl script_tag payload(0,500) -m reg -i <script>\n\non systems where the regex library is much slower when using \"-i\", it is\npossible to convert the sample to lowercase before matching, like this :\n\n    acl script_tag payload(0,500),lower -m reg <script>\n\nall acl-specific criteria imply a default matching method. most often, these\ncriteria are composed by concatenating the name of the original sample fetch\nmethod and the matching method. for example, \"hdr_beg\" applies the \"beg\" match\nto samples retrieved using the \"hdr\" fetch method. since all acl-specific\ncriteria rely on a sample fetch method, it is always possible instead to use\nthe original sample fetch method and the explicit matching method using \"-m\".\n\nif an alternate match is specified using \"-m\" on an acl-specific criterion,\nthe matching method is simply applied to the underlying sample fetch method.\nfor example, all acls below are exact equivalent :\n\n    acl short_form  hdr_beg(host)        www.\n    acl alternate1  hdr_beg(host) -m beg www.\n    acl alternate2  hdr_dom(host) -m beg www.\n    acl alternate3  hdr(host)     -m beg www.\n\nthe table below summarizes the compatibility matrix between sample or converter\ntypes and the pattern types to fetch against. it indicates for each compatible\ncombination the name of the matching method to be used, surrounded with angle\nbrackets \">\" and \"<\" when the method is the default one and will work by\ndefault without \"-m\".\n\n                           +-------------------------------------------------+\n                           |                input sample type                |\n    +----------------------+---------+---------+---------+---------+---------+\n    |     pattern type     | boolean | integer |   ip    | string  | binary  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (presence only) |  found  |  found  |  found  |  found  |  found  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (boolean value) |>  bool <|   bool  |         |   bool  |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (value)      |   int   |>  int  <|   int   |   int   |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (length)     |   len   |   len   |   len   |   len   |   len   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | ip address           |         |         |>   ip  <|    ip   |    ip   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | exact string         |   str   |   str   |   str   |>  str  <|   str   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | suffix               |   end   |   end   |   end   |   end   |   end   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | substring            |   sub   |   sub   |   sub   |   sub   |   sub   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | domain               |   dom   |   dom   |   dom   |   dom   |   dom   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | regex                |   reg   |   reg   |   reg   |   reg   |   reg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | hex block            |         |         |         |   bin   |   bin   |\n    +----------------------+---------+---------+---------+---------+---------+\n\n7.1.1\\. matching booleans\n------------------------\n\nin order to match a boolean, no value is needed and all values are ignored.\nboolean matching is used by default for all fetch methods of type \"boolean\".\nwhen boolean matching is used, the fetched value is returned as-is, which means\nthat a boolean \"true\" will always match and a boolean \"false\" will never match.\n\nboolean matching may also be enforced using \"-m bool\" on fetch methods which\nreturn an integer value. then, integer value 0 is converted to the boolean\n\"false\" and all other values are converted to \"true\".\n\n7.1.2\\. matching integers\n------------------------\n\ninteger matching applies by default to integer fetch methods. it can also be\nenforced on boolean fetches using \"-m int\". in this case, \"false\" is converted\nto the integer 0, and \"true\" is converted to the integer 1.\n\ninteger matching also supports integer ranges and operators. note that integer\nmatching only applies to positive values. a range is a value expressed with a\nlower and an upper bound separated with a colon, both of which may be omitted.\n\nfor instance, \"1024:65535\" is a valid range to represent a range of\nunprivileged ports, and \"1024:\" would also work. \"0:1023\" is a valid\nrepresentation of privileged ports, and \":1023\" would also work.\n\nas a special case, some acl functions support decimal numbers which are in fact\ntwo integers separated by a dot. this is used with some version checks for\ninstance. all integer properties apply to those decimal numbers, including\nranges and operators.\n\nfor an easier usage, comparison operators are also supported. note that using\noperators with ranges does not make much sense and is strongly discouraged.\nsimilarly, it does not make much sense to perform order comparisons with a set\nof values.\n\navailable operators for integer matching are :\n\n  eq : true if the tested value equals at least one value\n  ge : true if the tested value is greater than or equal to at least one value\n  gt : true if the tested value is greater than at least one value\n  le : true if the tested value is less than or equal to at least one value\n  lt : true if the tested value is less than at least one value\n\nfor instance, the following acl matches any negative content-length header :\n\n  acl negative-length hdr_val(content-length) lt 0\n\nthis one matches ssl versions between 3.0 and 3.1 (inclusive) :\n\n  acl sslv3 req_ssl_ver 3:3.1\n\n7.1.3\\. matching strings\n-----------------------\n\nstring matching applies to string or binary fetch methods, and exists in 6\ndifferent forms :\n\n  - exact match     (-m str) : the extracted string must exactly match the\n    patterns ;\n\n  - substring match (-m sub) : the patterns are looked up inside the\n    extracted string, and the acl matches if any of them is found inside ;\n\n  - prefix match    (-m beg) : the patterns are compared with the beginning of\n    the extracted string, and the acl matches if any of them matches.\n\n  - suffix match    (-m end) : the patterns are compared with the end of the\n    extracted string, and the acl matches if any of them matches.\n\n  - subdir match    (-m sub) : the patterns are looked up inside the extracted\n    string, delimited with slashes (\"/\"), and the acl matches if any of them\n    matches.\n\n  - domain match    (-m dom) : the patterns are looked up inside the extracted\n    string, delimited with dots (\".\"), and the acl matches if any of them\n    matches.\n\nstring matching applies to verbatim strings as they are passed, with the\nexception of the backslash (\"\\\") which makes it possible to escape some\ncharacters such as the space. if the \"-i\" flag is passed before the first\nstring, then the matching will be performed ignoring the case. in order\nto match the string \"-i\", either set it second, or pass the \"--\" flag\nbefore the first string. same applies of course to match the string \"--\".\n\n7.1.4\\. matching regular expressions (regexes)\n---------------------------------------------\n\njust like with string matching, regex matching applies to verbatim strings as\nthey are passed, with the exception of the backslash (\"\\\") which makes it\npossible to escape some characters such as the space. if the \"-i\" flag is\npassed before the first regex, then the matching will be performed ignoring\nthe case. in order to match the string \"-i\", either set it second, or pass\nthe \"--\" flag before the first string. same principle applies of course to\nmatch the string \"--\".\n\n7.1.5\\. matching arbitrary data blocks\n-------------------------------------\n\nit is possible to match some extracted samples against a binary block which may\nnot safely be represented as a string. for this, the patterns must be passed as\na series of hexadecimal digits in an even number, when the match method is set\nto binary. each sequence of two digits will represent a byte. the hexadecimal\ndigits may be used upper or lower case.\n\nexample :\n    # match \"hello\\n\" in the input stream (\\x48 \\x65 \\x6c \\x6c \\x6f \\x0a)\n    acl hello payload(0,6) -m bin 48656c6c6f0a\n\n7.1.6\\. matching ipv4 and ipv6 addresses\n---------------------------------------\n\nipv4 addresses values can be specified either as plain addresses or with a\nnetmask appended, in which case the ipv4 address matches whenever it is\nwithin the network. plain addresses may also be replaced with a resolvable\nhost name, but this practice is generally discouraged as it makes it more\ndifficult to read and debug configurations. if hostnames are used, you should\nat least ensure that they are present in /etc/hosts so that the configuration\ndoes not depend on any random dns match at the moment the configuration is\nparsed.\n\nipv6 may be entered in their usual form, with or without a netmask appended.\nonly bit counts are accepted for ipv6 netmasks. in order to avoid any risk of\ntrouble with randomly resolved ip addresses, host names are never allowed in\nipv6 patterns.\n\nhaproxy is also able to match ipv4 addresses with ipv6 addresses in the\nfollowing situations :\n  - tested address is ipv4, pattern address is ipv4, the match applies\n    in ipv4 using the supplied mask if any.\n  - tested address is ipv6, pattern address is ipv6, the match applies\n    in ipv6 using the supplied mask if any.\n  - tested address is ipv6, pattern address is ipv4, the match applies in ipv4\n    using the pattern's mask if the ipv6 address matches with 2002:ipv4::,\n    ::ipv4 or ::ffff:ipv4, otherwise it fails.\n  - tested address is ipv4, pattern address is ipv6, the ipv4 address is first\n    converted to ipv6 by prefixing ::ffff: in front of it, then the match is\n    applied in ipv6 using the supplied ipv6 mask.\n\n7.2\\. using acls to form conditions\n----------------------------------\n\nsome actions are only performed upon a valid condition. a condition is a\ncombination of acls with operators. 3 operators are supported :\n\n  - and (implicit)\n  - or  (explicit with the \"or\" keyword or the \"||\" operator)\n  - negation with the exclamation mark (\"!\")\n\na condition is formed as a disjunctive form:\n\n   [!]acl1 [!]acl2 ... [!]acln  { or [!]acl1 [!]acl2 ... [!]acln } ...\n\nsuch conditions are generally used after an \"if\" or \"unless\" statement,\nindicating when the condition will trigger the action.\n\nfor instance, to block http requests to the \"*\" url with methods other than\n\"options\", as well as post requests without content-length, and get or head\nrequests with a content-length greater than 0, and finally every request which\nis not either get/head/post/options !\n\n   acl missing_cl hdr_cnt(content-length) eq 0\n   block if http_url_star !meth_options || meth_post missing_cl\n   block if meth_get http_content\n   block unless meth_get or meth_post or meth_options\n\nto select a different backend for requests to static contents on the \"www\" site\nand to every request on the \"img\", \"video\", \"download\" and \"ftp\" hosts :\n\n   acl url_static  path_beg         /static /images /img /css\n   acl url_static  path_end         .gif .png .jpg .css .js\n   acl host_www    hdr_beg(host) -i www\n   acl host_static hdr_beg(host) -i img. video. download. ftp.\n\n   # now use backend \"static\" for all static-only hosts, and for static urls\n   # of host \"www\". use backend \"www\" for the rest.\n   use_backend static if host_static or host_www url_static\n   use_backend www    if host_www\n\nit is also possible to form rules using \"anonymous acls\". those are unnamed acl\nexpressions that are built on the fly without needing to be declared. they must\nbe enclosed between braces, with a space before and after each brace (because\nthe braces must be seen as independent words). example :\n\n   the following rule :\n\n       acl missing_cl hdr_cnt(content-length) eq 0\n       block if meth_post missing_cl\n\n   can also be written that way :\n\n       block if meth_post { hdr_cnt(content-length) eq 0 }\n\nit is generally not recommended to use this construct because it's a lot easier\nto leave errors in the configuration when written that way. however, for very\nsimple rules matching only one source ip address for instance, it can make more\nsense to use them than to declare acls with random names. another example of\ngood use is the following :\n\n   with named acls :\n\n        acl site_dead nbsrv(dynamic) lt 2\n        acl site_dead nbsrv(static)  lt 2\n        monitor fail  if site_dead\n\n   with anonymous acls :\n\n        monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }\n\nsee section 4.2 for detailed help on the \"block\" and \"use_backend\" keywords.\n\n7.3\\. fetching samples\n---------------------\n\nhistorically, sample fetch methods were only used to retrieve data to match\nagainst patterns using acls. with the arrival of stick-tables, a new class of\nsample fetch methods was created, most often sharing the same syntax as their\nacl counterpart. these sample fetch methods are also known as \"fetches\". as\nof now, acls and fetches have converged. all acl fetch methods have been made\navailable as fetch methods, and acls may use any sample fetch method as well.\n\nthis section details all available sample fetch methods and their output type.\nsome sample fetch methods have deprecated aliases that are used to maintain\ncompatibility with existing configurations. they are then explicitly marked as\ndeprecated and should not be used in new setups.\n\nthe acl derivatives are also indicated when available, with their respective\nmatching methods. these ones all have a well defined default pattern matching\nmethod, so it is never necessary (though allowed) to pass the \"-m\" option to\nindicate how the sample will be matched using acls.\n\nas indicated in the sample type versus matching compatibility matrix above,\nwhen using a generic sample fetch method in an acl, the \"-m\" option is\nmandatory unless the sample type is one of boolean, integer, ipv4 or ipv6\\. when\nthe same keyword exists as an acl keyword and as a standard fetch method, the\nacl engine will automatically pick the acl-only one by default.\n\nsome of these keywords support one or multiple mandatory arguments, and one or\nmultiple optional arguments. these arguments are strongly typed and are checked\nwhen the configuration is parsed so that there is no risk of running with an\nincorrect argument (eg: an unresolved backend name). fetch function arguments\nare passed between parenthesis and are delimited by commas.  when an argument\nis optional, it will be indicated below between square brackets ('[ ]'). when\nall arguments are optional, the parenthesis may be omitted.\n\nthus, the syntax of a standard sample fetch method is one of the following :\n   - name\n   - name(arg1)\n   - name(arg1,arg2)\n\n7.3.1\\. converters\n-----------------\n\nsample fetch methods may be combined with transformations to be applied on top\nof the fetched sample (also called \"converters\"). these combinations form what\nis called \"sample expressions\" and the result is a \"sample\". initially this\nwas only supported by \"stick on\" and \"stick store-request\" directives but this\nhas now be extended to all places where samples may be used (acls, log-format,\nunique-id-format, add-header, ...).\n\nthese transformations are enumerated as a series of specific keywords after the\nsample fetch method. these keywords may equally be appended immediately after\nthe fetch keyword's argument, delimited by a comma. these keywords can also\nsupport some arguments (eg: a netmask) which must be passed in parenthesis.\n\na certain category of converters are bitwise and arithmetic operators which\nsupport performing basic operations on integers. some bitwise operations are\nsupported (and, or, xor, cpl) and some arithmetic operations are supported\n(add, sub, mul, div, mod, neg). some comparators are provided (odd, even, not,\nbool) which make it possible to report a match without having to write an acl.\n\nthe currently available list of transformation keywords include :\n\nadd(<value>)\n  adds <value> to the input value of type signed integer, and returns the\n  result as a signed integer. <value> can be a numeric value or a variable\n  name. the name of the variable starts by an indication about its scope. the\n  allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nand(<value>)\n  performs a bitwise \"and\" between <value> and the input value of type signed\n  integer, and returns the result as an signed integer. <value> can be a\n  numeric value or a variable name. the name of the variable starts by an\n  indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nbase64\n  converts a binary input sample to a base64 string. it is used to log or\n  transfer binary content in a way that can be reliably transferred (eg:\n  an ssl id can be copied in a header).\n\nbool\n  returns a boolean true if the input value of type signed integer is\n  non-null, otherwise returns false. used in conjunction with and(), it can be\n  used to report true/false for bit testing on input values (eg: verify the\n  presence of a flag).\n\nbytes(<offset>[,<length>])\n  extracts some bytes from an input binary sample. the result is a binary\n  sample starting at an offset (in bytes) of the original sample and\n  optionnaly truncated at the given length.\n\ncpl\n  takes the input value of type signed integer, applies a ones-complement\n  (flips all bits) and returns the result as an signed integer.\n\ncrc32([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the crc32\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  provided for compatibility with other software which want a crc32 to be\n  computed on some input keys, so it follows the most common implementation as\n  found in ethernet, gzip, png, etc... it is slower than the other algorithms\n  but may provide a better or at least less predictable distribution. it must\n  not be used for security purposes as a 32-bit hash is trivial to break. see\n  also \"djb2\", \"sdbm\", \"wt6\" and the \"hash-type\" directive.\n\nda-csv(<prop>[,<prop>*])\n  asks the deviceatlas converter to identify the user agent string passed on\n  input, and to emit a string made of the concatenation of the properties\n  enumerated in argument, delimited by the separator defined by the global\n  keyword \"deviceatlas-property-separator\", or by default the pipe character\n  ('|'). there's a limit of 5 different properties imposed by the haproxy\n  configuration language.\n\n  example:\n    frontend www\n\tbind *:8881\n\tdefault_backend servers\n\thttp-request set-header x-deviceatlas-data %[req.fhdr(user-agent),da-csv(primaryhardwaretype,osname,osversion,browsername,browserversion)]\n\ndebug\n  this converter is used as debug tool. it dumps on screen the content and the\n  type of the input sample. the sample is returned as is on its output. this\n  converter only exists when haproxy was built with debugging enabled.\n\ndiv(<value>)\n  divides the input value of type signed integer by <value>, and returns the\n  result as an signed integer. if <value> is null, the largest unsigned\n  integer is returned (typically 2^63-1). <value> can be a numeric value or a\n  variable name. the name of the variable starts by an indication about it\n  scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\ndjb2([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the djb2\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"sdbm\", \"wt6\" and the\n  \"hash-type\" directive.\n\neven\n  returns a boolean true if the input value of type signed integer is even\n  otherwise returns false. it is functionally equivalent to \"not,and(1),bool\".\n\nfield(<index>,<delimiters>)\n  extracts the substring at the given index considering given delimiters from\n  an input string. indexes start at 1 and delimiters are a string formatted\n  list of chars.\n\nhex\n  converts a binary input sample to an hex string containing two hex digits per\n  input byte. it is used to log or transfer hex dumps of some binary input data\n  in a way that can be reliably transferred (eg: an ssl id can be copied in a\n  header).\n\nhttp_date([<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in a format suitable for use in http header fields. if\n  an offset value is specified, then it is a number of seconds that is added to\n  the date before the conversion is operated. this is particularly useful to\n  emit date header fields, expires values in responses when combined with a\n  positive offset, or last-modified values when the offset is negative.\n\nin_table(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, a boolean false\n  is returned. otherwise a boolean true is returned. this can be used to verify\n  the presence of a certain key in a table tracking some elements (eg: whether\n  or not a source ip address or an authorization header was already seen).\n\nipmask(<mask>)\n  apply a mask to an ipv4 address, and use the result for lookups and storage.\n  this can be used to make all hosts within a certain mask to share the same\n  table entries and as such use the same server. the mask can be passed in\n  dotted form (eg: 255.255.255.0) or in cidr form (eg: 24).\n\njson([<input-code>])\n  escapes the input string and produces an ascii ouput string ready to use as a\n  json string. the converter tries to decode the input string according to the\n  <input-code> parameter. it can be \"ascii\", \"utf8\", \"utf8s\", \"utf8\"\" or\n  \"utf8ps\". the \"ascii\" decoder never fails. the \"utf8\" decoder detects 3 types\n  of errors:\n   - bad utf-8 sequence (lone continuation byte, bad number of continuation\n     bytes, ...)\n   - invalid range (the decoded value is within a utf-8 prohibited range),\n   - code overlong (the value is encoded with more bytes than necessary).\n\n  the utf-8 json encoding can produce a \"too long value\" error when the utf-8\n  character is greater than 0xffff because the json string escape specification\n  only authorizes 4 hex digits for the value encoding. the utf-8 decoder exists\n  in 4 variants designated by a combination of two suffix letters : \"p\" for\n  \"permissive\" and \"s\" for \"silently ignore\". the behaviors of the decoders\n  are :\n   - \"ascii\"  : never fails ;\n   - \"utf8\"   : fails on any detected errors ;\n   - \"utf8s\"  : never fails, but removes characters corresponding to errors ;\n   - \"utf8p\"  : accepts and fixes the overlong errors, but fails on any other\n                error ;\n   - \"utf8ps\" : never fails, accepts and fixes the overlong errors, but removes\n                characters corresponding to the other errors.\n\n  this converter is particularly useful for building properly escaped json for\n  logging to servers which consume json-formated traffic logs.\n\n  example:\n     capture request header user-agent len 150\n     capture request header host len 15\n     log-format {\"ip\":\"%[src]\",\"user-agent\":\"%[capture.req.hdr(1),json]\"}\n\n  input request from client 127.0.0.1:\n     get / http/1.0\n     user-agent: very \"ugly\" ua 1/2\n\n  output log:\n     {\"ip\":\"127.0.0.1\",\"user-agent\":\"very \\\"ugly\\\" ua 1\\/2\"}\n\nlanguage(<value>[,<default>])\n  returns the value with the highest q-factor from a list as extracted from the\n  \"accept-language\" header using \"req.fhdr\". values with no q-factor have a\n  q-factor of 1\\. values with a q-factor of 0 are dropped. only values which\n  belong to the list of semi-colon delimited <values> will be considered. the\n  argument <value> syntax is \"lang[;lang[;lang[;...]]]\". if no value matches the\n  given list and a default value is provided, it is returned. note that language\n  names may have a variant after a dash ('-'). if this variant is present in the\n  list, it will be matched, but if it is not, only the base language is checked.\n  the match is case-sensitive, and the output string is always one of those\n  provided in arguments.  the ordering of arguments is meaningless, only the\n  ordering of the values in the request counts, as the first value among\n  multiple sharing the same q-factor is used.\n\n  example :\n\n    # this configuration switches to the backend matching a\n    # given language based on the request :\n\n    acl es req.fhdr(accept-language),language(es;fr;en) -m str es\n    acl fr req.fhdr(accept-language),language(es;fr;en) -m str fr\n    acl en req.fhdr(accept-language),language(es;fr;en) -m str en\n    use_backend spanish if es\n    use_backend french  if fr\n    use_backend english if en\n    default_backend choose_your_language\n\nlower\n  convert a string sample to lower case. this can only be placed after a string\n  sample fetch function or after a transformation keyword returning a string\n  type. the result is of type string.\n\nltime(<format>[,<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in local time using a format defined by the <format>\n  string using strftime(3). the purpose is to allow any date format to be used\n  in logs. an optional <offset> in seconds may be applied to the input date\n  (positive or negative). see the strftime() man page for the format supported\n  by your operating system. see also the utime converter.\n\n  example :\n\n      # emit two colons, one with the local time and another with ip:port\n      # eg:  20140710162350 127.0.0.1:57325\n      log-format %[date,ltime(%y%m%d%h%m%s)]\\ %ci:%cp\n\nmap(<map_file>[,<default_value>])\nmap_<match_type>(<map_file>[,<default_value>])\nmap_<match_type>_<output_type>(<map_file>[,<default_value>])\n  search the input value from <map_file> using the <match_type> matching method,\n  and return the associated value converted to the type <output_type>. if the\n  input value cannot be found in the <map_file>, the converter returns the\n  <default_value>. if the <default_value> is not set, the converter fails and\n  acts as if no input value could be fetched. if the <match_type> is not set, it\n  defaults to \"str\". likewise, if the <output_type> is not set, it defaults to\n  \"str\". for convenience, the \"map\" keyword is an alias for \"map_str\" and maps a\n  string to another string.\n\n  it is important to avoid overlapping between the keys : ip addresses and\n  strings are stored in trees, so the first of the finest match will be used.\n  other keys are stored in lists, so the first matching occurrence will be used.\n\n  the following array contains the list of all map functions avalaible sorted by\n  input type, match type and output type.\n\n  input type | match method | output type str | output type int | output type ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | str          | map_str         | map_str_int     | map_str_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | beg          | map_beg         | map_beg_int     | map_end_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | sub          | map_sub         | map_sub_int     | map_sub_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | dir          | map_dir         | map_dir_int     | map_dir_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | dom          | map_dom         | map_dom_int     | map_dom_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | end          | map_end         | map_end_int     | map_end_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    str      | reg          | map_reg         | map_reg_int     | map_reg_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    int      | int          | map_int         | map_int_int     | map_int_ip\n  -----------+--------------+-----------------+-----------------+---------------\n    ip       | ip           | map_ip          | map_ip_int      | map_ip_ip\n  -----------+--------------+-----------------+-----------------+---------------\n\n  the file contains one key + value per line. lines which start with '#' are\n  ignored, just like empty lines. leading tabs and spaces are stripped. the key\n  is then the first \"word\" (series of non-space/tabs characters), and the value\n  is what follows this series of space/tab till the end of the line excluding\n  trailing spaces/tabs.\n\n  example :\n\n     # this is a comment and is ignored\n        2.22.246.0/23    united kingdom      \\n\n     <-><-----------><--><------------><---->\n      |       |       |         |        `- trailing spaces ignored\n      |       |       |         `---------- value\n      |       |       `-------------------- middle spaces ignored\n      |       `---------------------------- key\n      `------------------------------------ leading spaces ignored\n\nmod(<value>)\n  divides the input value of type signed integer by <value>, and returns the\n  remainder as an signed integer. if <value> is null, then zero is returned.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nmul(<value>)\n  multiplies the input value of type signed integer by <value>, and returns\n  the product as an signed integer. in case of overflow, the largest possible\n  value for the sign is returned so that the operation doesn't wrap around.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nneg\n  takes the input value of type signed integer, computes the opposite value,\n  and returns the remainder as an signed integer. 0 is identity. this operator\n  is provided for reversed subtracts : in order to subtract the input from a\n  constant, simply perform a \"neg,add(value)\".\n\nnot\n  returns a boolean false if the input value of type signed integer is\n  non-null, otherwise returns true. used in conjunction with and(), it can be\n  used to report true/false for bit testing on input values (eg: verify the\n  absence of a flag).\n\nodd\n  returns a boolean true if the input value of type signed integer is odd\n  otherwise returns false. it is functionally equivalent to \"and(1),bool\".\n\nor(<value>)\n  performs a bitwise \"or\" between <value> and the input value of type signed\n  integer, and returns the result as an signed integer. <value> can be a\n  numeric value or a variable name. the name of the variable starts by an\n  indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nregsub(<regex>,<subst>[,<flags>])\n  applies a regex-based substitution to the input string. it does the same\n  operation as the well-known \"sed\" utility with \"s/<regex>/<subst>/\". by\n  default it will replace in the input string the first occurrence of the\n  largest part matching the regular expression <regex> with the substitution\n  string <subst>. it is possible to replace all occurrences instead by adding\n  the flag \"g\" in the third argument <flags>. it is also possible to make the\n  regex case insensitive by adding the flag \"i\" in <flags>. since <flags> is a\n  string, it is made up from the concatenation of all desired flags. thus if\n  both \"i\" and \"g\" are desired, using \"gi\" or \"ig\" will have the same effect.\n  it is important to note that due to the current limitations of the\n  configuration parser, some characters such as closing parenthesis or comma\n  are not possible to use in the arguments. the first use of this converter is\n  to replace certain characters or sequence of characters with other ones.\n\n  example :\n\n     # de-duplicate \"/\" in header \"x-path\".\n     # input:  x-path: /////a///b/c/xzxyz/\n     # output: x-path: /a/b/c/xzxyz/\n     http-request set-header x-path %[hdr(x-path),regsub(/+,/,g)]\n\ncapture-req(<id>)\n  capture the string entry in the request slot <id> and returns the entry as\n  is. if the slot doesn't exist, the capture fails silently.\n\n  see also: \"declare capture\", \"http-request capture\",\n            \"http-response capture\", \"req.hdr.capture\" and\n            \"res.hdr.capture\" (sample fetches).\n\ncapture-res(<id>)\n  capture the string entry in the response slot <id> and returns the entry as\n  is. if the slot doesn't exist, the capture fails silently.\n\n  see also: \"declare capture\", \"http-request capture\",\n            \"http-response capture\", \"req.hdr.capture\" and\n            \"res.hdr.capture\" (sample fetches).\n\nsdbm([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the sdbm\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"djb2\", \"wt6\" and the\n  \"hash-type\" directive.\n\nset-var(<var name>)\n  sets a variable with the input content and return the content on the output as\n  is. the variable keep the value and the associated input type. the name of the\n  variable starts by an indication about it scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\nsub(<value>)\n  subtracts <value> from the input value of type signed integer, and returns\n  the result as an signed integer. note: in order to subtract the input from\n  a constant, simply perform a \"neg,add(value)\". <value> can be a numeric value\n  or a variable name. the name of the variable starts by an indication about its\n  scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\ntable_bytes_in_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average client-to-server\n  bytes rate associated with the input sample in the designated table, measured\n  in amount of bytes over the period configured in the table. see also the\n  sc_bytes_in_rate sample fetch keyword.\n\ntable_bytes_out_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average server-to-client\n  bytes rate associated with the input sample in the designated table, measured\n  in amount of bytes over the period configured in the table. see also the\n  sc_bytes_out_rate sample fetch keyword.\n\ntable_conn_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of incoming\n  connections associated with the input sample in the designated table. see\n  also the sc_conn_cnt sample fetch keyword.\n\ntable_conn_cur(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current amount of concurrent\n  tracked connections associated with the input sample in the designated table.\n  see also the sc_conn_cur sample fetch keyword.\n\ntable_conn_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average incoming connection\n  rate associated with the input sample in the designated table. see also the\n  sc_conn_rate sample fetch keyword.\n\ntable_gpc0(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current value of the first\n  general purpose counter associated with the input sample in the designated\n  table. see also the sc_get_gpc0 sample fetch keyword.\n\ntable_gpc0_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the frequency which the gpc0\n  counter was incremented over the configured period in the table, associated\n  with the input sample in the designated table. see also the sc_get_gpc0_rate\n  sample fetch keyword.\n\ntable_http_err_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of http\n  errors associated with the input sample in the designated table. see also the\n  sc_http_err_cnt sample fetch keyword.\n\ntable_http_err_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the average rate of http errors associated with the\n  input sample in the designated table, measured in amount of errors over the\n  period configured in the table. see also the sc_http_err_rate sample fetch\n  keyword.\n\ntable_http_req_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of http\n  requests associated with the input sample in the designated table. see also\n  the sc_http_req_cnt sample fetch keyword.\n\ntable_http_req_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the average rate of http requests associated with the\n  input sample in the designated table, measured in amount of requests over the\n  period configured in the table. see also the sc_http_req_rate sample fetch\n  keyword.\n\ntable_kbytes_in(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of client-\n  to-server data associated with the input sample in the designated table,\n  measured in kilobytes. the test is currently performed on 32-bit integers,\n  which limits values to 4 terabytes. see also the sc_kbytes_in sample fetch\n  keyword.\n\ntable_kbytes_out(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of server-\n  to-client data associated with the input sample in the designated table,\n  measured in kilobytes. the test is currently performed on 32-bit integers,\n  which limits values to 4 terabytes. see also the sc_kbytes_out sample fetch\n  keyword.\n\ntable_server_id(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the server id associated with\n  the input sample in the designated table. a server id is associated to a\n  sample by a \"stick\" rule when a connection to a server succeeds. a server id\n  zero means that no server is associated with this key.\n\ntable_sess_cnt(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the cumulated amount of incoming\n  sessions associated with the input sample in the designated table. note that\n  a session here refers to an incoming connection being accepted by the\n  \"tcp-request connection\" rulesets. see also the sc_sess_cnt sample fetch\n  keyword.\n\ntable_sess_rate(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the average incoming session\n  rate associated with the input sample in the designated table. note that a\n  session here refers to an incoming connection being accepted by the\n  \"tcp-request connection\" rulesets. see also the sc_sess_rate sample fetch\n  keyword.\n\ntable_trackers(<table>)\n  uses the string representation of the input sample to perform a look up in\n  the specified table. if the key is not found in the table, integer value zero\n  is returned. otherwise the converter returns the current amount of concurrent\n  connections tracking the same key as the input sample in the designated\n  table. it differs from table_conn_cur in that it does not rely on any stored\n  information but on the table's reference count (the \"use\" value which is\n  returned by \"show table\" on the cli). this may sometimes be more suited for\n  layer7 tracking. it can be used to tell a server how many concurrent\n  connections there are from a given address for example. see also the\n  sc_trackers sample fetch keyword.\n\nupper\n  convert a string sample to upper case. this can only be placed after a string\n  sample fetch function or after a transformation keyword returning a string\n  type. the result is of type string.\n\nurl_dec\n  takes an url-encoded string provided as input and returns the decoded\n  version as output. the input and the output are of type string.\n\nutime(<format>[,<offset>])\n  converts an integer supposed to contain a date since epoch to a string\n  representing this date in utc time using a format defined by the <format>\n  string using strftime(3). the purpose is to allow any date format to be used\n  in logs. an optional <offset> in seconds may be applied to the input date\n  (positive or negative). see the strftime() man page for the format supported\n  by your operating system. see also the ltime converter.\n\n  example :\n\n      # emit two colons, one with the utc time and another with ip:port\n      # eg:  20140710162350 127.0.0.1:57325\n      log-format %[date,utime(%y%m%d%h%m%s)]\\ %ci:%cp\n\nword(<index>,<delimiters>)\n  extracts the nth word considering given delimiters from an input string.\n  indexes start at 1 and delimiters are a string formatted list of chars.\n\nwt6([<avalanche>])\n  hashes a binary input sample into an unsigned 32-bit quantity using the wt6\n  hash function. optionally, it is possible to apply a full avalanche hash\n  function to the output if the optional <avalanche> argument equals 1\\. this\n  converter uses the same functions as used by the various hash-based load\n  balancing algorithms, so it will provide exactly the same results. it is\n  mostly intended for debugging, but can be used as a stick-table entry to\n  collect rough statistics. it must not be used for security purposes as a\n  32-bit hash is trivial to break. see also \"crc32\", \"djb2\", \"sdbm\", and the\n  \"hash-type\" directive.\n\nxor(<value>)\n  performs a bitwise \"xor\" (exclusive or) between <value> and the input value\n  of type signed integer, and returns the result as an signed integer.\n  <value> can be a numeric value or a variable name. the name of the variable\n  starts by an indication about its scope. the allowed scopes are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n7.3.2\\. fetching samples from internal states\n--------------------------------------------\n\na first set of sample fetch methods applies to internal information which does\nnot even relate to any client information. these ones are sometimes used with\n\"monitor-fail\" directives to report an internal status to external watchers.\nthe sample fetch methods described in this section are usable anywhere.\n\nalways_false : boolean\n  always returns the boolean \"false\" value. it may be used with acls as a\n  temporary replacement for another one when adjusting configurations.\n\nalways_true : boolean\n  always returns the boolean \"true\" value. it may be used with acls as a\n  temporary replacement for another one when adjusting configurations.\n\navg_queue([<backend>]) : integer\n  returns the total number of queued connections of the designated backend\n  divided by the number of active servers. the current backend is used if no\n  backend is specified. this is very similar to \"queue\" except that the size of\n  the farm is considered, in order to give a more accurate measurement of the\n  time it may take for a new connection to be processed. the main usage is with\n  acl to return a sorry page to new users when it becomes certain they will get\n  a degraded service, or to pass to the backend servers in a header so that\n  they decide to work in degraded mode or to disable some functions to speed up\n  the processing a bit. note that in the event there would not be any active\n  server anymore, twice the number of queued connections would be considered as\n  the measured value. this is a fair estimate, as we expect one server to get\n  back soon anyway, but we still prefer to send new traffic to another backend\n  if in better shape. see also the \"queue\", \"be_conn\", and \"be_sess_rate\"\n  sample fetches.\n\nbe_conn([<backend>]) : integer\n  applies to the number of currently established connections on the backend,\n  possibly including the connection being evaluated. if no backend name is\n  specified, the current one is used. but it is also possible to check another\n  backend. it can be used to use a specific farm when the nominal one is full.\n  see also the \"fe_conn\", \"queue\" and \"be_sess_rate\" criteria.\n\nbe_sess_rate([<backend>]) : integer\n  returns an integer value corresponding to the sessions creation rate on the\n  backend, in number of new sessions per second. this is used with acls to\n  switch to an alternate backend when an expensive or fragile one reaches too\n  high a session rate, or to limit abuse of service (eg. prevent sucking of an\n  online dictionary). it can also be useful to add this element to logs using a\n  log-format directive.\n\n  example :\n        # redirect to an error page if the dictionary is requested too often\n        backend dynamic\n            mode http\n            acl being_scanned be_sess_rate gt 100\n            redirect location /denied.html if being_scanned\n\nbin(<hexa>) : bin\n  returns a binary chain. the input is the hexadecimal representation\n  of the string.\n\nbool(<bool>) : bool\n  returns a boolean value. <bool> can be 'true', 'false', '1' or '0'.\n  'false' and '0' are the same. 'true' and '1' are the same.\n\nconnslots([<backend>]) : integer\n  returns an integer value corresponding to the number of connection slots\n  still available in the backend, by totaling the maximum amount of\n  connections on all servers and the maximum queue size. this is probably only\n  used with acls.\n\n  the basic idea here is to be able to measure the number of connection \"slots\"\n  still available (connection + queue), so that anything beyond that (intended\n  usage; see \"use_backend\" keyword) can be redirected to a different backend.\n\n  'connslots' = number of available server connection slots, + number of\n  available server queue slots.\n\n  note that while \"fe_conn\" may be used, \"connslots\" comes in especially\n  useful when you have a case of traffic going to one single ip, splitting into\n  multiple backends (perhaps using acls to do name-based load balancing) and\n  you want to be able to differentiate between different backends, and their\n  available \"connslots\".  also, whereas \"nbsrv\" only measures servers that are\n  actually *down*, this fetch is more fine-grained and looks into the number of\n  available connection slots as well. see also \"queue\" and \"avg_queue\".\n\n  other caveats and notes: at this point in time, the code does not take care\n  of dynamic connections. also, if any of the server maxconn, or maxqueue is 0,\n  then this fetch clearly does not make sense, in which case the value returned\n  will be -1.\n\ndate([<offset>]) : integer\n  returns the current date as the epoch (number of seconds since 01/01/1970).\n  if an offset value is specified, then it is a number of seconds that is added\n  to the current date before returning the value. this is particularly useful\n  to compute relative dates, as both positive and negative offsets are allowed.\n  it is useful combined with the http_date converter.\n\n  example :\n\n     # set an expires header to now+1 hour in every response\n     http-response set-header expires %[date(3600),http_date]\n\nenv(<name>) : string\n  returns a string containing the value of environment variable <name>. as a\n  reminder, environment variables are per-process and are sampled when the\n  process starts. this can be useful to pass some information to a next hop\n  server, or with acls to take specific action when the process is started a\n  certain way.\n\n  examples :\n      # pass the via header to next hop with the local hostname in it\n      http-request add-header via 1.1\\ %[env(hostname)]\n\n      # reject cookie-less requests when the stop environment variable is set\n      http-request deny if !{ cook(sessionid) -m found } { env(stop) -m found }\n\nfe_conn([<frontend>]) : integer\n  returns the number of currently established connections on the frontend,\n  possibly including the connection being evaluated. if no frontend name is\n  specified, the current one is used. but it is also possible to check another\n  frontend. it can be used to return a sorry page before hard-blocking, or to\n  use a specific backend to drain new requests when the farm is considered\n  full.  this is mostly used with acls but can also be used to pass some\n  statistics to servers in http headers. see also the \"dst_conn\", \"be_conn\",\n  \"fe_sess_rate\" fetches.\n\nfe_sess_rate([<frontend>]) : integer\n  returns an integer value corresponding to the sessions creation rate on the\n  frontend, in number of new sessions per second. this is used with acls to\n  limit the incoming session rate to an acceptable range in order to prevent\n  abuse of service at the earliest moment, for example when combined with other\n  layer 4 acls in order to force the clients to wait a bit for the rate to go\n  down below the limit. it can also be useful to add this element to logs using\n  a log-format directive. see also the \"rate-limit sessions\" directive for use\n  in frontends.\n\n  example :\n        # this frontend limits incoming mails to 10/s with a max of 100\n        # concurrent connections. we accept any connection below 10/s, and\n        # force excess clients to wait for 100 ms. since clients are limited to\n        # 100 max, there cannot be more than 10 incoming mails per second.\n        frontend mail\n            bind :25\n            mode tcp\n            maxconn 100\n            acl too_fast fe_sess_rate ge 10\n            tcp-request inspect-delay 100ms\n            tcp-request content accept if ! too_fast\n            tcp-request content accept if wait_end\n\nint(<integer>) : signed integer\n  returns a signed integer.\n\nipv4(<ipv4>) : ipv4\n  returns an ipv4.\n\nipv6(<ipv6>) : ipv6\n  returns an ipv6.\n\nmeth(<method>) : method\n  returns a method.\n\nnbproc : integer\n  returns an integer value corresponding to the number of processes that were\n  started (it equals the global \"nbproc\" setting). this is useful for logging\n  and debugging purposes.\n\nnbsrv([<backend>]) : integer\n  returns an integer value corresponding to the number of usable servers of\n  either the current backend or the named backend. this is mostly used with\n  acls but can also be useful when added to logs. this is normally used to\n  switch to an alternate backend when the number of servers is too low to\n  to handle some load. it is useful to report a failure when combined with\n  \"monitor fail\".\n\nproc : integer\n  returns an integer value corresponding to the position of the process calling\n  the function, between 1 and global.nbproc. this is useful for logging and\n  debugging purposes.\n\nqueue([<backend>]) : integer\n  returns the total number of queued connections of the designated backend,\n  including all the connections in server queues. if no backend name is\n  specified, the current one is used, but it is also possible to check another\n  one. this is useful with acls or to pass statistics to backend servers. this\n  can be used to take actions when queuing goes above a known level, generally\n  indicating a surge of traffic or a massive slowdown on the servers. one\n  possible action could be to reject new users but still accept old ones. see\n  also the \"avg_queue\", \"be_conn\", and \"be_sess_rate\" fetches.\n\nrand([<range>]) : integer\n  returns a random integer value within a range of <range> possible values,\n  starting at zero. if the range is not specified, it defaults to 2^32, which\n  gives numbers between 0 and 4294967295\\. it can be useful to pass some values\n  needed to take some routing decisions for example, or just for debugging\n  purposes. this random must not be used for security purposes.\n\nsrv_conn([<backend>/]<server>) : integer\n  returns an integer value corresponding to the number of currently established\n  connections on the designated server, possibly including the connection being\n  evaluated. if <backend> is omitted, then the server is looked up in the\n  current backend. it can be used to use a specific farm when one server is\n  full, or to inform the server about our view of the number of active\n  connections with it. see also the \"fe_conn\", \"be_conn\" and \"queue\" fetch\n  methods.\n\nsrv_is_up([<backend>/]<server>) : boolean\n  returns true when the designated server is up, and false when it is either\n  down or in maintenance mode. if <backend> is omitted, then the server is\n  looked up in the current backend. it is mainly used to take action based on\n  an external status reported via a health check (eg: a geographical site's\n  availability). another possible use which is more of a hack consists in\n  using dummy servers as boolean variables that can be enabled or disabled from\n  the cli, so that rules depending on those acls can be tweaked in realtime.\n\nsrv_sess_rate([<backend>/]<server>) : integer\n  returns an integer corresponding to the sessions creation rate on the\n  designated server, in number of new sessions per second. if <backend> is\n  omitted, then the server is looked up in the current backend. this is mostly\n  used with acls but can make sense with logs too. this is used to switch to an\n  alternate backend when an expensive or fragile one reaches too high a session\n  rate, or to limit abuse of service (eg. prevent latent requests from\n  overloading servers).\n\n  example :\n        # redirect to a separate back\n        acl srv1_full srv_sess_rate(be1/srv1) gt 50\n        acl srv2_full srv_sess_rate(be1/srv2) gt 50\n        use_backend be2 if srv1_full or srv2_full\n\nstopping : boolean\n  returns true if the process calling the function is currently stopping. this\n  can be useful for logging, or for relaxing certain checks or helping close\n  certain connections upon graceful shutdown.\n\nstr(<string>) : string\n  returns a string.\n\ntable_avl([<table>]) : integer\n  returns the total number of available entries in the current proxy's\n  stick-table or in the designated stick-table. see also table_cnt.\n\ntable_cnt([<table>]) : integer\n  returns the total number of entries currently in use in the current proxy's\n  stick-table or in the designated stick-table. see also src_conn_cnt and\n  table_avl for other entry counting methods.\n\nvar(<var-name>) : undefined\n  returns a variable with the stored type. if the variable is not set, the\n  sample fetch fails. the name of the variable starts by an indication about its\n  scope. the scope allowed are:\n    \"sess\" : the variable is shared with all the session,\n    \"txn\"  : the variable is shared with all the transaction (request and\n             response),\n    \"req\"  : the variable is shared only during the request processing,\n    \"res\"  : the variable is shared only during the response processing.\n  this prefix is followed by a name. the separator is a '.'. the name may only\n  contain characters 'a-z', 'a-z', '0-9' and '_'.\n\n7.3.3\\. fetching samples at layer 4\n----------------------------------\n\nthe layer 4 usually describes just the transport layer which in haproxy is\nclosest to the connection, where no content is yet made available. the fetch\nmethods described here are usable as low as the \"tcp-request connection\" rule\nsets unless they require some future information. those generally include\ntcp/ip addresses and ports, as well as elements from stick-tables related to\nthe incoming connection. for retrieving a value from a sticky counters, the\ncounter number can be explicitly set as 0, 1, or 2 using the pre-defined\n\"sc0_\", \"sc1_\", or \"sc2_\" prefix, or it can be specified as the first integer\nargument when using the \"sc_\" prefix. an optional table may be specified with\nthe \"sc*\" form, in which case the currently tracked key will be looked up into\nthis alternate table instead of the table currently being tracked.\n\nbe_id : integer\n  returns an integer containing the current backend's id. it can be used in\n  frontends with responses to check which backend processed the request.\n\ndst : ip\n  this is the destination ipv4 address of the connection on the client side,\n  which is the address the client connected to. it can be useful when running\n  in transparent mode. it is of type ip and works on both ipv4 and ipv6 tables.\n  on ipv6 tables, ipv4 address is mapped to its ipv6 equivalent, according to\n  rfc 4291.\n\ndst_conn : integer\n  returns an integer value corresponding to the number of currently established\n  connections on the same socket including the one being evaluated. it is\n  normally used with acls but can as well be used to pass the information to\n  servers in an http header or in logs. it can be used to either return a sorry\n  page before hard-blocking, or to use a specific backend to drain new requests\n  when the socket is considered saturated. this offers the ability to assign\n  different limits to different listening ports or addresses. see also the\n  \"fe_conn\" and \"be_conn\" fetches.\n\ndst_port : integer\n  returns an integer value corresponding to the destination tcp port of the\n  connection on the client side, which is the port the client connected to.\n  this might be used when running in transparent mode, when assigning dynamic\n  ports to some clients for a whole application session, to stick all users to\n  a same server, or to pass the destination port information to a server using\n  an http header.\n\nfe_id : integer\n  returns an integer containing the current frontend's id. it can be used in\n  backends to check from which backend it was called, or to stick all users\n  coming via a same frontend to the same server.\n\nsc_bytes_in_rate(<ctr>[,<table>]) : integer\nsc0_bytes_in_rate([<table>]) : integer\nsc1_bytes_in_rate([<table>]) : integer\nsc2_bytes_in_rate([<table>]) : integer\n  returns the average client-to-server bytes rate from the currently tracked\n  counters, measured in amount of bytes over the period configured in the\n  table. see also src_bytes_in_rate.\n\nsc_bytes_out_rate(<ctr>[,<table>]) : integer\nsc0_bytes_out_rate([<table>]) : integer\nsc1_bytes_out_rate([<table>]) : integer\nsc2_bytes_out_rate([<table>]) : integer\n  returns the average server-to-client bytes rate from the currently tracked\n  counters, measured in amount of bytes over the period configured in the\n  table. see also src_bytes_out_rate.\n\nsc_clr_gpc0(<ctr>[,<table>]) : integer\nsc0_clr_gpc0([<table>]) : integer\nsc1_clr_gpc0([<table>]) : integer\nsc2_clr_gpc0([<table>]) : integer\n  clears the first general purpose counter associated to the currently tracked\n  counters, and returns its previous value. before the first invocation, the\n  stored value is zero, so first invocation will always return zero. this is\n  typically used as a second acl in an expression in order to mark a connection\n  when a first acl was verified :\n\n        # block if 5 consecutive requests continue to come faster than 10 sess\n        # per second, and reset the counter as soon as the traffic slows down.\n        acl abuse sc0_http_req_rate gt 10\n        acl kill  sc0_inc_gpc0 gt 5\n        acl save  sc0_clr_gpc0 ge 0\n        tcp-request connection accept if !abuse save\n        tcp-request connection reject if abuse kill\n\nsc_conn_cnt(<ctr>[,<table>]) : integer\nsc0_conn_cnt([<table>]) : integer\nsc1_conn_cnt([<table>]) : integer\nsc2_conn_cnt([<table>]) : integer\n  returns the cumulated number of incoming connections from currently tracked\n  counters. see also src_conn_cnt.\n\nsc_conn_cur(<ctr>[,<table>]) : integer\nsc0_conn_cur([<table>]) : integer\nsc1_conn_cur([<table>]) : integer\nsc2_conn_cur([<table>]) : integer\n  returns the current amount of concurrent connections tracking the same\n  tracked counters. this number is automatically incremented when tracking\n  begins and decremented when tracking stops. see also src_conn_cur.\n\nsc_conn_rate(<ctr>[,<table>]) : integer\nsc0_conn_rate([<table>]) : integer\nsc1_conn_rate([<table>]) : integer\nsc2_conn_rate([<table>]) : integer\n  returns the average connection rate from the currently tracked counters,\n  measured in amount of connections over the period configured in the table.\n  see also src_conn_rate.\n\nsc_get_gpc0(<ctr>[,<table>]) : integer\nsc0_get_gpc0([<table>]) : integer\nsc1_get_gpc0([<table>]) : integer\nsc2_get_gpc0([<table>]) : integer\n  returns the value of the first general purpose counter associated to the\n  currently tracked counters. see also src_get_gpc0 and sc/sc0/sc1/sc2_inc_gpc0.\n\nsc_gpc0_rate(<ctr>[,<table>]) : integer\nsc0_gpc0_rate([<table>]) : integer\nsc1_gpc0_rate([<table>]) : integer\nsc2_gpc0_rate([<table>]) : integer\n  returns the average increment rate of the first general purpose counter\n  associated to the currently tracked counters. it reports the frequency\n  which the gpc0 counter was incremented over the configured period. see also\n  src_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0\\. note\n  that the \"gpc0_rate\" counter must be stored in the stick-table for a value to\n  be returned, as \"gpc0\" only holds the event count.\n\nsc_http_err_cnt(<ctr>[,<table>]) : integer\nsc0_http_err_cnt([<table>]) : integer\nsc1_http_err_cnt([<table>]) : integer\nsc2_http_err_cnt([<table>]) : integer\n  returns the cumulated number of http errors from the currently tracked\n  counters. this includes the both request errors and 4xx error responses.\n  see also src_http_err_cnt.\n\nsc_http_err_rate(<ctr>[,<table>]) : integer\nsc0_http_err_rate([<table>]) : integer\nsc1_http_err_rate([<table>]) : integer\nsc2_http_err_rate([<table>]) : integer\n  returns the average rate of http errors from the currently tracked counters,\n  measured in amount of errors over the period configured in the table. this\n  includes the both request errors and 4xx error responses. see also\n  src_http_err_rate.\n\nsc_http_req_cnt(<ctr>[,<table>]) : integer\nsc0_http_req_cnt([<table>]) : integer\nsc1_http_req_cnt([<table>]) : integer\nsc2_http_req_cnt([<table>]) : integer\n  returns the cumulated number of http requests from the currently tracked\n  counters. this includes every started request, valid or not. see also\n  src_http_req_cnt.\n\nsc_http_req_rate(<ctr>[,<table>]) : integer\nsc0_http_req_rate([<table>]) : integer\nsc1_http_req_rate([<table>]) : integer\nsc2_http_req_rate([<table>]) : integer\n  returns the average rate of http requests from the currently tracked\n  counters, measured in amount of requests over the period configured in\n  the table. this includes every started request, valid or not. see also\n  src_http_req_rate.\n\nsc_inc_gpc0(<ctr>[,<table>]) : integer\nsc0_inc_gpc0([<table>]) : integer\nsc1_inc_gpc0([<table>]) : integer\nsc2_inc_gpc0([<table>]) : integer\n  increments the first general purpose counter associated to the currently\n  tracked counters, and returns its new value. before the first invocation,\n  the stored value is zero, so first invocation will increase it to 1 and will\n  return 1\\. this is typically used as a second acl in an expression in order\n  to mark a connection when a first acl was verified :\n\n        acl abuse sc0_http_req_rate gt 10\n        acl kill  sc0_inc_gpc0 gt 0\n        tcp-request connection reject if abuse kill\n\nsc_kbytes_in(<ctr>[,<table>]) : integer\nsc0_kbytes_in([<table>]) : integer\nsc1_kbytes_in([<table>]) : integer\nsc2_kbytes_in([<table>]) : integer\n  returns the total amount of client-to-server data from the currently tracked\n  counters, measured in kilobytes. the test is currently performed on 32-bit\n  integers, which limits values to 4 terabytes. see also src_kbytes_in.\n\nsc_kbytes_out(<ctr>[,<table>]) : integer\nsc0_kbytes_out([<table>]) : integer\nsc1_kbytes_out([<table>]) : integer\nsc2_kbytes_out([<table>]) : integer\n  returns the total amount of server-to-client data from the currently tracked\n  counters, measured in kilobytes. the test is currently performed on 32-bit\n  integers, which limits values to 4 terabytes. see also src_kbytes_out.\n\nsc_sess_cnt(<ctr>[,<table>]) : integer\nsc0_sess_cnt([<table>]) : integer\nsc1_sess_cnt([<table>]) : integer\nsc2_sess_cnt([<table>]) : integer\n  returns the cumulated number of incoming connections that were transformed\n  into sessions, which means that they were accepted by a \"tcp-request\n  connection\" rule, from the currently tracked counters. a backend may count\n  more sessions than connections because each connection could result in many\n  backend sessions if some http keep-alive is performed over the connection\n  with the client. see also src_sess_cnt.\n\nsc_sess_rate(<ctr>[,<table>]) : integer\nsc0_sess_rate([<table>]) : integer\nsc1_sess_rate([<table>]) : integer\nsc2_sess_rate([<table>]) : integer\n  returns the average session rate from the currently tracked counters,\n  measured in amount of sessions over the period configured in the table. a\n  session is a connection that got past the early \"tcp-request connection\"\n  rules. a backend may count more sessions than connections because each\n  connection could result in many backend sessions if some http keep-alive is\n  performed over the connection with the client. see also src_sess_rate.\n\nsc_tracked(<ctr>[,<table>]) : boolean\nsc0_tracked([<table>]) : boolean\nsc1_tracked([<table>]) : boolean\nsc2_tracked([<table>]) : boolean\n  returns true if the designated session counter is currently being tracked by\n  the current session. this can be useful when deciding whether or not we want\n  to set some values in a header passed to the server.\n\nsc_trackers(<ctr>[,<table>]) : integer\nsc0_trackers([<table>]) : integer\nsc1_trackers([<table>]) : integer\nsc2_trackers([<table>]) : integer\n  returns the current amount of concurrent connections tracking the same\n  tracked counters. this number is automatically incremented when tracking\n  begins and decremented when tracking stops. it differs from sc0_conn_cur in\n  that it does not rely on any stored information but on the table's reference\n  count (the \"use\" value which is returned by \"show table\" on the cli). this\n  may sometimes be more suited for layer7 tracking. it can be used to tell a\n  server how many concurrent connections there are from a given address for\n  example.\n\nso_id : integer\n  returns an integer containing the current listening socket's id. it is useful\n  in frontends involving many \"bind\" lines, or to stick all users coming via a\n  same socket to the same server.\n\nsrc : ip\n  this is the source ipv4 address of the client of the session.  it is of type\n  ip and works on both ipv4 and ipv6 tables. on ipv6 tables, ipv4 addresses are\n  mapped to their ipv6 equivalent, according to rfc 4291\\. note that it is the\n  tcp-level source address which is used, and not the address of a client\n  behind a proxy. however if the \"accept-proxy\" bind directive is used, it can\n  be the address of a client behind another proxy-protocol compatible component\n  for all rule sets except \"tcp-request connection\" which sees the real address.\n\n  example:\n       # add an http header in requests with the originating address' country\n       http-request set-header x-country %[src,map_ip(geoip.lst)]\n\nsrc_bytes_in_rate([<table>]) : integer\n  returns the average bytes rate from the incoming connection's source address\n  in the current proxy's stick-table or in the designated stick-table, measured\n  in amount of bytes over the period configured in the table. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_in_rate.\n\nsrc_bytes_out_rate([<table>]) : integer\n  returns the average bytes rate to the incoming connection's source address in\n  the current proxy's stick-table or in the designated stick-table, measured in\n  amount of bytes over the period configured in the table. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_out_rate.\n\nsrc_clr_gpc0([<table>]) : integer\n  clears the first general purpose counter associated to the incoming\n  connection's source address in the current proxy's stick-table or in the\n  designated stick-table, and returns its previous value. if the address is not\n  found, an entry is created and 0 is returned. this is typically used as a\n  second acl in an expression in order to mark a connection when a first acl\n  was verified :\n\n        # block if 5 consecutive requests continue to come faster than 10 sess\n        # per second, and reset the counter as soon as the traffic slows down.\n        acl abuse src_http_req_rate gt 10\n        acl kill  src_inc_gpc0 gt 5\n        acl save  src_clr_gpc0 ge 0\n        tcp-request connection accept if !abuse save\n        tcp-request connection reject if abuse kill\n\nsrc_conn_cnt([<table>]) : integer\n  returns the cumulated number of connections initiated from the current\n  incoming connection's source address in the current proxy's stick-table or in\n  the designated stick-table. if the address is not found, zero is returned.\n  see also sc/sc0/sc1/sc2_conn_cnt.\n\nsrc_conn_cur([<table>]) : integer\n  returns the current amount of concurrent connections initiated from the\n  current incoming connection's source address in the current proxy's\n  stick-table or in the designated stick-table. if the address is not found,\n  zero is returned. see also sc/sc0/sc1/sc2_conn_cur.\n\nsrc_conn_rate([<table>]) : integer\n  returns the average connection rate from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of connections over the period configured in the table. if\n  the address is not found, zero is returned. see also sc/sc0/sc1/sc2_conn_rate.\n\nsrc_get_gpc0([<table>]) : integer\n  returns the value of the first general purpose counter associated to the\n  incoming connection's source address in the current proxy's stick-table or in\n  the designated stick-table. if the address is not found, zero is returned.\n  see also sc/sc0/sc1/sc2_get_gpc0 and src_inc_gpc0.\n\nsrc_gpc0_rate([<table>]) : integer\n  returns the average increment rate of the first general purpose counter\n  associated to the incoming connection's source address in the current proxy's\n  stick-table or in the designated stick-table. it reports the frequency\n  which the gpc0 counter was incremented over the configured period. see also\n  sc/sc0/sc1/sc2_gpc0_rate, src_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0\\. note\n  that the \"gpc0_rate\" counter must be stored in the stick-table for a value to\n  be returned, as \"gpc0\" only holds the event count.\n\nsrc_http_err_cnt([<table>]) : integer\n  returns the cumulated number of http errors from the incoming connection's\n  source address in the current proxy's stick-table or in the designated\n  stick-table. this includes the both request errors and 4xx error responses.\n  see also sc/sc0/sc1/sc2_http_err_cnt. if the address is not found, zero is\n  returned.\n\nsrc_http_err_rate([<table>]) : integer\n  returns the average rate of http errors from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of errors over the period configured in the table. this\n  includes the both request errors and 4xx error responses. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_err_rate.\n\nsrc_http_req_cnt([<table>]) : integer\n  returns the cumulated number of http requests from the incoming connection's\n  source address in the current proxy's stick-table or in the designated stick-\n  table. this includes every started request, valid or not. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_cnt.\n\nsrc_http_req_rate([<table>]) : integer\n  returns the average rate of http requests from the incoming connection's\n  source address in the current proxy's stick-table or in the designated stick-\n  table, measured in amount of requests over the period configured in the\n  table. this includes every started request, valid or not. if the address is\n  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_rate.\n\nsrc_inc_gpc0([<table>]) : integer\n  increments the first general purpose counter associated to the incoming\n  connection's source address in the current proxy's stick-table or in the\n  designated stick-table, and returns its new value. if the address is not\n  found, an entry is created and 1 is returned. see also sc0/sc2/sc2_inc_gpc0.\n  this is typically used as a second acl in an expression in order to mark a\n  connection when a first acl was verified :\n\n        acl abuse src_http_req_rate gt 10\n        acl kill  src_inc_gpc0 gt 0\n        tcp-request connection reject if abuse kill\n\nsrc_kbytes_in([<table>]) : integer\n  returns the total amount of data received from the incoming connection's\n  source address in the current proxy's stick-table or in the designated\n  stick-table, measured in kilobytes. if the address is not found, zero is\n  returned. the test is currently performed on 32-bit integers, which limits\n  values to 4 terabytes. see also sc/sc0/sc1/sc2_kbytes_in.\n\nsrc_kbytes_out([<table>]) : integer\n  returns the total amount of data sent to the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in kilobytes. if the address is not found, zero is returned. the\n  test is currently performed on 32-bit integers, which limits values to 4\n  terabytes. see also sc/sc0/sc1/sc2_kbytes_out.\n\nsrc_port : integer\n  returns an integer value corresponding to the tcp source port of the\n  connection on the client side, which is the port the client connected from.\n  usage of this function is very limited as modern protocols do not care much\n  about source ports nowadays.\n\nsrc_sess_cnt([<table>]) : integer\n  returns the cumulated number of connections initiated from the incoming\n  connection's source ipv4 address in the current proxy's stick-table or in the\n  designated stick-table, that were transformed into sessions, which means that\n  they were accepted by \"tcp-request\" rules. if the address is not found, zero\n  is returned. see also sc/sc0/sc1/sc2_sess_cnt.\n\nsrc_sess_rate([<table>]) : integer\n  returns the average session rate from the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table,\n  measured in amount of sessions over the period configured in the table. a\n  session is a connection that went past the early \"tcp-request\" rules. if the\n  address is not found, zero is returned. see also sc/sc0/sc1/sc2_sess_rate.\n\nsrc_updt_conn_cnt([<table>]) : integer\n  creates or updates the entry associated to the incoming connection's source\n  address in the current proxy's stick-table or in the designated stick-table.\n  this table must be configured to store the \"conn_cnt\" data type, otherwise\n  the match will be ignored. the current count is incremented by one, and the\n  expiration timer refreshed. the updated count is returned, so this match\n  can't return zero. this was used to reject service abusers based on their\n  source address. note: it is recommended to use the more complete \"track-sc*\"\n  actions in \"tcp-request\" rules instead.\n\n  example :\n        # this frontend limits incoming ssh connections to 3 per 10 second for\n        # each source address, and rejects excess connections until a 10 second\n        # silence is observed. at most 20 addresses are tracked.\n        listen ssh\n            bind :22\n            mode tcp\n            maxconn 100\n            stick-table type ip size 20 expire 10s store conn_cnt\n            tcp-request content reject if { src_updt_conn_cnt gt 3 }\n            server local 127.0.0.1:22\n\nsrv_id : integer\n  returns an integer containing the server's id when processing the response.\n  while it's almost only used with acls, it may be used for logging or\n  debugging.\n\n7.3.4\\. fetching samples at layer 5\n----------------------------------\n\nthe layer 5 usually describes just the session layer which in haproxy is\nclosest to the session once all the connection handshakes are finished, but\nwhen no content is yet made available. the fetch methods described here are\nusable as low as the \"tcp-request content\" rule sets unless they require some\nfuture information. those generally include the results of ssl negotiations.\n\nssl_bc : boolean\n  returns true when the back connection was made via an ssl/tls transport\n  layer and is locally deciphered. this means the outgoing connection was made\n  other a server with the \"ssl\" option.\n\nssl_bc_alg_keysize : integer\n  returns the symmetric cipher key size supported in bits when the outgoing\n  connection was made over an ssl/tls transport layer.\n\nssl_bc_cipher : string\n  returns the name of the used cipher when the outgoing connection was made\n  over an ssl/tls transport layer.\n\nssl_bc_protocol : string\n  returns the name of the used protocol when the outgoing connection was made\n  over an ssl/tls transport layer.\n\nssl_bc_unique_id : binary\n  when the outgoing connection was made over an ssl/tls transport layer,\n  returns the tls unique id as defined in rfc5929 section 3\\. the unique id\n  can be encoded to base64 using the converter: \"ssl_bc_unique_id,base64\".\n\nssl_bc_session_id : binary\n  returns the ssl id of the back connection when the outgoing connection was\n  made over an ssl/tls transport layer. it is useful to log if we want to know\n  if session was reused or not.\n\nssl_bc_use_keysize : integer\n  returns the symmetric cipher key size used in bits when the outgoing\n  connection was made over an ssl/tls transport layer.\n\nssl_c_ca_err : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the id of the first error detected during verification of the client\n  certificate at depth > 0, or 0 if no error was encountered during this\n  verification process. please refer to your ssl library's documentation to\n  find the exhaustive list of error codes.\n\nssl_c_ca_err_depth : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the depth in the ca chain of the first error detected during the\n  verification of the client certificate. if no error is encountered, 0 is\n  returned.\n\nssl_c_der : binary\n  returns the der formatted certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_c_err : integer\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the id of the first error detected during verification at depth 0, or\n  0 if no error was encountered during this verification process. please refer\n  to your ssl library's documentation to find the exhaustive list of error\n  codes.\n\nssl_c_i_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the issuer of the certificate\n  presented by the client when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_c_i_dn(ou,2)\" the second organization unit, and\n  \"ssl_c_i_dn(cn)\" retrieves the common name.\n\nssl_c_key_alg : string\n  returns the name of the algorithm used to generate the key of the certificate\n  presented by the client when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_notafter : string\n  returns the end date presented by the client as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_notbefore : string\n  returns the start date presented by the client as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_c_s_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the subject of the certificate\n  presented by the client when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_c_s_dn(ou,2)\" the second organization unit, and\n  \"ssl_c_s_dn(cn)\" retrieves the common name.\n\nssl_c_serial : binary\n  returns the serial of the certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_c_sha1 : binary\n  returns the sha-1 fingerprint of the certificate presented by the client when\n  the incoming connection was made over an ssl/tls transport layer. this can be\n  used to stick a client to a server, or to pass this information to a server.\n  note that the output is binary, so if you want to pass that signature to the\n  server, you need to encode it in hex or base64, such as in the example below:\n\n     http-request set-header x-ssl-client-sha1 %[ssl_c_sha1,hex]\n\nssl_c_sig_alg : string\n  returns the name of the algorithm used to sign the certificate presented by\n  the client when the incoming connection was made over an ssl/tls transport\n  layer.\n\nssl_c_used : boolean\n  returns true if current ssl session uses a client certificate even if current\n  connection uses ssl session resumption. see also \"ssl_fc_has_crt\".\n\nssl_c_verify : integer\n  returns the verify result error id when the incoming connection was made over\n  an ssl/tls transport layer, otherwise zero if no error is encountered. please\n  refer to your ssl library's documentation for an exhaustive list of error\n  codes.\n\nssl_c_version : integer\n  returns the version of the certificate presented by the client when the\n  incoming connection was made over an ssl/tls transport layer.\n\nssl_f_der : binary\n  returns the der formatted certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_f_i_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the issuer of the certificate\n  presented by the frontend when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_f_i_dn(ou,2)\" the second organization unit, and\n  \"ssl_f_i_dn(cn)\" retrieves the common name.\n\nssl_f_key_alg : string\n  returns the name of the algorithm used to generate the key of the certificate\n  presented by the frontend when the incoming connection was made over an\n  ssl/tls transport layer.\n\nssl_f_notafter : string\n  returns the end date presented by the frontend as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_f_notbefore : string\n  returns the start date presented by the frontend as a formatted string\n  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls\n  transport layer.\n\nssl_f_s_dn([<entry>[,<occ>]]) : string\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the full distinguished name of the subject of the certificate\n  presented by the frontend when no <entry> is specified, or the value of the\n  first given entry found from the beginning of the dn. if a positive/negative\n  occurrence number is specified as the optional second argument, it returns\n  the value of the nth given entry value from the beginning/end of the dn.\n  for instance, \"ssl_f_s_dn(ou,2)\" the second organization unit, and\n  \"ssl_f_s_dn(cn)\" retrieves the common name.\n\nssl_f_serial : binary\n  returns the serial of the certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer. when used for\n  an acl, the value(s) to match against can be passed in hexadecimal form.\n\nssl_f_sha1 : binary\n  returns the sha-1 fingerprint of the certificate presented by the frontend\n  when the incoming connection was made over an ssl/tls transport layer. this\n  can be used to know which certificate was chosen using sni.\n\nssl_f_sig_alg : string\n  returns the name of the algorithm used to sign the certificate presented by\n  the frontend when the incoming connection was made over an ssl/tls transport\n  layer.\n\nssl_f_version : integer\n  returns the version of the certificate presented by the frontend when the\n  incoming connection was made over an ssl/tls transport layer.\n\nssl_fc : boolean\n  returns true when the front connection was made via an ssl/tls transport\n  layer and is locally deciphered. this means it has matched a socket declared\n  with a \"bind\" line having the \"ssl\" option.\n\n  example :\n        # this passes \"x-proto: https\" to servers when client connects over ssl\n        listen http-https\n            bind :80\n            bind :443 ssl crt /etc/haproxy.pem\n            http-request add-header x-proto https if { ssl_fc }\n\nssl_fc_alg_keysize : integer\n  returns the symmetric cipher key size supported in bits when the incoming\n  connection was made over an ssl/tls transport layer.\n\nssl_fc_alpn : string\n  this extracts the application layer protocol negotiation field from an\n  incoming connection made via a tls transport layer and locally deciphered by\n  haproxy. the result is a string containing the protocol name advertised by\n  the client. the ssl library must have been built with support for tls\n  extensions enabled (check haproxy -vv). note that the tls alpn extension is\n  not advertised unless the \"alpn\" keyword on the \"bind\" line specifies a\n  protocol list. also, nothing forces the client to pick a protocol from this\n  list, any other one may be requested. the tls alpn extension is meant to\n  replace the tls npn extension. see also \"ssl_fc_npn\".\n\nssl_fc_cipher : string\n  returns the name of the used cipher when the incoming connection was made\n  over an ssl/tls transport layer.\n\nssl_fc_has_crt : boolean\n  returns true if a client certificate is present in an incoming connection over\n  ssl/tls transport layer. useful if 'verify' statement is set to 'optional'.\n  note: on ssl session resumption with session id or tls ticket, client\n  certificate is not present in the current connection but may be retrieved\n  from the cache or the ticket. so prefer \"ssl_c_used\" if you want to check if\n  current ssl session uses a client certificate.\n\nssl_fc_has_sni : boolean\n  this checks for the presence of a server name indication tls extension (sni)\n  in an incoming connection was made over an ssl/tls transport layer. returns\n  true when the incoming connection presents a tls sni field. this requires\n  that the ssl library is build with support for tls extensions enabled (check\n  haproxy -vv).\n\nssl_fc_is_resumed: boolean\n  returns true if the ssl/tls session has been resumed through the use of\n  ssl session cache or tls tickets.\n\nssl_fc_npn : string\n  this extracts the next protocol negotiation field from an incoming connection\n  made via a tls transport layer and locally deciphered by haproxy. the result\n  is a string containing the protocol name advertised by the client. the ssl\n  library must have been built with support for tls extensions enabled (check\n  haproxy -vv). note that the tls npn extension is not advertised unless the\n  \"npn\" keyword on the \"bind\" line specifies a protocol list. also, nothing\n  forces the client to pick a protocol from this list, any other one may be\n  requested. please note that the tls npn extension was replaced with alpn.\n\nssl_fc_protocol : string\n  returns the name of the used protocol when the incoming connection was made\n  over an ssl/tls transport layer.\n\nssl_fc_unique_id : binary\n  when the incoming connection was made over an ssl/tls transport layer,\n  returns the tls unique id as defined in rfc5929 section 3\\. the unique id\n  can be encoded to base64 using the converter: \"ssl_bc_unique_id,base64\".\n\nssl_fc_session_id : binary\n  returns the ssl id of the front connection when the incoming connection was\n  made over an ssl/tls transport layer. it is useful to stick a given client to\n  a server. it is important to note that some browsers refresh their session id\n  every few minutes.\n\nssl_fc_sni : string\n  this extracts the server name indication tls extension (sni) field from an\n  incoming connection made via an ssl/tls transport layer and locally\n  deciphered by haproxy. the result (when present) typically is a string\n  matching the https host name (253 chars or less). the ssl library must have\n  been built with support for tls extensions enabled (check haproxy -vv).\n\n  this fetch is different from \"req_ssl_sni\" above in that it applies to the\n  connection being deciphered by haproxy and not to ssl contents being blindly\n  forwarded. see also \"ssl_fc_sni_end\" and \"ssl_fc_sni_reg\" below. this\n  requires that the ssl library is build with support for tls extensions\n  enabled (check haproxy -vv).\n\n  acl derivatives :\n    ssl_fc_sni_end : suffix match\n    ssl_fc_sni_reg : regex match\n\nssl_fc_use_keysize : integer\n  returns the symmetric cipher key size used in bits when the incoming\n  connection was made over an ssl/tls transport layer.\n\n7.3.5\\. fetching samples from buffer contents (layer 6)\n------------------------------------------------------\n\nfetching samples from buffer contents is a bit different from the previous\nsample fetches above because the sampled data are ephemeral. these data can\nonly be used when they're available and will be lost when they're forwarded.\nfor this reason, samples fetched from buffer contents during a request cannot\nbe used in a response for example. even while the data are being fetched, they\ncan change. sometimes it is necessary to set some delays or combine multiple\nsample fetch methods to ensure that the expected data are complete and usable,\nfor example through tcp request content inspection. please see the \"tcp-request\ncontent\" keyword for more detailed information on the subject.\n\npayload(<offset>,<length>) : binary (deprecated)\n  this is an alias for \"req.payload\" when used in the context of a request (eg:\n  \"stick on\", \"stick match\"), and for \"res.payload\" when used in the context of\n  a response such as in \"stick store response\".\n\npayload_lv(<offset1>,<length>[,<offset2>]) : binary (deprecated)\n  this is an alias for \"req.payload_lv\" when used in the context of a request\n  (eg: \"stick on\", \"stick match\"), and for \"res.payload_lv\" when used in the\n  context of a response such as in \"stick store response\".\n\nreq.len : integer\nreq_len : integer (deprecated)\n  returns an integer value corresponding to the number of bytes present in the\n  request buffer. this is mostly used in acl. it is important to understand\n  that this test does not return false as long as the buffer is changing. this\n  means that a check with equality to zero will almost always immediately match\n  at the beginning of the session, while a test for more data will wait for\n  that data to come in and return false only when haproxy is certain that no\n  more data will come in. this test was designed to be used with tcp request\n  content inspection.\n\nreq.payload(<offset>,<length>) : binary\n  this extracts a binary block of <length> bytes and starting at byte <offset>\n  in the request buffer. as a special case, if the <length> argument is zero,\n  the the whole buffer from <offset> to the end is extracted. this can be used\n  with acls in order to check for the presence of some content in a buffer at\n  any location.\n\n  acl alternatives :\n    payload(<offset>,<length>) : hex binary match\n\nreq.payload_lv(<offset1>,<length>[,<offset2>]) : binary\n  this extracts a binary block whose size is specified at <offset1> for <length>\n  bytes, and which starts at <offset2> if specified or just after the length in\n  the request buffer. the <offset2> parameter also supports relative offsets if\n  prepended with a '+' or '-' sign.\n\n  acl alternatives :\n    payload_lv(<offset1>,<length>[,<offset2>]) : hex binary match\n\n  example : please consult the example from the \"stick store-response\" keyword.\n\nreq.proto_http : boolean\nreq_proto_http : boolean (deprecated)\n  returns true when data in the request buffer look like http and correctly\n  parses as such. it is the same parser as the common http request parser which\n  is used so there should be no surprises. the test does not match until the\n  request is complete, failed or timed out. this test may be used to report the\n  protocol in tcp logs, but the biggest use is to block tcp request analysis\n  until a complete http request is present in the buffer, for example to track\n  a header.\n\n  example:\n        # track request counts per \"base\" (concatenation of host+url)\n        tcp-request inspect-delay 10s\n        tcp-request content reject if !http\n        tcp-request content track-sc0 base table req-rate\n\nreq.rdp_cookie([<name>]) : string\nrdp_cookie([<name>]) : string (deprecated)\n  when the request buffer looks like the rdp protocol, extracts the rdp cookie\n  <name>, or any cookie if unspecified. the parser only checks for the first\n  cookie, as illustrated in the rdp protocol specification. the cookie name is\n  case insensitive. generally the \"msts\" cookie name will be used, as it can\n  contain the user name of the client connecting to the server if properly\n  configured on the client. the \"mstshash\" cookie is often used as well for\n  session stickiness to servers.\n\n  this differs from \"balance rdp-cookie\" in that any balancing algorithm may be\n  used and thus the distribution of clients to backend servers is not linked to\n  a hash of the rdp cookie. it is envisaged that using a balancing algorithm\n  such as \"balance roundrobin\" or \"balance leastconn\" will lead to a more even\n  distribution of clients to backend servers than the hash used by \"balance\n  rdp-cookie\".\n\n  acl derivatives :\n    req_rdp_cookie([<name>]) : exact string match\n\n  example :\n   listen tse-farm\n       bind 0.0.0.0:3389\n       # wait up to 5s for an rdp cookie in the request\n       tcp-request inspect-delay 5s\n       tcp-request content accept if rdp_cookie\n       # apply rdp cookie persistence\n       persist rdp-cookie\n       # persist based on the mstshash cookie\n       # this is only useful makes sense if\n       # balance rdp-cookie is not used\n       stick-table type string size 204800\n       stick on req.rdp_cookie(mstshash)\n       server srv1 1.1.1.1:3389\n       server srv1 1.1.1.2:3389\n\n  see also : \"balance rdp-cookie\", \"persist rdp-cookie\", \"tcp-request\" and the\n  \"req_rdp_cookie\" acl.\n\nreq.rdp_cookie_cnt([name]) : integer\nrdp_cookie_cnt([name]) : integer (deprecated)\n  tries to parse the request buffer as rdp protocol, then returns an integer\n  corresponding to the number of rdp cookies found. if an optional cookie name\n  is passed, only cookies matching this name are considered. this is mostly\n  used in acl.\n\n  acl derivatives :\n    req_rdp_cookie_cnt([<name>]) : integer match\n\nreq.ssl_ec_ext : boolean\n  returns a boolean identifying if client sent the supported elliptic curves\n  extension as defined in rfc4492, section 5.1\\. within the ssl clienthello\n  message. this can be used to present ecc compatible clients with ec certificate\n  and to use rsa for all others, on the same ip address. note that this only\n  applies to raw contents found in the request buffer and not to contents\n  deciphered via an ssl data layer, so this will not work with \"bind\" lines\n  having the \"ssl\" option.\n\nreq.ssl_hello_type : integer\nreq_ssl_hello_type : integer (deprecated)\n  returns an integer value containing the type of the ssl hello message found\n  in the request buffer if the buffer contains data that parse as a complete\n  ssl (v3 or superior) client hello message. note that this only applies to raw\n  contents found in the request buffer and not to contents deciphered via an\n  ssl data layer, so this will not work with \"bind\" lines having the \"ssl\"\n  option. this is mostly used in acl to detect presence of an ssl hello message\n  that is supposed to contain an ssl session id usable for stickiness.\n\nreq.ssl_sni : string\nreq_ssl_sni : string (deprecated)\n  returns a string containing the value of the server name tls extension sent\n  by a client in a tls stream passing through the request buffer if the buffer\n  contains data that parse as a complete ssl (v3 or superior) client hello\n  message. note that this only applies to raw contents found in the request\n  buffer and not to contents deciphered via an ssl data layer, so this will not\n  work with \"bind\" lines having the \"ssl\" option. sni normally contains the\n  name of the host the client tries to connect to (for recent browsers). sni is\n  useful for allowing or denying access to certain hosts when ssl/tls is used\n  by the client. this test was designed to be used with tcp request content\n  inspection. if content switching is needed, it is recommended to first wait\n  for a complete client hello (type 1), like in the example below. see also\n  \"ssl_fc_sni\".\n\n  acl derivatives :\n    req_ssl_sni : exact string match\n\n  examples :\n     # wait for a client hello for at most 5 seconds\n     tcp-request inspect-delay 5s\n     tcp-request content accept if { req_ssl_hello_type 1 }\n     use_backend bk_allow if { req_ssl_sni -f allowed_sites }\n     default_backend bk_sorry_page\n\nres.ssl_hello_type : integer\nrep_ssl_hello_type : integer (deprecated)\n  returns an integer value containing the type of the ssl hello message found\n  in the response buffer if the buffer contains data that parses as a complete\n  ssl (v3 or superior) hello message. note that this only applies to raw\n  contents found in the response buffer and not to contents deciphered via an\n  ssl data layer, so this will not work with \"server\" lines having the \"ssl\"\n  option. this is mostly used in acl to detect presence of an ssl hello message\n  that is supposed to contain an ssl session id usable for stickiness.\n\nreq.ssl_ver : integer\nreq_ssl_ver : integer (deprecated)\n  returns an integer value containing the version of the ssl/tls protocol of a\n  stream present in the request buffer. both sslv2 hello messages and sslv3\n  messages are supported. tlsv1 is announced as ssl version 3.1\\. the value is\n  composed of the major version multiplied by 65536, added to the minor\n  version. note that this only applies to raw contents found in the request\n  buffer and not to contents deciphered via an ssl data layer, so this will not\n  work with \"bind\" lines having the \"ssl\" option. the acl version of the test\n  matches against a decimal notation in the form major.minor (eg: 3.1). this\n  fetch is mostly used in acl.\n\n  acl derivatives :\n    req_ssl_ver : decimal match\n\nres.len : integer\n  returns an integer value corresponding to the number of bytes present in the\n  response buffer. this is mostly used in acl. it is important to understand\n  that this test does not return false as long as the buffer is changing. this\n  means that a check with equality to zero will almost always immediately match\n  at the beginning of the session, while a test for more data will wait for\n  that data to come in and return false only when haproxy is certain that no\n  more data will come in. this test was designed to be used with tcp response\n  content inspection.\n\nres.payload(<offset>,<length>) : binary\n  this extracts a binary block of <length> bytes and starting at byte <offset>\n  in the response buffer. as a special case, if the <length> argument is zero,\n  the the whole buffer from <offset> to the end is extracted. this can be used\n  with acls in order to check for the presence of some content in a buffer at\n  any location.\n\nres.payload_lv(<offset1>,<length>[,<offset2>]) : binary\n  this extracts a binary block whose size is specified at <offset1> for <length>\n  bytes, and which starts at <offset2> if specified or just after the length in\n  the response buffer. the <offset2> parameter also supports relative offsets\n  if prepended with a '+' or '-' sign.\n\n  example : please consult the example from the \"stick store-response\" keyword.\n\nwait_end : boolean\n  this fetch either returns true when the inspection period is over, or does\n  not fetch. it is only used in acls, in conjunction with content analysis to\n  avoid returning a wrong verdict early.  it may also be used to delay some\n  actions, such as a delayed reject for some special addresses. since it either\n  stops the rules evaluation or immediately returns true, it is recommended to\n  use this acl as the last one in a rule.  please note that the default acl\n  \"wait_end\" is always usable without prior declaration. this test was designed\n  to be used with tcp request content inspection.\n\n  examples :\n     # delay every incoming request by 2 seconds\n     tcp-request inspect-delay 2s\n     tcp-request content accept if wait_end\n\n     # don't immediately tell bad guys they are rejected\n     tcp-request inspect-delay 10s\n     acl goodguys src 10.0.0.0/24\n     acl badguys  src 10.0.1.0/24\n     tcp-request content accept if goodguys\n     tcp-request content reject if badguys wait_end\n     tcp-request content reject\n\n7.3.6\\. fetching http samples (layer 7)\n--------------------------------------\n\nit is possible to fetch samples from http contents, requests and responses.\nthis application layer is also called layer 7\\. it is only possible to fetch the\ndata in this section when a full http request or response has been parsed from\nits respective request or response buffer. this is always the case with all\nhttp specific rules and for sections running with \"mode http\". when using tcp\ncontent inspection, it may be necessary to support an inspection delay in order\nto let the request or response come in first. these fetches may require a bit\nmore cpu resources than the layer 4 ones, but not much since the request and\nresponse are indexed.\n\nbase : string\n  this returns the concatenation of the first host header and the path part of\n  the request, which starts at the first slash and ends before the question\n  mark. it can be useful in virtual hosted environments to detect url abuses as\n  well as to improve shared caches efficiency. using this with a limited size\n  stick table also allows one to collect statistics about most commonly\n  requested objects by host/path. with acls it can allow simple content\n  switching rules involving the host and the path at the same time, such as\n  \"www.example.com/favicon.ico\". see also \"path\" and \"uri\".\n\n  acl derivatives :\n    base     : exact string match\n    base_beg : prefix match\n    base_dir : subdir match\n    base_dom : domain match\n    base_end : suffix match\n    base_len : length match\n    base_reg : regex match\n    base_sub : substring match\n\nbase32 : integer\n  this returns a 32-bit hash of the value returned by the \"base\" fetch method\n  above. this is useful to track per-url activity on high traffic sites without\n  having to store all urls. instead a shorter hash is stored, saving a lot of\n  memory. the output type is an unsigned integer. the hash function used is\n  sdbm with full avalanche on the output. technically, base32 is exactly equal\n  to \"base,sdbm(1)\".\n\nbase32+src : binary\n  this returns the concatenation of the base32 fetch above and the src fetch\n  below. the resulting type is of type binary, with a size of 8 or 20 bytes\n  depending on the source address family. this can be used to track per-ip,\n  per-url counters.\n\ncapture.req.hdr(<idx>) : string\n  this extracts the content of the header captured by the \"capture request\n  header\", idx is the position of the capture keyword in the configuration.\n  the first entry is an index of 0\\. see also: \"capture request header\".\n\ncapture.req.method : string\n  this extracts the method of an http request. it can be used in both request\n  and response. unlike \"method\", it can be used in both request and response\n  because it's allocated.\n\ncapture.req.uri : string\n  this extracts the request's uri, which starts at the first slash and ends\n  before the first space in the request (without the host part). unlike \"path\"\n  and \"url\", it can be used in both request and response because it's\n  allocated.\n\ncapture.req.ver : string\n  this extracts the request's http version and returns either \"http/1.0\" or\n  \"http/1.1\". unlike \"req.ver\", it can be used in both request, response, and\n  logs because it relies on a persistent flag.\n\ncapture.res.hdr(<idx>) : string\n  this extracts the content of the header captured by the \"capture response\n  header\", idx is the position of the capture keyword in the configuration.\n  the first entry is an index of 0.\n  see also: \"capture response header\"\n\ncapture.res.ver : string\n  this extracts the response's http version and returns either \"http/1.0\" or\n  \"http/1.1\". unlike \"res.ver\", it can be used in logs because it relies on a\n  persistent flag.\n\nreq.body : binary\n  this returns the http request's available body as a block of data. it\n  requires that the request body has been buffered made available using\n  \"option http-buffer-request\". in case of chunked-encoded body, currently only\n  the first chunk is analyzed.\n\nreq.body_param([<name>) : string\n  this fetch assumes that the body of the post request is url-encoded. the user\n  can check if the \"content-type\" contains the value\n  \"application/x-www-form-urlencoded\". this extracts the first occurrence of the\n  parameter <name> in the body, which ends before '&'. the parameter name is\n  case-sensitive. if no name is given, any parameter will match, and the first\n  one will be returned. the result is a string corresponding to the value of the\n  parameter <name> as presented in the request body (no url decoding is\n  performed). note that the acl version of this fetch iterates over multiple\n  parameters and will iteratively report all parameters values if no name is\n  given.\n\nreq.body_len : integer\n  this returns the length of the http request's available body in bytes. it may\n  be lower than the advertised length if the body is larger than the buffer. it\n  requires that the request body has been buffered made available using\n  \"option http-buffer-request\".\n\nreq.body_size : integer\n  this returns the advertised length of the http request's body in bytes. it\n  will represent the advertised content-length header, or the size of the first\n  chunk in case of chunked encoding. in order to parse the chunks, it requires\n  that the request body has been buffered made available using\n  \"option http-buffer-request\".\n\nreq.cook([<name>]) : string\ncook([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, and returns its value as string. if no name is\n  specified, the first cookie value is returned. when used with acls, all\n  matching cookies are evaluated. spaces around the name and the value are\n  ignored as requested by the cookie header specification (rfc6265). the cookie\n  name is case-sensitive. empty cookies are valid, so an empty cookie may very\n  well return an empty value if it is present. use the \"found\" match to detect\n  presence. use the res.cook() variant for response cookies sent by the server.\n\n  acl derivatives :\n    cook([<name>])     : exact string match\n    cook_beg([<name>]) : prefix match\n    cook_dir([<name>]) : subdir match\n    cook_dom([<name>]) : domain match\n    cook_end([<name>]) : suffix match\n    cook_len([<name>]) : length match\n    cook_reg([<name>]) : regex match\n    cook_sub([<name>]) : substring match\n\nreq.cook_cnt([<name>]) : integer\ncook_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of the cookie\n  <name> in the request, or all cookies if <name> is not specified.\n\nreq.cook_val([<name>]) : integer\ncook_val([<name>]) : integer (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, and converts its value to an integer which is\n  returned. if no name is specified, the first cookie value is returned. when\n  used in acls, all matching names are iterated over until a value matches.\n\ncookie([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"cookie\"\n  header line from the request, or a \"set-cookie\" header from the response, and\n  returns its value as a string. a typical use is to get multiple clients\n  sharing a same profile use the same server. this can be similar to what\n  \"appsession\" does with the \"request-learn\" statement, but with support for\n  multi-peer synchronization and state keeping across restarts. if no name is\n  specified, the first cookie value is returned. this fetch should not be used\n  anymore and should be replaced by req.cook() or res.cook() instead as it\n  ambiguously uses the direction based on the context where it is used.\n  see also : \"appsession\".\n\nhdr([<name>[,<occ>]]) : string\n  this is equivalent to req.hdr() when used on requests, and to res.hdr() when\n  used on responses. please refer to these respective fetches for more details.\n  in case of doubt about the fetch direction, please use the explicit ones.\n  note that contrary to the hdr() sample fetch method, the hdr_* acl keywords\n  unambiguously apply to the request headers.\n\nreq.fhdr(<name>[,<occ>]) : string\n  this extracts the last occurrence of header <name> in an http request. when\n  used from an acl, all occurrences are iterated over until a match is found.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. it differs from req.hdr() in that any commas\n  present in the value are returned and are not used as delimiters. this is\n  sometimes useful with headers such as user-agent.\n\nreq.fhdr_cnt([<name>]) : integer\n  returns an integer value representing the number of occurrences of request\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. contrary to its req.hdr_cnt() cousin, this function returns\n  the number of full line headers and does not stop on commas.\n\nreq.hdr([<name>[,<occ>]]) : string\n  this extracts the last occurrence of header <name> in an http request. when\n  used from an acl, all occurrences are iterated over until a match is found.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. a typical use is with the x-forwarded-for header\n  once converted to ip, associated with an ip stick-table. the function\n  considers any comma as a delimiter for distinct values. if full-line headers\n  are desired instead, use req.fhdr(). please carefully check rfc2616 to know\n  how certain headers are supposed to be parsed. also, some of them are case\n  insensitive (eg: connection).\n\n  acl derivatives :\n    hdr([<name>[,<occ>]])     : exact string match\n    hdr_beg([<name>[,<occ>]]) : prefix match\n    hdr_dir([<name>[,<occ>]]) : subdir match\n    hdr_dom([<name>[,<occ>]]) : domain match\n    hdr_end([<name>[,<occ>]]) : suffix match\n    hdr_len([<name>[,<occ>]]) : length match\n    hdr_reg([<name>[,<occ>]]) : regex match\n    hdr_sub([<name>[,<occ>]]) : substring match\n\nreq.hdr_cnt([<name>]) : integer\nhdr_cnt([<header>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of request\n  header field name <name>, or the total number of header field values if\n  <name> is not specified. it is important to remember that one header line may\n  count as several headers if it has several values. the function considers any\n  comma as a delimiter for distinct values. if full-line headers are desired\n  instead, req.fhdr_cnt() should be used instead. with acls, it can be used to\n  detect presence, absence or abuse of a specific header, as well as to block\n  request smuggling attacks by rejecting requests which contain more than one\n  of certain headers. see \"req.hdr\" for more information on header matching.\n\nreq.hdr_ip([<name>[,<occ>]]) : ip\nhdr_ip([<name>[,<occ>]]) : ip (deprecated)\n  this extracts the last occurrence of header <name> in an http request,\n  converts it to an ipv4 or ipv6 address and returns this address. when used\n  with acls, all occurrences are checked, and if <name> is omitted, every value\n  of every header is checked. optionally, a specific occurrence might be\n  specified as a position number. positive values indicate a position from the\n  first occurrence, with 1 being the first one.  negative values indicate\n  positions relative to the last one, with -1 being the last one. a typical use\n  is with the x-forwarded-for and x-client-ip headers.\n\nreq.hdr_val([<name>[,<occ>]]) : integer\nhdr_val([<name>[,<occ>]]) : integer (deprecated)\n  this extracts the last occurrence of header <name> in an http request, and\n  converts it to an integer value. when used with acls, all occurrences are\n  checked, and if <name> is omitted, every value of every header is checked.\n  optionally, a specific occurrence might be specified as a position number.\n  positive values indicate a position from the first occurrence, with 1 being\n  the first one. negative values indicate positions relative to the last one,\n  with -1 being the last one. a typical use is with the x-forwarded-for header.\n\nhttp_auth(<userlist>) : boolean\n  returns a boolean indicating whether the authentication data received from\n  the client match a username & password stored in the specified userlist. this\n  fetch function is not really useful outside of acls. currently only http\n  basic auth is supported.\n\nhttp_auth_group(<userlist>) : string\n  returns a string corresponding to the user name found in the authentication\n  data received from the client if both the user name and password are valid\n  according to the specified userlist. the main purpose is to use it in acls\n  where it is then checked whether the user belongs to any group within a list.\n  this fetch function is not really useful outside of acls. currently only http\n  basic auth is supported.\n\n  acl derivatives :\n    http_auth_group(<userlist>) : group ...\n    returns true when the user extracted from the request and whose password is\n    valid according to the specified userlist belongs to at least one of the\n    groups.\n\nhttp_first_req : boolean\n  returns true when the request being processed is the first one of the\n  connection. this can be used to add or remove headers that may be missing\n  from some requests when a request is not the first one, or to help grouping\n  requests in the logs.\n\nmethod : integer + string\n  returns an integer value corresponding to the method in the http request. for\n  example, \"get\" equals 1 (check sources to establish the matching). value 9\n  means \"other method\" and may be converted to a string extracted from the\n  stream. this should not be used directly as a sample, this is only meant to\n  be used from acls, which transparently convert methods from patterns to these\n  integer + string values. some predefined acl already check for most common\n  methods.\n\n  acl derivatives :\n    method : case insensitive method match\n\n  example :\n      # only accept get and head requests\n      acl valid_method method get head\n      http-request deny if ! valid_method\n\npath : string\n  this extracts the request's url path, which starts at the first slash and\n  ends before the question mark (without the host part). a typical use is with\n  prefetch-capable caches, and with portals which need to aggregate multiple\n  information from databases and keep them in caches. note that with outgoing\n  caches, it would be wiser to use \"url\" instead. with acls, it's typically\n  used to match exact file names (eg: \"/login.php\"), or directory parts using\n  the derivative forms. see also the \"url\" and \"base\" fetch methods.\n\n  acl derivatives :\n    path     : exact string match\n    path_beg : prefix match\n    path_dir : subdir match\n    path_dom : domain match\n    path_end : suffix match\n    path_len : length match\n    path_reg : regex match\n    path_sub : substring match\n\nquery : string\n  this extracts the request's query string, which starts after the first\n  question mark. if no question mark is present, this fetch returns nothing. if\n  a question mark is present but nothing follows, it returns an empty string.\n  this means it's possible to easily know whether a query string is present\n  using the \"found\" matching method. this fetch is the completemnt of \"path\"\n  which stops before the question mark.\n\nreq.hdr_names([<delim>]) : string\n  this builds a string made from the concatenation of all header names as they\n  appear in the request when the rule is evaluated. the default delimiter is\n  the comma (',') but it may be overridden as an optional argument <delim>. in\n  this case, only the first character of <delim> is considered.\n\nreq.ver : string\nreq_ver : string (deprecated)\n  returns the version string from the http request, for example \"1.1\". this can\n  be useful for logs, but is mostly there for acl. some predefined acl already\n  check for versions 1.0 and 1.1.\n\n  acl derivatives :\n    req_ver : exact string match\n\nres.comp : boolean\n  returns the boolean \"true\" value if the response has been compressed by\n  haproxy, otherwise returns boolean \"false\". this may be used to add\n  information in the logs.\n\nres.comp_algo : string\n  returns a string containing the name of the algorithm used if the response\n  was compressed by haproxy, for example : \"deflate\". this may be used to add\n  some information in the logs.\n\nres.cook([<name>]) : string\nscook([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response, and returns its value as string. if no name is\n  specified, the first cookie value is returned.\n\n  acl derivatives :\n    scook([<name>] : exact string match\n\nres.cook_cnt([<name>]) : integer\nscook_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of the cookie\n  <name> in the response, or all cookies if <name> is not specified. this is\n  mostly useful when combined with acls to detect suspicious responses.\n\nres.cook_val([<name>]) : integer\nscook_val([<name>]) : integer (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response, and converts its value to an integer which is\n  returned. if no name is specified, the first cookie value is returned.\n\nres.fhdr([<name>[,<occ>]]) : string\n  this extracts the last occurrence of header <name> in an http response, or of\n  the last header if no <name> is specified. optionally, a specific occurrence\n  might be specified as a position number. positive values indicate a position\n  from the first occurrence, with 1 being the first one. negative values\n  indicate positions relative to the last one, with -1 being the last one. it\n  differs from res.hdr() in that any commas present in the value are returned\n  and are not used as delimiters. if this is not desired, the res.hdr() fetch\n  should be used instead. this is sometimes useful with headers such as date or\n  expires.\n\nres.fhdr_cnt([<name>]) : integer\n  returns an integer value representing the number of occurrences of response\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. contrary to its res.hdr_cnt() cousin, this function returns\n  the number of full line headers and does not stop on commas. if this is not\n  desired, the res.hdr_cnt() fetch should be used instead.\n\nres.hdr([<name>[,<occ>]]) : string\nshdr([<name>[,<occ>]]) : string (deprecated)\n  this extracts the last occurrence of header <name> in an http response, or of\n  the last header if no <name> is specified. optionally, a specific occurrence\n  might be specified as a position number. positive values indicate a position\n  from the first occurrence, with 1 being the first one. negative values\n  indicate positions relative to the last one, with -1 being the last one. this\n  can be useful to learn some data into a stick-table. the function considers\n  any comma as a delimiter for distinct values. if this is not desired, the\n  res.fhdr() fetch should be used instead.\n\n  acl derivatives :\n    shdr([<name>[,<occ>]])     : exact string match\n    shdr_beg([<name>[,<occ>]]) : prefix match\n    shdr_dir([<name>[,<occ>]]) : subdir match\n    shdr_dom([<name>[,<occ>]]) : domain match\n    shdr_end([<name>[,<occ>]]) : suffix match\n    shdr_len([<name>[,<occ>]]) : length match\n    shdr_reg([<name>[,<occ>]]) : regex match\n    shdr_sub([<name>[,<occ>]]) : substring match\n\nres.hdr_cnt([<name>]) : integer\nshdr_cnt([<name>]) : integer (deprecated)\n  returns an integer value representing the number of occurrences of response\n  header field name <name>, or the total number of header fields if <name> is\n  not specified. the function considers any comma as a delimiter for distinct\n  values. if this is not desired, the res.fhdr_cnt() fetch should be used\n  instead.\n\nres.hdr_ip([<name>[,<occ>]]) : ip\nshdr_ip([<name>[,<occ>]]) : ip (deprecated)\n  this extracts the last occurrence of header <name> in an http response,\n  convert it to an ipv4 or ipv6 address and returns this address. optionally, a\n  specific occurrence might be specified as a position number. positive values\n  indicate a position from the first occurrence, with 1 being the first one.\n  negative values indicate positions relative to the last one, with -1 being\n  the last one. this can be useful to learn some data into a stick table.\n\nres.hdr_names([<delim>]) : string\n  this builds a string made from the concatenation of all header names as they\n  appear in the response when the rule is evaluated. the default delimiter is\n  the comma (',') but it may be overridden as an optional argument <delim>. in\n  this case, only the first character of <delim> is considered.\n\nres.hdr_val([<name>[,<occ>]]) : integer\nshdr_val([<name>[,<occ>]]) : integer (deprecated)\n  this extracts the last occurrence of header <name> in an http response, and\n  converts it to an integer value. optionally, a specific occurrence might be\n  specified as a position number. positive values indicate a position from the\n  first occurrence, with 1 being the first one. negative values indicate\n  positions relative to the last one, with -1 being the last one. this can be\n  useful to learn some data into a stick table.\n\nres.ver : string\nresp_ver : string (deprecated)\n  returns the version string from the http response, for example \"1.1\". this\n  can be useful for logs, but is mostly there for acl.\n\n  acl derivatives :\n    resp_ver : exact string match\n\nset-cookie([<name>]) : string (deprecated)\n  this extracts the last occurrence of the cookie name <name> on a \"set-cookie\"\n  header line from the response and uses the corresponding value to match. this\n  can be comparable to what \"appsession\" does with default options, but with\n  support for multi-peer synchronization and state keeping across restarts.\n\n  this fetch function is deprecated and has been superseded by the \"res.cook\"\n  fetch. this keyword will disappear soon.\n\n  see also : \"appsession\"\n\nstatus : integer\n  returns an integer containing the http status code in the http response, for\n  example, 302\\. it is mostly used within acls and integer ranges, for example,\n  to remove any location header if the response is not a 3xx.\n\nurl : string\n  this extracts the request's url as presented in the request. a typical use is\n  with prefetch-capable caches, and with portals which need to aggregate\n  multiple information from databases and keep them in caches. with acls, using\n  \"path\" is preferred over using \"url\", because clients may send a full url as\n  is normally done with proxies. the only real use is to match \"*\" which does\n  not match in \"path\", and for which there is already a predefined acl. see\n  also \"path\" and \"base\".\n\n  acl derivatives :\n    url     : exact string match\n    url_beg : prefix match\n    url_dir : subdir match\n    url_dom : domain match\n    url_end : suffix match\n    url_len : length match\n    url_reg : regex match\n    url_sub : substring match\n\nurl_ip : ip\n  this extracts the ip address from the request's url when the host part is\n  presented as an ip address. its use is very limited. for instance, a\n  monitoring system might use this field as an alternative for the source ip in\n  order to test what path a given source address would follow, or to force an\n  entry in a table for a given source address. with acls it can be used to\n  restrict access to certain systems through a proxy, for example when combined\n  with option \"http_proxy\".\n\nurl_port : integer\n  this extracts the port part from the request's url. note that if the port is\n  not specified in the request, port 80 is assumed. with acls it can be used to\n  restrict access to certain systems through a proxy, for example when combined\n  with option \"http_proxy\".\n\nurlp([<name>[,<delim>]]) : string\nurl_param([<name>[,<delim>]]) : string\n  this extracts the first occurrence of the parameter <name> in the query\n  string, which begins after either '?' or <delim>, and which ends before '&',\n  ';' or <delim>. the parameter name is case-sensitive. if no name is given,\n  any parameter will match, and the first one will be returned. the result is\n  a string corresponding to the value of the parameter <name> as presented in\n  the request (no url decoding is performed). this can be used for session\n  stickiness based on a client id, to extract an application cookie passed as a\n  url parameter, or in acls to apply some checks. note that the acl version of\n  this fetch iterates over multiple parameters and will iteratively report all\n  parameters values if no name is given\n\n  acl derivatives :\n    urlp(<name>[,<delim>])     : exact string match\n    urlp_beg(<name>[,<delim>]) : prefix match\n    urlp_dir(<name>[,<delim>]) : subdir match\n    urlp_dom(<name>[,<delim>]) : domain match\n    urlp_end(<name>[,<delim>]) : suffix match\n    urlp_len(<name>[,<delim>]) : length match\n    urlp_reg(<name>[,<delim>]) : regex match\n    urlp_sub(<name>[,<delim>]) : substring match\n\n  example :\n      # match http://example.com/foo?phpsessionid=some_id\n      stick on urlp(phpsessionid)\n      # match http://example.com/foo;jsessionid=some_id\n      stick on urlp(jsessionid,;)\n\nurlp_val([<name>[,<delim>])] : integer\n  see \"urlp\" above. this one extracts the url parameter <name> in the request\n  and converts it to an integer value. this can be used for session stickiness\n  based on a user id for example, or with acls to match a page number or price.\n\n7.4\\. pre-defined acls\n---------------------\n\nsome predefined acls are hard-coded so that they do not have to be declared in\nevery frontend which needs them. they all have their names in upper case in\norder to avoid confusion. their equivalence is provided below.\n\nacl name          equivalent to                usage\n---------------+-----------------------------+---------------------------------\nfalse            always_false                  never match\nhttp             req_proto_http                match if protocol is valid http\nhttp_1.0         req_ver 1.0                   match http version 1.0\nhttp_1.1         req_ver 1.1                   match http version 1.1\nhttp_content     hdr_val(content-length) gt 0  match an existing content-length\nhttp_url_abs     url_reg ^[^/:]*://            match absolute url with scheme\nhttp_url_slash   url_beg /                     match url beginning with \"/\"\nhttp_url_star    url     *                     match url equal to \"*\"\nlocalhost        src 127.0.0.1/8               match connection from local host\nmeth_connect     method  connect               match http connect method\nmeth_get         method  get head              match http get or head method\nmeth_head        method  head                  match http head method\nmeth_options     method  options               match http options method\nmeth_post        method  post                  match http post method\nmeth_trace       method  trace                 match http trace method\nrdp_cookie       req_rdp_cookie_cnt gt 0       match presence of an rdp cookie\nreq_content      req_len gt 0                  match data in the request buffer\ntrue             always_true                   always match\nwait_end         wait_end                      wait for end of content analysis\n---------------+-----------------------------+---------------------------------\n\n8\\. logging\n----------\n\none of haproxy's strong points certainly lies is its precise logs. it probably\nprovides the finest level of information available for such a product, which is\nvery important for troubleshooting complex environments. standard information\nprovided in logs include client ports, tcp/http state timers, precise session\nstate at termination and precise termination cause, information about decisions\nto direct traffic to a server, and of course the ability to capture arbitrary\nheaders.\n\nin order to improve administrators reactivity, it offers a great transparency\nabout encountered problems, both internal and external, and it is possible to\nsend logs to different sources at the same time with different level filters :\n\n  - global process-level logs (system errors, start/stop, etc..)\n  - per-instance system and internal errors (lack of resource, bugs, ...)\n  - per-instance external troubles (servers up/down, max connections)\n  - per-instance activity (client connections), either at the establishment or\n    at the termination.\n  - per-request control of log-level, eg:\n        http-request set-log-level silent if sensitive_request\n\nthe ability to distribute different levels of logs to different log servers\nallow several production teams to interact and to fix their problems as soon\nas possible. for example, the system team might monitor system-wide errors,\nwhile the application team might be monitoring the up/down for their servers in\nreal time, and the security team might analyze the activity logs with one hour\ndelay.\n\n8.1\\. log levels\n---------------\n\ntcp and http connections can be logged with information such as the date, time,\nsource ip address, destination address, connection duration, response times,\nhttp request, http return code, number of bytes transmitted, conditions\nin which the session ended, and even exchanged cookies values. for example\ntrack a particular user's problems. all messages may be sent to up to two\nsyslog servers. check the \"log\" keyword in section 4.2 for more information\nabout log facilities.\n\n8.2\\. log formats\n----------------\n\nhaproxy supports 5 log formats. several fields are common between these formats\nand will be detailed in the following sections. a few of them may vary\nslightly with the configuration, due to indicators specific to certain\noptions. the supported formats are as follows :\n\n  - the default format, which is very basic and very rarely used. it only\n    provides very basic information about the incoming connection at the moment\n    it is accepted : source ip:port, destination ip:port, and frontend-name.\n    this mode will eventually disappear so it will not be described to great\n    extents.\n\n  - the tcp format, which is more advanced. this format is enabled when \"option\n    tcplog\" is set on the frontend. haproxy will then usually wait for the\n    connection to terminate before logging. this format provides much richer\n    information, such as timers, connection counts, queue size, etc... this\n    format is recommended for pure tcp proxies.\n\n  - the http format, which is the most advanced for http proxying. this format\n    is enabled when \"option httplog\" is set on the frontend. it provides the\n    same information as the tcp format with some http-specific fields such as\n    the request, the status code, and captures of headers and cookies. this\n    format is recommended for http proxies.\n\n  - the clf http format, which is equivalent to the http format, but with the\n    fields arranged in the same order as the clf format. in this mode, all\n    timers, captures, flags, etc... appear one per field after the end of the\n    common fields, in the same order they appear in the standard http format.\n\n  - the custom log format, allows you to make your own log line.\n\nnext sections will go deeper into details for each of these formats. format\nspecification will be performed on a \"field\" basis. unless stated otherwise, a\nfield is a portion of text delimited by any number of spaces. since syslog\nservers are susceptible of inserting fields at the beginning of a line, it is\nalways assumed that the first field is the one containing the process name and\nidentifier.\n\nnote : since log lines may be quite long, the log examples in sections below\n       might be broken into multiple lines. the example log lines will be\n       prefixed with 3 closing angle brackets ('>>>') and each time a log is\n       broken into multiple lines, each non-final line will end with a\n       backslash ('\\') and the next line will start indented by two characters.\n\n8.2.1\\. default log format\n-------------------------\n\nthis format is used when no specific option is set. the log is emitted as soon\nas the connection is accepted. one should note that this currently is the only\nformat which logs the request's destination ip and ports.\n\n  example :\n        listen www\n            mode http\n            log global\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:12:09 localhost \\\n          haproxy[14385]: connect from 10.0.1.2:33312 to 10.0.3.31:8012 \\\n          (www/http)\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14385]:\n      2   'connect from'                                          connect from\n      3   source_ip ':' source_port                             10.0.1.2:33312\n      4   'to'                                                              to\n      5   destination_ip ':' destination_port                   10.0.3.31:8012\n      6   '(' frontend_name '/' mode ')'                            (www/http)\n\ndetailed fields description :\n  - \"source_ip\" is the ip address of the client which initiated the connection.\n  - \"source_port\" is the tcp port of the client which initiated the connection.\n  - \"destination_ip\" is the ip address the client connected to.\n  - \"destination_port\" is the tcp port the client connected to.\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n  - \"mode is the mode the frontend is operating (tcp or http).\n\nin case of a unix socket, the source and destination addresses are marked as\n\"unix:\" and the ports reflect the internal id of the socket which accepted the\nconnection (the same id as reported in the stats).\n\nit is advised not to use this deprecated format for newer installations as it\nwill eventually disappear.\n\n8.2.2\\. tcp log format\n---------------------\n\nthe tcp format is used when \"option tcplog\" is specified in the frontend, and\nis the recommended format for pure tcp proxies. it provides a lot of precious\ninformation for troubleshooting. since this format includes timers and byte\ncounts, the log is normally emitted at the end of the session. it can be\nemitted earlier if \"option logasap\" is specified, which makes sense in most\nenvironments with long sessions such as remote terminals. sessions which match\nthe \"monitor\" rules are never logged. it is also possible not to emit logs for\nsessions for which no data were exchanged between the client and the server, by\nspecifying \"option dontlognull\" in the frontend. successful connections will\nnot be logged if \"option dontlog-normal\" is specified in the frontend. a few\nfields may slightly vary depending on some configuration options, those are\nmarked with a star ('*') after the field name below.\n\n  example :\n        frontend fnt\n            mode tcp\n            option tcplog\n            log global\n            default_backend bck\n\n        backend bck\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:12:56 localhost \\\n          haproxy[14387]: 10.0.1.2:33313 [06/feb/2009:12:12:51.443] fnt \\\n          bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14387]:\n      2   client_ip ':' client_port                             10.0.1.2:33313\n      3   '[' accept_date ']'                       [06/feb/2009:12:12:51.443]\n      4   frontend_name                                                    fnt\n      5   backend_name '/' server_name                                bck/srv1\n      6   tw '/' tc '/' tt*                                           0/0/5007\n      7   bytes_read*                                                      212\n      8   termination_state                                                 --\n      9   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    0/0/0/0/3\n     10   srv_queue '/' backend_queue                                      0/0\n\ndetailed fields description :\n  - \"client_ip\" is the ip address of the client which initiated the tcp\n    connection to haproxy. if the connection was accepted on a unix socket\n    instead, the ip address would be replaced with the word \"unix\". note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the proxy protocol is correctly used, then the logs will reflect the\n    forwarded connection's information.\n\n  - \"client_port\" is the tcp port of the client which initiated the connection.\n    if the connection was accepted on a unix socket instead, the port would be\n    replaced with the id of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"accept_date\" is the exact date when the connection was received by haproxy\n    (which might be very slightly different from the date observed on the\n    network if there was some queuing in the system's backlog). this is usually\n    the same date which may appear in any upstream firewall's log.\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. this will be the same as the\n    frontend if no switching rule has been applied, which is common for tcp\n    applications.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. note that this server belongs to the backend\n    which processed the request. if the connection was aborted before reaching\n    a server, \"<nosrv>\" is indicated instead of a server name.\n\n  - \"tw\" is the total time in milliseconds spent waiting in the various queues.\n    it can be \"-1\" if the connection was aborted before reaching the queue.\n    see \"timers\" below for more details.\n\n  - \"tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. it can be \"-1\" if the\n    connection was aborted before a connection could be established. see\n    \"timers\" below for more details.\n\n  - \"tt\" is the total time in milliseconds elapsed between the accept and the\n    last close. it covers all possible processing. there is one exception, if\n    \"option logasap\" was specified, then the time counting stops at the moment\n    the log is emitted. in this case, a '+' sign is prepended before the value,\n    indicating that the final one will be larger. see \"timers\" below for more\n    details.\n\n  - \"bytes_read\" is the total number of bytes transmitted from the server to\n    the client when the log is emitted. if \"option logasap\" is specified, the\n    this value will be prefixed with a '+' sign indicating that the final one\n    may be larger. please note that this value is a 64-bit counter, so log\n    analysis tools must be able to handle it without overflowing.\n\n  - \"termination_state\" is the condition the session was in when the session\n    ended. this indicates the session state, which side caused the end of\n    session to happen, and for what reason (timeout, error, ...). the normal\n    flags should be \"--\", indicating the session was closed by either end with\n    no data remaining in buffers. see below \"session state at disconnection\"\n    for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the session was logged. it is useful to detect when some per-process system\n    limits have been reached. for instance, if actconn is close to 512 when\n    multiple connection errors occur, chances are high that the system limits\n    the process to use a maximum of 1024 file descriptors and that all of them\n    are used. see section 3 \"global parameters\" to find how to tune the system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the session was logged. it is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconn\"\n    has been reached. most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the session was logged. it includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. it is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the session was logged. it can never exceed the server's\n    configured \"maxconn\" parameter. if this value is very often close or equal\n    to the server's \"maxconn\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. when only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the connections to take longer to\n    be processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this session\n    when trying to connect to the server. it must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    frequent retries generally indicate either a network problem between\n    haproxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. this field may optionally be\n    prefixed with a '+' sign, indicating that the session has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. in this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. so as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queue\" is the total number of requests which were processed before\n    this one in the server queue. it is zero when the request has not gone\n    through the server queue. it makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. it is worth noting that if a session experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulated. a request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. it is zero when the request has not\n    gone through the global queue. it makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconn\" parameter. it is worth noting that if a\n    session experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulated. a request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n8.2.3\\. http log format\n----------------------\n\nthe http format is the most complete and the best suited for http proxies. it\nis enabled by when \"option httplog\" is specified in the frontend. it provides\nthe same level of information as the tcp format with additional features which\nare specific to the http protocol. just like the tcp format, the log is usually\nemitted at the end of the session, unless \"option logasap\" is specified, which\ngenerally only makes sense for download sites. a session which matches the\n\"monitor\" rules will never logged. it is also possible not to log sessions for\nwhich no data were sent by the client by specifying \"option dontlognull\" in the\nfrontend. successful connections will not be logged if \"option dontlog-normal\"\nis specified in the frontend.\n\nmost fields are shared with the tcp log, some being different. a few fields may\nslightly vary depending on some configuration options. those ones are marked\nwith a star ('*') after the field name below.\n\n  example :\n        frontend http-in\n            mode http\n            option httplog\n            log global\n            default_backend bck\n\n        backend static\n            server srv1 127.0.0.1:8000\n\n    >>> feb  6 12:14:14 localhost \\\n          haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n          static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n          {} \"get /index.html http/1.1\"\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14389]:\n      2   client_ip ':' client_port                             10.0.1.2:33317\n      3   '[' accept_date ']'                       [06/feb/2009:12:14:14.655]\n      4   frontend_name                                                http-in\n      5   backend_name '/' server_name                             static/srv1\n      6   tq '/' tw '/' tc '/' tr '/' tt*                       10/0/30/69/109\n      7   status_code                                                      200\n      8   bytes_read*                                                     2750\n      9   captured_request_cookie                                            -\n     10   captured_response_cookie                                           -\n     11   termination_state                                               ----\n     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    1/1/1/1/0\n     13   srv_queue '/' backend_queue                                      0/0\n     14   '{' captured_request_headers* '}'                   {haproxy.1wt.eu}\n     15   '{' captured_response_headers* '}'                                {}\n     16   '\"' http_request '\"'                      \"get /index.html http/1.1\"\n\ndetailed fields description :\n  - \"client_ip\" is the ip address of the client which initiated the tcp\n    connection to haproxy. if the connection was accepted on a unix socket\n    instead, the ip address would be replaced with the word \"unix\". note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the proxy protocol is correctly used, then the logs will reflect the\n    forwarded connection's information.\n\n  - \"client_port\" is the tcp port of the client which initiated the connection.\n    if the connection was accepted on a unix socket instead, the port would be\n    replaced with the id of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"accept_date\" is the exact date when the tcp connection was received by\n    haproxy (which might be very slightly different from the date observed on\n    the network if there was some queuing in the system's backlog). this is\n    usually the same date which may appear in any upstream firewall's log. this\n    does not depend on the fact that the client has sent the request or not.\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. this will be the same as the\n    frontend if no switching rule has been applied.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. note that this server belongs to the backend\n    which processed the request. if the request was aborted before reaching a\n    server, \"<nosrv>\" is indicated instead of a server name. if the request was\n    intercepted by the stats subsystem, \"<stats>\" is indicated instead.\n\n  - \"tq\" is the total time in milliseconds spent waiting for the client to send\n    a full http request, not counting data. it can be \"-1\" if the connection\n    was aborted before a complete request could be received. it should always\n    be very small because a request generally fits in one single packet. large\n    times here generally indicate network trouble between the client and\n    haproxy. see \"timers\" below for more details.\n\n  - \"tw\" is the total time in milliseconds spent waiting in the various queues.\n    it can be \"-1\" if the connection was aborted before reaching the queue.\n    see \"timers\" below for more details.\n\n  - \"tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. it can be \"-1\" if the\n    request was aborted before a connection could be established. see \"timers\"\n    below for more details.\n\n  - \"tr\" is the total time in milliseconds spent waiting for the server to send\n    a full http response, not counting data. it can be \"-1\" if the request was\n    aborted before a complete response could be received. it generally matches\n    the server's processing time for the request, though it may be altered by\n    the amount of data sent by the client to the server. large times here on\n    \"get\" requests generally indicate an overloaded server. see \"timers\" below\n    for more details.\n\n  - \"tt\" is the total time in milliseconds elapsed between the accept and the\n    last close. it covers all possible processing. there is one exception, if\n    \"option logasap\" was specified, then the time counting stops at the moment\n    the log is emitted. in this case, a '+' sign is prepended before the value,\n    indicating that the final one will be larger. see \"timers\" below for more\n    details.\n\n  - \"status_code\" is the http status code returned to the client. this status\n    is generally set by the server, but it might also be set by haproxy when\n    the server cannot be reached or when its response is blocked by haproxy.\n\n  - \"bytes_read\" is the total number of bytes transmitted to the client when\n    the log is emitted. this does include http headers. if \"option logasap\" is\n    specified, the this value will be prefixed with a '+' sign indicating that\n    the final one may be larger. please note that this value is a 64-bit\n    counter, so log analysis tools must be able to handle it without\n    overflowing.\n\n  - \"captured_request_cookie\" is an optional \"name=value\" entry indicating that\n    the client had this cookie in the request. the cookie name and its maximum\n    length are defined by the \"capture cookie\" statement in the frontend\n    configuration. the field is a single dash ('-') when the option is not\n    set. only one cookie may be captured, it is generally used to track session\n    id exchanges between a client and a server to detect session crossing\n    between clients due to application bugs. for more details, please consult\n    the section \"capturing http headers and cookies\" below.\n\n  - \"captured_response_cookie\" is an optional \"name=value\" entry indicating\n    that the server has returned a cookie with its response. the cookie name\n    and its maximum length are defined by the \"capture cookie\" statement in the\n    frontend configuration. the field is a single dash ('-') when the option is\n    not set. only one cookie may be captured, it is generally used to track\n    session id exchanges between a client and a server to detect session\n    crossing between clients due to application bugs. for more details, please\n    consult the section \"capturing http headers and cookies\" below.\n\n  - \"termination_state\" is the condition the session was in when the session\n    ended. this indicates the session state, which side caused the end of\n    session to happen, for what reason (timeout, error, ...), just like in tcp\n    logs, and information about persistence operations on cookies in the last\n    two characters. the normal flags should begin with \"--\", indicating the\n    session was closed by either end with no data remaining in buffers. see\n    below \"session state at disconnection\" for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the session was logged. it is useful to detect when some per-process system\n    limits have been reached. for instance, if actconn is close to 512 or 1024\n    when multiple connection errors occur, chances are high that the system\n    limits the process to use a maximum of 1024 file descriptors and that all\n    of them are used. see section 3 \"global parameters\" to find how to tune the\n    system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the session was logged. it is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconn\"\n    has been reached. most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the session was logged. it includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. it is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the session was logged. it can never exceed the server's\n    configured \"maxconn\" parameter. if this value is very often close or equal\n    to the server's \"maxconn\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. when only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the requests to take longer to be\n    processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this session\n    when trying to connect to the server. it must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    frequent retries generally indicate either a network problem between\n    haproxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. this field may optionally be\n    prefixed with a '+' sign, indicating that the session has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. in this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. so as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queue\" is the total number of requests which were processed before\n    this one in the server queue. it is zero when the request has not gone\n    through the server queue. it makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. it is worth noting that if a session experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulated. a request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. it is zero when the request has not\n    gone through the global queue. it makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconn\" parameter. it is worth noting that if a\n    session experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulated. a request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n  - \"captured_request_headers\" is a list of headers captured in the request due\n    to the presence of the \"capture request header\" statement in the frontend.\n    multiple headers can be captured, they will be delimited by a vertical bar\n    ('|'). when no capture is enabled, the braces do not appear, causing a\n    shift of remaining fields. it is important to note that this field may\n    contain spaces, and that using it requires a smarter log parser than when\n    it's not used. please consult the section \"capturing http headers and\n    cookies\" below for more details.\n\n  - \"captured_response_headers\" is a list of headers captured in the response\n    due to the presence of the \"capture response header\" statement in the\n    frontend. multiple headers can be captured, they will be delimited by a\n    vertical bar ('|'). when no capture is enabled, the braces do not appear,\n    causing a shift of remaining fields. it is important to note that this\n    field may contain spaces, and that using it requires a smarter log parser\n    than when it's not used. please consult the section \"capturing http headers\n    and cookies\" below for more details.\n\n  - \"http_request\" is the complete http request line, including the method,\n    request and http version string. non-printable characters are encoded (see\n    below the section \"non-printable characters\"). this is always the last\n    field, and it is always delimited by quotes and is the only one which can\n    contain quotes. if new fields are added to the log format, they will be\n    added before this field. this field might be truncated if the request is\n    huge and does not fit in the standard syslog buffer (1024 characters). this\n    is the reason why this field must always remain the last one.\n\n8.2.4\\. custom log format\n------------------------\n\nthe directive log-format allows you to customize the logs in http mode and tcp\nmode. it takes a string as argument.\n\nhaproxy understands some log format variables. % precedes log format variables.\nvariables can take arguments using braces ('{}'), and multiple arguments are\nseparated by commas within the braces. flags may be added or removed by\nprefixing them with a '+' or '-' sign.\n\nspecial variable \"%o\" may be used to propagate its flags to all other\nvariables on the same format string. this is particularly handy with quoted\nstring formats (\"q\").\n\nif a variable is named between square brackets ('[' .. ']') then it is used\nas a sample expression rule (see section 7.3). this it useful to add some\nless common information such as the client's ssl certificate's dn, or to log\nthe key that would be used to store an entry into a stick table.\n\nnote: spaces must be escaped. a space character is considered as a separator.\nin order to emit a verbatim '%', it must be preceded by another '%' resulting\nin '%%'. haproxy will automatically merge consecutive separators.\n\nflags are :\n  * q: quote a string\n  * x: hexadecimal representation (ips, ports, %ts, %rt, %pid)\n\n  example:\n\n    log-format %t\\ %t\\ some\\ text\n    log-format %{+q}o\\ %t\\ %s\\ %{-q}r\n\nat the moment, the default http format is defined this way :\n\n    log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tq/%tw/%tc/%tr/%tt\\ %st\\ %b\\ %cc\\ \\\n               %cs\\ %tsc\\ %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\\ %hr\\ %hs\\ %{+q}r\n\nthe default clf format is defined this way :\n\n    log-format %{+q}o\\ %{-q}ci\\ -\\ -\\ [%t]\\ %r\\ %st\\ %b\\ \\\"\\\"\\ \\\"\\\"\\ %cp\\ \\\n               %ms\\ %ft\\ %b\\ %s\\ \\%tq\\ %tw\\ %tc\\ %tr\\ %tt\\ %tsc\\ %ac\\ %fc\\ \\\n               %bc\\ %sc\\ %rc\\ %sq\\ %bq\\ %cc\\ %cs\\ \\%hrl\\ %hsl\n\nand the default tcp format is defined this way :\n\n    log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tw/%tc/%tt\\ %b\\ %ts\\ \\\n               %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\n\nplease refer to the table below for currently defined variables :\n\n  +---+------+-----------------------------------------------+-------------+\n  | r | var  | field name (8.2.2 and 8.2.3 for description)  | type        |\n  +---+------+-----------------------------------------------+-------------+\n  |   | %o   | special variable, apply flags on all next var |             |\n  +---+------+-----------------------------------------------+-------------+\n  |   | %b   | bytes_read           (from server to client)  | numeric     |\n  | h | %cc  | captured_request_cookie                       | string      |\n  | h | %cs  | captured_response_cookie                      | string      |\n  |   | %h   | hostname                                      | string      |\n  | h | %hm  | http method (ex: post)                        | string      |\n  | h | %hp  | http request uri without query string (path)  | string      |\n  | h | %hu  | http request uri (ex: /foo?bar=baz)           | string      |\n  | h | %hv  | http version (ex: http/1.0)                   | string      |\n  |   | %id  | unique-id                                     | string      |\n  |   | %st  | status_code                                   | numeric     |\n  |   | %t   | gmt_date_time                                 | date        |\n  |   | %tc  | tc                                            | numeric     |\n  |   | %tl  | local_date_time                               | date        |\n  | h | %tq  | tq                                            | numeric     |\n  | h | %tr  | tr                                            | numeric     |\n  |   | %ts  | timestamp                                     | numeric     |\n  |   | %tt  | tt                                            | numeric     |\n  |   | %tw  | tw                                            | numeric     |\n  |   | %u   | bytes_uploaded       (from client to server)  | numeric     |\n  |   | %ac  | actconn                                       | numeric     |\n  |   | %b   | backend_name                                  | string      |\n  |   | %bc  | beconn      (backend concurrent connections)  | numeric     |\n  |   | %bi  | backend_source_ip       (connecting address)  | ip          |\n  |   | %bp  | backend_source_port     (connecting address)  | numeric     |\n  |   | %bq  | backend_queue                                 | numeric     |\n  |   | %ci  | client_ip                 (accepted address)  | ip          |\n  |   | %cp  | client_port               (accepted address)  | numeric     |\n  |   | %f   | frontend_name                                 | string      |\n  |   | %fc  | feconn     (frontend concurrent connections)  | numeric     |\n  |   | %fi  | frontend_ip              (accepting address)  | ip          |\n  |   | %fp  | frontend_port            (accepting address)  | numeric     |\n  |   | %ft  | frontend_name_transport ('~' suffix for ssl)  | string      |\n  |   | %lc  | frontend_log_counter                          | numeric     |\n  |   | %hr  | captured_request_headers default style        | string      |\n  |   | %hrl | captured_request_headers clf style            | string list |\n  |   | %hs  | captured_response_headers default style       | string      |\n  |   | %hsl | captured_response_headers clf style           | string list |\n  |   | %ms  | accept date milliseconds                      | numeric     |\n  |   | %pid | pid                                           | numeric     |\n  | h | %r   | http_request                                  | string      |\n  |   | %rc  | retries                                       | numeric     |\n  |   | %rt  | request_counter (http req or tcp session)     | numeric     |\n  |   | %s   | server_name                                   | string      |\n  |   | %sc  | srv_conn     (server concurrent connections)  | numeric     |\n  |   | %si  | server_ip                   (target address)  | ip          |\n  |   | %sp  | server_port                 (target address)  | numeric     |\n  |   | %sq  | srv_queue                                     | numeric     |\n  | s | %sslc| ssl_ciphers (ex: aes-sha)                     | string      |\n  | s | %sslv| ssl_version (ex: tlsv1)                       | string      |\n  |   | %t   | date_time      (with millisecond resolution)  | date        |\n  |   | %ts  | termination_state                             | string      |\n  | h | %tsc | termination_state with cookie status          | string      |\n  +---+------+-----------------------------------------------+-------------+\n\n    r = restrictions : h = mode http only ; s = ssl only\n\n8.2.5\\. error log format\n-----------------------\n\nwhen an incoming connection fails due to an ssl handshake or an invalid proxy\nprotocol header, haproxy will log the event using a shorter, fixed line format.\nby default, logs are emitted at the log_info level, unless the option\n\"log-separate-errors\" is set in the backend, in which case the log_err level\nwill be used. connections on which no data are exchanged (eg: probes) are not\nlogged if the \"dontlognull\" option is set.\n\nthe format looks like this :\n\n    >>> dec  3 18:27:14 localhost \\\n          haproxy[6103]: 127.0.0.1:56059 [03/dec/2012:17:35:10.380] frt/f1: \\\n          connection error during ssl handshake\n\n  field   format                                extract from the example above\n      1   process_name '[' pid ']:'                             haproxy[6103]:\n      2   client_ip ':' client_port                            127.0.0.1:56059\n      3   '[' accept_date ']'                       [03/dec/2012:17:35:10.380]\n      4   frontend_name \"/\" bind_name \":\"                              frt/f1:\n      5   message                        connection error during ssl handshake\n\nthese fields just provide minimal information to help debugging connection\nfailures.\n\n8.3\\. advanced logging options\n-----------------------------\n\nsome advanced logging options are often looked for but are not easy to find out\njust by looking at the various options. here is an entry point for the few\noptions which can enable better logging. please refer to the keywords reference\nfor more information about their usage.\n\n8.3.1\\. disabling logging of external tests\n------------------------------------------\n\nit is quite common to have some monitoring tools perform health checks on\nhaproxy. sometimes it will be a layer 3 load-balancer such as lvs or any\ncommercial load-balancer, and sometimes it will simply be a more complete\nmonitoring system such as nagios. when the tests are very frequent, users often\nask how to disable logging for those checks. there are three possibilities :\n\n  - if connections come from everywhere and are just tcp probes, it is often\n    desired to simply disable logging of connections without data exchange, by\n    setting \"option dontlognull\" in the frontend. it also disables logging of\n    port scans, which may or may not be desired.\n\n  - if the connection come from a known source network, use \"monitor-net\" to\n    declare this network as monitoring only. any host in this network will then\n    only be able to perform health checks, and their requests will not be\n    logged. this is generally appropriate to designate a list of equipment\n    such as other load-balancers.\n\n  - if the tests are performed on a known uri, use \"monitor-uri\" to declare\n    this uri as dedicated to monitoring. any host sending this request will\n    only get the result of a health-check, and the request will not be logged.\n\n8.3.2\\. logging before waiting for the session to terminate\n----------------------------------------------------------\n\nthe problem with logging at end of connection is that you have no clue about\nwhat is happening during very long sessions, such as remote terminal sessions\nor large file downloads. this problem can be worked around by specifying\n\"option logasap\" in the frontend. haproxy will then log as soon as possible,\njust before data transfer begins. this means that in case of tcp, it will still\nlog the connection status to the server, and in case of http, it will log just\nafter processing the server headers. in this case, the number of bytes reported\nis the number of header bytes sent to the client. in order to avoid confusion\nwith normal logs, the total time field and the number of bytes are prefixed\nwith a '+' sign which means that real numbers are certainly larger.\n\n8.3.3\\. raising log level upon errors\n------------------------------------\n\nsometimes it is more convenient to separate normal traffic from errors logs,\nfor instance in order to ease error monitoring from log files. when the option\n\"log-separate-errors\" is used, connections which experience errors, timeouts,\nretries, redispatches or http status codes 5xx will see their syslog level\nraised from \"info\" to \"err\". this will help a syslog daemon store the log in\na separate file. it is very important to keep the errors in the normal traffic\nfile too, so that log ordering is not altered. you should also be careful if\nyou already have configured your syslog daemon to store all logs higher than\n\"notice\" in an \"admin\" file, because the \"err\" level is higher than \"notice\".\n\n8.3.4\\. disabling logging of successful connections\n--------------------------------------------------\n\nalthough this may sound strange at first, some large sites have to deal with\nmultiple thousands of logs per second and are experiencing difficulties keeping\nthem intact for a long time or detecting errors within them. if the option\n\"dontlog-normal\" is set on the frontend, all normal connections will not be\nlogged. in this regard, a normal connection is defined as one without any\nerror, timeout, retry nor redispatch. in http, the status code is checked too,\nand a response with a status 5xx is not considered normal and will be logged\ntoo. of course, doing is is really discouraged as it will remove most of the\nuseful information from the logs. do this only if you have no other\nalternative.\n\n8.4\\. timing events\n------------------\n\ntimers provide a great help in troubleshooting network problems. all values are\nreported in milliseconds (ms). these timers should be used in conjunction with\nthe session termination flags. in tcp mode with \"option tcplog\" set on the\nfrontend, 3 control points are reported under the form \"tw/tc/tt\", and in http\nmode, 5 control points are reported under the form \"tq/tw/tc/tr/tt\" :\n\n  - tq: total time to get the client request (http mode only). it's the time\n    elapsed between the moment the client connection was accepted and the\n    moment the proxy received the last http header. the value \"-1\" indicates\n    that the end of headers (empty line) has never been seen. this happens when\n    the client closes prematurely or times out.\n\n  - tw: total time spent in the queues waiting for a connection slot. it\n    accounts for backend queue as well as the server queues, and depends on the\n    queue size, and the time needed for the server to complete previous\n    requests. the value \"-1\" means that the request was killed before reaching\n    the queue, which is generally what happens with invalid or denied requests.\n\n  - tc: total time to establish the tcp connection to the server. it's the time\n    elapsed between the moment the proxy sent the connection request, and the\n    moment it was acknowledged by the server, or between the tcp syn packet and\n    the matching syn/ack packet in return. the value \"-1\" means that the\n    connection never established.\n\n  - tr: server response time (http mode only). it's the time elapsed between\n    the moment the tcp connection was established to the server and the moment\n    the server sent its complete response headers. it purely shows its request\n    processing time, without the network overhead due to the data transmission.\n    it is worth noting that when the client has data to send to the server, for\n    instance during a post request, the time already runs, and this can distort\n    apparent response time. for this reason, it's generally wise not to trust\n    too much this field for post requests initiated from clients behind an\n    untrusted network. a value of \"-1\" here means that the last the response\n    header (empty line) was never seen, most likely because the server timeout\n    stroke before the server managed to process the request.\n\n  - tt: total session duration time, between the moment the proxy accepted it\n    and the moment both ends were closed. the exception is when the \"logasap\"\n    option is specified. in this case, it only equals (tq+tw+tc+tr), and is\n    prefixed with a '+' sign. from this field, we can deduce \"td\", the data\n    transmission time, by subtracting other timers when valid :\n\n        td = tt - (tq + tw + tc + tr)\n\n    timers with \"-1\" values have to be excluded from this equation. in tcp\n    mode, \"tq\" and \"tr\" have to be excluded too. note that \"tt\" can never be\n    negative.\n\nthese timers provide precious indications on trouble causes. since the tcp\nprotocol defines retransmit delays of 3, 6, 12... seconds, we know for sure\nthat timers close to multiples of 3s are nearly always related to lost packets\ndue to network problems (wires, negotiation, congestion). moreover, if \"tt\" is\nclose to a timeout value specified in the configuration, it often means that a\nsession has been aborted on timeout.\n\nmost common cases :\n\n  - if \"tq\" is close to 3000, a packet has probably been lost between the\n    client and the proxy. this is very rare on local networks but might happen\n    when clients are on far remote networks and send large requests. it may\n    happen that values larger than usual appear here without any network cause.\n    sometimes, during an attack or just after a resource starvation has ended,\n    haproxy may accept thousands of connections in a few milliseconds. the time\n    spent accepting these connections will inevitably slightly delay processing\n    of other connections, and it can happen that request times in the order of\n    a few tens of milliseconds are measured after a few thousands of new\n    connections have been accepted at once. setting \"option http-server-close\"\n    may display larger request times since \"tq\" also measures the time spent\n    waiting for additional requests.\n\n  - if \"tc\" is close to 3000, a packet has probably been lost between the\n    server and the proxy during the server connection phase. this value should\n    always be very low, such as 1 ms on local networks and less than a few tens\n    of ms on remote networks.\n\n  - if \"tr\" is nearly always lower than 3000 except some rare values which seem\n    to be the average majored by 3000, there are probably some packets lost\n    between the proxy and the server.\n\n  - if \"tt\" is large even for small byte counts, it generally is because\n    neither the client nor the server decides to close the connection, for\n    instance because both have agreed on a keep-alive connection mode. in order\n    to solve this issue, it will be needed to specify \"option httpclose\" on\n    either the frontend or the backend. if the problem persists, it means that\n    the server ignores the \"close\" connection mode and expects the client to\n    close. then it will be required to use \"option forceclose\". having the\n    smallest possible 'tt' is important when connection regulation is used with\n    the \"maxconn\" option on the servers, since no new connection will be sent\n    to the server until another one is released.\n\nother noticeable http log cases ('xx' means any value to be ignored) :\n\n  tq/tw/tc/tr/+tt  the \"option logasap\" is present on the frontend and the log\n                   was emitted before the data phase. all the timers are valid\n                   except \"tt\" which is shorter than reality.\n\n  -1/xx/xx/xx/tt   the client was not able to send a complete request in time\n                   or it aborted too early. check the session termination flags\n                   then \"timeout http-request\" and \"timeout client\" settings.\n\n  tq/-1/xx/xx/tt   it was not possible to process the request, maybe because\n                   servers were out of order, because the request was invalid\n                   or forbidden by acl rules. check the session termination\n                   flags.\n\n  tq/tw/-1/xx/tt   the connection could not establish on the server. either it\n                   actively refused it or it timed out after tt-(tq+tw) ms.\n                   check the session termination flags, then check the\n                   \"timeout connect\" setting. note that the tarpit action might\n                   return similar-looking patterns, with \"tw\" equal to the time\n                   the client connection was maintained open.\n\n  tq/tw/tc/-1/tt   the server has accepted the connection but did not return\n                   a complete response in time, or it closed its connection\n                   unexpectedly after tt-(tq+tw+tc) ms. check the session\n                   termination flags, then check the \"timeout server\" setting.\n\n8.5\\. session state at disconnection\n-----------------------------------\n\ntcp and http logs provide a session termination indicator in the\n\"termination_state\" field, just before the number of active connections. it is\n2-characters long in tcp mode, and is extended to 4 characters in http mode,\neach of which has a special meaning :\n\n  - on the first character, a code reporting the first event which caused the\n    session to terminate :\n\n        c : the tcp session was unexpectedly aborted by the client.\n\n        s : the tcp session was unexpectedly aborted by the server, or the\n            server explicitly refused it.\n\n        p : the session was prematurely aborted by the proxy, because of a\n            connection limit enforcement, because a deny filter was matched,\n            because of a security check which detected and blocked a dangerous\n            error in server response which might have caused information leak\n            (eg: cacheable cookie).\n\n        l : the session was locally processed by haproxy and was not passed to\n            a server. this is what happens for stats and redirects.\n\n        r : a resource on the proxy has been exhausted (memory, sockets, source\n            ports, ...). usually, this appears during the connection phase, and\n            system logs should contain a copy of the precise error. if this\n            happens, it must be considered as a very serious anomaly which\n            should be fixed as soon as possible by any means.\n\n        i : an internal error was identified by the proxy during a self-check.\n            this should never happen, and you are encouraged to report any log\n            containing this, because this would almost certainly be a bug. it\n            would be wise to preventively restart the process after such an\n            event too, in case it would be caused by memory corruption.\n\n        d : the session was killed by haproxy because the server was detected\n            as down and was configured to kill all connections when going down.\n\n        u : the session was killed by haproxy on this backup server because an\n            active server was detected as up and was configured to kill all\n            backup connections when going up.\n\n        k : the session was actively killed by an admin operating on haproxy.\n\n        c : the client-side timeout expired while waiting for the client to\n            send or receive data.\n\n        s : the server-side timeout expired while waiting for the server to\n            send or receive data.\n\n        - : normal session completion, both the client and the server closed\n            with nothing left in the buffers.\n\n  - on the second character, the tcp or http session state when it was closed :\n\n        r : the proxy was waiting for a complete, valid request from the client\n            (http mode only). nothing was sent to any server.\n\n        q : the proxy was waiting in the queue for a connection slot. this can\n            only happen when servers have a 'maxconn' parameter set. it can\n            also happen in the global queue after a redispatch consecutive to\n            a failed attempt to connect to a dying server. if no redispatch is\n            reported, then no connection attempt was made to any server.\n\n        c : the proxy was waiting for the connection to establish on the\n            server. the server might at most have noticed a connection attempt.\n\n        h : the proxy was waiting for complete, valid response headers from the\n            server (http only).\n\n        d : the session was in the data phase.\n\n        l : the proxy was still transmitting last data to the client while the\n            server had already finished. this one is very rare as it can only\n            happen when the client dies while receiving the last packets.\n\n        t : the request was tarpitted. it has been held open with the client\n            during the whole \"timeout tarpit\" duration or until the client\n            closed, both of which will be reported in the \"tw\" timer.\n\n        - : normal session completion after end of data transfer.\n\n  - the third character tells whether the persistence cookie was provided by\n    the client (only in http mode) :\n\n        n : the client provided no cookie. this is usually the case for new\n            visitors, so counting the number of occurrences of this flag in the\n            logs generally indicate a valid trend for the site frequentation.\n\n        i : the client provided an invalid cookie matching no known server.\n            this might be caused by a recent configuration change, mixed\n            cookies between http/https sites, persistence conditionally\n            ignored, or an attack.\n\n        d : the client provided a cookie designating a server which was down,\n            so either \"option persist\" was used and the client was sent to\n            this server, or it was not set and the client was redispatched to\n            another server.\n\n        v : the client provided a valid cookie, and was sent to the associated\n            server.\n\n        e : the client provided a valid cookie, but with a last date which was\n            older than what is allowed by the \"maxidle\" cookie parameter, so\n            the cookie is consider expired and is ignored. the request will be\n            redispatched just as if there was no cookie.\n\n        o : the client provided a valid cookie, but with a first date which was\n            older than what is allowed by the \"maxlife\" cookie parameter, so\n            the cookie is consider too old and is ignored. the request will be\n            redispatched just as if there was no cookie.\n\n        u : a cookie was present but was not used to select the server because\n            some other server selection mechanism was used instead (typically a\n            \"use-server\" rule).\n\n        - : does not apply (no cookie set in configuration).\n\n  - the last character reports what operations were performed on the persistence\n    cookie returned by the server (only in http mode) :\n\n        n : no cookie was provided by the server, and none was inserted either.\n\n        i : no cookie was provided by the server, and the proxy inserted one.\n            note that in \"cookie insert\" mode, if the server provides a cookie,\n            it will still be overwritten and reported as \"i\" here.\n\n        u : the proxy updated the last date in the cookie that was presented by\n            the client. this can only happen in insert mode with \"maxidle\". it\n            happens every time there is activity at a different date than the\n            date indicated in the cookie. if any other change happens, such as\n            a redispatch, then the cookie will be marked as inserted instead.\n\n        p : a cookie was provided by the server and transmitted as-is.\n\n        r : the cookie provided by the server was rewritten by the proxy, which\n            happens in \"cookie rewrite\" or \"cookie prefix\" modes.\n\n        d : the cookie provided by the server was deleted by the proxy.\n\n        - : does not apply (no cookie set in configuration).\n\nthe combination of the two first flags gives a lot of information about what\nwas happening when the session terminated, and why it did terminate. it can be\nhelpful to detect server saturation, network troubles, local system resource\nstarvation, attacks, etc...\n\nthe most common termination flags combinations are indicated below. they are\nalphabetically sorted, with the lowercase set just after the upper case for\neasier finding and understanding.\n\n  flags   reason\n\n     --   normal termination.\n\n     cc   the client aborted before the connection could be established to the\n          server. this can happen when haproxy tries to connect to a recently\n          dead (or unchecked) server, and the client aborts while haproxy is\n          waiting for the server to respond or for \"timeout connect\" to expire.\n\n     cd   the client unexpectedly aborted during data transfer. this can be\n          caused by a browser crash, by an intermediate equipment between the\n          client and haproxy which decided to actively break the connection,\n          by network routing issues between the client and haproxy, or by a\n          keep-alive session between the server and the client terminated first\n          by the client.\n\n     cd   the client did not send nor acknowledge any data for as long as the\n          \"timeout client\" delay. this is often caused by network failures on\n          the client side, or the client simply leaving the net uncleanly.\n\n     ch   the client aborted while waiting for the server to start responding.\n          it might be the server taking too long to respond or the client\n          clicking the 'stop' button too fast.\n\n     ch   the \"timeout client\" stroke while waiting for client data during a\n          post request. this is sometimes caused by too large tcp mss values\n          for pppoe networks which cannot transport full-sized packets. it can\n          also happen when client timeout is smaller than server timeout and\n          the server takes too long to respond.\n\n     cq   the client aborted while its session was queued, waiting for a server\n          with enough empty slots to accept it. it might be that either all the\n          servers were saturated or that the assigned server was taking too\n          long a time to respond.\n\n     cr   the client aborted before sending a full http request. most likely\n          the request was typed by hand using a telnet client, and aborted\n          too early. the http status code is likely a 400 here. sometimes this\n          might also be caused by an ids killing the connection between haproxy\n          and the client. \"option http-ignore-probes\" can be used to ignore\n          connections without any data transfer.\n\n     cr   the \"timeout http-request\" stroke before the client sent a full http\n          request. this is sometimes caused by too large tcp mss values on the\n          client side for pppoe networks which cannot transport full-sized\n          packets, or by clients sending requests by hand and not typing fast\n          enough, or forgetting to enter the empty line at the end of the\n          request. the http status code is likely a 408 here. note: recently,\n          some browsers started to implement a \"pre-connect\" feature consisting\n          in speculatively connecting to some recently visited web sites just\n          in case the user would like to visit them. this results in many\n          connections being established to web sites, which end up in 408\n          request timeout if the timeout strikes first, or 400 bad request when\n          the browser decides to close them first. these ones pollute the log\n          and feed the error counters. some versions of some browsers have even\n          been reported to display the error code. it is possible to work\n          around the undesirable effects of this behaviour by adding \"option\n          http-ignore-probes\" in the frontend, resulting in connections with\n          zero data transfer to be totally ignored. this will definitely hide\n          the errors of people experiencing connectivity issues though.\n\n     ct   the client aborted while its session was tarpitted. it is important to\n          check if this happens on valid requests, in order to be sure that no\n          wrong tarpit rules have been written. if a lot of them happen, it\n          might make sense to lower the \"timeout tarpit\" value to something\n          closer to the average reported \"tw\" timer, in order not to consume\n          resources for just a few attackers.\n\n     lr   the request was intercepted and locally handled by haproxy. generally\n          it means that this was a redirect or a stats request.\n\n     sc   the server or an equipment between it and haproxy explicitly refused\n          the tcp connection (the proxy received a tcp rst or an icmp message\n          in return). under some circumstances, it can also be the network\n          stack telling the proxy that the server is unreachable (eg: no route,\n          or no arp response on local network). when this happens in http mode,\n          the status code is likely a 502 or 503 here.\n\n     sc   the \"timeout connect\" stroke before a connection to the server could\n          complete. when this happens in http mode, the status code is likely a\n          503 or 504 here.\n\n     sd   the connection to the server died with an error during the data\n          transfer. this usually means that haproxy has received an rst from\n          the server or an icmp message from an intermediate equipment while\n          exchanging data with the server. this can be caused by a server crash\n          or by a network issue on an intermediate equipment.\n\n     sd   the server did not send nor acknowledge any data for as long as the\n          \"timeout server\" setting during the data phase. this is often caused\n          by too short timeouts on l4 equipments before the server (firewalls,\n          load-balancers, ...), as well as keep-alive sessions maintained\n          between the client and the server expiring first on haproxy.\n\n     sh   the server aborted before sending its full http response headers, or\n          it crashed while processing the request. since a server aborting at\n          this moment is very rare, it would be wise to inspect its logs to\n          control whether it crashed and why. the logged request may indicate a\n          small set of faulty requests, demonstrating bugs in the application.\n          sometimes this might also be caused by an ids killing the connection\n          between haproxy and the server.\n\n     sh   the \"timeout server\" stroke before the server could return its\n          response headers. this is the most common anomaly, indicating too\n          long transactions, probably caused by server or database saturation.\n          the immediate workaround consists in increasing the \"timeout server\"\n          setting, but it is important to keep in mind that the user experience\n          will suffer from these long response times. the only long term\n          solution is to fix the application.\n\n     sq   the session spent too much time in queue and has been expired. see\n          the \"timeout queue\" and \"timeout connect\" settings to find out how to\n          fix this if it happens too often. if it often happens massively in\n          short periods, it may indicate general problems on the affected\n          servers due to i/o or database congestion, or saturation caused by\n          external attacks.\n\n     pc   the proxy refused to establish a connection to the server because the\n          process' socket limit has been reached while attempting to connect.\n          the global \"maxconn\" parameter may be increased in the configuration\n          so that it does not happen anymore. this status is very rare and\n          might happen when the global \"ulimit-n\" parameter is forced by hand.\n\n     pd   the proxy blocked an incorrectly formatted chunked encoded message in\n          a request or a response, after the server has emitted its headers. in\n          most cases, this will indicate an invalid message from the server to\n          the client. haproxy supports chunk sizes of up to 2gb - 1 (2147483647\n          bytes). any larger size will be considered as an error.\n\n     ph   the proxy blocked the server's response, because it was invalid,\n          incomplete, dangerous (cache control), or matched a security filter.\n          in any case, an http 502 error is sent to the client. one possible\n          cause for this error is an invalid syntax in an http header name\n          containing unauthorized characters. it is also possible but quite\n          rare, that the proxy blocked a chunked-encoding request from the\n          client due to an invalid syntax, before the server responded. in this\n          case, an http 400 error is sent to the client and reported in the\n          logs.\n\n     pr   the proxy blocked the client's http request, either because of an\n          invalid http syntax, in which case it returned an http 400 error to\n          the client, or because a deny filter matched, in which case it\n          returned an http 403 error.\n\n     pt   the proxy blocked the client's request and has tarpitted its\n          connection before returning it a 500 server error. nothing was sent\n          to the server. the connection was maintained open for as long as\n          reported by the \"tw\" timer field.\n\n     rc   a local resource has been exhausted (memory, sockets, source ports)\n          preventing the connection to the server from establishing. the error\n          logs will tell precisely what was missing. this is very rare and can\n          only be solved by proper system tuning.\n\nthe combination of the two last flags gives a lot of information about how\npersistence was handled by the client, the server and by haproxy. this is very\nimportant to troubleshoot disconnections, when users complain they have to\nre-authenticate. the commonly encountered flags are :\n\n     --   persistence cookie is not enabled.\n\n     nn   no cookie was provided by the client, none was inserted in the\n          response. for instance, this can be in insert mode with \"postonly\"\n          set on a get request.\n\n     ii   a cookie designating an invalid server was provided by the client,\n          a valid one was inserted in the response. this typically happens when\n          a \"server\" entry is removed from the configuration, since its cookie\n          value can be presented by a client when no other server knows it.\n\n     ni   no cookie was provided by the client, one was inserted in the\n          response. this typically happens for first requests from every user\n          in \"insert\" mode, which makes it an easy way to count real users.\n\n     vn   a cookie was provided by the client, none was inserted in the\n          response. this happens for most responses for which the client has\n          already got a cookie.\n\n     vu   a cookie was provided by the client, with a last visit date which is\n          not completely up-to-date, so an updated cookie was provided in\n          response. this can also happen if there was no date at all, or if\n          there was a date but the \"maxidle\" parameter was not set, so that the\n          cookie can be switched to unlimited time.\n\n     ei   a cookie was provided by the client, with a last visit date which is\n          too old for the \"maxidle\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     oi   a cookie was provided by the client, with a first visit date which is\n          too old for the \"maxlife\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     di   the server designated by the cookie was down, a new server was\n          selected and a new cookie was emitted in the response.\n\n     vi   the server designated by the cookie was not marked dead but could not\n          be reached. a redispatch happened and selected another one, which was\n          then advertised in the response.\n\n8.6\\. non-printable characters\n-----------------------------\n\nin order not to cause trouble to log analysis tools or terminals during log\nconsulting, non-printable characters are not sent as-is into log files, but are\nconverted to the two-digits hexadecimal representation of their ascii code,\nprefixed by the character '#'. the only characters that can be logged without\nbeing escaped are comprised between 32 and 126 (inclusive). obviously, the\nescape character '#' itself is also encoded to avoid any ambiguity (\"#23\"). it\nis the same for the character '\"' which becomes \"#22\", as well as '{', '|' and\n'}' when logging headers.\n\nnote that the space character (' ') is not encoded in headers, which can cause\nissues for tools relying on space count to locate fields. a typical header\ncontaining spaces is \"user-agent\".\n\nlast, it has been observed that some syslog daemons such as syslog-ng escape\nthe quote ('\"') with a backslash ('\\'). the reverse operation can safely be\nperformed since no quote may appear anywhere else in the logs.\n\n8.7\\. capturing http cookies\n---------------------------\n\ncookie capture simplifies the tracking a complete user session. this can be\nachieved using the \"capture cookie\" statement in the frontend. please refer to\nsection 4.2 for more details. only one cookie can be captured, and the same\ncookie will simultaneously be checked in the request (\"cookie:\" header) and in\nthe response (\"set-cookie:\" header). the respective values will be reported in\nthe http logs at the \"captured_request_cookie\" and \"captured_response_cookie\"\nlocations (see section 8.2.3 about http log format). when either cookie is\nnot seen, a dash ('-') replaces the value. this way, it's easy to detect when a\nuser switches to a new session for example, because the server will reassign it\na new cookie. it is also possible to detect if a server unexpectedly sets a\nwrong cookie to a client, leading to session crossing.\n\n  examples :\n        # capture the first cookie whose name starts with \"aspsession\"\n        capture cookie aspsession len 32\n\n        # capture the first cookie whose name is exactly \"vgnvisitor\"\n        capture cookie vgnvisitor= len 32\n\n8.8\\. capturing http headers\n---------------------------\n\nheader captures are useful to track unique request identifiers set by an upper\nproxy, virtual host names, user-agents, post content-length, referrers, etc. in\nthe response, one can search for information about the response length, how the\nserver asked the cache to behave, or an object location during a redirection.\n\nheader captures are performed using the \"capture request header\" and \"capture\nresponse header\" statements in the frontend. please consult their definition in\nsection 4.2 for more details.\n\nit is possible to include both request headers and response headers at the same\ntime. non-existent headers are logged as empty strings, and if one header\nappears more than once, only its last occurrence will be logged. request headers\nare grouped within braces '{' and '}' in the same order as they were declared,\nand delimited with a vertical bar '|' without any space. response headers\nfollow the same representation, but are displayed after a space following the\nrequest headers block. these blocks are displayed just before the http request\nin the logs.\n\nas a special case, it is possible to specify an http header capture in a tcp\nfrontend. the purpose is to enable logging of headers which will be parsed in\nan http backend if the request is then switched to this http backend.\n\n  example :\n        # this instance chains to the outgoing proxy\n        listen proxy-out\n            mode http\n            option httplog\n            option logasap\n            log global\n            server cache1 192.168.1.1:3128\n\n            # log the name of the virtual server\n            capture request  header host len 20\n\n            # log the amount of data uploaded during a post\n            capture request  header content-length len 10\n\n            # log the beginning of the referrer\n            capture request  header referer len 20\n\n            # server name (useful for outgoing proxies only)\n            capture response header server len 20\n\n            # logging the content-length is useful with \"option logasap\"\n            capture response header content-length len 10\n\n            # log the expected cache behaviour on the response\n            capture response header cache-control len 8\n\n            # the via header will report the next proxy's name\n            capture response header via len 20\n\n            # log the url location during a redirection\n            capture response header location len 20\n\n    >>> aug  9 20:26:09 localhost \\\n          haproxy[2022]: 127.0.0.1:34014 [09/aug/2004:20:26:09] proxy-out \\\n          proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \\\n          {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \\\n          \"get http://fr.adserver.yahoo.com/\"\n\n    >>> aug  9 20:30:46 localhost \\\n          haproxy[2022]: 127.0.0.1:34020 [09/aug/2004:20:30:46] proxy-out \\\n          proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \\\n          {w.ods.org||} {formilux/0.1.8|3495|||} \\\n          \"get http://trafic.1wt.eu/ http/1.1\"\n\n    >>> aug  9 20:30:46 localhost \\\n          haproxy[2022]: 127.0.0.1:34028 [09/aug/2004:20:30:46] proxy-out \\\n          proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \\\n          {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \\\n          {apache|230|||http://www.sytadin.} \\\n          \"get http://www.sytadin.equipement.gouv.fr/ http/1.1\"\n\n8.9\\. examples of logs\n---------------------\n\nthese are real-world examples of logs accompanied with an explanation. some of\nthem have been made up by hand. the syslog part has been removed for better\nreading. their sole purpose is to explain how to decipher them.\n\n    >>> haproxy[674]: 127.0.0.1:33318 [15/oct/2003:08:31:57.130] px-http \\\n          px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \\\n          \"head / http/1.0\"\n\n    => long request (6.5s) entered by hand through 'telnet'. the server replied\n       in 147 ms, and the session ended normally ('----')\n\n    >>> haproxy[674]: 127.0.0.1:33319 [15/oct/2003:08:31:57.149] px-http \\\n          px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \\\n          0/9 \"head / http/1.0\"\n\n    => idem, but the request was queued in the global queue behind 9 other\n       requests, and waited there for 1230 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.654] px-http \\\n          px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \\\n          \"get /image.iso http/1.0\"\n\n    => request for a long data transfer. the \"logasap\" option was specified, so\n       the log was produced just before transferring data. the server replied in\n       14 ms, 243 bytes of headers were sent to the client, and total time from\n       accept to first data byte is 30 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.925] px-http \\\n          px-http/srv1 9/0/7/14/30 502 243 - - ph-- 3/2/2/0/0 0/0 \\\n          \"get /cgi-bin/bug.cgi? http/1.0\"\n\n    => the proxy blocked a server response either because of an \"rspdeny\" or\n       \"rspideny\" filter, or because the response was improperly formatted and\n       not http-compliant, or because it blocked sensitive information which\n       risked being cached. in this case, the response is replaced with a \"502\n       bad gateway\". the flags (\"ph--\") tell us that it was haproxy who decided\n       to return the 502 and not the server.\n\n    >>> haproxy[18113]: 127.0.0.1:34548 [15/oct/2003:15:18:55.798] px-http \\\n          px-http/<nosrv> -1/-1/-1/-1/8490 -1 0 - - cr-- 2/2/2/0/0 0/0 \"\"\n\n    => the client never completed its request and aborted itself (\"c---\") after\n       8.5s, while the proxy was waiting for the request headers (\"-r--\").\n       nothing was sent to any server.\n\n    >>> haproxy[18113]: 127.0.0.1:34549 [15/oct/2003:15:19:06.103] px-http \\\n         px-http/<nosrv> -1/-1/-1/-1/50001 408 0 - - cr-- 2/2/2/0/0 0/0 \"\"\n\n    => the client never completed its request, which was aborted by the\n       time-out (\"c---\") after 50s, while the proxy was waiting for the request\n       headers (\"-r--\").  nothing was sent to any server, but the proxy could\n       send a 408 return code to the client.\n\n    >>> haproxy[18989]: 127.0.0.1:34550 [15/oct/2003:15:24:28.312] px-tcp \\\n          px-tcp/srv1 0/0/5007 0 cd 0/0/0/0/0 0/0\n\n    => this log was produced with \"option tcplog\". the client timed out after\n       5 seconds (\"c----\").\n\n    >>> haproxy[18989]: 10.0.0.1:34552 [15/oct/2003:15:26:31.462] px-http \\\n          px-http/srv1 3183/-1/-1/-1/11215 503 0 - - sc-- 205/202/202/115/3 \\\n          0/0 \"head / http/1.0\"\n\n    => the request took 3s to complete (probably a network problem), and the\n       connection to the server failed ('sc--') after 4 attempts of 2 seconds\n       (config says 'retries 3'), and no redispatch (otherwise we would have\n       seen \"/+3\"). status code 503 was returned to the client. there were 115\n       connections on this server, 202 connections on this proxy, and 205 on\n       the global process. it is possible that the server refused the\n       connection because of too many already established.\n\n9\\. statistics and monitoring\n----------------------------\n\nit is possible to query haproxy about its status. the most commonly used\nmechanism is the http statistics page. this page also exposes an alternative\ncsv output format for monitoring tools. the same format is provided on the\nunix socket.\n\n9.1\\. csv format\n---------------\n\nthe statistics may be consulted either from the unix socket or from the http\npage. both means provide a csv format whose fields follow. the first line\nbegins with a sharp ('#') and has one word per comma-delimited field which\nrepresents the title of the column. all other lines starting at the second one\nuse a classical csv format using a comma as the delimiter, and the double quote\n('\"') as an optional text delimiter, but only if the enclosed text is ambiguous\n(if it contains a quote or a comma). the double-quote character ('\"') in the\ntext is doubled ('\"\"'), which is the format that most tools recognize. please\ndo not insert any column before these ones in order not to break tools which\nuse hard-coded column positions.\n\nin brackets after each field name are the types which may have a value for\nthat field. the types are l (listeners), f (frontends), b (backends), and\ns (servers).\n\n  0\\. pxname [lfbs]: proxy name\n  1\\. svname [lfbs]: service name (frontend for frontend, backend for backend,\n     any name for server/listener)\n  2\\. qcur [..bs]: current queued requests. for the backend this reports the\n     number queued without a server assigned.\n  3\\. qmax [..bs]: max value of qcur\n  4\\. scur [lfbs]: current sessions\n  5\\. smax [lfbs]: max sessions\n  6\\. slim [lfbs]: configured session limit\n  7\\. stot [lfbs]: cumulative number of connections\n  8\\. bin [lfbs]: bytes in\n  9\\. bout [lfbs]: bytes out\n 10\\. dreq [lfb.]: requests denied because of security concerns.\n     - for tcp this is because of a matched tcp-request content rule.\n     - for http this is because of a matched http-request or tarpit rule.\n 11\\. dresp [lfbs]: responses denied because of security concerns.\n     - for http this is because of a matched http-request rule, or\n       \"option checkcache\".\n 12\\. ereq [lf..]: request errors. some of the possible causes are:\n     - early termination from the client, before the request has been sent.\n     - read error from the client\n     - client timeout\n     - client closed connection\n     - various bad requests from the client.\n     - request was tarpitted.\n 13\\. econ [..bs]: number of requests that encountered an error trying to\n     connect to a backend server. the backend stat is the sum of the stat\n     for all servers of that backend, plus any connection errors not\n     associated with a particular server (such as the backend having no\n     active servers).\n 14\\. eresp [..bs]: response errors. srv_abrt will be counted here also.\n     some other errors are:\n     - write error on the client socket (won't be counted for the server stat)\n     - failure applying filters to the response.\n 15\\. wretr [..bs]: number of times a connection to a server was retried.\n 16\\. wredis [..bs]: number of times a request was redispatched to another\n     server. the server value counts the number of times that server was\n     switched away from.\n 17\\. status [lfbs]: status (up/down/nolb/maint/maint(via)...)\n 18\\. weight [..bs]: total weight (backend), server weight (server)\n 19\\. act [..bs]: number of active servers (backend), server is active (server)\n 20\\. bck [..bs]: number of backup servers (backend), server is backup (server)\n 21\\. chkfail [...s]: number of failed checks. (only counts checks failed when\n     the server is up.)\n 22\\. chkdown [..bs]: number of up->down transitions. the backend counter counts\n     transitions to the whole backend being down, rather than the sum of the\n     counters for each server.\n 23\\. lastchg [..bs]: number of seconds since the last up<->down transition\n 24\\. downtime [..bs]: total downtime (in seconds). the value for the backend\n     is the downtime for the whole backend, not the sum of the server downtime.\n 25\\. qlimit [...s]: configured maxqueue for the server, or nothing in the\n     value is 0 (default, meaning no limit)\n 26\\. pid [lfbs]: process id (0 for first instance, 1 for second, ...)\n 27\\. iid [lfbs]: unique proxy id\n 28\\. sid [l..s]: server id (unique inside a proxy)\n 29\\. throttle [...s]: current throttle percentage for the server, when\n     slowstart is active, or no value if not in slowstart.\n 30\\. lbtot [..bs]: total number of times a server was selected, either for new\n     sessions, or when re-dispatching. the server counter is the number\n     of times that server was selected.\n 31\\. tracked [...s]: id of proxy/server if tracking is enabled.\n 32\\. type [lfbs]: (0=frontend, 1=backend, 2=server, 3=socket/listener)\n 33\\. rate [.fbs]: number of sessions per second over last elapsed second\n 34\\. rate_lim [.f..]: configured limit on new sessions per second\n 35\\. rate_max [.fbs]: max number of new sessions per second\n 36\\. check_status [...s]: status of last health check, one of:\n        unk     -> unknown\n        ini     -> initializing\n        sockerr -> socket error\n        l4ok    -> check passed on layer 4, no upper layers testing enabled\n        l4tout  -> layer 1-4 timeout\n        l4con   -> layer 1-4 connection problem, for example\n                   \"connection refused\" (tcp rst) or \"no route to host\" (icmp)\n        l6ok    -> check passed on layer 6\n        l6tout  -> layer 6 (ssl) timeout\n        l6rsp   -> layer 6 invalid response - protocol error\n        l7ok    -> check passed on layer 7\n        l7okc   -> check conditionally passed on layer 7, for example 404 with\n                   disable-on-404\n        l7tout  -> layer 7 (http/smtp) timeout\n        l7rsp   -> layer 7 invalid response - protocol error\n        l7sts   -> layer 7 response error, for example http 5xx\n 37\\. check_code [...s]: layer5-7 code, if available\n 38\\. check_duration [...s]: time in ms took to finish last health check\n 39\\. hrsp_1xx [.fbs]: http responses with 1xx code\n 40\\. hrsp_2xx [.fbs]: http responses with 2xx code\n 41\\. hrsp_3xx [.fbs]: http responses with 3xx code\n 42\\. hrsp_4xx [.fbs]: http responses with 4xx code\n 43\\. hrsp_5xx [.fbs]: http responses with 5xx code\n 44\\. hrsp_other [.fbs]: http responses with other codes (protocol error)\n 45\\. hanafail [...s]: failed health checks details\n 46\\. req_rate [.f..]: http requests per second over last elapsed second\n 47\\. req_rate_max [.f..]: max number of http requests per second observed\n 48\\. req_tot [.f..]: total number of http requests received\n 49\\. cli_abrt [..bs]: number of data transfers aborted by the client\n 50\\. srv_abrt [..bs]: number of data transfers aborted by the server\n     (inc. in eresp)\n 51\\. comp_in [.fb.]: number of http response bytes fed to the compressor\n 52\\. comp_out [.fb.]: number of http response bytes emitted by the compressor\n 53\\. comp_byp [.fb.]: number of bytes that bypassed the http compressor\n     (cpu/bw limit)\n 54\\. comp_rsp [.fb.]: number of http responses that were compressed\n 55\\. lastsess [..bs]: number of seconds since last session assigned to\n     server/backend\n 56\\. last_chk [...s]: last health check contents or textual error\n 57\\. last_agt [...s]: last agent check contents or textual error\n 58\\. qtime [..bs]: the average queue time in ms over the 1024 last requests\n 59\\. ctime [..bs]: the average connect time in ms over the 1024 last requests\n 60\\. rtime [..bs]: the average response time in ms over the 1024 last requests\n     (0 for tcp)\n 61\\. ttime [..bs]: the average total session time in ms over the 1024 last\n     requests\n\n9.2\\. unix socket commands\n-------------------------\n\nthe stats socket is not enabled by default. in order to enable it, it is\nnecessary to add one line in the global section of the haproxy configuration.\na second line is recommended to set a larger timeout, always appreciated when\nissuing commands by hand :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats timeout 2m\n\nit is also possible to add multiple instances of the stats socket by repeating\nthe line, and make them listen to a tcp port instead of a unix socket. this is\nnever done by default because this is dangerous, but can be handy in some\nsituations :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats socket ipv4@192.168.0.1:9999 level admin\n        stats timeout 2m\n\nto access the socket, an external utility such as \"socat\" is required. socat is a\nswiss-army knife to connect anything to anything. we use it to connect terminals\nto the socket, or a couple of stdin/stdout pipes to it for scripts. the two main\nsyntaxes we'll use are the following :\n\n    # socat /var/run/haproxy.sock stdio\n    # socat /var/run/haproxy.sock readline\n\nthe first one is used with scripts. it is possible to send the output of a\nscript to haproxy, and pass haproxy's output to another script. that's useful\nfor retrieving counters or attack traces for example.\n\nthe second one is only useful for issuing commands by hand. it has the benefit\nthat the terminal is handled by the readline library which supports line\nediting and history, which is very convenient when issuing repeated commands\n(eg: watch a counter).\n\nthe socket supports two operation modes :\n  - interactive\n  - non-interactive\n\nthe non-interactive mode is the default when socat connects to the socket. in\nthis mode, a single line may be sent. it is processed as a whole, responses are\nsent back, and the connection closes after the end of the response. this is the\nmode that scripts and monitoring tools use. it is possible to send multiple\ncommands in this mode, they need to be delimited by a semi-colon (';'). for\nexample :\n\n    # echo \"show info;show stat;show table\" | socat /var/run/haproxy stdio\n\nthe interactive mode displays a prompt ('>') and waits for commands to be\nentered on the line, then processes them, and displays the prompt again to wait\nfor a new command. this mode is entered via the \"prompt\" command which must be\nsent on the first line in non-interactive mode. the mode is a flip switch, if\n\"prompt\" is sent in interactive mode, it is disabled and the connection closes\nafter processing the last command of the same line.\n\nfor this reason, when debugging by hand, it's quite common to start with the\n\"prompt\" command :\n\n   # socat /var/run/haproxy readline\n   prompt\n   > show info\n   ...\n   >\n\nsince multiple commands may be issued at once, haproxy uses the empty line as a\ndelimiter to mark an end of output for each command, and takes care of ensuring\nthat no command can emit an empty line on output. a script can thus easily\nparse the output even when multiple commands were pipelined on a single line.\n\nit is important to understand that when multiple haproxy processes are started\non the same sockets, any process may pick up the request and will output its\nown stats.\n\nthe list of commands currently supported on the stats socket is provided below.\nif an unknown command is sent, haproxy displays the usage message which reminds\nall supported commands. some commands support a more complex syntax, generally\nit will explain what part of the command is invalid when this happens.\n\nadd acl <acl> <pattern>\n  add an entry into the acl <acl>. <acl> is the #<id> or the <file> returned by\n  \"show acl\". this command does not verify if the entry already exists. this\n  command cannot be used if the reference <acl> is a file also used with a map.\n  in this case, you must use the command \"add map\" in place of \"add acl\".\n\nadd map <map> <key> <value>\n  add an entry into the map <map> to associate the value <value> to the key\n  <key>. this command does not verify if the entry already exists. it is\n  mainly used to fill a map after a clear operation. note that if the reference\n  <map> is a file and is shared with a map, this map will contain also a new\n  pattern entry.\n\nclear counters\n  clear the max values of the statistics counters in each proxy (frontend &\n  backend) and in each server. the cumulated counters are not affected. this\n  can be used to get clean counters after an incident, without having to\n  restart nor to clear traffic counters. this command is restricted and can\n  only be issued on sockets configured for levels \"operator\" or \"admin\".\n\nclear counters all\n  clear all statistics counters in each proxy (frontend & backend) and in each\n  server. this has the same effect as restarting. this command is restricted\n  and can only be issued on sockets configured for level \"admin\".\n\nclear acl <acl>\n  remove all entries from the acl <acl>. <acl> is the #<id> or the <file>\n  returned by \"show acl\". note that if the reference <acl> is a file and is\n  shared with a map, this map will be also cleared.\n\nclear map <map>\n  remove all entries from the map <map>. <map> is the #<id> or the <file>\n  returned by \"show map\". note that if the reference <map> is a file and is\n  shared with a acl, this acl will be also cleared.\n\nclear table <table> [ data.<type> <operator> <value> ] | [ key <key> ]\n  remove entries from the stick-table <table>.\n\n  this is typically used to unblock some users complaining they have been\n  abusively denied access to a service, but this can also be used to clear some\n  stickiness entries matching a server that is going to be replaced (see \"show\n  table\" below for details).  note that sometimes, removal of an entry will be\n  refused because it is currently tracked by a session. retrying a few seconds\n  later after the session ends is usual enough.\n\n  in the case where no options arguments are given all entries will be removed.\n\n  when the \"data.\" form is used entries matching a filter applied using the\n  stored data (see \"stick-table\" in section 4.2) are removed.  a stored data\n  type must be specified in <type>, and this data type must be stored in the\n  table otherwise an error is reported. the data is compared according to\n  <operator> with the 64-bit integer <value>.  operators are the same as with\n  the acls :\n\n    - eq : match entries whose data is equal to this value\n    - ne : match entries whose data is not equal to this value\n    - le : match entries whose data is less than or equal to this value\n    - ge : match entries whose data is greater than or equal to this value\n    - lt : match entries whose data is less than this value\n    - gt : match entries whose data is greater than this value\n\n  when the key form is used the entry <key> is removed.  the key must be of the\n  same type as the table, which currently is limited to ipv4, ipv6, integer and\n  string.\n\n  example :\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \\\n          bytes_out_rate(60000)=187\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"clear table http_proxy key 127.0.0.1\" | socat stdio /tmp/sock1\n\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:1\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n        $ echo \"clear table http_proxy data.gpc0 eq 1\" | socat stdio /tmp/sock1\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:1\n\ndel acl <acl> [<key>|#<ref>]\n  delete all the acl entries from the acl <acl> corresponding to the key <key>.\n  <acl> is the #<id> or the <file> returned by \"show acl\". if the <ref> is used,\n  this command delete only the listed reference. the reference can be found with\n  listing the content of the acl. note that if the reference <acl> is a file and\n  is shared with a map, the entry will be also deleted in the map.\n\ndel map <map> [<key>|#<ref>]\n  delete all the map entries from the map <map> corresponding to the key <key>.\n  <map> is the #<id> or the <file> returned by \"show map\". if the <ref> is used,\n  this command delete only the listed reference. the reference can be found with\n  listing the content of the map. note that if the reference <map> is a file and\n  is shared with a acl, the entry will be also deleted in the map.\n\ndisable agent <backend>/<server>\n  mark the auxiliary agent check as temporarily stopped.\n\n  in the case where an agent check is being run as a auxiliary check, due\n  to the agent-check parameter of a server directive, new checks are only\n  initialised when the agent is in the enabled. thus, disable agent will\n  prevent any new agent checks from begin initiated until the agent\n  re-enabled using enable agent.\n\n  when an agent is disabled the processing of an auxiliary agent check that\n  was initiated while the agent was set as enabled is as follows: all\n  results that would alter the weight, specifically \"drain\" or a weight\n  returned by the agent, are ignored. the processing of agent check is\n  otherwise unchanged.\n\n  the motivation for this feature is to allow the weight changing effects\n  of the agent checks to be paused to allow the weight of a server to be\n  configured using set weight without being overridden by the agent.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable frontend <frontend>\n  mark the frontend as temporarily stopped. this corresponds to the mode which\n  is used during a soft restart : the frontend releases the port but can be\n  enabled again if needed. this should be used with care as some non-linux oses\n  are unable to enable it back. this is intended to be used in environments\n  where stopping a proxy is not even imaginable but a misconfigured proxy must\n  be fixed. that way it's possible to release the port and bind it into another\n  process to restore operations. the frontend will appear with status \"stop\"\n  on the stats page.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable health <backend>/<server>\n  mark the primary health check as temporarily stopped. this will disable\n  sending of health checks, and the last health check result will be ignored.\n  the server will be in unchecked state and considered up unless an auxiliary\n  agent check forces it down.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\ndisable server <backend>/<server>\n  mark the server down for maintenance. in this mode, no more checks will be\n  performed on the server until it leaves maintenance.\n  if the server is tracked by other servers, those servers will be set to down\n  during the maintenance.\n\n  in the statistics page, a server down for maintenance will appear with a\n  \"maint\" status, its tracking servers with the \"maint(via)\" one.\n\n  both the backend and the server may be specified either by their name or by\n  their numeric id, prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable agent <backend>/<server>\n  resume auxiliary agent check that was temporarily stopped.\n\n  see \"disable agent\" for details of the effect of temporarily starting\n  and stopping an auxiliary agent.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable frontend <frontend>\n  resume a frontend which was temporarily stopped. it is possible that some of\n  the listening ports won't be able to bind anymore (eg: if another process\n  took them since the 'disable frontend' operation). if this happens, an error\n  is displayed. some operating systems might not be able to resume a frontend\n  which was disabled.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable health <backend>/<server>\n  resume a primary health check that was temporarily stopped. this will enable\n  sending of health checks again. please see \"disable health\" for details.\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nenable server <backend>/<server>\n  if the server was previously marked as down for maintenance, this marks the\n  server up and checks are re-enabled.\n\n  both the backend and the server may be specified either by their name or by\n  their numeric id, prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nget map <map> <value>\nget acl <acl> <value>\n  lookup the value <value> in the map <map> or in the acl <acl>. <map> or <acl>\n  are the #<id> or the <file> returned by \"show map\" or \"show acl\". this command\n  returns all the matching patterns associated with this map. this is useful for\n  debugging maps and acls. the output format is composed by one line par\n  matching type. each line is composed by space-delimited series of words.\n\n  the first two words are:\n\n     <match method>:   the match method applied. it can be \"found\", \"bool\",\n                       \"int\", \"ip\", \"bin\", \"len\", \"str\", \"beg\", \"sub\", \"dir\",\n                       \"dom\", \"end\" or \"reg\".\n\n     <match result>:   the result. can be \"match\" or \"no-match\".\n\n  the following words are returned only if the pattern matches an entry.\n\n     <index type>:     \"tree\" or \"list\". the internal lookup algorithm.\n\n     <case>:           \"case-insensitive\" or \"case-sensitive\". the\n                       interpretation of the case.\n\n     <entry matched>:  match=\"<entry>\". return the matched pattern. it is\n                       useful with regular expressions.\n\n  the two last word are used to show the returned value and its type. with the\n  \"acl\" case, the pattern doesn't exist.\n\n     return=nothing:        no return because there are no \"map\".\n     return=\"<value>\":      the value returned in the string format.\n     return=cannot-display: the value cannot be converted as string.\n\n     type=\"<type>\":         the type of the returned sample.\n\nget weight <backend>/<server>\n  report the current weight and the initial weight of server <server> in\n  backend <backend> or an error if either doesn't exist. the initial weight is\n  the one that appears in the configuration file. both are normally equal\n  unless the current weight has been changed. both the backend and the server\n  may be specified either by their name or by their numeric id, prefixed with a\n  sharp ('#').\n\nhelp\n  print the list of known keywords and their basic usage. the same help screen\n  is also displayed for unknown commands.\n\nprompt\n  toggle the prompt at the beginning of the line and enter or leave interactive\n  mode. in interactive mode, the connection is not closed after a command\n  completes. instead, the prompt will appear again, indicating the user that\n  the interpreter is waiting for a new command. the prompt consists in a right\n  angle bracket followed by a space \"> \". this mode is particularly convenient\n  when one wants to periodically check information such as stats or errors.\n  it is also a good idea to enter interactive mode before issuing a \"help\"\n  command.\n\nquit\n  close the connection when in interactive mode.\n\nset map <map> [<key>|#<ref>] <value>\n  modify the value corresponding to each key <key> in a map <map>. <map> is the\n  #<id> or <file> returned by \"show map\". if the <ref> is used in place of\n  <key>, only the entry pointed by <ref> is changed. the new value is <value>.\n\nset maxconn frontend <frontend> <value>\n  dynamically change the specified frontend's maxconn setting. any positive\n  value is allowed including zero, but setting values larger than the global\n  maxconn does not make much sense. if the limit is increased and connections\n  were pending, they will immediately be accepted. if it is lowered to a value\n  below the current number of connections, new connections acceptation will be\n  delayed until the threshold is reached. the frontend might be specified by\n  either its name or its numeric id prefixed with a sharp ('#').\n\nset maxconn global <maxconn>\n  dynamically change the global maxconn setting within the range defined by the\n  initial global maxconn setting. if it is increased and connections were\n  pending, they will immediately be accepted. if it is lowered to a value below\n  the current number of connections, new connections acceptation will be\n  delayed until the threshold is reached. a value of zero restores the initial\n  setting.\n\nset rate-limit connections global <value>\n  change the process-wide connection rate limit, which is set by the global\n  'maxconnrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of connections per second.\n\nset rate-limit http-compression global <value>\n  change the maximum input compression rate, which is set by the global\n  'maxcomprate' setting. a value of zero disables the limitation. the value is\n  passed in number of kilobytes per second. the value is available in the \"show\n  info\" on the line \"compressbpsratelim\" in bytes.\n\nset rate-limit sessions global <value>\n  change the process-wide session rate limit, which is set by the global\n  'maxsessrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of sessions per second.\n\nset rate-limit ssl-sessions global <value>\n  change the process-wide ssl session rate limit, which is set by the global\n  'maxsslrate' setting. a value of zero disables the limitation. this limit\n  applies to all frontends and the change has an immediate effect. the value\n  is passed in number of sessions per second sent to the ssl stack. it applies\n  before the handshake in order to protect the stack against handshake abuses.\n\nset server <backend>/<server> addr <ip4 or ip6 address>\n  replace the current ip address of a server by the one provided.\n\nset server <backend>/<server> agent [ up | down ]\n  force a server's agent to a new state. this can be useful to immediately\n  switch a server's state regardless of some slow agent checks for example.\n  note that the change is propagated to tracking servers if any.\n\nset server <backend>/<server> health [ up | stopping | down ]\n  force a server's health to a new state. this can be useful to immediately\n  switch a server's state regardless of some slow health checks for example.\n  note that the change is propagated to tracking servers if any.\n\nset server <backend>/<server> state [ ready | drain | maint ]\n  force a server's administrative state to a new state. this can be useful to\n  disable load balancing and/or any traffic to a server. setting the state to\n  \"ready\" puts the server in normal mode, and the command is the equivalent of\n  the \"enable server\" command. setting the state to \"maint\" disables any traffic\n  to the server as well as any health checks. this is the equivalent of the\n  \"disable server\" command. setting the mode to \"drain\" only removes the server\n  from load balancing but still allows it to be checked and to accept new\n  persistent connections. changes are propagated to tracking servers if any.\n\nset server <backend>/<server> weight <weight>[%]\n  change a server's weight to the value passed in argument. this is the exact\n  equivalent of the \"set weight\" command below.\n\nset ssl ocsp-response <response>\n  this command is used to update an ocsp response for a certificate (see \"crt\"\n  on \"bind\" lines). same controls are performed as during the initial loading of\n  the response. the <response> must be passed as a base64 encoded string of the\n  der encoded response from the ocsp server.\n\n  example:\n    openssl ocsp -issuer issuer.pem -cert server.pem \\\n                 -host ocsp.issuer.com:80 -respout resp.der\n    echo \"set ssl ocsp-response $(base64 -w 10000 resp.der)\" | \\\n                 socat stdio /var/run/haproxy.stat\n\nset ssl tls-key <id> <tlskey>\n  set the next tls key for the <id> listener to <tlskey>. this key becomes the\n  ultimate key, while the penultimate one is used for encryption (others just\n  decrypt). the oldest tls key present is overwritten. <id> is either a numeric\n  #<id> or <file> returned by \"show tls-keys\". <tlskey> is a base64 encoded 48\n  bit tls ticket key (ex. openssl rand -base64 48).\n\nset table <table> key <key> [data.<data_type> <value>]*\n  create or update a stick-table entry in the table. if the key is not present,\n  an entry is inserted. see stick-table in section 4.2 to find all possible\n  values for <data_type>. the most likely use consists in dynamically entering\n  entries for source ip addresses, with a flag in gpc0 to dynamically block an\n  ip address or affect its quality of service. it is possible to pass multiple\n  data_types in a single call.\n\nset timeout cli <delay>\n  change the cli interface timeout for current connection. this can be useful\n  during long debugging sessions where the user needs to constantly inspect\n  some indicators without being disconnected. the delay is passed in seconds.\n\nset weight <backend>/<server> <weight>[%]\n  change a server's weight to the value passed in argument. if the value ends\n  with the '%' sign, then the new weight will be relative to the initially\n  configured weight.  absolute weights are permitted between 0 and 256.\n  relative weights must be positive with the resulting absolute weight is\n  capped at 256\\.  servers which are part of a farm running a static\n  load-balancing algorithm have stricter limitations because the weight\n  cannot change once set. thus for these servers, the only accepted values\n  are 0 and 100% (or 0 and the initial weight). changes take effect\n  immediately, though certain lb algorithms require a certain amount of\n  requests to consider changes. a typical usage of this command is to\n  disable a server during an update by setting its weight to zero, then to\n  enable it again after the update by setting it back to 100%. this command\n  is restricted and can only be issued on sockets configured for level\n  \"admin\". both the backend and the server may be specified either by their\n  name or by their numeric id, prefixed with a sharp ('#').\n\nshow errors [<iid>]\n  dump last known request and response errors collected by frontends and\n  backends. if <iid> is specified, the limit the dump to errors concerning\n  either frontend or backend whose id is <iid>. this command is restricted\n  and can only be issued on sockets configured for levels \"operator\" or\n  \"admin\".\n\n  the errors which may be collected are the last request and response errors\n  caused by protocol violations, often due to invalid characters in header\n  names. the report precisely indicates what exact character violated the\n  protocol. other important information such as the exact date the error was\n  detected, frontend and backend names, the server name (when known), the\n  internal session id and the source address which has initiated the session\n  are reported too.\n\n  all characters are returned, and non-printable characters are encoded. the\n  most common ones (\\t = 9, \\n = 10, \\r = 13 and \\e = 27) are encoded as one\n  letter following a backslash. the backslash itself is encoded as '\\\\' to\n  avoid confusion. other non-printable characters are encoded '\\xnn' where\n  nn is the two-digits hexadecimal representation of the character's ascii\n  code.\n\n  lines are prefixed with the position of their first character, starting at 0\n  for the beginning of the buffer. at most one input line is printed per line,\n  and large lines will be broken into multiple consecutive output lines so that\n  the output never goes beyond 79 characters wide. it is easy to detect if a\n  line was broken, because it will not end with '\\n' and the next line's offset\n  will be followed by a '+' sign, indicating it is a continuation of previous\n  line.\n\n  example :\n        $ echo \"show errors\" | socat stdio /tmp/sock1\n    >>> [04/mar/2009:15:46:56.081] backend http-in (#2) : invalid response\n          src 127.0.0.1, session #54, frontend fe-eth0 (#1), server s2 (#1)\n          response length 213 bytes, error at position 23:\n\n          00000  http/1.0 200 ok\\r\\n\n          00017  header/bizarre:blah\\r\\n\n          00038  location: blah\\r\\n\n          00054  long-line: this is a very long line which should b\n          00104+ e broken into multiple lines on the output buffer,\n          00154+  otherwise it would be too large to print in a ter\n          00204+ minal\\r\\n\n          00211  \\r\\n\n\n    in the example above, we see that the backend \"http-in\" which has internal\n    id 2 has blocked an invalid response from its server s2 which has internal\n    id 1\\. the request was on session 54 initiated by source 127.0.0.1 and\n    received by frontend fe-eth0 whose id is 1\\. the total response length was\n    213 bytes when the error was detected, and the error was at byte 23\\. this\n    is the slash ('/') in header name \"header/bizarre\", which is not a valid\n    http character for a header name.\n\nshow info\n  dump info about haproxy status on current process.\n\nshow map [<map>]\n  dump info about map converters. without argument, the list of all available\n  maps is returned. if a <map> is specified, its contents are dumped. <map> is\n  the #<id> or <file>. the first column is a unique identifier. it can be used\n  as reference for the operation \"del map\" and \"set map\". the second column is\n  the pattern and the third column is the sample if available. the data returned\n  are not directly a list of available maps, but are the list of all patterns\n  composing any map. many of these patterns can be shared with acl.\n\nshow acl [<acl>]\n  dump info about acl converters. without argument, the list of all available\n  acls is returned. if a <acl> is specified, its contents are dumped. <acl> if\n  the #<id> or <file>. the dump format is the same than the map even for the\n  sample value. the data returned are not a list of available acl, but are the\n  list of all patterns composing any acl. many of these patterns can be shared\n  with maps.\n\nshow pools\n  dump the status of internal memory pools. this is useful to track memory\n  usage when suspecting a memory leak for example. it does exactly the same\n  as the sigquit when running in foreground except that it does not flush\n  the pools.\n\nshow sess\n  dump all known sessions. avoid doing this on slow connections as this can\n  be huge. this command is restricted and can only be issued on sockets\n  configured for levels \"operator\" or \"admin\".\n\nshow sess <id>\n  display a lot of internal information about the specified session identifier.\n  this identifier is the first field at the beginning of the lines in the dumps\n  of \"show sess\" (it corresponds to the session pointer). those information are\n  useless to most users but may be used by haproxy developers to troubleshoot a\n  complex bug. the output format is intentionally not documented so that it can\n  freely evolve depending on demands. you may find a description of all fields\n  returned in src/dumpstats.c\n\n  the special id \"all\" dumps the states of all sessions, which must be avoided\n  as much as possible as it is highly cpu intensive and can take a lot of time.\n\nshow stat [<iid> <type> <sid>]\n  dump statistics in the csv format. by passing <id>, <type> and <sid>, it is\n  possible to dump only selected items :\n    - <iid> is a proxy id, -1 to dump everything\n    - <type> selects the type of dumpable objects : 1 for frontends, 2 for\n       backends, 4 for servers, -1 for everything. these values can be ored,\n       for example:\n          1 + 2     = 3   -> frontend + backend.\n          1 + 2 + 4 = 7   -> frontend + backend + server.\n    - <sid> is a server id, -1 to dump everything from the selected proxy.\n\n  example :\n        $ echo \"show info;show stat\" | socat stdio unix-connect:/tmp/sock1\n    >>> name: haproxy\n        version: 1.4-dev2-49\n        release_date: 2009/09/23\n        nbproc: 1\n        process_num: 1\n        (...)\n\n        # pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)\n        stats,frontend,,,0,0,1000,0,0,0,0,0,0,,,,,open,,,,,,,,,1,1,0, (...)\n        stats,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,0,0,0,,0,250,(...)\n        (...)\n        www1,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,1,1,0,,0,250, (...)\n\n        $\n\n    here, two commands have been issued at once. that way it's easy to find\n    which process the stats apply to in multi-process mode. notice the empty\n    line after the information output which marks the end of the first block.\n    a similar empty line appears at the end of the second block (stats) so that\n    the reader knows the output has not been truncated.\n\nshow stat resolvers <resolvers section id>\n  dump statistics for the given resolvers section.\n  for each name server, the following counters are reported:\n    sent: number of dns requests sent to this server\n    valid: number of dns valid responses received from this server\n    update: number of dns responses used to update the server's ip address\n    cname: number of cname responses\n    cname_error: cname errors encountered with this server\n    any_err: number of empty response (ie: server does not support any type)\n    nx: non existent domain response received from this server\n    timeout: how many time this server did not answer in time\n    refused: number of requests refused by this server\n    other: any other dns errors\n    invalid: invalid dns response (from a protocol point of view)\n    too_big: too big response\n    outdated: number of response arrived too late (after an other name server)\nshow table\n  dump general information on all known stick-tables. their name is returned\n  (the name of the proxy which holds them), their type (currently zero, always\n  ip), their size in maximum possible number of entries, and the number of\n  entries currently in use.\n\n  example :\n        $ echo \"show table\" | socat stdio /tmp/sock1\n    >>> # table: front_pub, type: ip, size:204800, used:171454\n    >>> # table: back_rdp, type: ip, size:204800, used:0\n\nshow table <name> [ data.<type> <operator> <value> ] | [ key <key> ]\n  dump contents of stick-table <name>. in this mode, a first line of generic\n  information about the table is reported as with \"show table\", then all\n  entries are dumped. since this can be quite heavy, it is possible to specify\n  a filter in order to specify what entries to display.\n\n  when the \"data.\" form is used the filter applies to the stored data (see\n  \"stick-table\" in section 4.2).  a stored data type must be specified\n  in <type>, and this data type must be stored in the table otherwise an\n  error is reported. the data is compared according to <operator> with the\n  64-bit integer <value>.  operators are the same as with the acls :\n\n    - eq : match entries whose data is equal to this value\n    - ne : match entries whose data is not equal to this value\n    - le : match entries whose data is less than or equal to this value\n    - ge : match entries whose data is greater than or equal to this value\n    - lt : match entries whose data is less than this value\n    - gt : match entries whose data is greater than this value\n\n  when the key form is used the entry <key> is shown.  the key must be of the\n  same type as the table, which currently is limited to ipv4, ipv6, integer,\n  and string.\n\n  example :\n        $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \\\n          bytes_out_rate(60000)=187\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy data.gpc0 gt 0\" | socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy data.conn_rate gt 5\" | \\\n            socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n        $ echo \"show table http_proxy key 127.0.0.2\" | \\\n            socat stdio /tmp/sock1\n    >>> # table: http_proxy, type: ip, size:204800, used:2\n    >>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n          bytes_out_rate(60000)=191\n\n  when the data criterion applies to a dynamic value dependent on time such as\n  a bytes rate, the value is dynamically computed during the evaluation of the\n  entry in order to decide whether it has to be dumped or not. this means that\n  such a filter could match for some time then not match anymore because as\n  time goes, the average event rate drops.\n\n  it is possible to use this to extract lists of ip addresses abusing the\n  service, in order to monitor them or even blacklist them in a firewall.\n  example :\n        $ echo \"show table http_proxy data.gpc0 gt 0\" \\\n          | socat stdio /tmp/sock1 \\\n          | fgrep 'key=' | cut -d' ' -f2 | cut -d= -f2 > abusers-ip.txt\n          ( or | awk '/key/{ print a[split($2,a,\"=\")]; }' )\n\nshow tls-keys\n  dump all loaded tls ticket keys. the tls ticket key reference id and the\n  file from which the keys have been loaded is shown. both of those can be\n  used to update the tls keys using \"set ssl tls-key\".\n\nshutdown frontend <frontend>\n  completely delete the specified frontend. all the ports it was bound to will\n  be released. it will not be possible to enable the frontend anymore after\n  this operation. this is intended to be used in environments where stopping a\n  proxy is not even imaginable but a misconfigured proxy must be fixed. that\n  way it's possible to release the port and bind it into another process to\n  restore operations. the frontend will not appear at all on the stats page\n  once it is terminated.\n\n  the frontend may be specified either by its name or by its numeric id,\n  prefixed with a sharp ('#').\n\n  this command is restricted and can only be issued on sockets configured for\n  level \"admin\".\n\nshutdown session <id>\n  immediately terminate the session matching the specified session identifier.\n  this identifier is the first field at the beginning of the lines in the dumps\n  of \"show sess\" (it corresponds to the session pointer). this can be used to\n  terminate a long-running session without waiting for a timeout or when an\n  endless transfer is ongoing. such terminated sessions are reported with a 'k'\n  flag in the logs.\n\nshutdown sessions server <backend>/<server>\n  immediately terminate all the sessions attached to the specified server. this\n  can be used to terminate long-running sessions after a server is put into\n  maintenance mode, for instance. such terminated sessions are reported with a\n  'k' flag in the logs.\n\n/*\n * local variables:\n *  fill-column: 79\n * end:\n */","slug":"Haproxy-Configuration","published":1,"updated":"2016-09-15T07:13:28.137Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cit5kly4l00137sqv7p2tuphu","content":"<hr>\n<pre><code>       haproxy\n configuration manual\n----------------------\n     version 1.6\n    willy tarreau\n     2015/07/22\n</code></pre><p>this document covers the configuration language as implemented in the version<br>specified above. it does not provide any hint, example or advice. for such<br>documentation, please refer to the reference manual or the architecture manual.<br>the summary below is meant to help you search sections by name and navigate<br>through the document.</p>\n<p>note to documentation contributors :<br>    this document is formatted with 80 columns per line, with even number of<br>    spaces for indentation and without tabs. please follow these rules strictly<br>    so that it remains easily printable everywhere. if a line needs to be<br>    printed verbatim and does not fit, please end each line with a backslash<br>    (‘\\’) and continue on next line, indented by two characters. it is also<br>    sometimes useful to prefix all output lines (logs, console outs) with 3<br>    closing angle brackets (‘&gt;&gt;&gt;’) in order to help get the difference between<br>    inputs and outputs when it can become ambiguous. if you add sections,<br>    please update the summary below for easier searching.</p>\n<h2 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h2><p>1.    quick reminder about http<br>1.1.      the http transaction model<br>1.2.      http request<br>1.2.1.        the request line<br>1.2.2.        the request headers<br>1.3.      http response<br>1.3.1.        the response line<br>1.3.2.        the response headers</p>\n<p>2.    configuring haproxy<br>2.1.      configuration file format<br>2.2.      quoting and escaping<br>2.3.      environment variables<br>2.4.      time format<br>2.5.      examples</p>\n<p>3.    global parameters<br>3.1.      process management and security<br>3.2.      performance tuning<br>3.3.      debugging<br>3.4.      userlists<br>3.5.      peers</p>\n<p>4.    proxies<br>4.1.      proxy keywords matrix<br>4.2.      alphabetically sorted keywords reference</p>\n<p>5.    bind and server options<br>5.1.      bind options<br>5.2.      server and default-server options<br>5.3.      server dns resolution<br>5.3.1.      global overview<br>5.3.2.      the resolvers section</p>\n<p>6.    http header manipulation</p>\n<p>7.    using acls and fetching samples<br>7.1.      acl basics<br>7.1.1.      matching booleans<br>7.1.2.      matching integers<br>7.1.3.      matching strings<br>7.1.4.      matching regular expressions (regexes)<br>7.1.5.      matching arbitrary data blocks<br>7.1.6.      matching ipv4 and ipv6 addresses<br>7.2.      using acls to form conditions<br>7.3.      fetching samples<br>7.3.1.        converters<br>7.3.2.        fetching samples from internal states<br>7.3.3.        fetching samples at layer 4<br>7.3.4.        fetching samples at layer 5<br>7.3.5.        fetching samples from buffer contents (layer 6)<br>7.3.6.        fetching http samples (layer 7)<br>7.4.      pre-defined acls</p>\n<p>8.    logging<br>8.1.      log levels<br>8.2.      log formats<br>8.2.1.        default log format<br>8.2.2.        tcp log format<br>8.2.3.        http log format<br>8.2.4.        custom log format<br>8.2.5.        error log format<br>8.3.      advanced logging options<br>8.3.1.        disabling logging of external tests<br>8.3.2.        logging before waiting for the session to terminate<br>8.3.3.        raising log level upon errors<br>8.3.4.        disabling logging of successful connections<br>8.4.      timing events<br>8.5.      session state at disconnection<br>8.6.      non-printable characters<br>8.7.      capturing http cookies<br>8.8.      capturing http headers<br>8.9.      examples of logs</p>\n<p>9.    statistics and monitoring<br>9.1.      csv format<br>9.2.      unix socket commands</p>\n<h2 id=\"1-quick-reminder-about-http\"><a href=\"#1-quick-reminder-about-http\" class=\"headerlink\" title=\"1. quick reminder about http\"></a>1. quick reminder about http</h2><p>when haproxy is running in http mode, both the request and the response are<br>fully analyzed and indexed, thus it becomes possible to build matching criteria<br>on almost anything found in the contents.</p>\n<p>however, it is important to understand how http requests and responses are<br>formed, and how haproxy decomposes them. it will then become easier to write<br>correct rules and to debug existing configurations.</p>\n<h2 id=\"1-1-the-http-transaction-model\"><a href=\"#1-1-the-http-transaction-model\" class=\"headerlink\" title=\"1.1. the http transaction model\"></a>1.1. the http transaction model</h2><p>the http protocol is transaction-driven. this means that each request will lead<br>to one and only one response. traditionally, a tcp connection is established<br>from the client to the server, a request is sent by the client on the<br>connection, the server responds and the connection is closed. a new request<br>will involve a new connection :</p>\n<p>  [con1] [req1] … [resp1] [clo1] [con2] [req2] … [resp2] [clo2] …</p>\n<p>in this mode, called the “http close” mode, there are as many connection<br>establishments as there are http transactions. since the connection is closed<br>by the server after the response, the client does not need to know the content<br>length.</p>\n<p>due to the transactional nature of the protocol, it was possible to improve it<br>to avoid closing a connection between two subsequent transactions. in this mode<br>however, it is mandatory that the server indicates the content length for each<br>response so that the client does not wait indefinitely. for this, a special<br>header is used: “content-length”. this mode is called the “keep-alive” mode :</p>\n<p>  [con] [req1] … [resp1] [req2] … [resp2] [clo] …</p>\n<p>its advantages are a reduced latency between transactions, and less processing<br>power required on the server side. it is generally better than the close mode,<br>but not always because the clients often limit their concurrent connections to<br>a smaller value.</p>\n<p>a last improvement in the communications is the pipelining mode. it still uses<br>keep-alive, but the client does not wait for the first response to send the<br>second request. this is useful for fetching large number of images composing a<br>page :</p>\n<p>  [con] [req1] [req2] … [resp1] [resp2] [clo] …</p>\n<p>this can obviously have a tremendous benefit on performance because the network<br>latency is eliminated between subsequent requests. many http agents do not<br>correctly support pipelining since there is no way to associate a response with<br>the corresponding request in http. for this reason, it is mandatory for the<br>server to reply in the exact same order as the requests were received.</p>\n<p>by default haproxy operates in keep-alive mode with regards to persistent<br>connections: for each connection it processes each request and response, and<br>leaves the connection idle on both sides between the end of a response and the<br>start of a new request.</p>\n<p>haproxy supports 5 connection modes :</p>\n<ul>\n<li>keep alive    : all requests and responses are processed (default)</li>\n<li>tunnel        : only the first request and response are processed,<pre><code>everything else is forwarded with no analysis.\n</code></pre></li>\n<li>passive close : tunnel with “connection: close” added in both directions.</li>\n<li>server close  : the server-facing connection is closed after the response.</li>\n<li>forced close  : the connection is actively closed after end of response.</li>\n</ul>\n<h2 id=\"1-2-http-request\"><a href=\"#1-2-http-request\" class=\"headerlink\" title=\"1.2. http request\"></a>1.2. http request</h2><p>first, let’s consider this http request :</p>\n<p>  line     contents<br>  number<br>     1     get /serv/login.php?lang=en&amp;profile=2 http/1.1<br>     2     host: www.mydomain.com<br>     3     user-agent: my small browser<br>     4     accept: image/jpeg, image/gif<br>     5     accept: image/png</p>\n<h2 id=\"1-2-1-the-request-line\"><a href=\"#1-2-1-the-request-line\" class=\"headerlink\" title=\"1.2.1. the request line\"></a>1.2.1. the request line</h2><p>line 1 is the “request line”. it is always composed of 3 fields :</p>\n<ul>\n<li>a method      : get</li>\n<li>a uri         : /serv/login.php?lang=en&amp;profile=2</li>\n<li>a version tag : http/1.1</li>\n</ul>\n<p>all of them are delimited by what the standard calls lws (linear white spaces),<br>which are commonly spaces, but can also be tabs or line feeds/carriage returns<br>followed by spaces/tabs. the method itself cannot contain any colon (‘:’) and<br>is limited to alphabetic letters. all those various combinations make it<br>desirable that haproxy performs the splitting itself rather than leaving it to<br>the user to write a complex or inaccurate regular expression.</p>\n<p>the uri itself can have several forms :</p>\n<ul>\n<li><p>a “relative uri” :</p>\n<p>  /serv/login.php?lang=en&amp;profile=2</p>\n<p>it is a complete url without the host part. this is generally what is<br>received by servers, reverse proxies and transparent proxies.</p>\n</li>\n<li><p>an “absolute uri”, also called a “url” :</p>\n<p>  <a href=\"http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2\" target=\"_blank\" rel=\"external\">http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2</a></p>\n<p>it is composed of a “scheme” (the protocol name followed by ‘://‘), a host<br>name or address, optionally a colon (‘:’) followed by a port number, then<br>a relative uri beginning at the first slash (‘/‘) after the address part.<br>this is generally what proxies receive, but a server supporting http/1.1<br>must accept this form too.</p>\n</li>\n<li><p>a star (‘*’) : this form is only accepted in association with the options<br>method and is not relayable. it is used to inquiry a next hop’s<br>capabilities.</p>\n</li>\n<li><p>an address:port combination : 192.168.0.12:80<br>this is used with the connect method, which is used to establish tcp<br>tunnels through http proxies, generally for https, but sometimes for<br>other protocols too.</p>\n</li>\n</ul>\n<p>in a relative uri, two sub-parts are identified. the part before the question<br>mark is called the “path”. it is typically the relative path to static objects<br>on the server. the part after the question mark is called the “query string”.<br>it is mostly used with get requests sent to dynamic scripts and is very<br>specific to the language, framework or application in use.</p>\n<h2 id=\"1-2-2-the-request-headers\"><a href=\"#1-2-2-the-request-headers\" class=\"headerlink\" title=\"1.2.2. the request headers\"></a>1.2.2. the request headers</h2><p>the headers start at the second line. they are composed of a name at the<br>beginning of the line, immediately followed by a colon (‘:’). traditionally,<br>an lws is added after the colon but that’s not required. then come the values.<br>multiple identical headers may be folded into one single line, delimiting the<br>values with commas, provided that their order is respected. this is commonly<br>encountered in the “cookie:” field. a header may span over multiple lines if<br>the subsequent lines begin with an lws. in the example in 1.2, lines 4 and 5<br>define a total of 3 values for the “accept:” header.</p>\n<p>contrary to a common mis-conception, header names are not case-sensitive, and<br>their values are not either if they refer to other header names (such as the<br>“connection:” header).</p>\n<p>the end of the headers is indicated by the first empty line. people often say<br>that it’s a double line feed, which is not exact, even if a double line feed<br>is one valid form of empty line.</p>\n<p>fortunately, haproxy takes care of all these complex combinations when indexing<br>headers, checking values and counting them, so there is no reason to worry<br>about the way they could be written, but it is important not to accuse an<br>application of being buggy if it does unusual, valid things.</p>\n<p>important note:<br>   as suggested by rfc2616, haproxy normalizes headers by replacing line breaks<br>   in the middle of headers by lws in order to join multi-line headers. this<br>   is necessary for proper analysis and helps less capable http parsers to work<br>   correctly and not to be fooled by such complex constructs.</p>\n<h2 id=\"1-3-http-response\"><a href=\"#1-3-http-response\" class=\"headerlink\" title=\"1.3. http response\"></a>1.3. http response</h2><p>an http response looks very much like an http request. both are called http<br>messages. let’s consider this http response :</p>\n<p>  line     contents<br>  number<br>     1     http/1.1 200 ok<br>     2     content-length: 350<br>     3     content-type: text/html</p>\n<p>as a special case, http supports so called “informational responses” as status<br>codes 1xx. these messages are special in that they don’t convey any part of the<br>response, they’re just used as sort of a signaling message to ask a client to<br>continue to post its request for instance. in the case of a status 100 response<br>the requested information will be carried by the next non-100 response message<br>following the informational one. this implies that multiple responses may be<br>sent to a single request, and that this only works when keep-alive is enabled<br>(1xx messages are http/1.1 only). haproxy handles these messages and is able to<br>correctly forward and skip them, and only process the next non-100 response. as<br>such, these messages are neither logged nor transformed, unless explicitly<br>state otherwise. status 101 messages indicate that the protocol is changing<br>over the same connection and that haproxy must switch to tunnel mode, just as<br>if a connect had occurred. then the upgrade header would contain additional<br>information about the type of protocol the connection is switching to.</p>\n<h2 id=\"1-3-1-the-response-line\"><a href=\"#1-3-1-the-response-line\" class=\"headerlink\" title=\"1.3.1. the response line\"></a>1.3.1. the response line</h2><p>line 1 is the “response line”. it is always composed of 3 fields :</p>\n<ul>\n<li>a version tag : http/1.1</li>\n<li>a status code : 200</li>\n<li>a reason      : ok</li>\n</ul>\n<p>the status code is always 3-digit. the first digit indicates a general status :</p>\n<ul>\n<li>1xx = informational message to be skipped (eg: 100, 101)</li>\n<li>2xx = ok, content is following   (eg: 200, 206)</li>\n<li>3xx = ok, no content following   (eg: 302, 304)</li>\n<li>4xx = error caused by the client (eg: 401, 403, 404)</li>\n<li>5xx = error caused by the server (eg: 500, 502, 503)</li>\n</ul>\n<p>please refer to rfc2616 for the detailed meaning of all such codes. the<br>“reason” field is just a hint, but is not parsed by clients. anything can be<br>found there, but it’s a common practice to respect the well-established<br>messages. it can be composed of one or multiple words, such as “ok”, “found”,<br>or “authentication required”.</p>\n<p>haproxy may emit the following status codes by itself :</p>\n<p>  code  when / reason<br>   200  access to stats page, and when replying to monitoring requests<br>   301  when performing a redirection, depending on the configured code<br>   302  when performing a redirection, depending on the configured code<br>   303  when performing a redirection, depending on the configured code<br>   307  when performing a redirection, depending on the configured code<br>   308  when performing a redirection, depending on the configured code<br>   400  for an invalid or too large request<br>   401  when an authentication is required to perform the action (when<br>        accessing the stats page)<br>   403  when a request is forbidden by a “block” acl or “reqdeny” filter<br>   408  when the request timeout strikes before the request is complete<br>   500  when haproxy encounters an unrecoverable internal error, such as a<br>        memory allocation failure, which should never happen<br>   502  when the server returns an empty, invalid or incomplete response, or<br>        when an “rspdeny” filter blocks the response.<br>   503  when no server was available to handle the request, or in response to<br>        monitoring requests which match the “monitor fail” condition<br>   504  when the response timeout strikes before the server responds</p>\n<p>the error 4xx and 5xx codes above may be customized (see “errorloc” in section<br>4.2).</p>\n<h2 id=\"1-3-2-the-response-headers\"><a href=\"#1-3-2-the-response-headers\" class=\"headerlink\" title=\"1.3.2. the response headers\"></a>1.3.2. the response headers</h2><p>response headers work exactly like request headers, and as such, haproxy uses<br>the same parsing function for both. please refer to paragraph 1.2.2 for more<br>details.</p>\n<h2 id=\"2-configuring-haproxy\"><a href=\"#2-configuring-haproxy\" class=\"headerlink\" title=\"2. configuring haproxy\"></a>2. configuring haproxy</h2><h2 id=\"2-1-configuration-file-format\"><a href=\"#2-1-configuration-file-format\" class=\"headerlink\" title=\"2.1. configuration file format\"></a>2.1. configuration file format</h2><p>haproxy’s configuration process involves 3 major sources of parameters :</p>\n<ul>\n<li>the arguments from the command-line, which always take precedence</li>\n<li>the “global” section, which sets process-wide parameters</li>\n<li>the proxies sections which can take form of “defaults”, “listen”,<br>“frontend” and “backend”.</li>\n</ul>\n<p>the configuration file syntax consists in lines beginning with a keyword<br>referenced in this manual, optionally followed by one or several parameters<br>delimited by spaces.</p>\n<h2 id=\"2-2-quoting-and-escaping\"><a href=\"#2-2-quoting-and-escaping\" class=\"headerlink\" title=\"2.2. quoting and escaping\"></a>2.2. quoting and escaping</h2><p>haproxy’s configuration introduces a quoting and escaping system similar to<br>many programming languages. the configuration file supports 3 types: escaping<br>with a backslash, weak quoting with double quotes, and strong quoting with<br>single quotes.</p>\n<p>if spaces have to be entered in strings, then they must be escaped by preceding<br>them by a backslash (‘\\’) or by quoting them. backslashes also have to be<br>escaped by doubling or strong quoting them.</p>\n<p>escaping is achieved by preceding a special character by a backslash (‘\\’):</p>\n<p>  \\    to mark a space and differentiate it from a delimiter<br>  #   to mark a hash and differentiate it from a comment<br>  \\   to use a backslash<br>  \\’   to use a single quote and differentiate it from strong quoting<br>  \\”   to use a double quote and differentiate it from weak quoting</p>\n<p>weak quoting is achieved by using double quotes (“”). weak quoting prevents<br>the interpretation of:</p>\n<pre><code>space as a parameter separator\n</code></pre><p>  ‘    single quote as a strong quoting delimiter</p>\n<h1 id=\"hash-as-a-comment-start\"><a href=\"#hash-as-a-comment-start\" class=\"headerlink\" title=\"hash as a comment start\"></a>hash as a comment start</h1><p>weak quoting permits the interpretation of variables, if you want to use a non<br>-interpreted dollar within a double quoted string, you should escape it with a<br>backslash (“\\$”), it does not work outside weak quoting.</p>\n<p>interpretation of escaping and special characters are not prevented by weak<br>quoting.</p>\n<p>strong quoting is achieved by using single quotes (‘’). inside single quotes,<br>nothing is interpreted, it’s the efficient way to quote regexes.</p>\n<p>quoted and escaped strings are replaced in memory by their interpreted<br>equivalent, it allows you to perform concatenation.</p>\n<p>  example:</p>\n<pre><code># those are equivalents:\nlog-format %{+q}o\\ %t\\ %s\\ %{-q}r\nlog-format &quot;%{+q}o %t %s %{-q}r&quot;\nlog-format &apos;%{+q}o %t %s %{-q}r&apos;\nlog-format &quot;%{+q}o %t&quot;&apos; %s %{-q}r&apos;\nlog-format &quot;%{+q}o %t&quot;&apos; %s&apos;\\ %{-q}r\n\n# those are equivalents:\nreqrep &quot;^([^\\ :]*)\\ /static/(.*)&quot;     \\1\\ /\\2\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &apos;\\1 /\\2&apos;\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &quot;\\1 /\\2&quot;\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &quot;\\1\\ /\\2&quot;\n</code></pre><h2 id=\"2-3-environment-variables\"><a href=\"#2-3-environment-variables\" class=\"headerlink\" title=\"2.3. environment variables\"></a>2.3. environment variables</h2><p>haproxy’s configuration supports environment variables. those variables are<br>interpreted only within double quotes. variables are expanded during the<br>configuration parsing. variable names must be preceded by a dollar (“$”) and<br>optionally enclosed with braces (“{}”) similarly to what is done in bourne<br>shell. variable names can contain alphanumerical characters or the character<br>underscore (“_”) but should not start with a digit.</p>\n<p>  example:</p>\n<pre><code>bind &quot;fd@${fd_app1}&quot;\n\nlog &quot;${local_syslog}:514&quot; local0 notice   # send to local server\n\nuser &quot;$haproxy_user&quot;\n</code></pre><h2 id=\"2-4-time-format\"><a href=\"#2-4-time-format\" class=\"headerlink\" title=\"2.4. time format\"></a>2.4. time format</h2><p>some parameters involve values representing time, such as timeouts. these<br>values are generally expressed in milliseconds (unless explicitly stated<br>otherwise) but may be expressed in any other unit by suffixing the unit to the<br>numeric value. it is important to consider this because it will not be repeated<br>for every keyword. supported units are :</p>\n<ul>\n<li>us : microseconds. 1 microsecond = 1/1000000 second</li>\n<li>ms : milliseconds. 1 millisecond = 1/1000 second. this is the default.</li>\n<li>s  : seconds. 1s = 1000ms</li>\n<li>m  : minutes. 1m = 60s = 60000ms</li>\n<li>h  : hours.   1h = 60m = 3600s = 3600000ms</li>\n<li>d  : days.    1d = 24h = 1440m = 86400s = 86400000ms</li>\n</ul>\n<h2 id=\"2-4-examples\"><a href=\"#2-4-examples\" class=\"headerlink\" title=\"2.4. examples\"></a>2.4. examples</h2><pre><code># simple configuration for an http proxy listening on port 80 on all\n# interfaces and forwarding requests to a single backend &quot;servers&quot; with a\n# single server &quot;server1&quot; listening on 127.0.0.1:8000\nglobal\n    daemon\n    maxconn 256\n\ndefaults\n    mode http\n    timeout connect 5000ms\n    timeout client 50000ms\n    timeout server 50000ms\n\nfrontend http-in\n    bind *:80\n    default_backend servers\n\nbackend servers\n    server server1 127.0.0.1:8000 maxconn 32\n\n# the same configuration defined with a single listen block. shorter but\n# less expressive, especially in http mode.\nglobal\n    daemon\n    maxconn 256\n\ndefaults\n    mode http\n    timeout connect 5000ms\n    timeout client 50000ms\n    timeout server 50000ms\n\nlisten http-in\n    bind *:80\n    server server1 127.0.0.1:8000 maxconn 32\n</code></pre><p>assuming haproxy is in $path, test these configurations in a shell with:</p>\n<pre><code>$ sudo haproxy -f configuration.conf -c\n</code></pre><h2 id=\"3-global-parameters\"><a href=\"#3-global-parameters\" class=\"headerlink\" title=\"3. global parameters\"></a>3. global parameters</h2><p>parameters in the “global” section are process-wide and often os-specific. they<br>are generally set once for all and do not need being changed once correct. some<br>of them have command-line equivalents.</p>\n<p>the following keywords are supported in the “global” section :</p>\n<ul>\n<li><p>process management and security</p>\n<ul>\n<li>ca-base</li>\n<li>chroot</li>\n<li>crt-base</li>\n<li>daemon</li>\n<li>external-check</li>\n<li>gid</li>\n<li>group</li>\n<li>log</li>\n<li>log-send-hostname</li>\n<li>nbproc</li>\n<li>pidfile</li>\n<li>uid</li>\n<li>ulimit-n</li>\n<li>user</li>\n<li>stats</li>\n<li>ssl-server-verify</li>\n<li>node</li>\n<li>description</li>\n<li>unix-bind</li>\n<li>51degrees-data-file</li>\n<li>51degrees-property-name-list</li>\n<li>51degrees-property-separator</li>\n<li>51degrees-cache-size</li>\n</ul>\n</li>\n<li><p>performance tuning</p>\n<ul>\n<li>max-spread-checks</li>\n<li>maxconn</li>\n<li>maxconnrate</li>\n<li>maxcomprate</li>\n<li>maxcompcpuusage</li>\n<li>maxpipes</li>\n<li>maxsessrate</li>\n<li>maxsslconn</li>\n<li>maxsslrate</li>\n<li>noepoll</li>\n<li>nokqueue</li>\n<li>nopoll</li>\n<li>nosplice</li>\n<li>nogetaddrinfo</li>\n<li>spread-checks</li>\n<li>tune.bufsize</li>\n<li>tune.chksize</li>\n<li>tune.comp.maxlevel</li>\n<li>tune.http.cookielen</li>\n<li>tune.http.maxhdr</li>\n<li>tune.idletimer</li>\n<li>tune.lua.forced-yield</li>\n<li>tune.lua.maxmem</li>\n<li>tune.lua.session-timeout</li>\n<li>tune.lua.task-timeout</li>\n<li>tune.maxaccept</li>\n<li>tune.maxpollevents</li>\n<li>tune.maxrewrite</li>\n<li>tune.pattern.cache-size</li>\n<li>tune.pipesize</li>\n<li>tune.rcvbuf.client</li>\n<li>tune.rcvbuf.server</li>\n<li>tune.sndbuf.client</li>\n<li>tune.sndbuf.server</li>\n<li>tune.ssl.cachesize</li>\n<li>tune.ssl.lifetime</li>\n<li>tune.ssl.force-private-cache</li>\n<li>tune.ssl.maxrecord</li>\n<li>tune.ssl.default-dh-param</li>\n<li>tune.ssl.ssl-ctx-cache-size</li>\n<li>tune.vars.global-max-size</li>\n<li>tune.vars.reqres-max-size</li>\n<li>tune.vars.sess-max-size</li>\n<li>tune.vars.txn-max-size</li>\n<li>tune.zlib.memlevel</li>\n<li>tune.zlib.windowsize</li>\n</ul>\n</li>\n<li><p>debugging</p>\n<ul>\n<li>debug</li>\n<li>quiet</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-1-process-management-and-security\"><a href=\"#3-1-process-management-and-security\" class=\"headerlink\" title=\"3.1. process management and security\"></a>3.1. process management and security</h2><p>ca-base <dir><br>  assigns a default directory to fetch ssl ca certificates and crls from when a<br>  relative path is used with “ca-file” or “crl-file” directives. absolute<br>  locations specified in “ca-file” and “crl-file” prevail and ignore “ca-base”.</dir></p>\n<p>chroot <jail dir=\"\"><br>  changes current directory to <jail dir=\"\"> and performs a chroot() there before<br>  dropping privileges. this increases the security level in case an unknown<br>  vulnerability would be exploited, since it would make it very hard for the<br>  attacker to exploit the system. this only works when the process is started<br>  with superuser privileges. it is important to ensure that <jail_dir> is both<br>  empty and unwritable to anyone.</jail_dir></jail></jail></p>\n<p>cpu-map &lt;”all”|”odd”|”even”|process_num&gt; <cpu-set>…<br>  on linux 2.6 and above, it is possible to bind a process to a specific cpu<br>  set. this means that the process will never run on other cpus. the “cpu-map”<br>  directive specifies cpu sets for process sets. the first argument is the<br>  process number to bind. this process must have a number between 1 and 32 or<br>  64, depending on the machine’s word size, and any process ids above nbproc<br>  are ignored. it is possible to specify all processes at once using “all”,<br>  only odd numbers using “odd” or even numbers using “even”, just like with the<br>  “bind-process” directive. the second and forthcoming arguments are cpu sets.<br>  each cpu set is either a unique number between 0 and 31 or 63 or a range with<br>  two such numbers delimited by a dash (‘-‘). multiple cpu numbers or ranges<br>  may be specified, and the processes will be allowed to bind to all of them.<br>  obviously, multiple “cpu-map” directives may be specified. each “cpu-map”<br>  directive will replace the previous ones when they overlap.</cpu-set></p>\n<p>crt-base <dir><br>  assigns a default directory to fetch ssl certificates from when a relative<br>  path is used with “crtfile” directives. absolute locations specified after<br>  “crtfile” prevail and ignore “crt-base”.</dir></p>\n<p>daemon<br>  makes the process fork into background. this is the recommended mode of<br>  operation. it is equivalent to the command line “-d” argument. it can be<br>  disabled by the command line “-db” argument.</p>\n<p>deviceatlas-json-file <path></path><br>  sets the path of the deviceatlas json data file to be loaded by the api.<br>  the path must be a valid json data file and accessible by haproxy process.</p>\n<p>deviceatlas-log-level <value><br>  sets the level of informations returned by the api. this directive is<br>  optional and set to 0 by default if not set.</value></p>\n<p>deviceatlas-separator <char><br>  sets the character separator for the api properties results. this directive<br>  is optional and set to | by default if not set.</char></p>\n<p>external-check<br>  allows the use of an external agent to perform health checks.<br>  this is disabled by default as a security precaution.<br>  see “option external-check”.</p>\n<p>gid <number><br>  changes the process’ group id to <number>. it is recommended that the group<br>  id is dedicated to haproxy or to a small set of similar daemons. haproxy must<br>  be started with a user belonging to this group, or with superuser privileges.<br>  note that if haproxy is started from a user having supplementary groups, it<br>  will only be able to drop these groups if started with superuser privileges.<br>  see also “group” and “uid”.</number></number></p>\n<p>group <group name=\"\"><br>  similar to “gid” but uses the gid of group name <group name=\"\"> from /etc/group.<br>  see also “gid” and “user”.</group></group></p>\n<p>log <address> [len <length>] <facility> [max level [min level]]<br>  adds a global syslog server. up to two global servers can be defined. they<br>  will receive logs for startups and exits, as well as all logs from proxies<br>  configured with “log global”.</facility></length></address></p>\n<p>  <address> can be one of:</address></p>\n<pre><code>- an ipv4 address optionally followed by a colon and a udp port. if\n  no port is specified, 514 is used by default (the standard syslog\n  port).\n\n- an ipv6 address followed by a colon and optionally a udp port. if\n  no port is specified, 514 is used by default (the standard syslog\n  port).\n\n- a filesystem path to a unix domain socket, keeping in mind\n  considerations for chroot (be sure the path is accessible inside\n  the chroot) and uid/gid (be sure the path is appropriately\n  writeable).\n\nyou may want to reference some environment variables in the address\nparameter, see section 2.3 about environment variables.\n</code></pre><p>  <length> is an optional maximum line length. log lines larger than this value<br>           will be truncated before being sent. the reason is that syslog<br>           servers act differently on log line length. all servers support the<br>           default value of 1024, but some servers simply drop larger lines<br>           while others do log them. if a server supports long lines, it may<br>           make sense to set this value here in order to avoid truncating long<br>           lines. similarly, if a server drops long lines, it is preferable to<br>           truncate them before sending them. accepted values are 80 to 65535<br>           inclusive. the default value of 1024 is generally fine for all<br>           standard usages. some specific cases of long captures or<br>           json-formated logs may require larger values.</length></p>\n<p>  <facility> must be one of the 24 standard syslog facilities :</facility></p>\n<pre><code>kern   user   mail   daemon auth   syslog lpr    news\nuucp   cron   auth2  ftp    ntp    audit  alert  cron2\nlocal0 local1 local2 local3 local4 local5 local6 local7\n</code></pre><p>  an optional level can be specified to filter outgoing messages. by default,<br>  all messages are sent. if a maximum level is specified, only messages with a<br>  severity at least as important as this level will be sent. an optional minimum<br>  level can be specified. if it is set, logs emitted with a more severe level<br>  than this one will be capped to this level. this is used to avoid sending<br>  “emerg” messages on all terminals on some default syslog configurations.<br>  eight levels are known :</p>\n<pre><code>emerg  alert  crit   err    warning notice info  debug\n</code></pre><p>log-send-hostname [<string>]<br>  sets the hostname field in the syslog header. if optional “string” parameter<br>  is set the header is set to the string contents, otherwise uses the hostname<br>  of the system. generally used if one is not relaying logs through an<br>  intermediate syslog server or for simply customizing the hostname printed in<br>  the logs.</string></p>\n<p>log-tag <string><br>  sets the tag field in the syslog header to this string. it defaults to the<br>  program name as launched from the command line, which usually is “haproxy”.<br>  sometimes it can be useful to differentiate between multiple processes<br>  running on the same host. see also the per-proxy “log-tag” directive.</string></p>\n<p>lua-load <file><br>  this global directive loads and executes a lua file. this directive can be<br>  used multiple times.</file></p>\n<p>nbproc <number><br>  creates <number> processes when going daemon. this requires the “daemon”<br>  mode. by default, only one process is created, which is the recommended mode<br>  of operation. for systems limited to small sets of file descriptors per<br>  process, it may be needed to fork multiple daemons. using multiple processes<br>  is harder to debug and is really discouraged. see also “daemon”.</number></number></p>\n<p>pidfile <pidfile><br>  writes pids of all daemons into file <pidfile>. this option is equivalent to<br>  the “-p” command line argument. the file must be accessible to the user<br>  starting the process. see also “daemon”.</pidfile></pidfile></p>\n<p>stats bind-process [ all | odd | even | <number 1-64=\"\">[-<number 1-64=\"\">] ] …<br>  limits the stats socket to a certain set of processes numbers. by default the<br>  stats socket is bound to all processes, causing a warning to be emitted when<br>  nbproc is greater than 1 because there is no way to select the target process<br>  when connecting. however, by using this setting, it becomes possible to pin<br>  the stats socket to a specific set of processes, typically the first one. the<br>  warning will automatically be disabled when this setting is used, whatever<br>  the number of processes used. the maximum process id depends on the machine’s<br>  word size (32 or 64). a better option consists in using the “process” setting<br>  of the “stats socket” line to force the process on each line.</number></number></p>\n<p>ssl-default-bind-ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it sets<br>  the default string describing the list of cipher algorithms (“cipher suite”)<br>  that are negotiated during the ssl/tls handshake for all “bind” lines which<br>  do not explicitly define theirs. the format of the string is defined in<br>  “man 1 ciphers” from openssl man pages, and can be for instance a string such<br>  as “aes:all:!anull:!enull:+rc4:@strength” (without quotes). please check the<br>  “bind” keyword for more information.</ciphers></p>\n<p>ssl-default-bind-options [<option>]…<br>  this setting is only available when support for openssl was built in. it sets<br>  default ssl-options to force on all “bind” lines. please check the “bind”<br>  keyword to see available options.</option></p>\n<p>  example:<br>        global<br>           ssl-default-bind-options no-sslv3 no-tls-tickets</p>\n<p>ssl-default-server-ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it<br>  sets the default string describing the list of cipher algorithms that are<br>  negotiated during the ssl/tls handshake with the server, for all “server”<br>  lines which do not explicitly define theirs. the format of the string is<br>  defined in “man 1 ciphers”. please check the “server” keyword for more<br>  information.</ciphers></p>\n<p>ssl-default-server-options [<option>]…<br>  this setting is only available when support for openssl was built in. it sets<br>  default ssl-options to force on all “server” lines. please check the “server”<br>  keyword to see available options.</option></p>\n<p>ssl-dh-param-file <file><br>  this setting is only available when support for openssl was built in. it sets<br>  the default dh parameters that are used during the ssl/tls handshake when<br>  ephemeral diffie-hellman (dhe) key exchange is used, for all “bind” lines<br>  which do not explicitely define theirs. it will be overridden by custom dh<br>  parameters found in a bind certificate file if any. if custom dh parameters<br>  are not specified either by using ssl-dh-param-file or by setting them directly<br>  in the certificate file, pre-generated dh parameters of the size specified<br>  by tune.ssl.default-dh-param will be used. custom parameters are known to be<br>  more secure and therefore their use is recommended.<br>  custom dh parameters may be generated by using the openssl command<br>  “openssl dhparam <size>“, where size should be at least 2048, as 1024-bit dh<br>  parameters should not be considered secure anymore.</size></file></p>\n<p>ssl-server-verify [none|required]<br>  the default behavior for ssl verify on servers side. if specified to ‘none’,<br>  servers certificates are not verified. the default is ‘required’ except if<br>  forced using cmdline option ‘-dv’.</p>\n<p>stats socket [<address:port>|<path></path>] [param*]<br>  binds a unix socket to <path></path> or a tcpv4/v6 address to <address:port>.<br>  connections to this socket will return various statistics outputs and even<br>  allow some commands to be issued to change some runtime settings. please<br>  consult section 9.2 “unix socket commands” for more details.</address:port></address:port></p>\n<p>  all parameters supported by “bind” lines are supported, for instance to<br>  restrict access to some users or their access rights. please consult<br>  section 5.1 for more information.</p>\n<p>stats timeout <timeout, in=\"\" milliseconds=\"\"><br>  the default timeout on the stats socket is set to 10 seconds. it is possible<br>  to change this value with “stats timeout”. the value must be passed in<br>  milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.</timeout,></p>\n<p>stats maxconn <connections><br>  by default, the stats socket is limited to 10 concurrent connections. it is<br>  possible to change this value with “stats maxconn”.</connections></p>\n<p>uid <number><br>  changes the process’ user id to <number>. it is recommended that the user id<br>  is dedicated to haproxy or to a small set of similar daemons. haproxy must<br>  be started with superuser privileges in order to be able to switch to another<br>  one. see also “gid” and “user”.</number></number></p>\n<p>ulimit-n <number><br>  sets the maximum number of per-process file-descriptors to <number>. by<br>  default, it is automatically computed, so it is recommended not to use this<br>  option.</number></number></p>\n<p>unix-bind [ prefix <prefix> ] [ mode <mode> ] [ user <user> ] [ uid <uid> ]<br>          [ group <group> ] [ gid <gid> ]</gid></group></uid></user></mode></prefix></p>\n<p>  fixes common settings to unix listening sockets declared in “bind” statements.<br>  this is mainly used to simplify declaration of those unix sockets and reduce<br>  the risk of errors, since those settings are most commonly required but are<br>  also process-specific. the <prefix> setting can be used to force all socket<br>  path to be relative to that directory. this might be needed to access another<br>  component’s chroot. note that those paths are resolved before haproxy chroots<br>  itself, so they are absolute. the <mode>, <user>, <uid>, <group> and <gid><br>  all have the same meaning as their homonyms used by the “bind” statement. if<br>  both are specified, the “bind” statement has priority, meaning that the<br>  “unix-bind” settings may be seen as process-wide default settings.</gid></group></uid></user></mode></prefix></p>\n<p>user <user name=\"\"><br>  similar to “uid” but uses the uid of user name <user name=\"\"> from /etc/passwd.<br>  see also “uid” and “group”.</user></user></p>\n<p>node <name><br>  only letters, digits, hyphen and underscore are allowed, like in dns names.</name></p>\n<p>  this statement is useful in ha configurations where two or more processes or<br>  servers share the same ip address. by setting a different node-name on all<br>  nodes, it becomes easy to immediately spot what server is handling the<br>  traffic.</p>\n<p>description <text><br>  add a text that describes the instance.</text></p>\n<p>  please note that it is required to escape certain characters (# for example)<br>  and this text is inserted into a html page so you should avoid using<br>  “&lt;” and “&gt;” characters.</p>\n<p>51degrees-data-file <file path=\"\"><br>  the path of the 51degrees data file to provide device detection services. the<br>  file should be unzipped and accessible by haproxy with relevavnt permissions.</file></p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-property-name-list [<string>]<br>  a list of 51degrees property names to be load from the dataset. a full list<br>  of names is available on the 51degrees website:<br>  <a href=\"https://51degrees.com/resources/property-dictionary\" target=\"_blank\" rel=\"external\">https://51degrees.com/resources/property-dictionary</a></string></p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-property-separator <char><br>  a char that will be appended to every property value in a response header<br>  containing 51degrees results. if not set that will be set as ‘,’.</char></p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-cache-size <number><br>  sets the size of the 51degrees converter cache to <number> entries. this<br>  is an lru cache which reminds previous device detections and their results.<br>  by default, this cache is disabled.</number></number></p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<h2 id=\"3-2-performance-tuning\"><a href=\"#3-2-performance-tuning\" class=\"headerlink\" title=\"3.2. performance tuning\"></a>3.2. performance tuning</h2><p>max-spread-checks <delay in=\"\" milliseconds=\"\"><br>  by default, haproxy tries to spread the start of health checks across the<br>  smallest health check interval of all the servers in a farm. the principle is<br>  to avoid hammering services running on the same server. but when using large<br>  check intervals (10 seconds or more), the last servers in the farm take some<br>  time before starting to be tested, which can be a problem. this parameter is<br>  used to enforce an upper bound on delay between the first and the last check,<br>  even if the servers’ check intervals are larger. when servers run with<br>  shorter intervals, their intervals will be respected though.</delay></p>\n<p>maxconn <number><br>  sets the maximum per-process number of concurrent connections to <number>. it<br>  is equivalent to the command-line argument “-n”. proxies will stop accepting<br>  connections when this limit is reached. the “ulimit-n” parameter is<br>  automatically adjusted according to this value. see also “ulimit-n”. note:<br>  the “select” poller cannot reliably use more than 1024 file descriptors on<br>  some platforms. if your platform only supports select and reports “select<br>  failed” on startup, you need to reduce maxconn until it works (slightly<br>  below 500 in general). if this value is not set, it will default to the value<br>  set in default_maxconn at build time (reported in haproxy -vv) if no memory<br>  limit is enforced, or will be computed based on the memory limit, the buffer<br>  size, memory allocated to compression, ssl cache size, and use or not of ssl<br>  and the associated maxsslconn (which can also be automatic).</number></number></p>\n<p>maxconnrate <number><br>  sets the maximum per-process number of connections per second to <number>.<br>  proxies will stop accepting connections when this limit is reached. it can be<br>  used to limit the global capacity regardless of each frontend capacity. it is<br>  important to note that this can only be used as a service protection measure,<br>  as there will not necessarily be a fair share between frontends when the<br>  limit is reached, so it’s a good idea to also limit each frontend to some<br>  value close to its expected share. also, lowering tune.maxaccept can improve<br>  fairness.</number></number></p>\n<p>maxcomprate <number><br>  sets the maximum per-process input compression rate to <number> kilobytes<br>  per second.  for each session, if the maximum is reached, the compression<br>  level will be decreased during the session. if the maximum is reached at the<br>  beginning of a session, the session will not compress at all. if the maximum<br>  is not reached, the compression level will be increased up to<br>  tune.comp.maxlevel.  a value of zero means there is no limit, this is the<br>  default value.</number></number></p>\n<p>maxcompcpuusage <number><br>  sets the maximum cpu usage haproxy can reach before stopping the compression<br>  for new requests or decreasing the compression level of current requests.<br>  it works like ‘maxcomprate’ but measures cpu usage instead of incoming data<br>  bandwidth. the value is expressed in percent of the cpu used by haproxy. in<br>  case of multiple processes (nbproc &gt; 1), each process manages its individual<br>  usage. a value of 100 disable the limit. the default value is 100. setting<br>  a lower value will prevent the compression work from slowing the whole<br>  process down and from introducing high latencies.</number></p>\n<p>maxpipes <number><br>  sets the maximum per-process number of pipes to <number>. currently, pipes<br>  are only used by kernel-based tcp splicing. since a pipe contains two file<br>  descriptors, the “ulimit-n” value will be increased accordingly. the default<br>  value is maxconn/4, which seems to be more than enough for most heavy usages.<br>  the splice code dynamically allocates and releases pipes, and can fall back<br>  to standard copy, so setting this value too low may only impact performance.</number></number></p>\n<p>maxsessrate <number><br>  sets the maximum per-process number of sessions per second to <number>.<br>  proxies will stop accepting connections when this limit is reached. it can be<br>  used to limit the global capacity regardless of each frontend capacity. it is<br>  important to note that this can only be used as a service protection measure,<br>  as there will not necessarily be a fair share between frontends when the<br>  limit is reached, so it’s a good idea to also limit each frontend to some<br>  value close to its expected share. also, lowering tune.maxaccept can improve<br>  fairness.</number></number></p>\n<p>maxsslconn <number><br>  sets the maximum per-process number of concurrent ssl connections to<br>  <number>. by default there is no ssl-specific limit, which means that the<br>  global maxconn setting will apply to all connections. setting this limit<br>  avoids having openssl use too much memory and crash when malloc returns null<br>  (since it unfortunately does not reliably check for such conditions). note<br>  that the limit applies both to incoming and outgoing connections, so one<br>  connection which is deciphered then ciphered accounts for 2 ssl connections.<br>  if this value is not set, but a memory limit is enforced, this value will be<br>  automatically computed based on the memory limit, maxconn,  the buffer size,<br>  memory allocated to compression, ssl cache size, and use of ssl in either<br>  frontends, backends or both. if neither maxconn nor maxsslconn are specified<br>  when there is a memory limit, haproxy will automatically adjust these values<br>  so that 100% of the connections can be made over ssl with no risk, and will<br>  consider the sides where it is enabled (frontend, backend, both).</number></number></p>\n<p>maxsslrate <number><br>  sets the maximum per-process number of ssl sessions per second to <number>.<br>  ssl listeners will stop accepting connections when this limit is reached. it<br>  can be used to limit the global ssl cpu usage regardless of each frontend<br>  capacity. it is important to note that this can only be used as a service<br>  protection measure, as there will not necessarily be a fair share between<br>  frontends when the limit is reached, so it’s a good idea to also limit each<br>  frontend to some value close to its expected share. it is also important to<br>  note that the sessions are accounted before they enter the ssl stack and not<br>  after, which also protects the stack against bad handshakes. also, lowering<br>  tune.maxaccept can improve fairness.</number></number></p>\n<p>maxzlibmem <number><br>  sets the maximum amount of ram in megabytes per process usable by the zlib.<br>  when the maximum amount is reached, future sessions will not compress as long<br>  as ram is unavailable. when sets to 0, there is no limit.<br>  the default value is 0. the value is available in bytes on the unix socket<br>  with “show info” on the line “maxzlibmemusage”, the memory used by zlib is<br>  “zlibmemusage” in bytes.</number></p>\n<p>noepoll<br>  disables the use of the “epoll” event polling system on linux. it is<br>  equivalent to the command-line argument “-de”. the next polling system<br>  used will generally be “poll”. see also “nopoll”.</p>\n<p>nokqueue<br>  disables the use of the “kqueue” event polling system on bsd. it is<br>  equivalent to the command-line argument “-dk”. the next polling system<br>  used will generally be “poll”. see also “nopoll”.</p>\n<p>nopoll<br>  disables the use of the “poll” event polling system. it is equivalent to the<br>  command-line argument “-dp”. the next polling system used will be “select”.<br>  it should never be needed to disable “poll” since it’s available on all<br>  platforms supported by haproxy. see also “nokqueue” and “noepoll”.</p>\n<p>nosplice<br>  disables the use of kernel tcp splicing between sockets on linux. it is<br>  equivalent to the command line argument “-ds”.  data will then be copied<br>  using conventional and more portable recv/send calls. kernel tcp splicing is<br>  limited to some very recent instances of kernel 2.6. most versions between<br>  2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not<br>  be used. this option makes it easier to globally disable kernel splicing in<br>  case of doubt. see also “option splice-auto”, “option splice-request” and<br>  “option splice-response”.</p>\n<p>nogetaddrinfo<br>  disables the use of getaddrinfo(3) for name resolving. it is equivalent to<br>  the command line argument “-dg”. deprecated gethostbyname(3) will be used.</p>\n<p>spread-checks <0..50, in=\"\" percent=\"\"><br>  sometimes it is desirable to avoid sending agent and health checks to<br>  servers at exact intervals, for instance when many logical servers are<br>  located on the same physical server. with the help of this parameter, it<br>  becomes possible to add some randomness in the check interval between 0<br>  and +/- 50%. a value between 2 and 5 seems to show good results. the<br>  default value remains at 0.</0..50,></p>\n<p>tune.buffers.limit <number><br>  sets a hard limit on the number of buffers which may be allocated per process.<br>  the default value is zero which means unlimited. the minimum non-zero value<br>  will always be greater than “tune.buffers.reserve” and should ideally always<br>  be about twice as large. forcing this value can be particularly useful to<br>  limit the amount of memory a process may take, while retaining a sane<br>  behaviour. when this limit is reached, sessions which need a buffer wait for<br>  another one to be released by another session. since buffers are dynamically<br>  allocated and released, the waiting time is very short and not perceptible<br>  provided that limits remain reasonable. in fact sometimes reducing the limit<br>  may even increase performance by increasing the cpu cache’s efficiency. tests<br>  have shown good results on average http traffic with a limit to 1/10 of the<br>  expected global maxconn setting, which also significantly reduces memory<br>  usage. the memory savings come from the fact that a number of connections<br>  will not allocate 2*tune.bufsize. it is best not to touch this value unless<br>  advised to do so by an haproxy core developer.</number></p>\n<p>tune.buffers.reserve <number><br>  sets the number of buffers which are pre-allocated and reserved for use only<br>  during memory shortage conditions resulting in failed memory allocations. the<br>  minimum value is 2 and is also the default. there is no reason a user would<br>  want to change this value, it’s mostly aimed at haproxy core developers.</number></p>\n<p>tune.bufsize <number><br>  sets the buffer size to this size (in bytes). lower values allow more<br>  sessions to coexist in the same amount of ram, and higher values allow some<br>  applications with very large cookies to work. the default value is 16384 and<br>  can be changed at build time. it is strongly recommended not to change this<br>  from the default value, as very low values will break some services such as<br>  statistics, and values larger than default size will increase memory usage,<br>  possibly causing the system to run out of memory. at least the global maxconn<br>  parameter should be decreased by the same factor as this one is increased.<br>  if http request is larger than (tune.bufsize - tune.maxrewrite), haproxy will<br>  return http 400 (bad request) error. similarly if an http response is larger<br>  than this size, haproxy will return http 502 (bad gateway).</number></p>\n<p>tune.chksize <number><br>  sets the check buffer size to this size (in bytes). higher values may help<br>  find string or regex patterns in very large pages, though doing so may imply<br>  more memory and cpu usage. the default value is 16384 and can be changed at<br>  build time. it is not recommended to change this value, but to use better<br>  checks whenever possible.</number></p>\n<p>tune.comp.maxlevel <number><br>  sets the maximum compression level. the compression level affects cpu<br>  usage during compression. this value affects cpu usage during compression.<br>  each session using compression initializes the compression algorithm with<br>  this value. the default value is 1.</number></p>\n<p>tune.http.cookielen <number><br>  sets the maximum length of captured cookies. this is the maximum value that<br>  the “capture cookie xxx len yyy” will be allowed to take, and any upper value<br>  will automatically be truncated to this one. it is important not to set too<br>  high a value because all cookie captures still allocate this size whatever<br>  their configured value (they share a same pool). this value is per request<br>  per response, so the memory allocated is twice this value per connection.<br>  when not specified, the limit is set to 63 characters. it is recommended not<br>  to change this value.</number></p>\n<p>tune.http.maxhdr <number><br>  sets the maximum number of headers in a request. when a request comes with a<br>  number of headers greater than this value (including the first line), it is<br>  rejected with a “400 bad request” status code. similarly, too large responses<br>  are blocked with “502 bad gateway”. the default value is 101, which is enough<br>  for all usages, considering that the widely deployed apache server uses the<br>  same limit. it can be useful to push this limit further to temporarily allow<br>  a buggy application to work by the time it gets fixed. keep in mind that each<br>  new header consumes 32bits of memory for each session, so don’t push this<br>  limit too high.</number></p>\n<p>tune.idletimer <timeout><br>  sets the duration after which haproxy will consider that an empty buffer is<br>  probably associated with an idle stream. this is used to optimally adjust<br>  some packet sizes while forwarding large and small data alternatively. the<br>  decision to use splice() or to send large buffers in ssl is modulated by this<br>  parameter. the value is in milliseconds between 0 and 65535. a value of zero<br>  means that haproxy will not try to detect idle streams. the default is 1000,<br>  which seems to correctly detect end user pauses (eg: read a page before<br>  clicking). there should be not reason for changing this value. please check<br>  tune.ssl.maxrecord below.</timeout></p>\n<p>tune.lua.forced-yield <number><br>  this directive forces the lua engine to execute a yield each <number> of<br>  instructions executed. this permits interruptng a long script and allows the<br>  haproxy scheduler to process other tasks like accepting connections or<br>  forwarding traffic. the default value is 10000 instructions. if haproxy often<br>  executes some lua code but more reactivity is required, this value can be<br>  lowered. if the lua code is quite long and its result is absolutely required<br>  to process the data, the <number> can be increased.</number></number></number></p>\n<p>tune.lua.maxmem<br>  sets the maximum amount of ram in megabytes per process usable by lua. by<br>  default it is zero which means unlimited. it is important to set a limit to<br>  ensure that a bug in a script will not result in the system running out of<br>  memory.</p>\n<p>tune.lua.session-timeout <timeout><br>  this is the execution timeout for the lua sessions. this is useful for<br>  preventing infinite loops or spending too much time in lua. this timeout has a<br>  priority over other timeouts. for example, if this timeout is set to 4s and<br>  you run a 5s sleep, the code will be interrupted with an error after waiting<br>  4s.</timeout></p>\n<p>tune.lua.task-timeout <timeout><br>  purpose is the same as “tune.lua.session-timeout”, but this timeout is<br>  dedicated to the tasks. by default, this timeout isn’t set because a task may<br>  remain alive during of the lifetime of haproxy. for example, a task used to<br>  check servers.</timeout></p>\n<p>tune.maxaccept <number><br>  sets the maximum number of consecutive connections a process may accept in a<br>  row before switching to other work. in single process mode, higher numbers<br>  give better performance at high connection rates. however in multi-process<br>  modes, keeping a bit of fairness between processes generally is better to<br>  increase performance. this value applies individually to each listener, so<br>  that the number of processes a listener is bound to is taken into account.<br>  this value defaults to 64. in multi-process mode, it is divided by twice<br>  the number of processes the listener is bound to. setting this value to -1<br>  completely disables the limitation. it should normally not be needed to tweak<br>  this value.</number></p>\n<p>tune.maxpollevents <number><br>  sets the maximum amount of events that can be processed at once in a call to<br>  the polling system. the default value is adapted to the operating system. it<br>  has been noticed that reducing it below 200 tends to slightly decrease<br>  latency at the expense of network bandwidth, and increasing it above 200<br>  tends to trade latency for slightly increased bandwidth.</number></p>\n<p>tune.maxrewrite <number><br>  sets the reserved buffer space to this size in bytes. the reserved space is<br>  used for header rewriting or appending. the first reads on sockets will never<br>  fill more than bufsize-maxrewrite. historically it has defaulted to half of<br>  bufsize, though that does not make much sense since there are rarely large<br>  numbers of headers to add. setting it too high prevents processing of large<br>  requests or responses. setting it too low prevents addition of new headers<br>  to already large requests or to post requests. it is generally wise to set it<br>  to about 1024. it is automatically readjusted to half of bufsize if it is<br>  larger than that. this means you don’t have to worry about it when changing<br>  bufsize.</number></p>\n<p>tune.pattern.cache-size <number><br>  sets the size of the pattern lookup cache to <number> entries. this is an lru<br>  cache which reminds previous lookups and their results. it is used by acls<br>  and maps on slow pattern lookups, namely the ones using the “sub”, “reg”,<br>  “dir”, “dom”, “end”, “bin” match methods as well as the case-insensitive<br>  strings. it applies to pattern expressions which means that it will be able<br>  to memorize the result of a lookup among all the patterns specified on a<br>  configuration line (including all those loaded from files). it automatically<br>  invalidates entries which are updated using http actions or on the cli. the<br>  default cache size is set to 10000 entries, which limits its footprint to<br>  about 5 mb on 32-bit systems and 8 mb on 64-bit systems. there is a very low<br>  risk of collision in this cache, which is in the order of the size of the<br>  cache divided by 2^64. typically, at 10000 requests per second with the<br>  default cache size of 10000 entries, there’s 1% chance that a brute force<br>  attack could cause a single collision after 60 years, or 0.1% after 6 years.<br>  this is considered much lower than the risk of a memory corruption caused by<br>  aging components. if this is not acceptable, the cache can be disabled by<br>  setting this parameter to 0.</number></number></p>\n<p>tune.pipesize <number><br>  sets the kernel pipe buffer size to this size (in bytes). by default, pipes<br>  are the default size for the system. but sometimes when using tcp splicing,<br>  it can improve performance to increase pipe sizes, especially if it is<br>  suspected that pipes are not filled and that many calls to splice() are<br>  performed. this has an impact on the kernel’s memory footprint, so this must<br>  not be changed if impacts are not understood.</number></p>\n<p>tune.rcvbuf.client <number><br>tune.rcvbuf.server <number><br>  forces the kernel socket receive buffer size on the client or the server side<br>  to the specified value in bytes. this value applies to all tcp/http frontends<br>  and backends. it should normally never be set, and the default size (0) lets<br>  the kernel autotune this value depending on the amount of available memory.<br>  however it can sometimes help to set it to very low values (eg: 4096) in<br>  order to save kernel memory by preventing it from buffering too large amounts<br>  of received data. lower values will significantly increase cpu usage though.</number></number></p>\n<p>tune.sndbuf.client <number><br>tune.sndbuf.server <number><br>  forces the kernel socket send buffer size on the client or the server side to<br>  the specified value in bytes. this value applies to all tcp/http frontends<br>  and backends. it should normally never be set, and the default size (0) lets<br>  the kernel autotune this value depending on the amount of available memory.<br>  however it can sometimes help to set it to very low values (eg: 4096) in<br>  order to save kernel memory by preventing it from buffering too large amounts<br>  of received data. lower values will significantly increase cpu usage though.<br>  another use case is to prevent write timeouts with extremely slow clients due<br>  to the kernel waiting for a large part of the buffer to be read before<br>  notifying haproxy again.</number></number></p>\n<p>tune.ssl.cachesize <number><br>  sets the size of the global ssl session cache, in a number of blocks. a block<br>  is large enough to contain an encoded session without peer certificate.<br>  an encoded session with peer certificate is stored in multiple blocks<br>  depending on the size of the peer certificate. a block uses approximately<br>  200 bytes of memory. the default value may be forced at build time, otherwise<br>  defaults to 20000.  when the cache is full, the most idle entries are purged<br>  and reassigned. higher values reduce the occurrence of such a purge, hence<br>  the number of cpu-intensive ssl handshakes by ensuring that all users keep<br>  their session as long as possible. all entries are pre-allocated upon startup<br>  and are shared between all processes if “nbproc” is greater than 1. setting<br>  this value to 0 disables the ssl session cache.</number></p>\n<p>tune.ssl.force-private-cache<br>  this boolean disables ssl session cache sharing between all processes. it<br>  should normally not be used since it will force many renegotiations due to<br>  clients hitting a random process. but it may be required on some operating<br>  systems where none of the ssl cache synchronization method may be used. in<br>  this case, adding a first layer of hash-based load balancing before the ssl<br>  layer might limit the impact of the lack of session sharing.</p>\n<p>tune.ssl.lifetime <timeout><br>  sets how long a cached ssl session may remain valid. this time is expressed<br>  in seconds and defaults to 300 (5 min). it is important to understand that it<br>  does not guarantee that sessions will last that long, because if the cache is<br>  full, the longest idle sessions will be purged despite their configured<br>  lifetime. the real usefulness of this setting is to prevent sessions from<br>  being used for too long.</timeout></p>\n<p>tune.ssl.maxrecord <number><br>  sets the maximum amount of bytes passed to ssl_write() at a time. default<br>  value 0 means there is no limit. over ssl/tls, the client can decipher the<br>  data only once it has received a full record. with large records, it means<br>  that clients might have to download up to 16kb of data before starting to<br>  process them. limiting the value can improve page load times on browsers<br>  located over high latency or low bandwidth networks. it is suggested to find<br>  optimal values which fit into 1 or 2 tcp segments (generally 1448 bytes over<br>  ethernet with tcp timestamps enabled, or 1460 when timestamps are disabled),<br>  keeping in mind that ssl/tls add some overhead. typical values of 1419 and<br>  2859 gave good results during tests. use “strace -e trace=write” to find the<br>  best value. haproxy will automatically switch to this setting after an idle<br>  stream has been detected (see tune.idletimer above).</number></p>\n<p>tune.ssl.default-dh-param <number><br>  sets the maximum size of the diffie-hellman parameters used for generating<br>  the ephemeral/temporary diffie-hellman key in case of dhe key exchange. the<br>  final size will try to match the size of the server’s rsa (or dsa) key (e.g,<br>  a 2048 bits temporary dh key for a 2048 bits rsa key), but will not exceed<br>  this maximum value. default value if 1024. only 1024 or higher values are<br>  allowed. higher values will increase the cpu load, and values greater than<br>  1024 bits are not supported by java 7 and earlier clients. this value is not<br>  used if static diffie-hellman parameters are supplied either directly<br>  in the certificate file or by using the ssl-dh-param-file parameter.</number></p>\n<p>tune.ssl.ssl-ctx-cache-size <number><br>  sets the size of the cache used to store generated certificates to <number><br>  entries. this is a lru cache. because generating a ssl certificate<br>  dynamically is expensive, they are cached. the default cache size is set to<br>  1000 entries.</number></number></p>\n<p>tune.vars.global-max-size <size><br>tune.vars.reqres-max-size <size><br>tune.vars.sess-max-size <size><br>tune.vars.txn-max-size <size><br>  these four tunes helps to manage the allowed amount of memory used by the<br>  variables system. “global” limits the memory for all the systems. “sess” limit<br>  the memory by session, “txn” limits the memory by transaction and “reqres”<br>  limits the memory for each request or response processing. during the<br>  accounting, “sess” embbed “txn” and “txn” embed “reqres”.</size></size></size></size></p>\n<p>  by example, we considers that “tune.vars.sess-max-size” is fixed to 100,<br>  “tune.vars.txn-max-size” is fixed to 100, “tune.vars.reqres-max-size” is<br>  also fixed to 100. if we create a variable “txn.var” that contains 100 bytes,<br>  we cannot create any more variable in the other contexts.</p>\n<p>tune.zlib.memlevel <number><br>  sets the memlevel parameter in zlib initialization for each session. it<br>  defines how much memory should be allocated for the internal compression<br>  state. a value of 1 uses minimum memory but is slow and reduces compression<br>  ratio, a value of 9 uses maximum memory for optimal speed.  can be a value<br>  between 1 and 9. the default value is 8.</number></p>\n<p>tune.zlib.windowsize <number><br>  sets the window size (the size of the history buffer) as a parameter of the<br>  zlib initialization for each session. larger values of this parameter result<br>  in better compression at the expense of memory usage.  can be a value between<br>  8 and 15.  the default value is 15.</number></p>\n<h2 id=\"3-3-debugging\"><a href=\"#3-3-debugging\" class=\"headerlink\" title=\"3.3. debugging\"></a>3.3. debugging</h2><p>debug<br>  enables debug mode which dumps to stdout all exchanges, and disables forking<br>  into background. it is the equivalent of the command-line argument “-d”. it<br>  should never be used in a production configuration since it may prevent full<br>  system startup.</p>\n<p>quiet<br>  do not display any message during startup. it is equivalent to the command-<br>  line argument “-q”.</p>\n<h2 id=\"3-4-userlists\"><a href=\"#3-4-userlists\" class=\"headerlink\" title=\"3.4. userlists\"></a>3.4. userlists</h2><p>it is possible to control access to frontend/backend/listen sections or to<br>http stats by allowing only authenticated and authorized users. to do this,<br>it is required to create at least one userlist and to define users.</p>\n<p>userlist <listname><br>  creates new userlist with name <listname>. many independent userlists can be<br>  used to store authentication &amp; authorization data for independent customers.</listname></listname></p>\n<p>group <groupname> [users <user>,<user>,(…)]<br>  adds group <groupname> to the current userlist. it is also possible to<br>  attach users to this group by using a comma separated list of names<br>  proceeded by “users” keyword.</groupname></user></user></groupname></p>\n<p>user <username> [password|insecure-password <password>]<br>                [groups <group>,<group>,(…)]<br>  adds user <username> to the current userlist. both secure (encrypted) and<br>  insecure (unencrypted) passwords can be used. encrypted passwords are<br>  evaluated using the crypt(3) function so depending of the system’s<br>  capabilities, different algorithms are supported. for example modern glibc<br>  based linux system supports md5, sha-256, sha-512 and of course classic,<br>  des-based method of encrypting passwords.</username></group></group></password></username></p>\n<p>  example:<br>        userlist l1<br>          group g1 users tiger,scott<br>          group g2 users xdb,scott</p>\n<pre><code>  user tiger password $6$k6y3o.ep$jlkbx9za9667qe4(...)xhswrv6j.c0/d7cv91\n  user scott insecure-password elgato\n  user xdb insecure-password hello\n\nuserlist l2\n  group g1\n  group g2\n\n  user tiger password $6$k6y3o.ep$jlkbx(...)xhswrv6j.c0/d7cv91 groups g1\n  user scott insecure-password elgato groups g1,g2\n  user xdb insecure-password hello groups g2\n</code></pre><p>  please note that both lists are functionally identical.</p>\n<h2 id=\"3-5-peers\"><a href=\"#3-5-peers\" class=\"headerlink\" title=\"3.5. peers\"></a>3.5. peers</h2><p>it is possible to propagate entries of any data-types in stick-tables between<br>several haproxy instances over tcp connections in a multi-master fashion. each<br>instance pushes its local updates and insertions to remote peers. the pushed<br>values overwrite remote ones without aggregation. interrupted exchanges are<br>automatically detected and recovered from the last known point.<br>in addition, during a soft restart, the old process connects to the new one<br>using such a tcp connection to push all its entries before the new process<br>tries to connect to other peers. that ensures very fast replication during a<br>reload, it typically takes a fraction of a second even for large tables.<br>note that server ids are used to identify servers remotely, so it is important<br>that configurations look similar or at least that the same ids are forced on<br>each server on all participants.</p>\n<p>peers <peersect><br>  creates a new peer list with name <peersect>. it is an independent section,<br>  which is referenced by one or more stick-tables.</peersect></peersect></p>\n<p>disabled<br>  disables a peers section. it disables both listening and any synchronization<br>  related to this section. this is provided to disable synchronization of stick<br>  tables without having to comment out all “peers” references.</p>\n<p>enable<br>  this re-enables a disabled peers section which was previously disabled.</p>\n<p>peer <peername> <ip>:<port><br>  defines a peer inside a peers section.<br>  if <peername> is set to the local peer name (by default hostname, or forced<br>  using “-l” command line option), haproxy will listen for incoming remote peer<br>  connection on <ip>:<port>. otherwise, <ip>:<port> defines where to connect to<br>  to join the remote peer, and <peername> is used at the protocol level to<br>  identify and validate the remote peer on the server side.</peername></port></ip></port></ip></peername></port></ip></peername></p>\n<p>  during a soft restart, local peer <ip>:<port> is used by the old instance to<br>  connect the new one and initiate a complete replication (teaching process).</port></ip></p>\n<p>  it is strongly recommended to have the exact same peers declaration on all<br>  peers and to only rely on the “-l” command line argument to change the local<br>  peer name. this makes it easier to maintain coherent configuration files<br>  across all peers.</p>\n<p>  you may want to reference some environment variables in the address<br>  parameter, see section 2.3 about environment variables.</p>\n<p>  example:<br>    peers mypeers<br>        peer haproxy1 192.168.0.1:1024<br>        peer haproxy2 192.168.0.2:1024<br>        peer haproxy3 10.2.0.1:1024</p>\n<pre><code>backend mybackend\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 20k peers mypeers\n    stick on src\n\n    server srv1 192.168.0.30:80\n    server srv2 192.168.0.31:80\n</code></pre><h2 id=\"3-6-mailers\"><a href=\"#3-6-mailers\" class=\"headerlink\" title=\"3.6. mailers\"></a>3.6. mailers</h2><p>it is possible to send email alerts when the state of servers changes.<br>if configured email alerts are sent to each mailer that is configured<br>in a mailers section. email is sent to mailers using smtp.</p>\n<p>mailer <mailersect><br>  creates a new mailer list with the name <mailersect>. it is an<br>  independent section which is referenced by one or more proxies.</mailersect></mailersect></p>\n<p>mailer <mailername> <ip>:<port><br>  defines a mailer inside a mailers section.</port></ip></mailername></p>\n<p>  example:<br>    mailers mymailers<br>        mailer smtp1 192.168.0.1:587<br>        mailer smtp2 192.168.0.2:587</p>\n<pre><code>backend mybackend\n    mode tcp\n    balance roundrobin\n\n    email-alert mailers mymailers\n    email-alert from test1@horms.org\n    email-alert to test2@horms.org\n\n    server srv1 192.168.0.30:80\n    server srv2 192.168.0.31:80\n</code></pre><h2 id=\"4-proxies\"><a href=\"#4-proxies\" class=\"headerlink\" title=\"4. proxies\"></a>4. proxies</h2><p>proxy configuration can be located in a set of sections :</p>\n<ul>\n<li>defaults [<name>]</name></li>\n<li>frontend <name></name></li>\n<li>backend  <name></name></li>\n<li>listen   <name></name></li>\n</ul>\n<p>a “defaults” section sets default parameters for all other sections following<br>its declaration. those default parameters are reset by the next “defaults”<br>section. see below for the list of parameters which can be set in a “defaults”<br>section. the name is optional but its use is encouraged for better readability.</p>\n<p>a “frontend” section describes a set of listening sockets accepting client<br>connections.</p>\n<p>a “backend” section describes a set of servers to which the proxy will connect<br>to forward incoming connections.</p>\n<p>a “listen” section defines a complete proxy with its frontend and backend<br>parts combined in one section. it is generally useful for tcp-only traffic.</p>\n<p>all proxy names must be formed from upper and lower case letters, digits,<br>‘-‘ (dash), ‘_’ (underscore) , ‘.’ (dot) and ‘:’ (colon). acl names are<br>case-sensitive, which means that “www” and “www” are two different proxies.</p>\n<p>historically, all proxy names could overlap, it just caused troubles in the<br>logs. since the introduction of content switching, it is mandatory that two<br>proxies with overlapping capabilities (frontend/backend) have different names.<br>however, it is still permitted that a frontend and a backend share the same<br>name, as this configuration seems to be commonly encountered.</p>\n<p>right now, two major proxy modes are supported : “tcp”, also known as layer 4,<br>and “http”, also known as layer 7. in layer 4 mode, haproxy simply forwards<br>bidirectional traffic between two sides. in layer 7 mode, haproxy analyzes the<br>protocol, and can interact with it by allowing, blocking, switching, adding,<br>modifying, or removing arbitrary contents in requests or responses, based on<br>arbitrary criteria.</p>\n<p>in http mode, the processing applied to requests and responses flowing over<br>a connection depends in the combination of the frontend’s http options and<br>the backend’s. haproxy supports 5 connection modes :</p>\n<ul>\n<li><p>kal : keep alive (“option http-keep-alive”) which is the default mode : all<br>requests and responses are processed, and connections remain open but idle<br>between responses and new requests.</p>\n</li>\n<li><p>tun: tunnel (“option http-tunnel”) : this was the default mode for versions<br>1.0 to 1.5-dev21 : only the first request and response are processed, and<br>everything else is forwarded with no analysis at all. this mode should not<br>be used as it creates lots of trouble with logging and http processing.</p>\n</li>\n<li><p>pcl: passive close (“option httpclose”) : exactly the same as tunnel mode,<br>but with “connection: close” appended in both directions to try to make<br>both ends close after the first request/response exchange.</p>\n</li>\n<li><p>scl: server close (“option http-server-close”) : the server-facing<br>connection is closed after the end of the response is received, but the<br>client-facing connection remains open.</p>\n</li>\n<li><p>fcl: forced close (“option forceclose”) : the connection is actively closed<br>after the end of the response.</p>\n</li>\n</ul>\n<p>the effective mode that will be applied to a connection passing through a<br>frontend and a backend can be determined by both proxy modes according to the<br>following matrix, but in short, the modes are symmetric, keep-alive is the<br>weakest option and force close is the strongest.</p>\n<pre><code>              backend mode\n\n    | kal | tun | pcl | scl | fcl\n----+-----+-----+-----+-----+----\nkal | kal | tun | pcl | scl | fcl\n----+-----+-----+-----+-----+----\ntun | tun | tun | pcl | scl | fcl\n</code></pre><p> frontend   —-+—–+—–+—–+—–+—-<br>   mode     pcl | pcl | pcl | pcl | fcl | fcl<br>            —-+—–+—–+—–+—–+—-<br>            scl | scl | scl | fcl | scl | fcl<br>            —-+—–+—–+—–+—–+—-<br>            fcl | fcl | fcl | fcl | fcl | fcl</p>\n<h2 id=\"4-1-proxy-keywords-matrix\"><a href=\"#4-1-proxy-keywords-matrix\" class=\"headerlink\" title=\"4.1. proxy keywords matrix\"></a>4.1. proxy keywords matrix</h2><p>the following list of keywords is supported. most of them may only be used in a<br>limited set of section types. some of them are marked as “deprecated” because<br>they are inherited from an old syntax which may be confusing or functionally<br>limited, and there are new recommended keywords to replace them. keywords<br>marked with “(*)” can be optionally inverted using the “no” prefix, eg. “no<br>option contstats”. this makes sense when the option has been enabled by default<br>and must be disabled for a specific instance. such options may also be prefixed<br>with “default” in order to restore default settings regardless of what has been<br>specified in a previous “defaults” section.</p>\n<p> keyword                              defaults   frontend   listen    backend<br>————————————+———-+———-+———+———<br>acl                                       -          x         x         x<br>appsession                                -          -         x         x<br>backlog                                   x          x         x         -<br>balance                                   x          -         x         x<br>bind                                      -          x         x         -<br>bind-process                              x          x         x         x<br>block                                     -          x         x         x<br>capture cookie                            -          x         x         -<br>capture request header                    -          x         x         -<br>capture response header                   -          x         x         -<br>clitimeout                  (deprecated)  x          x         x         -<br>compression                               x          x         x         x<br>contimeout                  (deprecated)  x          -         x         x<br>cookie                                    x          -         x         x<br>declare capture                           -          x         x         -<br>default-server                            x          -         x         x<br>default_backend                           x          x         x         -<br>description                               -          x         x         x<br>disabled                                  x          x         x         x<br>dispatch                                  -          -         x         x<br>email-alert from                          x          x         x         x<br>email-alert level                         x          x         x         x<br>email-alert mailers                       x          x         x         x<br>email-alert myhostname                    x          x         x         x<br>email-alert to                            x          x         x         x<br>enabled                                   x          x         x         x<br>errorfile                                 x          x         x         x<br>errorloc                                  x          x         x         x<br>errorloc302                               x          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>errorloc303                               x          x         x         x<br>force-persist                             -          x         x         x<br>fullconn                                  x          -         x         x<br>grace                                     x          x         x         x<br>hash-type                                 x          -         x         x<br>http-check disable-on-404                 x          -         x         x<br>http-check expect                         -          -         x         x<br>http-check send-state                     x          -         x         x<br>http-request                              -          x         x         x<br>http-response                             -          x         x         x<br>http-send-name-header                     -          -         x         x<br>id                                        -          x         x         x<br>ignore-persist                            -          x         x         x<br>log                                  (<em>)  x          x         x         x<br>log-format                                x          x         x         -<br>log-tag                                   x          x         x         x<br>max-keep-alive-queue                      x          -         x         x<br>maxconn                                   x          x         x         -<br>mode                                      x          x         x         x<br>monitor fail                              -          x         x         -<br>monitor-net                               x          x         x         -<br>monitor-uri                               x          x         x         -<br>option abortonclose                  (</em>)  x          -         x         x<br>option accept-invalid-http-request   (<em>)  x          x         x         -<br>option accept-invalid-http-response  (</em>)  x          -         x         x<br>option allbackups                    (<em>)  x          -         x         x<br>option checkcache                    (</em>)  x          -         x         x<br>option clitcpka                      (<em>)  x          x         x         -<br>option contstats                     (</em>)  x          x         x         -<br>option dontlog-normal                (<em>)  x          x         x         -<br>option dontlognull                   (</em>)  x          x         x         -<br>option forceclose                    (<em>)  x          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>option forwardfor                         x          x         x         x<br>option http-buffer-request           (</em>)  x          x         x         x<br>option http-ignore-probes            (<em>)  x          x         x         -<br>option http-keep-alive               (</em>)  x          x         x         x<br>option http-no-delay                 (<em>)  x          x         x         x<br>option http-pretend-keepalive        (</em>)  x          x         x         x<br>option http-server-close             (<em>)  x          x         x         x<br>option http-tunnel                   (</em>)  x          x         x         x<br>option http-use-proxy-header         (<em>)  x          x         x         -<br>option httpchk                            x          -         x         x<br>option httpclose                     (</em>)  x          x         x         x<br>option httplog                            x          x         x         x<br>option http_proxy                    (<em>)  x          x         x         x<br>option independent-streams           (</em>)  x          x         x         x<br>option ldap-check                         x          -         x         x<br>option external-check                     x          -         x         x<br>option log-health-checks             (<em>)  x          -         x         x<br>option log-separate-errors           (</em>)  x          x         x         -<br>option logasap                       (<em>)  x          x         x         -<br>option mysql-check                        x          -         x         x<br>option pgsql-check                        x          -         x         x<br>option nolinger                      (</em>)  x          x         x         x<br>option originalto                         x          x         x         x<br>option persist                       (<em>)  x          -         x         x<br>option redispatch                    (</em>)  x          -         x         x<br>option redis-check                        x          -         x         x<br>option smtpchk                            x          -         x         x<br>option socket-stats                  (<em>)  x          x         x         -<br>option splice-auto                   (</em>)  x          x         x         x<br>option splice-request                (<em>)  x          x         x         x<br>option splice-response               (</em>)  x          x         x         x<br>option srvtcpka                      (<em>)  x          -         x         x<br>option ssl-hello-chk                      x          -         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>option tcp-check                          x          -         x         x<br>option tcp-smart-accept              (</em>)  x          x         x         -<br>option tcp-smart-connect             (<em>)  x          -         x         x<br>option tcpka                              x          x         x         x<br>option tcplog                             x          x         x         x<br>option transparent                   (</em>)  x          -         x         x<br>external-check command                    x          -         x         x<br>external-check path                       x          -         x         x<br>persist rdp-cookie                        x          -         x         x<br>rate-limit sessions                       x          x         x         -<br>redirect                                  -          x         x         x<br>redisp                      (deprecated)  x          -         x         x<br>redispatch                  (deprecated)  x          -         x         x<br>reqadd                                    -          x         x         x<br>reqallow                                  -          x         x         x<br>reqdel                                    -          x         x         x<br>reqdeny                                   -          x         x         x<br>reqiallow                                 -          x         x         x<br>reqidel                                   -          x         x         x<br>reqideny                                  -          x         x         x<br>reqipass                                  -          x         x         x<br>reqirep                                   -          x         x         x<br>reqitarpit                                -          x         x         x<br>reqpass                                   -          x         x         x<br>reqrep                                    -          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>reqtarpit                                 -          x         x         x<br>retries                                   x          -         x         x<br>rspadd                                    -          x         x         x<br>rspdel                                    -          x         x         x<br>rspdeny                                   -          x         x         x<br>rspidel                                   -          x         x         x<br>rspideny                                  -          x         x         x<br>rspirep                                   -          x         x         x<br>rsprep                                    -          x         x         x<br>server                                    -          -         x         x<br>source                                    x          -         x         x<br>srvtimeout                  (deprecated)  x          -         x         x<br>stats admin                               -          -         x         x<br>stats auth                                x          -         x         x<br>stats enable                              x          -         x         x<br>stats hide-version                        x          -         x         x<br>stats http-request                        -          -         x         x<br>stats realm                               x          -         x         x<br>stats refresh                             x          -         x         x<br>stats scope                               x          -         x         x<br>stats show-desc                           x          -         x         x<br>stats show-legends                        x          -         x         x<br>stats show-node                           x          -         x         x<br>stats uri                                 x          -         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>stick match                               -          -         x         x<br>stick on                                  -          -         x         x<br>stick store-request                       -          -         x         x<br>stick store-response                      -          -         x         x<br>stick-table                               -          -         x         x<br>tcp-check connect                         -          -         x         x<br>tcp-check expect                          -          -         x         x<br>tcp-check send                            -          -         x         x<br>tcp-check send-binary                     -          -         x         x<br>tcp-request connection                    -          x         x         -<br>tcp-request content                       -          x         x         x<br>tcp-request inspect-delay                 -          x         x         x<br>tcp-response content                      -          -         x         x<br>tcp-response inspect-delay                -          -         x         x<br>timeout check                             x          -         x         x<br>timeout client                            x          x         x         -<br>timeout client-fin                        x          x         x         -<br>timeout clitimeout          (deprecated)  x          x         x         -<br>timeout connect                           x          -         x         x<br>timeout contimeout          (deprecated)  x          -         x         x<br>timeout http-keep-alive                   x          x         x         x<br>timeout http-request                      x          x         x         x<br>timeout queue                             x          -         x         x<br>timeout server                            x          -         x         x<br>timeout server-fin                        x          -         x         x<br>timeout srvtimeout          (deprecated)  x          -         x         x<br>timeout tarpit                            x          x         x         x<br>timeout tunnel                            x          -         x         x<br>transparent                 (deprecated)  x          -         x         x<br>unique-id-format                          x          x         x         -<br>unique-id-header                          x          x         x         -<br>use_backend                               -          x         x         -<br>use-server                                -          -         x         x<br>————————————+———-+———-+———+———<br> keyword                              defaults   frontend   listen    backend</p>\n<h2 id=\"4-2-alphabetically-sorted-keywords-reference\"><a href=\"#4-2-alphabetically-sorted-keywords-reference\" class=\"headerlink\" title=\"4.2. alphabetically sorted keywords reference\"></a>4.2. alphabetically sorted keywords reference</h2><p>this section provides a description of each keyword and its usage.</p>\n<p>acl <aclname> <criterion> [flags] [operator] <value> …<br>  declare or complete an access list.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  example:<br>        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3<br>        acl invalid_src  src_port     0:1023<br>        acl local_dst    hdr(host) -i localhost</value></criterion></aclname></p>\n<p>  see section 7 about acl usage.</p>\n<p>appsession <cookie> len <length> timeout <holdtime><br>           [request-learn] [prefix] [mode <path-parameters|query-string>]<br>  define session stickiness on an existing application cookie.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <cookie>   this is the name of the cookie used by the application and which<br>               haproxy will have to learn for each new session.</cookie></path-parameters|query-string></holdtime></length></cookie></p>\n<pre><code>&lt;length&gt;   this is the max number of characters that will be memorized and\n           checked in each cookie value.\n\n&lt;holdtime&gt; this is the time after which the cookie will be removed from\n           memory if unused. if no unit is specified, this time is in\n           milliseconds.\n\nrequest-learn\n           if this option is specified, then haproxy will be able to learn\n           the cookie found in the request in case the server does not\n           specify any in response. this is typically what happens with\n           phpsessid cookies, or when haproxy&apos;s session expires before\n           the application&apos;s session and the correct server is selected.\n           it is recommended to specify this option to improve reliability.\n\nprefix     when this option is specified, haproxy will match on the cookie\n           prefix (or url parameter prefix). the appsession value is the\n           data following this prefix.\n\n           example :\n           appsession aspsessionid len 64 timeout 3h prefix\n\n           this will match the cookie aspsessionidxxxx=xxxxx,\n           the appsession value will be xxxx=xxxxx.\n\nmode       this option allows to change the url parser mode.\n           2 modes are currently supported :\n           - path-parameters :\n             the parser looks for the appsession in the path parameters\n             part (each parameter is separated by a semi-colon), which is\n             convenient for jsessionid for example.\n             this is the default mode if the option is not set.\n           - query-string :\n             in this mode, the parser will look for the appsession in the\n             query string.\n</code></pre><p>  when an application cookie is defined in a backend, haproxy will check when<br>  the server sets such a cookie, and will store its value in a table, and<br>  associate it with the server’s identifier. up to <length> characters from<br>  the value will be retained. on each connection, haproxy will look for this<br>  cookie both in the “cookie:” headers, and as a url parameter (depending on<br>  the mode used). if a known value is found, the client will be directed to the<br>  server associated with this value. otherwise, the load balancing algorithm is<br>  applied. cookies are automatically removed from memory when they have been<br>  unused for a duration longer than <holdtime>.</holdtime></length></p>\n<p>  the definition of an application cookie is limited to one per backend.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :<br>        appsession jsessionid len 52 timeout 3h</p>\n<p>  see also : “cookie”, “capture cookie”, “balance”, “stick”, “stick-table”,<br>             “ignore-persist”, “nbproc” and “bind-process”.</p>\n<p>backlog <conns><br>  give hints to the system about the approximate listen backlog desired size<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <conns>   is the number of pending connections. depending on the operating<br>              system, it may represent the number of already acknowledged<br>              connections, of non-acknowledged ones, or both.</conns></conns></p>\n<p>  in order to protect against syn flood attacks, one solution is to increase<br>  the system’s syn backlog size. depending on the system, sometimes it is just<br>  tunable via a system parameter, sometimes it is not adjustable at all, and<br>  sometimes the system relies on hints given by the application at the time of<br>  the listen() syscall. by default, haproxy passes the frontend’s maxconn value<br>  to the listen() syscall. on systems which can make use of this value, it can<br>  sometimes be useful to be able to specify a different value, hence this<br>  backlog parameter.</p>\n<p>  on linux 2.4, the parameter is ignored by the system. on linux 2.6, it is<br>  used as a hint and the system accepts up to the smallest greater power of<br>  two, and never more than some limits (usually 32768).</p>\n<p>  see also : “maxconn” and the target operating system’s tuning guide.</p>\n<p>balance <algorithm> [ <arguments> ]<br>balance url_param <param> [check_post]<br>  define the load balancing algorithm to be used in a backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <algorithm> is the algorithm used to select a server when doing load<br>                balancing. this only applies when no persistence information<br>                is available, or when a connection is redispatched to another<br>                server. <algorithm> may be one of the following :</algorithm></algorithm></arguments></algorithm></p>\n<pre><code>  roundrobin  each server is used in turns, according to their weights.\n              this is the smoothest and fairest algorithm when the server&apos;s\n              processing time remains equally distributed. this algorithm\n              is dynamic, which means that server weights may be adjusted\n              on the fly for slow starts for instance. it is limited by\n              design to 4095 active servers per backend. note that in some\n              large farms, when a server becomes up after having been down\n              for a very short time, it may sometimes take a few hundreds\n              requests for it to be re-integrated into the farm and start\n              receiving traffic. this is normal, though very rare. it is\n              indicated here in case you would have the chance to observe\n              it, so that you don&apos;t worry.\n\n  static-rr   each server is used in turns, according to their weights.\n              this algorithm is as similar to roundrobin except that it is\n              static, which means that changing a server&apos;s weight on the\n              fly will have no effect. on the other hand, it has no design\n              limitation on the number of servers, and when a server goes\n              up, it is always immediately reintroduced into the farm, once\n              the full map is recomputed. it also uses slightly less cpu to\n              run (around -1%).\n\n  leastconn   the server with the lowest number of connections receives the\n              connection. round-robin is performed within groups of servers\n              of the same load to ensure that all servers will be used. use\n              of this algorithm is recommended where very long sessions are\n              expected, such as ldap, sql, tse, etc... but is not very well\n              suited for protocols using short sessions such as http. this\n              algorithm is dynamic, which means that server weights may be\n              adjusted on the fly for slow starts for instance.\n\n  first       the first server with available connection slots receives the\n              connection. the servers are chosen from the lowest numeric\n              identifier to the highest (see server parameter &quot;id&quot;), which\n              defaults to the server&apos;s position in the farm. once a server\n              reaches its maxconn value, the next server is used. it does\n              not make sense to use this algorithm without setting maxconn.\n              the purpose of this algorithm is to always use the smallest\n              number of servers so that extra servers can be powered off\n              during non-intensive hours. this algorithm ignores the server\n              weight, and brings more benefit to long session such as rdp\n              or imap than http, though it can be useful there too. in\n              order to use this algorithm efficiently, it is recommended\n              that a cloud controller regularly checks server usage to turn\n              them off when unused, and regularly checks backend queue to\n              turn new servers on when the queue inflates. alternatively,\n              using &quot;http-check send-state&quot; may inform servers on the load.\n\n  source      the source ip address is hashed and divided by the total\n              weight of the running servers to designate which server will\n              receive the request. this ensures that the same client ip\n              address will always reach the same server as long as no\n              server goes down or up. if the hash result changes due to the\n              number of running servers changing, many clients will be\n              directed to a different server. this algorithm is generally\n              used in tcp mode where no cookie may be inserted. it may also\n              be used on the internet to provide a best-effort stickiness\n              to clients which refuse session cookies. this algorithm is\n              static by default, which means that changing a server&apos;s\n              weight on the fly will have no effect, but this can be\n              changed using &quot;hash-type&quot;.\n\n  uri         this algorithm hashes either the left part of the uri (before\n              the question mark) or the whole uri (if the &quot;whole&quot; parameter\n              is present) and divides the hash value by the total weight of\n              the running servers. the result designates which server will\n              receive the request. this ensures that the same uri will\n              always be directed to the same server as long as no server\n              goes up or down. this is used with proxy caches and\n              anti-virus proxies in order to maximize the cache hit rate.\n              note that this algorithm may only be used in an http backend.\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n              this algorithm supports two optional parameters &quot;len&quot; and\n              &quot;depth&quot;, both followed by a positive integer number. these\n              options may be helpful when it is needed to balance servers\n              based on the beginning of the uri only. the &quot;len&quot; parameter\n              indicates that the algorithm should only consider that many\n              characters at the beginning of the uri to compute the hash.\n              note that having &quot;len&quot; set to 1 rarely makes sense since most\n              uris start with a leading &quot;/&quot;.\n\n              the &quot;depth&quot; parameter indicates the maximum directory depth\n              to be used to compute the hash. one level is counted for each\n              slash in the request. if both parameters are specified, the\n              evaluation stops when either is reached.\n\n  url_param   the url parameter specified in argument will be looked up in\n              the query string of each http get request.\n\n              if the modifier &quot;check_post&quot; is used, then an http post\n              request entity will be searched for the parameter argument,\n              when it is not found in a query string after a question mark\n              (&apos;?&apos;) in the url. the message body will only start to be\n              analyzed once either the advertised amount of data has been\n              received or the request buffer is full. in the unlikely event\n              that chunked encoding is used, only the first chunk is\n              scanned. parameter values separated by a chunk boundary, may\n              be randomly balanced if at all. this keyword used to support\n              an optional &lt;max_wait&gt; parameter which is now ignored.\n\n              if the parameter is found followed by an equal sign (&apos;=&apos;) and\n              a value, then the value is hashed and divided by the total\n              weight of the running servers. the result designates which\n              server will receive the request.\n\n              this is used to track user identifiers in requests and ensure\n              that a same user id will always be sent to the same server as\n              long as no server goes up or down. if no value is found or if\n              the parameter is not found, then a round robin algorithm is\n              applied. note that this algorithm may only be used in an http\n              backend. this algorithm is static by default, which means\n              that changing a server&apos;s weight on the fly will have no\n              effect, but this can be changed using &quot;hash-type&quot;.\n\n  hdr(&lt;name&gt;) the http header &lt;name&gt; will be looked up in each http\n              request. just as with the equivalent acl &apos;hdr()&apos; function,\n              the header name in parenthesis is not case sensitive. if the\n              header is absent or if it does not contain any value, the\n              roundrobin algorithm is applied instead.\n\n              an optional &apos;use_domain_only&apos; parameter is available, for\n              reducing the hash algorithm to the main domain part with some\n              specific headers such as &apos;host&apos;. for instance, in the host\n              value &quot;haproxy.1wt.eu&quot;, only &quot;1wt&quot; will be considered.\n\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n  rdp-cookie\n  rdp-cookie(&lt;name&gt;)\n              the rdp cookie &lt;name&gt; (or &quot;mstshash&quot; if omitted) will be\n              looked up and hashed for each incoming tcp request. just as\n              with the equivalent acl &apos;req_rdp_cookie()&apos; function, the name\n              is not case-sensitive. this mechanism is useful as a degraded\n              persistence mode, as it makes it possible to always send the\n              same user (or the same session id) to the same server. if the\n              cookie is not found, the normal roundrobin algorithm is\n              used instead.\n\n              note that for this to work, the frontend must ensure that an\n              rdp cookie is already present in the request buffer. for this\n              you must use &apos;tcp-request content accept&apos; rule combined with\n              a &apos;req_rdp_cookie_cnt&apos; acl.\n\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n              see also the rdp_cookie pattern fetch function.\n\n&lt;arguments&gt; is an optional list of arguments which may be needed by some\n            algorithms. right now, only &quot;url_param&quot; and &quot;uri&quot; support an\n            optional argument.\n</code></pre><p>  the load balancing algorithm of a backend is set to roundrobin when no other<br>  algorithm, mode nor option have been set. the algorithm may only be set once<br>  for each backend.</p>\n<p>  examples :<br>        balance roundrobin<br>        balance url_param userid<br>        balance url_param session_id check_post 64<br>        balance hdr(user-agent)<br>        balance hdr(host)<br>        balance hdr(host) use_domain_only</p>\n<p>  note: the following caveats and limitations on using the “check_post”<br>  extension with “url_param” must be considered :</p>\n<pre><code>- all post requests are eligible for consideration, because there is no way\n  to determine if the parameters will be found in the body or entity which\n  may contain binary data. therefore another method may be required to\n  restrict consideration of post requests that have no url parameters in\n  the body. (see acl reqideny http_end)\n\n- using a &lt;max_wait&gt; value larger than the request buffer size does not\n  make sense and is useless. the buffer size is set at build time, and\n  defaults to 16 kb.\n\n- content-encoding is not supported, the parameter search will probably\n  fail; and load balancing will fall back to round robin.\n\n- expect: 100-continue is not supported, load balancing will fall back to\n  round robin.\n\n- transfer-encoding (rfc2616 3.6.1) is only supported in the first chunk.\n  if the entire parameter value is not present in the first chunk, the\n  selection of server is undefined (actually, defined by how little\n  actually appeared in the first chunk).\n\n- this feature does not support generation of a 100, 411 or 501 response.\n\n- in some cases, requesting &quot;check_post&quot; may attempt to scan the entire\n  contents of a message body. scanning normally terminates when linear\n  white space or control characters are found, indicating the end of what\n  might be a url parameter list. this is probably not a concern with sgml\n  type message bodies.\n</code></pre><p>  see also : “dispatch”, “cookie”, “appsession”, “transparent”, “hash-type” and<br>             “http_proxy”.</p>\n<p>bind [<address>]:<port_range> [, …] [param<em>]<br>bind /<path></path> [, …] [param</em>]<br>  define one or several listening addresses and/or ports in a frontend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <address>     is optional and can be a host name, an ipv4 address, an ipv6<br>                  address, or ‘<em>‘. it designates the address the frontend will<br>                  listen on. if unset, all ipv4 addresses of the system will be<br>                  listened on. the same will apply for ‘</em>‘ or the system’s<br>                  special address “0.0.0.0”. the ipv6 equivalent is ‘::’.<br>                  optionally, an address family prefix may be used before the<br>                  address to force the family regardless of the address format,<br>                  which can be useful to specify a path to a unix socket with<br>                  no slash (‘/‘). currently supported prefixes are :</address></port_range></address></p>\n<pre><code>                - &apos;ipv4@&apos;  -&gt; address is always ipv4\n                - &apos;ipv6@&apos;  -&gt; address is always ipv6\n                - &apos;unix@&apos;  -&gt; address is a path to a local unix socket\n                - &apos;abns@&apos;  -&gt; address is in abstract namespace (linux only).\n                  note: since abstract sockets are not &quot;rebindable&quot;, they\n                        do not cope well with multi-process mode during\n                        soft-restart, so it is better to avoid them if\n                        nbproc is greater than 1\\. the effect is that if the\n                        new process fails to start, only one of the old ones\n                        will be able to rebind to the socket.\n                - &apos;fd@&lt;n&gt;&apos; -&gt; use file descriptor &lt;n&gt; inherited from the\n                  parent. the fd must be bound and may or may not already\n                  be listening.\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment\n              variables.\n\n&lt;port_range&gt;  is either a unique tcp port, or a port range for which the\n              proxy will accept connections for the ip address specified\n              above. the port is mandatory for tcp listeners. note that in\n              the case of an ipv6 address, the port is always the number\n              after the last colon (&apos;:&apos;). a range can either be :\n               - a numerical port (ex: &apos;80&apos;)\n               - a dash-delimited ports range explicitly stating the lower\n                 and upper bounds (ex: &apos;2000-2100&apos;) which are included in\n                 the range.\n\n              particular care must be taken against port ranges, because\n              every &lt;address:port&gt; couple consumes one socket (= a file\n              descriptor), so it&apos;s easy to consume lots of descriptors\n              with a simple range, and to run out of sockets. also, each\n              &lt;address:port&gt; couple must be used only once among all\n              instances running on a same system. please note that binding\n              to ports lower than 1024 generally require particular\n              privileges to start the program, which are independent of\n              the &apos;uid&apos; parameter.\n\n&lt;path&gt;        is a unix socket path beginning with a slash (&apos;/&apos;). this is\n              alternative to the tcp listening port. haproxy will then\n              receive unix connections on the socket located at this place.\n              the path must begin with a slash and by default is absolute.\n              it can be relative to the prefix defined by &quot;unix-bind&quot; in\n              the global section. note that the total length of the prefix\n              followed by the socket path cannot exceed some system limits\n              for unix sockets, which commonly are set to 107 characters.\n\n&lt;param*&gt;      is a list of parameters common to all sockets declared on the\n              same line. these numerous parameters depend on os and build\n              options and have a complete section dedicated to them. please\n              refer to section 5 to for more details.\n</code></pre><p>  it is possible to specify a list of address:port combinations delimited by<br>  commas. the frontend will then listen on all of these addresses. there is no<br>  fixed limit to the number of addresses and ports which can be listened on in<br>  a frontend, as well as there is no limit to the number of “bind” statements<br>  in a frontend.</p>\n<p>  example :<br>        listen http_proxy<br>            bind :80,:443<br>            bind 10.0.0.1:10080,10.0.0.1:10443<br>            bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy</p>\n<pre><code>listen http_https_proxy\n    bind :80\n    bind :443 ssl crt /etc/haproxy/site.pem\n\nlisten http_https_proxy_explicit\n    bind ipv6@:80\n    bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem\n    bind unix@ssl-frontend.sock user root mode 600 accept-proxy\n\nlisten external_bind_app1\n    bind &quot;fd@${fd_app1}&quot;\n</code></pre><p>  see also : “source”, “option forwardfor”, “unix-bind” and the proxy protocol<br>             documentation, and section 5 about bind options.</p>\n<p>bind-process [ all | odd | even | <number 1-64=\"\">[-<number 1-64=\"\">] ] …<br>  limit visibility of an instance to a certain set of processes numbers.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    all           all process will see this instance. this is the default. it<br>                  may be used to override a default value.</number></number></p>\n<pre><code>odd           this instance will be enabled on processes 1,3,5,...63\\. this\n              option may be combined with other numbers.\n\neven          this instance will be enabled on processes 2,4,6,...64\\. this\n              option may be combined with other numbers. do not use it\n              with less than 2 processes otherwise some instances might be\n              missing from all processes.\n\nnumber        the instance will be enabled on this process number or range,\n              whose values must all be between 1 and 32 or 64 depending on\n              the machine&apos;s word size. if a proxy is bound to process\n              numbers greater than the configured global.nbproc, it will\n              either be forced to process #1 if a single process was\n              specified, or to all processes otherwise.\n</code></pre><p>  this keyword limits binding of certain instances to certain processes. this<br>  is useful in order not to have too many processes listening to the same<br>  ports. for instance, on a dual-core machine, it might make sense to set<br>  ‘nbproc 2’ in the global section, then distributes the listeners among ‘odd’<br>  and ‘even’ instances.</p>\n<p>  at the moment, it is not possible to reference more than 32 or 64 processes<br>  using this keyword, but this should be more than enough for most setups.<br>  please note that ‘all’ really means all processes regardless of the machine’s<br>  word size, and is not limited to the first 32 or 64.</p>\n<p>  each “bind” line may further be limited to a subset of the proxy’s processes,<br>  please consult the “process” bind keyword in section 5.1.</p>\n<p>  when a frontend has no explicit “bind-process” line, it tries to bind to all<br>  the processes referenced by its “bind” lines. that means that frontends can<br>  easily adapt to their listeners’ processes.</p>\n<p>  if some backends are referenced by frontends bound to other processes, the<br>  backend automatically inherits the frontend’s processes.</p>\n<p>  example :<br>        listen app_ip1<br>            bind 10.0.0.1:80<br>            bind-process odd</p>\n<pre><code>listen app_ip2\n    bind 10.0.0.2:80\n    bind-process even\n\nlisten management\n    bind 10.0.0.3:80\n    bind-process 1 2 3 4\n\nlisten management\n    bind 10.0.0.4:80\n    bind-process 1-4\n</code></pre><p>  see also : “nbproc” in global section, and “process” in section 5.1.</p>\n<p>block { if | unless } <condition><br>  block a layer 7 request if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</condition></p>\n<p>  the http request will be blocked very early in the layer 7 processing<br>  if/unless <condition> is matched. a 403 error will be returned if the request<br>  is blocked. the condition has to reference acls (see section 7). this is<br>  typically used to deny access to certain sensitive resources if some<br>  conditions are met or not met. there is no fixed limit to the number of<br>  “block” statements per instance.</condition></p>\n<p>  example:<br>        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3<br>        acl invalid_src  src_port     0:1023<br>        acl local_dst    hdr(host) -i localhost<br>        block if invalid_src || local_dst</p>\n<p>  see section 7 about acl usage.</p>\n<p>capture cookie <name> len <length><br>  capture and log a cookie in the request and in the response.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the beginning of the name of the cookie to capture. in order<br>              to match the exact name, simply suffix the name with an equal<br>              sign (‘=’). the full name will appear in the logs, which is<br>              useful with application servers which adjust both the cookie name<br>              and value (eg: aspsessionxxxxx).</name></length></name></p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to report in the logs, which\n          include the cookie name, the equal sign and the value, all in the\n          standard &quot;name=value&quot; form. the string will be truncated on the\n          right if it exceeds &lt;length&gt;.\n</code></pre><p>  only the first cookie is captured. both the “cookie” request headers and the<br>  “set-cookie” response headers are monitored. this is particularly useful to<br>  check for application bugs causing session crossing or stealing between<br>  users, because generally the user’s cookies can only change on a login page.</p>\n<p>  when the cookie was not presented by the client, the associated log column<br>  will report “-“. when a request does not cause a cookie to be assigned by the<br>  server, a “-“ is reported in the response column.</p>\n<p>  the capture is performed in the frontend only because it is necessary that<br>  the log format does not change for a given frontend depending on the<br>  backends. this may change in the future. note that there can be only one<br>  “capture cookie” statement in a frontend. the maximum capture length is set<br>  by the global “tune.http.cookielen” setting and defaults to 63 characters. it<br>  is not possible to specify a capture in a “defaults” section.</p>\n<p>  example:<br>        capture cookie aspsession len 32</p>\n<p>  see also : “capture request header”, “capture response header” as well as<br>            section 8 about logging.</p>\n<p>capture request header <name> len <length><br>  capture and log the last occurrence of the specified request header.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the name of the header to capture. the header names are not<br>              case-sensitive, but it is a common practice to write them as they<br>              appear in the requests, with the first letter of each word in<br>              upper case. the header name will not appear in the logs, only the<br>              value is reported, but the position in the logs is respected.</name></length></name></p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to extract from the value and\n          report in the logs. the string will be truncated on the right if\n          it exceeds &lt;length&gt;.\n</code></pre><p>  the complete value of the last occurrence of the header is captured. the<br>  value will be added to the logs between braces (‘{}’). if multiple headers<br>  are captured, they will be delimited by a vertical bar (‘|’) and will appear<br>  in the same order they were declared in the configuration. non-existent<br>  headers will be logged just as an empty string. common uses for request<br>  header captures include the “host” field in virtual hosting environments, the<br>  “content-length” when uploads are supported, “user-agent” to quickly<br>  differentiate between real users and robots, and “x-forwarded-for” in proxied<br>  environments to find where the request came from.</p>\n<p>  note that when capturing headers such as “user-agent”, some spaces may be<br>  logged, making the log analysis more difficult. thus be careful about what<br>  you log if you know your log parser is not smart enough to rely on the<br>  braces.</p>\n<p>  there is no limit to the number of captured request headers nor to their<br>  length, though it is wise to keep them low to limit memory usage per session.<br>  in order to keep log format consistent for a same frontend, header captures<br>  can only be declared in a frontend. it is not possible to specify a capture<br>  in a “defaults” section.</p>\n<p>  example:<br>        capture request header host len 15<br>        capture request header x-forwarded-for len 15<br>        capture request header referrer len 15</p>\n<p>  see also : “capture cookie”, “capture response header” as well as section 8<br>             about logging.</p>\n<p>capture response header <name> len <length><br>  capture and log the last occurrence of the specified response header.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the name of the header to capture. the header names are not<br>              case-sensitive, but it is a common practice to write them as they<br>              appear in the response, with the first letter of each word in<br>              upper case. the header name will not appear in the logs, only the<br>              value is reported, but the position in the logs is respected.</name></length></name></p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to extract from the value and\n          report in the logs. the string will be truncated on the right if\n          it exceeds &lt;length&gt;.\n</code></pre><p>  the complete value of the last occurrence of the header is captured. the<br>  result will be added to the logs between braces (‘{}’) after the captured<br>  request headers. if multiple headers are captured, they will be delimited by<br>  a vertical bar (‘|’) and will appear in the same order they were declared in<br>  the configuration. non-existent headers will be logged just as an empty<br>  string. common uses for response header captures include the “content-length”<br>  header which indicates how many bytes are expected to be returned, the<br>  “location” header to track redirections.</p>\n<p>  there is no limit to the number of captured response headers nor to their<br>  length, though it is wise to keep them low to limit memory usage per session.<br>  in order to keep log format consistent for a same frontend, header captures<br>  can only be declared in a frontend. it is not possible to specify a capture<br>  in a “defaults” section.</p>\n<p>  example:<br>        capture response header content-length len 9<br>        capture response header location len 15</p>\n<p>  see also : “capture cookie”, “capture request header” as well as section 8<br>             about logging.</p>\n<p>clitimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the client side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value is specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase, when the client sends the request, and during the<br>  response while it is reading data sent by the server. the value is specified<br>  in milliseconds by default, but can be in any other unit if the number is<br>  suffixed by the unit, as specified at the top of this document. in tcp mode<br>  (and to a lesser extent, in http mode), it is highly recommended that the<br>  client timeout remains equal to the server timeout in order to avoid complex<br>  situations to debug. it is a good practice to cover one or several tcp packet<br>  losses by specifying timeouts that are slightly above multiples of 3 seconds<br>  (eg: 4 or 5 seconds).</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for compatibility but is currently deprecated.<br>  please use “timeout client” instead.</p>\n<p>  see also : “timeout client”, “timeout http-request”, “timeout server”, and<br>             “srvtimeout”.</p>\n<p>compression algo <algorithm> …<br>compression type <mime type=\"\"> …<br>compression offload<br>  enable http compression.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    algo     is followed by the list of supported compression algorithms.<br>    type     is followed by the list of mime types that will be compressed.<br>    offload  makes haproxy work as a compression offloader only (see notes).</mime></algorithm></p>\n<p>  the currently supported algorithms are :<br>    identity     this is mostly for debugging, and it was useful for developing<br>                 the compression feature. identity does not apply any change on<br>                 data.</p>\n<pre><code>gzip         applies gzip compression. this setting is only available when\n             support for zlib was built in.\n\ndeflate      same as &quot;gzip&quot;, but with deflate algorithm and zlib format.\n             note that this algorithm has ambiguous support on many\n             browsers and no support at all from recent ones. it is\n             strongly recommended not to use it for anything else than\n             experimentation. this setting is only available when support\n             for zlib was built in.\n\nraw-deflate  same as &quot;deflate&quot; without the zlib wrapper, and used as an\n             alternative when the browser wants &quot;deflate&quot;. all major\n             browsers understand it and despite violating the standards,\n             it is known to work better than &quot;deflate&quot;, at least on msie\n             and some versions of safari. do not use it in conjunction\n             with &quot;deflate&quot;, use either one or the other since both react\n             to the same accept-encoding token. this setting is only\n             available when support for zlib was built in.\n</code></pre><p>  compression will be activated depending on the accept-encoding request<br>  header. with identity, it does not take care of that header.<br>  if backend servers support http compression, these directives<br>  will be no-op: haproxy will see the compressed response and will not<br>  compress again. if backend servers do not support http compression and<br>  there is accept-encoding header in request, haproxy will compress the<br>  matching response.</p>\n<p>  the “offload” setting makes haproxy remove the accept-encoding header to<br>  prevent backend servers from compressing responses. it is strongly<br>  recommended not to do this because this means that all the compression work<br>  will be done on the single point where haproxy is located. however in some<br>  deployment scenarios, haproxy may be installed in front of a buggy gateway<br>  with broken http compression implementation which can’t be turned off.<br>  in that case haproxy can be used to prevent that gateway from emitting<br>  invalid payloads. in this case, simply removing the header in the<br>  configuration does not work because it applies before the header is parsed,<br>  so that prevents haproxy from compressing. the “offload” setting should<br>  then be used for such scenarios. note: for now, the “offload” setting is<br>  ignored when set in a defaults section.</p>\n<p>  compression is disabled when:</p>\n<pre><code>* the request does not advertise a supported compression algorithm in the\n  &quot;accept-encoding&quot; header\n* the response message is not http/1.1\n* http status code is not 200\n* response header &quot;transfer-encoding&quot; contains &quot;chunked&quot; (temporary\n  workaround)\n* response contain neither a &quot;content-length&quot; header nor a\n  &quot;transfer-encoding&quot; whose last value is &quot;chunked&quot;\n* response contains a &quot;content-type&quot; header whose first value starts with\n  &quot;multipart&quot;\n* the response contains the &quot;no-transform&quot; value in the &quot;cache-control&quot;\n  header\n* user-agent matches &quot;mozilla/4&quot; unless it is msie 6 with xp sp2, or msie 7\n  and later\n* the response contains a &quot;content-encoding&quot; header, indicating that the\n  response is already compressed (see compression offload)\n</code></pre><p>  note: the compression does not rewrite etag headers, and does not emit the<br>        warning header.</p>\n<p>  examples :<br>        compression algo gzip<br>        compression type text/html text/plain</p>\n<p>contimeout <timeout> (deprecated)<br>  set the maximum time to wait for a connection attempt to a server to succeed.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value is specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  if the server is located on the same lan as haproxy, the connection should be<br>  immediate (less than a few milliseconds). anyway, it is a good practice to<br>  cover one or several tcp packet losses by specifying timeouts that are<br>  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the<br>  connect timeout also presets the queue timeout to the same value if this one<br>  has not been specified. historically, the contimeout was also used to set the<br>  tarpit timeout in a listen section, which is not possible in a pure frontend.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of failed sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for backwards compatibility but is currently<br>  deprecated. please use “timeout connect”, “timeout queue” or “timeout tarpit”<br>  instead.</p>\n<p>  see also : “timeout connect”, “timeout queue”, “timeout tarpit”,<br>             “timeout server”, “contimeout”.</p>\n<p>cookie <name> [ rewrite | insert | prefix ] [ indirect ] [ nocache ]<br>              [ postonly ] [ preserve ] [ httponly ] [ secure ]<br>              [ domain <domain> ]* [ maxidle <idle> ] [ maxlife <life> ]<br>  enable cookie-based persistence in a backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the name of the cookie which will be monitored, modified or<br>              inserted in order to bring persistence. this cookie is sent to<br>              the client via a “set-cookie” header in the response, and is<br>              brought back by the client in a “cookie” header in all requests.<br>              special care should be taken to choose a name which does not<br>              conflict with any likely application cookie. also, if the same<br>              backends are subject to be used by the same clients (eg:<br>              http/https), care should be taken to use different cookie names<br>              between all backends if persistence between them is not desired.</name></life></idle></domain></name></p>\n<pre><code>rewrite   this keyword indicates that the cookie will be provided by the\n          server and that haproxy will have to modify its value to set the\n          server&apos;s identifier in it. this mode is handy when the management\n          of complex combinations of &quot;set-cookie&quot; and &quot;cache-control&quot;\n          headers is left to the application. the application can then\n          decide whether or not it is appropriate to emit a persistence\n          cookie. since all responses should be monitored, this mode only\n          works in http close mode. unless the application behaviour is\n          very complex and/or broken, it is advised not to start with this\n          mode for new deployments. this keyword is incompatible with\n          &quot;insert&quot; and &quot;prefix&quot;.\n\ninsert    this keyword indicates that the persistence cookie will have to\n          be inserted by haproxy in server responses if the client did not\n\n          already have a cookie that would have permitted it to access this\n          server. when used without the &quot;preserve&quot; option, if the server\n          emits a cookie with the same name, it will be remove before\n          processing.  for this reason, this mode can be used to upgrade\n          existing configurations running in the &quot;rewrite&quot; mode. the cookie\n          will only be a session cookie and will not be stored on the\n          client&apos;s disk. by default, unless the &quot;indirect&quot; option is added,\n          the server will see the cookies emitted by the client. due to\n          caching effects, it is generally wise to add the &quot;nocache&quot; or\n          &quot;postonly&quot; keywords (see below). the &quot;insert&quot; keyword is not\n          compatible with &quot;rewrite&quot; and &quot;prefix&quot;.\n\nprefix    this keyword indicates that instead of relying on a dedicated\n          cookie for the persistence, an existing one will be completed.\n          this may be needed in some specific environments where the client\n          does not support more than one single cookie and the application\n          already needs it. in this case, whenever the server sets a cookie\n          named &lt;name&gt;, it will be prefixed with the server&apos;s identifier\n          and a delimiter. the prefix will be removed from all client\n          requests so that the server still finds the cookie it emitted.\n          since all requests and responses are subject to being modified,\n          this mode requires the http close mode. the &quot;prefix&quot; keyword is\n          not compatible with &quot;rewrite&quot; and &quot;insert&quot;. note: it is highly\n          recommended not to use &quot;indirect&quot; with &quot;prefix&quot;, otherwise server\n          cookie updates would not be sent to clients.\n\nindirect  when this option is specified, no cookie will be emitted to a\n          client which already has a valid one for the server which has\n          processed the request. if the server sets such a cookie itself,\n          it will be removed, unless the &quot;preserve&quot; option is also set. in\n          &quot;insert&quot; mode, this will additionally remove cookies from the\n          requests transmitted to the server, making the persistence\n          mechanism totally transparent from an application point of view.\n          note: it is highly recommended not to use &quot;indirect&quot; with\n          &quot;prefix&quot;, otherwise server cookie updates would not be sent to\n          clients.\n\nnocache   this option is recommended in conjunction with the insert mode\n          when there is a cache between the client and haproxy, as it\n          ensures that a cacheable response will be tagged non-cacheable if\n          a cookie needs to be inserted. this is important because if all\n          persistence cookies are added on a cacheable home page for\n          instance, then all customers will then fetch the page from an\n          outer cache and will all share the same persistence cookie,\n          leading to one server receiving much more traffic than others.\n          see also the &quot;insert&quot; and &quot;postonly&quot; options.\n\npostonly  this option ensures that cookie insertion will only be performed\n          on responses to post requests. it is an alternative to the\n          &quot;nocache&quot; option, because post responses are not cacheable, so\n          this ensures that the persistence cookie will never get cached.\n          since most sites do not need any sort of persistence before the\n          first post which generally is a login request, this is a very\n          efficient method to optimize caching without risking to find a\n          persistence cookie in the cache.\n          see also the &quot;insert&quot; and &quot;nocache&quot; options.\n\npreserve  this option may only be used with &quot;insert&quot; and/or &quot;indirect&quot;. it\n          allows the server to emit the persistence cookie itself. in this\n          case, if a cookie is found in the response, haproxy will leave it\n          untouched. this is useful in order to end persistence after a\n          logout request for instance. for this, the server just has to\n          emit a cookie with an invalid value (eg: empty) or with a date in\n          the past. by combining this mechanism with the &quot;disable-on-404&quot;\n          check option, it is possible to perform a completely graceful\n          shutdown because users will definitely leave the server after\n          they logout.\n\nhttponly  this option tells haproxy to add an &quot;httponly&quot; cookie attribute\n          when a cookie is inserted. this attribute is used so that a\n          user agent doesn&apos;t share the cookie with non-http components.\n          please check rfc6265 for more information on this attribute.\n\nsecure    this option tells haproxy to add a &quot;secure&quot; cookie attribute when\n          a cookie is inserted. this attribute is used so that a user agent\n          never emits this cookie over non-secure channels, which means\n          that a cookie learned with this flag will be presented only over\n          ssl/tls connections. please check rfc6265 for more information on\n          this attribute.\n\ndomain    this option allows to specify the domain at which a cookie is\n          inserted. it requires exactly one parameter: a valid domain\n          name. if the domain begins with a dot, the browser is allowed to\n          use it for any host ending with that name. it is also possible to\n          specify several domain names by invoking this option multiple\n          times. some browsers might have small limits on the number of\n          domains, so be careful when doing that. for the record, sending\n          10 domains to msie 6 or firefox 2 works as expected.\n\nmaxidle   this option allows inserted cookies to be ignored after some idle\n          time. it only works with insert-mode cookies. when a cookie is\n          sent to the client, the date this cookie was emitted is sent too.\n          upon further presentations of this cookie, if the date is older\n          than the delay indicated by the parameter (in seconds), it will\n          be ignored. otherwise, it will be refreshed if needed when the\n          response is sent to the client. this is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (eg: after a farm size change). when\n          this option is set and a cookie has no date, it is always\n          accepted, but gets refreshed in the response. this maintains the\n          ability for admins to access their sites. cookies that have a\n          date in the future further than 24 hours are ignored. doing so\n          lets admins fix timezone issues without risking kicking users off\n          the site.\n\nmaxlife   this option allows inserted cookies to be ignored after some life\n          time, whether they&apos;re in use or not. it only works with insert\n          mode cookies. when a cookie is first sent to the client, the date\n          this cookie was emitted is sent too. upon further presentations\n          of this cookie, if the date is older than the delay indicated by\n          the parameter (in seconds), it will be ignored. if the cookie in\n          the request has no date, it is accepted and a date will be set.\n          cookies that have a date in the future further than 24 hours are\n          ignored. doing so lets admins fix timezone issues without risking\n          kicking users off the site. contrary to maxidle, this value is\n          not refreshed, only the first visit date counts. both maxidle and\n          maxlife may be used at the time. this is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (eg: after a farm size change). this\n          is stronger than the maxidle method in that it forces a\n          redispatch after some absolute delay.\n</code></pre><p>  there can be only one persistence cookie per http backend, and it can be<br>  declared in a defaults section. the value of the cookie will be the value<br>  indicated after the “cookie” keyword in a “server” statement. if no cookie<br>  is declared for a given server, the cookie is not set.</p>\n<p>  examples :<br>        cookie jsessionid prefix<br>        cookie srv insert indirect nocache<br>        cookie srv insert postonly indirect<br>        cookie srv insert indirect nocache maxidle 30m maxlife 8h</p>\n<p>  see also : “appsession”, “balance source”, “capture cookie”, “server”<br>             and “ignore-persist”.</p>\n<p>declare capture [ request | response ] len <length><br>  declares a capture slot.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments:<br>    <length> is the length allowed for the capture.</length></length></p>\n<p>  this declaration is only available in the frontend or listen section, but the<br>  reserved slot can be used in the backends. the “request” keyword allocates a<br>  capture slot for use in the request, and “response” allocates a capture slot<br>  for use in the response.</p>\n<p>  see also: “capture-req”, “capture-res” (sample converters),<br>            “http-request capture” and “http-response capture”.</p>\n<p>default-server [param<em>]<br>  change default options for a server in a backend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments:<br>    &lt;param</em>&gt;  is a list of parameters for this server. the “default-server”<br>              keyword accepts an important number of options and has a complete<br>              section dedicated to it. please refer to section 5 for more<br>              details.</p>\n<p>  example :<br>        default-server inter 1000 weight 13</p>\n<p>  see also: “server” and section 5 about server options</p>\n<p>default_backend <backend><br>  specify the backend to use when no “use_backend” rule has been matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <backend> is the name of the backend to use.</backend></backend></p>\n<p>  when doing content-switching between frontend and backends using the<br>  “use_backend” keyword, it is often useful to indicate which backend will be<br>  used when no rule has matched. it generally is the dynamic backend which<br>  will catch all undetermined requests.</p>\n<p>  example :</p>\n<pre><code>use_backend     dynamic  if  url_dyn\nuse_backend     static   if  url_css url_img extension_img\ndefault_backend dynamic\n</code></pre><p>  see also : “use_backend”</p>\n<p>description <string><br>  describe a listen, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments : string</string></p>\n<p>  allows to add a sentence to describe the related object in the haproxy html<br>  stats page. the description will be printed on the right of the object name<br>  it describes.<br>  no need to backslash spaces in the <string> arguments.</string></p>\n<p>disabled<br>  disable a proxy, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  the “disabled” keyword is used to disable an instance, mainly in order to<br>  liberate a listening port or to temporarily disable a service. the instance<br>  will still be created and its configuration will be checked, but it will be<br>  created in the “stopped” state and will appear as such in the statistics. it<br>  will not receive any traffic nor will it send any health-checks or logs. it<br>  is possible to disable many instances at once by adding the “disabled”<br>  keyword in a “defaults” section.</p>\n<p>  see also : “enabled”</p>\n<p>dispatch <address>:<port><br>  set a default server address<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :</port></address></p>\n<pre><code>&lt;address&gt; is the ipv4 address of the default server. alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up.\n\n&lt;ports&gt;   is a mandatory port specification. all connections will be sent\n          to this port, and it is not permitted to use port offsets as is\n          possible with normal servers.\n</code></pre><p>  the “dispatch” keyword designates a default server for use when no other<br>  server can take the connection. in the past it was used to forward non<br>  persistent connections to an auxiliary load balancer. due to its simple<br>  syntax, it has also been used for simple tcp relays. it is recommended not to<br>  use it for more clarity, and to use the “server” directive instead.</p>\n<p>  see also : “server”</p>\n<p>enabled<br>  enable a proxy, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  the “enabled” keyword is used to explicitly enable an instance, when the<br>  defaults has been set to “disabled”. this is very rarely used.</p>\n<p>  see also : “disabled”</p>\n<p>errorfile <code> <file><br>  return a file contents instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 200, 400, 403, 405, 408, 429, 500, 502, 503, and<br>              504.</code></file></code></p>\n<pre><code>&lt;file&gt;    designates a file containing the full http response. it is\n          recommended to follow the common practice of appending &quot;.http&quot; to\n          the filename so that people do not confuse the response with html\n          error pages, and to use absolute paths, since files are read\n          before any chroot is performed.\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  the files are returned verbatim on the tcp socket. this allows any trick such<br>  as redirections to another url or site, as well as tricks to clean cookies,<br>  force enable or disable caching, etc… the package provides default error<br>  files returning the same contents as default errors.</p>\n<p>  the files should not exceed the configured buffer size (bufsize), which<br>  generally is 8 or 16 kb, otherwise they will be truncated. it is also wise<br>  not to put any reference to local contents (eg: images) in order to avoid<br>  loops between the client and haproxy when all servers are down, causing an<br>  error to be returned instead of an image. for better http compliance, it is<br>  recommended that all header lines end with cr-lf and not lf alone.</p>\n<p>  the files are read at the same time as the configuration and kept in memory.<br>  for this reason, the errors continue to be returned even when the process is<br>  chrooted, and no file change is considered while the process is running. a<br>  simple method for developing those files consists in associating them to the<br>  403 status code and interrogating a blocked url.</p>\n<p>  see also : “errorloc”, “errorloc302”, “errorloc303”</p>\n<p>  example :<br>        errorfile 400 /etc/haproxy/errorfiles/400badreq.http<br>        errorfile 408 /dev/null  # workaround chrome pre-connect bug<br>        errorfile 403 /etc/haproxy/errorfiles/403forbid.http<br>        errorfile 503 /etc/haproxy/errorfiles/503sorry.http</p>\n<p>errorloc <code> <url><br>errorloc302 <code> <url><br>  return an http redirection to a url instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 200, 400, 403, 408, 500, 502, 503, and 504.</code></url></code></url></code></p>\n<pre><code>&lt;url&gt;     it is the exact contents of the &quot;location&quot; header. it may contain\n          either a relative uri to an error page hosted on the same site,\n          or an absolute uri designating an error page on another site.\n          special care should be given to relative uris to avoid redirect\n          loops if the uri itself may generate the same error (eg: 500).\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  note that both keyword return the http 302 status code, which tells the<br>  client to fetch the designated url using the same http method. this can be<br>  quite problematic in case of non-get methods such as post, because the url<br>  sent to the client might not be allowed for something other than get. to<br>  workaround this problem, please use “errorloc303” which send the http 303<br>  status code, indicating to the client that the url must be fetched with a get<br>  request.</p>\n<p>  see also : “errorfile”, “errorloc303”</p>\n<p>errorloc303 <code> <url><br>  return an http redirection to a url instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 400, 403, 408, 500, 502, 503, and 504.</code></url></code></p>\n<pre><code>&lt;url&gt;     it is the exact contents of the &quot;location&quot; header. it may contain\n          either a relative uri to an error page hosted on the same site,\n          or an absolute uri designating an error page on another site.\n          special care should be given to relative uris to avoid redirect\n          loops if the uri itself may generate the same error (eg: 500).\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  note that both keyword return the http 303 status code, which tells the<br>  client to fetch the designated url using the same http get method. this<br>  solves the usual problems associated with “errorloc” and the 302 code. it is<br>  possible that some very old browsers designed before http/1.1 do not support<br>  it, but no such problem has been reported till now.</p>\n<p>  see also : “errorfile”, “errorloc”, “errorloc302”</p>\n<p>email-alert from <emailaddr><br>  declare the from email address to be used in both the envelope and header<br>  of email alerts.  this is the address that email alerts are sent from.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</emailaddr></p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the from email address to use when sending email alerts\n</code></pre><p>  also requires “email-alert mailers” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert level”, “email-alert mailers”,<br>             “email-alert myhostname”, “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert level <level><br>  declare the maximum log level of messages for which email alerts will be<br>  sent. this acts as a filter on the sending of email alerts.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</level></p>\n<p>  arguments :</p>\n<pre><code>&lt;level&gt; one of the 8 syslog levels:\n          emerg alert crit err warning notice info  debug\n        the above syslog levels are ordered from lowest to highest.\n</code></pre><p>  by default level is alert</p>\n<p>  also requires “email-alert from”, “email-alert mailers” and<br>  “email-alert to” to be set and if so sending email alerts is enabled<br>  for the proxy.</p>\n<p>  alerts are sent when :</p>\n<ul>\n<li>an un-paused server is marked as down and <level> is alert or lower</level></li>\n<li>a paused server is marked as down and <level> is notice or lower</level></li>\n<li>a server is marked as up or enters the drain state and <level><br>is notice or lower</level></li>\n<li><p>“option log-health-checks” is enabled, <level> is info or lower,<br> and a health check status update occurs</level></p>\n<p>see also : “email-alert from”, “email-alert mailers”,</p>\n<pre><code>&quot;email-alert myhostname&quot;, &quot;email-alert to&quot;,\nsection 3.6 about mailers.\n</code></pre></li>\n</ul>\n<p>email-alert mailers <mailersect><br>  declare the mailers to be used when sending email alerts<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</mailersect></p>\n<p>  arguments :</p>\n<pre><code>&lt;mailersect&gt; is the name of the mailers section to send email alerts.\n</code></pre><p>  also requires “email-alert from” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert myhostname”,<br>             “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert myhostname <hostname><br>  declare the to hostname address to be used when communicating with<br>  mailers.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</hostname></p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the to email address to use when sending email alerts\n</code></pre><p>  by default the systems hostname is used.</p>\n<p>  also requires “email-alert from”, “email-alert mailers” and<br>  “email-alert to” to be set and if so sending email alerts is enabled<br>  for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert mailers”,<br>             “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert to <emailaddr><br>  declare both the recipent address in the envelope and to address in the<br>  header of email alerts. this is the address that email alerts are sent to.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</emailaddr></p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the to email address to use when sending email alerts\n</code></pre><p>  also requires “email-alert mailers” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert mailers”,<br>             “email-alert myhostname”, section 3.6 about mailers.</p>\n<p>force-persist { if | unless } <condition><br>  declare a condition to force persistence on down servers<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes</condition></p>\n<p>  by default, requests are not dispatched to down servers. it is possible to<br>  force this using “option persist”, but it is unconditional and redispatches<br>  to a valid server if “option redispatch” is set. that leaves with very little<br>  possibilities to force some requests to reach a server which is artificially<br>  marked down for maintenance operations.</p>\n<p>  the “force-persist” statement allows one to declare various acl-based<br>  conditions which, when met, will cause a request to ignore the down status of<br>  a server and still try to connect to it. that makes it possible to start a<br>  server, still replying an error to the health checks, and run a specially<br>  configured browser to test the service. among the handy methods, one could<br>  use a specific source ip address, or a specific cookie. the cookie also has<br>  the advantage that it can easily be added/removed on the browser from a test<br>  page. once the service is validated, it is then possible to open the service<br>  to the world by returning a valid response to health checks.</p>\n<p>  the forced persistence is enabled when an “if” condition is met, or unless an<br>  “unless” condition is met. the final redispatch is always disabled when this<br>  is used.</p>\n<p>  see also : “option redispatch”, “ignore-persist”, “persist”,<br>             and section 7 about acl usage.</p>\n<p>fullconn <conns><br>  specify at what backend load the servers will reach their maxconn<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <conns>   is the number of connections on the backend which will make the<br>              servers use the maximal number of connections.</conns></conns></p>\n<p>  when a server has a “maxconn” parameter specified, it means that its number<br>  of concurrent connections will never go higher. additionally, if it has a<br>  “minconn” parameter, it indicates a dynamic limit following the backend’s<br>  load. the server will then always accept at least <minconn> connections,<br>  never more than <maxconn>, and the limit will be on the ramp between both<br>  values when the backend has less than <conns> concurrent connections. this<br>  makes it possible to limit the load on the servers during normal loads, but<br>  push it further for important loads without overloading the servers during<br>  exceptional loads.</conns></maxconn></minconn></p>\n<p>  since it’s hard to get this value right, haproxy automatically sets it to<br>  10% of the sum of the maxconns of all frontends that may branch to this<br>  backend (based on “use_backend” and “default_backend” rules). that way it’s<br>  safe to leave it unset. however, “use_backend” involving dynamic names are<br>  not counted since there is no way to know if they could match or not.</p>\n<p>  example :</p>\n<pre><code># the servers will accept between 100 and 1000 concurrent connections each\n# and the maximum of 1000 will be reached when the backend reaches 10000\n# connections.\nbackend dynamic\n   fullconn   10000\n   server     srv1   dyn1:80 minconn 100 maxconn 1000\n   server     srv2   dyn2:80 minconn 100 maxconn 1000\n</code></pre><p>  see also : “maxconn”, “server”</p>\n<p>grace <time><br>  maintain a proxy operational for some time after a soft stop<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <time>    is the time (by default in milliseconds) for which the instance<br>              will remain operational with the frontend sockets still listening<br>              when a soft-stop is received via the sigusr1 signal.</time></time></p>\n<p>  this may be used to ensure that the services disappear in a certain order.<br>  this was designed so that frontends which are dedicated to monitoring by an<br>  external equipment fail immediately while other ones remain up for the time<br>  needed by the equipment to detect the failure.</p>\n<p>  note that currently, there is very little benefit in using this parameter,<br>  and it may in fact complicate the soft-reconfiguration process more than<br>  simplify it.</p>\n<p>hash-type <method> <function> <modifier><br>  specify a method to use for mapping hashes to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <method> is the method used to select a server from the hash computed by<br>             the <function> :</function></method></modifier></function></method></p>\n<pre><code>  map-based   the hash table is a static array containing all alive servers.\n              the hashes will be very smooth, will consider weights, but\n              will be static in that weight changes while a server is up\n              will be ignored. this means that there will be no slow start.\n              also, since a server is selected by its position in the array,\n              most mappings are changed when the server count changes. this\n              means that when a server goes up or down, or when a server is\n              added to a farm, most connections will be redistributed to\n              different servers. this can be inconvenient with caches for\n              instance.\n\n  consistent  the hash table is a tree filled with many occurrences of each\n              server. the hash key is looked up in the tree and the closest\n              server is chosen. this hash is dynamic, it supports changing\n              weights while the servers are up, so it is compatible with the\n              slow start feature. it has the advantage that when a server\n              goes up or down, only its associations are moved. when a\n              server is added to the farm, only a few part of the mappings\n              are redistributed, making it an ideal method for caches.\n              however, due to its principle, the distribution will never be\n              very smooth and it may sometimes be necessary to adjust a\n              server&apos;s weight or its id to get a more balanced distribution.\n              in order to get the same distribution on multiple load\n              balancers, it is important that all servers have the exact\n              same ids. note: consistent hash uses sdbm and avalanche if no\n              hash function is specified.\n\n&lt;function&gt; is the hash function to be used :\n\n   sdbm   this function was created initially for sdbm (a public-domain\n          reimplementation of ndbm) database library. it was found to do\n          well in scrambling bits, causing better distribution of the keys\n          and fewer splits. it also happens to be a good general hashing\n          function with good distribution, unless the total server weight\n          is a multiple of 64, in which case applying the avalanche\n          modifier may help.\n\n   djb2   this function was first proposed by dan bernstein many years ago\n          on comp.lang.c. studies have shown that for certain workload this\n          function provides a better distribution than sdbm. it generally\n          works well with text-based inputs though it can perform extremely\n          poorly with numeric-only input or when the total server weight is\n          a multiple of 33, unless the avalanche modifier is also used.\n\n   wt6    this function was designed for haproxy while testing other\n          functions in the past. it is not as smooth as the other ones, but\n          is much less sensible to the input data set or to the number of\n          servers. it can make sense as an alternative to sdbm+avalanche or\n          djb2+avalanche for consistent hashing or when hashing on numeric\n          data such as a source ip address or a visitor identifier in a url\n          parameter.\n\n   crc32  this is the most common crc32 implementation as used in ethernet,\n          gzip, png, etc. it is slower than the other ones but may provide\n          a better distribution or less predictable results especially when\n          used on strings.\n\n&lt;modifier&gt; indicates an optional method applied after hashing the key :\n\n   avalanche   this directive indicates that the result from the hash\n               function above should not be used in its raw form but that\n               a 4-byte full avalanche hash must be applied first. the\n               purpose of this step is to mix the resulting bits from the\n               previous hash in order to avoid any undesired effect when\n               the input contains some limited values or when the number of\n               servers is a multiple of one of the hash&apos;s components (64\n               for sdbm, 33 for djb2). enabling avalanche tends to make the\n               result less predictable, but it&apos;s also not as smooth as when\n               using the original function. some testing might be needed\n               with some workloads. this hash is one of the many proposed\n               by bob jenkins.\n</code></pre><p>  the default hash type is “map-based” and is recommended for most usages. the<br>  default function is “sdbm”, the selection of a function should be based on<br>  the range of the values being hashed.</p>\n<p>  see also : “balance”, “server”</p>\n<p>http-check disable-on-404<br>  enable a maintenance mode upon http/404 response to health-checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is set, a server which returns an http code 404 will be<br>  excluded from further load-balancing, but will still receive persistent<br>  connections. this provides a very convenient method for web administrators<br>  to perform a graceful shutdown of their servers. it is also important to note<br>  that a server which is detected as failed while it was in this mode will not<br>  generate an alert, just a notice. if the server responds 2xx or 3xx again, it<br>  will immediately be reinserted into the farm. the status on the stats page<br>  reports “nolb” for a server in this mode. it is important to note that this<br>  option only works in conjunction with the “httpchk” option. if this option<br>  is used with “http-check expect”, then it has precedence over it so that 404<br>  responses will still be considered as soft-stop.</p>\n<p>  see also : “option httpchk”, “http-check expect”</p>\n<p>http-check expect [!] <match> <pattern><br>  make http health checks consider response contents or specific status codes<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <match>   is a keyword indicating how to look for a specific pattern in the<br>              response. the keyword may be one of “status”, “rstatus”,<br>              “string”, or “rstring”. the keyword may be preceded by an<br>              exclamation mark (“!”) to negate the match. spaces are allowed<br>              between the exclamation mark and the keyword. see below for more<br>              details on the supported keywords.</match></pattern></match></p>\n<pre><code>&lt;pattern&gt; is the pattern to look for. it may be a string or a regular\n          expression. if the pattern contains spaces, they must be escaped\n          with the usual backslash (&apos;\\&apos;).\n</code></pre><p>  by default, “option httpchk” considers that response statuses 2xx and 3xx<br>  are valid, and that others are invalid. when “http-check expect” is used,<br>  it defines what is considered valid or invalid. only one “http-check”<br>  statement is supported in a backend. if a server fails to respond or times<br>  out, the check obviously fails. the available matches are :</p>\n<pre><code>status &lt;string&gt; : test the exact string match for the http status code.\n                  a health check response will be considered valid if the\n                  response&apos;s status code is exactly this string. if the\n                  &quot;status&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the status code matches.\n\nrstatus &lt;regex&gt; : test a regular expression for the http status code.\n                  a health check response will be considered valid if the\n                  response&apos;s status code matches the expression. if the\n                  &quot;rstatus&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the status code matches.\n                  this is mostly used to check for multiple codes.\n\nstring &lt;string&gt; : test the exact string match in the http response body.\n                  a health check response will be considered valid if the\n                  response&apos;s body contains this exact string. if the\n                  &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body contains this\n                  string. this can be used to look for a mandatory word at\n                  the end of a dynamic page, or to detect a failure when a\n                  specific error appears on the check page (eg: a stack\n                  trace).\n\nrstring &lt;regex&gt; : test a regular expression on the http response body.\n                  a health check response will be considered valid if the\n                  response&apos;s body matches this expression. if the &quot;rstring&quot;\n                  keyword is prefixed with &quot;!&quot;, then the response will be\n                  considered invalid if the body matches the expression.\n                  this can be used to look for a mandatory word at the end\n                  of a dynamic page, or to detect a failure when a specific\n                  error appears on the check page (eg: a stack trace).\n</code></pre><p>  it is important to note that the responses will be limited to a certain size<br>  defined by the global “tune.chksize” option, which defaults to 16384 bytes.<br>  thus, too large responses may not contain the mandatory pattern when using<br>  “string” or “rstring”. if a large response is absolutely required, it is<br>  possible to change the default max size by setting the global variable.<br>  however, it is worth keeping in mind that parsing very large responses can<br>  waste some cpu cycles, especially when regular expressions are used, and that<br>  it is always better to focus the checks on smaller resources.</p>\n<p>  also “http-check expect” doesn’t support http keep-alive. keep in mind that it<br>  will automatically append a “connection: close” header, meaning that this<br>  header should not be present in the request provided by “option httpchk”.</p>\n<p>  last, if “http-check expect” is combined with “http-check disable-on-404”,<br>  then this last one has precedence when the server responds with 404.</p>\n<p>  examples :</p>\n<pre><code># only accept status 200 as valid\nhttp-check expect status 200\n\n# consider sql errors as errors\nhttp-check expect ! string sql\\ error\n\n# consider status 5xx only as errors\nhttp-check expect ! rstatus ^5\n\n# check that we have a correct hexadecimal tag before /html\nhttp-check expect rstring &lt;!--tag:[0-9a-f]*&lt;/html&gt;\n</code></pre><p>  see also : “option httpchk”, “http-check disable-on-404”</p>\n<p>http-check send-state<br>  enable emission of a state header with http health checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is set, haproxy will systematically send a special header<br>  “x-haproxy-server-state” with a list of parameters indicating to each server<br>  how they are seen by haproxy. this can be used for instance when a server is<br>  manipulated without access to haproxy and the operator needs to know whether<br>  haproxy still sees it up or not, or if the server is the last one in a farm.</p>\n<p>  the header is composed of fields delimited by semi-colons, the first of which<br>  is a word (“up”, “down”, “nolb”), possibly followed by a number of valid<br>  checks on the total number before transition, just as appears in the stats<br>  interface. next headers are in the form “<variable>=<value>“, indicating in<br>  no specific order some values available in the stats interface :</value></variable></p>\n<pre><code>- a variable &quot;address&quot;, containing the address of the backend server.\n  this corresponds to the &lt;address&gt; field in the server declaration. for\n  unix domain sockets, it will read &quot;unix&quot;.\n\n- a variable &quot;port&quot;, containing the port of the backend server. this\n  corresponds to the &lt;port&gt; field in the server declaration. for unix\n  domain sockets, it will read &quot;unix&quot;.\n\n- a variable &quot;name&quot;, containing the name of the backend followed by a slash\n  (&quot;/&quot;) then the name of the server. this can be used when a server is\n  checked in multiple backends.\n\n- a variable &quot;node&quot; containing the name of the haproxy node, as set in the\n  global &quot;node&quot; variable, otherwise the system&apos;s hostname if unspecified.\n\n- a variable &quot;weight&quot; indicating the weight of the server, a slash (&quot;/&quot;)\n  and the total weight of the farm (just counting usable servers). this\n  helps to know if other servers are available to handle the load when this\n  one fails.\n\n- a variable &quot;scur&quot; indicating the current number of concurrent connections\n  on the server, followed by a slash (&quot;/&quot;) then the total number of\n  connections on all servers of the same backend.\n\n- a variable &quot;qcur&quot; indicating the current number of requests in the\n  server&apos;s queue.\n</code></pre><p>  example of a header received by the application server :</p>\n<pre><code>&gt;&gt;&gt;  x-haproxy-server-state: up 2/3; name=bck/srv2; node=lb1; weight=1/2; \\\n       scur=13/22; qcur=0\n</code></pre><p>  see also : “option httpchk”, “http-check disable-on-404”</p>\n<p>http-request { allow | deny | tarpit | auth [realm <realm>] | redirect <rule> |<br>              add-header <name> <fmt> | set-header <name> <fmt> |<br>              capture <sample> [ len <length> | id <id> ] |<br>              del-header <name> | set-nice <nice> | set-log-level <level> |<br>              replace-header <name> <match-regex> <replace-fmt> |<br>              replace-value <name> <match-regex> <replace-fmt> |<br>              set-method <fmt> | set-path <fmt> | set-query <fmt> |<br>              set-uri <fmt> | set-tos <tos> | set-mark <mark> |<br>              add-acl(<file name=\"\">) <key fmt=\"\"> |<br>              del-acl(<file name=\"\">) <key fmt=\"\"> |<br>              del-map(<file name=\"\">) <key fmt=\"\"> |<br>              set-map(<file name=\"\">) <key fmt=\"\"> <value fmt=\"\"> |<br>              set-var(<var name=\"\">) <expr> |<br>              { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] |<br>              lua <function name=\"\"><br>             }<br>             [ { if | unless } <condition> ]<br>  access control for layer 7 requests</condition></function></table></key></expr></var></value></key></file></key></file></key></file></key></file></mark></tos></fmt></fmt></fmt></fmt></replace-fmt></match-regex></name></replace-fmt></match-regex></name></level></nice></name></id></length></sample></fmt></name></fmt></name></rule></realm></p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    yes   |   yes  |   yes</p>\n<p>  the http-request statement defines a set of rules which apply to layer 7<br>  processing. the rules are evaluated in their declaration order when they are<br>  met in a frontend, listen or backend section. any rule may optionally be<br>  followed by an acl-based condition, in which case it will only be evaluated<br>  if the condition is true.</p>\n<p>  the first keyword is the rule’s action. currently supported actions include :</p>\n<pre><code>- &quot;allow&quot; : this stops the evaluation of the rules and lets the request\n  pass the check. no further &quot;http-request&quot; rules are evaluated.\n\n- &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects\n  the request and emits an http 403 error. no further &quot;http-request&quot; rules\n  are evaluated.\n\n- &quot;tarpit&quot; : this stops the evaluation of the rules and immediately blocks\n  the request without responding for a delay specified by &quot;timeout tarpit&quot;\n  or &quot;timeout connect&quot; if the former is not set. after that delay, if the\n  client is still connected, an http error 500 is returned so that the\n  client does not suspect it has been tarpitted. logs will report the flags\n  &quot;pt&quot;. the goal of the tarpit rule is to slow down robots during an attack\n  when they&apos;re limited on the number of concurrent requests. it can be very\n  efficient against very dumb robots, and will significantly reduce the\n  load on firewalls compared to a &quot;deny&quot; rule. but when facing &quot;correctly&quot;\n  developed robots, it can make things worse by forcing haproxy and the\n  front firewall to support insane number of concurrent connections.\n\n- &quot;auth&quot; : this stops the evaluation of the rules and immediately responds\n  with an http 401 or 407 error code to invite the user to present a valid\n  user name and password. no further &quot;http-request&quot; rules are evaluated. an\n  optional &quot;realm&quot; parameter is supported, it sets the authentication realm\n  that is returned with the response (typically the application&apos;s name).\n\n- &quot;redirect&quot; : this performs an http redirection based on a redirect rule.\n  this is exactly the same as the &quot;redirect&quot; statement except that it\n  inserts a redirect rule which can be processed in the middle of other\n  &quot;http-request&quot; rules and that these rules use the &quot;log-format&quot; strings.\n  see the &quot;redirect&quot; keyword for the rule&apos;s syntax.\n\n- &quot;add-header&quot; appends an http header field whose name is specified in\n  &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format\n  rules (see custom log format in section 8.2.4). this is particularly\n  useful to pass connection-specific information to the server (eg: the\n  client&apos;s ssl certificate), or to combine several headers into one. this\n  rule is not final, so it is possible to add other similar rules. note\n  that header addition is performed immediately, so one rule might reuse\n  the resulting header from a previous rule.\n\n- &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name\n  is first removed if it existed. this is useful when passing security\n  information to the server, where the header must not be manipulated by\n  external users. note that the new value is computed before the removal so\n  it is possible to concatenate a value to an existing header.\n\n- &quot;del-header&quot; removes all http header fields whose name is specified in\n  &lt;name&gt;.\n\n- &quot;replace-header&quot; matches the regular expression in all occurrences of\n  header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with\n  the &lt;replace-fmt&gt; argument. format characters are allowed in replace-fmt\n  and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. the match is only\n  case-sensitive. it is important to understand that this action only\n  considers whole header lines, regardless of the number of values they\n  may contain. this usage is suited to headers naturally containing commas\n  in their value, such as if-modified-since and so on.\n\n  example:\n\n    http-request replace-header cookie foo=([^;]*);(.*) foo=\\1;ip=%bi;\\2\n\n  applied to:\n\n    cookie: foo=foobar; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n  outputs:\n\n    cookie: foo=foobar;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n  assuming the backend ip is 192.168.1.20\n\n- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the\n  regex against every comma-delimited value of the header field &lt;name&gt;\n  instead of the entire header. this is suited for all headers which are\n  allowed to carry more than one value. an example could be the accept\n  header.\n\n  example:\n\n    http-request replace-value x-forwarded-for ^192\\.168\\.(.*)$ 172.16.\\1\n\n  applied to:\n\n    x-forwarded-for: 192.168.10.1, 192.168.13.24, 10.0.0.37\n\n  outputs:\n\n    x-forwarded-for: 172.16.10.1, 172.16.13.24, 10.0.0.37\n\n- &quot;set-method&quot; rewrites the request method with the result of the\n  evaluation of format string &lt;fmt&gt;. there should be very few valid reasons\n  for having to do so as this is more likely to break something than to fix\n  it.\n\n- &quot;set-path&quot; rewrites the request path with the result of the evaluation of\n  format string &lt;fmt&gt;. the query string, if any, is left intact. if a\n  scheme and authority is found before the path, they are left intact as\n  well. if the request doesn&apos;t have a path (&quot;*&quot;), this one is replaced with\n  the format. this can be used to prepend a directory component in front of\n  a path for example. see also &quot;set-query&quot; and &quot;set-uri&quot;.\n\n  example :\n      # prepend the host name before the path\n      http-request set-path /%[hdr(host)]%[path]\n\n- &quot;set-query&quot; rewrites the request&apos;s query string which appears after the\n  first question mark (&quot;?&quot;) with the result of the evaluation of format\n  string &lt;fmt&gt;. the part prior to the question mark is left intact. if the\n  request doesn&apos;t contain a question mark and the new value is not empty,\n  then one is added at the end of the uri, followed by the new value. if\n  a question mark was present, it will never be removed even if the value\n  is empty. this can be used to add or remove parameters from the query\n  string. see also &quot;set-query&quot; and &quot;set-uri&quot;.\n\n  example :\n      # replace &quot;%3d&quot; with &quot;=&quot; in the query string\n      http-request set-query %[query,regsub(%3d,=,g)]\n\n- &quot;set-uri&quot; rewrites the request uri with the result of the evaluation of\n  format string &lt;fmt&gt;. the scheme, authority, path and query string are all\n  replaced at once. this can be used to rewrite hosts in front of proxies,\n  or to perform complex modifications to the uri such as moving parts\n  between the path and the query string. see also &quot;set-path&quot; and\n  &quot;set-query&quot;.\n\n- &quot;set-nice&quot; sets the &quot;nice&quot; factor of the current request being processed.\n  it only has effect against the other requests being processed at the same\n  time. the default value is 0, unless altered by the &quot;nice&quot; setting on the\n  &quot;bind&quot; line. the accepted range is -1024..1024\\. the higher the value, the\n  nicest the request will be. lower values will make the request more\n  important than other ones. this can be useful to improve the speed of\n  some requests, or lower the priority of non-important requests. using\n  this setting without prior experimentation can cause some major slowdown.\n\n- &quot;set-log-level&quot; is used to change the log level of the current request\n  when a certain condition is met. valid levels are the 8 syslog levels\n  (see the &quot;log&quot; keyword) plus the special level &quot;silent&quot; which disables\n  logging for this request. this rule is not final so the last matching\n  rule wins. this rule can be useful to disable health checks coming from\n  another equipment.\n\n- &quot;set-tos&quot; is used to set the tos or dscp field value of packets sent to\n  the client to the value passed in &lt;tos&gt; on platforms which support this.\n  this value represents the whole 8 bits of the ip tos field, and can be\n  expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). note\n  that only the 6 higher bits are used in dscp or tos, and the two lower\n  bits are always 0\\. this can be used to adjust some routing behaviour on\n  border routers based on some information from the request. see rfc 2474,\n  2597, 3260 and 4594 for more information.\n\n- &quot;set-mark&quot; is used to set the netfilter mark on all packets sent to the\n  client to the value passed in &lt;mark&gt; on platforms which support it. this\n  value is an unsigned 32 bit value which can be matched by netfilter and\n  by the routing table. it can be expressed both in decimal or hexadecimal\n  format (prefixed by &quot;0x&quot;). this can be useful to force certain packets to\n  take a different route (for example a cheaper network path for bulk\n  downloads). this works on linux kernels 2.6.32 and above and requires\n  admin privileges.\n\n- &quot;add-acl&quot; is used to add a new entry into an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the new entry. it\n  performs a lookup in the acl before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;add acl&quot; command from the\n  stats socket, but can be triggered by an http request.\n\n- &quot;del-acl&quot; is used to delete an entry from an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it is the equivalent of the &quot;del acl&quot; command from the stats socket, but\n  can be triggered by an http request.\n\n- &quot;del-map&quot; is used to delete an entry from a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it takes one argument: &quot;file name&quot; it is the equivalent of the &quot;del map&quot;\n  command from the stats socket, but can be triggered by an http request.\n\n- &quot;set-map&quot; is used to add a new entry into a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes 2 arguments: &lt;key fmt&gt;,\n  which follows log-format rules, used to collect map key, and &lt;value fmt&gt;,\n  which follows log-format rules, used to collect content for the new entry.\n  it performs a lookup in the map before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;set map&quot; command from the\n  stats socket, but can be triggered by an http request.\n\n- capture &lt;sample&gt; [ len &lt;length&gt; | id &lt;id&gt; ] :\n  captures sample expression &lt;sample&gt; from the request buffer, and converts\n  it to a string of at most &lt;len&gt; characters. the resulting string is\n  stored into the next request &quot;capture&quot; slot, so it will possibly appear\n  next to some captured http headers. it will then automatically appear in\n  the logs, and it will be possible to extract it using sample fetch rules\n  to feed it into headers or anything. the length should be limited given\n  that this size will be allocated for each capture during the whole\n  session life. please check section 7.3 (fetching samples) and &quot;capture\n  request header&quot; for more information.\n\n  if the keyword &quot;id&quot; is used instead of &quot;len&quot;, the action tries to store\n  the captured string in a previously declared capture slot. this is useful\n  to run captures in backends. the slot id can be declared by a previous\n  directive &quot;http-request capture&quot; or with the &quot;declare capture&quot; keyword.\n\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;] :\n  enables tracking of sticky counters from current request. these rules\n  do not stop evaluation and do not change default action. three sets of\n  counters may be simultaneously tracked by the same connection. the first\n  &quot;track-sc0&quot; rule executed enables tracking of the counters of the\n  specified table as the first set. the first &quot;track-sc1&quot; rule executed\n  enables tracking of the counters of the specified table as the second\n  set. the first &quot;track-sc2&quot; rule executed enables tracking of the\n  counters of the specified table as the third set. it is a recommended\n  practice to use the first set of counters for the per-frontend counters\n  and the second set for the per-backend ones. but this is just a\n  guideline, all may be used everywhere.\n\n  these actions take one or two arguments :\n    &lt;key&gt;   is mandatory, and is a sample expression rule as described\n            in section 7.3\\. it describes what elements of the incoming\n            request or connection will be analysed, extracted, combined,\n            and used to select which table entry to update the counters.\n\n    &lt;table&gt; is an optional table to be used instead of the default one,\n            which is the stick-table declared in the current proxy. all\n            the counters for the matches and updates for the key will\n            then be performed in that table until the session ends.\n\n  once a &quot;track-sc*&quot; rule is executed, the key is looked up in the table\n  and if it is not found, an entry is allocated for it. then a pointer to\n  that entry is kept during all the session&apos;s life, and this entry&apos;s\n  counters are updated as often as possible, every time the session&apos;s\n  counters are updated, and also systematically when the session ends.\n  counters are only updated for events that happen after the tracking has\n  been started. as an exception, connection counters and request counters\n  are systematically updated so that they reflect useful information.\n\n  if the entry tracks concurrent connection counters, one connection is\n  counted for as long as the entry is tracked, and the entry will not\n  expire during that time. tracking counters also provides a performance\n  advantage over just checking the keys, because only one table lookup is\n  performed for all acl checks that make use of it.\n\n- &quot;lua&quot; is used to run a lua function if the action is executed. the single\n  parameter is the name of the function to run. the prototype of the\n  function is documented in the api documentation.\n\n- set-var(&lt;var-name&gt;) &lt;expr&gt; :\n  is used to set the contents of a variable. the variable is declared\n  inline.\n\n    &lt;var-name&gt; the name of the variable starts by an indication about its\n               scope. the allowed scopes are:\n                 &quot;sess&quot; : the variable is shared with all the session,\n                 &quot;txn&quot;  : the variable is shared with all the transaction\n                          (request and response)\n                 &quot;req&quot;  : the variable is shared only during the request\n                          processing\n                 &quot;res&quot;  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a &apos;.&apos;.\n               the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos;,\n               and &apos;_&apos;.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-request set-var(req.my_var) req.fhdr(user-agent),lower\n\n- set-src &lt;expr&gt; :\n  is used to set the source ip address to the value of specified\n  expression. useful when a proxy in front of haproxy rewrites source ip,\n  but provides the correct ip in a http header; or you want to mask\n  source ip for privacy.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-request set-src hdr(x-forwarded-for)\n     http-request set-src src,ipmask(24)\n\n  when set-src is successful, the source port is set to 0.\n</code></pre><p>  there is no limit to the number of http-request statements per instance.</p>\n<p>  it is important to know that http-request rules are processed very early in<br>  the http processing, just after “block” rules and before “reqdel” or “reqrep”<br>  rules. that way, headers added by “add-header”/“set-header” are visible by<br>  almost all further acl rules.</p>\n<p>  example:<br>        acl nagios src 192.168.129.3<br>        acl local_net src 192.168.0.0/16<br>        acl auth_ok http_auth(l1)</p>\n<pre><code>http-request allow if nagios\nhttp-request allow if local_net auth_ok\nhttp-request auth realm gimme if local_net auth_ok\nhttp-request deny\n</code></pre><p>  example:<br>        acl auth_ok http_auth_group(l1) g1<br>        http-request auth unless auth_ok</p>\n<p>  example:<br>        http-request set-header x-haproxy-current-date %t<br>        http-request set-header x-ssl                  %[ssl_fc]<br>        http-request set-header x-ssl-session_id       %[ssl_fc_session_id]<br>        http-request set-header x-ssl-client-verify    %[ssl_c_verify]<br>        http-request set-header x-ssl-client-dn        %{+q}[ssl_c_s_dn]<br>        http-request set-header x-ssl-client-cn        %{+q}[ssl_c_s_dn(cn)]<br>        http-request set-header x-ssl-issuer           %{+q}[ssl_c_i_dn]<br>        http-request set-header x-ssl-client-notbefore %{+q}[ssl_c_notbefore]<br>        http-request set-header x-ssl-client-notafter  %{+q}[ssl_c_notafter]</p>\n<p>  example:<br>        acl key req.hdr(x-add-acl-key) -m found<br>        acl add path /addacl<br>        acl del path /delacl</p>\n<pre><code>acl myhost hdr(host) -f myhost.lst\n\nhttp-request add-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key add\nhttp-request del-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key del\n</code></pre><p>  example:<br>        acl value  req.hdr(x-value) -m found<br>        acl setmap path /setmap<br>        acl delmap path /delmap</p>\n<pre><code>use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\nhttp-request set-map(map.lst) %[src] %[req.hdr(x-value)] if setmap value\nhttp-request del-map(map.lst) %[src]                     if delmap\n</code></pre><p>  see also : “stats http-request”, section 3.4 about userlists and section 7<br>             about acl usage.</p>\n<p>http-response { allow | deny | add-header <name> <fmt> | set-nice <nice> |<br>                capture <sample> id <id> | redirect <rule> |<br>                set-header <name> <fmt> | del-header <name> |<br>                replace-header <name> <regex-match> <replace-fmt> |<br>                replace-value <name> <regex-match> <replace-fmt> |<br>                set-log-level <level> | set-mark <mark> | set-tos <tos> |<br>                add-acl(<file name=\"\">) <key fmt=\"\"> |<br>                del-acl(<file name=\"\">) <key fmt=\"\"> |<br>                del-map(<file name=\"\">) <key fmt=\"\"> |<br>                set-map(<file name=\"\">) <key fmt=\"\"> <value fmt=\"\"> |<br>                set-var(<var-name>) <expr> |<br>                lua <function name=\"\"><br>              }<br>              [ { if | unless } <condition> ]<br>  access control for layer 7 responses</condition></function></expr></var-name></value></key></file></key></file></key></file></key></file></tos></mark></level></replace-fmt></regex-match></name></replace-fmt></regex-match></name></name></fmt></name></rule></id></sample></nice></fmt></name></p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    yes   |   yes  |   yes</p>\n<p>  the http-response statement defines a set of rules which apply to layer 7<br>  processing. the rules are evaluated in their declaration order when they are<br>  met in a frontend, listen or backend section. any rule may optionally be<br>  followed by an acl-based condition, in which case it will only be evaluated<br>  if the condition is true. since these rules apply on responses, the backend<br>  rules are applied first, followed by the frontend’s rules.</p>\n<p>  the first keyword is the rule’s action. currently supported actions include :</p>\n<pre><code>- &quot;allow&quot; : this stops the evaluation of the rules and lets the response\n  pass the check. no further &quot;http-response&quot; rules are evaluated for the\n  current section.\n\n- &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects\n  the response and emits an http 502 error. no further &quot;http-response&quot;\n  rules are evaluated.\n\n- &quot;add-header&quot; appends an http header field whose name is specified in\n  &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format\n  rules (see custom log format in section 8.2.4). this may be used to send\n  a cookie to a client for example, or to pass some internal information.\n  this rule is not final, so it is possible to add other similar rules.\n  note that header addition is performed immediately, so one rule might\n  reuse the resulting header from a previous rule.\n\n- &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name\n  is first removed if it existed. this is useful when passing security\n  information to the server, where the header must not be manipulated by\n  external users.\n\n- &quot;del-header&quot; removes all http header fields whose name is specified in\n  &lt;name&gt;.\n\n- &quot;replace-header&quot; matches the regular expression in all occurrences of\n  header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with\n  the &lt;replace-fmt&gt; argument. format characters are allowed in replace-fmt\n  and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. the match is only\n  case-sensitive. it is important to understand that this action only\n  considers whole header lines, regardless of the number of values they\n  may contain. this usage is suited to headers naturally containing commas\n  in their value, such as set-cookie, expires and so on.\n\n  example:\n\n    http-response replace-header set-cookie (c=[^;]*);(.*) \\1;ip=%bi;\\2\n\n  applied to:\n\n    set-cookie: c=1; expires=tue, 14-jun-2016 01:40:45 gmt\n\n  outputs:\n\n    set-cookie: c=1;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt\n\n  assuming the backend ip is 192.168.1.20.\n\n- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the\n  regex against every comma-delimited value of the header field &lt;name&gt;\n  instead of the entire header. this is suited for all headers which are\n  allowed to carry more than one value. an example could be the accept\n  header.\n\n  example:\n\n    http-response replace-value cache-control ^public$ private\n\n  applied to:\n\n    cache-control: max-age=3600, public\n\n  outputs:\n\n    cache-control: max-age=3600, private\n\n- &quot;set-nice&quot; sets the &quot;nice&quot; factor of the current request being processed.\n  it only has effect against the other requests being processed at the same\n  time. the default value is 0, unless altered by the &quot;nice&quot; setting on the\n  &quot;bind&quot; line. the accepted range is -1024..1024\\. the higher the value, the\n  nicest the request will be. lower values will make the request more\n  important than other ones. this can be useful to improve the speed of\n  some requests, or lower the priority of non-important requests. using\n  this setting without prior experimentation can cause some major slowdown.\n\n- &quot;set-log-level&quot; is used to change the log level of the current request\n  when a certain condition is met. valid levels are the 8 syslog levels\n  (see the &quot;log&quot; keyword) plus the special level &quot;silent&quot; which disables\n  logging for this request. this rule is not final so the last matching\n  rule wins. this rule can be useful to disable health checks coming from\n  another equipment.\n\n- &quot;set-tos&quot; is used to set the tos or dscp field value of packets sent to\n  the client to the value passed in &lt;tos&gt; on platforms which support this.\n  this value represents the whole 8 bits of the ip tos field, and can be\n  expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). note\n  that only the 6 higher bits are used in dscp or tos, and the two lower\n  bits are always 0\\. this can be used to adjust some routing behaviour on\n  border routers based on some information from the request. see rfc 2474,\n  2597, 3260 and 4594 for more information.\n\n- &quot;set-mark&quot; is used to set the netfilter mark on all packets sent to the\n  client to the value passed in &lt;mark&gt; on platforms which support it. this\n  value is an unsigned 32 bit value which can be matched by netfilter and\n  by the routing table. it can be expressed both in decimal or hexadecimal\n  format (prefixed by &quot;0x&quot;). this can be useful to force certain packets to\n  take a different route (for example a cheaper network path for bulk\n  downloads). this works on linux kernels 2.6.32 and above and requires\n  admin privileges.\n\n- &quot;add-acl&quot; is used to add a new entry into an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the new entry. it\n  performs a lookup in the acl before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;add acl&quot; command from the\n  stats socket, but can be triggered by an http response.\n\n- &quot;del-acl&quot; is used to delete an entry from an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it is the equivalent of the &quot;del acl&quot; command from the stats socket, but\n  can be triggered by an http response.\n\n- &quot;del-map&quot; is used to delete an entry from a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it takes one argument: &quot;file name&quot; it is the equivalent of the &quot;del map&quot;\n  command from the stats socket, but can be triggered by an http response.\n\n- &quot;set-map&quot; is used to add a new entry into a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes 2 arguments: &lt;key fmt&gt;,\n  which follows log-format rules, used to collect map key, and &lt;value fmt&gt;,\n  which follows log-format rules, used to collect content for the new entry.\n  it performs a lookup in the map before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;set map&quot; command from the\n  stats socket, but can be triggered by an http response.\n\n- &quot;lua&quot; is used to run a lua function if the action is executed. the single\n  parameter is the name of the function to run. the prototype of the\n  function is documented in the api documentation.\n\n- capture &lt;sample&gt; id &lt;id&gt; :\n  captures sample expression &lt;sample&gt; from the response buffer, and converts\n  it to a string. the resulting string is stored into the next request\n  &quot;capture&quot; slot, so it will possibly appear next to some captured http\n  headers. it will then automatically appear in the logs, and it will be\n  possible to extract it using sample fetch rules to feed it into headers or\n  anything. please check section 7.3 (fetching samples) and &quot;capture\n  response header&quot; for more information.\n\n  the keyword &quot;id&quot; is the id of the capture slot which is used for storing\n  the string. the capture slot must be defined in an associated frontend.\n  this is useful to run captures in backends. the slot id can be declared by\n  a previous directive &quot;http-response capture&quot; or with the &quot;declare capture&quot;\n  keyword.\n\n- &quot;redirect&quot; : this performs an http redirection based on a redirect rule.\n  this supports a format string similarly to &quot;http-request redirect&quot; rules,\n  with the exception that only the &quot;location&quot; type of redirect is possible\n  on the response. see the &quot;redirect&quot; keyword for the rule&apos;s syntax. when\n  a redirect rule is applied during a response, connections to the server\n  are closed so that no data can be forwarded from the server to the client.\n\n- set-var(&lt;var-name&gt;) expr:\n  is used to set the contents of a variable. the variable is declared\n  inline.\n\n    &lt;var-name&gt; the name of the variable starts by an indication about its\n               scope. the allowed scopes are:\n                 &quot;sess&quot; : the variable is shared with all the session,\n                 &quot;txn&quot;  : the variable is shared with all the transaction\n                          (request and response)\n                 &quot;req&quot;  : the variable is shared only during the request\n                          processing\n                 &quot;res&quot;  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a &apos;.&apos;.\n               the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos;,\n               and &apos;_&apos;.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-response set-var(sess.last_redir) res.hdr(location)\n</code></pre><p>  there is no limit to the number of http-response statements per instance.</p>\n<p>  it is important to know that http-response rules are processed very early in<br>  the http processing, before “reqdel” or “reqrep” rules. that way, headers<br>  added by “add-header”/“set-header” are visible by almost all further acl<br>  rules.</p>\n<p>  example:<br>         acl key_acl res.hdr(x-acl-key) -m found</p>\n<pre><code>acl myhost hdr(host) -f myhost.lst\n\nhttp-response add-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\nhttp-response del-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n</code></pre><p>  example:<br>         acl value  res.hdr(x-value) -m found</p>\n<pre><code>use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\nhttp-response set-map(map.lst) %[src] %[res.hdr(x-value)] if value\nhttp-response del-map(map.lst) %[src]                     if ! value\n</code></pre><p>  see also : “http-request”, section 3.4 about userlists and section 7 about<br>             acl usage.</p>\n<p>http-send-name-header [<header>]<br>  add the server name to a request. use the header string given by <header></header></header></p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                               yes    |    no    |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;header&gt;  the header string to use to send the server name\n</code></pre><p>  the “http-send-name-header” statement causes the name of the target<br>  server to be added to the headers of an http request.  the name<br>  is added with the header string proved.</p>\n<p>  see also : “server”</p>\n<p>id <value><br>  set a persistent id to a proxy.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes<br>  arguments : none</value></p>\n<p>  set a persistent id for the proxy. this id must be unique and positive.<br>  an unused id will automatically be assigned if unset. the first assigned<br>  value will be 1. this id is currently only returned in statistics.</p>\n<p>ignore-persist { if | unless } <condition><br>  declare a condition to ignore persistence<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes</condition></p>\n<p>  by default, when cookie persistence is enabled, every requests containing<br>  the cookie are unconditionally persistent (assuming the target server is up<br>  and running).</p>\n<p>  the “ignore-persist” statement allows one to declare various acl-based<br>  conditions which, when met, will cause a request to ignore persistence.<br>  this is sometimes useful to load balance requests for static files, which<br>  often don’t require persistence. this can also be used to fully disable<br>  persistence for a specific user-agent (for example, some web crawler bots).</p>\n<p>  combined with “appsession”, it can also help reduce haproxy memory usage, as<br>  the appsession table won’t grow if persistence is ignored.</p>\n<p>  the persistence is ignored when an “if” condition is met, or unless an<br>  “unless” condition is met.</p>\n<p>  see also : “force-persist”, “cookie”, and section 7 about acl usage.</p>\n<p>log global<br>log <address> [len <length>] <facility> [<level> [<minlevel>]]<br>no log<br>  enable per-instance logging of events and traffic.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</minlevel></level></facility></length></address></p>\n<p>  prefix :<br>    no         should be used when the logger list must be flushed. for example,<br>               if you don’t want to inherit from the default logger list. this<br>               prefix does not allow arguments.</p>\n<p>  arguments :<br>    global     should be used when the instance’s logging parameters are the<br>               same as the global ones. this is the most common usage. “global”<br>               replaces <address>, <facility> and <level> with those of the log<br>               entries found in the “global” section. only one “log global”<br>               statement may be used per instance, and this form takes no other<br>               parameter.</level></facility></address></p>\n<pre><code>&lt;address&gt;  indicates where to send the logs. it takes the same format as\n           for the &quot;global&quot; section&apos;s logs, and can be one of :\n\n           - an ipv4 address optionally followed by a colon (&apos;:&apos;) and a udp\n             port. if no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - an ipv6 address followed by a colon (&apos;:&apos;) and optionally a udp\n             port. if no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - a filesystem path to a unix domain socket, keeping in mind\n             considerations for chroot (be sure the path is accessible\n             inside the chroot) and uid/gid (be sure the path is\n             appropriately writeable).\n\n          you may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment variables.\n\n&lt;length&gt;   is an optional maximum line length. log lines larger than this\n           value will be truncated before being sent. the reason is that\n           syslog servers act differently on log line length. all servers\n           support the default value of 1024, but some servers simply drop\n           larger lines while others do log them. if a server supports long\n           lines, it may make sense to set this value here in order to avoid\n           truncating long lines. similarly, if a server drops long lines,\n           it is preferable to truncate them before sending them. accepted\n           values are 80 to 65535 inclusive. the default value of 1024 is\n           generally fine for all standard usages. some specific cases of\n           long captures or json-formated logs may require larger values.\n\n&lt;facility&gt; must be one of the 24 standard syslog facilities :\n\n             kern   user   mail   daemon auth   syslog lpr    news\n             uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n             local0 local1 local2 local3 local4 local5 local6 local7\n\n&lt;level&gt;    is optional and can be specified to filter outgoing messages. by\n           default, all messages are sent. if a level is specified, only\n           messages with a severity at least as important as this level\n           will be sent. an optional minimum level can be specified. if it\n           is set, logs emitted with a more severe level than this one will\n           be capped to this level. this is used to avoid sending &quot;emerg&quot;\n           messages on all terminals on some default syslog configurations.\n           eight levels are known :\n\n             emerg  alert  crit   err    warning notice info  debug\n</code></pre><p>  it is important to keep in mind that it is the frontend which decides what to<br>  log from a connection, and that in case of content switching, the log entries<br>  from the backend will be ignored. connections are logged at level “info”.</p>\n<p>  however, backend log declaration define how and where servers status changes<br>  will be logged. level “notice” will be used to indicate a server going up,<br>  “warning” will be used for termination signals and definitive service<br>  termination, and “alert” will be used for when a server goes down.</p>\n<p>  note : according to rfc3164, messages are truncated to 1024 bytes before<br>         being emitted.</p>\n<p>  example :<br>    log global<br>    log 127.0.0.1:514 local0 notice         # only send important events<br>    log 127.0.0.1:514 local0 notice notice  # same but limit output level<br>    log “${local_syslog}:514” local0 notice   # send to local server</p>\n<p>log-format <string><br>  specifies the log format string to use for traffic logs<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |    no</string></p>\n<p>  this directive specifies the log format string that will be used for all logs<br>  resulting from traffic passing through the frontend using this line. if the<br>  directive is used in a defaults section, all subsequent frontends will use<br>  the same log format. please see section 8.2.4 which covers the log format<br>  string in depth.</p>\n<p>log-tag <string><br>  specifies the log tag to use for all outgoing logs<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</string></p>\n<p>  sets the tag field in the syslog header to this string. it defaults to the<br>  log-tag set in the global section, otherwise the program name as launched<br>  from the command line, which usually is “haproxy”. sometimes it can be useful<br>  to differentiate between multiple processes running on the same host, or to<br>  differentiate customer instances running in the same process. in the backend,<br>  logs about servers up/down will use this tag. as a hint, it can be convenient<br>  to set a log-tag related to a hosted customer in a defaults section then put<br>  all the frontends and backends for that customer, then start another customer<br>  in a new defaults section. see also the global “log-tag” directive.</p>\n<p>max-keep-alive-queue <value><br>  set the maximum server queue size for maintaining keep-alive connections<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes</value></p>\n<p>  http keep-alive tries to reuse the same server connection whenever possible,<br>  but sometimes it can be counter-productive, for example if a server has a lot<br>  of connections while other ones are idle. this is especially true for static<br>  servers.</p>\n<p>  the purpose of this setting is to set a threshold on the number of queued<br>  connections at which haproxy stops trying to reuse the same server and prefers<br>  to find another one. the default value, -1, means there is no limit. a value<br>  of zero means that keep-alive requests will never be queued. for very close<br>  servers which can be reached with a low latency and which are not sensible to<br>  breaking keep-alive, a low value is recommended (eg: local static server can<br>  use a value of 10 or less). for remote servers suffering from a high latency,<br>  higher values might be needed to cover for the latency and/or the cost of<br>  picking a different server.</p>\n<p>  note that this has no impact on responses which are maintained to the same<br>  server consecutively to a 401 response. they will still go to the same server<br>  even if they have to be queued.</p>\n<p>  see also : “option http-server-close”, “option prefer-last-server”, server<br>             “maxconn” and cookie persistence.</p>\n<p>maxconn <conns><br>  fix the maximum number of concurrent connections on a frontend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <conns>   is the maximum number of concurrent connections the frontend will<br>              accept to serve. excess connections will be queued by the system<br>              in the socket’s listen queue and will be served once a connection<br>              closes.</conns></conns></p>\n<p>  if the system supports it, it can be useful on big sites to raise this limit<br>  very high so that haproxy manages connection queues, instead of leaving the<br>  clients with unanswered connection attempts. this value should not exceed the<br>  global maxconn. also, keep in mind that a connection contains two buffers<br>  of 8kb each, as well as some other data resulting in about 17 kb of ram being<br>  consumed per established connection. that means that a medium system equipped<br>  with 1gb of ram can withstand around 40000-50000 concurrent connections if<br>  properly tuned.</p>\n<p>  also, when <conns> is set to large values, it is possible that the servers<br>  are not sized to accept such loads, and for this reason it is generally wise<br>  to assign them some reasonable connection limits.</conns></p>\n<p>  by default, this value is set to 2000.</p>\n<p>  see also : “server”, global section’s “maxconn”, “fullconn”</p>\n<p>mode { tcp|http|health }<br>  set the running mode or protocol of the instance<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    tcp       the instance will work in pure tcp mode. a full-duplex connection<br>              will be established between clients and servers, and no layer 7<br>              examination will be performed. this is the default mode. it<br>              should be used for ssl, ssh, smtp, …</p>\n<pre><code>http      the instance will work in http mode. the client request will be\n          analyzed in depth before connecting to any server. any request\n          which is not rfc-compliant will be rejected. layer 7 filtering,\n          processing and switching will be possible. this is the mode which\n          brings haproxy most of its value.\n\nhealth    the instance will work in &quot;health&quot; mode. it will just reply &quot;ok&quot;\n          to incoming connections and close the connection. alternatively,\n          if the &quot;httpchk&quot; option is set, &quot;http/1.0 200 ok&quot; will be sent\n          instead. nothing will be logged in either case. this mode is used\n          to reply to external components health checks. this mode is\n          deprecated and should not be used anymore as it is possible to do\n          the same and even better by combining tcp or http modes with the\n          &quot;monitor&quot; keyword.\n</code></pre><p>  when doing content switching, it is mandatory that the frontend and the<br>  backend are in the same mode (generally http), otherwise the configuration<br>  will be refused.</p>\n<p>  example :<br>     defaults http_instances<br>         mode http</p>\n<p>  see also : “monitor”, “monitor-net”</p>\n<p>monitor fail { if | unless } <condition><br>  add a condition to report a failure to a monitor http request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments :<br>    if <cond>     the monitor request will fail if the condition is satisfied,<br>                  and will succeed otherwise. the condition should describe a<br>                  combined test which must induce a failure if all conditions<br>                  are met, for instance a low number of servers both in a<br>                  backend and its backup.</cond></condition></p>\n<pre><code>unless &lt;cond&gt; the monitor request will succeed only if the condition is\n              satisfied, and will fail otherwise. such a condition may be\n              based on a test on the presence of a minimum number of active\n              servers in a list of backends.\n</code></pre><p>  this statement adds a condition which can force the response to a monitor<br>  request to report a failure. by default, when an external component queries<br>  the uri dedicated to monitoring, a 200 response is returned. when one of the<br>  conditions above is met, haproxy will return 503 instead of 200. this is<br>  very useful to report a site failure to an external component which may base<br>  routing advertisements between multiple sites on the availability reported by<br>  haproxy. in this case, one would rely on an acl involving the “nbsrv”<br>  criterion. note that “monitor fail” only works in http mode. both status<br>  messages may be tweaked using “errorfile” or “errorloc” if needed.</p>\n<p>  example:<br>     frontend www<br>        mode http<br>        acl site_dead nbsrv(dynamic) lt 2<br>        acl site_dead nbsrv(static)  lt 2<br>        monitor-uri   /site_alive<br>        monitor fail  if site_dead</p>\n<p>  see also : “monitor-net”, “monitor-uri”, “errorfile”, “errorloc”</p>\n<p>monitor-net <source><br>  declare a source network which is limited to monitor requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <source>  is the source ipv4 address or network which will only be able to<br>              get monitor responses to any request. it can be either an ipv4<br>              address, a host name, or an address followed by a slash (‘/‘)<br>              followed by a mask.</p>\n<p>  in tcp mode, any connection coming from a source matching <source> will cause<br>  the connection to be immediately closed without any log. this allows another<br>  equipment to probe the port and verify that it is still listening, without<br>  forwarding the connection to a remote server.</p>\n<p>  in http mode, a connection coming from a source matching <source> will be<br>  accepted, the following response will be sent without waiting for a request,<br>  then the connection will be closed : “http/1.0 200 ok”. this is normally<br>  enough for any front-end http probe to detect that the service is up and<br>  running without forwarding the request to a backend server. note that this<br>  response is sent in raw format, without any transformation. this is important<br>  as it means that it will not be ssl-encrypted on ssl listeners.</p>\n<p>  monitor requests are processed very early, just after tcp-request connection<br>  acls which are the only ones able to block them. these connections are short<br>  lived and never wait for any data from the client. they cannot be logged, and<br>  it is the intended purpose. they are only used to report haproxy’s health to<br>  an upper component, nothing more. please note that “monitor fail” rules do<br>  not apply to connections intercepted by “monitor-net”.</p>\n<p>  last, please note that only one “monitor-net” statement can be specified in<br>  a frontend. if more than one is found, only the last one will be considered.</p>\n<p>  example :</p>\n<pre><code># addresses .252 and .253 are just probing us.\nfrontend www\n    monitor-net 192.168.0.252/31\n</code></pre><p>  see also : “monitor fail”, “monitor-uri”</p>\n<p>monitor-uri <uri><br>  intercept a uri used by external components’ monitor requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <uri>     is the exact uri which we want to intercept to return haproxy’s<br>              health status instead of forwarding the request.</uri></uri></p>\n<p>  when an http request referencing <uri> will be received on a frontend,<br>  haproxy will not forward it nor log it, but instead will return either<br>  “http/1.0 200 ok” or “http/1.0 503 service unavailable”, depending on failure<br>  conditions defined with “monitor fail”. this is normally enough for any<br>  front-end http probe to detect that the service is up and running without<br>  forwarding the request to a backend server. note that the http method, the<br>  version and all headers are ignored, but the request must at least be valid<br>  at the http level. this keyword may only be used with an http-mode frontend.</uri></p>\n<p>  monitor requests are processed very early. it is not possible to block nor<br>  divert them using acls. they cannot be logged either, and it is the intended<br>  purpose. they are only used to report haproxy’s health to an upper component,<br>  nothing more. however, it is possible to add any number of conditions using<br>  “monitor fail” and acls so that the result can be adjusted to whatever check<br>  can be imagined (most often the number of available servers in a backend).</p>\n<p>  example :</p>\n<pre><code># use /haproxy_test to report haproxy&apos;s status\nfrontend www\n    mode http\n    monitor-uri /haproxy_test\n</code></pre><p>  see also : “monitor fail”, “monitor-net”</p>\n<p>option abortonclose<br>no option abortonclose<br>  enable or disable early dropping of aborted requests pending in queues.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  in presence of very high loads, the servers will take some time to respond.<br>  the per-instance connection queue will inflate, and the response time will<br>  increase respective to the size of the queue times the average per-session<br>  response time. when clients will wait for more than a few seconds, they will<br>  often hit the “stop” button on their browser, leaving a useless request in<br>  the queue, and slowing down other users, and the servers as well, because the<br>  request will eventually be served, then aborted at the first error<br>  encountered while delivering the response.</p>\n<p>  as there is no way to distinguish between a full stop and a simple output<br>  close on the client side, http agents should be conservative and consider<br>  that the client might only have closed its output channel while waiting for<br>  the response. however, this introduces risks of congestion when lots of users<br>  do the same, and is completely useless nowadays because probably no client at<br>  all will close the session while waiting for the response. some http agents<br>  support this behaviour (squid, apache, haproxy), and others do not (tux, most<br>  hardware-based load balancers). so the probability for a closed input channel<br>  to represent a user hitting the “stop” button is close to 100%, and the risk<br>  of being the single component to break rare but valid traffic is extremely<br>  low, which adds to the temptation to be able to abort a session early while<br>  still not served and not pollute the servers.</p>\n<p>  in haproxy, the user can choose the desired behaviour using the option<br>  “abortonclose”. by default (without the option) the behaviour is http<br>  compliant and aborted requests will be served. but when the option is<br>  specified, a session with an incoming channel closed will be aborted while<br>  it is still possible, either pending in the queue for a connection slot, or<br>  during the connection establishment if the server has not yet acknowledged<br>  the connection request. this considerably reduces the queue size and the load<br>  on saturated servers when users are tempted to click on stop, which in turn<br>  reduces the response time for other users.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “timeout queue” and server’s “maxconn” and “maxqueue” parameters</p>\n<p>option accept-invalid-http-request<br>no option accept-invalid-http-request<br>  enable or disable relaxing of http request parsing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, haproxy complies with rfc7230 in terms of message parsing. this<br>  means that invalid characters in header names are not permitted and cause an<br>  error to be returned to the client. this is the desired behaviour as such<br>  forbidden characters are essentially used to build attacks exploiting server<br>  weaknesses, and bypass security filtering. sometimes, a buggy browser or<br>  server will emit invalid header names for whatever reason (configuration,<br>  implementation) and the issue will not be immediately fixed. in such a case,<br>  it is possible to relax haproxy’s header name parser to accept any character<br>  even if that does not make sense, by specifying this option. similarly, the<br>  list of characters allowed to appear in a uri is well defined by rfc3986, and<br>  chars 0-31, 32 (space), 34 (‘“‘), 60 (‘&lt;’), 62 (‘&gt;’), 92 (‘\\’), 94 (‘^’), 96<br>  (‘`’), 123 (‘{‘), 124 (‘|’), 125 (‘}’), 127 (delete) and anything above are<br>  not allowed at all. haproxy always blocks a number of them (0..32, 127). the<br>  remaining ones are blocked by default unless this option is enabled. this<br>  option also relaxes the test on the http version, it allows http/0.9 requests<br>  to pass through (no version specified) and multiple digits for both the major<br>  and the minor version.</p>\n<p>  this option should never be enabled by default as it hides application bugs<br>  and open security breaches. it should only be deployed after a problem has<br>  been confirmed.</p>\n<p>  when this option is enabled, erroneous header names will still be accepted in<br>  requests, but the complete request will be captured in order to permit later<br>  analysis using the “show errors” request on the unix stats socket. similarly,<br>  requests containing invalid chars in the uri part will be logged. doing this<br>  also helps confirming that the issue has been solved.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option accept-invalid-http-response” and “show errors” on the<br>             stats socket.</p>\n<p>option accept-invalid-http-response<br>no option accept-invalid-http-response<br>  enable or disable relaxing of http response parsing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, haproxy complies with rfc7230 in terms of message parsing. this<br>  means that invalid characters in header names are not permitted and cause an<br>  error to be returned to the client. this is the desired behaviour as such<br>  forbidden characters are essentially used to build attacks exploiting server<br>  weaknesses, and bypass security filtering. sometimes, a buggy browser or<br>  server will emit invalid header names for whatever reason (configuration,<br>  implementation) and the issue will not be immediately fixed. in such a case,<br>  it is possible to relax haproxy’s header name parser to accept any character<br>  even if that does not make sense, by specifying this option. this option also<br>  relaxes the test on the http version format, it allows multiple digits for<br>  both the major and the minor version.</p>\n<p>  this option should never be enabled by default as it hides application bugs<br>  and open security breaches. it should only be deployed after a problem has<br>  been confirmed.</p>\n<p>  when this option is enabled, erroneous header names will still be accepted in<br>  responses, but the complete response will be captured in order to permit<br>  later analysis using the “show errors” request on the unix stats socket.<br>  doing this also helps confirming that the issue has been solved.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option accept-invalid-http-request” and “show errors” on the<br>             stats socket.</p>\n<p>option allbackups<br>no option allbackups<br>  use either all backup servers at a time or only the first one<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the first operational backup server gets all traffic when normal<br>  servers are all down. sometimes, it may be preferred to use multiple backups<br>  at once, because one will not be enough. when “option allbackups” is enabled,<br>  the load balancing will be performed among all backup servers when all normal<br>  ones are unavailable. the same load balancing algorithm will be used and the<br>  servers’ weights will be respected. thus, there will not be any priority<br>  order between the backup servers anymore.</p>\n<p>  this option is mostly used with static server farms dedicated to return a<br>  “sorry” page when an application is completely offline.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option checkcache<br>no option checkcache<br>  analyze all server responses and block responses with cacheable cookies<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  some high-level frameworks set application cookies everywhere and do not<br>  always let enough control to the developer to manage how the responses should<br>  be cached. when a session cookie is returned on a cacheable object, there is a<br>  high risk of session crossing or stealing between users traversing the same<br>  caches. in some situations, it is better to block the response than to let<br>  some sensitive session information go in the wild.</p>\n<p>  the option “checkcache” enables deep inspection of all server responses for<br>  strict compliance with http specification in terms of cacheability. it<br>  carefully checks “cache-control”, “pragma” and “set-cookie” headers in server<br>  response to check if there’s a risk of caching a cookie on a client-side<br>  proxy. when this option is enabled, the only responses which can be delivered<br>  to the client are :</p>\n<pre><code>- all those without &quot;set-cookie&quot; header ;\n- all those with a return code other than 200, 203, 206, 300, 301, 410,\n  provided that the server has not set a &quot;cache-control: public&quot; header ;\n- all those that come from a post request, provided that the server has not\n  set a &apos;cache-control: public&apos; header ;\n- those with a &apos;pragma: no-cache&apos; header\n- those with a &apos;cache-control: private&apos; header\n- those with a &apos;cache-control: no-store&apos; header\n- those with a &apos;cache-control: max-age=0&apos; header\n- those with a &apos;cache-control: s-maxage=0&apos; header\n- those with a &apos;cache-control: no-cache&apos; header\n- those with a &apos;cache-control: no-cache=&quot;set-cookie&quot;&apos; header\n- those with a &apos;cache-control: no-cache=&quot;set-cookie,&apos; header\n  (allowing other fields after set-cookie)\n</code></pre><p>  if a response doesn’t respect these requirements, then it will be blocked<br>  just as if it was from an “rspdeny” filter, with an “http 502 bad gateway”.<br>  the session state shows “ph–” meaning that the proxy blocked the response<br>  during headers processing. additionally, an alert will be sent in the logs so<br>  that admins are informed that there’s something to be fixed.</p>\n<p>  due to the high impact on the application, the application should be tested<br>  in depth with the option enabled before going to production. it is also a<br>  good practice to always activate it during tests, even if it is not used in<br>  production, as it will report potentially dangerous application behaviours.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option clitcpka<br>no option clitcpka<br>  enable or disable the sending of tcp keepalive packets on the client side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “clitcpka” enables the emission of tcp keep-alive probes on the<br>  client side of a connection, which should help when session expirations are<br>  noticed between haproxy and a client.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option srvtcpka”, “option tcpka”</p>\n<p>option contstats<br>  enable continuous traffic statistics updates<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, counters used for statistics calculation are incremented<br>  only when a session finishes. it works quite well when serving small<br>  objects, but with big ones (for example large images or archives) or<br>  with a/v streaming, a graph generated from haproxy counters looks like<br>  a hedgehog. with this option enabled counters get incremented continuously,<br>  during a whole session. recounting touches a hotpath directly so<br>  it is not enabled by default, as it has small performance impact (~0.5%).</p>\n<p>option dontlog-normal<br>no option dontlog-normal<br>  enable or disable logging of normal, successful connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  there are large sites dealing with several thousand connections per second<br>  and for which logging is a major pain. some of them are even forced to turn<br>  logs off and cannot debug production issues. setting this option ensures that<br>  normal connections, those which experience no error, no timeout, no retry nor<br>  redispatch, will not be logged. this leaves disk space for anomalies. in http<br>  mode, the response status code is checked and return codes 5xx will still be<br>  logged.</p>\n<p>  it is strongly discouraged to use this option as most of the time, the key to<br>  complex issues is in the normal logs which will not be logged here. if you<br>  need to separate logs, see the “log-separate-errors” option instead.</p>\n<p>  see also : “log”, “dontlognull”, “log-separate-errors” and section 8 about<br>             logging.</p>\n<p>option dontlognull<br>no option dontlognull<br>  enable or disable logging of null connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  in certain environments, there are components which will regularly connect to<br>  various systems to ensure that they are still alive. it can be the case from<br>  another load balancer as well as from monitoring systems. by default, even a<br>  simple port probe or scan will produce a log. if those connections pollute<br>  the logs too much, it is possible to enable option “dontlognull” to indicate<br>  that a connection on which no data has been transferred will not be logged,<br>  which typically corresponds to those probes. note that errors will still be<br>  returned to the client and accounted for in the stats. if this is not what is<br>  desired, option http-ignore-probes can be used instead.</p>\n<p>  it is generally recommended not to use this option in uncontrolled<br>  environments (eg: internet), otherwise scans and other malicious activities<br>  would not be logged.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “log”, “http-ignore-probes”, “monitor-net”, “monitor-uri”, and<br>             section 8 about logging.</p>\n<p>option forceclose<br>no option forceclose<br>  enable or disable active connection closing after response is transferred.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  some http servers do not necessarily close the connections when they receive<br>  the “connection: close” set by “option httpclose”, and if the client does not<br>  close either, then the connection remains open till the timeout expires. this<br>  causes high number of simultaneous connections on the servers and shows high<br>  global session times in the logs.</p>\n<p>  when this happens, it is possible to use “option forceclose”. it will<br>  actively close the outgoing server channel as soon as the server has finished<br>  to respond and release some resources earlier than with “option httpclose”.</p>\n<p>  this option may also be combined with “option http-pretend-keepalive”, which<br>  will disable sending of the “connection: close” header, but will still cause<br>  the connection to be closed once the whole response is received.</p>\n<p>  this option disables and replaces any previous “option httpclose”, “option<br>  http-server-close”, “option http-keep-alive”, or “option http-tunnel”.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option httpclose” and “option http-pretend-keepalive”</p>\n<p>option forwardfor [ except <network> ] [ header <name> ] [ if-none ]<br>  enable insertion of the x-forwarded-for header to requests sent to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <network> is an optional argument used to disable this option for sources<br>              matching <network><br>    <name>    an optional argument to specify a different “x-forwarded-for”<br>              header name.</name></network></network></name></network></p>\n<p>  since haproxy works in reverse-proxy mode, the servers see its ip address as<br>  their client address. this is sometimes annoying when the client’s ip address<br>  is expected in server logs. to solve this problem, the well-known http header<br>  “x-forwarded-for” may be added by haproxy to all requests sent to the server.<br>  this header contains a value representing the client’s ip address. since this<br>  header is always appended at the end of the existing header list, the server<br>  must be configured to always use the last occurrence of this header only. see<br>  the server’s manual to find how to enable use of this standard header. note<br>  that only the last occurrence of the header must be used, since it is really<br>  possible that the client has already brought one.</p>\n<p>  the keyword “header” may be used to supply a different header name to replace<br>  the default “x-forwarded-for”. this can be useful where you might already<br>  have a “x-forwarded-for” header from a different application (eg: stunnel),<br>  and you need preserve it. also if your backend server doesn’t use the<br>  “x-forwarded-for” header and requires different one (eg: zeus web servers<br>  require “x-cluster-client-ip”).</p>\n<p>  sometimes, a same haproxy instance may be shared between a direct client<br>  access and a reverse-proxy access (for instance when an ssl reverse-proxy is<br>  used to decrypt https traffic). it is possible to disable the addition of the<br>  header for a known source address or network by adding the “except” keyword<br>  followed by the network address. in this case, any source ip matching the<br>  network will not cause an addition of this header. most common uses are with<br>  private networks or 127.0.0.1.</p>\n<p>  alternatively, the keyword “if-none” states that the header will only be<br>  added if it is not present. this should only be used in perfectly trusted<br>  environment, as this might cause a security issue if headers reaching haproxy<br>  are under the control of the end-user.</p>\n<p>  this option may be specified either in the frontend or in the backend. if at<br>  least one of them uses it, the header will be added. note that the backend’s<br>  setting of the header subargument takes precedence over the frontend’s if<br>  both are defined. in the case of the “if-none” argument, if at least one of<br>  the frontend or the backend does not specify it, it wants the addition to be<br>  mandatory, so it wins.</p>\n<p>  examples :</p>\n<pre><code># public http address also used by stunnel on the same machine\nfrontend www\n    mode http\n    option forwardfor except 127.0.0.1  # stunnel already adds the header\n\n# those servers want the ip address in x-client\nbackend www\n    mode http\n    option forwardfor header x-client\n</code></pre><p>  see also : “option httpclose”, “option http-server-close”,<br>             “option forceclose”, “option http-keep-alive”</p>\n<p>option http-buffer-request<br>no option http-buffer-request<br>  enable or disable waiting for whole http request body before proceeding<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  it is sometimes desirable to wait for the body of an http request before<br>  taking a decision. this is what is being done by “balance url_param” for<br>  example. the first use case is to buffer requests from slow clients before<br>  connecting to the server. another use case consists in taking the routing<br>  decision based on the request body’s contents. this option placed in a<br>  frontend or backend forces the http processing to wait until either the whole<br>  body is received, or the request buffer is full, or the first chunk is<br>  complete in case of chunked encoding. it can have undesired side effects with<br>  some applications abusing http by expecting unbufferred transmissions between<br>  the frontend and the backend, so this should definitely not be used by<br>  default.</p>\n<p>  see also : “option http-no-delay”</p>\n<p>option http-ignore-probes<br>no option http-ignore-probes<br>  enable or disable logging of null connections and request timeouts<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  recently some browsers started to implement a “pre-connect” feature<br>  consisting in speculatively connecting to some recently visited web sites<br>  just in case the user would like to visit them. this results in many<br>  connections being established to web sites, which end up in 408 request<br>  timeout if the timeout strikes first, or 400 bad request when the browser<br>  decides to close them first. these ones pollute the log and feed the error<br>  counters. there was already “option dontlognull” but it’s insufficient in<br>  this case. instead, this option does the following things :</p>\n<pre><code>- prevent any 400/408 message from being sent to the client if nothing\n  was received over a connection before it was closed ;\n- prevent any log from being emitted in this situation ;\n- prevent any error counter from being incremented\n</code></pre><p>  that way the empty connection is silently ignored. note that it is better<br>  not to use this unless it is clear that it is needed, because it will hide<br>  real problems. the most common reason for not receiving a request and seeing<br>  a 408 is due to an mtu inconsistency between the client and an intermediary<br>  element such as a vpn, which blocks too large packets. these issues are<br>  generally seen with post requests as well as get with large cookies. the logs<br>  are often the only way to detect them.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “log”, “dontlognull”, “errorfile”, and section 8 about logging.</p>\n<p>option http-keep-alive<br>no option http-keep-alive<br>  enable or disable http keep-alive from client to server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and the<br>  start of a new request. this mode may be changed by several options such as<br>  “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”. this option allows to set back the keep-alive mode,<br>  which can be useful when another mode was used in a defaults section.</p>\n<p>  setting “option http-keep-alive” enables http keep-alive mode on the client-<br>  and server- sides. this provides the lowest latency on the client side (slow<br>  network) and the fastest session reuse on the server side at the expense<br>  of maintaining idle connections to the servers. in general, it is possible<br>  with this option to achieve approximately twice the request rate that the<br>  “http-server-close” option achieves on small objects. there are mainly two<br>  situations where this option may be useful :</p>\n<pre><code>- when the server is non-http compliant and authenticates the connection\n  instead of requests (eg: ntlm authentication)\n\n- when the cost of establishing the connection to the server is significant\n  compared to the cost of retrieving the associated object from the server.\n</code></pre><p>  this last case can happen when the server is a fast static server of cache.<br>  in this case, the server will need to be properly tuned to support high enough<br>  connection counts because connections will last until the client sends another<br>  request.</p>\n<p>  if the client request has to go to another backend or another server due to<br>  content switching or the load balancing algorithm, the idle connection will<br>  immediately be closed and a new one re-opened. option “prefer-last-server” is<br>  available to try optimize server selection so that if the server currently<br>  attached to an idle connection is usable, it will be used.</p>\n<p>  in general it is preferred to use “option http-server-close” with application<br>  servers, and some static servers might benefit from “option http-keep-alive”.</p>\n<p>  at the moment, logs will not indicate whether requests came from the same<br>  session or not. the accept date reported in the logs corresponds to the end<br>  of the previous request, and the request time corresponds to the time spent<br>  waiting for a new request. the keep-alive request time is still bound to the<br>  timeout defined by “timeout http-keep-alive” or “timeout http-request” if<br>  not set.</p>\n<p>  this option disables and replaces any previous “option httpclose”, “option<br>  http-server-close”, “option forceclose” or “option http-tunnel”. when backend<br>  and frontend options differ, all of these 4 options have precedence over<br>  “option http-keep-alive”.</p>\n<p>  see also : “option forceclose”, “option http-server-close”,<br>             “option prefer-last-server”, “option http-pretend-keepalive”,<br>             “option httpclose”, and “1.1. the http transaction model”.</p>\n<p>option http-no-delay<br>no option http-no-delay<br>  instruct the system to favor low interactive delays over performance in http<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  in http, each payload is unidirectional and has no notion of interactivity.<br>  any agent is expected to queue data somewhat for a reasonably low delay.<br>  there are some very rare server-to-server applications that abuse the http<br>  protocol and expect the payload phase to be highly interactive, with many<br>  interleaved data chunks in both directions within a single request. this is<br>  absolutely not supported by the http specification and will not work across<br>  most proxies or servers. when such applications attempt to do this through<br>  haproxy, it works but they will experience high delays due to the network<br>  optimizations which favor performance by instructing the system to wait for<br>  enough data to be available in order to only send full packets. typical<br>  delays are around 200 ms per round trip. note that this only happens with<br>  abnormal uses. normal uses such as connect requests nor websockets are not<br>  affected.</p>\n<p>  when “option http-no-delay” is present in either the frontend or the backend<br>  used by a connection, all such optimizations will be disabled in order to<br>  make the exchanges as fast as possible. of course this offers no guarantee on<br>  the functionality, as it may break at any other place. but if it works via<br>  haproxy, it will work as fast as possible. this option should never be used<br>  by default, and should never be used at all unless such a buggy application<br>  is discovered. the impact of using this option is an increase of bandwidth<br>  usage and cpu usage, which may significantly lower performance in high<br>  latency environments.</p>\n<p>  see also : “option http-buffer-request”</p>\n<p>option http-pretend-keepalive<br>no option http-pretend-keepalive<br>  define whether haproxy will announce keepalive to the server or not<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when running with “option http-server-close” or “option forceclose”, haproxy<br>  adds a “connection: close” header to the request forwarded to the server.<br>  unfortunately, when some servers see this header, they automatically refrain<br>  from using the chunked encoding for responses of unknown length, while this<br>  is totally unrelated. the immediate effect is that this prevents haproxy from<br>  maintaining the client connection alive. a second effect is that a client or<br>  a cache could receive an incomplete response without being aware of it, and<br>  consider the response complete.</p>\n<p>  by setting “option http-pretend-keepalive”, haproxy will make the server<br>  believe it will keep the connection alive. the server will then not fall back<br>  to the abnormal undesired above. when haproxy gets the whole response, it<br>  will close the connection with the server just as it would do with the<br>  “forceclose” option. that way the client gets a normal response and the<br>  connection is correctly closed on the server side.</p>\n<p>  it is recommended not to enable this option by default, because most servers<br>  will more efficiently close the connection themselves after the last packet,<br>  and release its buffers slightly earlier. also, the added packet on the<br>  network could slightly reduce the overall peak performance. however it is<br>  worth noting that when this option is enabled, haproxy will have slightly<br>  less work to do. so if haproxy is the bottleneck on the whole architecture,<br>  enabling this option might save a few cpu cycles.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  this option may be combined with “option httpclose”, which will cause<br>  keepalive to be announced to the server and close to be announced to the<br>  client. this practice is discouraged though.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close”, and<br>             “option http-keep-alive”</p>\n<p>option http-server-close<br>no option http-server-close<br>  enable or disable http connection closing on the server side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”. setting “option http-server-close” enables http<br>  connection-close mode on the server side while keeping the ability to support<br>  http keep-alive and pipelining on the client side.  this provides the lowest<br>  latency on the client side (slow network) and the fastest session reuse on<br>  the server side to save server resources, similarly to “option forceclose”.<br>  it also permits non-keepalive capable servers to be served in keep-alive mode<br>  to the clients if they conform to the requirements of rfc2616. please note<br>  that some servers do not always conform to those requirements when they see<br>  “connection: close” in the request. the effect will be that keep-alive will<br>  never be used. a workaround consists in enabling “option<br>  http-pretend-keepalive”.</p>\n<p>  at the moment, logs will not indicate whether requests came from the same<br>  session or not. the accept date reported in the logs corresponds to the end<br>  of the previous request, and the request time corresponds to the time spent<br>  waiting for a new request. the keep-alive request time is still bound to the<br>  timeout defined by “timeout http-keep-alive” or “timeout http-request” if<br>  not set.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  it disables and replaces any previous “option httpclose”, “option forceclose”,<br>  “option http-tunnel” or “option http-keep-alive”. please check section 4<br>  (“proxies”) to see how this option combines with others when frontend and<br>  backend options differ.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-pretend-keepalive”,<br>             “option httpclose”, “option http-keep-alive”, and<br>             “1.1. the http transaction model”.</p>\n<p>option http-tunnel<br>no option http-tunnel<br>  disable or enable http connection processing after first transaction<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”.</p>\n<p>  option “http-tunnel” disables any http processing past the first request and<br>  the first response. this is the mode which was used by default in versions<br>  1.0 to 1.5-dev21. it is the mode with the lowest processing overhead, which<br>  is normally not needed anymore unless in very specific cases such as when<br>  using an in-house protocol that looks like http but is not compatible, or<br>  just to log one request per client in order to reduce log size. note that<br>  everything which works at the http level, including header parsing/addition,<br>  cookie processing or content switching will only work for the first request<br>  and will be ignored after the first response.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close”,<br>             “option httpclose”, “option http-keep-alive”, and<br>             “1.1. the http transaction model”.</p>\n<p>option http-use-proxy-header<br>no option http-use-proxy-header<br>  make use of non-standard proxy-connection header instead of connection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  while rfc2616 explicitly states that http/1.1 agents must use the<br>  connection header to indicate their wish of persistent or non-persistent<br>  connections, both browsers and proxies ignore this header for proxied<br>  connections and make use of the undocumented, non-standard proxy-connection<br>  header instead. the issue begins when trying to put a load balancer between<br>  browsers and such proxies, because there will be a difference between what<br>  haproxy understands and what the client and the proxy agree on.</p>\n<p>  by setting this option in a frontend, haproxy can automatically switch to use<br>  that non-standard header if it sees proxied requests. a proxied request is<br>  defined here as one where the uri begins with neither a ‘/‘ nor a ‘*’. the<br>  choice of header only affects requests passing through proxies making use of<br>  one of the “httpclose”, “forceclose” and “http-server-close” options. note<br>  that this option can only be specified in a frontend and will affect the<br>  request along its whole life.</p>\n<p>  also, when this option is set, a request which requires authentication will<br>  automatically switch to use proxy authentication headers if it is itself a<br>  proxied request. that makes it possible to check or enforce authentication in<br>  front of an existing proxy.</p>\n<p>  this option should normally never be used, except in front of a proxy.</p>\n<p>  see also : “option httpclose”, “option forceclose” and “option<br>             http-server-close”.</p>\n<p>option httpchk<br>option httpchk <uri><br>option httpchk <method> <uri><br>option httpchk <method> <uri> <version><br>  enable http protocol to check on the servers health<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <method>  is the optional http method used with the requests. when not set,<br>              the “options” method is used, as it generally requires low server<br>              processing and is easy to filter out from the logs. any method<br>              may be used, though it is not recommended to invent non-standard<br>              ones.</method></version></uri></method></uri></method></uri></p>\n<pre><code>&lt;uri&gt;     is the uri referenced in the http requests. it defaults to &quot; / &quot;\n          which is accessible by default on almost any server, but may be\n          changed to any other uri. query strings are permitted.\n\n&lt;version&gt; is the optional http version string. it defaults to &quot;http/1.0&quot;\n          but some servers might behave incorrectly in http 1.0, so turning\n          it to http/1.1 may sometimes help. note that the host field is\n          mandatory in http/1.1, and as a trick, it is possible to pass it\n          after &quot;\\r\\n&quot; following the version string.\n</code></pre><p>  by default, server health checks only consist in trying to establish a tcp<br>  connection. when “option httpchk” is specified, a complete http request is<br>  sent once the tcp connection is established, and responses 2xx and 3xx are<br>  considered valid, while all other ones indicate a server failure, including<br>  the lack of any response.</p>\n<p>  the port and interval are specified in the server configuration.</p>\n<p>  this option does not necessarily require an http backend, it also works with<br>  plain tcp backends. this is particularly useful to check simple scripts bound<br>  to some dedicated ports using the inetd daemon.</p>\n<p>  examples :</p>\n<pre><code># relay https traffic to apache instance and check service availability\n# using http request &quot;options * http/1.1&quot; on port 80.\nbackend https_relay\n    mode tcp\n    option httpchk options * http/1.1\\r\\nhost:\\ www\n    server apache1 192.168.1.1:443 check port 80\n</code></pre><p>  see also : “option ssl-hello-chk”, “option smtpchk”, “option mysql-check”,<br>             “option pgsql-check”, “http-check” and the “check”, “port” and<br>             “inter” server options.</p>\n<p>option httpclose<br>no option httpclose<br>  enable or disable passive http connection closing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”.</p>\n<p>  if “option httpclose” is set, haproxy will work in http tunnel mode and check<br>  if a “connection: close” header is already set in each direction, and will<br>  add one if missing. each end should react to this by actively closing the tcp<br>  connection after each transfer, thus resulting in a switch to the http close<br>  mode. any “connection” header different from “close” will also be removed.<br>  note that this option is deprecated since what it does is very cheap but not<br>  reliable. using “option http-server-close” or “option forceclose” is strongly<br>  recommended instead.</p>\n<p>  it seldom happens that some servers incorrectly ignore this header and do not<br>  close the connection even though they reply “connection: close”. for this<br>  reason, they are not compatible with older http 1.0 browsers. if this happens<br>  it is possible to use the “option forceclose” which actively closes the<br>  request connection once the server responds. option “forceclose” also<br>  releases the server connection earlier because it does not have to wait for<br>  the client to acknowledge it.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  it disables and replaces any previous “option http-server-close”,<br>  “option forceclose”, “option http-keep-alive” or “option http-tunnel”. please<br>  check section 4 (“proxies”) to see how this option combines with others when<br>  frontend and backend options differ.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close” and<br>             “1.1. the http transaction model”.</p>\n<p>option httplog [ clf ]<br>  enable logging of http request, session state and timers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    clf       if the “clf” argument is added, then the output format will be<br>              the clf format instead of haproxy’s default http format. you can<br>              use this when you need to feed haproxy’s logs through a specific<br>              log analyser which only support the clf format and which is not<br>              extensible.</p>\n<p>  by default, the log output format is very poor, as it only contains the<br>  source and destination addresses, and the instance name. by specifying<br>  “option httplog”, each log line turns into a much richer format including,<br>  but not limited to, the http request, the connection timers, the session<br>  status, the connections numbers, the captured headers and cookies, the<br>  frontend, backend and server name, and of course the source address and<br>  ports.</p>\n<p>  this option may be set either in the frontend or the backend.</p>\n<p>  specifying only “option httplog” will automatically clear the ‘clf’ mode<br>  if it was set by default.</p>\n<p>  see also :  section 8 about logging.</p>\n<p>option http_proxy<br>no option http_proxy<br>  enable or disable plain http proxy mode<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  it sometimes happens that people need a pure http proxy which understands<br>  basic proxy requests without caching nor any fancy feature. in this case,<br>  it may be worth setting up an haproxy instance with the “option http_proxy”<br>  set. in this mode, no server is declared, and the connection is forwarded to<br>  the ip address and port found in the url after the “http://“ scheme.</p>\n<p>  no host address resolution is performed, so this only works when pure ip<br>  addresses are passed. since this option’s usage perimeter is rather limited,<br>  it will probably be used only by experts who know they need exactly it. last,<br>  if the clients are susceptible of sending keep-alive requests, it will be<br>  needed to add “option httpclose” to ensure that all requests will correctly<br>  be analyzed.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  example :</p>\n<pre><code># this backend understands http proxy requests and forwards them directly.\nbackend direct_forward\n    option httpclose\n    option http_proxy\n</code></pre><p>  see also : “option httpclose”</p>\n<p>option independent-streams<br>no option independent-streams<br>  enable or disable independent timeout processing for both directions<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |  yes<br>  arguments : none</p>\n<p>  by default, when data is sent over a socket, both the write timeout and the<br>  read timeout for that socket are refreshed, because we consider that there is<br>  activity on that socket, and we have no other means of guessing if we should<br>  receive data or not.</p>\n<p>  while this default behaviour is desirable for almost all applications, there<br>  exists a situation where it is desirable to disable it, and only refresh the<br>  read timeout if there are incoming data. this happens on sessions with large<br>  timeouts and low amounts of exchanged data such as telnet session. if the<br>  server suddenly disappears, the output data accumulates in the system’s<br>  socket buffers, both timeouts are correctly refreshed, and there is no way<br>  to know the server does not receive them, so we don’t timeout. however, when<br>  the underlying protocol always echoes sent data, it would be enough by itself<br>  to detect the issue using the read timeout. note that this problem does not<br>  happen with more verbose protocols because data won’t accumulate long in the<br>  socket buffers.</p>\n<p>  when this option is set on the frontend, it will disable read timeout updates<br>  on data sent to the client. there probably is little use of this case. when<br>  the option is set on the backend, it will disable read timeout updates on<br>  data sent to the server. doing so will typically break large http posts from<br>  slow lines, so use it with caution.</p>\n<p>  note: older versions used to call this setting “option independent-streams”<br>        with a spelling mistake. this spelling is still supported but<br>        deprecated.</p>\n<p>  see also : “timeout client”, “timeout server” and “timeout tunnel”</p>\n<p>option ldap-check<br>  use ldapv3 health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  it is possible to test that the server correctly talks ldapv3 instead of just<br>  testing that it accepts the tcp connection. when this option is set, an<br>  ldapv3 anonymous simple bind message is sent to the server, and the response<br>  is analyzed to find an ldapv3 bind response message.</p>\n<p>  the server is considered valid only when the ldap response contains success<br>  resultcode (<a href=\"http://tools.ietf.org/html/rfc4511#section-4.1.9\" target=\"_blank\" rel=\"external\">http://tools.ietf.org/html/rfc4511#section-4.1.9</a>).</p>\n<p>  logging of bind requests is server dependent see your documentation how to<br>  configure it.</p>\n<p>  example :<br>        option ldap-check</p>\n<p>  see also : “option httpchk”</p>\n<p>option external-check<br>  use external processes for server health checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  it is possible to test the health of a server using an external command.<br>  this is achieved by running the executable set using “external-check<br>  command”.</p>\n<p>  requires the “external-check” global to be set.</p>\n<p>  see also : “external-check”, “external-check command”, “external-check path”</p>\n<p>option log-health-checks<br>no option log-health-checks<br>  enable or disable logging of health checks status updates<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |  yes<br>  arguments : none</p>\n<p>  by default, failed health check are logged if server is up and successful<br>  health checks are logged if server is down, so the amount of additional<br>  information is limited.</p>\n<p>  when this option is enabled, any change of the health check status or to<br>  the server’s health will be logged, so that it becomes possible to know<br>  that a server was failing occasional checks before crashing, or exactly when<br>  it failed to respond a valid http status, then when the port started to<br>  reject connections, then when the server stopped responding at all.</p>\n<p>  note that status changes not caused by health checks (eg: enable/disable on<br>  the cli) are intentionally not logged by this option.</p>\n<p>  see also: “option httpchk”, “option ldap-check”, “option mysql-check”,<br>            “option pgsql-check”, “option redis-check”, “option smtpchk”,<br>            “option tcp-check”, “log” and section 8 about logging.</p>\n<p>option log-separate-errors<br>no option log-separate-errors<br>  change log level for non-completely successful connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  sometimes looking for errors in logs is not easy. this option makes haproxy<br>  raise the level of logs containing potentially interesting information such<br>  as errors, timeouts, retries, redispatches, or http status codes 5xx. the<br>  level changes from “info” to “err”. this makes it possible to log them<br>  separately to a different file with most syslog daemons. be careful not to<br>  remove them from the original file, otherwise you would lose ordering which<br>  provides very important information.</p>\n<p>  using this option, large sites dealing with several thousand connections per<br>  second may log normal traffic to a rotating buffer and only archive smaller<br>  error logs.</p>\n<p>  see also : “log”, “dontlognull”, “dontlog-normal” and section 8 about<br>             logging.</p>\n<p>option logasap<br>no option logasap<br>  enable or disable early logging of http requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, http requests are logged upon termination so that the total<br>  transfer time and the number of bytes appear in the logs. when large objects<br>  are being transferred, it may take a while before the request appears in the<br>  logs. using “option logasap”, the request gets logged as soon as the server<br>  sends the complete headers. the only missing information in the logs will be<br>  the total number of bytes which will indicate everything except the amount<br>  of data transferred, and the total time which will not take the transfer<br>  time into account. in such a situation, it’s a good practice to capture the<br>  “content-length” response header so that the logs at least indicate how many<br>  bytes are expected to be transferred.</p>\n<p>  examples :<br>      listen http_proxy 0.0.0.0:80<br>          mode http<br>          option httplog<br>          option logasap<br>          log 192.168.2.200 local3</p>\n<pre><code>&gt;&gt;&gt; feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n      static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \\\n      &quot;get /image.iso http/1.0&quot;\n</code></pre><p>  see also : “option httplog”, “capture response header”, and section 8 about<br>             logging.</p>\n<p>option mysql-check [ user <username> [ post-41 ] ]<br>  use mysql health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <username> this is the username which will be used when connecting to mysql<br>               server.<br>    post-41    send post v4.1 client compatible checks</username></username></p>\n<p>  if you specify a username, the check consists of sending two mysql packet,<br>  one client authentication packet, and one quit packet, to correctly close<br>  mysql session. we then parse the mysql handshake initialisation packet and/or<br>  error packet. it is a basic but useful test which does not produce error nor<br>  aborted connect on the server. however, it requires adding an authorization<br>  in the mysql table, like this :</p>\n<pre><code>use mysql;\ninsert into user (host,user) values (&apos;&lt;ip_of_haproxy&gt;&apos;,&apos;&lt;username&gt;&apos;);\nflush privileges;\n</code></pre><p>  if you don’t specify a username (it is deprecated and not recommended), the<br>  check only consists in parsing the mysql handshake initialisation packet or<br>  error packet, we don’t send anything in this mode. it was reported that it<br>  can generate lockout if check is too frequent and/or if there is not enough<br>  traffic. in fact, you need in this case to check mysql “max_connect_errors”<br>  value as if a connection is established successfully within fewer than mysql<br>  “max_connect_errors” attempts after a previous connection was interrupted,<br>  the error count for the host is cleared to zero. if haproxy’s server get<br>  blocked, the “flush hosts” statement is the only way to unblock it.</p>\n<p>  remember that this does not check database presence nor database consistency.<br>  to do this, you can use an external check with xinetd for example.</p>\n<p>  the check requires mysql &gt;=3.22, for older version, please use tcp check.</p>\n<p>  most often, an incoming mysql server needs to see the client’s ip address for<br>  various purposes, including ip privilege matching and connection logging.<br>  when possible, it is often wise to masquerade the client’s ip address when<br>  connecting to the server using the “usesrc” argument of the “source” keyword,<br>  which requires the cttproxy feature to be compiled in, and the mysql server<br>  to route the client via the machine hosting haproxy.</p>\n<p>  see also: “option httpchk”</p>\n<p>option nolinger<br>no option nolinger<br>  enable or disable immediate session resource cleaning after close<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when clients or servers abort connections in a dirty way (eg: they are<br>  physically disconnected), the session timeouts triggers and the session is<br>  closed. but it will remain in fin_wait1 state for some time in the system,<br>  using some resources and possibly limiting the ability to establish newer<br>  connections.</p>\n<p>  when this happens, it is possible to activate “option nolinger” which forces<br>  the system to immediately remove any socket’s pending data on close. thus,<br>  the session is instantly purged from the system’s tables. this usually has<br>  side effects such as increased number of tcp resets due to old retransmits<br>  getting immediately rejected. some firewalls may sometimes complain about<br>  this too.</p>\n<p>  for this reason, it is not recommended to use this option when not absolutely<br>  needed. you know that you need it when you have thousands of fin_wait1<br>  sessions on your system (time_wait ones do not count).</p>\n<p>  this option may be used both on frontends and backends, depending on the side<br>  where it is required. use it on the frontend for clients, and on the backend<br>  for servers.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option originalto [ except <network> ] [ header <name> ]<br>  enable insertion of the x-original-to header to requests sent to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <network> is an optional argument used to disable this option for sources<br>              matching <network><br>    <name>    an optional argument to specify a different “x-original-to”<br>              header name.</name></network></network></name></network></p>\n<p>  since haproxy can work in transparent mode, every request from a client can<br>  be redirected to the proxy and haproxy itself can proxy every request to a<br>  complex squid environment and the destination host from so_original_dst will<br>  be lost. this is annoying when you want access rules based on destination ip<br>  addresses. to solve this problem, a new http header “x-original-to” may be<br>  added by haproxy to all requests sent to the server. this header contains a<br>  value representing the original destination ip address. since this must be<br>  configured to always use the last occurrence of this header only. note that<br>  only the last occurrence of the header must be used, since it is really<br>  possible that the client has already brought one.</p>\n<p>  the keyword “header” may be used to supply a different header name to replace<br>  the default “x-original-to”. this can be useful where you might already<br>  have a “x-original-to” header from a different application, and you need<br>  preserve it. also if your backend server doesn’t use the “x-original-to”<br>  header and requires different one.</p>\n<p>  sometimes, a same haproxy instance may be shared between a direct client<br>  access and a reverse-proxy access (for instance when an ssl reverse-proxy is<br>  used to decrypt https traffic). it is possible to disable the addition of the<br>  header for a known source address or network by adding the “except” keyword<br>  followed by the network address. in this case, any source ip matching the<br>  network will not cause an addition of this header. most common uses are with<br>  private networks or 127.0.0.1.</p>\n<p>  this option may be specified either in the frontend or in the backend. if at<br>  least one of them uses it, the header will be added. note that the backend’s<br>  setting of the header subargument takes precedence over the frontend’s if<br>  both are defined.</p>\n<p>  examples :</p>\n<pre><code># original destination address\nfrontend www\n    mode http\n    option originalto except 127.0.0.1\n\n# those servers want the ip address in x-client-dst\nbackend www\n    mode http\n    option originalto header x-client-dst\n</code></pre><p>  see also : “option httpclose”, “option http-server-close”,<br>             “option forceclose”</p>\n<p>option persist<br>no option persist<br>  enable or disable forced persistence on down servers<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when an http request reaches a backend with a cookie which references a dead<br>  server, by default it is redispatched to another server. it is possible to<br>  force the request to be sent to the dead server first using “option persist”<br>  if absolutely needed. a common use case is when servers are under extreme<br>  load and spend their time flapping. in this case, the users would still be<br>  directed to the server they opened the session on, in the hope they would be<br>  correctly served. it is recommended to use “option redispatch” in conjunction<br>  with this option so that in the event it would not be possible to connect to<br>  the server at all (server definitely dead), the client would finally be<br>  redirected to another valid server.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option redispatch”, “retries”, “force-persist”</p>\n<p>option pgsql-check [ user <username> ]<br>  use postgresql health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <username> this is the username which will be used when connecting to<br>               postgresql server.</username></username></p>\n<p>  the check sends a postgresql startupmessage and waits for either<br>  authentication request or errorresponse message. it is a basic but useful<br>  test which does not produce error nor aborted connect on the server.<br>  this check is identical with the “mysql-check”.</p>\n<p>  see also: “option httpchk”</p>\n<p>option prefer-last-server<br>no option prefer-last-server<br>  allow multiple load balanced requests to remain on the same server<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when the load balancing algorithm in use is not deterministic, and a previous<br>  request was sent to a server to which haproxy still holds a connection, it is<br>  sometimes desirable that subsequent requests on a same session go to the same<br>  server as much as possible. note that this is different from persistence, as<br>  we only indicate a preference which haproxy tries to apply without any form<br>  of warranty. the real use is for keep-alive connections sent to servers. when<br>  this option is used, haproxy will try to reuse the same connection that is<br>  attached to the server instead of rebalancing to another server, causing a<br>  close of the connection. this can make sense for static file servers. it does<br>  not make much sense to use this in combination with hashing algorithms. note,<br>  haproxy already automatically tries to stick to a server which sends a 401 or<br>  to a proxy which sends a 407 (authentication required). this is mandatory for<br>  use with the broken ntlm authentication challenge, and significantly helps in<br>  troubleshooting some faulty applications. option prefer-last-server might be<br>  desirable in these environments as well, to avoid redistributing the traffic<br>  after every other response.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also: “option http-keep-alive”</p>\n<p>option redispatch<br>option redispatch <interval><br>no option redispatch<br>  enable or disable session redistribution in case of connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <interval> the optional integer value that controls how often redispatches<br>               occur when retrying connections. positive value p indicates a<br>               redispatch is desired on every pth retry, and negative value<br>               n indicate a redispath is desired on the nth retry prior to the<br>               last retry. for example, the default of -1 preserves the<br>               historical behaviour of redispatching on the last retry, a<br>               positive value of 1 would indicate a redispatch on every retry,<br>               and a positive value of 3 would indicate a redispatch on every<br>               third retry. you can disable redispatches with a value of 0.</interval></interval></p>\n<p>  in http mode, if a server designated by a cookie is down, clients may<br>  definitely stick to it because they cannot flush the cookie, so they will not<br>  be able to access the service anymore.</p>\n<p>  specifying “option redispatch” will allow the proxy to break their<br>  persistence and redistribute them to a working server.</p>\n<p>  it also allows to retry connections to another server in case of multiple<br>  connection failures. of course, it requires having “retries” set to a nonzero<br>  value.</p>\n<p>  this form is the preferred form, which replaces both the “redispatch” and<br>  “redisp” keywords.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “redispatch”, “retries”, “force-persist”</p>\n<p>option redis-check<br>  use redis health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  it is possible to test that the server correctly talks redis protocol instead<br>  of just testing that it accepts the tcp connection. when this option is set,<br>  a ping redis command is sent to the server, and the response is analyzed to<br>  find the “+pong” response message.</p>\n<p>  example :<br>        option redis-check</p>\n<p>  see also : “option httpchk”</p>\n<p>option smtpchk<br>option smtpchk <hello> <domain><br>  use smtp health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <hello>   is an optional argument. it is the “hello” command to use. it can<br>              be either “helo” (for smtp) or “ehlo” (for estmp). all other<br>              values will be turned into the default command (“helo”).</hello></domain></hello></p>\n<pre><code>&lt;domain&gt;  is the domain name to present to the server. it may only be\n          specified (and is mandatory) if the hello command has been\n          specified. by default, &quot;localhost&quot; is used.\n</code></pre><p>  when “option smtpchk” is set, the health checks will consist in tcp<br>  connections followed by an smtp command. by default, this command is<br>  “helo localhost”. the server’s return code is analyzed and only return codes<br>  starting with a “2” will be considered as valid. all other responses,<br>  including a lack of response will constitute an error and will indicate a<br>  dead server.</p>\n<p>  this test is meant to be used with smtp servers or relays. depending on the<br>  request, it is possible that some servers do not log each connection attempt,<br>  so you may want to experiment to improve the behaviour. using telnet on port<br>  25 is often easier than adjusting the configuration.</p>\n<p>  most often, an incoming smtp server needs to see the client’s ip address for<br>  various purposes, including spam filtering, anti-spoofing and logging. when<br>  possible, it is often wise to masquerade the client’s ip address when<br>  connecting to the server using the “usesrc” argument of the “source” keyword,<br>  which requires the cttproxy feature to be compiled in.</p>\n<p>  example :<br>        option smtpchk helo mydomain.org</p>\n<p>  see also : “option httpchk”, “source”</p>\n<p>option socket-stats<br>no option socket-stats</p>\n<p>  enable or disable collecting &amp; providing separate statistics for each socket.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no</p>\n<p>  arguments : none</p>\n<p>option splice-auto<br>no option splice-auto<br>  enable or disable automatic kernel acceleration on sockets in both directions<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will automatically evaluate the opportunity to use kernel tcp splicing to<br>  forward data between the client and the server, in either direction. haproxy<br>  uses heuristics to estimate if kernel splicing might improve performance or<br>  not. both directions are handled independently. note that the heuristics used<br>  are not much aggressive in order to limit excessive use of splicing. this<br>  option requires splicing to be enabled at compile time, and may be globally<br>  disabled with the global option “nosplice”. since splice uses pipes, using it<br>  requires that there are enough spare pipes.</p>\n<p>  important note: kernel-based tcp splicing is a linux-specific feature which<br>  first appeared in kernel 2.6.25. it offers kernel-based acceleration to<br>  transfer data between sockets without copying these data to user-space, thus<br>  providing noticeable performance gains and cpu cycles savings. since many<br>  early implementations are buggy, corrupt data and/or are inefficient, this<br>  feature is not enabled by default, and it should be used with extreme care.<br>  while it is not possible to detect the correctness of an implementation,<br>  2.6.29 is the first version offering a properly working implementation. in<br>  case of doubt, splicing may be globally disabled using the global “nosplice”<br>  keyword.</p>\n<p>  example :<br>        option splice-auto</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-request”, “option splice-response”, and global<br>             options “nosplice” and “maxpipes”</p>\n<p>option splice-request<br>no option splice-request<br>  enable or disable automatic kernel acceleration on sockets for requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will use kernel tcp splicing whenever possible to forward data going from<br>  the client to the server. it might still use the recv/send scheme if there<br>  are no spare pipes left. this option requires splicing to be enabled at<br>  compile time, and may be globally disabled with the global option “nosplice”.<br>  since splice uses pipes, using it requires that there are enough spare pipes.</p>\n<p>  important note: see “option splice-auto” for usage limitations.</p>\n<p>  example :<br>        option splice-request</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-auto”, “option splice-response”, and global options<br>             “nosplice” and “maxpipes”</p>\n<p>option splice-response<br>no option splice-response<br>  enable or disable automatic kernel acceleration on sockets for responses<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will use kernel tcp splicing whenever possible to forward data going from<br>  the server to the client. it might still use the recv/send scheme if there<br>  are no spare pipes left. this option requires splicing to be enabled at<br>  compile time, and may be globally disabled with the global option “nosplice”.<br>  since splice uses pipes, using it requires that there are enough spare pipes.</p>\n<p>  important note: see “option splice-auto” for usage limitations.</p>\n<p>  example :<br>        option splice-response</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-auto”, “option splice-request”, and global options<br>             “nosplice” and “maxpipes”</p>\n<p>option srvtcpka<br>no option srvtcpka<br>  enable or disable the sending of tcp keepalive packets on the server side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “srvtcpka” enables the emission of tcp keep-alive probes on the<br>  server side of a connection, which should help when session expirations are<br>  noticed between haproxy and a server.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option clitcpka”, “option tcpka”</p>\n<p>option ssl-hello-chk<br>  use sslv3 client hello health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when some ssl-based protocols are relayed in tcp mode through haproxy, it is<br>  possible to test that the server correctly talks ssl instead of just testing<br>  that it accepts the tcp connection. when “option ssl-hello-chk” is set, pure<br>  sslv3 client hello messages are sent once the connection is established to<br>  the server, and the response is analyzed to find an ssl server hello message.<br>  the server is considered valid only when the response contains this server<br>  hello message.</p>\n<p>  all servers tested till there correctly reply to sslv3 client hello messages,<br>  and most servers tested do not even log the requests containing only hello<br>  messages, which is appreciable.</p>\n<p>  note that this check works even when ssl support was not built into haproxy<br>  because it forges the ssl message. when ssl support is available, it is best<br>  to use native ssl health checks instead of this one.</p>\n<p>  see also: “option httpchk”, “check-ssl”</p>\n<p>option tcp-check<br>  perform health checks using tcp-check send/expect sequences<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               yes    |    no    |   yes  |   yes</p>\n<p>  this health check method is intended to be combined with “tcp-check” command<br>  lists in order to support send/expect types of health check sequences.</p>\n<p>  tcp checks currently support 4 modes of operations :</p>\n<pre><code>- no &quot;tcp-check&quot; directive : the health check only consists in a connection\n  attempt, which remains the default mode.\n\n- &quot;tcp-check send&quot; or &quot;tcp-check send-binary&quot; only is mentioned : this is\n  used to send a string along with a connection opening. with some\n  protocols, it helps sending a &quot;quit&quot; message for example that prevents\n  the server from logging a connection error for each health check. the\n  check result will still be based on the ability to open the connection\n  only.\n\n- &quot;tcp-check expect&quot; only is mentioned : this is used to test a banner.\n  the connection is opened and haproxy waits for the server to present some\n  contents which must validate some rules. the check result will be based\n  on the matching between the contents and the rules. this is suited for\n  pop, imap, smtp, ftp, ssh, telnet.\n\n- both &quot;tcp-check send&quot; and &quot;tcp-check expect&quot; are mentioned : this is\n  used to test a hello-type protocol. haproxy sends a message, the server\n  responds and its response is analysed. the check result will be based on\n  the matching between the response contents and the rules. this is often\n  suited for protocols which require a binding or a request/response model.\n  ldap, mysql, redis and ssl are example of such protocols, though they\n  already all have their dedicated checks with a deeper understanding of\n  the respective protocols.\n  in this mode, many questions may be sent and many answers may be\n  analysed.\n\na fifth mode can be used to insert comments in different steps of the\nscript.\n\nfor each tcp-check rule you create, you can add a &quot;comment&quot; directive,\nfollowed by a string. this string will be reported in the log and stderr\nin debug mode. it is useful to make user-friendly error reporting.\nthe &quot;comment&quot; is of course optional.\n</code></pre><p>  examples :</p>\n<pre><code># perform a pop check (analyse only server&apos;s banner)\noption tcp-check\ntcp-check expect string +ok\\ pop3\\ ready comment pop\\ protocol\n\n# perform an imap check (analyse only server&apos;s banner)\noption tcp-check\ntcp-check expect string *\\ ok\\ imap4\\ ready comment imap\\ protocol\n\n# look for the redis master server after ensuring it speaks well\n# redis protocol, then it exits properly.\n# (send a command then analyse the response 3 times)\noption tcp-check\ntcp-check comment ping\\ phase\ntcp-check send ping\\r\\n\ntcp-check expect +ponge\ntcp-check comment role\\ check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check comment quit\\ phase\ntcp-check send quit\\r\\n\ntcp-check expect string +ok\n\nforge a http request, then analyse the response\n(send many headers before analyzing)\noption tcp-check\ntcp-check comment forge\\ and\\ send\\ http\\ request\ntcp-check send head\\ /\\ http/1.1\\r\\n\ntcp-check send host:\\ www.mydomain.com\\r\\n\ntcp-check send user-agent:\\ haproxy\\ tcpcheck\\r\\n\ntcp-check send \\r\\n\ntcp-check expect rstring http/1\\..\\ (2..|3..) comment check\\ http\\ response\n</code></pre><p>  see also : “tcp-check expect”, “tcp-check send”</p>\n<p>option tcp-smart-accept<br>no option tcp-smart-accept<br>  enable or disable the saving of one ack packet during the accept sequence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |    no<br>  arguments : none</p>\n<p>  when an http connection request comes in, the system acknowledges it on<br>  behalf of haproxy, then the client immediately sends its request, and the<br>  system acknowledges it too while it is notifying haproxy about the new<br>  connection. haproxy then reads the request and responds. this means that we<br>  have one tcp ack sent by the system for nothing, because the request could<br>  very well be acknowledged by haproxy when it sends its response.</p>\n<p>  for this reason, in http mode, haproxy automatically asks the system to avoid<br>  sending this useless ack on platforms which support it (currently at least<br>  linux). it must not cause any problem, because the system will send it anyway<br>  after 40 ms if the response takes more time than expected to come.</p>\n<p>  during complex network debugging sessions, it may be desirable to disable<br>  this optimization because delayed acks can make troubleshooting more complex<br>  when trying to identify where packets are delayed. it is then possible to<br>  fall back to normal behaviour by specifying “no option tcp-smart-accept”.</p>\n<p>  it is also possible to force it for non-http proxies by simply specifying<br>  “option tcp-smart-accept”. for instance, it can make sense with some services<br>  such as smtp where the server speaks first.</p>\n<p>  it is recommended to avoid forcing this option in a defaults section. in case<br>  of doubt, consider setting it back to automatic values by prepending the<br>  “default” keyword before it, or disabling it using the “no” keyword.</p>\n<p>  see also : “option tcp-smart-connect”</p>\n<p>option tcp-smart-connect<br>no option tcp-smart-connect<br>  enable or disable the saving of one ack packet during the connect sequence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  on certain systems (at least linux), haproxy can ask the kernel not to<br>  immediately send an empty ack upon a connection request, but to directly<br>  send the buffer request instead. this saves one packet on the network and<br>  thus boosts performance. it can also be useful for some servers, because they<br>  immediately get the request along with the incoming connection.</p>\n<p>  this feature is enabled when “option tcp-smart-connect” is set in a backend.<br>  it is not enabled by default because it makes network troubleshooting more<br>  complex.</p>\n<p>  it only makes sense to enable it with protocols where the client speaks first<br>  such as http. in other situations, if there is no data to send in place of<br>  the ack, a normal ack is sent.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option tcp-smart-accept”</p>\n<p>option tcpka<br>  enable or disable the sending of tcp keepalive packets on both sides<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “tcpka” enables the emission of tcp keep-alive probes on both<br>  the client and server sides of a connection. note that this is meaningful<br>  only in “defaults” or “listen” sections. if this option is used in a<br>  frontend, only the client side will get keep-alives, and if this option is<br>  used in a backend, only the server side will get keep-alives. for this<br>  reason, it is strongly recommended to explicitly use “option clitcpka” and<br>  “option srvtcpka” when the configuration is split between frontends and<br>  backends.</p>\n<p>  see also : “option clitcpka”, “option srvtcpka”</p>\n<p>option tcplog<br>  enable advanced logging of tcp connections with session state and timers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the log output format is very poor, as it only contains the<br>  source and destination addresses, and the instance name. by specifying<br>  “option tcplog”, each log line turns into a much richer format including, but<br>  not limited to, the connection timers, the session status, the connections<br>  numbers, the frontend, backend and server name, and of course the source<br>  address and ports. this option is useful for pure tcp proxies in order to<br>  find which of the client or server disconnects or times out. for normal http<br>  proxies, it’s better to use “option httplog” which is even more complete.</p>\n<p>  this option may be set either in the frontend or the backend.</p>\n<p>  see also :  “option httplog”, and section 8 about logging.</p>\n<p>option transparent<br>no option transparent<br>  enable client-side transparent proxying<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  this option was introduced in order to provide layer 7 persistence to layer 3<br>  load balancers. the idea is to use the os’s ability to redirect an incoming<br>  connection for a remote address to a local process (here haproxy), and let<br>  this process know what address was initially requested. when this option is<br>  used, sessions without cookies will be forwarded to the original destination<br>  ip address of the incoming request (which should match that of another<br>  equipment), while requests with cookies will still be forwarded to the<br>  appropriate server.</p>\n<p>  note that contrary to a common belief, this option does not make haproxy<br>  present the client’s ip to the server when establishing the connection.</p>\n<p>  see also: the “usesrc” argument of the “source” keyword, and the<br>            “transparent” option of the “bind” keyword.</p>\n<p>external-check command <command><br>  executable to run when performing an external-check<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <command> is the external command to run</p>\n<p>  the arguments passed to the to the command are:</p>\n<p>  <proxy_address> <proxy_port> <server_address> <server_port></server_port></server_address></proxy_port></proxy_address></p>\n<p>  the <proxy_address> and <proxy_port> are derived from the first listener<br>  that is either ipv4, ipv6 or a unix socket. in the case of a unix socket<br>  listener the proxy_address will be the path of the socket and the<br>  <proxy_port> will be the string “not_used”. in a backend section, it’s not<br>  possible to determine a listener, and both <proxy_address> and <proxy_port><br>  will have the string value “not_used”.</proxy_port></proxy_address></proxy_port></proxy_port></proxy_address></p>\n<p>  some values are also provided through environment variables.</p>\n<p>  environment variables :<br>    haproxy_proxy_addr      the first bind address if available (or empty if not<br>                            applicable, for example in a “backend” section).</p>\n<pre><code>haproxy_proxy_id        the backend id.\n\nhaproxy_proxy_name      the backend name.\n\nhaproxy_proxy_port      the first bind port if available (or empty if not\n                        applicable, for example in a &quot;backend&quot; section or\n                        for a unix socket).\n\nhaproxy_server_addr     the server address.\n\nhaproxy_server_curconn  the current number of connections on the server.\n\nhaproxy_server_id       the server id.\n\nhaproxy_server_maxconn  the server max connections.\n\nhaproxy_server_name     the server name.\n\nhaproxy_server_port     the server port if available (or empty for a unix\n                        socket).\n\npath                    the path environment variable used when executing\n                        the command may be set using &quot;external-check path&quot;.\n</code></pre><p>  if the command executed and exits with a zero status then the check is<br>  considered to have passed, otherwise the check is considered to have<br>  failed.</p>\n<p>  example :<br>        external-check command /bin/true</p>\n<p>  see also : “external-check”, “option external-check”, “external-check path”</p>\n<p>external-check path <path></path><br>  the value of the path environment variable used when running an external-check<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <path></path> is the path used when executing external command to run</p>\n<p>  the default path is “”.</p>\n<p>  example :<br>        external-check path “/usr/bin:/bin”</p>\n<p>  see also : “external-check”, “option external-check”,<br>             “external-check command”</p>\n<p>persist rdp-cookie<br>persist rdp-cookie(<name>)<br>  enable rdp cookie-based persistence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the optional name of the rdp cookie to check. if omitted, the<br>              default cookie name “msts” will be used. there currently is no<br>              valid reason to change this name.</name></name></p>\n<p>  this statement enables persistence based on an rdp cookie. the rdp cookie<br>  contains all information required to find the server in the list of known<br>  servers. so when this option is set in the backend, the request is analysed<br>  and if an rdp cookie is found, it is decoded. if it matches a known server<br>  which is still up (or if “option persist” is set), then the connection is<br>  forwarded to this server.</p>\n<p>  note that this only makes sense in a tcp backend, but for this to work, the<br>  frontend must have waited long enough to ensure that an rdp cookie is present<br>  in the request buffer. this is the same requirement as with the “rdp-cookie”<br>  load-balancing method. thus it is highly recommended to put all statements in<br>  a single “listen” section.</p>\n<p>  also, it is important to understand that the terminal server will emit this<br>  rdp cookie only if it is configured for “token redirection mode”, which means<br>  that the “ip address redirection” option is disabled.</p>\n<p>  example :<br>        listen tse-farm<br>            bind :3389</p>\n<pre><code># wait up to 5s for an rdp cookie in the request\ntcp-request inspect-delay 5s\ntcp-request content accept if rdp_cookie\n# apply rdp cookie persistence\npersist rdp-cookie\n# if server is unknown, let&apos;s balance on the same cookie.\n# alternatively, &quot;balance leastconn&quot; may be useful too.\nbalance rdp-cookie\nserver srv1 1.1.1.1:3389\nserver srv2 1.1.1.2:3389\n</code></pre><p>  see also : “balance rdp-cookie”, “tcp-request”, the “req_rdp_cookie” acl and<br>  the rdp_cookie pattern fetch function.</p>\n<p>rate-limit sessions <rate><br>  set a limit on the number of new sessions accepted per second on a frontend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <rate>    the <rate> parameter is an integer designating the maximum number<br>              of new sessions per second to accept on the frontend.</rate></rate></rate></p>\n<p>  when the frontend reaches the specified number of new sessions per second, it<br>  stops accepting new connections until the rate drops below the limit again.<br>  during this time, the pending sessions will be kept in the socket’s backlog<br>  (in system buffers) and haproxy will not even be aware that sessions are<br>  pending. when applying very low limit on a highly loaded service, it may make<br>  sense to increase the socket’s backlog using the “backlog” keyword.</p>\n<p>  this feature is particularly efficient at blocking connection-based attacks<br>  or service abuse on fragile servers. since the session rate is measured every<br>  millisecond, it is extremely accurate. also, the limit applies immediately,<br>  no delay is needed at all to detect the threshold.</p>\n<p>  example : limit the connection rate on smtp to 10 per second max<br>        listen smtp<br>            mode tcp<br>            bind :25<br>            rate-limit sessions 10<br>            server 127.0.0.1:1025</p>\n<p>  note : when the maximum rate is reached, the frontend’s status is not changed<br>         but its sockets appear as “waiting” in the statistics if the<br>         “socket-stats” option is enabled.</p>\n<p>  see also : the “backlog” keyword and the “fe_sess_rate” acl criterion.</p>\n<p>redirect location <loc> [code <code>] <option> [{if | unless} <condition>]<br>redirect prefix   <pfx> [code <code>] <option> [{if | unless} <condition>]<br>redirect scheme   <sch> [code <code>] <option> [{if | unless} <condition>]<br>  return an http redirection if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</condition></option></code></sch></condition></option></code></pfx></condition></option></code></loc></p>\n<p>  if/unless the condition is matched, the http request will lead to a redirect<br>  response. if no condition is specified, the redirect applies unconditionally.</p>\n<p>  arguments :<br>    <loc>     with “redirect location”, the exact value in <loc> is placed into<br>              the http “location” header. when used in an “http-request” rule,<br>              <loc> value follows the log-format rules and can include some<br>              dynamic values (see custom log format in section 8.2.4).</loc></loc></loc></p>\n<pre><code>&lt;pfx&gt;     with &quot;redirect prefix&quot;, the &quot;location&quot; header is built from the\n          concatenation of &lt;pfx&gt; and the complete uri path, including the\n          query string, unless the &quot;drop-query&quot; option is specified (see\n          below). as a special case, if &lt;pfx&gt; equals exactly &quot;/&quot;, then\n          nothing is inserted before the original uri. it allows one to\n          redirect to the same url (for instance, to insert a cookie). when\n          used in an &quot;http-request&quot; rule, &lt;pfx&gt; value follows the log-format\n          rules and can include some dynamic values (see custom log format\n          in section 8.2.4).\n\n&lt;sch&gt;     with &quot;redirect scheme&quot;, then the &quot;location&quot; header is built by\n          concatenating &lt;sch&gt; with &quot;://&quot; then the first occurrence of the\n          &quot;host&quot; header, and then the uri path, including the query string\n          unless the &quot;drop-query&quot; option is specified (see below). if no\n          path is found or if the path is &quot;*&quot;, then &quot;/&quot; is used instead. if\n          no &quot;host&quot; header is found, then an empty host component will be\n          returned, which most recent browsers interpret as redirecting to\n          the same host. this directive is mostly used to redirect http to\n          https. when used in an &quot;http-request&quot; rule, &lt;sch&gt; value follows\n          the log-format rules and can include some dynamic values (see\n          custom log format in section 8.2.4).\n\n&lt;code&gt;    the code is optional. it indicates which type of http redirection\n          is desired. only codes 301, 302, 303, 307 and 308 are supported,\n          with 302 used by default if no code is specified. 301 means\n          &quot;moved permanently&quot;, and a browser may cache the location. 302\n          means &quot;moved permanently&quot; and means that the browser should not\n          cache the redirection. 303 is equivalent to 302 except that the\n          browser will fetch the location with a get method. 307 is just\n          like 302 but makes it clear that the same method must be reused.\n          likewise, 308 replaces 301 if the same method must be used.\n\n&lt;option&gt;  there are several options which can be specified to adjust the\n          expected behaviour of a redirection :\n\n  - &quot;drop-query&quot;\n    when this keyword is used in a prefix-based redirection, then the\n    location will be set without any possible query-string, which is useful\n    for directing users to a non-secure page for instance. it has no effect\n    with a location-type redirect.\n\n  - &quot;append-slash&quot;\n    this keyword may be used in conjunction with &quot;drop-query&quot; to redirect\n    users who use a url not ending with a &apos;/&apos; to the same one with the &apos;/&apos;.\n    it can be useful to ensure that search engines will only see one url.\n    for this, a return code 301 is preferred.\n\n  - &quot;set-cookie name[=value]&quot;\n    a &quot;set-cookie&quot; header will be added with name (and optionally &quot;=value&quot;)\n    to the response. this is sometimes used to indicate that a user has\n    been seen, for instance to protect against some types of dos. no other\n    cookie option is added, so the cookie will be a session cookie. note\n    that for a browser, a sole cookie name without an equal sign is\n    different from a cookie with an equal sign.\n\n  - &quot;clear-cookie name[=]&quot;\n    a &quot;set-cookie&quot; header will be added with name (and optionally &quot;=&quot;), but\n    with the &quot;max-age&quot; attribute set to zero. this will tell the browser to\n    delete this cookie. it is useful for instance on logout pages. it is\n    important to note that clearing the cookie &quot;name&quot; will not remove a\n    cookie set with &quot;name=value&quot;. you have to clear the cookie &quot;name=&quot; for\n    that, because the browser makes the difference.\n</code></pre><p>  example: move the login url only to https.<br>        acl clear      dst_port  80<br>        acl secure     dst_port  8080<br>        acl login_page url_beg   /login<br>        acl logout     url_beg   /logout<br>        acl uid_given  url_reg   /login?userid=[^&amp;]+<br>        acl cookie_set hdr_sub(cookie) seen=1</p>\n<pre><code>redirect prefix   https://mysite.com set-cookie seen=1 if !cookie_set\nredirect prefix   https://mysite.com           if login_page !secure\nredirect prefix   http://mysite.com drop-query if login_page !uid_given\nredirect location http://mysite.com/           if !login_page secure\nredirect location / clear-cookie userid=       if logout\n</code></pre><p>  example: send redirects for request for articles without a ‘/‘.<br>        acl missing_slash path_reg ^/article/[^/]*$<br>        redirect code 301 prefix / drop-query append-slash if missing_slash</p>\n<p>  example: redirect all http traffic to https when ssl is handled by haproxy.<br>        redirect scheme https if !{ ssl_fc }</p>\n<p>  example: append ‘www.’ prefix in front of all hosts not having it<br>        http-request redirect code 301 location www.%[hdr(host)]%[req.uri] \\<br>          unless { hdr_beg(host) -i www }</p>\n<p>  see section 7 about acl usage.</p>\n<p>redisp (deprecated)<br>redispatch (deprecated)<br>  enable or disable session redistribution in case of connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  in http mode, if a server designated by a cookie is down, clients may<br>  definitely stick to it because they cannot flush the cookie, so they will not<br>  be able to access the service anymore.</p>\n<p>  specifying “redispatch” will allow the proxy to break their persistence and<br>  redistribute them to a working server.</p>\n<p>  it also allows to retry last connection to another server in case of multiple<br>  connection failures. of course, it requires having “retries” set to a nonzero<br>  value.</p>\n<p>  this form is deprecated, do not use it in any new configuration, use the new<br>  “option redispatch” instead.</p>\n<p>  see also : “option redispatch”</p>\n<p>reqadd  <string> [{if | unless} <cond>]<br>  add a header at the end of the http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <string>  is the complete line to be added. any space or known delimiter<br>              must be escaped using a backslash (‘\\’). please refer to section<br>              6 about http header manipulation for more information.</string></cond></string></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a new line consisting in <string> followed by a line feed will be added after<br>  the last header of an http request.</string></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses.</p>\n<p>  example : add “x-proto: ssl” to requests coming via port 81<br>     acl is-ssl  dst_port       81<br>     reqadd      x-proto:\\ ssl  if is-ssl</p>\n<p>  see also: “rspadd”, section 6 about http header manipulation, and section 7<br>            about acls.</p>\n<p>reqallow  <search> [{if | unless} <cond>]<br>reqiallow <search> [{if | unless} <cond>] (ignore case)<br>  definitely allow an http request if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqallow” keyword strictly matches case while “reqiallow”<br>              ignores case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will mark the request as allowed, even if any later test would<br>  result in a deny. the test applies both to the request line and to request<br>  headers. keep in mind that urls in request line are case-sensitive while<br>  header names are not.</search></p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># allow www.* but refuse *.local\nreqiallow ^host:\\ www\\.\nreqideny  ^host:\\ .*\\.local\n</code></pre><p>  see also: “reqdeny”, “block”, section 6 about http header manipulation, and<br>            section 7 about acls.</p>\n<p>reqdel  <search> [{if | unless} <cond>]<br>reqidel <search> [{if | unless} <cond>]  (ignore case)<br>  delete all headers matching a regular expression in an http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the “reqdel”<br>              keyword strictly matches case while “reqidel” ignores case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any header line matching extended regular expression <search> in the request<br>  will be completely deleted. most common use of this is to remove unwanted<br>  and/or dangerous headers or cookies from a request before passing it to the<br>  next servers.</search></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. keep in mind that header names are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># remove x-forwarded-for header and server cookie\nreqidel ^x-forwarded-for:.*\nreqidel ^cookie:.*server=\n</code></pre><p>  see also: “reqadd”, “reqrep”, “rspdel”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqdeny  <search> [{if | unless} <cond>]<br>reqideny <search> [{if | unless} <cond>]  (ignore case)<br>  deny an http request if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqdeny” keyword strictly matches case while “reqideny” ignores<br>              case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will mark the request as denied, even if any later test would<br>  result in an allow. the test applies both to the request line and to request<br>  headers. keep in mind that urls in request line are case-sensitive while<br>  header names are not.</search></p>\n<p>  a denied request will generate an “http 403 forbidden” response once the<br>  complete request has been parsed. this is consistent with what is practiced<br>  using acls.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># refuse *.local, then allow www.*\nreqideny  ^host:\\ .*\\.local\nreqiallow ^host:\\ www\\.\n</code></pre><p>  see also: “reqallow”, “rspdeny”, “block”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqpass  <search> [{if | unless} <cond>]<br>reqipass <search> [{if | unless} <cond>]  (ignore case)<br>  ignore any http request line matching a regular expression in next rules<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqpass” keyword strictly matches case while “reqipass” ignores<br>              case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will skip next rules, without assigning any deny or allow verdict.<br>  the test applies both to the request line and to request headers. keep in<br>  mind that urls in request line are case-sensitive while header names are not.</search></p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># refuse *.local, then allow www.*, but ignore &quot;www.private.local&quot;\nreqipass  ^host:\\ www.private\\.local\nreqideny  ^host:\\ .*\\.local\nreqiallow ^host:\\ www\\.\n</code></pre><p>  see also: “reqallow”, “reqdeny”, “block”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqrep  <search> <string> [{if | unless} <cond>]<br>reqirep <search> <string> [{if | unless} <cond>]   (ignore case)<br>  replace a regular expression with a string in an http request line<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the “reqrep”<br>              keyword strictly matches case while “reqirep” ignores case.</search></cond></string></search></cond></string></search></p>\n<pre><code>&lt;string&gt;  is the complete line to be added. any space or known delimiter\n          must be escaped using a backslash (&apos;\\&apos;). references to matched\n          pattern groups are possible using the common \\n form, with n\n          being a single digit between 0 and 9\\. please refer to section\n          6 about http header manipulation for more information.\n\n&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any line matching extended regular expression <search> in the request (both<br>  the request line and header lines) will be completely replaced with <string>.<br>  most common use of this is to rewrite urls or domain names in “host” headers.</string></search></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. note that for increased readability, it is suggested to add enough<br>  spaces between the request and the response. keep in mind that urls in<br>  request line are case-sensitive while header names are not.</p>\n<p>  example :</p>\n<pre><code># replace &quot;/static/&quot; with &quot;/&quot; at the beginning of any request path.\nreqrep ^([^\\ :]*)\\ /static/(.*)     \\1\\ /\\2\n# replace &quot;www.mydomain.com&quot; with &quot;www&quot; in the host name.\nreqirep ^host:\\ www.mydomain.com   host:\\ www\n</code></pre><p>  see also: “reqadd”, “reqdel”, “rsprep”, “tune.bufsize”, section 6 about<br>            http header manipulation, and section 7 about acls.</p>\n<p>reqtarpit  <search> [{if | unless} <cond>]<br>reqitarpit <search> [{if | unless} <cond>]  (ignore case)<br>  tarpit an http request containing a line matching a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqtarpit” keyword strictly matches case while “reqitarpit”<br>              ignores case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will be tarpitted, which means that it will connect to nowhere, will<br>  be kept open for a pre-defined time, then will return an http error 500 so<br>  that the attacker does not suspect it has been tarpitted. the status 500 will<br>  be reported in the logs, but the completion flags will indicate “pt”. the<br>  delay is defined by “timeout tarpit”, or “timeout connect” if the former is<br>  not set.</search></p>\n<p>  the goal of the tarpit is to slow down robots attacking servers with<br>  identifiable requests. many robots limit their outgoing number of connections<br>  and stay connected waiting for a reply which can take several minutes to<br>  come. depending on the environment and attack, it may be particularly<br>  efficient at reducing the load on the network and firewalls.</p>\n<p>  examples :</p>\n<pre><code># ignore user-agents reporting any flavour of &quot;mozilla&quot; or &quot;msie&quot;, but\n# block all others.\nreqipass   ^user-agent:\\.*(mozilla|msie)\nreqitarpit ^user-agent:\n\n# block bad guys\nacl badguys src 10.1.0.3 172.16.13.20/28\nreqitarpit . if badguys\n</code></pre><p>  see also: “reqallow”, “reqdeny”, “reqpass”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>retries <value><br>  set the number of retries to perform on a server after a connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <value>   is the number of times a connection attempt should be retried on<br>              a server when a connection either is refused or times out. the<br>              default value is 3.</value></value></p>\n<p>  it is important to understand that this value applies to the number of<br>  connection attempts, not full requests. when a connection has effectively<br>  been established to a server, there will be no more retry.</p>\n<p>  in order to avoid immediate reconnections to a server which is restarting,<br>  a turn-around timer of min(“timeout connect”, one second) is applied before<br>  a retry occurs.</p>\n<p>  when “option redispatch” is set, the last retry may be performed on another<br>  server even if a cookie references a different server.</p>\n<p>  see also : “option redispatch”</p>\n<p>rspadd <string> [{if | unless} <cond>]<br>  add a header at the end of the http response<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <string>  is the complete line to be added. any space or known delimiter<br>              must be escaped using a backslash (‘\\’). please refer to section<br>              6 about http header manipulation for more information.</string></cond></string></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a new line consisting in <string> followed by a line feed will be added after<br>  the last header of an http response.</string></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses.</p>\n<p>  see also: “reqadd”, section 6 about http header manipulation, and section 7<br>            about acls.</p>\n<p>rspdel  <search> [{if | unless} <cond>]<br>rspidel <search> [{if | unless} <cond>]  (ignore case)<br>  delete all headers matching a regular expression in an http response<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rspdel” keyword strictly matches case while “rspidel”<br>              ignores case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any header line matching extended regular expression <search> in the response<br>  will be completely deleted. most common use of this is to remove unwanted<br>  and/or sensitive headers or cookies from a response before passing it to the<br>  client.</search></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. keep in mind that header names are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># remove the server header from responses\nrspidel ^server:.*\n</code></pre><p>  see also: “rspadd”, “rsprep”, “reqdel”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>rspdeny  <search> [{if | unless} <cond>]<br>rspideny <search> [{if | unless} <cond>]  (ignore case)<br>  block an http response if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rspdeny” keyword strictly matches case while “rspideny”<br>              ignores case.</search></cond></search></cond></search></p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a response containing any line which matches extended regular expression<br>  <search> will mark the request as denied. the test applies both to the<br>  response line and to response headers. keep in mind that header names are not<br>  case-sensitive.</search></p>\n<p>  main use of this keyword is to prevent sensitive information leak and to<br>  block the response before it reaches the client. if a response is denied, it<br>  will be replaced with an http 502 error so that the client never retrieves<br>  any sensitive data.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  rspdeny should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># ensure that no content type matching ms-word will leak\nrspideny  ^content-type:\\.*/ms-word\n</code></pre><p>  see also: “reqdeny”, “acl”, “block”, section 6 about http header manipulation<br>            and section 7 about acls.</p>\n<p>rsprep  <search> <string> [{if | unless} <cond>]<br>rspirep <search> <string> [{if | unless} <cond>]  (ignore case)<br>  replace a regular expression with a string in an http response line<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rsprep” keyword strictly matches case while “rspirep”<br>              ignores case.</search></cond></string></search></cond></string></search></p>\n<pre><code>&lt;string&gt;  is the complete line to be added. any space or known delimiter\n          must be escaped using a backslash (&apos;\\&apos;). references to matched\n          pattern groups are possible using the common \\n form, with n\n          being a single digit between 0 and 9\\. please refer to section\n          6 about http header manipulation for more information.\n\n&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any line matching extended regular expression <search> in the response (both<br>  the response line and header lines) will be completely replaced with<br>  <string>. most common use of this is to rewrite location headers.</string></search></p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. note that for increased readability, it is suggested to add enough<br>  spaces between the request and the response. keep in mind that header names<br>  are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># replace &quot;location: 127.0.0.1:8080&quot; with &quot;location: www.mydomain.com&quot;\nrspirep ^location:\\ 127.0.0.1:8080    location:\\ www.mydomain.com\n</code></pre><p>  see also: “rspadd”, “rspdel”, “reqrep”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>server <name> <address>[:[port]] [param*]<br>  declare a server in a backend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the internal name assigned to this server. this name will<br>              appear in logs and alerts.  if “http-send-name-header” is<br>              set, it will be added to the request header sent to the server.</name></address></name></p>\n<pre><code>&lt;address&gt; is the ipv4 or ipv6 address of the server. alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up. address &quot;0.0.0.0&quot; or &quot;*&quot; has a special meaning.\n          it indicates that the connection will be forwarded to the same ip\n          address as the one from the client connection. this is useful in\n          transparent proxy architectures where the client&apos;s connection is\n          intercepted and haproxy must forward to the original destination\n          address. this is more or less what the &quot;transparent&quot; keyword does\n          except that with a server it&apos;s possible to limit concurrency and\n          to report statistics. optionally, an address family prefix may be\n          used before the address to force the family regardless of the\n          address format, which can be useful to specify a path to a unix\n          socket with no slash (&apos;/&apos;). currently supported prefixes are :\n                - &apos;ipv4@&apos;  -&gt; address is always ipv4\n                - &apos;ipv6@&apos;  -&gt; address is always ipv6\n                - &apos;unix@&apos;  -&gt; address is a path to a local unix socket\n                - &apos;abns@&apos;  -&gt; address is in abstract namespace (linux only)\n          you may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment\n          variables.\n\n&lt;port&gt;    is an optional port specification. if set, all connections will\n          be sent to this port. if unset, the same port the client\n          connected to will be used. the port may also be prefixed by a &quot;+&quot;\n          or a &quot;-&quot;. in this case, the server&apos;s port will be determined by\n          adding this value to the client&apos;s port.\n\n&lt;param*&gt;  is a list of parameters for this server. the &quot;server&quot; keywords\n          accepts an important number of options and has a complete section\n          dedicated to it. please refer to section 5 for more details.\n</code></pre><p>  examples :<br>        server first  10.1.1.1:1080 cookie first  check inter 1000<br>        server second 10.1.1.2:1080 cookie second check inter 1000<br>        server transp ipv4@<br>        server backup “${srv_backup}:1080” backup<br>        server www1_dc1 “${lan_dc1}.101:80”<br>        server www1_dc2 “${lan_dc2}.101:80”</p>\n<p>  see also: “default-server”, “http-send-name-header” and section 5 about<br>             server options</p>\n<p>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | client | clientip } ]<br>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]<br>source <addr>[:<port>] [interface <name>]<br>  set the source address for outgoing connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <addr>    is the ipv4 address haproxy will bind to before connecting to a<br>              server. this address is also used as a source for health checks.</addr></name></port></addr></occ></hdr></port2></addr2></port></addr></port2></addr2></port></addr></p>\n<pre><code>          the default value of 0.0.0.0 means that the system will select\n          the most appropriate address to reach its destination. optionally\n          an address family prefix may be used before the address to force\n          the family regardless of the address format, which can be useful\n          to specify a path to a unix socket with no slash (&apos;/&apos;). currently\n          supported prefixes are :\n            - &apos;ipv4@&apos; -&gt; address is always ipv4\n            - &apos;ipv6@&apos; -&gt; address is always ipv6\n            - &apos;unix@&apos; -&gt; address is a path to a local unix socket\n            - &apos;abns@&apos; -&gt; address is in abstract namespace (linux only)\n          you may want to reference some environment variables in the address\n          parameter, see section 2.3 about environment variables.\n\n&lt;port&gt;    is an optional port. it is normally not needed but may be useful\n          in some very specific contexts. the default value of zero means\n          the system will select a free port. note that port ranges are not\n          supported in the backend. if you want to force port ranges, you\n          have to specify them on each &quot;server&quot; line.\n\n&lt;addr2&gt;   is the ip address to present to the server when connections are\n          forwarded in full transparent proxy mode. this is currently only\n          supported on some patched linux kernels. when this address is\n          specified, clients connecting to the server will be presented\n          with this address, while health checks will still use the address\n          &lt;addr&gt;.\n\n&lt;port2&gt;   is the optional port to present to the server when connections\n          are forwarded in full transparent proxy mode (see &lt;addr2&gt; above).\n          the default value of zero means the system will select a free\n          port.\n\n&lt;hdr&gt;     is the name of a http header in which to fetch the ip to bind to.\n          this is the name of a comma-separated header list which can\n          contain multiple ip addresses. by default, the last occurrence is\n          used. this is designed to work with the x-forwarded-for header\n          and to automatically bind to the client&apos;s ip address as seen\n          by previous proxy, typically stunnel. in order to use another\n          occurrence from the last one, please see the &lt;occ&gt; parameter\n          below. when the header (or occurrence) is not found, no binding\n          is performed so that the proxy&apos;s default ip address is used. also\n          keep in mind that the header name is case insensitive, as for any\n          http header.\n\n&lt;occ&gt;     is the occurrence number of a value to be used in a multi-value\n          header. this is to be used in conjunction with &quot;hdr_ip(&lt;hdr&gt;)&quot;,\n          in order to specify which occurrence to use for the source ip\n          address. positive values indicate a position from the first\n          occurrence, 1 being the first one. negative values indicate\n          positions relative to the last one, -1 being the last one. this\n          is helpful for situations where an x-forwarded-for header is set\n          at the entry point of an infrastructure and must be used several\n          proxy layers away. when this value is not specified, -1 is\n          assumed. passing a zero here disables the feature.\n\n&lt;name&gt;    is an optional interface name to which to bind to for outgoing\n          traffic. on systems supporting this features (currently, only\n          linux), this allows one to bind all traffic to the server to\n          this interface even if it is not the one the system would select\n          based on routing tables. this should be used with extreme care.\n          note that using this option requires root privileges.\n</code></pre><p>  the “source” keyword is useful in complex environments where a specific<br>  address only is allowed to connect to the servers. it may be needed when a<br>  private address must be used through a public gateway for instance, and it is<br>  known that the system cannot determine the adequate source address by itself.</p>\n<p>  an extension which is available on certain patched linux kernels may be used<br>  through the “usesrc” optional keyword. it makes it possible to connect to the<br>  servers with an ip address which does not belong to the system itself. this<br>  is called “full transparent proxy mode”. for this to work, the destination<br>  servers have to route their traffic back to this address through the machine<br>  running haproxy, and ip forwarding must generally be enabled on this machine.</p>\n<p>  in this “full transparent proxy” mode, it is possible to force a specific ip<br>  address to be presented to the servers. this is not much used in fact. a more<br>  common use is to tell haproxy to present the client’s ip address. for this,<br>  there are two methods :</p>\n<pre><code>- present the client&apos;s ip and port addresses. this is the most transparent\n  mode, but it can cause problems when ip connection tracking is enabled on\n  the machine, because a same connection may be seen twice with different\n  states. however, this solution presents the huge advantage of not\n  limiting the system to the 64k outgoing address+port couples, because all\n  of the client ranges may be used.\n\n- present only the client&apos;s ip address and select a spare port. this\n  solution is still quite elegant but slightly less transparent (downstream\n  firewalls logs will not match upstream&apos;s). it also presents the downside\n  of limiting the number of concurrent connections to the usual 64k ports.\n  however, since the upstream and downstream ports are different, local ip\n  connection tracking on the machine will not be upset by the reuse of the\n  same session.\n</code></pre><p>  note that depending on the transparent proxy technology used, it may be<br>  required to force the source address. in fact, cttproxy version 2 requires an<br>  ip address in <addr> above, and does not support setting of “0.0.0.0” as the<br>  ip address because it creates nat entries which much match the exact outgoing<br>  address. tproxy version 4 and some other kernel patches which work in pure<br>  forwarding mode generally will not have this limitation.</addr></p>\n<p>  this option sets the default source for all servers in the backend. it may<br>  also be specified in a “defaults” section. finer source address specification<br>  is possible at the server level using the “source” server option. refer to<br>  section 5 for more information.</p>\n<p>  in order to work, “usesrc” requires root privileges.</p>\n<p>  examples :<br>        backend private</p>\n<pre><code>    # connect to the servers using our 192.168.1.200 source address\n    source 192.168.1.200\n\nbackend transparent_ssl1\n    # connect to the ssl farm from the client&apos;s source address\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_ssl2\n    # connect to the ssl farm from the client&apos;s source address and port\n    # not recommended if ip conntrack is present on the local machine.\n    source 192.168.1.200 usesrc client\n\nbackend transparent_ssl3\n    # connect to the ssl farm from the client&apos;s source address. it\n    # is more conntrack-friendly.\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_smtp\n    # connect to the smtp farm from the client&apos;s source address/port\n    # with tproxy version 4.\n    source 0.0.0.0 usesrc clientip\n\nbackend transparent_http\n    # connect to the servers using the client&apos;s ip as seen by previous\n    # proxy.\n    source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)\n</code></pre><p>  see also : the “source” server option in section 5, the tproxy patches for<br>             the linux kernel on www.balabit.com, the “bind” keyword.</p>\n<p>srvtimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the server side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase of the server’s response, when it has to send the<br>  headers, as it directly represents the server’s processing time for the<br>  request. to find out what value to put there, it’s often good to start with<br>  what would be considered as unacceptable response times, then check the logs<br>  to observe the response time distribution, and adjust the value accordingly.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. in tcp mode (and to a lesser extent, in http mode), it is highly<br>  recommended that the client timeout remains equal to the server timeout in<br>  order to avoid complex situations to debug. whatever the expected server<br>  response times, it is a good practice to cover at least one or several tcp<br>  packet losses by specifying timeouts that are slightly above multiples of 3<br>  seconds (eg: 4 or 5 seconds minimum).</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for compatibility but is currently deprecated.<br>  please use “timeout server” instead.</p>\n<p>  see also : “timeout server”, “timeout tunnel”, “timeout client” and<br>             “clitimeout”.</p>\n<p>stats admin { if | unless } <cond><br>  enable statistics admin level if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</cond></p>\n<p>  this statement enables the statistics admin level if/unless a condition is<br>  matched.</p>\n<p>  the admin level allows to enable/disable servers from the web interface. by<br>  default, statistics page is read-only for security reasons.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  currently, the post request is limited to the buffer size minus the reserved<br>  buffer space, which means that if the list of servers is too long, the<br>  request won’t be processed. it is recommended to alter few servers at a<br>  time.</p>\n<p>  example :</p>\n<pre><code># statistics admin level only for localhost\nbackend stats_localhost\n    stats enable\n    stats admin if localhost\n</code></pre><p>  example :</p>\n<pre><code># statistics admin level always enabled because of the authentication\nbackend stats_auth\n    stats enable\n    stats auth  admin:admin123\n    stats admin if true\n</code></pre><p>  example :</p>\n<pre><code># statistics admin level depends on the authenticated user\nuserlist stats-auth\n    group admin    users admin\n    user  admin    insecure-password admin123\n    group readonly users haproxy\n    user  haproxy  insecure-password haproxy\n\nbackend stats_auth\n    stats enable\n    acl auth       http_auth(stats-auth)\n    acl auth_admin http_auth_group(stats-auth) admin\n    stats http-request auth unless auth\n    stats admin if auth_admin\n</code></pre><p>  see also : “stats enable”, “stats auth”, “stats http-request”, “nbproc”,<br>             “bind-process”, section 3.4 about userlists and section 7 about<br>             acl usage.</p>\n<p>stats auth <user>:<passwd><br>  enable statistics with authentication and grant access to an account<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <user>    is a user name to grant access to</user></passwd></user></p>\n<pre><code>&lt;passwd&gt;  is the cleartext password associated to this user\n</code></pre><p>  this statement enables statistics with default settings, and restricts access<br>  to declared users only. it may be repeated as many times as necessary to<br>  allow as many users as desired. when a user tries to access the statistics<br>  without a valid account, a “401 forbidden” response will be returned so that<br>  the browser asks the user to provide a valid user and password. the real<br>  which will be returned to the browser is configurable using “stats realm”.</p>\n<p>  since the authentication method is http basic authentication, the passwords<br>  circulate in cleartext on the network. thus, it was decided that the<br>  configuration file would also use cleartext passwords to remind the users<br>  that those ones should not be sensitive and not shared with any other account.</p>\n<p>  it is also possible to reduce the scope of the proxies which appear in the<br>  report using “stats scope”.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats enable”, “stats realm”, “stats scope”, “stats uri”</p>\n<p>stats enable<br>  enable statistics reporting with default settings<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  this statement enables statistics reporting with default settings defined<br>  at build time. unless stated otherwise, these settings are used :</p>\n<pre><code>- stats uri   : /haproxy?stats\n- stats realm : &quot;haproxy statistics&quot;\n- stats auth  : no authentication\n- stats scope : no restriction\n</code></pre><p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats realm”, “stats uri”</p>\n<p>stats hide-version<br>  enable statistics and hide haproxy version reporting<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the stats page reports some useful status information along with<br>  the statistics. among them is haproxy’s version. however, it is generally<br>  considered dangerous to report precise version to anyone, as it can help them<br>  target known weaknesses with specific attacks. the “stats hide-version”<br>  statement removes the version from the statistics report. this is recommended<br>  for public sites or any site with a weak login/password.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats http-request { allow | deny | auth [realm <realm>] }<br>             [ { if | unless } <condition> ]<br>  access control for statistics</condition></realm></p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    no    |   yes  |   yes</p>\n<p>  as “http-request”, these set of options allow to fine control access to<br>  statistics. each option may be followed by if/unless and acl.<br>  first option with matched condition (or option without condition) is final.<br>  for “deny” a 403 error will be returned, for “allow” normal processing is<br>  performed, for “auth” a 401/407 error code is returned so the client<br>  should be asked to enter a username and password.</p>\n<p>  there is no fixed limit to the number of http-request statements per<br>  instance.</p>\n<p>  see also : “http-request”, section 3.4 about userlists and section 7<br>             about acl usage.</p>\n<p>stats realm <realm><br>  enable statistics and set authentication realm<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <realm>   is the name of the http basic authentication realm reported to<br>              the browser. the browser uses it to display it in the pop-up<br>              inviting the user to enter a valid username and password.</realm></realm></p>\n<p>  the realm is read as a single word, so any spaces in it should be escaped<br>  using a backslash (‘\\’).</p>\n<p>  this statement is useful only in conjunction with “stats auth” since it is<br>  only related to authentication.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats uri”</p>\n<p>stats refresh <delay><br>  enable statistics with automatic refresh<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <delay>   is the suggested refresh delay, specified in seconds, which will<br>              be returned to the browser consulting the report page. while the<br>              browser is free to apply any delay, it will generally respect it<br>              and refresh the page this every seconds. the refresh interval may<br>              be specified in any other non-default time unit, by suffixing the<br>              unit after the value, as explained at the top of this document.</delay></delay></p>\n<p>  this statement is useful on monitoring displays with a permanent page<br>  reporting the load balancer’s activity. when set, the html report page will<br>  include a link “refresh”/“stop refresh” so that the user can select whether<br>  he wants automatic refresh of the page or not.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats scope { <name> | “.” }<br>  enable statistics and limit access scope<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <name>    is the name of a listen, frontend or backend section to be<br>              reported. the special name “.” (a single dot) designates the<br>              section in which the statement appears.</name></name></p>\n<p>  when this statement is specified, only the sections enumerated with this<br>  statement will appear in the report. all other ones will be hidden. this<br>  statement may appear as many times as needed if multiple sections need to be<br>  reported. please note that the name checking is performed as simple string<br>  comparisons, and that it is never checked that a give section name really<br>  exists.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats show-desc [ <desc> ]<br>  enable reporting of a description on the statistics page.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</desc></p>\n<pre><code>&lt;desc&gt;    is an optional description to be reported. if unspecified, the\n          description from global section is automatically used instead.\n</code></pre><p>  this statement is useful for users that offer shared services to their<br>  customers, where node or description should be different for each customer.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.  by default description is not shown.</p>\n<p>  example :</p>\n<pre><code># internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-desc master node for europe, asia, africa\n    stats uri       /admin?stats\n    stats refresh   5s\n</code></pre><p>  see also: “show-node”, “stats enable”, “stats uri” and “description” in<br>            global section.</p>\n<p>stats show-legends<br>  enable reporting additional information on the statistics page<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  enable reporting additional information on the statistics page :</p>\n<pre><code>- cap: capabilities (proxy)\n- mode: one of tcp, http or health (proxy)\n- id: snmp id (proxy, socket, server)\n- ip (socket, server)\n- cookie (backend, server)\n</code></pre><p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.  default behaviour is not to show this information.</p>\n<p>  see also: “stats enable”, “stats uri”.</p>\n<p>stats show-node [ <name> ]<br>  enable reporting of a host name on the statistics page.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments:<br>    <name>    is an optional name to be reported. if unspecified, the<br>              node name from global section is automatically used instead.</name></name></p>\n<p>  this statement is useful for users that offer shared services to their<br>  customers, where node or description might be different on a stats page<br>  provided for each customer.  default behaviour is not to show host name.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example:</p>\n<pre><code># internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-node europe-1\n    stats uri       /admin?stats\n    stats refresh   5s\n</code></pre><p>  see also: “show-desc”, “stats enable”, “stats uri”, and “node” in global<br>            section.</p>\n<p>stats uri <prefix><br>  enable statistics and define the uri prefix to access them<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <prefix>  is the prefix of any uri which will be redirected to stats. this<br>              prefix may contain a question mark (‘?’) to indicate part of a<br>              query string.</prefix></prefix></p>\n<p>  the statistics uri is intercepted on the relayed traffic, so it appears as a<br>  page within the normal application. it is strongly advised to ensure that the<br>  selected uri will never appear in the application, otherwise it will never be<br>  possible to reach it in the application.</p>\n<p>  the default uri compiled in haproxy is “/haproxy?stats”, but this may be<br>  changed at build time, so it’s better to always explicitly specify it here.<br>  it is generally a good idea to include a question mark in the uri so that<br>  intermediate proxies refrain from caching the results. also, since any string<br>  beginning with the prefix will be accepted as a stats request, the question<br>  mark helps ensuring that no valid uri will begin with the same words.</p>\n<p>  it is sometimes very convenient to use “/“ as the uri prefix, and put that<br>  statement in a “listen” instance of its own. that makes it easy to dedicate<br>  an address or a port to statistics only.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”</p>\n<p>stick match <pattern> [table <table>] [{if | unless} <cond>]<br>  define a request pattern matching condition to stick a user to a server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</cond></table></pattern></p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the incoming request or connection<br>               will be analysed in the hope to find a matching entry in a<br>               stickiness table. this rule is mandatory.</pattern></p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional matching condition. it makes it possible to match\n           on a certain criterion only when other conditions are met (or\n           not met). for instance, it could be used to match on a source ip\n           address except when a request passes through a known proxy, in\n           which case we&apos;d match on a header containing that ip address.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick match” statement<br>  describes a rule to extract the stickiness criterion from an incoming request<br>  or connection. see section 7 for a complete list of possible patterns and<br>  transformation rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick match” statement<br>  will apply, using “if” or “unless” followed by a condition. see section 7 for<br>  acl based conditions.</p>\n<p>  there is no limit on the number of “stick match” statements. the first that<br>  applies and matches will cause the request to be directed to the same server<br>  as was used for the request which created the entry. that way, multiple<br>  matches can be used as fallbacks.</p>\n<p>  the stick rules are checked after the persistence cookies, so they will not<br>  affect stickiness if a cookie has already been used to select a server. that<br>  way, it becomes very easy to insert cookies and match on ip addresses in<br>  order to maintain stickiness between http and https.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :</p>\n<pre><code># forward smtp users to the same server they just used for pop in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n</code></pre><p>  see also : “stick-table”, “stick on”, “nbproc”, “bind-process” and section 7<br>             about acls and samples fetching.</p>\n<p>stick on <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern to associate a user to a server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</condition></table></pattern></p>\n<p>  note : this form is exactly equivalent to “stick match” followed by<br>         “stick store-request”, all with the same arguments. please refer<br>         to both keywords for details. it is only provided as a convenience<br>         for writing more maintainable configurations.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  examples :</p>\n<pre><code># the following form ...\nstick on src table pop if !localhost\n\n# ...is strictly equivalent to this one :\nstick match src table pop if !localhost\nstick store-request src table pop if !localhost\n\n# use cookie persistence for http, and stick on source address for https as\n# well as http without cookie. share the same table between both accesses.\nbackend http\n    mode http\n    balance roundrobin\n    stick on src table https\n    cookie srv insert indirect nocache\n    server s1 192.168.1.1:80 cookie s1\n    server s2 192.168.1.1:80 cookie s2\n\nbackend https\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 200k expire 30m\n    stick on src\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n</code></pre><p>  see also : “stick match”, “stick store-request”, “nbproc” and “bind-process”.</p>\n<p>stick store-request <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern used to create an entry in a stickiness table<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</condition></table></pattern></p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the incoming request or connection<br>               will be analysed, extracted and stored in the table once a<br>               server is selected.</pattern></p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional storage condition. it makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           for instance, it could be used to store the source ip address\n           except when the request passes through a known proxy, in which\n           case we&apos;d store a converted form of a header containing that ip\n           address.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick store-request” statement<br>  describes a rule to decide what to extract from the request and when to do<br>  it, in order to store it into a stickiness table for further requests to<br>  match it using the “stick match” statement. obviously the extracted part must<br>  make sense and have a chance to be matched in a further request. storing a<br>  client’s ip address for instance often makes sense. storing an id found in a<br>  url parameter also makes sense. storing a source port will almost never make<br>  any sense because it will be randomly matched. see section 7 for a complete<br>  list of possible patterns and transformation rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick store-request”<br>  statement will apply, using “if” or “unless” followed by a condition. this<br>  condition will be evaluated while parsing the request, so any criteria can be<br>  used. see section 7 for acl based conditions.</p>\n<p>  there is no limit on the number of “stick store-request” statements, but<br>  there is a limit of 8 simultaneous stores per request or response. this<br>  makes it possible to store up to 8 criteria, all extracted from either the<br>  request or the response, regardless of the number of rules. only the 8 first<br>  ones which match will be kept. using this, it is possible to feed multiple<br>  tables at once in the hope to increase the chance to recognize a user on<br>  another protocol or access method. using multiple store-request rules with<br>  the same table is possible and may be used to find the best criterion to rely<br>  on, by arranging the rules by decreasing preference order. only the first<br>  extracted criterion for a given table will be stored. all subsequent store-<br>  request rules referencing the same table will be skipped and their acls will<br>  not be evaluated.</p>\n<p>  the “store-request” rules are evaluated once the server connection has been<br>  established, so that the table will contain the real server that processed<br>  the request.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :</p>\n<pre><code># forward smtp users to the same server they just used for pop in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n</code></pre><p>  see also : “stick-table”, “stick on”, “nbproc”, “bind-process” and section 7<br>             about acls and sample fetching.</p>\n<p>stick-table type {ip | integer | string [len <length>] | binary [len <length>]}<br>            size <size> [expire <expire>] [nopurge] [peers <peersect>]<br>            [store <data_type>]*<br>  configure the stickiness table for the current section<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</data_type></peersect></expire></size></length></length></p>\n<p>  arguments :<br>    ip         a table declared with “type ip” will only store ipv4 addresses.<br>               this form is very compact (about 50 bytes per entry) and allows<br>               very fast entry lookup and stores with almost no overhead. this<br>               is mainly used to store client source ip addresses.</p>\n<pre><code>ipv6       a table declared with &quot;type ipv6&quot; will only store ipv6 addresses.\n           this form is very compact (about 60 bytes per entry) and allows\n           very fast entry lookup and stores with almost no overhead. this\n           is mainly used to store client source ip addresses.\n\ninteger    a table declared with &quot;type integer&quot; will store 32bit integers\n           which can represent a client identifier found in a request for\n           instance.\n\nstring     a table declared with &quot;type string&quot; will store substrings of up\n           to &lt;len&gt; characters. if the string provided by the pattern\n           extractor is larger than &lt;len&gt;, it will be truncated before\n           being stored. during matching, at most &lt;len&gt; characters will be\n           compared between the string in the table and the extracted\n           pattern. when not specified, the string is automatically limited\n           to 32 characters.\n\nbinary     a table declared with &quot;type binary&quot; will store binary blocks\n           of &lt;len&gt; bytes. if the block provided by the pattern\n           extractor is larger than &lt;len&gt;, it will be truncated before\n           being stored. if the block provided by the sample expression\n           is shorter than &lt;len&gt;, it will be padded by 0\\. when not\n           specified, the block is automatically limited to 32 bytes.\n\n&lt;length&gt;   is the maximum number of characters that will be stored in a\n           &quot;string&quot; type table (see type &quot;string&quot; above). or the number\n           of bytes of the block in &quot;binary&quot; type table. be careful when\n           changing this parameter as memory usage will proportionally\n           increase.\n\n&lt;size&gt;     is the maximum number of entries that can fit in the table. this\n           value directly impacts memory usage. count approximately\n           50 bytes per entry, plus the size of a string if any. the size\n           supports suffixes &quot;k&quot;, &quot;m&quot;, &quot;g&quot; for 2^10, 2^20 and 2^30 factors.\n\n[nopurge]  indicates that we refuse to purge older entries when the table\n           is full. when not specified and the table is full when haproxy\n           wants to store an entry in it, it will flush a few of the oldest\n           entries in order to release some space for the new ones. this is\n           most often the desired behaviour. in some specific cases, it\n           be desirable to refuse new entries instead of purging the older\n           ones. that may be the case when the amount of data to store is\n           far above the hardware limits and we prefer not to offer access\n           to new clients than to reject the ones already connected. when\n           using this parameter, be sure to properly set the &quot;expire&quot;\n           parameter (see below).\n\n&lt;peersect&gt; is the name of the peers section to use for replication. entries\n           which associate keys to server ids are kept synchronized with\n           the remote peers declared in this section. all entries are also\n           automatically learned from the local peer (old process) during a\n           soft restart.\n\n           note : each peers section may be referenced only by tables\n                  belonging to the same unique process.\n\n&lt;expire&gt;   defines the maximum duration of an entry in the table since it\n           was last created, refreshed or matched. the expiration delay is\n           defined using the standard time format, similarly as the various\n           timeouts. the maximum duration is slightly above 24 days. see\n           section 2.2 for more information. if this delay is not specified,\n           the session won&apos;t automatically expire, but older entries will\n           be removed once full. be sure not to use the &quot;nopurge&quot; parameter\n           if not expiration delay is specified.\n</code></pre><p>   <data_type> is used to store additional information in the stick-table. this<br>               may be used by acls in order to control various criteria related<br>               to the activity of the client matching the stick-table. for each<br>               item specified here, the size of each entry will be inflated so<br>               that the additional data can fit. several data types may be<br>               stored with an entry. multiple data types may be specified after<br>               the “store” keyword, as a comma-separated list. alternatively,<br>               it is possible to repeat the “store” keyword followed by one or<br>               several data types. except for the “server_id” type which is<br>               automatically detected and enabled, all data types must be<br>               explicitly declared to be stored. if an acl references a data<br>               type which is not stored, the acl will simply not match. some<br>               data types require an argument which must be passed just after<br>               the type between parenthesis. see below for the supported data<br>               types and their arguments.</data_type></p>\n<p>  the data types that can be stored with an entry are the following :</p>\n<pre><code>- server_id : this is an integer which holds the numeric id of the server a\n  request was assigned to. it is used by the &quot;stick match&quot;, &quot;stick store&quot;,\n  and &quot;stick on&quot; rules. it is automatically enabled when referenced.\n\n- gpc0 : first general purpose counter. it is a positive 32-bit integer\n  integer which may be used for anything. most of the time it will be used\n  to put a special tag on some entries, for instance to note that a\n  specific behaviour was detected and must be known for future matches.\n\n- gpc0_rate(&lt;period&gt;) : increment rate of the first general purpose counter\n  over a period. it is a positive 32-bit integer integer which may be used\n  for anything. just like &lt;gpc0&gt;, it counts events, but instead of keeping\n  a cumulative count, it maintains the rate at which the counter is\n  incremented. most of the time it will be used to measure the frequency of\n  occurrence of certain events (eg: requests to a specific url).\n\n- conn_cnt : connection count. it is a positive 32-bit integer which counts\n  the absolute number of connections received from clients which matched\n  this entry. it does not mean the connections were accepted, just that\n  they were received.\n\n- conn_cur : current connections. it is a positive 32-bit integer which\n  stores the concurrent connection counts for the entry. it is incremented\n  once an incoming connection matches the entry, and decremented once the\n  connection leaves. that way it is possible to know at any time the exact\n  number of concurrent connections for an entry.\n\n- conn_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming connection rate over that period, in connections per period. the\n  result is an integer which can be matched using acls.\n\n- sess_cnt : session count. it is a positive 32-bit integer which counts\n  the absolute number of sessions received from clients which matched this\n  entry. a session is a connection that was accepted by the layer 4 rules.\n\n- sess_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming session rate over that period, in sessions per period. the\n  result is an integer which can be matched using acls.\n\n- http_req_cnt : http request count. it is a positive 32-bit integer which\n  counts the absolute number of http requests received from clients which\n  matched this entry. it does not matter whether they are valid requests or\n  not. note that this is different from sessions when keep-alive is used on\n  the client side.\n\n- http_req_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  http request rate over that period, in requests per period. the result is\n  an integer which can be matched using acls. it does not matter whether\n  they are valid requests or not. note that this is different from sessions\n  when keep-alive is used on the client side.\n\n- http_err_cnt : http error count. it is a positive 32-bit integer which\n  counts the absolute number of http requests errors induced by clients\n  which matched this entry. errors are counted on invalid and truncated\n  requests, as well as on denied or tarpitted requests, and on failed\n  authentications. if the server responds with 4xx, then the request is\n  also counted as an error since it&apos;s an error triggered by the client\n  (eg: vulnerability scan).\n\n- http_err_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  http request error rate over that period, in requests per period (see\n  http_err_cnt above for what is accounted as an error). the result is an\n  integer which can be matched using acls.\n\n- bytes_in_cnt : client to server byte count. it is a positive 64-bit\n  integer which counts the cumulated amount of bytes received from clients\n  which matched this entry. headers are included in the count. this may be\n  used to limit abuse of upload features on photo or video servers.\n\n- bytes_in_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming bytes rate over that period, in bytes per period. it may be used\n  to detect users which upload too much and too fast. warning: with large\n  uploads, it is possible that the amount of uploaded data will be counted\n  once upon termination, thus causing spikes in the average transfer speed\n  instead of having a smooth one. this may partially be smoothed with\n  &quot;option contstats&quot; though this is not perfect yet. use of byte_in_cnt is\n  recommended for better fairness.\n\n- bytes_out_cnt : server to client byte count. it is a positive 64-bit\n  integer which counts the cumulated amount of bytes sent to clients which\n  matched this entry. headers are included in the count. this may be used\n  to limit abuse of bots sucking the whole site.\n\n- bytes_out_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes\n  an integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  outgoing bytes rate over that period, in bytes per period. it may be used\n  to detect users which download too much and too fast. warning: with large\n  transfers, it is possible that the amount of transferred data will be\n  counted once upon termination, thus causing spikes in the average\n  transfer speed instead of having a smooth one. this may partially be\n  smoothed with &quot;option contstats&quot; though this is not perfect yet. use of\n  byte_out_cnt is recommended for better fairness.\n</code></pre><p>  there is only one stick-table per proxy. at the moment of writing this doc,<br>  it does not seem useful to have multiple tables per proxy. if this happens<br>  to be required, simply create a dummy backend with a stick-table in it and<br>  reference it.</p>\n<p>  it is important to understand that stickiness based on learning information<br>  has some limitations, including the fact that all learned associations are<br>  lost upon restart. in general it can be good as a complement but not always<br>  as an exclusive stickiness.</p>\n<p>  last, memory requirements may be important when storing many data types.<br>  indeed, storing all indicators above at once in each entry requires 116 bytes<br>  per entry, or 116 mb for a 1-million entries table. this is definitely not<br>  something that can be ignored.</p>\n<p>  example:</p>\n<pre><code># keep track of counters of up to 1 million ip addresses over 5 minutes\n# and store a general purpose counter and the average connection rate\n# computed over a sliding window of 30 seconds.\nstick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)\n</code></pre><p>  see also : “stick match”, “stick on”, “stick store-request”, section 2.2<br>             about time format and section 7 about acls.</p>\n<p>stick store-response <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern used to create an entry in a stickiness table<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</condition></table></pattern></p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the response or connection will<br>               be analysed, extracted and stored in the table once a<br>               server is selected.</pattern></p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional storage condition. it makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           for instance, it could be used to store the ssl session id only\n           when the response is a ssl server hello.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick store-response”<br>  statement  describes a rule to decide what to extract from the response and<br>  when to do it, in order to store it into a stickiness table for further<br>  requests to match it using the “stick match” statement. obviously the<br>  extracted part must make sense and have a chance to be matched in a further<br>  request. storing an id found in a header of a response makes sense.<br>  see section 7 for a complete list of possible patterns and transformation<br>  rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick store-response”<br>  statement will apply, using “if” or “unless” followed by a condition. this<br>  condition will be evaluated while parsing the response, so any criteria can<br>  be used. see section 7 for acl based conditions.</p>\n<p>  there is no limit on the number of “stick store-response” statements, but<br>  there is a limit of 8 simultaneous stores per request or response. this<br>  makes it possible to store up to 8 criteria, all extracted from either the<br>  request or the response, regardless of the number of rules. only the 8 first<br>  ones which match will be kept. using this, it is possible to feed multiple<br>  tables at once in the hope to increase the chance to recognize a user on<br>  another protocol or access method. using multiple store-response rules with<br>  the same table is possible and may be used to find the best criterion to rely<br>  on, by arranging the rules by decreasing preference order. only the first<br>  extracted criterion for a given table will be stored. all subsequent store-<br>  response rules referencing the same table will be skipped and their acls will<br>  not be evaluated. however, even if a store-request rule references a table, a<br>  store-response rule may also use the same table. this means that each table<br>  may learn exactly one element from the request and one element from the<br>  response at once.</p>\n<p>  the table will contain the real server that processed the request.</p>\n<p>  example :</p>\n<pre><code># learn ssl session id from both request and response and create affinity.\nbackend https\n    mode tcp\n    balance roundrobin\n    # maximum ssl session id length is 32 bytes.\n    stick-table type binary len 32 size 30k expire 30m\n\n    acl clienthello req_ssl_hello_type 1\n    acl serverhello rep_ssl_hello_type 2\n\n    # use tcp content accepts to detects ssl client and server hello.\n    tcp-request inspect-delay 5s\n    tcp-request content accept if clienthello\n\n    # no timeout on response inspect delay by default.\n    tcp-response content accept if serverhello\n\n    # ssl session id (sslid) may be present on a client or server hello.\n    # its length is coded on 1 byte at offset 43 and its value starts\n    # at offset 44.\n\n    # match and learn on request if client hello.\n    stick on payload_lv(43,1) if clienthello\n\n    # learn on response if server hello.\n    stick store-response payload_lv(43,1) if serverhello\n\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n</code></pre><p>  see also : “stick-table”, “stick on”, and section 7 about acls and pattern<br>             extraction.</p>\n<p>tcp-check connect [params*]<br>  opens a new connection<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</p>\n<p>  when an application lies on more than a single tcp port or when haproxy<br>  load-balance many services in a single backend, it makes sense to probe all<br>  the services individually before considering a server as operational.</p>\n<p>  when there are no tcp port configured on the server line neither server port<br>  directive, then the ‘tcp-check connect port <port>‘ must be the first step<br>  of the sequence.</port></p>\n<p>  in a tcp-check ruleset a ‘connect’ is required, it is also mandatory to start<br>  the ruleset with a ‘connect’ rule. purpose is to ensure admin know what they<br>  do.</p>\n<p>  parameters :<br>    they are optional and can be used to describe how haproxy should open and<br>    use the tcp connection.</p>\n<pre><code>port      if not set, check port or server port is used.\n          it tells haproxy where to open the connection to.\n          &lt;port&gt; must be a valid tcp port source integer, from 1 to 65535.\n\nsend-proxy   send a proxy protocol string\n\nssl          opens a ciphered connection\n\nexamples:\n     # check http and https services on a server.\n     # first open port 80 thanks to server line port directive, then\n     # tcp-check opens port 443, ciphered and run a request on it:\n     option tcp-check\n     tcp-check connect\n     tcp-check send get\\ /\\ http/1.0\\r\\n\n     tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n     tcp-check send \\r\\n\n     tcp-check expect rstring (2..|3..)\n     tcp-check connect port 443 ssl\n     tcp-check send get\\ /\\ http/1.0\\r\\n\n     tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n     tcp-check send \\r\\n\n     tcp-check expect rstring (2..|3..)\n     server www 10.0.0.1 check port 80\n\n     # check both pop and imap from a single server:\n     option tcp-check\n     tcp-check connect port 110\n     tcp-check expect string +ok\\ pop3\\ ready\n     tcp-check connect port 143\n     tcp-check expect string *\\ ok\\ imap4\\ ready\n     server mail 10.0.0.1 check\n</code></pre><p>  see also : “option tcp-check”, “tcp-check send”, “tcp-check expect”</p>\n<p>tcp-check expect [!] <match> <pattern><br>  specify data to be collected and analysed during a generic health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</pattern></match></p>\n<p>  arguments :<br>    <match>   is a keyword indicating how to look for a specific pattern in the<br>              response. the keyword may be one of “string”, “rstring” or<br>              binary.<br>              the keyword may be preceded by an exclamation mark (“!”) to negate<br>              the match. spaces are allowed between the exclamation mark and the<br>              keyword. see below for more details on the supported keywords.</match></p>\n<pre><code>&lt;pattern&gt; is the pattern to look for. it may be a string or a regular\n          expression. if the pattern contains spaces, they must be escaped\n          with the usual backslash (&apos;\\&apos;).\n          if the match is set to binary, then the pattern must be passed as\n          a serie of hexadecimal digits in an even number. each sequence of\n          two digits will represent a byte. the hexadecimal digits may be\n          used upper or lower case.\n</code></pre><p>  the available matches are intentionally similar to their http-check cousins :</p>\n<pre><code>string &lt;string&gt; : test the exact string matches in the response buffer.\n                  a health check response will be considered valid if the\n                  response&apos;s buffer contains this exact string. if the\n                  &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body contains this\n                  string. this can be used to look for a mandatory pattern\n                  in a protocol response, or to detect a failure when a\n                  specific error appears in a protocol banner.\n\nrstring &lt;regex&gt; : test a regular expression on the response buffer.\n                  a health check response will be considered valid if the\n                  response&apos;s buffer matches this expression. if the\n                  &quot;rstring&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body matches the\n                  expression.\n\nbinary &lt;hexstring&gt; : test the exact string in its hexadecimal form matches\n                     in the response buffer. a health check response will\n                     be considered valid if the response&apos;s buffer contains\n                     this exact hexadecimal string.\n                     purpose is to match data on binary protocols.\n</code></pre><p>  it is important to note that the responses will be limited to a certain size<br>  defined by the global “tune.chksize” option, which defaults to 16384 bytes.<br>  thus, too large responses may not contain the mandatory pattern when using<br>  “string”, “rstring” or binary. if a large response is absolutely required, it<br>  is possible to change the default max size by setting the global variable.<br>  however, it is worth keeping in mind that parsing very large responses can<br>  waste some cpu cycles, especially when regular expressions are used, and that<br>  it is always better to focus the checks on smaller resources. also, in its<br>  current state, the check will not find any string nor regex past a null<br>  character in the response. similarly it is not possible to request matching<br>  the null character.</p>\n<p>  examples :</p>\n<pre><code># perform a pop check\noption tcp-check\ntcp-check expect string +ok\\ pop3\\ ready\n\n# perform an imap check\noption tcp-check\ntcp-check expect string *\\ ok\\ imap4\\ ready\n\n# look for the redis master server\noption tcp-check\ntcp-check send ping\\r\\n\ntcp-check expect +pong\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check send quit\\r\\n\ntcp-check expect string +ok\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check send”,<br>             “tcp-check send-binary”, “http-check expect”, tune.chksize</p>\n<p>tcp-check send <data><br>  specify a string to be sent as a question during a generic health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</data></p>\n<pre><code>&lt;data&gt; : the data to be sent as a question during a generic health check\n         session. for now, &lt;data&gt; must be a string.\n</code></pre><p>  examples :</p>\n<pre><code># look for the redis master server\noption tcp-check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check expect”,<br>             “tcp-check send-binary”, tune.chksize</p>\n<p>tcp-check send-binary <hexastring><br>  specify an hexa digits string to be sent as a binary question during a raw<br>  tcp health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</hexastring></p>\n<pre><code>&lt;data&gt; : the data to be sent as a question during a generic health check\n         session. for now, &lt;data&gt; must be a string.\n&lt;hexastring&gt; : test the exact string in its hexadecimal form matches in the\n               response buffer. a health check response will be considered\n               valid if the response&apos;s buffer contains this exact\n               hexadecimal string.\n               purpose is to send binary data to ask on binary protocols.\n</code></pre><p>  examples :</p>\n<pre><code># redis check in binary\noption tcp-check\ntcp-check send-binary 50494e470d0a # ping\\r\\n\ntcp-check expect binary 2b504f4e47 # +pong\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check expect”,<br>             “tcp-check send”, tune.chksize</p>\n<p>tcp-request connection <action> [{if | unless} <condition>]<br>  perform an action on an incoming connection depending on a layer 4 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “reject”, “track-sc0”, “track-sc1”,<br>                “track-sc2”, and “expect-proxy”. see below for more details.</action></condition></action></p>\n<pre><code>&lt;condition&gt; is a standard layer4-only acl-based condition (see section 7).\n</code></pre><p>  immediately after acceptance of a new incoming connection, it is possible to<br>  evaluate some conditions to decide whether this connection must be accepted<br>  or dropped or have its counters tracked. those conditions cannot make use of<br>  any data contents because the connection has not been read from yet, and the<br>  buffers are not yet allocated. this is used to selectively and very quickly<br>  accept or drop connections from various sources with a very low overhead. if<br>  some contents need to be inspected in order to take the decision, the<br>  “tcp-request content” statements must be used instead.</p>\n<p>  the “tcp-request connection” rules are evaluated in their exact declaration<br>  order. if no rule matches or if there is no rule, the default action is to<br>  accept the incoming connection. there is no specific limit to the number of<br>  rules which may be inserted.</p>\n<p>  four types of actions are supported :</p>\n<pre><code>- accept :\n    accepts the connection if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation.\n\n- reject :\n    rejects the connection if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation. rejected connections do not even become a\n    session, which is why they are accounted separately for in the stats,\n    as &quot;denied connections&quot;. they are not considered for the session\n    rate-limit and are not logged either. the reason is that these rules\n    should only be used to filter extremely high connection rates such as\n    the ones encountered during a massive ddos attack. under these extreme\n    conditions, the simple action of logging each event would make the\n    system collapse and would considerably lower the filtering capacity. if\n    logging is absolutely desired, then &quot;tcp-request content&quot; rules should\n    be used instead.\n\n- expect-proxy layer4 :\n    configures the client-facing connection to receive a proxy protocol\n    header before any byte is read from the socket. this is equivalent to\n    having the &quot;accept-proxy&quot; keyword on the &quot;bind&quot; line, except that using\n    the tcp rule allows the proxy protocol to be accepted only for certain\n    ip address ranges using an acl. this is convenient when multiple layers\n    of load balancers are passed through by traffic coming from public\n    hosts.\n\n- capture &lt;sample&gt; len &lt;length&gt; :\n    this only applies to &quot;tcp-request content&quot; rules. it captures sample\n    expression &lt;sample&gt; from the request buffer, and converts it to a\n    string of at most &lt;len&gt; characters. the resulting string is stored into\n    the next request &quot;capture&quot; slot, so it will possibly appear next to\n    some captured http headers. it will then automatically appear in the\n    logs, and it will be possible to extract it using sample fetch rules to\n    feed it into headers or anything. the length should be limited given\n    that this size will be allocated for each capture during the whole\n    session life. please check section 7.3 (fetching samples) and &quot;capture\n    request header&quot; for more information.\n\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;] :\n    enables tracking of sticky counters from current connection. these\n    rules do not stop evaluation and do not change default action. 3 sets\n    of counters may be simultaneously tracked by the same connection. the\n    first &quot;track-sc0&quot; rule executed enables tracking of the counters of the\n    specified table as the first set. the first &quot;track-sc1&quot; rule executed\n    enables tracking of the counters of the specified table as the second\n    set. the first &quot;track-sc2&quot; rule executed enables tracking of the\n    counters of the specified table as the third set. it is a recommended\n    practice to use the first set of counters for the per-frontend counters\n    and the second set for the per-backend ones. but this is just a\n    guideline, all may be used everywhere.\n\n    these actions take one or two arguments :\n      &lt;key&gt;   is mandatory, and is a sample expression rule as described\n              in section 7.3\\. it describes what elements of the incoming\n              request or connection will be analysed, extracted, combined,\n              and used to select which table entry to update the counters.\n              note that &quot;tcp-request connection&quot; cannot use content-based\n              fetches.\n\n     &lt;table&gt;  is an optional table to be used instead of the default one,\n              which is the stick-table declared in the current proxy. all\n              the counters for the matches and updates for the key will\n              then be performed in that table until the session ends.\n\n    once a &quot;track-sc*&quot; rule is executed, the key is looked up in the table\n    and if it is not found, an entry is allocated for it. then a pointer to\n    that entry is kept during all the session&apos;s life, and this entry&apos;s\n    counters are updated as often as possible, every time the session&apos;s\n    counters are updated, and also systematically when the session ends.\n    counters are only updated for events that happen after the tracking has\n    been started. for example, connection counters will not be updated when\n    tracking layer 7 information, since the connection event happens before\n    layer7 information is extracted.\n\n    if the entry tracks concurrent connection counters, one connection is\n    counted for as long as the entry is tracked, and the entry will not\n    expire during that time. tracking counters also provides a performance\n    advantage over just checking the keys, because only one table lookup is\n    performed for all acl checks that make use of it.\n</code></pre><p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  “track-sc*” actions as well as for changing the default action to a reject.</p>\n<p>  example: accept all connections from white-listed hosts, reject too fast<br>           connection without counting them, and track accepted connections.<br>           this results in connection rate being capped from abusive sources.</p>\n<pre><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection reject if { src_conn_rate gt 10 }\ntcp-request connection track-sc0 src\n</code></pre><p>  example: accept all connections from white-listed hosts, count all other<br>           connections and reject too fast ones. this results in abusive ones<br>           being blocked as long as they don’t slow down.</p>\n<pre><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection track-sc0 src\ntcp-request connection reject if { sc0_conn_rate gt 10 }\n</code></pre><p>  example: enable the proxy protocol for traffic coming from all known proxies.</p>\n<pre><code>tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request content”, “stick-table”</p>\n<p>tcp-request content <action> [{if | unless} <condition>]<br>  perform an action on a new session depending on a layer 4-7 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “reject”, “track-sc0”, “track-sc1”,<br>                “track-sc2”, “capture” and “lua”. see “tcp-request connection”<br>                above for their signification.</action></condition></action></p>\n<pre><code>&lt;condition&gt; is a standard layer 4-7 acl-based condition (see section 7).\n</code></pre><p>  a request’s contents can be analysed at an early stage of request processing<br>  called “tcp content inspection”. during this stage, acl-based rules are<br>  evaluated every time the request contents are updated, until either an<br>  “accept” or a “reject” rule matches, or the tcp request inspection delay<br>  expires with no matching rule.</p>\n<p>  the first difference between these rules and “tcp-request connection” rules<br>  is that “tcp-request content” rules can make use of contents to take a<br>  decision. most often, these decisions will consider a protocol recognition or<br>  validity. the second difference is that content-based rules can be used in<br>  both frontends and backends. in case of http keep-alive with the client, all<br>  tcp-request content rules are evaluated again, so haproxy keeps a record of<br>  what sticky counters were assigned by a “tcp-request connection” versus a<br>  “tcp-request content” rule, and flushes all the content-related ones after<br>  processing an http request, so that they may be evaluated again by the rules<br>  being evaluated again for the next request. this is of particular importance<br>  when the rule tracks some l7 information or when it is conditioned by an<br>  l7-based acl, since tracking may change between requests.</p>\n<p>  content-based rules are evaluated in their exact declaration order. if no<br>  rule matches or if there is no rule, the default action is to accept the<br>  contents. there is no specific limit to the number of rules which may be<br>  inserted.</p>\n<p>  four types of actions are supported :</p>\n<pre><code>- accept : the request is accepted\n- reject : the request is rejected and the connection is closed\n- capture : the specified sample expression is captured\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;]\n- lua &lt;function&gt;\n- set-var(&lt;var-name&gt;) &lt;expr&gt;\n</code></pre><p>  they have the same meaning as their counter-parts in “tcp-request connection”<br>  so please refer to that section for a complete description.</p>\n<p>  while there is nothing mandatory about it, it is recommended to use the<br>  track-sc0 in “tcp-request connection” rules, track-sc1 for “tcp-request<br>  content” rules in the frontend, and track-sc2 for “tcp-request content”<br>  rules in the backend, because that makes the configuration more readable<br>  and easier to troubleshoot, but this is just a guideline and all counters<br>  may be used everywhere.</p>\n<p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  “track-sc*” actions as well as for changing the default action to a reject.</p>\n<p>  it is perfectly possible to match layer 7 contents with “tcp-request content”<br>  rules, since http-specific acl matches are able to preliminarily parse the<br>  contents of a buffer before extracting the required data. if the buffered<br>  contents do not parse as a valid http message, then the acl does not match.<br>  the parser which is involved there is exactly the same as for all other http<br>  processing, so there is no risk of parsing something differently. in an http<br>  backend connected to from an http frontend, it is guaranteed that http<br>  contents will always be immediately present when the rule is evaluated first.</p>\n<p>  tracking layer7 information is also possible provided that the information<br>  are present when the rule is processed. the rule processing engine is able to<br>  wait until the inspect delay expires when the data to be tracked is not yet<br>  available.</p>\n<p>  the “lua” keyword is followed by a lua function name. it is used to run a lua<br>  function if the action is executed. the single parameter is the name of the<br>  function to run. the prototype of the function is documented in the api<br>  documentation.</p>\n<p>  the “set-var” is used to set the content of a variable. the variable is<br>  declared inline.</p>\n<pre><code>&lt;var-name&gt; the name of the variable starts by an indication about its scope.\n           the allowed scopes are:\n             &quot;sess&quot; : the variable is shared with all the session,\n             &quot;txn&quot;  : the variable is shared with all the transaction\n                      (request and response)\n             &quot;req&quot;  : the variable is shared only during the request\n                      processing\n             &quot;res&quot;  : the variable is shared only during the response\n                      processing.\n           this prefix is followed by a name. the separator is a &apos;.&apos;.\n           the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos; and &apos;_&apos;.\n\n&lt;expr&gt;     is a standard haproxy expression formed by a sample-fetch\n           followed by some converters.\n</code></pre><p>  example:</p>\n<pre><code>tcp-request content set-var(sess.my_var) src\n</code></pre><p>  example:</p>\n<pre><code># accept http requests containing a host header saying &quot;example.com&quot;\n# and reject everything else.\nacl is_host_com hdr(host) -i example.com\ntcp-request inspect-delay 30s\ntcp-request content accept if is_host_com\ntcp-request content reject\n</code></pre><p>  example:</p>\n<pre><code># reject smtp connection if client speaks first\ntcp-request inspect-delay 30s\nacl content_present req_len gt 0\ntcp-request content reject if content_present\n\n# forward https connection only if client speaks\ntcp-request inspect-delay 30s\nacl content_present req_len gt 0\ntcp-request content accept if content_present\ntcp-request content reject\n</code></pre><p>  example:</p>\n<pre><code># track the last ip from x-forwarded-for\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 hdr(x-forwarded-for,-1)\n</code></pre><p>  example:</p>\n<pre><code># track request counts per &quot;base&quot; (concatenation of host+url)\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 base table req-rate\n</code></pre><p>  example: track per-frontend and per-backend counters, block abusers at the<br>           frontend when the backend detects abuse.</p>\n<pre><code>frontend http\n    # use general purpose couter 0 in sc0 as a global abuse counter\n    # protecting all our sites\n    stick-table type ip size 1m expire 5m store gpc0\n    tcp-request connection track-sc0 src\n    tcp-request connection reject if { sc0_get_gpc0 gt 0 }\n    ...\n    use_backend http_dynamic if { path_end .php }\n\nbackend http_dynamic\n    # if a source makes too fast requests to this dynamic site (tracked\n    # by sc1), block it globally in the frontend.\n    stick-table type ip size 1m expire 5m store http_req_rate(10s)\n    acl click_too_fast sc1_http_req_rate gt 10\n    acl mark_as_abuser sc0_inc_gpc0 gt 0\n    tcp-request content track-sc1 src\n    tcp-request content reject if click_too_fast mark_as_abuser\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request connection”, “tcp-request inspect-delay”</p>\n<p>tcp-request inspect-delay <timeout><br>  set the maximum allowed time to wait for data during content inspection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  people using haproxy primarily as a tcp relay are often worried about the<br>  risk of passing any type of protocol to a server without any analysis. in<br>  order to be able to analyze the request contents, we must first withhold<br>  the data then analyze them. this statement simply enables withholding of<br>  data for at most the specified amount of time.</p>\n<p>  tcp content inspection applies very early when a connection reaches a<br>  frontend, then very early when the connection is forwarded to a backend. this<br>  means that a connection may experience a first delay in the frontend and a<br>  second delay in the backend if both have tcp-request rules.</p>\n<p>  note that when performing content inspection, haproxy will evaluate the whole<br>  rules for every new chunk which gets in, taking into account the fact that<br>  those data are partial. if no rule matches before the aforementioned delay,<br>  a last check is performed upon expiration, this time considering that the<br>  contents are definitive. if no delay is set, haproxy will not wait at all<br>  and will immediately apply a verdict based on the available information.<br>  obviously this is unlikely to be very useful and might even be racy, so such<br>  setups are not recommended.</p>\n<p>  as soon as a rule matches, the request is released and continues as usual. if<br>  the timeout is reached and no rule matches, the default policy will be to let<br>  it pass through unaffected.</p>\n<p>  for most protocols, it is enough to set it to a few seconds, as most clients<br>  send the full request immediately upon connection. add 3 or more seconds to<br>  cover tcp retransmits but that’s all. for some protocols, it may make sense<br>  to use large values, for instance to ensure that the client never talks<br>  before the server (eg: smtp), or to wait for a client to talk before passing<br>  data to the server (eg: ssl). note that the client timeout must cover at<br>  least the inspection delay, otherwise it will expire first. if the client<br>  closes the connection or if the buffer is full, the delay immediately expires<br>  since the contents will not be able to change anymore.</p>\n<p>  see also : “tcp-request content accept”, “tcp-request content reject”,<br>             “timeout client”.</p>\n<p>tcp-response content <action> [{if | unless} <condition>]<br>  perform an action on a session response depending on a layer 4-7 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “close”, “reject”, “lua”.</action></condition></action></p>\n<pre><code>&lt;condition&gt; is a standard layer 4-7 acl-based condition (see section 7).\n</code></pre><p>  response contents can be analysed at an early stage of response processing<br>  called “tcp content inspection”. during this stage, acl-based rules are<br>  evaluated every time the response contents are updated, until either an<br>  “accept”, “close” or a “reject” rule matches, or a tcp response inspection<br>  delay is set and expires with no matching rule.</p>\n<p>  most often, these decisions will consider a protocol recognition or validity.</p>\n<p>  content-based rules are evaluated in their exact declaration order. if no<br>  rule matches or if there is no rule, the default action is to accept the<br>  contents. there is no specific limit to the number of rules which may be<br>  inserted.</p>\n<p>  two types of actions are supported :</p>\n<pre><code>- accept :\n    accepts the response if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation.\n\n- close :\n    immediately closes the connection with the server if the condition is\n    true (when used with &quot;if&quot;), or false (when used with &quot;unless&quot;). the\n    first such rule executed ends the rules evaluation. the main purpose of\n    this action is to force a connection to be finished between a client\n    and a server after an exchange when the application protocol expects\n    some long time outs to elapse first. the goal is to eliminate idle\n    connections which take significant resources on servers with certain\n    protocols.\n\n- reject :\n    rejects the response if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation. rejected session are immediately closed.\n\n- lua &lt;function&gt;\n    executes lua.\n\n- set-var(&lt;var-name&gt;) &lt;expr&gt;\n    sets a variable.\n</code></pre><p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  for changing the default action to a reject.</p>\n<p>  it is perfectly possible to match layer 7 contents with “tcp-response<br>  content” rules, but then it is important to ensure that a full response has<br>  been buffered, otherwise no contents will match. in order to achieve this,<br>  the best solution involves detecting the http protocol during the inspection<br>  period.</p>\n<p>  the “lua” keyword is followed by a lua function name. it is used to run a lua<br>  function if the action is executed. the single parameter is the name of the<br>  function to run. the prototype of the function is documented in the api<br>  documentation.</p>\n<p>  the “set-var” is used to set the content of a variable. the variable is<br>  declared inline.</p>\n<pre><code>&lt;var-name&gt; the name of the variable starts by an indication about its scope.\n           the allowed scopes are:\n             &quot;sess&quot; : the variable is shared with all the session,\n             &quot;txn&quot;  : the variable is shared with all the transaction\n                      (request and response)\n             &quot;req&quot;  : the variable is shared only during the request\n                      processing\n             &quot;res&quot;  : the variable is shared only during the response\n                      processing.\n           this prefix is followed by a name. the separator is a &apos;.&apos;.\n           the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos; and &apos;_&apos;.\n\n&lt;expr&gt;     is a standard haproxy expression formed by a sample-fetch\n           followed by some converters.\n</code></pre><p>  example:</p>\n<pre><code>tcp-request content set-var(sess.my_var) src\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request content”, “tcp-response inspect-delay”</p>\n<p>tcp-response inspect-delay <timeout><br>  set the maximum allowed time to wait for a response during content inspection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  see also : “tcp-response content”, “tcp-request inspect-delay”.</p>\n<p>timeout check <timeout><br>  set additional check timeout, but only after a connection has been already<br>  established.</timeout></p>\n<p>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments:<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></p>\n<p>  if set, haproxy uses min(“timeout connect”, “inter”) as a connect timeout<br>  for check and “timeout check” as an additional read timeout. the “min” is<br>  used so that people running with <em>very</em> long “timeout connect” (eg. those<br>  who needed this due to the queue or tarpit) do not slow down their checks.<br>  (please also note that there is no valid reason to have such long connect<br>  timeouts, because “timeout queue” and “timeout tarpit” can always be used to<br>  avoid that).</p>\n<p>  if “timeout check” is not set haproxy uses “inter” for complete check<br>  timeout (connect + read) exactly like all &lt;1.3.15 version.</p>\n<p>  in most cases check request is much simpler and faster to handle than normal<br>  requests and people may want to kick out laggy servers so this timeout should<br>  be smaller than “timeout server”.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it.</p>\n<p>  see also: “timeout connect”, “timeout queue”, “timeout server”,<br>            “timeout tarpit”.</p>\n<p>timeout client <timeout><br>timeout clitimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the client side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></timeout></p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase, when the client sends the request, and during the<br>  response while it is reading data sent by the server. the value is specified<br>  in milliseconds by default, but can be in any other unit if the number is<br>  suffixed by the unit, as specified at the top of this document. in tcp mode<br>  (and to a lesser extent, in http mode), it is highly recommended that the<br>  client timeout remains equal to the server timeout in order to avoid complex<br>  situations to debug. it is a good practice to cover one or several tcp packet<br>  losses by specifying timeouts that are slightly above multiples of 3 seconds<br>  (eg: 4 or 5 seconds). if some long-lived sessions are mixed with short-lived<br>  sessions (eg: websocket and http), it’s worth considering “timeout tunnel”,<br>  which overrides “timeout client” and “timeout server” for tunnels, as well as<br>  “timeout client-fin” for half-closed connections.</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “clitimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout clitimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also : “clitimeout”, “timeout server”, “timeout tunnel”.</p>\n<p>timeout client-fin <timeout><br>  set the inactivity timeout on the client side for half-closed connections.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data while one direction is already shut down. this timeout is different<br>  from “timeout client” in that it only applies to connections which are closed<br>  in one direction. this is particularly useful to avoid keeping connections in<br>  fin_wait state for too long when clients do not disconnect cleanly. this<br>  problem is particularly common long connections such as rdp or websocket.<br>  note that this timeout can override “timeout tunnel” when a connection shuts<br>  down in one direction.</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. by default it is not set, so half-closed connections<br>  will use the other timeouts (timeout.client or timeout.tunnel).</p>\n<p>  see also : “timeout client”, “timeout server-fin”, and “timeout tunnel”.</p>\n<p>timeout connect <timeout><br>timeout contimeout <timeout> (deprecated)<br>  set the maximum time to wait for a connection attempt to a server to succeed.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></timeout></p>\n<p>  if the server is located on the same lan as haproxy, the connection should be<br>  immediate (less than a few milliseconds). anyway, it is a good practice to<br>  cover one or several tcp packet losses by specifying timeouts that are<br>  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the<br>  connect timeout also presets both queue and tarpit timeouts to the same value<br>  if these have not been specified.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of failed sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “contimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout contimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also: “timeout check”, “timeout queue”, “timeout server”, “contimeout”,<br>            “timeout tarpit”.</p>\n<p>timeout http-keep-alive <timeout><br>  set the maximum allowed time to wait for a new http request to appear<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  by default, the time to wait for a new request in case of keep-alive is set<br>  by “timeout http-request”. however this is not always convenient because some<br>  people want very short keep-alive timeouts in order to release connections<br>  faster, and others prefer to have larger ones but still have short timeouts<br>  once the request has started to present itself.</p>\n<p>  the “http-keep-alive” timeout covers these needs. it will define how long to<br>  wait for a new http request to start coming after a response was sent. once<br>  the first byte of request has been seen, the “http-request” timeout is used<br>  to wait for the complete request to come. note that empty lines prior to a<br>  new request do not refresh the timeout and are not counted as a new request.</p>\n<p>  there is also another difference between the two timeouts : when a connection<br>  expires during timeout http-keep-alive, no error is returned, the connection<br>  just closes. if the connection expires in “http-request” while waiting for a<br>  connection to complete, a http 408 error is returned.</p>\n<p>  in general it is optimal to set this value to a few tens to hundreds of<br>  milliseconds, to allow users to fetch all objects of a page at once but<br>  without waiting for further clicks. also, if set to a very small value (eg:<br>  1 millisecond) it will probably only accept pipelined requests but not the<br>  non-pipelined ones. it may be a nice trade-off for very large sites running<br>  with tens to hundreds of thousands of clients.</p>\n<p>  if this parameter is not set, the “http-request” timeout applies, and if both<br>  are not set, “timeout client” still applies at the lower level. it should be<br>  set in the frontend to take effect, unless the frontend is in tcp mode, in<br>  which case the http backend’s timeout will be used.</p>\n<p>  see also : “timeout http-request”, “timeout client”.</p>\n<p>timeout http-request <timeout><br>  set the maximum allowed time to wait for a complete http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  in order to offer dos protection, it may be required to lower the maximum<br>  accepted time to receive a complete http request without affecting the client<br>  timeout. this helps protecting against established connections on which<br>  nothing is sent. the client timeout cannot offer a good protection against<br>  this abuse because it is an inactivity timeout, which means that if the<br>  attacker sends one character every now and then, the timeout will not<br>  trigger. with the http request timeout, no matter what speed the client<br>  types, the request will be aborted if it does not complete in time. when the<br>  timeout expires, an http 408 response is sent to the client to inform it<br>  about the problem, and the connection is closed. the logs will report<br>  termination codes “cr”. some recent browsers are having problems with this<br>  standard, well-documented behaviour, so it might be needed to hide the 408<br>  code using “option http-ignore-probes” or “errorfile 408 /dev/null”. see<br>  more details in the explanations of the “cr” termination code in section 8.5.</p>\n<p>  note that this timeout only applies to the header part of the request, and<br>  not to any data. as soon as the empty line is received, this timeout is not<br>  used anymore. it is used again on keep-alive connections to wait for a second<br>  request if “timeout http-keep-alive” is not set.</p>\n<p>  generally it is enough to set it to a few seconds, as most clients send the<br>  full request immediately upon connection. add 3 or more seconds to cover tcp<br>  retransmits but that’s all. setting it to very low values (eg: 50 ms) will<br>  generally work on local networks as long as there are no packet losses. this<br>  will prevent people from sending bare http requests using telnet.</p>\n<p>  if this parameter is not set, the client timeout still applies between each<br>  chunk of the incoming request. it should be set in the frontend to take<br>  effect, unless the frontend is in tcp mode, in which case the http backend’s<br>  timeout will be used.</p>\n<p>  see also : “errorfile”, “http-ignore-probes”, “timeout http-keep-alive”, and<br>             “timeout client”.</p>\n<p>timeout queue <timeout><br>  set the maximum time to wait in the queue for a connection slot to be free<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  when a server’s maxconn is reached, connections are left pending in a queue<br>  which may be server-specific or global to the backend. in order not to wait<br>  indefinitely, a timeout is applied to requests pending in the queue. if the<br>  timeout is reached, it is considered that the request will almost never be<br>  served, so it is dropped and a 503 error is returned to the client.</p>\n<p>  the “timeout queue” statement allows to fix the maximum time for a request to<br>  be left pending in a queue. if unspecified, the same value as the backend’s<br>  connection timeout (“timeout connect”) is used, for backwards compatibility<br>  with older versions with no “timeout queue” parameter.</p>\n<p>  see also : “timeout connect”, “contimeout”.</p>\n<p>timeout server <timeout><br>timeout srvtimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the server side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></timeout></p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase of the server’s response, when it has to send the<br>  headers, as it directly represents the server’s processing time for the<br>  request. to find out what value to put there, it’s often good to start with<br>  what would be considered as unacceptable response times, then check the logs<br>  to observe the response time distribution, and adjust the value accordingly.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. in tcp mode (and to a lesser extent, in http mode), it is highly<br>  recommended that the client timeout remains equal to the server timeout in<br>  order to avoid complex situations to debug. whatever the expected server<br>  response times, it is a good practice to cover at least one or several tcp<br>  packet losses by specifying timeouts that are slightly above multiples of 3<br>  seconds (eg: 4 or 5 seconds minimum). if some long-lived sessions are mixed<br>  with short-lived sessions (eg: websocket and http), it’s worth considering<br>  “timeout tunnel”, which overrides “timeout client” and “timeout server” for<br>  tunnels.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “srvtimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout srvtimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also : “srvtimeout”, “timeout client” and “timeout tunnel”.</p>\n<p>timeout server-fin <timeout><br>  set the inactivity timeout on the server side for half-closed connections.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data while one direction is already shut down. this timeout is different<br>  from “timeout server” in that it only applies to connections which are closed<br>  in one direction. this is particularly useful to avoid keeping connections in<br>  fin_wait state for too long when a remote server does not disconnect cleanly.<br>  this problem is particularly common long connections such as rdp or websocket.<br>  note that this timeout can override “timeout tunnel” when a connection shuts<br>  down in one direction. this setting was provided for completeness, but in most<br>  situations, it should not be needed.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. by default it is not set, so half-closed connections<br>  will use the other timeouts (timeout.server or timeout.tunnel).</p>\n<p>  see also : “timeout client-fin”, “timeout server”, and “timeout tunnel”.</p>\n<p>timeout tarpit <timeout><br>  set the duration for which tarpitted connections will be maintained<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the tarpit duration specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  when a connection is tarpitted using “reqtarpit”, it is maintained open with<br>  no activity for a certain amount of time, then closed. “timeout tarpit”<br>  defines how long it will be maintained open.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. if unspecified, the same value as the backend’s connection timeout<br>  (“timeout connect”) is used, for backwards compatibility with older versions<br>  with no “timeout tarpit” parameter.</p>\n<p>  see also : “timeout connect”, “contimeout”.</p>\n<p>timeout tunnel <timeout><br>  set the maximum inactivity time on the client and server side for tunnels.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</timeout></timeout></p>\n<p>  the tunnel timeout applies when a bidirectional connection is established<br>  between a client and a server, and the connection remains inactive in both<br>  directions. this timeout supersedes both the client and server timeouts once<br>  the connection becomes a tunnel. in tcp, this timeout is used as soon as no<br>  analyser remains attached to either connection (eg: tcp content rules are<br>  accepted). in http, this timeout is used when a connection is upgraded (eg:<br>  when switching to the websocket protocol, or forwarding a connect request<br>  to a proxy), or after the first response when no keepalive/close option is<br>  specified.</p>\n<p>  since this timeout is usually used in conjunction with long-lived connections,<br>  it usually is a good idea to also set “timeout client-fin” to handle the<br>  situation where a client suddenly disappears from the net and does not<br>  acknowledge a close, or sends a shutdown and does not acknowledge pending<br>  data anymore. this can happen in lossy networks where firewalls are present,<br>  and is detected by the presence of large amounts of sessions in a fin_wait<br>  state.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. whatever the expected normal idle time, it is a good practice to<br>  cover at least one or several tcp packet losses by specifying timeouts that<br>  are slightly above multiples of 3 seconds (eg: 4 or 5 seconds minimum).</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it.</p>\n<p>  example :<br>        defaults http<br>            option http-server-close<br>            timeout connect 5s<br>            timeout client 30s<br>            timeout client-fin 30s<br>            timeout server 30s<br>            timeout tunnel  1h    # timeout to use with websocket and connect</p>\n<p>  see also : “timeout client”, “timeout client-fin”, “timeout server”.</p>\n<p>transparent (deprecated)<br>  enable client-side transparent proxying<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  this keyword was introduced in order to provide layer 7 persistence to layer<br>  3 load balancers. the idea is to use the os’s ability to redirect an incoming<br>  connection for a remote address to a local process (here haproxy), and let<br>  this process know what address was initially requested. when this option is<br>  used, sessions without cookies will be forwarded to the original destination<br>  ip address of the incoming request (which should match that of another<br>  equipment), while requests with cookies will still be forwarded to the<br>  appropriate server.</p>\n<p>  the “transparent” keyword is deprecated, use “option transparent” instead.</p>\n<p>  note that contrary to a common belief, this option does not make haproxy<br>  present the client’s ip to the server when establishing the connection.</p>\n<p>  see also: “option transparent”</p>\n<p>unique-id-format <string><br>  generate a unique id for each request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  yes  |    yes   |   yes  |   no<br>  arguments :<br>    <string>   is a log-format string.</string></string></p>\n<p>  this keyword creates a id for each request using the custom log format. a<br>  unique id is useful to trace a request passing through many components of<br>  a complex infrastructure. the newly created id may also be logged using the<br>  %id tag the log-format string.</p>\n<p>  the format should be composed from elements that are guaranteed to be<br>  unique when combined together. for instance, if multiple haproxy instances<br>  are involved, it might be important to include the node name. it is often<br>  needed to log the incoming connection’s source and destination addresses<br>  and ports. note that since multiple requests may be performed over the same<br>  connection, including a request counter may help differentiate them.<br>  similarly, a timestamp may protect against a rollover of the counter.<br>  logging the process id will avoid collisions after a service restart.</p>\n<p>  it is recommended to use hexadecimal notation for many fields since it<br>  makes them more compact and saves space in logs.</p>\n<p>  example:</p>\n<pre><code>unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n\nwill generate:\n\n       7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n</code></pre><p>  see also: “unique-id-header”</p>\n<p>unique-id-header <name><br>  add a unique id header in the http request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  yes  |    yes   |   yes  |   no<br>  arguments :<br>    <name>   is the name of the header.</name></name></p>\n<p>  add a unique-id header in the http request sent to the server, using the<br>  unique-id-format. it can’t work if the unique-id-format doesn’t exist.</p>\n<p>  example:</p>\n<pre><code>    unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n    unique-id-header x-unique-id\n\n    will generate:\n\n       x-unique-id: 7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\nsee also: &quot;unique-id-format&quot;\n</code></pre><p>use_backend <backend> [{if | unless} <condition>]<br>  switch to a specific backend if/unless an acl-based condition is matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <backend>   is the name of a valid backend or “listen” section, or a<br>                “log-format” string resolving to a backend name.</backend></condition></backend></p>\n<pre><code>&lt;condition&gt; is a condition composed of acls, as described in section 7\\. if\n            it is omitted, the rule is unconditionally applied.\n</code></pre><p>  when doing content-switching, connections arrive on a frontend and are then<br>  dispatched to various backends depending on a number of conditions. the<br>  relation between the conditions and the backends is described with the<br>  “use_backend” keyword. while it is normally used with http processing, it can<br>  also be used in pure tcp, either without content using stateless acls (eg:<br>  source address validation) or combined with a “tcp-request” rule to wait for<br>  some payload.</p>\n<p>  there may be as many “use_backend” rules as desired. all of these rules are<br>  evaluated in their declaration order, and the first one which matches will<br>  assign the backend.</p>\n<p>  in the first form, the backend will be used if the condition is met. in the<br>  second form, the backend will be used if the condition is not met. if no<br>  condition is valid, the backend defined with “default_backend” will be used.<br>  if no default backend is defined, either the servers in the same section are<br>  used (in case of a “listen” section) or, in case of a frontend, no server is<br>  used and a 503 service unavailable response is returned.</p>\n<p>  note that it is possible to switch from a tcp frontend to an http backend. in<br>  this case, either the frontend has already checked that the protocol is http,<br>  and backend processing will immediately follow, or the backend will wait for<br>  a complete http request to get in. this feature is useful when a frontend<br>  must decode several protocols on a unique port, one of them being http.</p>\n<p>  when <backend> is a simple name, it is resolved at configuration time, and an<br>  error is reported if the specified backend does not exist. if <backend> is<br>  a log-format string instead, no check may be done at configuration time, so<br>  the backend name is resolved dynamically at run time. if the resulting<br>  backend name does not correspond to any valid backend, no other rule is<br>  evaluated, and the default_backend directive is applied instead. note that<br>  when using dynamic backend names, it is highly recommended to use a prefix<br>  that no other backend uses in order to ensure that an unauthorized backend<br>  cannot be forced from the request.</backend></backend></p>\n<p>  it is worth mentioning that “use_backend” rules with an explicit name are<br>  used to detect the association between frontends and backends to compute the<br>  backend’s “fullconn” setting. this cannot be done for dynamic names.</p>\n<p>  see also: “default_backend”, “tcp-request”, “fullconn”, “log-format”, and<br>            section 7 about acls.</p>\n<p>use-server <server> if <condition><br>use-server <server> unless <condition><br>  only use a specific server if/unless an acl-based condition is matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    no    |   yes  |   yes<br>  arguments :<br>    <server>    is the name of a valid server in the same backend section.</server></condition></server></condition></server></p>\n<pre><code>&lt;condition&gt; is a condition composed of acls, as described in section 7.\n</code></pre><p>  by default, connections which arrive to a backend are load-balanced across<br>  the available servers according to the configured algorithm, unless a<br>  persistence mechanism such as a cookie is used and found in the request.</p>\n<p>  sometimes it is desirable to forward a particular request to a specific<br>  server without having to declare a dedicated backend for this server. this<br>  can be achieved using the “use-server” rules. these rules are evaluated after<br>  the “redirect” rules and before evaluating cookies, and they have precedence<br>  on them. there may be as many “use-server” rules as desired. all of these<br>  rules are evaluated in their declaration order, and the first one which<br>  matches will assign the server.</p>\n<p>  if a rule designates a server which is down, and “option persist” is not used<br>  and no force-persist rule was validated, it is ignored and evaluation goes on<br>  with the next rules until one matches.</p>\n<p>  in the first form, the server will be used if the condition is met. in the<br>  second form, the server will be used if the condition is not met. if no<br>  condition is valid, the processing continues and the server will be assigned<br>  according to other persistence mechanisms.</p>\n<p>  note that even if a rule is matched, cookie processing is still performed but<br>  does not assign the server. this allows prefixed cookies to have their prefix<br>  stripped.</p>\n<p>  the “use-server” statement works both in http and tcp mode. this makes it<br>  suitable for use with content-based inspection. for instance, a server could<br>  be selected in a farm according to the tls sni field. and if these servers<br>  have their weight set to zero, they will not be used for other traffic.</p>\n<p>  example :</p>\n<pre><code># intercept incoming tls requests based on the sni field\nuse-server www if { req_ssl_sni -i www.example.com }\nserver     www 192.168.0.1:443 weight 0\nuse-server mail if { req_ssl_sni -i mail.example.com }\nserver     mail 192.168.0.1:587 weight 0\nuse-server imap if { req_ssl_sni -i imap.example.com }\nserver     mail 192.168.0.1:993 weight 0\n# all the rest is forwarded to this server\nserver  default 192.168.0.2:443 check\n</code></pre><p>  see also: “use_backend”, section 5 about server and section 7 about acls.</p>\n<h2 id=\"5-bind-and-server-options\"><a href=\"#5-bind-and-server-options\" class=\"headerlink\" title=\"5. bind and server options\"></a>5. bind and server options</h2><p>the “bind”, “server” and “default-server” keywords support a number of settings<br>depending on some build options and on the system haproxy was built on. these<br>settings generally each consist in one word sometimes followed by a value,<br>written on the same line as the “bind” or “server” line. all these options are<br>described in this section.</p>\n<h2 id=\"5-1-bind-options\"><a href=\"#5-1-bind-options\" class=\"headerlink\" title=\"5.1. bind options\"></a>5.1. bind options</h2><p>the “bind” keyword supports a certain number of settings which are all passed<br>as arguments on the same line. the order in which those arguments appear makes<br>no importance, provided that they appear after the bind address. all of these<br>parameters are optional. some of them consist in a single words (booleans),<br>while other ones expect a value after them. in this case, the value must be<br>provided immediately after the setting name.</p>\n<p>the currently supported settings are the following ones.</p>\n<p>accept-proxy<br>  enforces the use of the proxy protocol over any connection accepted by any of<br>  the sockets declared on the same line. versions 1 and 2 of the proxy protocol<br>  are supported and correctly detected. the proxy protocol dictates the layer<br>  3/4 addresses of the incoming connection to be used everywhere an address is<br>  used, with the only exception of “tcp-request connection” rules which will<br>  only see the real connection address. logs will reflect the addresses<br>  indicated in the protocol, unless it is violated, in which case the real<br>  address will still be used.  this keyword combined with support from external<br>  components can be used as an efficient and reliable alternative to the<br>  x-forwarded-for mechanism which is not always reliable and not even always<br>  usable. see also “tcp-request connection expect-proxy” for a finer-grained<br>  setting of which client is allowed to use the protocol.</p>\n<p>alpn <protocols><br>  this enables the tls alpn extension and advertises the specified protocol<br>  list as supported on top of alpn. the protocol list consists in a comma-<br>  delimited list of protocol names, for instance: “http/1.1,http/1.0” (without<br>  quotes). this requires that the ssl library is build with support for tls<br>  extensions enabled (check with haproxy -vv). the alpn extension replaces the<br>  initial npn extension.</protocols></p>\n<p>backlog <backlog><br>  sets the socket’s backlog to this value. if unspecified, the frontend’s<br>  backlog is used instead, which generally defaults to the maxconn value.</backlog></p>\n<p>ecdhe <named curve=\"\"><br>  this setting is only available when support for openssl was built in. it sets<br>  the named curve (rfc 4492) used to generate ecdh ephemeral keys. by default,<br>  used named curve is prime256v1.</named></p>\n<p>ca-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load ca certificates used to verify<br>  client’s certificate.</cafile></p>\n<p>ca-ignore-err [all|<errorid>,…]<br>  this setting is only available when support for openssl was built in.<br>  sets a comma separated list of errorids to ignore during verify at depth &gt; 0.<br>  if set to ‘all’, all errors are ignored. ssl handshake is not aborted if an<br>  error is ignored.</errorid></p>\n<p>ca-sign-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file containing both the ca certificate and the ca private<br>  key used to create and sign server’s certificates. this is a mandatory<br>  setting when the dynamic generation of certificates is enabled. see<br>  ‘generate-certificates’ for details.</cafile></p>\n<p>ca-sign-passphrase <passphrase><br>  this setting is only available when support for openssl was built in. it is<br>  the ca private key passphrase. this setting is optional and used only when<br>  the dynamic generation of certificates is enabled. see<br>  ‘generate-certificates’ for details.</passphrase></p>\n<p>ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it sets<br>  the string describing the list of cipher algorithms (“cipher suite”) that are<br>  negotiated during the ssl/tls handshake. the format of the string is defined<br>  in “man 1 ciphers” from openssl man pages, and can be for instance a string<br>  such as “aes:all:!anull:!enull:+rc4:@strength” (without quotes).</ciphers></p>\n<p>crl-file <crlfile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load certificate revocation list used<br>  to verify client’s certificate.</crlfile></p>\n<p>crt <cert><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file containing both the required certificates and any<br>  associated private keys. this file can be built by concatenating multiple<br>  pem files into one (e.g. cat cert.pem key.pem &gt; combined.pem). if your ca<br>  requires an intermediate certificate, this can also be concatenated into this<br>  file.</cert></p>\n<p>  if the openssl used supports diffie-hellman, parameters present in this file<br>  are loaded.</p>\n<p>  if a directory name is used instead of a pem file, then all files found in<br>  that directory will be loaded in alphabetic order unless their name ends with<br>  ‘.issuer’, ‘.ocsp’ or ‘.sctl’ (reserved extensions). this directive may be<br>  specified multiple times in order to load certificates from multiple files or<br>  directories. the certificates will be presented to clients who provide a<br>  valid tls server name indication field matching one of their cn or alt<br>  subjects.  wildcards are supported, where a wildcard character ‘<em>‘ is used<br>  instead of the first hostname component (eg: </em>.example.org matches<br>  www.example.org but not www.sub.example.org).</p>\n<p>  if no sni is provided by the client or if the ssl library does not support<br>  tls extensions, or if the client provides an sni hostname which does not<br>  match any certificate, then the first loaded certificate will be presented.<br>  this means that when loading certificates from a directory, it is highly<br>  recommended to load the default one first as a file or to ensure that it will<br>  always be the first one in the directory.</p>\n<p>  note that the same cert may be loaded multiple times without side effects.</p>\n<p>  some cas (such as godaddy) offer a drop down list of server types that do not<br>  include haproxy when obtaining a certificate. if this happens be sure to<br>  choose a webserver that the ca believes requires an intermediate ca (for<br>  godaddy, selection apache tomcat will get the correct bundle, but many<br>  others, e.g. nginx, result in a wrong bundle that will not work for some<br>  clients).</p>\n<p>  for each pem file, haproxy checks for the presence of file at the same path<br>  suffixed by “.ocsp”. if such file is found, support for the tls certificate<br>  status request extension (also known as “ocsp stapling”) is automatically<br>  enabled. the content of this file is optional. if not empty, it must contain<br>  a valid ocsp response in der format. in order to be valid an ocsp response<br>  must comply with the following rules: it has to indicate a good status,<br>  it has to be a single response for the certificate of the pem file, and it<br>  has to be valid at the moment of addition. if these rules are not respected<br>  the ocsp response is ignored and a warning is emitted. in order to  identify<br>  which certificate an ocsp response applies to, the issuer’s certificate is<br>  necessary. if the issuer’s certificate is not found in the pem file, it will<br>  be loaded from a file at the same path as the pem file suffixed by “.issuer”<br>  if it exists otherwise it will fail with an error.</p>\n<p>  for each pem file, haproxy also checks for the presence of file at the same<br>  path suffixed by “.sctl”. if such file is found, support for certificate<br>  transparency (rfc6962) tls extension is enabled. the file must contain a<br>  valid signed certificate timestamp list, as described in rfc. file is parsed<br>  to check basic syntax, but no signatures are verified.</p>\n<p>crt-ignore-err <errors><br>  this setting is only available when support for openssl was built in. sets a<br>  comma separated list of errorids to ignore during verify at depth == 0.  if<br>  set to ‘all’, all errors are ignored. ssl handshake is not aborted if an error<br>  is ignored.</errors></p>\n<p>crt-list <file><br>  this setting is only available when support for openssl was built in. it<br>  designates a list of pem file with an optional list of sni filter per<br>  certificate, with the following format for each line :</file></p>\n<pre><code>&lt;crtfile&gt; [[!]&lt;snifilter&gt; ...]\n</code></pre><p>  wildcards are supported in the sni filter. negative filter are also supported,<br>  only useful in combination with a wildcard filter to exclude a particular sni.<br>  the certificates will be presented to clients who provide a valid tls server<br>  name indication field matching one of the sni filters. if no sni filter is<br>  specified, the cn and alt subjects are used. this directive may be specified<br>  multiple times. see the “crt” option for more information. the default<br>  certificate is still needed to meet openssl expectations. if it is not used,<br>  the ‘strict-sni’ option may be used.</p>\n<p>defer-accept<br>  is an optional keyword which is supported only on certain linux kernels. it<br>  states that a connection will only be accepted once some data arrive on it,<br>  or at worst after the first retransmit. this should be used only on protocols<br>  for which the client talks first (eg: http). it can slightly improve<br>  performance by ensuring that most of the request is already available when<br>  the connection is accepted. on the other hand, it will not be able to detect<br>  connections which don’t talk. it is important to note that this option is<br>  broken in all kernels up to 2.6.31, as the connection is never accepted until<br>  the client talks. this can cause issues with front firewalls which would see<br>  an established connection while the proxy will only see it in syn_recv. this<br>  option is only supported on tcpv4/tcpv6 sockets and ignored by other ones.</p>\n<p>force-sslv3<br>  this option enforces use of sslv3 only on ssl connections instantiated from<br>  this listener. sslv3 is generally less expensive than the tls counterparts<br>  for high connection rates. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*” and “no-sslv3”.</p>\n<p>force-tlsv10<br>  this option enforces use of tlsv1.0 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*” and “no-sslv3”.</p>\n<p>force-tlsv11<br>  this option enforces use of tlsv1.1 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*”, and “no-sslv3”.</p>\n<p>force-tlsv12<br>  this option enforces use of tlsv1.2 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*”, and “no-sslv3”.</p>\n<p>generate-certificates<br>  this setting is only available when support for openssl was built in. it<br>  enables the dynamic ssl certificates generation. a ca certificate and its<br>  private key are necessary (see ‘ca-sign-file’). when haproxy is configured as<br>  a transparent forward proxy, ssl requests generate errors because of a common<br>  name mismatch on the certificate presented to the client. with this option<br>  enabled, haproxy will try to forge a certificate using the sni hostname<br>  indicated by the client. this is done only if no certificate matches the sni<br>  hostname (see ‘crt-list’). if an error occurs, the default certificate is<br>  used, else the ‘strict-sni’ option is set.<br>  it can also be used when haproxy is configured as a reverse proxy to ease the<br>  deployment of an architecture with many backends.</p>\n<p>  creating a ssl certificate is an expensive operation, so a lru cache is used<br>  to store forged certificates (see ‘tune.ssl.ssl-ctx-cache-size’). it<br>  increases the haproxy’s memroy footprint to reduce latency when the same<br>  certificate is used many times.</p>\n<p>gid <gid><br>  sets the group of the unix sockets to the designated system gid. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “group”<br>  setting except that the group id is used instead of its name. this setting is<br>  ignored by non unix sockets.</gid></p>\n<p>group <group><br>  sets the group of the unix sockets to the designated system group. it can<br>  also be set by default in the global section’s “unix-bind” statement. note<br>  that some platforms simply ignore this. this setting is equivalent to the<br>  “gid” setting except that the group name is used instead of its gid. this<br>  setting is ignored by non unix sockets.</group></p>\n<p>id <id><br>  fixes the socket id. by default, socket ids are automatically assigned, but<br>  sometimes it is more convenient to fix them to ease monitoring. this value<br>  must be strictly positive and unique within the listener/frontend. this<br>  option can only be used when defining only a single socket.</id></p>\n<p>interface <interface><br>  restricts the socket to a specific interface. when specified, only packets<br>  received from that particular interface are processed by the socket. this is<br>  currently only supported on linux. the interface must be a primary system<br>  interface, not an aliased interface. it is also possible to bind multiple<br>  frontends to the same address if they are bound to different interfaces. note<br>  that binding to a network interface requires root privileges. this parameter<br>  is only compatible with tcpv4/tcpv6 sockets.</interface></p>\n<p>level <level><br>  this setting is used with the stats sockets only to restrict the nature of<br>  the commands that can be issued on the socket. it is ignored by other<br>  sockets. <level> can be one of :</level></level></p>\n<ul>\n<li>“user” is the least privileged level ; only non-sensitive stats can be<br>read, and no change is allowed. it would make sense on systems where it<br>is not easy to restrict access to the socket.</li>\n<li>“operator” is the default level and fits most common uses. all data can<br>be read, and only non-sensitive changes are permitted (eg: clear max<br>counters).</li>\n<li>“admin” should be used with care, as everything is permitted (eg: clear<br>all counters).</li>\n</ul>\n<p>maxconn <maxconn><br>  limits the sockets to this number of concurrent connections. extraneous<br>  connections will remain in the system’s backlog until a connection is<br>  released. if unspecified, the limit will be the same as the frontend’s<br>  maxconn. note that in case of port ranges or multiple addresses, the same<br>  value will be applied to each socket. this setting enables different<br>  limitations on expensive sockets, for instance ssl entries which may easily<br>  eat all memory.</maxconn></p>\n<p>mode <mode><br>  sets the octal mode used to define access permissions on the unix socket. it<br>  can also be set by default in the global section’s “unix-bind” statement.<br>  note that some platforms simply ignore this. this setting is ignored by non<br>  unix sockets.</mode></p>\n<p>mss <maxseg><br>  sets the tcp maximum segment size (mss) value to be advertised on incoming<br>  connections. this can be used to force a lower mss for certain specific<br>  ports, for instance for connections passing through a vpn. note that this<br>  relies on a kernel feature which is theoretically supported under linux but<br>  was buggy in all versions prior to 2.6.28. it may or may not work on other<br>  operating systems. it may also not change the advertised value but change the<br>  effective size of outgoing segments. the commonly advertised value for tcpv4<br>  over ethernet networks is 1460 = 1500(mtu) - 40(ip+tcp). if this value is<br>  positive, it will be used as the advertised mss. if it is negative, it will<br>  indicate by how much to reduce the incoming connection’s advertised mss for<br>  outgoing segments. this parameter is only compatible with tcp v4/v6 sockets.</maxseg></p>\n<p>name <name><br>  sets an optional name for these sockets, which will be reported on the stats<br>  page.</name></p>\n<p>nice <nice><br>  sets the ‘niceness’ of connections initiated from the socket. value must be<br>  in the range -1024..1024 inclusive, and defaults to zero. positive values<br>  means that such connections are more friendly to others and easily offer<br>  their place in the scheduler. on the opposite, negative values mean that<br>  connections want to run with a higher priority than others. the difference<br>  only happens under high loads when the system is close to saturation.<br>  negative values are appropriate for low-latency or administration services,<br>  and high values are generally recommended for cpu intensive tasks such as ssl<br>  processing or bulk transfers which are less sensible to latency. for example,<br>  it may make sense to use a positive value for an smtp socket and a negative<br>  one for an rdp socket.</nice></p>\n<p>no-sslv3<br>  this setting is only available when support for openssl was built in. it<br>  disables support for sslv3 on any sockets instantiated from the listener when<br>  ssl is supported. note that sslv2 is forced disabled in the code and cannot<br>  be enabled using any configuration option. this option is also available on<br>  global statement “ssl-default-bind-options”. see also “force-tls*”,<br>  and “force-sslv3”.</p>\n<p>no-tls-tickets<br>  this setting is only available when support for openssl was built in. it<br>  disables the stateless session resumption (rfc 5077 tls ticket<br>  extension) and force to use stateful session resumption. stateless<br>  session resumption is more expensive in cpu usage. this option is also<br>  available on global statement “ssl-default-bind-options”.</p>\n<p>no-tlsv10<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.0 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>no-tlsv11<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.1 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>no-tlsv12<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.2 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>npn <protocols><br>  this enables the npn tls extension and advertises the specified protocol list<br>  as supported on top of npn. the protocol list consists in a comma-delimited<br>  list of protocol names, for instance: “http/1.1,http/1.0” (without quotes).<br>  this requires that the ssl library is build with support for tls extensions<br>  enabled (check with haproxy -vv). note that the npn extension has been<br>  replaced with the alpn extension (see the “alpn” keyword).</protocols></p>\n<p>process [ all | odd | even | <number 1-64=\"\">[-<number 1-64=\"\">] ]<br>  this restricts the list of processes on which this listener is allowed to<br>  run. it does not enforce any process but eliminates those which do not match.<br>  if the frontend uses a “bind-process” setting, the intersection between the<br>  two is applied. if in the end the listener is not allowed to run on any<br>  remaining process, a warning is emitted, and the listener will either run on<br>  the first process of the listener if a single process was specified, or on<br>  all of its processes if multiple processes were specified. for the unlikely<br>  case where several ranges are needed, this directive may be repeated. the<br>  main purpose of this directive is to be used with the stats sockets and have<br>  one different socket per process. the second purpose is to have multiple bind<br>  lines sharing the same ip:port but not the same process in a listener, so<br>  that the system can distribute the incoming connections into multiple queues<br>  and allow a smoother inter-process load balancing. currently linux 3.9 and<br>  above is known for supporting this. see also “bind-process” and “nbproc”.</number></number></p>\n<p>ssl<br>  this setting is only available when support for openssl was built in. it<br>  enables ssl deciphering on connections instantiated from this listener. a<br>  certificate is necessary (see “crt” above). all contents in the buffers will<br>  appear in clear text, so that acls and http processing will only have access<br>  to deciphered contents.</p>\n<p>strict-sni<br>  this setting is only available when support for openssl was built in. the<br>  ssl/tls negotiation is allow only if the client provided an sni which match<br>  a certificate. the default certificate is not used.<br>  see the “crt” option for more information.</p>\n<p>tcp-ut <delay><br>  sets the tcp user timeout for all incoming connections instanciated from this<br>  listening socket. this option is available on linux since version 2.6.37. it<br>  allows haproxy to configure a timeout for sockets which contain data not<br>  receiving an acknoledgement for the configured delay. this is especially<br>  useful on long-lived connections experiencing long idle periods such as<br>  remote terminals or database connection pools, where the client and server<br>  timeouts must remain high to allow a long period of idle, but where it is<br>  important to detect that the client has disappeared in order to release all<br>  resources associated with its connection (and the server’s session). the<br>  argument is a delay expressed in milliseconds by default. this only works<br>  for regular tcp connections, and is ignored for other protocols.</delay></p>\n<p>tfo<br>  is an optional keyword which is supported only on linux kernels &gt;= 3.7. it<br>  enables tcp fast open on the listening socket, which means that clients which<br>  support this feature will be able to send a request and receive a response<br>  during the 3-way handshake starting from second connection, thus saving one<br>  round-trip after the first connection. this only makes sense with protocols<br>  that use high connection rates and where each round trip matters. this can<br>  possibly cause issues with many firewalls which do not accept data on syn<br>  packets, so this option should only be enabled once well tested. this option<br>  is only supported on tcpv4/tcpv6 sockets and ignored by other ones. you may<br>  need to build haproxy with use_tfo=1 if your libc doesn’t define<br>  tcp_fastopen.</p>\n<p>tls-ticket-keys <keyfile><br>  sets the tls ticket keys file to load the keys from. the keys need to be 48<br>  bytes long, encoded with base64 (ex. openssl rand -base64 48). number of keys<br>  is specified by the tls_tickets_no build option (default 3) and at least as<br>  many keys need to be present in the file. last tls_tickets_no keys will be<br>  used for decryption and the penultimate one for encryption. this enables easy<br>  key rotation by just appending new key to the file and reloading the process.<br>  keys must be periodically rotated (ex. every 12h) or perfect forward secrecy<br>  is compromised. it is also a good idea to keep the keys off any permanent<br>  storage such as hard drives (hint: use tmpfs and don’t swap those files).<br>  lifetime hint can be changed using tune.ssl.timeout.</keyfile></p>\n<p>transparent<br>  is an optional keyword which is supported only on certain linux kernels. it<br>  indicates that the addresses will be bound even if they do not belong to the<br>  local machine, and that packets targeting any of these addresses will be<br>  intercepted just as if the addresses were locally configured. this normally<br>  requires that ip forwarding is enabled. caution! do not use this with the<br>  default address ‘*’, as it would redirect any traffic for the specified port.<br>  this keyword is available only when haproxy is built with use_linux_tproxy=1.<br>  this parameter is only compatible with tcpv4 and tcpv6 sockets, depending on<br>  kernel version. some distribution kernels include backports of the feature,<br>  so check for support with your vendor.</p>\n<p>v4v6<br>  is an optional keyword which is supported only on most recent systems<br>  including linux kernels &gt;= 2.4.21. it is used to bind a socket to both ipv4<br>  and ipv6 when it uses the default address. doing so is sometimes necessary<br>  on systems which bind to ipv6 only by default. it has no effect on non-ipv6<br>  sockets, and is overridden by the “v6only” option.</p>\n<p>v6only<br>  is an optional keyword which is supported only on most recent systems<br>  including linux kernels &gt;= 2.4.21. it is used to bind a socket to ipv6 only<br>  when it uses the default address. doing so is sometimes preferred to doing it<br>  system-wide as it is per-listener. it has no effect on non-ipv6 sockets and<br>  has precedence over the “v4v6” option.</p>\n<p>uid <uid><br>  sets the owner of the unix sockets to the designated system uid. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “user”<br>  setting except that the user numeric id is used instead of its name. this<br>  setting is ignored by non unix sockets.</uid></p>\n<p>user <user><br>  sets the owner of the unix sockets to the designated system user. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “uid”<br>  setting except that the user name is used instead of its uid. this setting is<br>  ignored by non unix sockets.</user></p>\n<p>verify [none|optional|required]<br>  this setting is only available when support for openssl was built in. if set<br>  to ‘none’, client certificate is not requested. this is the default. in other<br>  cases, a client certificate is requested. if the client does not provide a<br>  certificate after the request and if ‘verify’ is set to ‘required’, then the<br>  handshake is aborted, while it would have succeeded if set to ‘optional’. the<br>  certificate provided by the client is always verified using cas from<br>  ‘ca-file’ and optional crls from ‘crl-file’. on verify failure the handshake<br>  is aborted, regardless of the ‘verify’ option, unless the error code exactly<br>  matches one of those listed with ‘ca-ignore-err’ or ‘crt-ignore-err’.</p>\n<h2 id=\"5-2-server-and-default-server-options\"><a href=\"#5-2-server-and-default-server-options\" class=\"headerlink\" title=\"5.2. server and default-server options\"></a>5.2. server and default-server options</h2><p>the “server” and “default-server” keywords support a certain number of settings<br>which are all passed as arguments on the server line. the order in which those<br>arguments appear does not count, and they are all optional. some of those<br>settings are single words (booleans) while others expect one or several values<br>after them. in this case, the values must immediately follow the setting name.<br>except default-server, all those settings must be specified after the server’s<br>address if they are used:</p>\n<p>  server <name> <address>[:port] [settings …]<br>  default-server [settings …]</address></name></p>\n<p>the currently supported settings are the following ones.</p>\n<p>addr <ipv4|ipv6><br>  using the “addr” parameter, it becomes possible to use a different ip address<br>  to send health-checks. on some servers, it may be desirable to dedicate an ip<br>  address to specific component able to perform complex tests which are more<br>  suitable to health-checks than the application. this parameter is ignored if<br>  the “check” parameter is not set. see also the “port” parameter.</ipv4|ipv6></p>\n<p>  supported in default-server: no</p>\n<p>agent-check<br>  enable an auxiliary agent check which is run independently of a regular<br>  health check. an agent health check is performed by making a tcp connection<br>  to the port set by the “agent-port” parameter and reading an ascii string.<br>  the string is made of a series of words delimited by spaces, tabs or commas<br>  in any order, optionally terminated by ‘\\r’ and/or ‘\\n’, each consisting of :</p>\n<ul>\n<li><p>an ascii representation of a positive integer percentage, e.g. “75%”.<br>values in this format will set the weight proportional to the initial<br>weight of a server as configured when haproxy starts. note that a zero<br>weight is reported on the stats page as “drain” since it has the same<br>effect on the server (it’s removed from the lb farm).</p>\n</li>\n<li><p>the word “ready”. this will turn the server’s administrative state to the<br>ready mode, thus cancelling any drain or maint state</p>\n</li>\n<li><p>the word “drain”. this will turn the server’s administrative state to the<br>drain mode, thus it will not accept any new connections other than those<br>that are accepted via persistence.</p>\n</li>\n<li><p>the word “maint”. this will turn the server’s administrative state to the<br>maint mode, thus it will not accept any new connections at all, and health<br>checks will be stopped.</p>\n</li>\n<li><p>the words “down”, “failed”, or “stopped”, optionally followed by a<br>description string after a sharp (‘#’). all of these mark the server’s<br>operating state as down, but since the word itself is reported on the stats<br>page, the difference allows an administrator to know if the situation was<br>expected or not : the service may intentionally be stopped, may appear up<br>but fail some validity tests, or may be seen as down (eg: missing process,<br>or port not responding).</p>\n</li>\n<li><p>the word “up” sets back the server’s operating state as up if health checks<br>also report that the service is accessible.</p>\n<p>parameters which are not advertised by the agent are not changed. for<br>example, an agent might be designed to monitor cpu usage and only report a<br>relative weight and never interact with the operating status. similarly, an<br>agent could be designed as an end-user interface with 3 radio buttons<br>allowing an administrator to change only the administrative state. however,<br>it is important to consider that only the agent may revert its own actions,<br>so if a server is set to drain mode or to down state using the agent, the<br>agent must implement the other equivalent actions to bring the service into<br>operations again.</p>\n<p>failure to connect to the agent is not considered an error as connectivity<br>is tested by the regular health check which is enabled by the “check”<br>parameter. warning though, it is not a good idea to stop an agent after it<br>reports “down”, since only an agent reporting “up” will be able to turn the<br>server up again. note that the cli on the unix stats socket is also able to<br>force an agent’s result in order to workaround a bogus agent if needed.</p>\n<p>requires the “agent-port” parameter to be set. see also the “agent-inter”<br>parameter.</p>\n<p>supported in default-server: no</p>\n</li>\n</ul>\n<p>agent-inter <delay><br>  the “agent-inter” parameter sets the interval between two agent checks<br>  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.</delay></delay></p>\n<p>  just as with every other time-based parameter, it may be entered in any<br>  other explicit unit among { us, ms, s, m, h, d }. the “agent-inter”<br>  parameter also serves as a timeout for agent checks “timeout check” is<br>  not set. in order to reduce “resonance” effects when multiple servers are<br>  hosted on the same hardware, the agent and health checks of all servers<br>  are started with a small time offset between them. it is also possible to<br>  add some random noise in the agent and health checks interval using the<br>  global “spread-checks” keyword. this makes sense for instance when a lot<br>  of backends use the same servers.</p>\n<p>  see also the “agent-check” and “agent-port” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>agent-port <port><br>  the “agent-port” parameter sets the tcp port used for agent checks.</port></p>\n<p>  see also the “agent-check” and “agent-inter” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>backup<br>  when “backup” is present on a server line, the server is only used in load<br>  balancing when all other non-backup servers are unavailable. requests coming<br>  with a persistence cookie referencing the server will always be served<br>  though. by default, only the first operational backup server is used, unless<br>  the “allbackups” option is set in the backend. see also the “allbackups”<br>  option.</p>\n<p>  supported in default-server: no</p>\n<p>ca-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load ca certificates used to verify<br>  server’s certificate.</cafile></p>\n<p>  supported in default-server: no</p>\n<p>check<br>  this option enables health checks on the server. by default, a server is<br>  always considered available. if “check” is set, the server is available when<br>  accepting periodic tcp connections, to ensure that it is really able to serve<br>  requests. the default address and port to send the tests to are those of the<br>  server, and the default source is the same as the one defined in the<br>  backend. it is possible to change the address using the “addr” parameter, the<br>  port using the “port” parameter, the source address using the “source”<br>  address, and the interval and timers using the “inter”, “rise” and “fall”<br>  parameters. the request method is define in the backend using the “httpchk”,<br>  “smtpchk”, “mysql-check”, “pgsql-check” and “ssl-hello-chk” options. please<br>  refer to those options and parameters for more information.</p>\n<p>  supported in default-server: no</p>\n<p>check-send-proxy<br>  this option forces emission of a proxy protocol line with outgoing health<br>  checks, regardless of whether the server uses send-proxy or not for the<br>  normal traffic. by default, the proxy protocol is enabled for health checks<br>  if it is already enabled for normal traffic and if no “port” nor “addr”<br>  directive is present. however, if such a directive is present, the<br>  “check-send-proxy” option needs to be used to force the use of the<br>  protocol. see also the “send-proxy” option for more information.</p>\n<p>  supported in default-server: no</p>\n<p>check-ssl<br>  this option forces encryption of all health checks over ssl, regardless of<br>  whether the server uses ssl or not for the normal traffic. this is generally<br>  used when an explicit “port” or “addr” directive is specified and ssl health<br>  checks are not inherited. it is important to understand that this option<br>  inserts an ssl transport layer below the checks, so that a simple tcp connect<br>  check becomes an ssl connect, which replaces the old ssl-hello-chk. the most<br>  common use is to send https checks by combining “httpchk” with ssl checks.<br>  all ssl settings are common to health checks and traffic (eg: ciphers).<br>  see the “ssl” option for more information.</p>\n<p>  supported in default-server: no</p>\n<p>ciphers <ciphers><br>  this option sets the string describing the list of cipher algorithms that is<br>  is negotiated during the ssl/tls handshake with the server. the format of the<br>  string is defined in “man 1 ciphers”. when ssl is used to communicate with<br>  servers on the local network, it is common to see a weaker set of algorithms<br>  than what is used over the internet. doing so reduces cpu usage on both the<br>  server and haproxy while still keeping it compatible with deployed software.<br>  some algorithms such as rc4-sha1 are reasonably cheap. if no security at all<br>  is needed and just connectivity, using des can be appropriate.</ciphers></p>\n<p>  supported in default-server: no</p>\n<p>cookie <value><br>  the “cookie” parameter sets the cookie value assigned to the server to<br>  <value>. this value will be checked in incoming requests, and the first<br>  operational server possessing the same value will be selected. in return, in<br>  cookie insertion or rewrite modes, this value will be assigned to the cookie<br>  sent to the client. there is nothing wrong in having several servers sharing<br>  the same cookie value, and it is in fact somewhat common between normal and<br>  backup servers. see also the “cookie” keyword in backend section.</value></value></p>\n<p>  supported in default-server: no</p>\n<p>crl-file <crlfile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load certificate revocation list used<br>  to verify server’s certificate.</crlfile></p>\n<p>  supported in default-server: no</p>\n<p>crt <cert><br>  this setting is only available when support for openssl was built in.<br>  it designates a pem file from which to load both a certificate and the<br>  associated private key. this file can be built by concatenating both pem<br>  files into one. this certificate will be sent if the server send a client<br>  certificate request.</cert></p>\n<p>  supported in default-server: no</p>\n<p>disabled<br>  the “disabled” keyword starts the server in the “disabled” state. that means<br>  that it is marked down in maintenance mode, and no connection other than the<br>  ones allowed by persist mode will reach it. it is very well suited to setup<br>  new servers, because normal traffic will never reach them, while it is still<br>  possible to test the service by making use of the force-persist mechanism.</p>\n<p>  supported in default-server: no</p>\n<p>error-limit <count><br>  if health observing is enabled, the “error-limit” parameter specifies the<br>  number of consecutive errors that triggers event selected by the “on-error”<br>  option. by default it is set to 10 consecutive errors.</count></p>\n<p>  supported in default-server: yes</p>\n<p>  see also the “check”, “error-limit” and “on-error”.</p>\n<p>fall <count><br>  the “fall” parameter states that a server will be considered as dead after<br>  <count> consecutive unsuccessful health checks. this value defaults to 3 if<br>  unspecified. see also the “check”, “inter” and “rise” parameters.</count></count></p>\n<p>  supported in default-server: yes</p>\n<p>force-sslv3<br>  this option enforces use of sslv3 only when ssl is used to communicate with<br>  the server. sslv3 is generally less expensive than the tls counterparts for<br>  high connection rates. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv10<br>  this option enforces use of tlsv1.0 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv11<br>  this option enforces use of tlsv1.1 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv12<br>  this option enforces use of tlsv1.2 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>id <value><br>  set a persistent id for the server. this id must be positive and unique for<br>  the proxy. an unused id will automatically be assigned if unset. the first<br>  assigned value will be 1. this id is currently only returned in statistics.</value></p>\n<p>  supported in default-server: no</p>\n<p>inter <delay><br>fastinter <delay><br>downinter <delay><br>  the “inter” parameter sets the interval between two consecutive health checks<br>  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.<br>  it is also possible to use “fastinter” and “downinter” to optimize delays<br>  between checks depending on the server state :</delay></delay></delay></delay></p>\n<pre><code>         server state            |             interval used\n---------------------------------+-----------------------------------------\n up 100% (non-transitional)      | &quot;inter&quot;\n---------------------------------+-----------------------------------------\n transitionally up (going down), |\n transitionally down (going up), | &quot;fastinter&quot; if set, &quot;inter&quot; otherwise.\n or yet unchecked.               |\n---------------------------------+-----------------------------------------\n down 100% (non-transitional)    | &quot;downinter&quot; if set, &quot;inter&quot; otherwise.\n---------------------------------+-----------------------------------------\n</code></pre><p>  just as with every other time-based parameter, they can be entered in any<br>  other explicit unit among { us, ms, s, m, h, d }. the “inter” parameter also<br>  serves as a timeout for health checks sent to servers if “timeout check” is<br>  not set. in order to reduce “resonance” effects when multiple servers are<br>  hosted on the same hardware, the agent and health checks of all servers<br>  are started with a small time offset between them. it is also possible to<br>  add some random noise in the agent and health checks interval using the<br>  global “spread-checks” keyword. this makes sense for instance when a lot<br>  of backends use the same servers.</p>\n<p>  supported in default-server: yes</p>\n<p>maxconn <maxconn><br>  the “maxconn” parameter specifies the maximal number of concurrent<br>  connections that will be sent to this server. if the number of incoming<br>  concurrent requests goes higher than this value, they will be queued, waiting<br>  for a connection to be released. this parameter is very important as it can<br>  save fragile servers from going down under extreme loads. if a “minconn”<br>  parameter is specified, the limit becomes dynamic. the default value is “0”<br>  which means unlimited. see also the “minconn” and “maxqueue” parameters, and<br>  the backend’s “fullconn” keyword.</maxconn></p>\n<p>  supported in default-server: yes</p>\n<p>maxqueue <maxqueue><br>  the “maxqueue” parameter specifies the maximal number of connections which<br>  will wait in the queue for this server. if this limit is reached, next<br>  requests will be redispatched to other servers instead of indefinitely<br>  waiting to be served. this will break persistence but may allow people to<br>  quickly re-log in when the server they try to connect to is dying. the<br>  default value is “0” which means the queue is unlimited. see also the<br>  “maxconn” and “minconn” parameters.</maxqueue></p>\n<p>  supported in default-server: yes</p>\n<p>minconn <minconn><br>  when the “minconn” parameter is set, the maxconn limit becomes a dynamic<br>  limit following the backend’s load. the server will always accept at least<br>  <minconn> connections, never more than <maxconn>, and the limit will be on<br>  the ramp between both values when the backend has less than <fullconn><br>  concurrent connections. this makes it possible to limit the load on the<br>  server during normal loads, but push it further for important loads without<br>  overloading the server during exceptional loads. see also the “maxconn”<br>  and “maxqueue” parameters, as well as the “fullconn” backend keyword.</fullconn></maxconn></minconn></minconn></p>\n<p>  supported in default-server: yes</p>\n<p>no-ssl-reuse<br>  this option disables ssl session reuse when ssl is used to communicate with<br>  the server. it will force the server to perform a full handshake for every<br>  new connection. it’s probably only useful for benchmarking, troubleshooting,<br>  and for paranoid users.</p>\n<p>  supported in default-server: no</p>\n<p>no-sslv3<br>  this option disables support for sslv3 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tls-tickets<br>  this setting is only available when support for openssl was built in. it<br>  disables the stateless session resumption (rfc 5077 tls ticket<br>  extension) and force to use stateful session resumption. stateless<br>  session resumption is more expensive in cpu usage for servers. this option<br>  is also available on global statement “ssl-default-server-options”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv10<br>  this option disables support for tlsv1.0 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv11<br>  this option disables support for tlsv1.1 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv12<br>  this option disables support for tlsv1.2 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>non-stick<br>  never add connections allocated to this sever to a stick-table.<br>  this may be used in conjunction with backup to ensure that<br>  stick-table persistence is disabled for backup servers.</p>\n<p>  supported in default-server: no</p>\n<p>observe <mode><br>  this option enables health adjusting based on observing communication with<br>  the server. by default this functionality is disabled and enabling it also<br>  requires to enable health checks. there are two supported modes: “layer4” and<br>  “layer7”. in layer4 mode, only successful/unsuccessful tcp connections are<br>  significant. in layer7, which is only allowed for http proxies, responses<br>  received from server are verified, like valid/wrong http code, unparsable<br>  headers, a timeout, etc. valid status codes include 100 to 499, 501 and 505.</mode></p>\n<p>  supported in default-server: no</p>\n<p>  see also the “check”, “on-error” and “error-limit”.</p>\n<p>on-error <mode><br>  select what should happen when enough consecutive errors are detected.<br>  currently, four modes are available:</mode></p>\n<ul>\n<li>fastinter: force fastinter</li>\n<li>fail-check: simulate a failed check, also forces fastinter (default)</li>\n<li>sudden-death: simulate a pre-fatal failed health check, one more failed<br>check will mark a server down, forces fastinter</li>\n<li><p>mark-down: mark the server immediately down and force fastinter</p>\n<p>supported in default-server: yes</p>\n<p>see also the “check”, “observe” and “error-limit”.</p>\n</li>\n</ul>\n<p>on-marked-down <action><br>  modify what occurs when a server is marked down.<br>  currently one action is available:</action></p>\n<ul>\n<li><p>shutdown-sessions: shutdown peer sessions. when this setting is enabled,<br>all connections to the server are immediately terminated when the server<br>goes down. it might be used if the health check detects more complex cases<br>than a simple connection status, and long timeouts would cause the service<br>to remain unresponsive for too long a time. for instance, a health check<br>might detect that a database is stuck and that there’s no chance to reuse<br>existing connections anymore. connections killed this way are logged with<br>a ‘d’ termination code (for “down”).</p>\n<p>actions are disabled by default</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>on-marked-up <action><br>  modify what occurs when a server is marked up.<br>  currently one action is available:</action></p>\n<ul>\n<li><p>shutdown-backup-sessions: shutdown sessions on all backup servers. this is<br>done only if the server is not in backup state and if it is not disabled<br>(it must have an effective weight &gt; 0). this can be used sometimes to force<br>an active server to take all the traffic back after recovery when dealing<br>with long sessions (eg: ldap, sql, …). doing this can cause more trouble<br>than it tries to solve (eg: incomplete transactions), so use this feature<br>with extreme care. sessions killed because a server comes up are logged<br>with an ‘u’ termination code (for “up”).</p>\n<p>actions are disabled by default</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>port <port><br>  using the “port” parameter, it becomes possible to use a different port to<br>  send health-checks. on some servers, it may be desirable to dedicate a port<br>  to a specific component able to perform complex tests which are more suitable<br>  to health-checks than the application. it is common to run a simple script in<br>  inetd for instance. this parameter is ignored if the “check” parameter is not<br>  set. see also the “addr” parameter.</port></p>\n<p>  supported in default-server: yes</p>\n<p>redir <prefix><br>  the “redir” parameter enables the redirection mode for all get and head<br>  requests addressing this server. this means that instead of having haproxy<br>  forward the request to the server, it will send an “http 302” response with<br>  the “location” header composed of this prefix immediately followed by the<br>  requested uri beginning at the leading ‘/‘ of the path component. that means<br>  that no trailing slash should be used after <prefix>. all invalid requests<br>  will be rejected, and all non-get or head requests will be normally served by<br>  the server. note that since the response is completely forged, no header<br>  mangling nor cookie insertion is possible in the response. however, cookies in<br>  requests are still analysed, making this solution completely usable to direct<br>  users to a remote location in case of local disaster. main use consists in<br>  increasing bandwidth for static servers by having the clients directly<br>  connect to them. note: never use a relative location here, it would cause a<br>  loop between the client and haproxy!</prefix></prefix></p>\n<p>  example :  server srv1 192.168.1.1:80 redir <a href=\"http://image1.mydomain.com\" target=\"_blank\" rel=\"external\">http://image1.mydomain.com</a> check</p>\n<p>  supported in default-server: no</p>\n<p>rise <count><br>  the “rise” parameter states that a server will be considered as operational<br>  after <count> consecutive successful health checks. this value defaults to 2<br>  if unspecified. see also the “check”, “inter” and “fall” parameters.</count></count></p>\n<p>  supported in default-server: yes</p>\n<p>resolve-prefer <family><br>  when dns resolution is enabled for a server and multiple ip addresses from<br>  different families are returned, haproxy will prefer using an ip address<br>  from the family mentioned in the “resolve-prefer” parameter.<br>  available families: “ipv4” and “ipv6”</family></p>\n<p>  default value: ipv4</p>\n<p>  example: server s1 app1.domain.com:80 resolvers mydns resolve-prefer ipv6</p>\n<p>resolvers <id><br>  points to an existing “resolvers” section to resolve current server’s<br>  hostname.</id></p>\n<p>  example: server s1 app1.domain.com:80 resolvers mydns</p>\n<p>  see also chapter 5.3</p>\n<p>send-proxy<br>  the “send-proxy” parameter enforces use of the proxy protocol over any<br>  connection established to this server. the proxy protocol informs the other<br>  end about the layer 3/4 addresses of the incoming connection, so that it can<br>  know the client’s address or the public address it accessed to, whatever the<br>  upper layer protocol. for connections accepted by an “accept-proxy” listener,<br>  the advertised address will be used. only tcpv4 and tcpv6 address families<br>  are supported. other families such as unix sockets, will report an unknown<br>  family. servers using this option can fully be chained to another instance of<br>  haproxy listening with an “accept-proxy” setting. this setting must not be<br>  used if the server isn’t aware of the protocol. when health checks are sent<br>  to the server, the proxy protocol is automatically used when this option is<br>  set, unless there is an explicit “port” or “addr” directive, in which case an<br>  explicit “check-send-proxy” directive would also be needed to use the proxy<br>  protocol. see also the “accept-proxy” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2<br>  the “send-proxy-v2” parameter enforces use of the proxy protocol version 2<br>  over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. this setting must not be used if the<br>  server isn’t aware of this version of the protocol. see also the “send-proxy”<br>  option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2-ssl<br>  the “send-proxy-v2-ssl” parameter enforces use of the proxy protocol version<br>  2 over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. in addition, the ssl information extension<br>  of the proxy protocol is added to the proxy protocol header. this setting<br>  must not be used if the server isn’t aware of this version of the protocol.<br>  see also the “send-proxy-v2” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2-ssl-cn<br>  the “send-proxy-v2-ssl” parameter enforces use of the proxy protocol version<br>  2 over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. in addition, the ssl information extension<br>  of the proxy protocol, along along with the common name from the subject of<br>  the client certificate (if any), is added to the proxy protocol header. this<br>  setting must not be used if the server isn’t aware of this version of the<br>  protocol. see also the “send-proxy-v2” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>slowstart <start_time_in_ms><br>  the “slowstart” parameter for a server accepts a value in milliseconds which<br>  indicates after how long a server which has just come back up will run at<br>  full speed. just as with every other time-based parameter, it can be entered<br>  in any other explicit unit among { us, ms, s, m, h, d }. the speed grows<br>  linearly from 0 to 100% during this time. the limitation applies to two<br>  parameters :</start_time_in_ms></p>\n<ul>\n<li><p>maxconn: the number of connections accepted by the server will grow from 1<br>to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).</p>\n</li>\n<li><p>weight: when the backend uses a dynamic weighted algorithm, the weight<br>grows linearly from 1 to 100%. in this case, the weight is updated at every<br>health-check. for this reason, it is important that the “inter” parameter<br>is smaller than the “slowstart”, in order to maximize the number of steps.</p>\n<p>the slowstart never applies when haproxy starts, otherwise it would cause<br>trouble to running servers. it only applies when a server has been previously<br>seen as failed.</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>sni <expression><br>  the “sni” parameter evaluates the sample fetch expression, converts it to a<br>  string and uses the result as the host name sent in the sni tls extension to<br>  the server. a typical use case is to send the sni received from the client in<br>  a bridged https scenario, using the “ssl_fc_sni” sample fetch for the<br>  expression, though alternatives such as req.hdr(host) can also make sense.</expression></p>\n<p>  supported in default-server: no</p>\n<p>source <addr>[:<pl>[-<ph>]] [usesrc { <addr2>[:<port2>] | client | clientip } ]<br>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]<br>source <addr>[:<pl>[-<ph>]] [interface <name>] …<br>  the “source” parameter sets the source address which will be used when<br>  connecting to the server. it follows the exact same parameters and principle<br>  as the backend “source” keyword, except that it only applies to the server<br>  referencing it. please consult the “source” keyword for details.</name></ph></pl></addr></occ></hdr></port2></addr2></port></addr></port2></addr2></ph></pl></addr></p>\n<p>  additionally, the “source” statement on a server line allows one to specify a<br>  source port range by indicating the lower and higher bounds delimited by a<br>  dash (‘-‘). some operating systems might require a valid ip address when a<br>  source port range is specified. it is permitted to have the same ip/range for<br>  several servers. doing so makes it possible to bypass the maximum of 64k<br>  total concurrent connections. the limit will then reach 64k connections per<br>  server.</p>\n<p>  supported in default-server: no</p>\n<p>ssl<br>  this option enables ssl ciphering on outgoing connections to the server. it<br>  is critical to verify server certificates using “verify” when using ssl to<br>  connect to servers, otherwise the communication is prone to trivial man in<br>  the-middle attacks rendering ssl useless. when this option is used, health<br>  checks are automatically sent in ssl too unless there is a “port” or an<br>  “addr” directive indicating the check should be sent to a different location.<br>  see the “check-ssl” option to force ssl health checks.</p>\n<p>  supported in default-server: no</p>\n<p>track [<proxy>/]<server><br>  this option enables ability to set the current state of the server by tracking<br>  another one. it is possible to track a server which itself tracks another<br>  server, provided that at the end of the chain, a server has health checks<br>  enabled. if <proxy> is omitted the current one is used. if disable-on-404 is<br>  used, it has to be enabled on both proxies.</proxy></server></proxy></p>\n<p>  supported in default-server: no</p>\n<p>verify [none|required]<br>  this setting is only available when support for openssl was built in. if set<br>  to ‘none’, server certificate is not verified. in the other case, the<br>  certificate provided by the server is verified using cas from ‘ca-file’<br>  and optional crls from ‘crl-file’. if ‘ssl_server_verify’ is not specified<br>  in global  section, this is the default. on verify failure the handshake<br>  is aborted. it is critically important to verify server certificates when<br>  using ssl to connect to servers, otherwise the communication is prone to<br>  trivial man-in-the-middle attacks rendering ssl totally useless.</p>\n<p>  supported in default-server: no</p>\n<p>verifyhost <hostname><br>  this setting is only available when support for openssl was built in, and<br>  only takes effect if ‘verify required’ is also specified. when set, the<br>  hostnames in the subject and subjectalternatenames of the certificate<br>  provided by the server are checked. if none of the hostnames in the<br>  certificate match the specified hostname, the handshake is aborted. the<br>  hostnames in the server-provided certificate may include wildcards.</hostname></p>\n<p>  supported in default-server: no</p>\n<p>weight <weight><br>  the “weight” parameter is used to adjust the server’s weight relative to<br>  other servers. all servers will receive a load proportional to their weight<br>  relative to the sum of all weights, so the higher the weight, the higher the<br>  load. the default weight is 1, and the maximal value is 256. a value of 0<br>  means the server will not participate in load-balancing but will still accept<br>  persistent connections. if this parameter is used to distribute the load<br>  according to server’s capacity, it is recommended to start with values which<br>  can both grow and shrink, for instance between 10 and 100 to leave enough<br>  room above and below for later adjustments.</weight></p>\n<p>  supported in default-server: yes</p>\n<h2 id=\"5-3-server-ip-address-resolution-using-dns\"><a href=\"#5-3-server-ip-address-resolution-using-dns\" class=\"headerlink\" title=\"5.3. server ip address resolution using dns\"></a>5.3. server ip address resolution using dns</h2><p>haproxy allows using a host name to be resolved to find out what is the server<br>ip address. by default, haproxy resolves the name when parsing the<br>configuration, at startup.<br>this is not sufficient in some cases, such as in amazon where a server’s ip<br>can change after a reboot or an elb virtual ip can change based on current<br>workload.<br>this chapter describes how haproxy can be configured to process server’s name<br>resolution at run time.<br>whether run time server name resolution has been enable or not, haproxy will<br>carry on doing the first resolution when parsing the configuration.</p>\n<h2 id=\"5-3-1-global-overview\"><a href=\"#5-3-1-global-overview\" class=\"headerlink\" title=\"5.3.1. global overview\"></a>5.3.1. global overview</h2><p>as we’ve seen in introduction, name resolution in haproxy occurs at two<br>different steps of the process life:</p>\n<p>  1. when starting up, haproxy parses the server line definition and matches a<br>     host name. it uses libc functions to get the host name resolved. this<br>     resolution relies on /etc/resolv.conf file.</p>\n<p>  2. at run time, when haproxy gets prepared to run a health check on a server,<br>     it verifies if the current name resolution is still considered as valid.<br>     if not, it processes a new resolution, in parallel of the health check.</p>\n<p>a few other events can trigger a name resolution at run time:</p>\n<ul>\n<li>when a server’s health check ends up in a connection timeout: this may be<br>because the server has a new ip address. so we need to trigger a name<br>resolution to know this new ip.</li>\n</ul>\n<p>a few things important to notice:</p>\n<ul>\n<li><p>all the name servers are queried in the mean time. haproxy will process the<br>first valid response.</p>\n</li>\n<li><p>a resolution is considered as invalid (nx, timeout, refused), when all the<br>servers return an error.</p>\n</li>\n</ul>\n<h2 id=\"5-3-2-the-resolvers-section\"><a href=\"#5-3-2-the-resolvers-section\" class=\"headerlink\" title=\"5.3.2. the resolvers section\"></a>5.3.2. the resolvers section</h2><p>this section is dedicated to host information related to name resolution in<br>haproxy.<br>there can be as many as resolvers section as needed. each section can contain<br>many name servers.</p>\n<p>resolvers <resolvers id=\"\"><br>  creates a new name server list labelled <resolvers id=\"\"></resolvers></resolvers></p>\n<p>a resolvers section accept the following parameters:</p>\n<p>nameserver <id> <ip>:<port><br>  dns server description:<br>    <id>   : label of the server, should be unique<br>    <ip>   : ip address of the server<br>    <port> : port where the dns service actually runs</port></ip></id></port></ip></id></p>\n<p>hold <status> <period><br>  defines <period> during which the last name resolution should be kept based<br>  on last resolution <status><br>    <status> : last name resolution status. only “valid” is accepted for now.<br>    <period> : interval between two successive name resolution when the last<br>               answer was in <status>. it follows the haproxy time format.<br>               <period> is in milliseconds by default.</period></status></period></status></status></period></period></status></p>\n<p>  default value is 10s for “valid”.</p>\n<p>  note: since the name resolution is triggered by the health checks, a new<br>        resolution is triggered after <period> modulo the <inter> parameter of<br>        the healch check.</inter></period></p>\n<p>resolve_retries <nb><br>  defines the number <nb> of queries to send to resolve a server name before<br>  giving up.<br>  default value: 3</nb></nb></p>\n<p>timeout <event> <time><br>  defines timeouts related to name resolution<br>     <event> : the event on which the <time> timeout period applies to.<br>               events available are:</time></event></time></event></p>\n<pre><code>          - retry: time between two dns queries, when no response have\n                   been received.\n                   default value: 1s\n&lt;time&gt;  : time related to the event. it follows the haproxy time format.\n          &lt;time&gt; is expressed in milliseconds.\n</code></pre><p>example of a resolvers section (with default values):</p>\n<p>   resolvers mydns<br>     nameserver dns1 10.0.0.1:53<br>     nameserver dns2 10.0.0.2:53<br>     resolve_retries       3<br>     timeout retry         1s<br>     hold valid           10s</p>\n<h2 id=\"6-http-header-manipulation\"><a href=\"#6-http-header-manipulation\" class=\"headerlink\" title=\"6. http header manipulation\"></a>6. http header manipulation</h2><p>in http mode, it is possible to rewrite, add or delete some of the request and<br>response headers based on regular expressions. it is also possible to block a<br>request or a response if a particular header matches a regular expression,<br>which is enough to stop most elementary protocol attacks, and to protect<br>against information leak from the internal network.</p>\n<p>if haproxy encounters an “informational response” (status code 1xx), it is able<br>to process all rsp* rules which can allow, deny, rewrite or delete a header,<br>but it will refuse to add a header to any such messages as this is not<br>http-compliant. the reason for still processing headers in such responses is to<br>stop and/or fix any possible information leak which may happen, for instance<br>because another downstream equipment would unconditionally add a header, or if<br>a server name appears there. when such messages are seen, normal processing<br>still occurs on the next non-informational messages.</p>\n<p>this section covers common usage of the following keywords, described in detail<br>in section 4.2 :</p>\n<ul>\n<li>reqadd     <string></string></li>\n<li>reqallow   <search></search></li>\n<li>reqiallow  <search></search></li>\n<li>reqdel     <search></search></li>\n<li>reqidel    <search></search></li>\n<li>reqdeny    <search></search></li>\n<li>reqideny   <search></search></li>\n<li>reqpass    <search></search></li>\n<li>reqipass   <search></search></li>\n<li>reqrep     <search> <replace></replace></search></li>\n<li>reqirep    <search> <replace></replace></search></li>\n<li>reqtarpit  <search></search></li>\n<li>reqitarpit <search></search></li>\n<li>rspadd     <string></string></li>\n<li>rspdel     <search></search></li>\n<li>rspidel    <search></search></li>\n<li>rspdeny    <search></search></li>\n<li>rspideny   <search></search></li>\n<li>rsprep     <search> <replace></replace></search></li>\n<li>rspirep    <search> <replace></replace></search></li>\n</ul>\n<p>with all these keywords, the same conventions are used. the <search> parameter<br>is a posix extended regular expression (regex) which supports grouping through<br>parenthesis (without the backslash). spaces and other delimiters must be<br>prefixed with a backslash (‘\\’) to avoid confusion with a field delimiter.<br>other characters may be prefixed with a backslash to change their meaning :</search></p>\n<p>  \\t   for a tab<br>  \\r   for a carriage return (cr)<br>  \\n   for a new line (lf)<br>  \\    to mark a space and differentiate it from a delimiter<br>  #   to mark a sharp and differentiate it from a comment<br>  \\   to use a backslash in a regex<br>  \\\\ to use a backslash in the text (<em>2 for regex, </em>2 for haproxy)<br>  \\xxx to write the ascii hex code xx as in the c language</p>\n<p>the <replace> parameter contains the string to be used to replace the largest<br>portion of text matching the regex. it can make use of the special characters<br>above, and can reference a substring which is delimited by parenthesis in the<br>regex, by writing a backslash (‘\\’) immediately followed by one digit from 0 to<br>9 indicating the group position (0 designating the entire line). this practice<br>is very common to users of the “sed” program.</replace></p>\n<p>the <string> parameter represents the string which will systematically be added<br>after the last header line. it can also use special character sequences above.</string></p>\n<h2 id=\"notes-related-to-these-keywords\"><a href=\"#notes-related-to-these-keywords\" class=\"headerlink\" title=\"notes related to these keywords :\"></a>notes related to these keywords :</h2><ul>\n<li><p>these keywords are not always convenient to allow/deny based on header<br>contents. it is strongly recommended to use acls with the “block” keyword<br>instead, resulting in far more flexible and manageable rules.</p>\n</li>\n<li><p>lines are always considered as a whole. it is not possible to reference<br>a header name only or a value only. this is important because of the way<br>headers are written (notably the number of spaces after the colon).</p>\n</li>\n<li><p>the first line is always considered as a header, which makes it possible to<br>rewrite or filter http requests uris or response codes, but in turn makes<br>it harder to distinguish between headers and request line. the regex prefix<br>^[^\\ \\t]<em>[\\ \\t] matches any http method followed by a space, and the prefix<br>^[^ \\t:]</em>: matches any header name followed by a colon.</p>\n</li>\n<li><p>for performances reasons, the number of characters added to a request or to<br>a response is limited at build time to values between 1 and 4 kb. this<br>should normally be far more than enough for most usages. if it is too short<br>on occasional usages, it is possible to gain some space by removing some<br>useless headers before adding new ones.</p>\n</li>\n<li><p>keywords beginning with “reqi” and “rspi” are the same as their counterpart<br>without the ‘i’ letter except that they ignore case when matching patterns.</p>\n</li>\n<li><p>when a request passes through a frontend then a backend, all req<em> rules<br>from the frontend will be evaluated, then all req</em> rules from the backend<br>will be evaluated. the reverse path is applied to responses.</p>\n</li>\n<li><p>req* statements are applied after “block” statements, so that “block” is<br>always the first one, but before “use_backend” in order to permit rewriting<br>before switching.</p>\n</li>\n</ul>\n<h2 id=\"7-using-acls-and-fetching-samples\"><a href=\"#7-using-acls-and-fetching-samples\" class=\"headerlink\" title=\"7. using acls and fetching samples\"></a>7. using acls and fetching samples</h2><p>haproxy is capable of extracting data from request or response streams, from<br>client or server information, from tables, environmental information etc…<br>the action of extracting such data is called fetching a sample. once retrieved,<br>these samples may be used for various purposes such as a key to a stick-table,<br>but most common usages consist in matching them against predefined constant<br>data called patterns.</p>\n<h2 id=\"7-1-acl-basics\"><a href=\"#7-1-acl-basics\" class=\"headerlink\" title=\"7.1. acl basics\"></a>7.1. acl basics</h2><p>the use of access control lists (acl) provides a flexible solution to perform<br>content switching and generally to take decisions based on content extracted<br>from the request, the response or any environmental status. the principle is<br>simple :</p>\n<ul>\n<li>extract a data sample from a stream, table or the environment</li>\n<li>optionally apply some format conversion to the extracted sample</li>\n<li>apply one or multiple pattern matching methods on this sample</li>\n<li>perform actions only when a pattern matches the sample</li>\n</ul>\n<p>the actions generally consist in blocking a request, selecting a backend, or<br>adding a header.</p>\n<p>in order to define a test, the “acl” keyword is used. the syntax is :</p>\n<p>   acl <aclname> <criterion> [flags] [operator] [<value>] …</value></criterion></aclname></p>\n<p>this creates a new acl <aclname> or completes an existing one with new tests.<br>those tests apply to the portion of request/response specified in <criterion><br>and may be adjusted with optional flags [flags]. some criteria also support<br>an operator which may be specified before the set of values. optionally some<br>conversion operators may be applied to the sample, and they will be specified<br>as a comma-delimited list of keywords just after the first keyword. the values<br>are of the type supported by the criterion, and are separated by spaces.</criterion></aclname></p>\n<p>acl names must be formed from upper and lower case letters, digits, ‘-‘ (dash),<br>‘_’ (underscore) , ‘.’ (dot) and ‘:’ (colon). acl names are case-sensitive,<br>which means that “my_acl” and “my_acl” are two different acls.</p>\n<p>there is no enforced limit to the number of acls. the unused ones do not affect<br>performance, they just consume a small amount of memory.</p>\n<p>the criterion generally is the name of a sample fetch method, or one of its acl<br>specific declinations. the default test method is implied by the output type of<br>this sample fetch method. the acl declinations can describe alternate matching<br>methods of a same sample fetch method. the sample fetch methods are the only<br>ones supporting a conversion.</p>\n<p>sample fetch methods return data which can be of the following types :</p>\n<ul>\n<li>boolean</li>\n<li>integer (signed or unsigned)</li>\n<li>ipv4 or ipv6 address</li>\n<li>string</li>\n<li>data block</li>\n</ul>\n<p>converters transform any of these data into any of these. for example, some<br>converters might convert a string to a lower-case string while other ones<br>would turn a string to an ipv4 address, or apply a netmask to an ip address.<br>the resulting sample is of the type of the last converter applied to the list,<br>which defaults to the type of the sample fetch method.</p>\n<p>each sample or converter returns data of a specific type, specified with its<br>keyword in this documentation. when an acl is declared using a standard sample<br>fetch method, certain types automatically involved a default matching method<br>which are summarized in the table below :</p>\n<p>   +———————+—————–+<br>   | sample or converter | default         |<br>   |    output type      | matching method |<br>   +———————+—————–+<br>   | boolean             | bool            |<br>   +———————+—————–+<br>   | integer             | int             |<br>   +———————+—————–+<br>   | ip                  | ip              |<br>   +———————+—————–+<br>   | string              | str             |<br>   +———————+—————–+<br>   | binary              | none, use “-m”  |<br>   +———————+—————–+</p>\n<p>note that in order to match a binary samples, it is mandatory to specify a<br>matching method, see below.</p>\n<p>the acl engine can match these types against patterns of the following types :</p>\n<ul>\n<li>boolean</li>\n<li>integer or integer range</li>\n<li>ip address / network</li>\n<li>string (exact, substring, suffix, prefix, subdir, domain)</li>\n<li>regular expression</li>\n<li>hex block</li>\n</ul>\n<p>the following acl flags are currently supported :</p>\n<p>   -i : ignore case during matching of all subsequent patterns.<br>   -f : load patterns from a file.<br>   -m : use a specific pattern matching method<br>   -n : forbid the dns resolutions<br>   -m : load the file pointed by -f like a map file.<br>   -u : force the unique id of the acl<br>   – : force end of flags. useful when a string looks like one of the flags.</p>\n<p>the “-f” flag is followed by the name of a file from which all lines will be<br>read as individual values. it is even possible to pass multiple “-f” arguments<br>if the patterns are to be loaded from multiple files. empty lines as well as<br>lines beginning with a sharp (‘#’) will be ignored. all leading spaces and tabs<br>will be stripped. if it is absolutely necessary to insert a valid pattern<br>beginning with a sharp, just prefix it with a space so that it is not taken for<br>a comment. depending on the data type and match method, haproxy may load the<br>lines into a binary tree, allowing very fast lookups. this is true for ipv4 and<br>exact string matching. in this case, duplicates will automatically be removed.</p>\n<p>the “-m” flag allows an acl to use a map file. if this flag is set, the file is<br>parsed as two column file. the first column contains the patterns used by the<br>acl, and the second column contain the samples. the sample can be used later by<br>a map. this can be useful in some rare cases where an acl would just be used to<br>check for the existence of a pattern in a map before a mapping is applied.</p>\n<p>the “-u” flag forces the unique id of the acl. this unique id is used with the<br>socket interface to identify acl and dynamically change its values. note that a<br>file is always identified by its name even if an id is set.</p>\n<p>also, note that the “-i” flag applies to subsequent entries and not to entries<br>loaded from files preceding it. for instance :</p>\n<pre><code>acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test\n</code></pre><p>in this example, each line of “exact-ua.lst” will be exactly matched against<br>the “user-agent” header of the request. then each line of “generic-ua” will be<br>case-insensitively matched. then the word “test” will be insensitively matched<br>as well.</p>\n<p>the “-m” flag is used to select a specific pattern matching method on the input<br>sample. all acl-specific criteria imply a pattern matching method and generally<br>do not need this flag. however, this flag is useful with generic sample fetch<br>methods to describe how they’re going to be matched against the patterns. this<br>is required for sample fetches which return data type for which there is no<br>obvious matching method (eg: string or binary). when “-m” is specified and<br>followed by a pattern matching method name, this method is used instead of the<br>default one for the criterion. this makes it possible to match contents in ways<br>that were not initially planned, or with sample fetch methods which return a<br>string. the matching method also affects the way the patterns are parsed.</p>\n<p>the “-n” flag forbids the dns resolutions. it is used with the load of ip files.<br>by default, if the parser cannot parse ip address it considers that the parsed<br>string is maybe a domain name and try dns resolution. the flag “-n” disable this<br>resolution. it is useful for detecting malformed ip lists. note that if the dns<br>server is not reachable, the haproxy configuration parsing may last many minutes<br>waiting fir the timeout. during this time no error messages are displayed. the<br>flag “-n” disable this behavior. note also that during the runtime, this<br>function is disabled for the dynamic acl modifications.</p>\n<p>there are some restrictions however. not all methods can be used with all<br>sample fetch methods. also, if “-m” is used in conjunction with “-f”, it must<br>be placed first. the pattern matching method must be one of the following :</p>\n<ul>\n<li><p>“found” : only check if the requested sample could be found in the stream,</p>\n<pre><code>but do not compare it against any pattern. it is recommended not\nto pass any pattern to avoid confusion. this matching method is\nparticularly useful to detect presence of certain contents such\nas headers, cookies, etc... even if they are empty and without\ncomparing them to anything nor counting them.\n</code></pre></li>\n<li><p>“bool”  : check the value as a boolean. it can only be applied to fetches</p>\n<pre><code>which return a boolean or integer value, and takes no pattern.\nvalue zero or false does not match, all other values do match.\n</code></pre></li>\n<li><p>“int”   : match the value as an integer. it can be used with integer and</p>\n<pre><code>boolean samples. boolean false is integer 0, true is integer 1.\n</code></pre></li>\n<li><p>“ip”    : match the value as an ipv4 or ipv6 address. it is compatible</p>\n<pre><code>with ip address samples only, so it is implied and never needed.\n</code></pre></li>\n<li><p>“bin”   : match the contents against an hexadecimal string representing a</p>\n<pre><code>binary sequence. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“len”   : match the sample’s length as an integer. this may be used with</p>\n<pre><code>binary or string samples.\n</code></pre></li>\n<li><p>“str”   : exact match : match the contents against a string. this may be</p>\n<pre><code>used with binary or string samples.\n</code></pre></li>\n<li><p>“sub”   : substring match : check that the contents contain at least one of</p>\n<pre><code>the provided string patterns. this may be used with binary or\nstring samples.\n</code></pre></li>\n<li><p>“reg”   : regex match : match the contents against a list of regular</p>\n<pre><code>expressions. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“beg”   : prefix match : check that the contents begin like the provided</p>\n<pre><code>string patterns. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“end”   : suffix match : check that the contents end like the provided</p>\n<pre><code>string patterns. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“dir”   : subdir match : check that a slash-delimited portion of the</p>\n<pre><code>contents exactly matches one of the provided string patterns.\nthis may be used with binary or string samples.\n</code></pre></li>\n<li><p>“dom”   : domain match : check that a dot-delimited portion of the contents</p>\n<pre><code>exactly match one of the provided string patterns. this may be\nused with binary or string samples.\n</code></pre></li>\n</ul>\n<p>for example, to quickly detect the presence of cookie “jsessionid” in an http<br>request, it is possible to do :</p>\n<pre><code>acl jsess_present cook(jsessionid) -m found\n</code></pre><p>in order to apply a regular expression on the 500 first bytes of data in the<br>buffer, one would use the following acl :</p>\n<pre><code>acl script_tag payload(0,500) -m reg -i &lt;script&gt;\n</code></pre><p>on systems where the regex library is much slower when using “-i”, it is<br>possible to convert the sample to lowercase before matching, like this :</p>\n<pre><code>acl script_tag payload(0,500),lower -m reg &lt;script&gt;\n</code></pre><p>all acl-specific criteria imply a default matching method. most often, these<br>criteria are composed by concatenating the name of the original sample fetch<br>method and the matching method. for example, “hdr_beg” applies the “beg” match<br>to samples retrieved using the “hdr” fetch method. since all acl-specific<br>criteria rely on a sample fetch method, it is always possible instead to use<br>the original sample fetch method and the explicit matching method using “-m”.</p>\n<p>if an alternate match is specified using “-m” on an acl-specific criterion,<br>the matching method is simply applied to the underlying sample fetch method.<br>for example, all acls below are exact equivalent :</p>\n<pre><code>acl short_form  hdr_beg(host)        www.\nacl alternate1  hdr_beg(host) -m beg www.\nacl alternate2  hdr_dom(host) -m beg www.\nacl alternate3  hdr(host)     -m beg www.\n</code></pre><p>the table below summarizes the compatibility matrix between sample or converter<br>types and the pattern types to fetch against. it indicates for each compatible<br>combination the name of the matching method to be used, surrounded with angle<br>brackets “&gt;” and “&lt;” when the method is the default one and will work by<br>default without “-m”.</p>\n<pre><code>                       +-------------------------------------------------+\n                       |                input sample type                |\n+----------------------+---------+---------+---------+---------+---------+\n|     pattern type     | boolean | integer |   ip    | string  | binary  |\n+----------------------+---------+---------+---------+---------+---------+\n| none (presence only) |  found  |  found  |  found  |  found  |  found  |\n+----------------------+---------+---------+---------+---------+---------+\n| none (boolean value) |&gt;  bool &lt;|   bool  |         |   bool  |         |\n+----------------------+---------+---------+---------+---------+---------+\n| integer (value)      |   int   |&gt;  int  &lt;|   int   |   int   |         |\n+----------------------+---------+---------+---------+---------+---------+\n| integer (length)     |   len   |   len   |   len   |   len   |   len   |\n+----------------------+---------+---------+---------+---------+---------+\n| ip address           |         |         |&gt;   ip  &lt;|    ip   |    ip   |\n+----------------------+---------+---------+---------+---------+---------+\n| exact string         |   str   |   str   |   str   |&gt;  str  &lt;|   str   |\n+----------------------+---------+---------+---------+---------+---------+\n| prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |\n+----------------------+---------+---------+---------+---------+---------+\n| suffix               |   end   |   end   |   end   |   end   |   end   |\n+----------------------+---------+---------+---------+---------+---------+\n| substring            |   sub   |   sub   |   sub   |   sub   |   sub   |\n+----------------------+---------+---------+---------+---------+---------+\n| subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |\n+----------------------+---------+---------+---------+---------+---------+\n| domain               |   dom   |   dom   |   dom   |   dom   |   dom   |\n+----------------------+---------+---------+---------+---------+---------+\n| regex                |   reg   |   reg   |   reg   |   reg   |   reg   |\n+----------------------+---------+---------+---------+---------+---------+\n| hex block            |         |         |         |   bin   |   bin   |\n+----------------------+---------+---------+---------+---------+---------+\n</code></pre><h2 id=\"7-1-1-matching-booleans\"><a href=\"#7-1-1-matching-booleans\" class=\"headerlink\" title=\"7.1.1. matching booleans\"></a>7.1.1. matching booleans</h2><p>in order to match a boolean, no value is needed and all values are ignored.<br>boolean matching is used by default for all fetch methods of type “boolean”.<br>when boolean matching is used, the fetched value is returned as-is, which means<br>that a boolean “true” will always match and a boolean “false” will never match.</p>\n<p>boolean matching may also be enforced using “-m bool” on fetch methods which<br>return an integer value. then, integer value 0 is converted to the boolean<br>“false” and all other values are converted to “true”.</p>\n<h2 id=\"7-1-2-matching-integers\"><a href=\"#7-1-2-matching-integers\" class=\"headerlink\" title=\"7.1.2. matching integers\"></a>7.1.2. matching integers</h2><p>integer matching applies by default to integer fetch methods. it can also be<br>enforced on boolean fetches using “-m int”. in this case, “false” is converted<br>to the integer 0, and “true” is converted to the integer 1.</p>\n<p>integer matching also supports integer ranges and operators. note that integer<br>matching only applies to positive values. a range is a value expressed with a<br>lower and an upper bound separated with a colon, both of which may be omitted.</p>\n<p>for instance, “1024:65535” is a valid range to represent a range of<br>unprivileged ports, and “1024:” would also work. “0:1023” is a valid<br>representation of privileged ports, and “:1023” would also work.</p>\n<p>as a special case, some acl functions support decimal numbers which are in fact<br>two integers separated by a dot. this is used with some version checks for<br>instance. all integer properties apply to those decimal numbers, including<br>ranges and operators.</p>\n<p>for an easier usage, comparison operators are also supported. note that using<br>operators with ranges does not make much sense and is strongly discouraged.<br>similarly, it does not make much sense to perform order comparisons with a set<br>of values.</p>\n<p>available operators for integer matching are :</p>\n<p>  eq : true if the tested value equals at least one value<br>  ge : true if the tested value is greater than or equal to at least one value<br>  gt : true if the tested value is greater than at least one value<br>  le : true if the tested value is less than or equal to at least one value<br>  lt : true if the tested value is less than at least one value</p>\n<p>for instance, the following acl matches any negative content-length header :</p>\n<p>  acl negative-length hdr_val(content-length) lt 0</p>\n<p>this one matches ssl versions between 3.0 and 3.1 (inclusive) :</p>\n<p>  acl sslv3 req_ssl_ver 3:3.1</p>\n<h2 id=\"7-1-3-matching-strings\"><a href=\"#7-1-3-matching-strings\" class=\"headerlink\" title=\"7.1.3. matching strings\"></a>7.1.3. matching strings</h2><p>string matching applies to string or binary fetch methods, and exists in 6<br>different forms :</p>\n<ul>\n<li><p>exact match     (-m str) : the extracted string must exactly match the<br>patterns ;</p>\n</li>\n<li><p>substring match (-m sub) : the patterns are looked up inside the<br>extracted string, and the acl matches if any of them is found inside ;</p>\n</li>\n<li><p>prefix match    (-m beg) : the patterns are compared with the beginning of<br>the extracted string, and the acl matches if any of them matches.</p>\n</li>\n<li><p>suffix match    (-m end) : the patterns are compared with the end of the<br>extracted string, and the acl matches if any of them matches.</p>\n</li>\n<li><p>subdir match    (-m sub) : the patterns are looked up inside the extracted<br>string, delimited with slashes (“/“), and the acl matches if any of them<br>matches.</p>\n</li>\n<li><p>domain match    (-m dom) : the patterns are looked up inside the extracted<br>string, delimited with dots (“.”), and the acl matches if any of them<br>matches.</p>\n</li>\n</ul>\n<p>string matching applies to verbatim strings as they are passed, with the<br>exception of the backslash (“\\”) which makes it possible to escape some<br>characters such as the space. if the “-i” flag is passed before the first<br>string, then the matching will be performed ignoring the case. in order<br>to match the string “-i”, either set it second, or pass the “–” flag<br>before the first string. same applies of course to match the string “–”.</p>\n<h2 id=\"7-1-4-matching-regular-expressions-regexes\"><a href=\"#7-1-4-matching-regular-expressions-regexes\" class=\"headerlink\" title=\"7.1.4. matching regular expressions (regexes)\"></a>7.1.4. matching regular expressions (regexes)</h2><p>just like with string matching, regex matching applies to verbatim strings as<br>they are passed, with the exception of the backslash (“\\”) which makes it<br>possible to escape some characters such as the space. if the “-i” flag is<br>passed before the first regex, then the matching will be performed ignoring<br>the case. in order to match the string “-i”, either set it second, or pass<br>the “–” flag before the first string. same principle applies of course to<br>match the string “–”.</p>\n<h2 id=\"7-1-5-matching-arbitrary-data-blocks\"><a href=\"#7-1-5-matching-arbitrary-data-blocks\" class=\"headerlink\" title=\"7.1.5. matching arbitrary data blocks\"></a>7.1.5. matching arbitrary data blocks</h2><p>it is possible to match some extracted samples against a binary block which may<br>not safely be represented as a string. for this, the patterns must be passed as<br>a series of hexadecimal digits in an even number, when the match method is set<br>to binary. each sequence of two digits will represent a byte. the hexadecimal<br>digits may be used upper or lower case.</p>\n<p>example :</p>\n<pre><code># match &quot;hello\\n&quot; in the input stream (\\x48 \\x65 \\x6c \\x6c \\x6f \\x0a)\nacl hello payload(0,6) -m bin 48656c6c6f0a\n</code></pre><h2 id=\"7-1-6-matching-ipv4-and-ipv6-addresses\"><a href=\"#7-1-6-matching-ipv4-and-ipv6-addresses\" class=\"headerlink\" title=\"7.1.6. matching ipv4 and ipv6 addresses\"></a>7.1.6. matching ipv4 and ipv6 addresses</h2><p>ipv4 addresses values can be specified either as plain addresses or with a<br>netmask appended, in which case the ipv4 address matches whenever it is<br>within the network. plain addresses may also be replaced with a resolvable<br>host name, but this practice is generally discouraged as it makes it more<br>difficult to read and debug configurations. if hostnames are used, you should<br>at least ensure that they are present in /etc/hosts so that the configuration<br>does not depend on any random dns match at the moment the configuration is<br>parsed.</p>\n<p>ipv6 may be entered in their usual form, with or without a netmask appended.<br>only bit counts are accepted for ipv6 netmasks. in order to avoid any risk of<br>trouble with randomly resolved ip addresses, host names are never allowed in<br>ipv6 patterns.</p>\n<p>haproxy is also able to match ipv4 addresses with ipv6 addresses in the<br>following situations :</p>\n<ul>\n<li>tested address is ipv4, pattern address is ipv4, the match applies<br>in ipv4 using the supplied mask if any.</li>\n<li>tested address is ipv6, pattern address is ipv6, the match applies<br>in ipv6 using the supplied mask if any.</li>\n<li>tested address is ipv6, pattern address is ipv4, the match applies in ipv4<br>using the pattern’s mask if the ipv6 address matches with 2002:ipv4::,<br>::ipv4 or ::ffff:ipv4, otherwise it fails.</li>\n<li>tested address is ipv4, pattern address is ipv6, the ipv4 address is first<br>converted to ipv6 by prefixing ::ffff: in front of it, then the match is<br>applied in ipv6 using the supplied ipv6 mask.</li>\n</ul>\n<h2 id=\"7-2-using-acls-to-form-conditions\"><a href=\"#7-2-using-acls-to-form-conditions\" class=\"headerlink\" title=\"7.2. using acls to form conditions\"></a>7.2. using acls to form conditions</h2><p>some actions are only performed upon a valid condition. a condition is a<br>combination of acls with operators. 3 operators are supported :</p>\n<ul>\n<li>and (implicit)</li>\n<li>or  (explicit with the “or” keyword or the “||” operator)</li>\n<li>negation with the exclamation mark (“!”)</li>\n</ul>\n<p>a condition is formed as a disjunctive form:</p>\n<p>   [!]acl1 [!]acl2 … [!]acln  { or [!]acl1 [!]acl2 … [!]acln } …</p>\n<p>such conditions are generally used after an “if” or “unless” statement,<br>indicating when the condition will trigger the action.</p>\n<p>for instance, to block http requests to the “*” url with methods other than<br>“options”, as well as post requests without content-length, and get or head<br>requests with a content-length greater than 0, and finally every request which<br>is not either get/head/post/options !</p>\n<p>   acl missing_cl hdr_cnt(content-length) eq 0<br>   block if http_url_star !meth_options || meth_post missing_cl<br>   block if meth_get http_content<br>   block unless meth_get or meth_post or meth_options</p>\n<p>to select a different backend for requests to static contents on the “www” site<br>and to every request on the “img”, “video”, “download” and “ftp” hosts :</p>\n<p>   acl url_static  path_beg         /static /images /img /css<br>   acl url_static  path_end         .gif .png .jpg .css .js<br>   acl host_www    hdr_beg(host) -i www<br>   acl host_static hdr_beg(host) -i img. video. download. ftp.</p>\n<h1 id=\"now-use-backend-“static”-for-all-static-only-hosts-and-for-static-urls\"><a href=\"#now-use-backend-“static”-for-all-static-only-hosts-and-for-static-urls\" class=\"headerlink\" title=\"now use backend “static” for all static-only hosts, and for static urls\"></a>now use backend “static” for all static-only hosts, and for static urls</h1><h1 id=\"of-host-“www”-use-backend-“www”-for-the-rest\"><a href=\"#of-host-“www”-use-backend-“www”-for-the-rest\" class=\"headerlink\" title=\"of host “www”. use backend “www” for the rest.\"></a>of host “www”. use backend “www” for the rest.</h1><p>   use_backend static if host_static or host_www url_static<br>   use_backend www    if host_www</p>\n<p>it is also possible to form rules using “anonymous acls”. those are unnamed acl<br>expressions that are built on the fly without needing to be declared. they must<br>be enclosed between braces, with a space before and after each brace (because<br>the braces must be seen as independent words). example :</p>\n<p>   the following rule :</p>\n<pre><code>acl missing_cl hdr_cnt(content-length) eq 0\nblock if meth_post missing_cl\n</code></pre><p>   can also be written that way :</p>\n<pre><code>block if meth_post { hdr_cnt(content-length) eq 0 }\n</code></pre><p>it is generally not recommended to use this construct because it’s a lot easier<br>to leave errors in the configuration when written that way. however, for very<br>simple rules matching only one source ip address for instance, it can make more<br>sense to use them than to declare acls with random names. another example of<br>good use is the following :</p>\n<p>   with named acls :</p>\n<pre><code>acl site_dead nbsrv(dynamic) lt 2\nacl site_dead nbsrv(static)  lt 2\nmonitor fail  if site_dead\n</code></pre><p>   with anonymous acls :</p>\n<pre><code>monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }\n</code></pre><p>see section 4.2 for detailed help on the “block” and “use_backend” keywords.</p>\n<h2 id=\"7-3-fetching-samples\"><a href=\"#7-3-fetching-samples\" class=\"headerlink\" title=\"7.3. fetching samples\"></a>7.3. fetching samples</h2><p>historically, sample fetch methods were only used to retrieve data to match<br>against patterns using acls. with the arrival of stick-tables, a new class of<br>sample fetch methods was created, most often sharing the same syntax as their<br>acl counterpart. these sample fetch methods are also known as “fetches”. as<br>of now, acls and fetches have converged. all acl fetch methods have been made<br>available as fetch methods, and acls may use any sample fetch method as well.</p>\n<p>this section details all available sample fetch methods and their output type.<br>some sample fetch methods have deprecated aliases that are used to maintain<br>compatibility with existing configurations. they are then explicitly marked as<br>deprecated and should not be used in new setups.</p>\n<p>the acl derivatives are also indicated when available, with their respective<br>matching methods. these ones all have a well defined default pattern matching<br>method, so it is never necessary (though allowed) to pass the “-m” option to<br>indicate how the sample will be matched using acls.</p>\n<p>as indicated in the sample type versus matching compatibility matrix above,<br>when using a generic sample fetch method in an acl, the “-m” option is<br>mandatory unless the sample type is one of boolean, integer, ipv4 or ipv6. when<br>the same keyword exists as an acl keyword and as a standard fetch method, the<br>acl engine will automatically pick the acl-only one by default.</p>\n<p>some of these keywords support one or multiple mandatory arguments, and one or<br>multiple optional arguments. these arguments are strongly typed and are checked<br>when the configuration is parsed so that there is no risk of running with an<br>incorrect argument (eg: an unresolved backend name). fetch function arguments<br>are passed between parenthesis and are delimited by commas.  when an argument<br>is optional, it will be indicated below between square brackets (‘[ ]’). when<br>all arguments are optional, the parenthesis may be omitted.</p>\n<p>thus, the syntax of a standard sample fetch method is one of the following :</p>\n<ul>\n<li>name</li>\n<li>name(arg1)</li>\n<li>name(arg1,arg2)</li>\n</ul>\n<h2 id=\"7-3-1-converters\"><a href=\"#7-3-1-converters\" class=\"headerlink\" title=\"7.3.1. converters\"></a>7.3.1. converters</h2><p>sample fetch methods may be combined with transformations to be applied on top<br>of the fetched sample (also called “converters”). these combinations form what<br>is called “sample expressions” and the result is a “sample”. initially this<br>was only supported by “stick on” and “stick store-request” directives but this<br>has now be extended to all places where samples may be used (acls, log-format,<br>unique-id-format, add-header, …).</p>\n<p>these transformations are enumerated as a series of specific keywords after the<br>sample fetch method. these keywords may equally be appended immediately after<br>the fetch keyword’s argument, delimited by a comma. these keywords can also<br>support some arguments (eg: a netmask) which must be passed in parenthesis.</p>\n<p>a certain category of converters are bitwise and arithmetic operators which<br>support performing basic operations on integers. some bitwise operations are<br>supported (and, or, xor, cpl) and some arithmetic operations are supported<br>(add, sub, mul, div, mod, neg). some comparators are provided (odd, even, not,<br>bool) which make it possible to report a match without having to write an acl.</p>\n<p>the currently available list of transformation keywords include :</p>\n<p>add(<value>)<br>  adds <value> to the input value of type signed integer, and returns the<br>  result as a signed integer. <value> can be a numeric value or a variable<br>  name. the name of the variable starts by an indication about its scope. the<br>  allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<p>and(<value>)<br>  performs a bitwise “and” between <value> and the input value of type signed<br>  integer, and returns the result as an signed integer. <value> can be a<br>  numeric value or a variable name. the name of the variable starts by an<br>  indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<p>base64<br>  converts a binary input sample to a base64 string. it is used to log or<br>  transfer binary content in a way that can be reliably transferred (eg:<br>  an ssl id can be copied in a header).</p>\n<p>bool<br>  returns a boolean true if the input value of type signed integer is<br>  non-null, otherwise returns false. used in conjunction with and(), it can be<br>  used to report true/false for bit testing on input values (eg: verify the<br>  presence of a flag).</p>\n<p>bytes(<offset>[,<length>])<br>  extracts some bytes from an input binary sample. the result is a binary<br>  sample starting at an offset (in bytes) of the original sample and<br>  optionnaly truncated at the given length.</length></offset></p>\n<p>cpl<br>  takes the input value of type signed integer, applies a ones-complement<br>  (flips all bits) and returns the result as an signed integer.</p>\n<p>crc32([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the crc32<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  provided for compatibility with other software which want a crc32 to be<br>  computed on some input keys, so it follows the most common implementation as<br>  found in ethernet, gzip, png, etc… it is slower than the other algorithms<br>  but may provide a better or at least less predictable distribution. it must<br>  not be used for security purposes as a 32-bit hash is trivial to break. see<br>  also “djb2”, “sdbm”, “wt6” and the “hash-type” directive.</avalanche></avalanche></p>\n<p>da-csv(<prop>[,<prop>*])<br>  asks the deviceatlas converter to identify the user agent string passed on<br>  input, and to emit a string made of the concatenation of the properties<br>  enumerated in argument, delimited by the separator defined by the global<br>  keyword “deviceatlas-property-separator”, or by default the pipe character<br>  (‘|’). there’s a limit of 5 different properties imposed by the haproxy<br>  configuration language.</prop></prop></p>\n<p>  example:<br>    frontend www<br>    bind *:8881<br>    default_backend servers<br>    http-request set-header x-deviceatlas-data %[req.fhdr(user-agent),da-csv(primaryhardwaretype,osname,osversion,browsername,browserversion)]</p>\n<p>debug<br>  this converter is used as debug tool. it dumps on screen the content and the<br>  type of the input sample. the sample is returned as is on its output. this<br>  converter only exists when haproxy was built with debugging enabled.</p>\n<p>div(<value>)<br>  divides the input value of type signed integer by <value>, and returns the<br>  result as an signed integer. if <value> is null, the largest unsigned<br>  integer is returned (typically 2^63-1). <value> can be a numeric value or a<br>  variable name. the name of the variable starts by an indication about it<br>  scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></value></p>\n<p>djb2([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the djb2<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “sdbm”, “wt6” and the<br>  “hash-type” directive.</avalanche></avalanche></p>\n<p>even<br>  returns a boolean true if the input value of type signed integer is even<br>  otherwise returns false. it is functionally equivalent to “not,and(1),bool”.</p>\n<p>field(<index>,<delimiters>)<br>  extracts the substring at the given index considering given delimiters from<br>  an input string. indexes start at 1 and delimiters are a string formatted<br>  list of chars.</delimiters></index></p>\n<p>hex<br>  converts a binary input sample to an hex string containing two hex digits per<br>  input byte. it is used to log or transfer hex dumps of some binary input data<br>  in a way that can be reliably transferred (eg: an ssl id can be copied in a<br>  header).</p>\n<p>http_date([<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in a format suitable for use in http header fields. if<br>  an offset value is specified, then it is a number of seconds that is added to<br>  the date before the conversion is operated. this is particularly useful to<br>  emit date header fields, expires values in responses when combined with a<br>  positive offset, or last-modified values when the offset is negative.</offset></p>\n<p>in_table(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, a boolean false<br>  is returned. otherwise a boolean true is returned. this can be used to verify<br>  the presence of a certain key in a table tracking some elements (eg: whether<br>  or not a source ip address or an authorization header was already seen).</table></p>\n<p>ipmask(<mask>)<br>  apply a mask to an ipv4 address, and use the result for lookups and storage.<br>  this can be used to make all hosts within a certain mask to share the same<br>  table entries and as such use the same server. the mask can be passed in<br>  dotted form (eg: 255.255.255.0) or in cidr form (eg: 24).</mask></p>\n<p>json([<input-code>])<br>  escapes the input string and produces an ascii ouput string ready to use as a<br>  json string. the converter tries to decode the input string according to the<br>  <input-code> parameter. it can be “ascii”, “utf8”, “utf8s”, “utf8”” or<br>  “utf8ps”. the “ascii” decoder never fails. the “utf8” decoder detects 3 types<br>  of errors:</input-code></input-code></p>\n<ul>\n<li>bad utf-8 sequence (lone continuation byte, bad number of continuation<br>bytes, …)</li>\n<li>invalid range (the decoded value is within a utf-8 prohibited range),</li>\n<li><p>code overlong (the value is encoded with more bytes than necessary).</p>\n<p>the utf-8 json encoding can produce a “too long value” error when the utf-8<br>character is greater than 0xffff because the json string escape specification<br>only authorizes 4 hex digits for the value encoding. the utf-8 decoder exists<br>in 4 variants designated by a combination of two suffix letters : “p” for<br>“permissive” and “s” for “silently ignore”. the behaviors of the decoders<br>are :</p>\n</li>\n<li>“ascii”  : never fails ;</li>\n<li>“utf8”   : fails on any detected errors ;</li>\n<li>“utf8s”  : never fails, but removes characters corresponding to errors ;</li>\n<li>“utf8p”  : accepts and fixes the overlong errors, but fails on any other<pre><code>error ;\n</code></pre></li>\n<li><p>“utf8ps” : never fails, accepts and fixes the overlong errors, but removes</p>\n<pre><code>characters corresponding to the other errors.\n</code></pre><p>this converter is particularly useful for building properly escaped json for<br>logging to servers which consume json-formated traffic logs.</p>\n<p>example:<br>capture request header user-agent len 150<br>capture request header host len 15<br>log-format {“ip”:”%[src]”,”user-agent”:”%[capture.req.hdr(1),json]”}</p>\n<p>input request from client 127.0.0.1:<br>get / http/1.0<br>user-agent: very “ugly” ua 1/2</p>\n<p>output log:<br>{“ip”:”127.0.0.1”,”user-agent”:”very \\”ugly\\” ua 1\\/2”}</p>\n</li>\n</ul>\n<p>language(<value>[,<default>])<br>  returns the value with the highest q-factor from a list as extracted from the<br>  “accept-language” header using “req.fhdr”. values with no q-factor have a<br>  q-factor of 1. values with a q-factor of 0 are dropped. only values which<br>  belong to the list of semi-colon delimited <values> will be considered. the<br>  argument <value> syntax is “lang[;lang[;lang[;…]]]”. if no value matches the<br>  given list and a default value is provided, it is returned. note that language<br>  names may have a variant after a dash (‘-‘). if this variant is present in the<br>  list, it will be matched, but if it is not, only the base language is checked.<br>  the match is case-sensitive, and the output string is always one of those<br>  provided in arguments.  the ordering of arguments is meaningless, only the<br>  ordering of the values in the request counts, as the first value among<br>  multiple sharing the same q-factor is used.</value></values></default></value></p>\n<p>  example :</p>\n<pre><code># this configuration switches to the backend matching a\n# given language based on the request :\n\nacl es req.fhdr(accept-language),language(es;fr;en) -m str es\nacl fr req.fhdr(accept-language),language(es;fr;en) -m str fr\nacl en req.fhdr(accept-language),language(es;fr;en) -m str en\nuse_backend spanish if es\nuse_backend french  if fr\nuse_backend english if en\ndefault_backend choose_your_language\n</code></pre><p>lower<br>  convert a string sample to lower case. this can only be placed after a string<br>  sample fetch function or after a transformation keyword returning a string<br>  type. the result is of type string.</p>\n<p>ltime(<format>[,<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in local time using a format defined by the <format><br>  string using strftime(3). the purpose is to allow any date format to be used<br>  in logs. an optional <offset> in seconds may be applied to the input date<br>  (positive or negative). see the strftime() man page for the format supported<br>  by your operating system. see also the utime converter.</offset></format></offset></format></p>\n<p>  example :</p>\n<pre><code># emit two colons, one with the local time and another with ip:port\n# eg:  20140710162350 127.0.0.1:57325\nlog-format %[date,ltime(%y%m%d%h%m%s)]\\ %ci:%cp\n</code></pre><p>map(<map_file>[,<default_value>])<br>map_<match_type>(<map_file>[,<default_value>])<br>map_<match_type>_<output_type>(<map_file>[,<default_value>])<br>  search the input value from <map_file> using the <match_type> matching method,<br>  and return the associated value converted to the type <output_type>. if the<br>  input value cannot be found in the <map_file>, the converter returns the<br>  <default_value>. if the <default_value> is not set, the converter fails and<br>  acts as if no input value could be fetched. if the <match_type> is not set, it<br>  defaults to “str”. likewise, if the <output_type> is not set, it defaults to<br>  “str”. for convenience, the “map” keyword is an alias for “map_str” and maps a<br>  string to another string.</output_type></match_type></default_value></default_value></map_file></output_type></match_type></map_file></default_value></map_file></output_type></match_type></default_value></map_file></match_type></default_value></map_file></p>\n<p>  it is important to avoid overlapping between the keys : ip addresses and<br>  strings are stored in trees, so the first of the finest match will be used.<br>  other keys are stored in lists, so the first matching occurrence will be used.</p>\n<p>  the following array contains the list of all map functions avalaible sorted by<br>  input type, match type and output type.</p>\n<p>  input type | match method | output type str | output type int | output type ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | str          | map_str         | map_str_int     | map_str_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | beg          | map_beg         | map_beg_int     | map_end_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | sub          | map_sub         | map_sub_int     | map_sub_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | dir          | map_dir         | map_dir_int     | map_dir_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | dom          | map_dom         | map_dom_int     | map_dom_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | end          | map_end         | map_end_int     | map_end_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | reg          | map_reg         | map_reg_int     | map_reg_ip<br>  ———–+————–+—————–+—————–+—————<br>    int      | int          | map_int         | map_int_int     | map_int_ip<br>  ———–+————–+—————–+—————–+—————<br>    ip       | ip           | map_ip          | map_ip_int      | map_ip_ip<br>  ———–+————–+—————–+—————–+—————</p>\n<p>  the file contains one key + value per line. lines which start with ‘#’ are<br>  ignored, just like empty lines. leading tabs and spaces are stripped. the key<br>  is then the first “word” (series of non-space/tabs characters), and the value<br>  is what follows this series of space/tab till the end of the line excluding<br>  trailing spaces/tabs.</p>\n<p>  example :</p>\n<pre><code># this is a comment and is ignored\n   2.22.246.0/23    united kingdom      \\n\n&lt;-&gt;&lt;-----------&gt;&lt;--&gt;&lt;------------&gt;&lt;----&gt;\n |       |       |         |        `- trailing spaces ignored\n |       |       |         `---------- value\n |       |       `-------------------- middle spaces ignored\n |       `---------------------------- key\n `------------------------------------ leading spaces ignored\n</code></pre><p>mod(<value>)<br>  divides the input value of type signed integer by <value>, and returns the<br>  remainder as an signed integer. if <value> is null, then zero is returned.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></value></p>\n<p>mul(<value>)<br>  multiplies the input value of type signed integer by <value>, and returns<br>  the product as an signed integer. in case of overflow, the largest possible<br>  value for the sign is returned so that the operation doesn’t wrap around.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<p>neg<br>  takes the input value of type signed integer, computes the opposite value,<br>  and returns the remainder as an signed integer. 0 is identity. this operator<br>  is provided for reversed subtracts : in order to subtract the input from a<br>  constant, simply perform a “neg,add(value)”.</p>\n<p>not<br>  returns a boolean false if the input value of type signed integer is<br>  non-null, otherwise returns true. used in conjunction with and(), it can be<br>  used to report true/false for bit testing on input values (eg: verify the<br>  absence of a flag).</p>\n<p>odd<br>  returns a boolean true if the input value of type signed integer is odd<br>  otherwise returns false. it is functionally equivalent to “and(1),bool”.</p>\n<p>or(<value>)<br>  performs a bitwise “or” between <value> and the input value of type signed<br>  integer, and returns the result as an signed integer. <value> can be a<br>  numeric value or a variable name. the name of the variable starts by an<br>  indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<p>regsub(<regex>,<subst>[,<flags>])<br>  applies a regex-based substitution to the input string. it does the same<br>  operation as the well-known “sed” utility with “s/<regex>/<subst>/“. by<br>  default it will replace in the input string the first occurrence of the<br>  largest part matching the regular expression <regex> with the substitution<br>  string <subst>. it is possible to replace all occurrences instead by adding<br>  the flag “g” in the third argument <flags>. it is also possible to make the<br>  regex case insensitive by adding the flag “i” in <flags>. since <flags> is a<br>  string, it is made up from the concatenation of all desired flags. thus if<br>  both “i” and “g” are desired, using “gi” or “ig” will have the same effect.<br>  it is important to note that due to the current limitations of the<br>  configuration parser, some characters such as closing parenthesis or comma<br>  are not possible to use in the arguments. the first use of this converter is<br>  to replace certain characters or sequence of characters with other ones.</flags></flags></flags></subst></regex></subst></regex></flags></subst></regex></p>\n<p>  example :</p>\n<pre><code># de-duplicate &quot;/&quot; in header &quot;x-path&quot;.\n# input:  x-path: /////a///b/c/xzxyz/\n# output: x-path: /a/b/c/xzxyz/\nhttp-request set-header x-path %[hdr(x-path),regsub(/+,/,g)]\n</code></pre><p>capture-req(<id>)<br>  capture the string entry in the request slot <id> and returns the entry as<br>  is. if the slot doesn’t exist, the capture fails silently.</id></id></p>\n<p>  see also: “declare capture”, “http-request capture”,<br>            “http-response capture”, “req.hdr.capture” and<br>            “res.hdr.capture” (sample fetches).</p>\n<p>capture-res(<id>)<br>  capture the string entry in the response slot <id> and returns the entry as<br>  is. if the slot doesn’t exist, the capture fails silently.</id></id></p>\n<p>  see also: “declare capture”, “http-request capture”,<br>            “http-response capture”, “req.hdr.capture” and<br>            “res.hdr.capture” (sample fetches).</p>\n<p>sdbm([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the sdbm<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “djb2”, “wt6” and the<br>  “hash-type” directive.</avalanche></avalanche></p>\n<p>set-var(<var name=\"\">)<br>  sets a variable with the input content and return the content on the output as<br>  is. the variable keep the value and the associated input type. the name of the<br>  variable starts by an indication about it scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</var></p>\n<p>sub(<value>)<br>  subtracts <value> from the input value of type signed integer, and returns<br>  the result as an signed integer. note: in order to subtract the input from<br>  a constant, simply perform a “neg,add(value)”. <value> can be a numeric value<br>  or a variable name. the name of the variable starts by an indication about its<br>  scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<p>table_bytes_in_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average client-to-server<br>  bytes rate associated with the input sample in the designated table, measured<br>  in amount of bytes over the period configured in the table. see also the<br>  sc_bytes_in_rate sample fetch keyword.</table></p>\n<p>table_bytes_out_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average server-to-client<br>  bytes rate associated with the input sample in the designated table, measured<br>  in amount of bytes over the period configured in the table. see also the<br>  sc_bytes_out_rate sample fetch keyword.</table></p>\n<p>table_conn_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of incoming<br>  connections associated with the input sample in the designated table. see<br>  also the sc_conn_cnt sample fetch keyword.</table></p>\n<p>table_conn_cur(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current amount of concurrent<br>  tracked connections associated with the input sample in the designated table.<br>  see also the sc_conn_cur sample fetch keyword.</table></p>\n<p>table_conn_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average incoming connection<br>  rate associated with the input sample in the designated table. see also the<br>  sc_conn_rate sample fetch keyword.</table></p>\n<p>table_gpc0(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current value of the first<br>  general purpose counter associated with the input sample in the designated<br>  table. see also the sc_get_gpc0 sample fetch keyword.</table></p>\n<p>table_gpc0_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the frequency which the gpc0<br>  counter was incremented over the configured period in the table, associated<br>  with the input sample in the designated table. see also the sc_get_gpc0_rate<br>  sample fetch keyword.</table></p>\n<p>table_http_err_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of http<br>  errors associated with the input sample in the designated table. see also the<br>  sc_http_err_cnt sample fetch keyword.</table></p>\n<p>table_http_err_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the average rate of http errors associated with the<br>  input sample in the designated table, measured in amount of errors over the<br>  period configured in the table. see also the sc_http_err_rate sample fetch<br>  keyword.</table></p>\n<p>table_http_req_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of http<br>  requests associated with the input sample in the designated table. see also<br>  the sc_http_req_cnt sample fetch keyword.</table></p>\n<p>table_http_req_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the average rate of http requests associated with the<br>  input sample in the designated table, measured in amount of requests over the<br>  period configured in the table. see also the sc_http_req_rate sample fetch<br>  keyword.</table></p>\n<p>table_kbytes_in(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of client-<br>  to-server data associated with the input sample in the designated table,<br>  measured in kilobytes. the test is currently performed on 32-bit integers,<br>  which limits values to 4 terabytes. see also the sc_kbytes_in sample fetch<br>  keyword.</table></p>\n<p>table_kbytes_out(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of server-<br>  to-client data associated with the input sample in the designated table,<br>  measured in kilobytes. the test is currently performed on 32-bit integers,<br>  which limits values to 4 terabytes. see also the sc_kbytes_out sample fetch<br>  keyword.</table></p>\n<p>table_server_id(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the server id associated with<br>  the input sample in the designated table. a server id is associated to a<br>  sample by a “stick” rule when a connection to a server succeeds. a server id<br>  zero means that no server is associated with this key.</table></p>\n<p>table_sess_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of incoming<br>  sessions associated with the input sample in the designated table. note that<br>  a session here refers to an incoming connection being accepted by the<br>  “tcp-request connection” rulesets. see also the sc_sess_cnt sample fetch<br>  keyword.</table></p>\n<p>table_sess_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average incoming session<br>  rate associated with the input sample in the designated table. note that a<br>  session here refers to an incoming connection being accepted by the<br>  “tcp-request connection” rulesets. see also the sc_sess_rate sample fetch<br>  keyword.</table></p>\n<p>table_trackers(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current amount of concurrent<br>  connections tracking the same key as the input sample in the designated<br>  table. it differs from table_conn_cur in that it does not rely on any stored<br>  information but on the table’s reference count (the “use” value which is<br>  returned by “show table” on the cli). this may sometimes be more suited for<br>  layer7 tracking. it can be used to tell a server how many concurrent<br>  connections there are from a given address for example. see also the<br>  sc_trackers sample fetch keyword.</table></p>\n<p>upper<br>  convert a string sample to upper case. this can only be placed after a string<br>  sample fetch function or after a transformation keyword returning a string<br>  type. the result is of type string.</p>\n<p>url_dec<br>  takes an url-encoded string provided as input and returns the decoded<br>  version as output. the input and the output are of type string.</p>\n<p>utime(<format>[,<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in utc time using a format defined by the <format><br>  string using strftime(3). the purpose is to allow any date format to be used<br>  in logs. an optional <offset> in seconds may be applied to the input date<br>  (positive or negative). see the strftime() man page for the format supported<br>  by your operating system. see also the ltime converter.</offset></format></offset></format></p>\n<p>  example :</p>\n<pre><code># emit two colons, one with the utc time and another with ip:port\n# eg:  20140710162350 127.0.0.1:57325\nlog-format %[date,utime(%y%m%d%h%m%s)]\\ %ci:%cp\n</code></pre><p>word(<index>,<delimiters>)<br>  extracts the nth word considering given delimiters from an input string.<br>  indexes start at 1 and delimiters are a string formatted list of chars.</delimiters></index></p>\n<p>wt6([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the wt6<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “djb2”, “sdbm”, and the<br>  “hash-type” directive.</avalanche></avalanche></p>\n<p>xor(<value>)<br>  performs a bitwise “xor” (exclusive or) between <value> and the input value<br>  of type signed integer, and returns the result as an signed integer.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</value></value></value></p>\n<h2 id=\"7-3-2-fetching-samples-from-internal-states\"><a href=\"#7-3-2-fetching-samples-from-internal-states\" class=\"headerlink\" title=\"7.3.2. fetching samples from internal states\"></a>7.3.2. fetching samples from internal states</h2><p>a first set of sample fetch methods applies to internal information which does<br>not even relate to any client information. these ones are sometimes used with<br>“monitor-fail” directives to report an internal status to external watchers.<br>the sample fetch methods described in this section are usable anywhere.</p>\n<p>always_false : boolean<br>  always returns the boolean “false” value. it may be used with acls as a<br>  temporary replacement for another one when adjusting configurations.</p>\n<p>always_true : boolean<br>  always returns the boolean “true” value. it may be used with acls as a<br>  temporary replacement for another one when adjusting configurations.</p>\n<p>avg_queue([<backend>]) : integer<br>  returns the total number of queued connections of the designated backend<br>  divided by the number of active servers. the current backend is used if no<br>  backend is specified. this is very similar to “queue” except that the size of<br>  the farm is considered, in order to give a more accurate measurement of the<br>  time it may take for a new connection to be processed. the main usage is with<br>  acl to return a sorry page to new users when it becomes certain they will get<br>  a degraded service, or to pass to the backend servers in a header so that<br>  they decide to work in degraded mode or to disable some functions to speed up<br>  the processing a bit. note that in the event there would not be any active<br>  server anymore, twice the number of queued connections would be considered as<br>  the measured value. this is a fair estimate, as we expect one server to get<br>  back soon anyway, but we still prefer to send new traffic to another backend<br>  if in better shape. see also the “queue”, “be_conn”, and “be_sess_rate”<br>  sample fetches.</backend></p>\n<p>be_conn([<backend>]) : integer<br>  applies to the number of currently established connections on the backend,<br>  possibly including the connection being evaluated. if no backend name is<br>  specified, the current one is used. but it is also possible to check another<br>  backend. it can be used to use a specific farm when the nominal one is full.<br>  see also the “fe_conn”, “queue” and “be_sess_rate” criteria.</backend></p>\n<p>be_sess_rate([<backend>]) : integer<br>  returns an integer value corresponding to the sessions creation rate on the<br>  backend, in number of new sessions per second. this is used with acls to<br>  switch to an alternate backend when an expensive or fragile one reaches too<br>  high a session rate, or to limit abuse of service (eg. prevent sucking of an<br>  online dictionary). it can also be useful to add this element to logs using a<br>  log-format directive.</backend></p>\n<p>  example :</p>\n<pre><code># redirect to an error page if the dictionary is requested too often\nbackend dynamic\n    mode http\n    acl being_scanned be_sess_rate gt 100\n    redirect location /denied.html if being_scanned\n</code></pre><p>bin(<hexa>) : bin<br>  returns a binary chain. the input is the hexadecimal representation<br>  of the string.</hexa></p>\n<p>bool(<bool>) : bool<br>  returns a boolean value. <bool> can be ‘true’, ‘false’, ‘1’ or ‘0’.<br>  ‘false’ and ‘0’ are the same. ‘true’ and ‘1’ are the same.</bool></bool></p>\n<p>connslots([<backend>]) : integer<br>  returns an integer value corresponding to the number of connection slots<br>  still available in the backend, by totaling the maximum amount of<br>  connections on all servers and the maximum queue size. this is probably only<br>  used with acls.</backend></p>\n<p>  the basic idea here is to be able to measure the number of connection “slots”<br>  still available (connection + queue), so that anything beyond that (intended<br>  usage; see “use_backend” keyword) can be redirected to a different backend.</p>\n<p>  ‘connslots’ = number of available server connection slots, + number of<br>  available server queue slots.</p>\n<p>  note that while “fe_conn” may be used, “connslots” comes in especially<br>  useful when you have a case of traffic going to one single ip, splitting into<br>  multiple backends (perhaps using acls to do name-based load balancing) and<br>  you want to be able to differentiate between different backends, and their<br>  available “connslots”.  also, whereas “nbsrv” only measures servers that are<br>  actually <em>down</em>, this fetch is more fine-grained and looks into the number of<br>  available connection slots as well. see also “queue” and “avg_queue”.</p>\n<p>  other caveats and notes: at this point in time, the code does not take care<br>  of dynamic connections. also, if any of the server maxconn, or maxqueue is 0,<br>  then this fetch clearly does not make sense, in which case the value returned<br>  will be -1.</p>\n<p>date([<offset>]) : integer<br>  returns the current date as the epoch (number of seconds since 01/01/1970).<br>  if an offset value is specified, then it is a number of seconds that is added<br>  to the current date before returning the value. this is particularly useful<br>  to compute relative dates, as both positive and negative offsets are allowed.<br>  it is useful combined with the http_date converter.</offset></p>\n<p>  example :</p>\n<pre><code># set an expires header to now+1 hour in every response\nhttp-response set-header expires %[date(3600),http_date]\n</code></pre><p>env(<name>) : string<br>  returns a string containing the value of environment variable <name>. as a<br>  reminder, environment variables are per-process and are sampled when the<br>  process starts. this can be useful to pass some information to a next hop<br>  server, or with acls to take specific action when the process is started a<br>  certain way.</name></name></p>\n<p>  examples :</p>\n<pre><code># pass the via header to next hop with the local hostname in it\nhttp-request add-header via 1.1\\ %[env(hostname)]\n\n# reject cookie-less requests when the stop environment variable is set\nhttp-request deny if !{ cook(sessionid) -m found } { env(stop) -m found }\n</code></pre><p>fe_conn([<frontend>]) : integer<br>  returns the number of currently established connections on the frontend,<br>  possibly including the connection being evaluated. if no frontend name is<br>  specified, the current one is used. but it is also possible to check another<br>  frontend. it can be used to return a sorry page before hard-blocking, or to<br>  use a specific backend to drain new requests when the farm is considered<br>  full.  this is mostly used with acls but can also be used to pass some<br>  statistics to servers in http headers. see also the “dst_conn”, “be_conn”,<br>  “fe_sess_rate” fetches.</frontend></p>\n<p>fe_sess_rate([<frontend>]) : integer<br>  returns an integer value corresponding to the sessions creation rate on the<br>  frontend, in number of new sessions per second. this is used with acls to<br>  limit the incoming session rate to an acceptable range in order to prevent<br>  abuse of service at the earliest moment, for example when combined with other<br>  layer 4 acls in order to force the clients to wait a bit for the rate to go<br>  down below the limit. it can also be useful to add this element to logs using<br>  a log-format directive. see also the “rate-limit sessions” directive for use<br>  in frontends.</frontend></p>\n<p>  example :</p>\n<pre><code># this frontend limits incoming mails to 10/s with a max of 100\n# concurrent connections. we accept any connection below 10/s, and\n# force excess clients to wait for 100 ms. since clients are limited to\n# 100 max, there cannot be more than 10 incoming mails per second.\nfrontend mail\n    bind :25\n    mode tcp\n    maxconn 100\n    acl too_fast fe_sess_rate ge 10\n    tcp-request inspect-delay 100ms\n    tcp-request content accept if ! too_fast\n    tcp-request content accept if wait_end\n</code></pre><p>int(<integer>) : signed integer<br>  returns a signed integer.</integer></p>\n<p>ipv4(<ipv4>) : ipv4<br>  returns an ipv4.</ipv4></p>\n<p>ipv6(<ipv6>) : ipv6<br>  returns an ipv6.</ipv6></p>\n<p>meth(<method>) : method<br>  returns a method.</method></p>\n<p>nbproc : integer<br>  returns an integer value corresponding to the number of processes that were<br>  started (it equals the global “nbproc” setting). this is useful for logging<br>  and debugging purposes.</p>\n<p>nbsrv([<backend>]) : integer<br>  returns an integer value corresponding to the number of usable servers of<br>  either the current backend or the named backend. this is mostly used with<br>  acls but can also be useful when added to logs. this is normally used to<br>  switch to an alternate backend when the number of servers is too low to<br>  to handle some load. it is useful to report a failure when combined with<br>  “monitor fail”.</backend></p>\n<p>proc : integer<br>  returns an integer value corresponding to the position of the process calling<br>  the function, between 1 and global.nbproc. this is useful for logging and<br>  debugging purposes.</p>\n<p>queue([<backend>]) : integer<br>  returns the total number of queued connections of the designated backend,<br>  including all the connections in server queues. if no backend name is<br>  specified, the current one is used, but it is also possible to check another<br>  one. this is useful with acls or to pass statistics to backend servers. this<br>  can be used to take actions when queuing goes above a known level, generally<br>  indicating a surge of traffic or a massive slowdown on the servers. one<br>  possible action could be to reject new users but still accept old ones. see<br>  also the “avg_queue”, “be_conn”, and “be_sess_rate” fetches.</backend></p>\n<p>rand([<range>]) : integer<br>  returns a random integer value within a range of <range> possible values,<br>  starting at zero. if the range is not specified, it defaults to 2^32, which<br>  gives numbers between 0 and 4294967295. it can be useful to pass some values<br>  needed to take some routing decisions for example, or just for debugging<br>  purposes. this random must not be used for security purposes.</range></range></p>\n<p>srv_conn([<backend>/]<server>) : integer<br>  returns an integer value corresponding to the number of currently established<br>  connections on the designated server, possibly including the connection being<br>  evaluated. if <backend> is omitted, then the server is looked up in the<br>  current backend. it can be used to use a specific farm when one server is<br>  full, or to inform the server about our view of the number of active<br>  connections with it. see also the “fe_conn”, “be_conn” and “queue” fetch<br>  methods.</backend></server></backend></p>\n<p>srv_is_up([<backend>/]<server>) : boolean<br>  returns true when the designated server is up, and false when it is either<br>  down or in maintenance mode. if <backend> is omitted, then the server is<br>  looked up in the current backend. it is mainly used to take action based on<br>  an external status reported via a health check (eg: a geographical site’s<br>  availability). another possible use which is more of a hack consists in<br>  using dummy servers as boolean variables that can be enabled or disabled from<br>  the cli, so that rules depending on those acls can be tweaked in realtime.</backend></server></backend></p>\n<p>srv_sess_rate([<backend>/]<server>) : integer<br>  returns an integer corresponding to the sessions creation rate on the<br>  designated server, in number of new sessions per second. if <backend> is<br>  omitted, then the server is looked up in the current backend. this is mostly<br>  used with acls but can make sense with logs too. this is used to switch to an<br>  alternate backend when an expensive or fragile one reaches too high a session<br>  rate, or to limit abuse of service (eg. prevent latent requests from<br>  overloading servers).</backend></server></backend></p>\n<p>  example :</p>\n<pre><code># redirect to a separate back\nacl srv1_full srv_sess_rate(be1/srv1) gt 50\nacl srv2_full srv_sess_rate(be1/srv2) gt 50\nuse_backend be2 if srv1_full or srv2_full\n</code></pre><p>stopping : boolean<br>  returns true if the process calling the function is currently stopping. this<br>  can be useful for logging, or for relaxing certain checks or helping close<br>  certain connections upon graceful shutdown.</p>\n<p>str(<string>) : string<br>  returns a string.</string></p>\n<p>table_avl([<table>]) : integer<br>  returns the total number of available entries in the current proxy’s<br>  stick-table or in the designated stick-table. see also table_cnt.</table></p>\n<p>table_cnt([<table>]) : integer<br>  returns the total number of entries currently in use in the current proxy’s<br>  stick-table or in the designated stick-table. see also src_conn_cnt and<br>  table_avl for other entry counting methods.</table></p>\n<p>var(<var-name>) : undefined<br>  returns a variable with the stored type. if the variable is not set, the<br>  sample fetch fails. the name of the variable starts by an indication about its<br>  scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</var-name></p>\n<h2 id=\"7-3-3-fetching-samples-at-layer-4\"><a href=\"#7-3-3-fetching-samples-at-layer-4\" class=\"headerlink\" title=\"7.3.3. fetching samples at layer 4\"></a>7.3.3. fetching samples at layer 4</h2><p>the layer 4 usually describes just the transport layer which in haproxy is<br>closest to the connection, where no content is yet made available. the fetch<br>methods described here are usable as low as the “tcp-request connection” rule<br>sets unless they require some future information. those generally include<br>tcp/ip addresses and ports, as well as elements from stick-tables related to<br>the incoming connection. for retrieving a value from a sticky counters, the<br>counter number can be explicitly set as 0, 1, or 2 using the pre-defined<br>“sc0<em>“, “sc1</em>“, or “sc2<em>“ prefix, or it can be specified as the first integer<br>argument when using the “sc</em>“ prefix. an optional table may be specified with<br>the “sc*” form, in which case the currently tracked key will be looked up into<br>this alternate table instead of the table currently being tracked.</p>\n<p>be_id : integer<br>  returns an integer containing the current backend’s id. it can be used in<br>  frontends with responses to check which backend processed the request.</p>\n<p>dst : ip<br>  this is the destination ipv4 address of the connection on the client side,<br>  which is the address the client connected to. it can be useful when running<br>  in transparent mode. it is of type ip and works on both ipv4 and ipv6 tables.<br>  on ipv6 tables, ipv4 address is mapped to its ipv6 equivalent, according to<br>  rfc 4291.</p>\n<p>dst_conn : integer<br>  returns an integer value corresponding to the number of currently established<br>  connections on the same socket including the one being evaluated. it is<br>  normally used with acls but can as well be used to pass the information to<br>  servers in an http header or in logs. it can be used to either return a sorry<br>  page before hard-blocking, or to use a specific backend to drain new requests<br>  when the socket is considered saturated. this offers the ability to assign<br>  different limits to different listening ports or addresses. see also the<br>  “fe_conn” and “be_conn” fetches.</p>\n<p>dst_port : integer<br>  returns an integer value corresponding to the destination tcp port of the<br>  connection on the client side, which is the port the client connected to.<br>  this might be used when running in transparent mode, when assigning dynamic<br>  ports to some clients for a whole application session, to stick all users to<br>  a same server, or to pass the destination port information to a server using<br>  an http header.</p>\n<p>fe_id : integer<br>  returns an integer containing the current frontend’s id. it can be used in<br>  backends to check from which backend it was called, or to stick all users<br>  coming via a same frontend to the same server.</p>\n<p>sc_bytes_in_rate(<ctr>[,<table>]) : integer<br>sc0_bytes_in_rate([<table>]) : integer<br>sc1_bytes_in_rate([<table>]) : integer<br>sc2_bytes_in_rate([<table>]) : integer<br>  returns the average client-to-server bytes rate from the currently tracked<br>  counters, measured in amount of bytes over the period configured in the<br>  table. see also src_bytes_in_rate.</table></table></table></table></ctr></p>\n<p>sc_bytes_out_rate(<ctr>[,<table>]) : integer<br>sc0_bytes_out_rate([<table>]) : integer<br>sc1_bytes_out_rate([<table>]) : integer<br>sc2_bytes_out_rate([<table>]) : integer<br>  returns the average server-to-client bytes rate from the currently tracked<br>  counters, measured in amount of bytes over the period configured in the<br>  table. see also src_bytes_out_rate.</table></table></table></table></ctr></p>\n<p>sc_clr_gpc0(<ctr>[,<table>]) : integer<br>sc0_clr_gpc0([<table>]) : integer<br>sc1_clr_gpc0([<table>]) : integer<br>sc2_clr_gpc0([<table>]) : integer<br>  clears the first general purpose counter associated to the currently tracked<br>  counters, and returns its previous value. before the first invocation, the<br>  stored value is zero, so first invocation will always return zero. this is<br>  typically used as a second acl in an expression in order to mark a connection<br>  when a first acl was verified :</table></table></table></table></ctr></p>\n<pre><code># block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 5\nacl save  sc0_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n</code></pre><p>sc_conn_cnt(<ctr>[,<table>]) : integer<br>sc0_conn_cnt([<table>]) : integer<br>sc1_conn_cnt([<table>]) : integer<br>sc2_conn_cnt([<table>]) : integer<br>  returns the cumulated number of incoming connections from currently tracked<br>  counters. see also src_conn_cnt.</table></table></table></table></ctr></p>\n<p>sc_conn_cur(<ctr>[,<table>]) : integer<br>sc0_conn_cur([<table>]) : integer<br>sc1_conn_cur([<table>]) : integer<br>sc2_conn_cur([<table>]) : integer<br>  returns the current amount of concurrent connections tracking the same<br>  tracked counters. this number is automatically incremented when tracking<br>  begins and decremented when tracking stops. see also src_conn_cur.</table></table></table></table></ctr></p>\n<p>sc_conn_rate(<ctr>[,<table>]) : integer<br>sc0_conn_rate([<table>]) : integer<br>sc1_conn_rate([<table>]) : integer<br>sc2_conn_rate([<table>]) : integer<br>  returns the average connection rate from the currently tracked counters,<br>  measured in amount of connections over the period configured in the table.<br>  see also src_conn_rate.</table></table></table></table></ctr></p>\n<p>sc_get_gpc0(<ctr>[,<table>]) : integer<br>sc0_get_gpc0([<table>]) : integer<br>sc1_get_gpc0([<table>]) : integer<br>sc2_get_gpc0([<table>]) : integer<br>  returns the value of the first general purpose counter associated to the<br>  currently tracked counters. see also src_get_gpc0 and sc/sc0/sc1/sc2_inc_gpc0.</table></table></table></table></ctr></p>\n<p>sc_gpc0_rate(<ctr>[,<table>]) : integer<br>sc0_gpc0_rate([<table>]) : integer<br>sc1_gpc0_rate([<table>]) : integer<br>sc2_gpc0_rate([<table>]) : integer<br>  returns the average increment rate of the first general purpose counter<br>  associated to the currently tracked counters. it reports the frequency<br>  which the gpc0 counter was incremented over the configured period. see also<br>  src_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. note<br>  that the “gpc0_rate” counter must be stored in the stick-table for a value to<br>  be returned, as “gpc0” only holds the event count.</table></table></table></table></ctr></p>\n<p>sc_http_err_cnt(<ctr>[,<table>]) : integer<br>sc0_http_err_cnt([<table>]) : integer<br>sc1_http_err_cnt([<table>]) : integer<br>sc2_http_err_cnt([<table>]) : integer<br>  returns the cumulated number of http errors from the currently tracked<br>  counters. this includes the both request errors and 4xx error responses.<br>  see also src_http_err_cnt.</table></table></table></table></ctr></p>\n<p>sc_http_err_rate(<ctr>[,<table>]) : integer<br>sc0_http_err_rate([<table>]) : integer<br>sc1_http_err_rate([<table>]) : integer<br>sc2_http_err_rate([<table>]) : integer<br>  returns the average rate of http errors from the currently tracked counters,<br>  measured in amount of errors over the period configured in the table. this<br>  includes the both request errors and 4xx error responses. see also<br>  src_http_err_rate.</table></table></table></table></ctr></p>\n<p>sc_http_req_cnt(<ctr>[,<table>]) : integer<br>sc0_http_req_cnt([<table>]) : integer<br>sc1_http_req_cnt([<table>]) : integer<br>sc2_http_req_cnt([<table>]) : integer<br>  returns the cumulated number of http requests from the currently tracked<br>  counters. this includes every started request, valid or not. see also<br>  src_http_req_cnt.</table></table></table></table></ctr></p>\n<p>sc_http_req_rate(<ctr>[,<table>]) : integer<br>sc0_http_req_rate([<table>]) : integer<br>sc1_http_req_rate([<table>]) : integer<br>sc2_http_req_rate([<table>]) : integer<br>  returns the average rate of http requests from the currently tracked<br>  counters, measured in amount of requests over the period configured in<br>  the table. this includes every started request, valid or not. see also<br>  src_http_req_rate.</table></table></table></table></ctr></p>\n<p>sc_inc_gpc0(<ctr>[,<table>]) : integer<br>sc0_inc_gpc0([<table>]) : integer<br>sc1_inc_gpc0([<table>]) : integer<br>sc2_inc_gpc0([<table>]) : integer<br>  increments the first general purpose counter associated to the currently<br>  tracked counters, and returns its new value. before the first invocation,<br>  the stored value is zero, so first invocation will increase it to 1 and will<br>  return 1. this is typically used as a second acl in an expression in order<br>  to mark a connection when a first acl was verified :</table></table></table></table></ctr></p>\n<pre><code>acl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n</code></pre><p>sc_kbytes_in(<ctr>[,<table>]) : integer<br>sc0_kbytes_in([<table>]) : integer<br>sc1_kbytes_in([<table>]) : integer<br>sc2_kbytes_in([<table>]) : integer<br>  returns the total amount of client-to-server data from the currently tracked<br>  counters, measured in kilobytes. the test is currently performed on 32-bit<br>  integers, which limits values to 4 terabytes. see also src_kbytes_in.</table></table></table></table></ctr></p>\n<p>sc_kbytes_out(<ctr>[,<table>]) : integer<br>sc0_kbytes_out([<table>]) : integer<br>sc1_kbytes_out([<table>]) : integer<br>sc2_kbytes_out([<table>]) : integer<br>  returns the total amount of server-to-client data from the currently tracked<br>  counters, measured in kilobytes. the test is currently performed on 32-bit<br>  integers, which limits values to 4 terabytes. see also src_kbytes_out.</table></table></table></table></ctr></p>\n<p>sc_sess_cnt(<ctr>[,<table>]) : integer<br>sc0_sess_cnt([<table>]) : integer<br>sc1_sess_cnt([<table>]) : integer<br>sc2_sess_cnt([<table>]) : integer<br>  returns the cumulated number of incoming connections that were transformed<br>  into sessions, which means that they were accepted by a “tcp-request<br>  connection” rule, from the currently tracked counters. a backend may count<br>  more sessions than connections because each connection could result in many<br>  backend sessions if some http keep-alive is performed over the connection<br>  with the client. see also src_sess_cnt.</table></table></table></table></ctr></p>\n<p>sc_sess_rate(<ctr>[,<table>]) : integer<br>sc0_sess_rate([<table>]) : integer<br>sc1_sess_rate([<table>]) : integer<br>sc2_sess_rate([<table>]) : integer<br>  returns the average session rate from the currently tracked counters,<br>  measured in amount of sessions over the period configured in the table. a<br>  session is a connection that got past the early “tcp-request connection”<br>  rules. a backend may count more sessions than connections because each<br>  connection could result in many backend sessions if some http keep-alive is<br>  performed over the connection with the client. see also src_sess_rate.</table></table></table></table></ctr></p>\n<p>sc_tracked(<ctr>[,<table>]) : boolean<br>sc0_tracked([<table>]) : boolean<br>sc1_tracked([<table>]) : boolean<br>sc2_tracked([<table>]) : boolean<br>  returns true if the designated session counter is currently being tracked by<br>  the current session. this can be useful when deciding whether or not we want<br>  to set some values in a header passed to the server.</table></table></table></table></ctr></p>\n<p>sc_trackers(<ctr>[,<table>]) : integer<br>sc0_trackers([<table>]) : integer<br>sc1_trackers([<table>]) : integer<br>sc2_trackers([<table>]) : integer<br>  returns the current amount of concurrent connections tracking the same<br>  tracked counters. this number is automatically incremented when tracking<br>  begins and decremented when tracking stops. it differs from sc0_conn_cur in<br>  that it does not rely on any stored information but on the table’s reference<br>  count (the “use” value which is returned by “show table” on the cli). this<br>  may sometimes be more suited for layer7 tracking. it can be used to tell a<br>  server how many concurrent connections there are from a given address for<br>  example.</table></table></table></table></ctr></p>\n<p>so_id : integer<br>  returns an integer containing the current listening socket’s id. it is useful<br>  in frontends involving many “bind” lines, or to stick all users coming via a<br>  same socket to the same server.</p>\n<p>src : ip<br>  this is the source ipv4 address of the client of the session.  it is of type<br>  ip and works on both ipv4 and ipv6 tables. on ipv6 tables, ipv4 addresses are<br>  mapped to their ipv6 equivalent, according to rfc 4291. note that it is the<br>  tcp-level source address which is used, and not the address of a client<br>  behind a proxy. however if the “accept-proxy” bind directive is used, it can<br>  be the address of a client behind another proxy-protocol compatible component<br>  for all rule sets except “tcp-request connection” which sees the real address.</p>\n<p>  example:</p>\n<pre><code># add an http header in requests with the originating address&apos; country\nhttp-request set-header x-country %[src,map_ip(geoip.lst)]\n</code></pre><p>src_bytes_in_rate([<table>]) : integer<br>  returns the average bytes rate from the incoming connection’s source address<br>  in the current proxy’s stick-table or in the designated stick-table, measured<br>  in amount of bytes over the period configured in the table. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_in_rate.</table></p>\n<p>src_bytes_out_rate([<table>]) : integer<br>  returns the average bytes rate to the incoming connection’s source address in<br>  the current proxy’s stick-table or in the designated stick-table, measured in<br>  amount of bytes over the period configured in the table. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_out_rate.</table></p>\n<p>src_clr_gpc0([<table>]) : integer<br>  clears the first general purpose counter associated to the incoming<br>  connection’s source address in the current proxy’s stick-table or in the<br>  designated stick-table, and returns its previous value. if the address is not<br>  found, an entry is created and 0 is returned. this is typically used as a<br>  second acl in an expression in order to mark a connection when a first acl<br>  was verified :</table></p>\n<pre><code># block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse src_http_req_rate gt 10\nacl kill  src_inc_gpc0 gt 5\nacl save  src_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n</code></pre><p>src_conn_cnt([<table>]) : integer<br>  returns the cumulated number of connections initiated from the current<br>  incoming connection’s source address in the current proxy’s stick-table or in<br>  the designated stick-table. if the address is not found, zero is returned.<br>  see also sc/sc0/sc1/sc2_conn_cnt.</table></p>\n<p>src_conn_cur([<table>]) : integer<br>  returns the current amount of concurrent connections initiated from the<br>  current incoming connection’s source address in the current proxy’s<br>  stick-table or in the designated stick-table. if the address is not found,<br>  zero is returned. see also sc/sc0/sc1/sc2_conn_cur.</table></p>\n<p>src_conn_rate([<table>]) : integer<br>  returns the average connection rate from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of connections over the period configured in the table. if<br>  the address is not found, zero is returned. see also sc/sc0/sc1/sc2_conn_rate.</table></p>\n<p>src_get_gpc0([<table>]) : integer<br>  returns the value of the first general purpose counter associated to the<br>  incoming connection’s source address in the current proxy’s stick-table or in<br>  the designated stick-table. if the address is not found, zero is returned.<br>  see also sc/sc0/sc1/sc2_get_gpc0 and src_inc_gpc0.</table></p>\n<p>src_gpc0_rate([<table>]) : integer<br>  returns the average increment rate of the first general purpose counter<br>  associated to the incoming connection’s source address in the current proxy’s<br>  stick-table or in the designated stick-table. it reports the frequency<br>  which the gpc0 counter was incremented over the configured period. see also<br>  sc/sc0/sc1/sc2_gpc0_rate, src_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. note<br>  that the “gpc0_rate” counter must be stored in the stick-table for a value to<br>  be returned, as “gpc0” only holds the event count.</table></p>\n<p>src_http_err_cnt([<table>]) : integer<br>  returns the cumulated number of http errors from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated<br>  stick-table. this includes the both request errors and 4xx error responses.<br>  see also sc/sc0/sc1/sc2_http_err_cnt. if the address is not found, zero is<br>  returned.</table></p>\n<p>src_http_err_rate([<table>]) : integer<br>  returns the average rate of http errors from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of errors over the period configured in the table. this<br>  includes the both request errors and 4xx error responses. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_err_rate.</table></p>\n<p>src_http_req_cnt([<table>]) : integer<br>  returns the cumulated number of http requests from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated stick-<br>  table. this includes every started request, valid or not. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_cnt.</table></p>\n<p>src_http_req_rate([<table>]) : integer<br>  returns the average rate of http requests from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated stick-<br>  table, measured in amount of requests over the period configured in the<br>  table. this includes every started request, valid or not. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_rate.</table></p>\n<p>src_inc_gpc0([<table>]) : integer<br>  increments the first general purpose counter associated to the incoming<br>  connection’s source address in the current proxy’s stick-table or in the<br>  designated stick-table, and returns its new value. if the address is not<br>  found, an entry is created and 1 is returned. see also sc0/sc2/sc2_inc_gpc0.<br>  this is typically used as a second acl in an expression in order to mark a<br>  connection when a first acl was verified :</table></p>\n<pre><code>acl abuse src_http_req_rate gt 10\nacl kill  src_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n</code></pre><p>src_kbytes_in([<table>]) : integer<br>  returns the total amount of data received from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated<br>  stick-table, measured in kilobytes. if the address is not found, zero is<br>  returned. the test is currently performed on 32-bit integers, which limits<br>  values to 4 terabytes. see also sc/sc0/sc1/sc2_kbytes_in.</table></p>\n<p>src_kbytes_out([<table>]) : integer<br>  returns the total amount of data sent to the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in kilobytes. if the address is not found, zero is returned. the<br>  test is currently performed on 32-bit integers, which limits values to 4<br>  terabytes. see also sc/sc0/sc1/sc2_kbytes_out.</table></p>\n<p>src_port : integer<br>  returns an integer value corresponding to the tcp source port of the<br>  connection on the client side, which is the port the client connected from.<br>  usage of this function is very limited as modern protocols do not care much<br>  about source ports nowadays.</p>\n<p>src_sess_cnt([<table>]) : integer<br>  returns the cumulated number of connections initiated from the incoming<br>  connection’s source ipv4 address in the current proxy’s stick-table or in the<br>  designated stick-table, that were transformed into sessions, which means that<br>  they were accepted by “tcp-request” rules. if the address is not found, zero<br>  is returned. see also sc/sc0/sc1/sc2_sess_cnt.</table></p>\n<p>src_sess_rate([<table>]) : integer<br>  returns the average session rate from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of sessions over the period configured in the table. a<br>  session is a connection that went past the early “tcp-request” rules. if the<br>  address is not found, zero is returned. see also sc/sc0/sc1/sc2_sess_rate.</table></p>\n<p>src_updt_conn_cnt([<table>]) : integer<br>  creates or updates the entry associated to the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table.<br>  this table must be configured to store the “conn_cnt” data type, otherwise<br>  the match will be ignored. the current count is incremented by one, and the<br>  expiration timer refreshed. the updated count is returned, so this match<br>  can’t return zero. this was used to reject service abusers based on their<br>  source address. note: it is recommended to use the more complete “track-sc*”<br>  actions in “tcp-request” rules instead.</table></p>\n<p>  example :</p>\n<pre><code># this frontend limits incoming ssh connections to 3 per 10 second for\n# each source address, and rejects excess connections until a 10 second\n# silence is observed. at most 20 addresses are tracked.\nlisten ssh\n    bind :22\n    mode tcp\n    maxconn 100\n    stick-table type ip size 20 expire 10s store conn_cnt\n    tcp-request content reject if { src_updt_conn_cnt gt 3 }\n    server local 127.0.0.1:22\n</code></pre><p>srv_id : integer<br>  returns an integer containing the server’s id when processing the response.<br>  while it’s almost only used with acls, it may be used for logging or<br>  debugging.</p>\n<h2 id=\"7-3-4-fetching-samples-at-layer-5\"><a href=\"#7-3-4-fetching-samples-at-layer-5\" class=\"headerlink\" title=\"7.3.4. fetching samples at layer 5\"></a>7.3.4. fetching samples at layer 5</h2><p>the layer 5 usually describes just the session layer which in haproxy is<br>closest to the session once all the connection handshakes are finished, but<br>when no content is yet made available. the fetch methods described here are<br>usable as low as the “tcp-request content” rule sets unless they require some<br>future information. those generally include the results of ssl negotiations.</p>\n<p>ssl_bc : boolean<br>  returns true when the back connection was made via an ssl/tls transport<br>  layer and is locally deciphered. this means the outgoing connection was made<br>  other a server with the “ssl” option.</p>\n<p>ssl_bc_alg_keysize : integer<br>  returns the symmetric cipher key size supported in bits when the outgoing<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_bc_cipher : string<br>  returns the name of the used cipher when the outgoing connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_bc_protocol : string<br>  returns the name of the used protocol when the outgoing connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_bc_unique_id : binary<br>  when the outgoing connection was made over an ssl/tls transport layer,<br>  returns the tls unique id as defined in rfc5929 section 3. the unique id<br>  can be encoded to base64 using the converter: “ssl_bc_unique_id,base64”.</p>\n<p>ssl_bc_session_id : binary<br>  returns the ssl id of the back connection when the outgoing connection was<br>  made over an ssl/tls transport layer. it is useful to log if we want to know<br>  if session was reused or not.</p>\n<p>ssl_bc_use_keysize : integer<br>  returns the symmetric cipher key size used in bits when the outgoing<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_c_ca_err : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the id of the first error detected during verification of the client<br>  certificate at depth &gt; 0, or 0 if no error was encountered during this<br>  verification process. please refer to your ssl library’s documentation to<br>  find the exhaustive list of error codes.</p>\n<p>ssl_c_ca_err_depth : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the depth in the ca chain of the first error detected during the<br>  verification of the client certificate. if no error is encountered, 0 is<br>  returned.</p>\n<p>ssl_c_der : binary<br>  returns the der formatted certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_c_err : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the id of the first error detected during verification at depth 0, or<br>  0 if no error was encountered during this verification process. please refer<br>  to your ssl library’s documentation to find the exhaustive list of error<br>  codes.</p>\n<p>ssl_c_i_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the issuer of the certificate<br>  presented by the client when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_c_i_dn(ou,2)” the second organization unit, and<br>  “ssl_c_i_dn(cn)” retrieves the common name.</entry></occ></entry></p>\n<p>ssl_c_key_alg : string<br>  returns the name of the algorithm used to generate the key of the certificate<br>  presented by the client when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_notafter : string<br>  returns the end date presented by the client as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_notbefore : string<br>  returns the start date presented by the client as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_s_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the subject of the certificate<br>  presented by the client when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_c_s_dn(ou,2)” the second organization unit, and<br>  “ssl_c_s_dn(cn)” retrieves the common name.</entry></occ></entry></p>\n<p>ssl_c_serial : binary<br>  returns the serial of the certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_c_sha1 : binary<br>  returns the sha-1 fingerprint of the certificate presented by the client when<br>  the incoming connection was made over an ssl/tls transport layer. this can be<br>  used to stick a client to a server, or to pass this information to a server.<br>  note that the output is binary, so if you want to pass that signature to the<br>  server, you need to encode it in hex or base64, such as in the example below:</p>\n<pre><code>http-request set-header x-ssl-client-sha1 %[ssl_c_sha1,hex]\n</code></pre><p>ssl_c_sig_alg : string<br>  returns the name of the algorithm used to sign the certificate presented by<br>  the client when the incoming connection was made over an ssl/tls transport<br>  layer.</p>\n<p>ssl_c_used : boolean<br>  returns true if current ssl session uses a client certificate even if current<br>  connection uses ssl session resumption. see also “ssl_fc_has_crt”.</p>\n<p>ssl_c_verify : integer<br>  returns the verify result error id when the incoming connection was made over<br>  an ssl/tls transport layer, otherwise zero if no error is encountered. please<br>  refer to your ssl library’s documentation for an exhaustive list of error<br>  codes.</p>\n<p>ssl_c_version : integer<br>  returns the version of the certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer.</p>\n<p>ssl_f_der : binary<br>  returns the der formatted certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_f_i_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the issuer of the certificate<br>  presented by the frontend when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_f_i_dn(ou,2)” the second organization unit, and<br>  “ssl_f_i_dn(cn)” retrieves the common name.</entry></occ></entry></p>\n<p>ssl_f_key_alg : string<br>  returns the name of the algorithm used to generate the key of the certificate<br>  presented by the frontend when the incoming connection was made over an<br>  ssl/tls transport layer.</p>\n<p>ssl_f_notafter : string<br>  returns the end date presented by the frontend as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_f_notbefore : string<br>  returns the start date presented by the frontend as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_f_s_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the subject of the certificate<br>  presented by the frontend when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_f_s_dn(ou,2)” the second organization unit, and<br>  “ssl_f_s_dn(cn)” retrieves the common name.</entry></occ></entry></p>\n<p>ssl_f_serial : binary<br>  returns the serial of the certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_f_sha1 : binary<br>  returns the sha-1 fingerprint of the certificate presented by the frontend<br>  when the incoming connection was made over an ssl/tls transport layer. this<br>  can be used to know which certificate was chosen using sni.</p>\n<p>ssl_f_sig_alg : string<br>  returns the name of the algorithm used to sign the certificate presented by<br>  the frontend when the incoming connection was made over an ssl/tls transport<br>  layer.</p>\n<p>ssl_f_version : integer<br>  returns the version of the certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer.</p>\n<p>ssl_fc : boolean<br>  returns true when the front connection was made via an ssl/tls transport<br>  layer and is locally deciphered. this means it has matched a socket declared<br>  with a “bind” line having the “ssl” option.</p>\n<p>  example :</p>\n<pre><code># this passes &quot;x-proto: https&quot; to servers when client connects over ssl\nlisten http-https\n    bind :80\n    bind :443 ssl crt /etc/haproxy.pem\n    http-request add-header x-proto https if { ssl_fc }\n</code></pre><p>ssl_fc_alg_keysize : integer<br>  returns the symmetric cipher key size supported in bits when the incoming<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_fc_alpn : string<br>  this extracts the application layer protocol negotiation field from an<br>  incoming connection made via a tls transport layer and locally deciphered by<br>  haproxy. the result is a string containing the protocol name advertised by<br>  the client. the ssl library must have been built with support for tls<br>  extensions enabled (check haproxy -vv). note that the tls alpn extension is<br>  not advertised unless the “alpn” keyword on the “bind” line specifies a<br>  protocol list. also, nothing forces the client to pick a protocol from this<br>  list, any other one may be requested. the tls alpn extension is meant to<br>  replace the tls npn extension. see also “ssl_fc_npn”.</p>\n<p>ssl_fc_cipher : string<br>  returns the name of the used cipher when the incoming connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_fc_has_crt : boolean<br>  returns true if a client certificate is present in an incoming connection over<br>  ssl/tls transport layer. useful if ‘verify’ statement is set to ‘optional’.<br>  note: on ssl session resumption with session id or tls ticket, client<br>  certificate is not present in the current connection but may be retrieved<br>  from the cache or the ticket. so prefer “ssl_c_used” if you want to check if<br>  current ssl session uses a client certificate.</p>\n<p>ssl_fc_has_sni : boolean<br>  this checks for the presence of a server name indication tls extension (sni)<br>  in an incoming connection was made over an ssl/tls transport layer. returns<br>  true when the incoming connection presents a tls sni field. this requires<br>  that the ssl library is build with support for tls extensions enabled (check<br>  haproxy -vv).</p>\n<p>ssl_fc_is_resumed: boolean<br>  returns true if the ssl/tls session has been resumed through the use of<br>  ssl session cache or tls tickets.</p>\n<p>ssl_fc_npn : string<br>  this extracts the next protocol negotiation field from an incoming connection<br>  made via a tls transport layer and locally deciphered by haproxy. the result<br>  is a string containing the protocol name advertised by the client. the ssl<br>  library must have been built with support for tls extensions enabled (check<br>  haproxy -vv). note that the tls npn extension is not advertised unless the<br>  “npn” keyword on the “bind” line specifies a protocol list. also, nothing<br>  forces the client to pick a protocol from this list, any other one may be<br>  requested. please note that the tls npn extension was replaced with alpn.</p>\n<p>ssl_fc_protocol : string<br>  returns the name of the used protocol when the incoming connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_fc_unique_id : binary<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the tls unique id as defined in rfc5929 section 3. the unique id<br>  can be encoded to base64 using the converter: “ssl_bc_unique_id,base64”.</p>\n<p>ssl_fc_session_id : binary<br>  returns the ssl id of the front connection when the incoming connection was<br>  made over an ssl/tls transport layer. it is useful to stick a given client to<br>  a server. it is important to note that some browsers refresh their session id<br>  every few minutes.</p>\n<p>ssl_fc_sni : string<br>  this extracts the server name indication tls extension (sni) field from an<br>  incoming connection made via an ssl/tls transport layer and locally<br>  deciphered by haproxy. the result (when present) typically is a string<br>  matching the https host name (253 chars or less). the ssl library must have<br>  been built with support for tls extensions enabled (check haproxy -vv).</p>\n<p>  this fetch is different from “req_ssl_sni” above in that it applies to the<br>  connection being deciphered by haproxy and not to ssl contents being blindly<br>  forwarded. see also “ssl_fc_sni_end” and “ssl_fc_sni_reg” below. this<br>  requires that the ssl library is build with support for tls extensions<br>  enabled (check haproxy -vv).</p>\n<p>  acl derivatives :<br>    ssl_fc_sni_end : suffix match<br>    ssl_fc_sni_reg : regex match</p>\n<p>ssl_fc_use_keysize : integer<br>  returns the symmetric cipher key size used in bits when the incoming<br>  connection was made over an ssl/tls transport layer.</p>\n<h2 id=\"7-3-5-fetching-samples-from-buffer-contents-layer-6\"><a href=\"#7-3-5-fetching-samples-from-buffer-contents-layer-6\" class=\"headerlink\" title=\"7.3.5. fetching samples from buffer contents (layer 6)\"></a>7.3.5. fetching samples from buffer contents (layer 6)</h2><p>fetching samples from buffer contents is a bit different from the previous<br>sample fetches above because the sampled data are ephemeral. these data can<br>only be used when they’re available and will be lost when they’re forwarded.<br>for this reason, samples fetched from buffer contents during a request cannot<br>be used in a response for example. even while the data are being fetched, they<br>can change. sometimes it is necessary to set some delays or combine multiple<br>sample fetch methods to ensure that the expected data are complete and usable,<br>for example through tcp request content inspection. please see the “tcp-request<br>content” keyword for more detailed information on the subject.</p>\n<p>payload(<offset>,<length>) : binary (deprecated)<br>  this is an alias for “req.payload” when used in the context of a request (eg:<br>  “stick on”, “stick match”), and for “res.payload” when used in the context of<br>  a response such as in “stick store response”.</length></offset></p>\n<p>payload_lv(<offset1>,<length>[,<offset2>]) : binary (deprecated)<br>  this is an alias for “req.payload_lv” when used in the context of a request<br>  (eg: “stick on”, “stick match”), and for “res.payload_lv” when used in the<br>  context of a response such as in “stick store response”.</offset2></length></offset1></p>\n<p>req.len : integer<br>req_len : integer (deprecated)<br>  returns an integer value corresponding to the number of bytes present in the<br>  request buffer. this is mostly used in acl. it is important to understand<br>  that this test does not return false as long as the buffer is changing. this<br>  means that a check with equality to zero will almost always immediately match<br>  at the beginning of the session, while a test for more data will wait for<br>  that data to come in and return false only when haproxy is certain that no<br>  more data will come in. this test was designed to be used with tcp request<br>  content inspection.</p>\n<p>req.payload(<offset>,<length>) : binary<br>  this extracts a binary block of <length> bytes and starting at byte <offset><br>  in the request buffer. as a special case, if the <length> argument is zero,<br>  the the whole buffer from <offset> to the end is extracted. this can be used<br>  with acls in order to check for the presence of some content in a buffer at<br>  any location.</offset></length></offset></length></length></offset></p>\n<p>  acl alternatives :<br>    payload(<offset>,<length>) : hex binary match</length></offset></p>\n<p>req.payload_lv(<offset1>,<length>[,<offset2>]) : binary<br>  this extracts a binary block whose size is specified at <offset1> for <length><br>  bytes, and which starts at <offset2> if specified or just after the length in<br>  the request buffer. the <offset2> parameter also supports relative offsets if<br>  prepended with a ‘+’ or ‘-‘ sign.</offset2></offset2></length></offset1></offset2></length></offset1></p>\n<p>  acl alternatives :<br>    payload_lv(<offset1>,<length>[,<offset2>]) : hex binary match</offset2></length></offset1></p>\n<p>  example : please consult the example from the “stick store-response” keyword.</p>\n<p>req.proto_http : boolean<br>req_proto_http : boolean (deprecated)<br>  returns true when data in the request buffer look like http and correctly<br>  parses as such. it is the same parser as the common http request parser which<br>  is used so there should be no surprises. the test does not match until the<br>  request is complete, failed or timed out. this test may be used to report the<br>  protocol in tcp logs, but the biggest use is to block tcp request analysis<br>  until a complete http request is present in the buffer, for example to track<br>  a header.</p>\n<p>  example:</p>\n<pre><code># track request counts per &quot;base&quot; (concatenation of host+url)\ntcp-request inspect-delay 10s\ntcp-request content reject if !http\ntcp-request content track-sc0 base table req-rate\n</code></pre><p>req.rdp_cookie([<name>]) : string<br>rdp_cookie([<name>]) : string (deprecated)<br>  when the request buffer looks like the rdp protocol, extracts the rdp cookie<br>  <name>, or any cookie if unspecified. the parser only checks for the first<br>  cookie, as illustrated in the rdp protocol specification. the cookie name is<br>  case insensitive. generally the “msts” cookie name will be used, as it can<br>  contain the user name of the client connecting to the server if properly<br>  configured on the client. the “mstshash” cookie is often used as well for<br>  session stickiness to servers.</name></name></name></p>\n<p>  this differs from “balance rdp-cookie” in that any balancing algorithm may be<br>  used and thus the distribution of clients to backend servers is not linked to<br>  a hash of the rdp cookie. it is envisaged that using a balancing algorithm<br>  such as “balance roundrobin” or “balance leastconn” will lead to a more even<br>  distribution of clients to backend servers than the hash used by “balance<br>  rdp-cookie”.</p>\n<p>  acl derivatives :<br>    req_rdp_cookie([<name>]) : exact string match</name></p>\n<p>  example :<br>   listen tse-farm<br>       bind 0.0.0.0:3389</p>\n<pre><code># wait up to 5s for an rdp cookie in the request\ntcp-request inspect-delay 5s\ntcp-request content accept if rdp_cookie\n# apply rdp cookie persistence\npersist rdp-cookie\n# persist based on the mstshash cookie\n# this is only useful makes sense if\n# balance rdp-cookie is not used\nstick-table type string size 204800\nstick on req.rdp_cookie(mstshash)\nserver srv1 1.1.1.1:3389\nserver srv1 1.1.1.2:3389\n</code></pre><p>  see also : “balance rdp-cookie”, “persist rdp-cookie”, “tcp-request” and the<br>  “req_rdp_cookie” acl.</p>\n<p>req.rdp_cookie_cnt([name]) : integer<br>rdp_cookie_cnt([name]) : integer (deprecated)<br>  tries to parse the request buffer as rdp protocol, then returns an integer<br>  corresponding to the number of rdp cookies found. if an optional cookie name<br>  is passed, only cookies matching this name are considered. this is mostly<br>  used in acl.</p>\n<p>  acl derivatives :<br>    req_rdp_cookie_cnt([<name>]) : integer match</name></p>\n<p>req.ssl_ec_ext : boolean<br>  returns a boolean identifying if client sent the supported elliptic curves<br>  extension as defined in rfc4492, section 5.1. within the ssl clienthello<br>  message. this can be used to present ecc compatible clients with ec certificate<br>  and to use rsa for all others, on the same ip address. note that this only<br>  applies to raw contents found in the request buffer and not to contents<br>  deciphered via an ssl data layer, so this will not work with “bind” lines<br>  having the “ssl” option.</p>\n<p>req.ssl_hello_type : integer<br>req_ssl_hello_type : integer (deprecated)<br>  returns an integer value containing the type of the ssl hello message found<br>  in the request buffer if the buffer contains data that parse as a complete<br>  ssl (v3 or superior) client hello message. note that this only applies to raw<br>  contents found in the request buffer and not to contents deciphered via an<br>  ssl data layer, so this will not work with “bind” lines having the “ssl”<br>  option. this is mostly used in acl to detect presence of an ssl hello message<br>  that is supposed to contain an ssl session id usable for stickiness.</p>\n<p>req.ssl_sni : string<br>req_ssl_sni : string (deprecated)<br>  returns a string containing the value of the server name tls extension sent<br>  by a client in a tls stream passing through the request buffer if the buffer<br>  contains data that parse as a complete ssl (v3 or superior) client hello<br>  message. note that this only applies to raw contents found in the request<br>  buffer and not to contents deciphered via an ssl data layer, so this will not<br>  work with “bind” lines having the “ssl” option. sni normally contains the<br>  name of the host the client tries to connect to (for recent browsers). sni is<br>  useful for allowing or denying access to certain hosts when ssl/tls is used<br>  by the client. this test was designed to be used with tcp request content<br>  inspection. if content switching is needed, it is recommended to first wait<br>  for a complete client hello (type 1), like in the example below. see also<br>  “ssl_fc_sni”.</p>\n<p>  acl derivatives :<br>    req_ssl_sni : exact string match</p>\n<p>  examples :</p>\n<pre><code># wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req_ssl_hello_type 1 }\nuse_backend bk_allow if { req_ssl_sni -f allowed_sites }\ndefault_backend bk_sorry_page\n</code></pre><p>res.ssl_hello_type : integer<br>rep_ssl_hello_type : integer (deprecated)<br>  returns an integer value containing the type of the ssl hello message found<br>  in the response buffer if the buffer contains data that parses as a complete<br>  ssl (v3 or superior) hello message. note that this only applies to raw<br>  contents found in the response buffer and not to contents deciphered via an<br>  ssl data layer, so this will not work with “server” lines having the “ssl”<br>  option. this is mostly used in acl to detect presence of an ssl hello message<br>  that is supposed to contain an ssl session id usable for stickiness.</p>\n<p>req.ssl_ver : integer<br>req_ssl_ver : integer (deprecated)<br>  returns an integer value containing the version of the ssl/tls protocol of a<br>  stream present in the request buffer. both sslv2 hello messages and sslv3<br>  messages are supported. tlsv1 is announced as ssl version 3.1. the value is<br>  composed of the major version multiplied by 65536, added to the minor<br>  version. note that this only applies to raw contents found in the request<br>  buffer and not to contents deciphered via an ssl data layer, so this will not<br>  work with “bind” lines having the “ssl” option. the acl version of the test<br>  matches against a decimal notation in the form major.minor (eg: 3.1). this<br>  fetch is mostly used in acl.</p>\n<p>  acl derivatives :<br>    req_ssl_ver : decimal match</p>\n<p>res.len : integer<br>  returns an integer value corresponding to the number of bytes present in the<br>  response buffer. this is mostly used in acl. it is important to understand<br>  that this test does not return false as long as the buffer is changing. this<br>  means that a check with equality to zero will almost always immediately match<br>  at the beginning of the session, while a test for more data will wait for<br>  that data to come in and return false only when haproxy is certain that no<br>  more data will come in. this test was designed to be used with tcp response<br>  content inspection.</p>\n<p>res.payload(<offset>,<length>) : binary<br>  this extracts a binary block of <length> bytes and starting at byte <offset><br>  in the response buffer. as a special case, if the <length> argument is zero,<br>  the the whole buffer from <offset> to the end is extracted. this can be used<br>  with acls in order to check for the presence of some content in a buffer at<br>  any location.</offset></length></offset></length></length></offset></p>\n<p>res.payload_lv(<offset1>,<length>[,<offset2>]) : binary<br>  this extracts a binary block whose size is specified at <offset1> for <length><br>  bytes, and which starts at <offset2> if specified or just after the length in<br>  the response buffer. the <offset2> parameter also supports relative offsets<br>  if prepended with a ‘+’ or ‘-‘ sign.</offset2></offset2></length></offset1></offset2></length></offset1></p>\n<p>  example : please consult the example from the “stick store-response” keyword.</p>\n<p>wait_end : boolean<br>  this fetch either returns true when the inspection period is over, or does<br>  not fetch. it is only used in acls, in conjunction with content analysis to<br>  avoid returning a wrong verdict early.  it may also be used to delay some<br>  actions, such as a delayed reject for some special addresses. since it either<br>  stops the rules evaluation or immediately returns true, it is recommended to<br>  use this acl as the last one in a rule.  please note that the default acl<br>  “wait_end” is always usable without prior declaration. this test was designed<br>  to be used with tcp request content inspection.</p>\n<p>  examples :</p>\n<pre><code># delay every incoming request by 2 seconds\ntcp-request inspect-delay 2s\ntcp-request content accept if wait_end\n\n# don&apos;t immediately tell bad guys they are rejected\ntcp-request inspect-delay 10s\nacl goodguys src 10.0.0.0/24\nacl badguys  src 10.0.1.0/24\ntcp-request content accept if goodguys\ntcp-request content reject if badguys wait_end\ntcp-request content reject\n</code></pre><h2 id=\"7-3-6-fetching-http-samples-layer-7\"><a href=\"#7-3-6-fetching-http-samples-layer-7\" class=\"headerlink\" title=\"7.3.6. fetching http samples (layer 7)\"></a>7.3.6. fetching http samples (layer 7)</h2><p>it is possible to fetch samples from http contents, requests and responses.<br>this application layer is also called layer 7. it is only possible to fetch the<br>data in this section when a full http request or response has been parsed from<br>its respective request or response buffer. this is always the case with all<br>http specific rules and for sections running with “mode http”. when using tcp<br>content inspection, it may be necessary to support an inspection delay in order<br>to let the request or response come in first. these fetches may require a bit<br>more cpu resources than the layer 4 ones, but not much since the request and<br>response are indexed.</p>\n<p>base : string<br>  this returns the concatenation of the first host header and the path part of<br>  the request, which starts at the first slash and ends before the question<br>  mark. it can be useful in virtual hosted environments to detect url abuses as<br>  well as to improve shared caches efficiency. using this with a limited size<br>  stick table also allows one to collect statistics about most commonly<br>  requested objects by host/path. with acls it can allow simple content<br>  switching rules involving the host and the path at the same time, such as<br>  “www.example.com/favicon.ico”. see also “path” and “uri”.</p>\n<p>  acl derivatives :<br>    base     : exact string match<br>    base_beg : prefix match<br>    base_dir : subdir match<br>    base_dom : domain match<br>    base_end : suffix match<br>    base_len : length match<br>    base_reg : regex match<br>    base_sub : substring match</p>\n<p>base32 : integer<br>  this returns a 32-bit hash of the value returned by the “base” fetch method<br>  above. this is useful to track per-url activity on high traffic sites without<br>  having to store all urls. instead a shorter hash is stored, saving a lot of<br>  memory. the output type is an unsigned integer. the hash function used is<br>  sdbm with full avalanche on the output. technically, base32 is exactly equal<br>  to “base,sdbm(1)”.</p>\n<p>base32+src : binary<br>  this returns the concatenation of the base32 fetch above and the src fetch<br>  below. the resulting type is of type binary, with a size of 8 or 20 bytes<br>  depending on the source address family. this can be used to track per-ip,<br>  per-url counters.</p>\n<p>capture.req.hdr(<idx>) : string<br>  this extracts the content of the header captured by the “capture request<br>  header”, idx is the position of the capture keyword in the configuration.<br>  the first entry is an index of 0. see also: “capture request header”.</idx></p>\n<p>capture.req.method : string<br>  this extracts the method of an http request. it can be used in both request<br>  and response. unlike “method”, it can be used in both request and response<br>  because it’s allocated.</p>\n<p>capture.req.uri : string<br>  this extracts the request’s uri, which starts at the first slash and ends<br>  before the first space in the request (without the host part). unlike “path”<br>  and “url”, it can be used in both request and response because it’s<br>  allocated.</p>\n<p>capture.req.ver : string<br>  this extracts the request’s http version and returns either “http/1.0” or<br>  “http/1.1”. unlike “req.ver”, it can be used in both request, response, and<br>  logs because it relies on a persistent flag.</p>\n<p>capture.res.hdr(<idx>) : string<br>  this extracts the content of the header captured by the “capture response<br>  header”, idx is the position of the capture keyword in the configuration.<br>  the first entry is an index of 0.<br>  see also: “capture response header”</idx></p>\n<p>capture.res.ver : string<br>  this extracts the response’s http version and returns either “http/1.0” or<br>  “http/1.1”. unlike “res.ver”, it can be used in logs because it relies on a<br>  persistent flag.</p>\n<p>req.body : binary<br>  this returns the http request’s available body as a block of data. it<br>  requires that the request body has been buffered made available using<br>  “option http-buffer-request”. in case of chunked-encoded body, currently only<br>  the first chunk is analyzed.</p>\n<p>req.body_param([<name>) : string<br>  this fetch assumes that the body of the post request is url-encoded. the user<br>  can check if the “content-type” contains the value<br>  “application/x-www-form-urlencoded”. this extracts the first occurrence of the<br>  parameter <name> in the body, which ends before ‘&amp;’. the parameter name is<br>  case-sensitive. if no name is given, any parameter will match, and the first<br>  one will be returned. the result is a string corresponding to the value of the<br>  parameter <name> as presented in the request body (no url decoding is<br>  performed). note that the acl version of this fetch iterates over multiple<br>  parameters and will iteratively report all parameters values if no name is<br>  given.</name></name></name></p>\n<p>req.body_len : integer<br>  this returns the length of the http request’s available body in bytes. it may<br>  be lower than the advertised length if the body is larger than the buffer. it<br>  requires that the request body has been buffered made available using<br>  “option http-buffer-request”.</p>\n<p>req.body_size : integer<br>  this returns the advertised length of the http request’s body in bytes. it<br>  will represent the advertised content-length header, or the size of the first<br>  chunk in case of chunked encoding. in order to parse the chunks, it requires<br>  that the request body has been buffered made available using<br>  “option http-buffer-request”.</p>\n<p>req.cook([<name>]) : string<br>cook([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, and returns its value as string. if no name is<br>  specified, the first cookie value is returned. when used with acls, all<br>  matching cookies are evaluated. spaces around the name and the value are<br>  ignored as requested by the cookie header specification (rfc6265). the cookie<br>  name is case-sensitive. empty cookies are valid, so an empty cookie may very<br>  well return an empty value if it is present. use the “found” match to detect<br>  presence. use the res.cook() variant for response cookies sent by the server.</name></name></name></p>\n<p>  acl derivatives :<br>    cook([<name>])     : exact string match<br>    cook_beg([<name>]) : prefix match<br>    cook_dir([<name>]) : subdir match<br>    cook_dom([<name>]) : domain match<br>    cook_end([<name>]) : suffix match<br>    cook_len([<name>]) : length match<br>    cook_reg([<name>]) : regex match<br>    cook_sub([<name>]) : substring match</name></name></name></name></name></name></name></name></p>\n<p>req.cook_cnt([<name>]) : integer<br>cook_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of the cookie<br>  <name> in the request, or all cookies if <name> is not specified.</name></name></name></name></p>\n<p>req.cook_val([<name>]) : integer<br>cook_val([<name>]) : integer (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, and converts its value to an integer which is<br>  returned. if no name is specified, the first cookie value is returned. when<br>  used in acls, all matching names are iterated over until a value matches.</name></name></name></p>\n<p>cookie([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, or a “set-cookie” header from the response, and<br>  returns its value as a string. a typical use is to get multiple clients<br>  sharing a same profile use the same server. this can be similar to what<br>  “appsession” does with the “request-learn” statement, but with support for<br>  multi-peer synchronization and state keeping across restarts. if no name is<br>  specified, the first cookie value is returned. this fetch should not be used<br>  anymore and should be replaced by req.cook() or res.cook() instead as it<br>  ambiguously uses the direction based on the context where it is used.<br>  see also : “appsession”.</name></name></p>\n<p>hdr([<name>[,<occ>]]) : string<br>  this is equivalent to req.hdr() when used on requests, and to res.hdr() when<br>  used on responses. please refer to these respective fetches for more details.<br>  in case of doubt about the fetch direction, please use the explicit ones.<br>  note that contrary to the hdr() sample fetch method, the hdr_* acl keywords<br>  unambiguously apply to the request headers.</occ></name></p>\n<p>req.fhdr(<name>[,<occ>]) : string<br>  this extracts the last occurrence of header <name> in an http request. when<br>  used from an acl, all occurrences are iterated over until a match is found.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. it differs from req.hdr() in that any commas<br>  present in the value are returned and are not used as delimiters. this is<br>  sometimes useful with headers such as user-agent.</name></occ></name></p>\n<p>req.fhdr_cnt([<name>]) : integer<br>  returns an integer value representing the number of occurrences of request<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. contrary to its req.hdr_cnt() cousin, this function returns<br>  the number of full line headers and does not stop on commas.</name></name></name></p>\n<p>req.hdr([<name>[,<occ>]]) : string<br>  this extracts the last occurrence of header <name> in an http request. when<br>  used from an acl, all occurrences are iterated over until a match is found.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. a typical use is with the x-forwarded-for header<br>  once converted to ip, associated with an ip stick-table. the function<br>  considers any comma as a delimiter for distinct values. if full-line headers<br>  are desired instead, use req.fhdr(). please carefully check rfc2616 to know<br>  how certain headers are supposed to be parsed. also, some of them are case<br>  insensitive (eg: connection).</name></occ></name></p>\n<p>  acl derivatives :<br>    hdr([<name>[,<occ>]])     : exact string match<br>    hdr_beg([<name>[,<occ>]]) : prefix match<br>    hdr_dir([<name>[,<occ>]]) : subdir match<br>    hdr_dom([<name>[,<occ>]]) : domain match<br>    hdr_end([<name>[,<occ>]]) : suffix match<br>    hdr_len([<name>[,<occ>]]) : length match<br>    hdr_reg([<name>[,<occ>]]) : regex match<br>    hdr_sub([<name>[,<occ>]]) : substring match</occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></p>\n<p>req.hdr_cnt([<name>]) : integer<br>hdr_cnt([<header>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of request<br>  header field name <name>, or the total number of header field values if<br>  <name> is not specified. it is important to remember that one header line may<br>  count as several headers if it has several values. the function considers any<br>  comma as a delimiter for distinct values. if full-line headers are desired<br>  instead, req.fhdr_cnt() should be used instead. with acls, it can be used to<br>  detect presence, absence or abuse of a specific header, as well as to block<br>  request smuggling attacks by rejecting requests which contain more than one<br>  of certain headers. see “req.hdr” for more information on header matching.</name></name></header></name></p>\n<p>req.hdr_ip([<name>[,<occ>]]) : ip<br>hdr_ip([<name>[,<occ>]]) : ip (deprecated)<br>  this extracts the last occurrence of header <name> in an http request,<br>  converts it to an ipv4 or ipv6 address and returns this address. when used<br>  with acls, all occurrences are checked, and if <name> is omitted, every value<br>  of every header is checked. optionally, a specific occurrence might be<br>  specified as a position number. positive values indicate a position from the<br>  first occurrence, with 1 being the first one.  negative values indicate<br>  positions relative to the last one, with -1 being the last one. a typical use<br>  is with the x-forwarded-for and x-client-ip headers.</name></name></occ></name></occ></name></p>\n<p>req.hdr_val([<name>[,<occ>]]) : integer<br>hdr_val([<name>[,<occ>]]) : integer (deprecated)<br>  this extracts the last occurrence of header <name> in an http request, and<br>  converts it to an integer value. when used with acls, all occurrences are<br>  checked, and if <name> is omitted, every value of every header is checked.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. a typical use is with the x-forwarded-for header.</name></name></occ></name></occ></name></p>\n<p>http_auth(<userlist>) : boolean<br>  returns a boolean indicating whether the authentication data received from<br>  the client match a username &amp; password stored in the specified userlist. this<br>  fetch function is not really useful outside of acls. currently only http<br>  basic auth is supported.</userlist></p>\n<p>http_auth_group(<userlist>) : string<br>  returns a string corresponding to the user name found in the authentication<br>  data received from the client if both the user name and password are valid<br>  according to the specified userlist. the main purpose is to use it in acls<br>  where it is then checked whether the user belongs to any group within a list.<br>  this fetch function is not really useful outside of acls. currently only http<br>  basic auth is supported.</userlist></p>\n<p>  acl derivatives :<br>    http_auth_group(<userlist>) : group …<br>    returns true when the user extracted from the request and whose password is<br>    valid according to the specified userlist belongs to at least one of the<br>    groups.</userlist></p>\n<p>http_first_req : boolean<br>  returns true when the request being processed is the first one of the<br>  connection. this can be used to add or remove headers that may be missing<br>  from some requests when a request is not the first one, or to help grouping<br>  requests in the logs.</p>\n<p>method : integer + string<br>  returns an integer value corresponding to the method in the http request. for<br>  example, “get” equals 1 (check sources to establish the matching). value 9<br>  means “other method” and may be converted to a string extracted from the<br>  stream. this should not be used directly as a sample, this is only meant to<br>  be used from acls, which transparently convert methods from patterns to these<br>  integer + string values. some predefined acl already check for most common<br>  methods.</p>\n<p>  acl derivatives :<br>    method : case insensitive method match</p>\n<p>  example :</p>\n<pre><code># only accept get and head requests\nacl valid_method method get head\nhttp-request deny if ! valid_method\n</code></pre><p>path : string<br>  this extracts the request’s url path, which starts at the first slash and<br>  ends before the question mark (without the host part). a typical use is with<br>  prefetch-capable caches, and with portals which need to aggregate multiple<br>  information from databases and keep them in caches. note that with outgoing<br>  caches, it would be wiser to use “url” instead. with acls, it’s typically<br>  used to match exact file names (eg: “/login.php”), or directory parts using<br>  the derivative forms. see also the “url” and “base” fetch methods.</p>\n<p>  acl derivatives :<br>    path     : exact string match<br>    path_beg : prefix match<br>    path_dir : subdir match<br>    path_dom : domain match<br>    path_end : suffix match<br>    path_len : length match<br>    path_reg : regex match<br>    path_sub : substring match</p>\n<p>query : string<br>  this extracts the request’s query string, which starts after the first<br>  question mark. if no question mark is present, this fetch returns nothing. if<br>  a question mark is present but nothing follows, it returns an empty string.<br>  this means it’s possible to easily know whether a query string is present<br>  using the “found” matching method. this fetch is the completemnt of “path”<br>  which stops before the question mark.</p>\n<p>req.hdr_names([<delim>]) : string<br>  this builds a string made from the concatenation of all header names as they<br>  appear in the request when the rule is evaluated. the default delimiter is<br>  the comma (‘,’) but it may be overridden as an optional argument <delim>. in<br>  this case, only the first character of <delim> is considered.</delim></delim></delim></p>\n<p>req.ver : string<br>req_ver : string (deprecated)<br>  returns the version string from the http request, for example “1.1”. this can<br>  be useful for logs, but is mostly there for acl. some predefined acl already<br>  check for versions 1.0 and 1.1.</p>\n<p>  acl derivatives :<br>    req_ver : exact string match</p>\n<p>res.comp : boolean<br>  returns the boolean “true” value if the response has been compressed by<br>  haproxy, otherwise returns boolean “false”. this may be used to add<br>  information in the logs.</p>\n<p>res.comp_algo : string<br>  returns a string containing the name of the algorithm used if the response<br>  was compressed by haproxy, for example : “deflate”. this may be used to add<br>  some information in the logs.</p>\n<p>res.cook([<name>]) : string<br>scook([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response, and returns its value as string. if no name is<br>  specified, the first cookie value is returned.</name></name></name></p>\n<p>  acl derivatives :<br>    scook([<name>] : exact string match</name></p>\n<p>res.cook_cnt([<name>]) : integer<br>scook_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of the cookie<br>  <name> in the response, or all cookies if <name> is not specified. this is<br>  mostly useful when combined with acls to detect suspicious responses.</name></name></name></name></p>\n<p>res.cook_val([<name>]) : integer<br>scook_val([<name>]) : integer (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response, and converts its value to an integer which is<br>  returned. if no name is specified, the first cookie value is returned.</name></name></name></p>\n<p>res.fhdr([<name>[,<occ>]]) : string<br>  this extracts the last occurrence of header <name> in an http response, or of<br>  the last header if no <name> is specified. optionally, a specific occurrence<br>  might be specified as a position number. positive values indicate a position<br>  from the first occurrence, with 1 being the first one. negative values<br>  indicate positions relative to the last one, with -1 being the last one. it<br>  differs from res.hdr() in that any commas present in the value are returned<br>  and are not used as delimiters. if this is not desired, the res.hdr() fetch<br>  should be used instead. this is sometimes useful with headers such as date or<br>  expires.</name></name></occ></name></p>\n<p>res.fhdr_cnt([<name>]) : integer<br>  returns an integer value representing the number of occurrences of response<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. contrary to its res.hdr_cnt() cousin, this function returns<br>  the number of full line headers and does not stop on commas. if this is not<br>  desired, the res.hdr_cnt() fetch should be used instead.</name></name></name></p>\n<p>res.hdr([<name>[,<occ>]]) : string<br>shdr([<name>[,<occ>]]) : string (deprecated)<br>  this extracts the last occurrence of header <name> in an http response, or of<br>  the last header if no <name> is specified. optionally, a specific occurrence<br>  might be specified as a position number. positive values indicate a position<br>  from the first occurrence, with 1 being the first one. negative values<br>  indicate positions relative to the last one, with -1 being the last one. this<br>  can be useful to learn some data into a stick-table. the function considers<br>  any comma as a delimiter for distinct values. if this is not desired, the<br>  res.fhdr() fetch should be used instead.</name></name></occ></name></occ></name></p>\n<p>  acl derivatives :<br>    shdr([<name>[,<occ>]])     : exact string match<br>    shdr_beg([<name>[,<occ>]]) : prefix match<br>    shdr_dir([<name>[,<occ>]]) : subdir match<br>    shdr_dom([<name>[,<occ>]]) : domain match<br>    shdr_end([<name>[,<occ>]]) : suffix match<br>    shdr_len([<name>[,<occ>]]) : length match<br>    shdr_reg([<name>[,<occ>]]) : regex match<br>    shdr_sub([<name>[,<occ>]]) : substring match</occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></occ></name></p>\n<p>res.hdr_cnt([<name>]) : integer<br>shdr_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of response<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. the function considers any comma as a delimiter for distinct<br>  values. if this is not desired, the res.fhdr_cnt() fetch should be used<br>  instead.</name></name></name></name></p>\n<p>res.hdr_ip([<name>[,<occ>]]) : ip<br>shdr_ip([<name>[,<occ>]]) : ip (deprecated)<br>  this extracts the last occurrence of header <name> in an http response,<br>  convert it to an ipv4 or ipv6 address and returns this address. optionally, a<br>  specific occurrence might be specified as a position number. positive values<br>  indicate a position from the first occurrence, with 1 being the first one.<br>  negative values indicate positions relative to the last one, with -1 being<br>  the last one. this can be useful to learn some data into a stick table.</name></occ></name></occ></name></p>\n<p>res.hdr_names([<delim>]) : string<br>  this builds a string made from the concatenation of all header names as they<br>  appear in the response when the rule is evaluated. the default delimiter is<br>  the comma (‘,’) but it may be overridden as an optional argument <delim>. in<br>  this case, only the first character of <delim> is considered.</delim></delim></delim></p>\n<p>res.hdr_val([<name>[,<occ>]]) : integer<br>shdr_val([<name>[,<occ>]]) : integer (deprecated)<br>  this extracts the last occurrence of header <name> in an http response, and<br>  converts it to an integer value. optionally, a specific occurrence might be<br>  specified as a position number. positive values indicate a position from the<br>  first occurrence, with 1 being the first one. negative values indicate<br>  positions relative to the last one, with -1 being the last one. this can be<br>  useful to learn some data into a stick table.</name></occ></name></occ></name></p>\n<p>res.ver : string<br>resp_ver : string (deprecated)<br>  returns the version string from the http response, for example “1.1”. this<br>  can be useful for logs, but is mostly there for acl.</p>\n<p>  acl derivatives :<br>    resp_ver : exact string match</p>\n<p>set-cookie([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response and uses the corresponding value to match. this<br>  can be comparable to what “appsession” does with default options, but with<br>  support for multi-peer synchronization and state keeping across restarts.</name></name></p>\n<p>  this fetch function is deprecated and has been superseded by the “res.cook”<br>  fetch. this keyword will disappear soon.</p>\n<p>  see also : “appsession”</p>\n<p>status : integer<br>  returns an integer containing the http status code in the http response, for<br>  example, 302. it is mostly used within acls and integer ranges, for example,<br>  to remove any location header if the response is not a 3xx.</p>\n<p>url : string<br>  this extracts the request’s url as presented in the request. a typical use is<br>  with prefetch-capable caches, and with portals which need to aggregate<br>  multiple information from databases and keep them in caches. with acls, using<br>  “path” is preferred over using “url”, because clients may send a full url as<br>  is normally done with proxies. the only real use is to match “*” which does<br>  not match in “path”, and for which there is already a predefined acl. see<br>  also “path” and “base”.</p>\n<p>  acl derivatives :<br>    url     : exact string match<br>    url_beg : prefix match<br>    url_dir : subdir match<br>    url_dom : domain match<br>    url_end : suffix match<br>    url_len : length match<br>    url_reg : regex match<br>    url_sub : substring match</p>\n<p>url_ip : ip<br>  this extracts the ip address from the request’s url when the host part is<br>  presented as an ip address. its use is very limited. for instance, a<br>  monitoring system might use this field as an alternative for the source ip in<br>  order to test what path a given source address would follow, or to force an<br>  entry in a table for a given source address. with acls it can be used to<br>  restrict access to certain systems through a proxy, for example when combined<br>  with option “http_proxy”.</p>\n<p>url_port : integer<br>  this extracts the port part from the request’s url. note that if the port is<br>  not specified in the request, port 80 is assumed. with acls it can be used to<br>  restrict access to certain systems through a proxy, for example when combined<br>  with option “http_proxy”.</p>\n<p>urlp([<name>[,<delim>]]) : string<br>url_param([<name>[,<delim>]]) : string<br>  this extracts the first occurrence of the parameter <name> in the query<br>  string, which begins after either ‘?’ or <delim>, and which ends before ‘&amp;’,<br>  ‘;’ or <delim>. the parameter name is case-sensitive. if no name is given,<br>  any parameter will match, and the first one will be returned. the result is<br>  a string corresponding to the value of the parameter <name> as presented in<br>  the request (no url decoding is performed). this can be used for session<br>  stickiness based on a client id, to extract an application cookie passed as a<br>  url parameter, or in acls to apply some checks. note that the acl version of<br>  this fetch iterates over multiple parameters and will iteratively report all<br>  parameters values if no name is given</name></delim></delim></name></delim></name></delim></name></p>\n<p>  acl derivatives :<br>    urlp(<name>[,<delim>])     : exact string match<br>    urlp_beg(<name>[,<delim>]) : prefix match<br>    urlp_dir(<name>[,<delim>]) : subdir match<br>    urlp_dom(<name>[,<delim>]) : domain match<br>    urlp_end(<name>[,<delim>]) : suffix match<br>    urlp_len(<name>[,<delim>]) : length match<br>    urlp_reg(<name>[,<delim>]) : regex match<br>    urlp_sub(<name>[,<delim>]) : substring match</delim></name></delim></name></delim></name></delim></name></delim></name></delim></name></delim></name></delim></name></p>\n<p>  example :</p>\n<pre><code># match http://example.com/foo?phpsessionid=some_id\nstick on urlp(phpsessionid)\n# match http://example.com/foo;jsessionid=some_id\nstick on urlp(jsessionid,;)\n</code></pre><p>urlp_val([<name>[,<delim>])] : integer<br>  see “urlp” above. this one extracts the url parameter <name> in the request<br>  and converts it to an integer value. this can be used for session stickiness<br>  based on a user id for example, or with acls to match a page number or price.</name></delim></name></p>\n<h2 id=\"7-4-pre-defined-acls\"><a href=\"#7-4-pre-defined-acls\" class=\"headerlink\" title=\"7.4. pre-defined acls\"></a>7.4. pre-defined acls</h2><p>some predefined acls are hard-coded so that they do not have to be declared in<br>every frontend which needs them. they all have their names in upper case in<br>order to avoid confusion. their equivalence is provided below.</p>\n<p>acl name          equivalent to                usage<br>—————+—————————–+———————————<br>false            always_false                  never match<br>http             req_proto_http                match if protocol is valid http<br>http_1.0         req_ver 1.0                   match http version 1.0<br>http_1.1         req_ver 1.1                   match http version 1.1<br>http_content     hdr_val(content-length) gt 0  match an existing content-length<br>http_url_abs     url_reg ^[^/:]<em>://            match absolute url with scheme<br>http_url_slash   url_beg /                     match url beginning with “/“<br>http_url_star    url     </em>                     match url equal to “*”<br>localhost        src 127.0.0.1/8               match connection from local host<br>meth_connect     method  connect               match http connect method<br>meth_get         method  get head              match http get or head method<br>meth_head        method  head                  match http head method<br>meth_options     method  options               match http options method<br>meth_post        method  post                  match http post method<br>meth_trace       method  trace                 match http trace method<br>rdp_cookie       req_rdp_cookie_cnt gt 0       match presence of an rdp cookie<br>req_content      req_len gt 0                  match data in the request buffer<br>true             always_true                   always match<br>wait_end         wait_end                      wait for end of content analysis<br>—————+—————————–+———————————</p>\n<h2 id=\"8-logging\"><a href=\"#8-logging\" class=\"headerlink\" title=\"8. logging\"></a>8. logging</h2><p>one of haproxy’s strong points certainly lies is its precise logs. it probably<br>provides the finest level of information available for such a product, which is<br>very important for troubleshooting complex environments. standard information<br>provided in logs include client ports, tcp/http state timers, precise session<br>state at termination and precise termination cause, information about decisions<br>to direct traffic to a server, and of course the ability to capture arbitrary<br>headers.</p>\n<p>in order to improve administrators reactivity, it offers a great transparency<br>about encountered problems, both internal and external, and it is possible to<br>send logs to different sources at the same time with different level filters :</p>\n<ul>\n<li>global process-level logs (system errors, start/stop, etc..)</li>\n<li>per-instance system and internal errors (lack of resource, bugs, …)</li>\n<li>per-instance external troubles (servers up/down, max connections)</li>\n<li>per-instance activity (client connections), either at the establishment or<br>at the termination.</li>\n<li>per-request control of log-level, eg:<pre><code>http-request set-log-level silent if sensitive_request\n</code></pre></li>\n</ul>\n<p>the ability to distribute different levels of logs to different log servers<br>allow several production teams to interact and to fix their problems as soon<br>as possible. for example, the system team might monitor system-wide errors,<br>while the application team might be monitoring the up/down for their servers in<br>real time, and the security team might analyze the activity logs with one hour<br>delay.</p>\n<h2 id=\"8-1-log-levels\"><a href=\"#8-1-log-levels\" class=\"headerlink\" title=\"8.1. log levels\"></a>8.1. log levels</h2><p>tcp and http connections can be logged with information such as the date, time,<br>source ip address, destination address, connection duration, response times,<br>http request, http return code, number of bytes transmitted, conditions<br>in which the session ended, and even exchanged cookies values. for example<br>track a particular user’s problems. all messages may be sent to up to two<br>syslog servers. check the “log” keyword in section 4.2 for more information<br>about log facilities.</p>\n<h2 id=\"8-2-log-formats\"><a href=\"#8-2-log-formats\" class=\"headerlink\" title=\"8.2. log formats\"></a>8.2. log formats</h2><p>haproxy supports 5 log formats. several fields are common between these formats<br>and will be detailed in the following sections. a few of them may vary<br>slightly with the configuration, due to indicators specific to certain<br>options. the supported formats are as follows :</p>\n<ul>\n<li><p>the default format, which is very basic and very rarely used. it only<br>provides very basic information about the incoming connection at the moment<br>it is accepted : source ip:port, destination ip:port, and frontend-name.<br>this mode will eventually disappear so it will not be described to great<br>extents.</p>\n</li>\n<li><p>the tcp format, which is more advanced. this format is enabled when “option<br>tcplog” is set on the frontend. haproxy will then usually wait for the<br>connection to terminate before logging. this format provides much richer<br>information, such as timers, connection counts, queue size, etc… this<br>format is recommended for pure tcp proxies.</p>\n</li>\n<li><p>the http format, which is the most advanced for http proxying. this format<br>is enabled when “option httplog” is set on the frontend. it provides the<br>same information as the tcp format with some http-specific fields such as<br>the request, the status code, and captures of headers and cookies. this<br>format is recommended for http proxies.</p>\n</li>\n<li><p>the clf http format, which is equivalent to the http format, but with the<br>fields arranged in the same order as the clf format. in this mode, all<br>timers, captures, flags, etc… appear one per field after the end of the<br>common fields, in the same order they appear in the standard http format.</p>\n</li>\n<li><p>the custom log format, allows you to make your own log line.</p>\n</li>\n</ul>\n<p>next sections will go deeper into details for each of these formats. format<br>specification will be performed on a “field” basis. unless stated otherwise, a<br>field is a portion of text delimited by any number of spaces. since syslog<br>servers are susceptible of inserting fields at the beginning of a line, it is<br>always assumed that the first field is the one containing the process name and<br>identifier.</p>\n<p>note : since log lines may be quite long, the log examples in sections below<br>       might be broken into multiple lines. the example log lines will be<br>       prefixed with 3 closing angle brackets (‘&gt;&gt;&gt;’) and each time a log is<br>       broken into multiple lines, each non-final line will end with a<br>       backslash (‘\\’) and the next line will start indented by two characters.</p>\n<h2 id=\"8-2-1-default-log-format\"><a href=\"#8-2-1-default-log-format\" class=\"headerlink\" title=\"8.2.1. default log format\"></a>8.2.1. default log format</h2><p>this format is used when no specific option is set. the log is emitted as soon<br>as the connection is accepted. one should note that this currently is the only<br>format which logs the request’s destination ip and ports.</p>\n<p>  example :<br>        listen www<br>            mode http<br>            log global<br>            server srv1 127.0.0.1:8000</p>\n<pre><code>&gt;&gt;&gt; feb  6 12:12:09 localhost \\\n      haproxy[14385]: connect from 10.0.1.2:33312 to 10.0.3.31:8012 \\\n      (www/http)\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14385]:<br>      2   ‘connect from’                                          connect from<br>      3   source_ip ‘:’ source_port                             10.0.1.2:33312<br>      4   ‘to’                                                              to<br>      5   destination_ip ‘:’ destination_port                   10.0.3.31:8012<br>      6   ‘(‘ frontend_name ‘/‘ mode ‘)’                            (www/http)</p>\n<p>detailed fields description :</p>\n<ul>\n<li>“source_ip” is the ip address of the client which initiated the connection.</li>\n<li>“source_port” is the tcp port of the client which initiated the connection.</li>\n<li>“destination_ip” is the ip address the client connected to.</li>\n<li>“destination_port” is the tcp port the client connected to.</li>\n<li>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</li>\n<li>“mode is the mode the frontend is operating (tcp or http).</li>\n</ul>\n<p>in case of a unix socket, the source and destination addresses are marked as<br>“unix:” and the ports reflect the internal id of the socket which accepted the<br>connection (the same id as reported in the stats).</p>\n<p>it is advised not to use this deprecated format for newer installations as it<br>will eventually disappear.</p>\n<h2 id=\"8-2-2-tcp-log-format\"><a href=\"#8-2-2-tcp-log-format\" class=\"headerlink\" title=\"8.2.2. tcp log format\"></a>8.2.2. tcp log format</h2><p>the tcp format is used when “option tcplog” is specified in the frontend, and<br>is the recommended format for pure tcp proxies. it provides a lot of precious<br>information for troubleshooting. since this format includes timers and byte<br>counts, the log is normally emitted at the end of the session. it can be<br>emitted earlier if “option logasap” is specified, which makes sense in most<br>environments with long sessions such as remote terminals. sessions which match<br>the “monitor” rules are never logged. it is also possible not to emit logs for<br>sessions for which no data were exchanged between the client and the server, by<br>specifying “option dontlognull” in the frontend. successful connections will<br>not be logged if “option dontlog-normal” is specified in the frontend. a few<br>fields may slightly vary depending on some configuration options, those are<br>marked with a star (‘*’) after the field name below.</p>\n<p>  example :<br>        frontend fnt<br>            mode tcp<br>            option tcplog<br>            log global<br>            default_backend bck</p>\n<pre><code>    backend bck\n        server srv1 127.0.0.1:8000\n\n&gt;&gt;&gt; feb  6 12:12:56 localhost \\\n      haproxy[14387]: 10.0.1.2:33313 [06/feb/2009:12:12:51.443] fnt \\\n      bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14387]:<br>      2   client_ip ‘:’ client_port                             10.0.1.2:33313<br>      3   ‘[‘ accept_date ‘]’                       [06/feb/2009:12:12:51.443]<br>      4   frontend_name                                                    fnt<br>      5   backend_name ‘/‘ server_name                                bck/srv1<br>      6   tw ‘/‘ tc ‘/‘ tt<em>                                           0/0/5007<br>      7   bytes_read</em>                                                      212<br>      8   termination_state                                                 –<br>      9   actconn ‘/‘ feconn ‘/‘ beconn ‘/‘ srv_conn ‘/‘ retries*    0/0/0/0/3<br>     10   srv_queue ‘/‘ backend_queue                                      0/0</p>\n<p>detailed fields description :</p>\n<ul>\n<li><p>“client_ip” is the ip address of the client which initiated the tcp<br>connection to haproxy. if the connection was accepted on a unix socket<br>instead, the ip address would be replaced with the word “unix”. note that<br>when the connection is accepted on a socket configured with “accept-proxy”<br>and the proxy protocol is correctly used, then the logs will reflect the<br>forwarded connection’s information.</p>\n</li>\n<li><p>“client_port” is the tcp port of the client which initiated the connection.<br>if the connection was accepted on a unix socket instead, the port would be<br>replaced with the id of the accepting socket, which is also reported in the<br>stats interface.</p>\n</li>\n<li><p>“accept_date” is the exact date when the connection was received by haproxy<br>(which might be very slightly different from the date observed on the<br>network if there was some queuing in the system’s backlog). this is usually<br>the same date which may appear in any upstream firewall’s log.</p>\n</li>\n<li><p>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</p>\n</li>\n<li><p>“backend_name” is the name of the backend (or listener) which was selected<br>to manage the connection to the server. this will be the same as the<br>frontend if no switching rule has been applied, which is common for tcp<br>applications.</p>\n</li>\n<li><p>“server_name” is the name of the last server to which the connection was<br>sent, which might differ from the first one if there were connection errors<br>and a redispatch occurred. note that this server belongs to the backend<br>which processed the request. if the connection was aborted before reaching<br>a server, “<nosrv>“ is indicated instead of a server name.</nosrv></p>\n</li>\n<li><p>“tw” is the total time in milliseconds spent waiting in the various queues.<br>it can be “-1” if the connection was aborted before reaching the queue.<br>see “timers” below for more details.</p>\n</li>\n<li><p>“tc” is the total time in milliseconds spent waiting for the connection to<br>establish to the final server, including retries. it can be “-1” if the<br>connection was aborted before a connection could be established. see<br>“timers” below for more details.</p>\n</li>\n<li><p>“tt” is the total time in milliseconds elapsed between the accept and the<br>last close. it covers all possible processing. there is one exception, if<br>“option logasap” was specified, then the time counting stops at the moment<br>the log is emitted. in this case, a ‘+’ sign is prepended before the value,<br>indicating that the final one will be larger. see “timers” below for more<br>details.</p>\n</li>\n<li><p>“bytes_read” is the total number of bytes transmitted from the server to<br>the client when the log is emitted. if “option logasap” is specified, the<br>this value will be prefixed with a ‘+’ sign indicating that the final one<br>may be larger. please note that this value is a 64-bit counter, so log<br>analysis tools must be able to handle it without overflowing.</p>\n</li>\n<li><p>“termination_state” is the condition the session was in when the session<br>ended. this indicates the session state, which side caused the end of<br>session to happen, and for what reason (timeout, error, …). the normal<br>flags should be “–”, indicating the session was closed by either end with<br>no data remaining in buffers. see below “session state at disconnection”<br>for more details.</p>\n</li>\n<li><p>“actconn” is the total number of concurrent connections on the process when<br>the session was logged. it is useful to detect when some per-process system<br>limits have been reached. for instance, if actconn is close to 512 when<br>multiple connection errors occur, chances are high that the system limits<br>the process to use a maximum of 1024 file descriptors and that all of them<br>are used. see section 3 “global parameters” to find how to tune the system.</p>\n</li>\n<li><p>“feconn” is the total number of concurrent connections on the frontend when<br>the session was logged. it is useful to estimate the amount of resource<br>required to sustain high loads, and to detect when the frontend’s “maxconn”<br>has been reached. most often when this value increases by huge jumps, it is<br>because there is congestion on the backend servers, but sometimes it can be<br>caused by a denial of service attack.</p>\n</li>\n<li><p>“beconn” is the total number of concurrent connections handled by the<br>backend when the session was logged. it includes the total number of<br>concurrent connections active on servers as well as the number of<br>connections pending in queues. it is useful to estimate the amount of<br>additional servers needed to support high loads for a given application.<br>most often when this value increases by huge jumps, it is because there is<br>congestion on the backend servers, but sometimes it can be caused by a<br>denial of service attack.</p>\n</li>\n<li><p>“srv_conn” is the total number of concurrent connections still active on<br>the server when the session was logged. it can never exceed the server’s<br>configured “maxconn” parameter. if this value is very often close or equal<br>to the server’s “maxconn”, it means that traffic regulation is involved a<br>lot, meaning that either the server’s maxconn value is too low, or that<br>there aren’t enough servers to process the load with an optimal response<br>time. when only one of the server’s “srv_conn” is high, it usually means<br>that this server has some trouble causing the connections to take longer to<br>be processed than on other servers.</p>\n</li>\n<li><p>“retries” is the number of connection retries experienced by this session<br>when trying to connect to the server. it must normally be zero, unless a<br>server is being stopped at the same moment the connection was attempted.<br>frequent retries generally indicate either a network problem between<br>haproxy and the server, or a misconfigured system backlog on the server<br>preventing new connections from being queued. this field may optionally be<br>prefixed with a ‘+’ sign, indicating that the session has experienced a<br>redispatch after the maximal retry count has been reached on the initial<br>server. in this case, the server name appearing in the log is the one the<br>connection was redispatched to, and not the first one, though both may<br>sometimes be the same in case of hashing for instance. so as a general rule<br>of thumb, when a ‘+’ is present in front of the retry count, this count<br>should not be attributed to the logged server.</p>\n</li>\n<li><p>“srv_queue” is the total number of requests which were processed before<br>this one in the server queue. it is zero when the request has not gone<br>through the server queue. it makes it possible to estimate the approximate<br>server’s response time by dividing the time spent in queue by the number of<br>requests in the queue. it is worth noting that if a session experiences a<br>redispatch and passes through two server queues, their positions will be<br>cumulated. a request should not pass through both the server queue and the<br>backend queue unless a redispatch occurs.</p>\n</li>\n<li><p>“backend_queue” is the total number of requests which were processed before<br>this one in the backend’s global queue. it is zero when the request has not<br>gone through the global queue. it makes it possible to estimate the average<br>queue length, which easily translates into a number of missing servers when<br>divided by a server’s “maxconn” parameter. it is worth noting that if a<br>session experiences a redispatch, it may pass twice in the backend’s queue,<br>and then both positions will be cumulated. a request should not pass<br>through both the server queue and the backend queue unless a redispatch<br>occurs.</p>\n</li>\n</ul>\n<h2 id=\"8-2-3-http-log-format\"><a href=\"#8-2-3-http-log-format\" class=\"headerlink\" title=\"8.2.3. http log format\"></a>8.2.3. http log format</h2><p>the http format is the most complete and the best suited for http proxies. it<br>is enabled by when “option httplog” is specified in the frontend. it provides<br>the same level of information as the tcp format with additional features which<br>are specific to the http protocol. just like the tcp format, the log is usually<br>emitted at the end of the session, unless “option logasap” is specified, which<br>generally only makes sense for download sites. a session which matches the<br>“monitor” rules will never logged. it is also possible not to log sessions for<br>which no data were sent by the client by specifying “option dontlognull” in the<br>frontend. successful connections will not be logged if “option dontlog-normal”<br>is specified in the frontend.</p>\n<p>most fields are shared with the tcp log, some being different. a few fields may<br>slightly vary depending on some configuration options. those ones are marked<br>with a star (‘*’) after the field name below.</p>\n<p>  example :<br>        frontend http-in<br>            mode http<br>            option httplog<br>            log global<br>            default_backend bck</p>\n<pre><code>    backend static\n        server srv1 127.0.0.1:8000\n\n&gt;&gt;&gt; feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n      {} &quot;get /index.html http/1.1&quot;\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14389]:<br>      2   client_ip ‘:’ client_port                             10.0.1.2:33317<br>      3   ‘[‘ accept_date ‘]’                       [06/feb/2009:12:14:14.655]<br>      4   frontend_name                                                http-in<br>      5   backend_name ‘/‘ server_name                             static/srv1<br>      6   tq ‘/‘ tw ‘/‘ tc ‘/‘ tr ‘/‘ tt<em>                       10/0/30/69/109<br>      7   status_code                                                      200<br>      8   bytes_read</em>                                                     2750<br>      9   captured_request_cookie                                            -<br>     10   captured_response_cookie                                           -<br>     11   termination_state                                               —-<br>     12   actconn ‘/‘ feconn ‘/‘ beconn ‘/‘ srv_conn ‘/‘ retries<em>    1/1/1/1/0<br>     13   srv_queue ‘/‘ backend_queue                                      0/0<br>     14   ‘{‘ captured_request_headers</em> ‘}’                   {haproxy.1wt.eu}<br>     15   ‘{‘ captured_response_headers* ‘}’                                {}<br>     16   ‘“‘ http_request ‘“‘                      “get /index.html http/1.1”</p>\n<p>detailed fields description :</p>\n<ul>\n<li><p>“client_ip” is the ip address of the client which initiated the tcp<br>connection to haproxy. if the connection was accepted on a unix socket<br>instead, the ip address would be replaced with the word “unix”. note that<br>when the connection is accepted on a socket configured with “accept-proxy”<br>and the proxy protocol is correctly used, then the logs will reflect the<br>forwarded connection’s information.</p>\n</li>\n<li><p>“client_port” is the tcp port of the client which initiated the connection.<br>if the connection was accepted on a unix socket instead, the port would be<br>replaced with the id of the accepting socket, which is also reported in the<br>stats interface.</p>\n</li>\n<li><p>“accept_date” is the exact date when the tcp connection was received by<br>haproxy (which might be very slightly different from the date observed on<br>the network if there was some queuing in the system’s backlog). this is<br>usually the same date which may appear in any upstream firewall’s log. this<br>does not depend on the fact that the client has sent the request or not.</p>\n</li>\n<li><p>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</p>\n</li>\n<li><p>“backend_name” is the name of the backend (or listener) which was selected<br>to manage the connection to the server. this will be the same as the<br>frontend if no switching rule has been applied.</p>\n</li>\n<li><p>“server_name” is the name of the last server to which the connection was<br>sent, which might differ from the first one if there were connection errors<br>and a redispatch occurred. note that this server belongs to the backend<br>which processed the request. if the request was aborted before reaching a<br>server, “<nosrv>“ is indicated instead of a server name. if the request was<br>intercepted by the stats subsystem, “<stats>“ is indicated instead.</stats></nosrv></p>\n</li>\n<li><p>“tq” is the total time in milliseconds spent waiting for the client to send<br>a full http request, not counting data. it can be “-1” if the connection<br>was aborted before a complete request could be received. it should always<br>be very small because a request generally fits in one single packet. large<br>times here generally indicate network trouble between the client and<br>haproxy. see “timers” below for more details.</p>\n</li>\n<li><p>“tw” is the total time in milliseconds spent waiting in the various queues.<br>it can be “-1” if the connection was aborted before reaching the queue.<br>see “timers” below for more details.</p>\n</li>\n<li><p>“tc” is the total time in milliseconds spent waiting for the connection to<br>establish to the final server, including retries. it can be “-1” if the<br>request was aborted before a connection could be established. see “timers”<br>below for more details.</p>\n</li>\n<li><p>“tr” is the total time in milliseconds spent waiting for the server to send<br>a full http response, not counting data. it can be “-1” if the request was<br>aborted before a complete response could be received. it generally matches<br>the server’s processing time for the request, though it may be altered by<br>the amount of data sent by the client to the server. large times here on<br>“get” requests generally indicate an overloaded server. see “timers” below<br>for more details.</p>\n</li>\n<li><p>“tt” is the total time in milliseconds elapsed between the accept and the<br>last close. it covers all possible processing. there is one exception, if<br>“option logasap” was specified, then the time counting stops at the moment<br>the log is emitted. in this case, a ‘+’ sign is prepended before the value,<br>indicating that the final one will be larger. see “timers” below for more<br>details.</p>\n</li>\n<li><p>“status_code” is the http status code returned to the client. this status<br>is generally set by the server, but it might also be set by haproxy when<br>the server cannot be reached or when its response is blocked by haproxy.</p>\n</li>\n<li><p>“bytes_read” is the total number of bytes transmitted to the client when<br>the log is emitted. this does include http headers. if “option logasap” is<br>specified, the this value will be prefixed with a ‘+’ sign indicating that<br>the final one may be larger. please note that this value is a 64-bit<br>counter, so log analysis tools must be able to handle it without<br>overflowing.</p>\n</li>\n<li><p>“captured_request_cookie” is an optional “name=value” entry indicating that<br>the client had this cookie in the request. the cookie name and its maximum<br>length are defined by the “capture cookie” statement in the frontend<br>configuration. the field is a single dash (‘-‘) when the option is not<br>set. only one cookie may be captured, it is generally used to track session<br>id exchanges between a client and a server to detect session crossing<br>between clients due to application bugs. for more details, please consult<br>the section “capturing http headers and cookies” below.</p>\n</li>\n<li><p>“captured_response_cookie” is an optional “name=value” entry indicating<br>that the server has returned a cookie with its response. the cookie name<br>and its maximum length are defined by the “capture cookie” statement in the<br>frontend configuration. the field is a single dash (‘-‘) when the option is<br>not set. only one cookie may be captured, it is generally used to track<br>session id exchanges between a client and a server to detect session<br>crossing between clients due to application bugs. for more details, please<br>consult the section “capturing http headers and cookies” below.</p>\n</li>\n<li><p>“termination_state” is the condition the session was in when the session<br>ended. this indicates the session state, which side caused the end of<br>session to happen, for what reason (timeout, error, …), just like in tcp<br>logs, and information about persistence operations on cookies in the last<br>two characters. the normal flags should begin with “–”, indicating the<br>session was closed by either end with no data remaining in buffers. see<br>below “session state at disconnection” for more details.</p>\n</li>\n<li><p>“actconn” is the total number of concurrent connections on the process when<br>the session was logged. it is useful to detect when some per-process system<br>limits have been reached. for instance, if actconn is close to 512 or 1024<br>when multiple connection errors occur, chances are high that the system<br>limits the process to use a maximum of 1024 file descriptors and that all<br>of them are used. see section 3 “global parameters” to find how to tune the<br>system.</p>\n</li>\n<li><p>“feconn” is the total number of concurrent connections on the frontend when<br>the session was logged. it is useful to estimate the amount of resource<br>required to sustain high loads, and to detect when the frontend’s “maxconn”<br>has been reached. most often when this value increases by huge jumps, it is<br>because there is congestion on the backend servers, but sometimes it can be<br>caused by a denial of service attack.</p>\n</li>\n<li><p>“beconn” is the total number of concurrent connections handled by the<br>backend when the session was logged. it includes the total number of<br>concurrent connections active on servers as well as the number of<br>connections pending in queues. it is useful to estimate the amount of<br>additional servers needed to support high loads for a given application.<br>most often when this value increases by huge jumps, it is because there is<br>congestion on the backend servers, but sometimes it can be caused by a<br>denial of service attack.</p>\n</li>\n<li><p>“srv_conn” is the total number of concurrent connections still active on<br>the server when the session was logged. it can never exceed the server’s<br>configured “maxconn” parameter. if this value is very often close or equal<br>to the server’s “maxconn”, it means that traffic regulation is involved a<br>lot, meaning that either the server’s maxconn value is too low, or that<br>there aren’t enough servers to process the load with an optimal response<br>time. when only one of the server’s “srv_conn” is high, it usually means<br>that this server has some trouble causing the requests to take longer to be<br>processed than on other servers.</p>\n</li>\n<li><p>“retries” is the number of connection retries experienced by this session<br>when trying to connect to the server. it must normally be zero, unless a<br>server is being stopped at the same moment the connection was attempted.<br>frequent retries generally indicate either a network problem between<br>haproxy and the server, or a misconfigured system backlog on the server<br>preventing new connections from being queued. this field may optionally be<br>prefixed with a ‘+’ sign, indicating that the session has experienced a<br>redispatch after the maximal retry count has been reached on the initial<br>server. in this case, the server name appearing in the log is the one the<br>connection was redispatched to, and not the first one, though both may<br>sometimes be the same in case of hashing for instance. so as a general rule<br>of thumb, when a ‘+’ is present in front of the retry count, this count<br>should not be attributed to the logged server.</p>\n</li>\n<li><p>“srv_queue” is the total number of requests which were processed before<br>this one in the server queue. it is zero when the request has not gone<br>through the server queue. it makes it possible to estimate the approximate<br>server’s response time by dividing the time spent in queue by the number of<br>requests in the queue. it is worth noting that if a session experiences a<br>redispatch and passes through two server queues, their positions will be<br>cumulated. a request should not pass through both the server queue and the<br>backend queue unless a redispatch occurs.</p>\n</li>\n<li><p>“backend_queue” is the total number of requests which were processed before<br>this one in the backend’s global queue. it is zero when the request has not<br>gone through the global queue. it makes it possible to estimate the average<br>queue length, which easily translates into a number of missing servers when<br>divided by a server’s “maxconn” parameter. it is worth noting that if a<br>session experiences a redispatch, it may pass twice in the backend’s queue,<br>and then both positions will be cumulated. a request should not pass<br>through both the server queue and the backend queue unless a redispatch<br>occurs.</p>\n</li>\n<li><p>“captured_request_headers” is a list of headers captured in the request due<br>to the presence of the “capture request header” statement in the frontend.<br>multiple headers can be captured, they will be delimited by a vertical bar<br>(‘|’). when no capture is enabled, the braces do not appear, causing a<br>shift of remaining fields. it is important to note that this field may<br>contain spaces, and that using it requires a smarter log parser than when<br>it’s not used. please consult the section “capturing http headers and<br>cookies” below for more details.</p>\n</li>\n<li><p>“captured_response_headers” is a list of headers captured in the response<br>due to the presence of the “capture response header” statement in the<br>frontend. multiple headers can be captured, they will be delimited by a<br>vertical bar (‘|’). when no capture is enabled, the braces do not appear,<br>causing a shift of remaining fields. it is important to note that this<br>field may contain spaces, and that using it requires a smarter log parser<br>than when it’s not used. please consult the section “capturing http headers<br>and cookies” below for more details.</p>\n</li>\n<li><p>“http_request” is the complete http request line, including the method,<br>request and http version string. non-printable characters are encoded (see<br>below the section “non-printable characters”). this is always the last<br>field, and it is always delimited by quotes and is the only one which can<br>contain quotes. if new fields are added to the log format, they will be<br>added before this field. this field might be truncated if the request is<br>huge and does not fit in the standard syslog buffer (1024 characters). this<br>is the reason why this field must always remain the last one.</p>\n</li>\n</ul>\n<h2 id=\"8-2-4-custom-log-format\"><a href=\"#8-2-4-custom-log-format\" class=\"headerlink\" title=\"8.2.4. custom log format\"></a>8.2.4. custom log format</h2><p>the directive log-format allows you to customize the logs in http mode and tcp<br>mode. it takes a string as argument.</p>\n<p>haproxy understands some log format variables. % precedes log format variables.<br>variables can take arguments using braces (‘{}’), and multiple arguments are<br>separated by commas within the braces. flags may be added or removed by<br>prefixing them with a ‘+’ or ‘-‘ sign.</p>\n<p>special variable “%o” may be used to propagate its flags to all other<br>variables on the same format string. this is particularly handy with quoted<br>string formats (“q”).</p>\n<p>if a variable is named between square brackets (‘[‘ .. ‘]’) then it is used<br>as a sample expression rule (see section 7.3). this it useful to add some<br>less common information such as the client’s ssl certificate’s dn, or to log<br>the key that would be used to store an entry into a stick table.</p>\n<p>note: spaces must be escaped. a space character is considered as a separator.<br>in order to emit a verbatim ‘%’, it must be preceded by another ‘%’ resulting<br>in ‘%%’. haproxy will automatically merge consecutive separators.</p>\n<p>flags are :</p>\n<ul>\n<li>q: quote a string</li>\n<li><p>x: hexadecimal representation (ips, ports, %ts, %rt, %pid)</p>\n<p>example:</p>\n<p>log-format %t\\ %t\\ some\\ text<br>log-format %{+q}o\\ %t\\ %s\\ %{-q}r</p>\n</li>\n</ul>\n<p>at the moment, the default http format is defined this way :</p>\n<pre><code>log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tq/%tw/%tc/%tr/%tt\\ %st\\ %b\\ %cc\\ \\\n           %cs\\ %tsc\\ %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\\ %hr\\ %hs\\ %{+q}r\n</code></pre><p>the default clf format is defined this way :</p>\n<pre><code>log-format %{+q}o\\ %{-q}ci\\ -\\ -\\ [%t]\\ %r\\ %st\\ %b\\ \\&quot;\\&quot;\\ \\&quot;\\&quot;\\ %cp\\ \\\n           %ms\\ %ft\\ %b\\ %s\\ \\%tq\\ %tw\\ %tc\\ %tr\\ %tt\\ %tsc\\ %ac\\ %fc\\ \\\n           %bc\\ %sc\\ %rc\\ %sq\\ %bq\\ %cc\\ %cs\\ \\%hrl\\ %hsl\n</code></pre><p>and the default tcp format is defined this way :</p>\n<pre><code>log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tw/%tc/%tt\\ %b\\ %ts\\ \\\n           %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\n</code></pre><p>please refer to the table below for currently defined variables :</p>\n<p>  +—+——+———————————————–+————-+<br>  | r | var  | field name (8.2.2 and 8.2.3 for description)  | type        |<br>  +—+——+———————————————–+————-+<br>  |   | %o   | special variable, apply flags on all next var |             |<br>  +—+——+———————————————–+————-+<br>  |   | %b   | bytes_read           (from server to client)  | numeric     |<br>  | h | %cc  | captured_request_cookie                       | string      |<br>  | h | %cs  | captured_response_cookie                      | string      |<br>  |   | %h   | hostname                                      | string      |<br>  | h | %hm  | http method (ex: post)                        | string      |<br>  | h | %hp  | http request uri without query string (path)  | string      |<br>  | h | %hu  | http request uri (ex: /foo?bar=baz)           | string      |<br>  | h | %hv  | http version (ex: http/1.0)                   | string      |<br>  |   | %id  | unique-id                                     | string      |<br>  |   | %st  | status_code                                   | numeric     |<br>  |   | %t   | gmt_date_time                                 | date        |<br>  |   | %tc  | tc                                            | numeric     |<br>  |   | %tl  | local_date_time                               | date        |<br>  | h | %tq  | tq                                            | numeric     |<br>  | h | %tr  | tr                                            | numeric     |<br>  |   | %ts  | timestamp                                     | numeric     |<br>  |   | %tt  | tt                                            | numeric     |<br>  |   | %tw  | tw                                            | numeric     |<br>  |   | %u   | bytes_uploaded       (from client to server)  | numeric     |<br>  |   | %ac  | actconn                                       | numeric     |<br>  |   | %b   | backend_name                                  | string      |<br>  |   | %bc  | beconn      (backend concurrent connections)  | numeric     |<br>  |   | %bi  | backend_source_ip       (connecting address)  | ip          |<br>  |   | %bp  | backend_source_port     (connecting address)  | numeric     |<br>  |   | %bq  | backend_queue                                 | numeric     |<br>  |   | %ci  | client_ip                 (accepted address)  | ip          |<br>  |   | %cp  | client_port               (accepted address)  | numeric     |<br>  |   | %f   | frontend_name                                 | string      |<br>  |   | %fc  | feconn     (frontend concurrent connections)  | numeric     |<br>  |   | %fi  | frontend_ip              (accepting address)  | ip          |<br>  |   | %fp  | frontend_port            (accepting address)  | numeric     |<br>  |   | %ft  | frontend_name_transport (‘~’ suffix for ssl)  | string      |<br>  |   | %lc  | frontend_log_counter                          | numeric     |<br>  |   | %hr  | captured_request_headers default style        | string      |<br>  |   | %hrl | captured_request_headers clf style            | string list |<br>  |   | %hs  | captured_response_headers default style       | string      |<br>  |   | %hsl | captured_response_headers clf style           | string list |<br>  |   | %ms  | accept date milliseconds                      | numeric     |<br>  |   | %pid | pid                                           | numeric     |<br>  | h | %r   | http_request                                  | string      |<br>  |   | %rc  | retries                                       | numeric     |<br>  |   | %rt  | request_counter (http req or tcp session)     | numeric     |<br>  |   | %s   | server_name                                   | string      |<br>  |   | %sc  | srv_conn     (server concurrent connections)  | numeric     |<br>  |   | %si  | server_ip                   (target address)  | ip          |<br>  |   | %sp  | server_port                 (target address)  | numeric     |<br>  |   | %sq  | srv_queue                                     | numeric     |<br>  | s | %sslc| ssl_ciphers (ex: aes-sha)                     | string      |<br>  | s | %sslv| ssl_version (ex: tlsv1)                       | string      |<br>  |   | %t   | date_time      (with millisecond resolution)  | date        |<br>  |   | %ts  | termination_state                             | string      |<br>  | h | %tsc | termination_state with cookie status          | string      |<br>  +—+——+———————————————–+————-+</p>\n<pre><code>r = restrictions : h = mode http only ; s = ssl only\n</code></pre><h2 id=\"8-2-5-error-log-format\"><a href=\"#8-2-5-error-log-format\" class=\"headerlink\" title=\"8.2.5. error log format\"></a>8.2.5. error log format</h2><p>when an incoming connection fails due to an ssl handshake or an invalid proxy<br>protocol header, haproxy will log the event using a shorter, fixed line format.<br>by default, logs are emitted at the log_info level, unless the option<br>“log-separate-errors” is set in the backend, in which case the log_err level<br>will be used. connections on which no data are exchanged (eg: probes) are not<br>logged if the “dontlognull” option is set.</p>\n<p>the format looks like this :</p>\n<pre><code>&gt;&gt;&gt; dec  3 18:27:14 localhost \\\n      haproxy[6103]: 127.0.0.1:56059 [03/dec/2012:17:35:10.380] frt/f1: \\\n      connection error during ssl handshake\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                             haproxy[6103]:<br>      2   client_ip ‘:’ client_port                            127.0.0.1:56059<br>      3   ‘[‘ accept_date ‘]’                       [03/dec/2012:17:35:10.380]<br>      4   frontend_name “/“ bind_name “:”                              frt/f1:<br>      5   message                        connection error during ssl handshake</p>\n<p>these fields just provide minimal information to help debugging connection<br>failures.</p>\n<h2 id=\"8-3-advanced-logging-options\"><a href=\"#8-3-advanced-logging-options\" class=\"headerlink\" title=\"8.3. advanced logging options\"></a>8.3. advanced logging options</h2><p>some advanced logging options are often looked for but are not easy to find out<br>just by looking at the various options. here is an entry point for the few<br>options which can enable better logging. please refer to the keywords reference<br>for more information about their usage.</p>\n<h2 id=\"8-3-1-disabling-logging-of-external-tests\"><a href=\"#8-3-1-disabling-logging-of-external-tests\" class=\"headerlink\" title=\"8.3.1. disabling logging of external tests\"></a>8.3.1. disabling logging of external tests</h2><p>it is quite common to have some monitoring tools perform health checks on<br>haproxy. sometimes it will be a layer 3 load-balancer such as lvs or any<br>commercial load-balancer, and sometimes it will simply be a more complete<br>monitoring system such as nagios. when the tests are very frequent, users often<br>ask how to disable logging for those checks. there are three possibilities :</p>\n<ul>\n<li><p>if connections come from everywhere and are just tcp probes, it is often<br>desired to simply disable logging of connections without data exchange, by<br>setting “option dontlognull” in the frontend. it also disables logging of<br>port scans, which may or may not be desired.</p>\n</li>\n<li><p>if the connection come from a known source network, use “monitor-net” to<br>declare this network as monitoring only. any host in this network will then<br>only be able to perform health checks, and their requests will not be<br>logged. this is generally appropriate to designate a list of equipment<br>such as other load-balancers.</p>\n</li>\n<li><p>if the tests are performed on a known uri, use “monitor-uri” to declare<br>this uri as dedicated to monitoring. any host sending this request will<br>only get the result of a health-check, and the request will not be logged.</p>\n</li>\n</ul>\n<h2 id=\"8-3-2-logging-before-waiting-for-the-session-to-terminate\"><a href=\"#8-3-2-logging-before-waiting-for-the-session-to-terminate\" class=\"headerlink\" title=\"8.3.2. logging before waiting for the session to terminate\"></a>8.3.2. logging before waiting for the session to terminate</h2><p>the problem with logging at end of connection is that you have no clue about<br>what is happening during very long sessions, such as remote terminal sessions<br>or large file downloads. this problem can be worked around by specifying<br>“option logasap” in the frontend. haproxy will then log as soon as possible,<br>just before data transfer begins. this means that in case of tcp, it will still<br>log the connection status to the server, and in case of http, it will log just<br>after processing the server headers. in this case, the number of bytes reported<br>is the number of header bytes sent to the client. in order to avoid confusion<br>with normal logs, the total time field and the number of bytes are prefixed<br>with a ‘+’ sign which means that real numbers are certainly larger.</p>\n<h2 id=\"8-3-3-raising-log-level-upon-errors\"><a href=\"#8-3-3-raising-log-level-upon-errors\" class=\"headerlink\" title=\"8.3.3. raising log level upon errors\"></a>8.3.3. raising log level upon errors</h2><p>sometimes it is more convenient to separate normal traffic from errors logs,<br>for instance in order to ease error monitoring from log files. when the option<br>“log-separate-errors” is used, connections which experience errors, timeouts,<br>retries, redispatches or http status codes 5xx will see their syslog level<br>raised from “info” to “err”. this will help a syslog daemon store the log in<br>a separate file. it is very important to keep the errors in the normal traffic<br>file too, so that log ordering is not altered. you should also be careful if<br>you already have configured your syslog daemon to store all logs higher than<br>“notice” in an “admin” file, because the “err” level is higher than “notice”.</p>\n<h2 id=\"8-3-4-disabling-logging-of-successful-connections\"><a href=\"#8-3-4-disabling-logging-of-successful-connections\" class=\"headerlink\" title=\"8.3.4. disabling logging of successful connections\"></a>8.3.4. disabling logging of successful connections</h2><p>although this may sound strange at first, some large sites have to deal with<br>multiple thousands of logs per second and are experiencing difficulties keeping<br>them intact for a long time or detecting errors within them. if the option<br>“dontlog-normal” is set on the frontend, all normal connections will not be<br>logged. in this regard, a normal connection is defined as one without any<br>error, timeout, retry nor redispatch. in http, the status code is checked too,<br>and a response with a status 5xx is not considered normal and will be logged<br>too. of course, doing is is really discouraged as it will remove most of the<br>useful information from the logs. do this only if you have no other<br>alternative.</p>\n<h2 id=\"8-4-timing-events\"><a href=\"#8-4-timing-events\" class=\"headerlink\" title=\"8.4. timing events\"></a>8.4. timing events</h2><p>timers provide a great help in troubleshooting network problems. all values are<br>reported in milliseconds (ms). these timers should be used in conjunction with<br>the session termination flags. in tcp mode with “option tcplog” set on the<br>frontend, 3 control points are reported under the form “tw/tc/tt”, and in http<br>mode, 5 control points are reported under the form “tq/tw/tc/tr/tt” :</p>\n<ul>\n<li><p>tq: total time to get the client request (http mode only). it’s the time<br>elapsed between the moment the client connection was accepted and the<br>moment the proxy received the last http header. the value “-1” indicates<br>that the end of headers (empty line) has never been seen. this happens when<br>the client closes prematurely or times out.</p>\n</li>\n<li><p>tw: total time spent in the queues waiting for a connection slot. it<br>accounts for backend queue as well as the server queues, and depends on the<br>queue size, and the time needed for the server to complete previous<br>requests. the value “-1” means that the request was killed before reaching<br>the queue, which is generally what happens with invalid or denied requests.</p>\n</li>\n<li><p>tc: total time to establish the tcp connection to the server. it’s the time<br>elapsed between the moment the proxy sent the connection request, and the<br>moment it was acknowledged by the server, or between the tcp syn packet and<br>the matching syn/ack packet in return. the value “-1” means that the<br>connection never established.</p>\n</li>\n<li><p>tr: server response time (http mode only). it’s the time elapsed between<br>the moment the tcp connection was established to the server and the moment<br>the server sent its complete response headers. it purely shows its request<br>processing time, without the network overhead due to the data transmission.<br>it is worth noting that when the client has data to send to the server, for<br>instance during a post request, the time already runs, and this can distort<br>apparent response time. for this reason, it’s generally wise not to trust<br>too much this field for post requests initiated from clients behind an<br>untrusted network. a value of “-1” here means that the last the response<br>header (empty line) was never seen, most likely because the server timeout<br>stroke before the server managed to process the request.</p>\n</li>\n<li><p>tt: total session duration time, between the moment the proxy accepted it<br>and the moment both ends were closed. the exception is when the “logasap”<br>option is specified. in this case, it only equals (tq+tw+tc+tr), and is<br>prefixed with a ‘+’ sign. from this field, we can deduce “td”, the data<br>transmission time, by subtracting other timers when valid :</p>\n<pre><code>td = tt - (tq + tw + tc + tr)\n</code></pre><p>timers with “-1” values have to be excluded from this equation. in tcp<br>mode, “tq” and “tr” have to be excluded too. note that “tt” can never be<br>negative.</p>\n</li>\n</ul>\n<p>these timers provide precious indications on trouble causes. since the tcp<br>protocol defines retransmit delays of 3, 6, 12… seconds, we know for sure<br>that timers close to multiples of 3s are nearly always related to lost packets<br>due to network problems (wires, negotiation, congestion). moreover, if “tt” is<br>close to a timeout value specified in the configuration, it often means that a<br>session has been aborted on timeout.</p>\n<p>most common cases :</p>\n<ul>\n<li><p>if “tq” is close to 3000, a packet has probably been lost between the<br>client and the proxy. this is very rare on local networks but might happen<br>when clients are on far remote networks and send large requests. it may<br>happen that values larger than usual appear here without any network cause.<br>sometimes, during an attack or just after a resource starvation has ended,<br>haproxy may accept thousands of connections in a few milliseconds. the time<br>spent accepting these connections will inevitably slightly delay processing<br>of other connections, and it can happen that request times in the order of<br>a few tens of milliseconds are measured after a few thousands of new<br>connections have been accepted at once. setting “option http-server-close”<br>may display larger request times since “tq” also measures the time spent<br>waiting for additional requests.</p>\n</li>\n<li><p>if “tc” is close to 3000, a packet has probably been lost between the<br>server and the proxy during the server connection phase. this value should<br>always be very low, such as 1 ms on local networks and less than a few tens<br>of ms on remote networks.</p>\n</li>\n<li><p>if “tr” is nearly always lower than 3000 except some rare values which seem<br>to be the average majored by 3000, there are probably some packets lost<br>between the proxy and the server.</p>\n</li>\n<li><p>if “tt” is large even for small byte counts, it generally is because<br>neither the client nor the server decides to close the connection, for<br>instance because both have agreed on a keep-alive connection mode. in order<br>to solve this issue, it will be needed to specify “option httpclose” on<br>either the frontend or the backend. if the problem persists, it means that<br>the server ignores the “close” connection mode and expects the client to<br>close. then it will be required to use “option forceclose”. having the<br>smallest possible ‘tt’ is important when connection regulation is used with<br>the “maxconn” option on the servers, since no new connection will be sent<br>to the server until another one is released.</p>\n</li>\n</ul>\n<p>other noticeable http log cases (‘xx’ means any value to be ignored) :</p>\n<p>  tq/tw/tc/tr/+tt  the “option logasap” is present on the frontend and the log<br>                   was emitted before the data phase. all the timers are valid<br>                   except “tt” which is shorter than reality.</p>\n<p>  -1/xx/xx/xx/tt   the client was not able to send a complete request in time<br>                   or it aborted too early. check the session termination flags<br>                   then “timeout http-request” and “timeout client” settings.</p>\n<p>  tq/-1/xx/xx/tt   it was not possible to process the request, maybe because<br>                   servers were out of order, because the request was invalid<br>                   or forbidden by acl rules. check the session termination<br>                   flags.</p>\n<p>  tq/tw/-1/xx/tt   the connection could not establish on the server. either it<br>                   actively refused it or it timed out after tt-(tq+tw) ms.<br>                   check the session termination flags, then check the<br>                   “timeout connect” setting. note that the tarpit action might<br>                   return similar-looking patterns, with “tw” equal to the time<br>                   the client connection was maintained open.</p>\n<p>  tq/tw/tc/-1/tt   the server has accepted the connection but did not return<br>                   a complete response in time, or it closed its connection<br>                   unexpectedly after tt-(tq+tw+tc) ms. check the session<br>                   termination flags, then check the “timeout server” setting.</p>\n<h2 id=\"8-5-session-state-at-disconnection\"><a href=\"#8-5-session-state-at-disconnection\" class=\"headerlink\" title=\"8.5. session state at disconnection\"></a>8.5. session state at disconnection</h2><p>tcp and http logs provide a session termination indicator in the<br>“termination_state” field, just before the number of active connections. it is<br>2-characters long in tcp mode, and is extended to 4 characters in http mode,<br>each of which has a special meaning :</p>\n<ul>\n<li><p>on the first character, a code reporting the first event which caused the<br>session to terminate :</p>\n<pre><code>c : the tcp session was unexpectedly aborted by the client.\n\ns : the tcp session was unexpectedly aborted by the server, or the\n    server explicitly refused it.\n\np : the session was prematurely aborted by the proxy, because of a\n    connection limit enforcement, because a deny filter was matched,\n    because of a security check which detected and blocked a dangerous\n    error in server response which might have caused information leak\n    (eg: cacheable cookie).\n\nl : the session was locally processed by haproxy and was not passed to\n    a server. this is what happens for stats and redirects.\n\nr : a resource on the proxy has been exhausted (memory, sockets, source\n    ports, ...). usually, this appears during the connection phase, and\n    system logs should contain a copy of the precise error. if this\n    happens, it must be considered as a very serious anomaly which\n    should be fixed as soon as possible by any means.\n\ni : an internal error was identified by the proxy during a self-check.\n    this should never happen, and you are encouraged to report any log\n    containing this, because this would almost certainly be a bug. it\n    would be wise to preventively restart the process after such an\n    event too, in case it would be caused by memory corruption.\n\nd : the session was killed by haproxy because the server was detected\n    as down and was configured to kill all connections when going down.\n\nu : the session was killed by haproxy on this backup server because an\n    active server was detected as up and was configured to kill all\n    backup connections when going up.\n\nk : the session was actively killed by an admin operating on haproxy.\n\nc : the client-side timeout expired while waiting for the client to\n    send or receive data.\n\ns : the server-side timeout expired while waiting for the server to\n    send or receive data.\n\n- : normal session completion, both the client and the server closed\n    with nothing left in the buffers.\n</code></pre></li>\n<li><p>on the second character, the tcp or http session state when it was closed :</p>\n<pre><code>r : the proxy was waiting for a complete, valid request from the client\n    (http mode only). nothing was sent to any server.\n\nq : the proxy was waiting in the queue for a connection slot. this can\n    only happen when servers have a &apos;maxconn&apos; parameter set. it can\n    also happen in the global queue after a redispatch consecutive to\n    a failed attempt to connect to a dying server. if no redispatch is\n    reported, then no connection attempt was made to any server.\n\nc : the proxy was waiting for the connection to establish on the\n    server. the server might at most have noticed a connection attempt.\n\nh : the proxy was waiting for complete, valid response headers from the\n    server (http only).\n\nd : the session was in the data phase.\n\nl : the proxy was still transmitting last data to the client while the\n    server had already finished. this one is very rare as it can only\n    happen when the client dies while receiving the last packets.\n\nt : the request was tarpitted. it has been held open with the client\n    during the whole &quot;timeout tarpit&quot; duration or until the client\n    closed, both of which will be reported in the &quot;tw&quot; timer.\n\n- : normal session completion after end of data transfer.\n</code></pre></li>\n<li><p>the third character tells whether the persistence cookie was provided by<br>the client (only in http mode) :</p>\n<pre><code>n : the client provided no cookie. this is usually the case for new\n    visitors, so counting the number of occurrences of this flag in the\n    logs generally indicate a valid trend for the site frequentation.\n\ni : the client provided an invalid cookie matching no known server.\n    this might be caused by a recent configuration change, mixed\n    cookies between http/https sites, persistence conditionally\n    ignored, or an attack.\n\nd : the client provided a cookie designating a server which was down,\n    so either &quot;option persist&quot; was used and the client was sent to\n    this server, or it was not set and the client was redispatched to\n    another server.\n\nv : the client provided a valid cookie, and was sent to the associated\n    server.\n\ne : the client provided a valid cookie, but with a last date which was\n    older than what is allowed by the &quot;maxidle&quot; cookie parameter, so\n    the cookie is consider expired and is ignored. the request will be\n    redispatched just as if there was no cookie.\n\no : the client provided a valid cookie, but with a first date which was\n    older than what is allowed by the &quot;maxlife&quot; cookie parameter, so\n    the cookie is consider too old and is ignored. the request will be\n    redispatched just as if there was no cookie.\n\nu : a cookie was present but was not used to select the server because\n    some other server selection mechanism was used instead (typically a\n    &quot;use-server&quot; rule).\n\n- : does not apply (no cookie set in configuration).\n</code></pre></li>\n<li><p>the last character reports what operations were performed on the persistence<br>cookie returned by the server (only in http mode) :</p>\n<pre><code>n : no cookie was provided by the server, and none was inserted either.\n\ni : no cookie was provided by the server, and the proxy inserted one.\n    note that in &quot;cookie insert&quot; mode, if the server provides a cookie,\n    it will still be overwritten and reported as &quot;i&quot; here.\n\nu : the proxy updated the last date in the cookie that was presented by\n    the client. this can only happen in insert mode with &quot;maxidle&quot;. it\n    happens every time there is activity at a different date than the\n    date indicated in the cookie. if any other change happens, such as\n    a redispatch, then the cookie will be marked as inserted instead.\n\np : a cookie was provided by the server and transmitted as-is.\n\nr : the cookie provided by the server was rewritten by the proxy, which\n    happens in &quot;cookie rewrite&quot; or &quot;cookie prefix&quot; modes.\n\nd : the cookie provided by the server was deleted by the proxy.\n\n- : does not apply (no cookie set in configuration).\n</code></pre></li>\n</ul>\n<p>the combination of the two first flags gives a lot of information about what<br>was happening when the session terminated, and why it did terminate. it can be<br>helpful to detect server saturation, network troubles, local system resource<br>starvation, attacks, etc…</p>\n<p>the most common termination flags combinations are indicated below. they are<br>alphabetically sorted, with the lowercase set just after the upper case for<br>easier finding and understanding.</p>\n<p>  flags   reason</p>\n<pre><code>--   normal termination.\n\ncc   the client aborted before the connection could be established to the\n     server. this can happen when haproxy tries to connect to a recently\n     dead (or unchecked) server, and the client aborts while haproxy is\n     waiting for the server to respond or for &quot;timeout connect&quot; to expire.\n\ncd   the client unexpectedly aborted during data transfer. this can be\n     caused by a browser crash, by an intermediate equipment between the\n     client and haproxy which decided to actively break the connection,\n     by network routing issues between the client and haproxy, or by a\n     keep-alive session between the server and the client terminated first\n     by the client.\n\ncd   the client did not send nor acknowledge any data for as long as the\n     &quot;timeout client&quot; delay. this is often caused by network failures on\n     the client side, or the client simply leaving the net uncleanly.\n\nch   the client aborted while waiting for the server to start responding.\n     it might be the server taking too long to respond or the client\n     clicking the &apos;stop&apos; button too fast.\n\nch   the &quot;timeout client&quot; stroke while waiting for client data during a\n     post request. this is sometimes caused by too large tcp mss values\n     for pppoe networks which cannot transport full-sized packets. it can\n     also happen when client timeout is smaller than server timeout and\n     the server takes too long to respond.\n\ncq   the client aborted while its session was queued, waiting for a server\n     with enough empty slots to accept it. it might be that either all the\n     servers were saturated or that the assigned server was taking too\n     long a time to respond.\n\ncr   the client aborted before sending a full http request. most likely\n     the request was typed by hand using a telnet client, and aborted\n     too early. the http status code is likely a 400 here. sometimes this\n     might also be caused by an ids killing the connection between haproxy\n     and the client. &quot;option http-ignore-probes&quot; can be used to ignore\n     connections without any data transfer.\n\ncr   the &quot;timeout http-request&quot; stroke before the client sent a full http\n     request. this is sometimes caused by too large tcp mss values on the\n     client side for pppoe networks which cannot transport full-sized\n     packets, or by clients sending requests by hand and not typing fast\n     enough, or forgetting to enter the empty line at the end of the\n     request. the http status code is likely a 408 here. note: recently,\n     some browsers started to implement a &quot;pre-connect&quot; feature consisting\n     in speculatively connecting to some recently visited web sites just\n     in case the user would like to visit them. this results in many\n     connections being established to web sites, which end up in 408\n     request timeout if the timeout strikes first, or 400 bad request when\n     the browser decides to close them first. these ones pollute the log\n     and feed the error counters. some versions of some browsers have even\n     been reported to display the error code. it is possible to work\n     around the undesirable effects of this behaviour by adding &quot;option\n     http-ignore-probes&quot; in the frontend, resulting in connections with\n     zero data transfer to be totally ignored. this will definitely hide\n     the errors of people experiencing connectivity issues though.\n\nct   the client aborted while its session was tarpitted. it is important to\n     check if this happens on valid requests, in order to be sure that no\n     wrong tarpit rules have been written. if a lot of them happen, it\n     might make sense to lower the &quot;timeout tarpit&quot; value to something\n     closer to the average reported &quot;tw&quot; timer, in order not to consume\n     resources for just a few attackers.\n\nlr   the request was intercepted and locally handled by haproxy. generally\n     it means that this was a redirect or a stats request.\n\nsc   the server or an equipment between it and haproxy explicitly refused\n     the tcp connection (the proxy received a tcp rst or an icmp message\n     in return). under some circumstances, it can also be the network\n     stack telling the proxy that the server is unreachable (eg: no route,\n     or no arp response on local network). when this happens in http mode,\n     the status code is likely a 502 or 503 here.\n\nsc   the &quot;timeout connect&quot; stroke before a connection to the server could\n     complete. when this happens in http mode, the status code is likely a\n     503 or 504 here.\n\nsd   the connection to the server died with an error during the data\n     transfer. this usually means that haproxy has received an rst from\n     the server or an icmp message from an intermediate equipment while\n     exchanging data with the server. this can be caused by a server crash\n     or by a network issue on an intermediate equipment.\n\nsd   the server did not send nor acknowledge any data for as long as the\n     &quot;timeout server&quot; setting during the data phase. this is often caused\n     by too short timeouts on l4 equipments before the server (firewalls,\n     load-balancers, ...), as well as keep-alive sessions maintained\n     between the client and the server expiring first on haproxy.\n\nsh   the server aborted before sending its full http response headers, or\n     it crashed while processing the request. since a server aborting at\n     this moment is very rare, it would be wise to inspect its logs to\n     control whether it crashed and why. the logged request may indicate a\n     small set of faulty requests, demonstrating bugs in the application.\n     sometimes this might also be caused by an ids killing the connection\n     between haproxy and the server.\n\nsh   the &quot;timeout server&quot; stroke before the server could return its\n     response headers. this is the most common anomaly, indicating too\n     long transactions, probably caused by server or database saturation.\n     the immediate workaround consists in increasing the &quot;timeout server&quot;\n     setting, but it is important to keep in mind that the user experience\n     will suffer from these long response times. the only long term\n     solution is to fix the application.\n\nsq   the session spent too much time in queue and has been expired. see\n     the &quot;timeout queue&quot; and &quot;timeout connect&quot; settings to find out how to\n     fix this if it happens too often. if it often happens massively in\n     short periods, it may indicate general problems on the affected\n     servers due to i/o or database congestion, or saturation caused by\n     external attacks.\n\npc   the proxy refused to establish a connection to the server because the\n     process&apos; socket limit has been reached while attempting to connect.\n     the global &quot;maxconn&quot; parameter may be increased in the configuration\n     so that it does not happen anymore. this status is very rare and\n     might happen when the global &quot;ulimit-n&quot; parameter is forced by hand.\n\npd   the proxy blocked an incorrectly formatted chunked encoded message in\n     a request or a response, after the server has emitted its headers. in\n     most cases, this will indicate an invalid message from the server to\n     the client. haproxy supports chunk sizes of up to 2gb - 1 (2147483647\n     bytes). any larger size will be considered as an error.\n\nph   the proxy blocked the server&apos;s response, because it was invalid,\n     incomplete, dangerous (cache control), or matched a security filter.\n     in any case, an http 502 error is sent to the client. one possible\n     cause for this error is an invalid syntax in an http header name\n     containing unauthorized characters. it is also possible but quite\n     rare, that the proxy blocked a chunked-encoding request from the\n     client due to an invalid syntax, before the server responded. in this\n     case, an http 400 error is sent to the client and reported in the\n     logs.\n\npr   the proxy blocked the client&apos;s http request, either because of an\n     invalid http syntax, in which case it returned an http 400 error to\n     the client, or because a deny filter matched, in which case it\n     returned an http 403 error.\n\npt   the proxy blocked the client&apos;s request and has tarpitted its\n     connection before returning it a 500 server error. nothing was sent\n     to the server. the connection was maintained open for as long as\n     reported by the &quot;tw&quot; timer field.\n\nrc   a local resource has been exhausted (memory, sockets, source ports)\n     preventing the connection to the server from establishing. the error\n     logs will tell precisely what was missing. this is very rare and can\n     only be solved by proper system tuning.\n</code></pre><p>the combination of the two last flags gives a lot of information about how<br>persistence was handled by the client, the server and by haproxy. this is very<br>important to troubleshoot disconnections, when users complain they have to<br>re-authenticate. the commonly encountered flags are :</p>\n<pre><code>--   persistence cookie is not enabled.\n\nnn   no cookie was provided by the client, none was inserted in the\n     response. for instance, this can be in insert mode with &quot;postonly&quot;\n     set on a get request.\n\nii   a cookie designating an invalid server was provided by the client,\n     a valid one was inserted in the response. this typically happens when\n     a &quot;server&quot; entry is removed from the configuration, since its cookie\n     value can be presented by a client when no other server knows it.\n\nni   no cookie was provided by the client, one was inserted in the\n     response. this typically happens for first requests from every user\n     in &quot;insert&quot; mode, which makes it an easy way to count real users.\n\nvn   a cookie was provided by the client, none was inserted in the\n     response. this happens for most responses for which the client has\n     already got a cookie.\n\nvu   a cookie was provided by the client, with a last visit date which is\n     not completely up-to-date, so an updated cookie was provided in\n     response. this can also happen if there was no date at all, or if\n     there was a date but the &quot;maxidle&quot; parameter was not set, so that the\n     cookie can be switched to unlimited time.\n\nei   a cookie was provided by the client, with a last visit date which is\n     too old for the &quot;maxidle&quot; parameter, so the cookie was ignored and a\n     new cookie was inserted in the response.\n\noi   a cookie was provided by the client, with a first visit date which is\n     too old for the &quot;maxlife&quot; parameter, so the cookie was ignored and a\n     new cookie was inserted in the response.\n\ndi   the server designated by the cookie was down, a new server was\n     selected and a new cookie was emitted in the response.\n\nvi   the server designated by the cookie was not marked dead but could not\n     be reached. a redispatch happened and selected another one, which was\n     then advertised in the response.\n</code></pre><h2 id=\"8-6-non-printable-characters\"><a href=\"#8-6-non-printable-characters\" class=\"headerlink\" title=\"8.6. non-printable characters\"></a>8.6. non-printable characters</h2><p>in order not to cause trouble to log analysis tools or terminals during log<br>consulting, non-printable characters are not sent as-is into log files, but are<br>converted to the two-digits hexadecimal representation of their ascii code,<br>prefixed by the character ‘#’. the only characters that can be logged without<br>being escaped are comprised between 32 and 126 (inclusive). obviously, the<br>escape character ‘#’ itself is also encoded to avoid any ambiguity (“#23”). it<br>is the same for the character ‘“‘ which becomes “#22”, as well as ‘{‘, ‘|’ and<br>‘}’ when logging headers.</p>\n<p>note that the space character (‘ ‘) is not encoded in headers, which can cause<br>issues for tools relying on space count to locate fields. a typical header<br>containing spaces is “user-agent”.</p>\n<p>last, it has been observed that some syslog daemons such as syslog-ng escape<br>the quote (‘“‘) with a backslash (‘\\’). the reverse operation can safely be<br>performed since no quote may appear anywhere else in the logs.</p>\n<h2 id=\"8-7-capturing-http-cookies\"><a href=\"#8-7-capturing-http-cookies\" class=\"headerlink\" title=\"8.7. capturing http cookies\"></a>8.7. capturing http cookies</h2><p>cookie capture simplifies the tracking a complete user session. this can be<br>achieved using the “capture cookie” statement in the frontend. please refer to<br>section 4.2 for more details. only one cookie can be captured, and the same<br>cookie will simultaneously be checked in the request (“cookie:” header) and in<br>the response (“set-cookie:” header). the respective values will be reported in<br>the http logs at the “captured_request_cookie” and “captured_response_cookie”<br>locations (see section 8.2.3 about http log format). when either cookie is<br>not seen, a dash (‘-‘) replaces the value. this way, it’s easy to detect when a<br>user switches to a new session for example, because the server will reassign it<br>a new cookie. it is also possible to detect if a server unexpectedly sets a<br>wrong cookie to a client, leading to session crossing.</p>\n<p>  examples :</p>\n<pre><code># capture the first cookie whose name starts with &quot;aspsession&quot;\ncapture cookie aspsession len 32\n\n# capture the first cookie whose name is exactly &quot;vgnvisitor&quot;\ncapture cookie vgnvisitor= len 32\n</code></pre><h2 id=\"8-8-capturing-http-headers\"><a href=\"#8-8-capturing-http-headers\" class=\"headerlink\" title=\"8.8. capturing http headers\"></a>8.8. capturing http headers</h2><p>header captures are useful to track unique request identifiers set by an upper<br>proxy, virtual host names, user-agents, post content-length, referrers, etc. in<br>the response, one can search for information about the response length, how the<br>server asked the cache to behave, or an object location during a redirection.</p>\n<p>header captures are performed using the “capture request header” and “capture<br>response header” statements in the frontend. please consult their definition in<br>section 4.2 for more details.</p>\n<p>it is possible to include both request headers and response headers at the same<br>time. non-existent headers are logged as empty strings, and if one header<br>appears more than once, only its last occurrence will be logged. request headers<br>are grouped within braces ‘{‘ and ‘}’ in the same order as they were declared,<br>and delimited with a vertical bar ‘|’ without any space. response headers<br>follow the same representation, but are displayed after a space following the<br>request headers block. these blocks are displayed just before the http request<br>in the logs.</p>\n<p>as a special case, it is possible to specify an http header capture in a tcp<br>frontend. the purpose is to enable logging of headers which will be parsed in<br>an http backend if the request is then switched to this http backend.</p>\n<p>  example :</p>\n<pre><code>    # this instance chains to the outgoing proxy\n    listen proxy-out\n        mode http\n        option httplog\n        option logasap\n        log global\n        server cache1 192.168.1.1:3128\n\n        # log the name of the virtual server\n        capture request  header host len 20\n\n        # log the amount of data uploaded during a post\n        capture request  header content-length len 10\n\n        # log the beginning of the referrer\n        capture request  header referer len 20\n\n        # server name (useful for outgoing proxies only)\n        capture response header server len 20\n\n        # logging the content-length is useful with &quot;option logasap&quot;\n        capture response header content-length len 10\n\n        # log the expected cache behaviour on the response\n        capture response header cache-control len 8\n\n        # the via header will report the next proxy&apos;s name\n        capture response header via len 20\n\n        # log the url location during a redirection\n        capture response header location len 20\n\n&gt;&gt;&gt; aug  9 20:26:09 localhost \\\n      haproxy[2022]: 127.0.0.1:34014 [09/aug/2004:20:26:09] proxy-out \\\n      proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \\\n      {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \\\n      &quot;get http://fr.adserver.yahoo.com/&quot;\n\n&gt;&gt;&gt; aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34020 [09/aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \\\n      {w.ods.org||} {formilux/0.1.8|3495|||} \\\n      &quot;get http://trafic.1wt.eu/ http/1.1&quot;\n\n&gt;&gt;&gt; aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34028 [09/aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \\\n      {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \\\n      {apache|230|||http://www.sytadin.} \\\n      &quot;get http://www.sytadin.equipement.gouv.fr/ http/1.1&quot;\n</code></pre><h2 id=\"8-9-examples-of-logs\"><a href=\"#8-9-examples-of-logs\" class=\"headerlink\" title=\"8.9. examples of logs\"></a>8.9. examples of logs</h2><p>these are real-world examples of logs accompanied with an explanation. some of<br>them have been made up by hand. the syslog part has been removed for better<br>reading. their sole purpose is to explain how to decipher them.</p>\n<pre><code>&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33318 [15/oct/2003:08:31:57.130] px-http \\\n      px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \\\n      &quot;head / http/1.0&quot;\n\n=&gt; long request (6.5s) entered by hand through &apos;telnet&apos;. the server replied\n   in 147 ms, and the session ended normally (&apos;----&apos;)\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33319 [15/oct/2003:08:31:57.149] px-http \\\n      px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \\\n      0/9 &quot;head / http/1.0&quot;\n\n=&gt; idem, but the request was queued in the global queue behind 9 other\n   requests, and waited there for 1230 ms.\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.654] px-http \\\n      px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \\\n      &quot;get /image.iso http/1.0&quot;\n\n=&gt; request for a long data transfer. the &quot;logasap&quot; option was specified, so\n   the log was produced just before transferring data. the server replied in\n   14 ms, 243 bytes of headers were sent to the client, and total time from\n   accept to first data byte is 30 ms.\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.925] px-http \\\n      px-http/srv1 9/0/7/14/30 502 243 - - ph-- 3/2/2/0/0 0/0 \\\n      &quot;get /cgi-bin/bug.cgi? http/1.0&quot;\n\n=&gt; the proxy blocked a server response either because of an &quot;rspdeny&quot; or\n   &quot;rspideny&quot; filter, or because the response was improperly formatted and\n   not http-compliant, or because it blocked sensitive information which\n   risked being cached. in this case, the response is replaced with a &quot;502\n   bad gateway&quot;. the flags (&quot;ph--&quot;) tell us that it was haproxy who decided\n   to return the 502 and not the server.\n\n&gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34548 [15/oct/2003:15:18:55.798] px-http \\\n      px-http/&lt;nosrv&gt; -1/-1/-1/-1/8490 -1 0 - - cr-- 2/2/2/0/0 0/0 &quot;&quot;\n\n=&gt; the client never completed its request and aborted itself (&quot;c---&quot;) after\n   8.5s, while the proxy was waiting for the request headers (&quot;-r--&quot;).\n   nothing was sent to any server.\n\n&gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34549 [15/oct/2003:15:19:06.103] px-http \\\n     px-http/&lt;nosrv&gt; -1/-1/-1/-1/50001 408 0 - - cr-- 2/2/2/0/0 0/0 &quot;&quot;\n\n=&gt; the client never completed its request, which was aborted by the\n   time-out (&quot;c---&quot;) after 50s, while the proxy was waiting for the request\n   headers (&quot;-r--&quot;).  nothing was sent to any server, but the proxy could\n   send a 408 return code to the client.\n\n&gt;&gt;&gt; haproxy[18989]: 127.0.0.1:34550 [15/oct/2003:15:24:28.312] px-tcp \\\n      px-tcp/srv1 0/0/5007 0 cd 0/0/0/0/0 0/0\n\n=&gt; this log was produced with &quot;option tcplog&quot;. the client timed out after\n   5 seconds (&quot;c----&quot;).\n\n&gt;&gt;&gt; haproxy[18989]: 10.0.0.1:34552 [15/oct/2003:15:26:31.462] px-http \\\n      px-http/srv1 3183/-1/-1/-1/11215 503 0 - - sc-- 205/202/202/115/3 \\\n      0/0 &quot;head / http/1.0&quot;\n\n=&gt; the request took 3s to complete (probably a network problem), and the\n   connection to the server failed (&apos;sc--&apos;) after 4 attempts of 2 seconds\n   (config says &apos;retries 3&apos;), and no redispatch (otherwise we would have\n   seen &quot;/+3&quot;). status code 503 was returned to the client. there were 115\n   connections on this server, 202 connections on this proxy, and 205 on\n   the global process. it is possible that the server refused the\n   connection because of too many already established.\n</code></pre><h2 id=\"9-statistics-and-monitoring\"><a href=\"#9-statistics-and-monitoring\" class=\"headerlink\" title=\"9. statistics and monitoring\"></a>9. statistics and monitoring</h2><p>it is possible to query haproxy about its status. the most commonly used<br>mechanism is the http statistics page. this page also exposes an alternative<br>csv output format for monitoring tools. the same format is provided on the<br>unix socket.</p>\n<h2 id=\"9-1-csv-format\"><a href=\"#9-1-csv-format\" class=\"headerlink\" title=\"9.1. csv format\"></a>9.1. csv format</h2><p>the statistics may be consulted either from the unix socket or from the http<br>page. both means provide a csv format whose fields follow. the first line<br>begins with a sharp (‘#’) and has one word per comma-delimited field which<br>represents the title of the column. all other lines starting at the second one<br>use a classical csv format using a comma as the delimiter, and the double quote<br>(‘“‘) as an optional text delimiter, but only if the enclosed text is ambiguous<br>(if it contains a quote or a comma). the double-quote character (‘“‘) in the<br>text is doubled (‘“”‘), which is the format that most tools recognize. please<br>do not insert any column before these ones in order not to break tools which<br>use hard-coded column positions.</p>\n<p>in brackets after each field name are the types which may have a value for<br>that field. the types are l (listeners), f (frontends), b (backends), and<br>s (servers).</p>\n<p>  0. pxname [lfbs]: proxy name<br>  1. svname [lfbs]: service name (frontend for frontend, backend for backend,<br>     any name for server/listener)<br>  2. qcur [..bs]: current queued requests. for the backend this reports the<br>     number queued without a server assigned.<br>  3. qmax [..bs]: max value of qcur<br>  4. scur [lfbs]: current sessions<br>  5. smax [lfbs]: max sessions<br>  6. slim [lfbs]: configured session limit<br>  7. stot [lfbs]: cumulative number of connections<br>  8. bin [lfbs]: bytes in<br>  9. bout [lfbs]: bytes out<br> 10. dreq [lfb.]: requests denied because of security concerns.</p>\n<pre><code>- for tcp this is because of a matched tcp-request content rule.\n- for http this is because of a matched http-request or tarpit rule.\n</code></pre><p> 11. dresp [lfbs]: responses denied because of security concerns.</p>\n<pre><code>- for http this is because of a matched http-request rule, or\n  &quot;option checkcache&quot;.\n</code></pre><p> 12. ereq [lf..]: request errors. some of the possible causes are:</p>\n<pre><code>- early termination from the client, before the request has been sent.\n- read error from the client\n- client timeout\n- client closed connection\n- various bad requests from the client.\n- request was tarpitted.\n</code></pre><p> 13. econ [..bs]: number of requests that encountered an error trying to<br>     connect to a backend server. the backend stat is the sum of the stat<br>     for all servers of that backend, plus any connection errors not<br>     associated with a particular server (such as the backend having no<br>     active servers).<br> 14. eresp [..bs]: response errors. srv_abrt will be counted here also.<br>     some other errors are:</p>\n<pre><code>- write error on the client socket (won&apos;t be counted for the server stat)\n- failure applying filters to the response.\n</code></pre><p> 15. wretr [..bs]: number of times a connection to a server was retried.<br> 16. wredis [..bs]: number of times a request was redispatched to another<br>     server. the server value counts the number of times that server was<br>     switched away from.<br> 17. status [lfbs]: status (up/down/nolb/maint/maint(via)…)<br> 18. weight [..bs]: total weight (backend), server weight (server)<br> 19. act [..bs]: number of active servers (backend), server is active (server)<br> 20. bck [..bs]: number of backup servers (backend), server is backup (server)<br> 21. chkfail […s]: number of failed checks. (only counts checks failed when<br>     the server is up.)<br> 22. chkdown [..bs]: number of up-&gt;down transitions. the backend counter counts<br>     transitions to the whole backend being down, rather than the sum of the<br>     counters for each server.<br> 23. lastchg [..bs]: number of seconds since the last up&lt;-&gt;down transition<br> 24. downtime [..bs]: total downtime (in seconds). the value for the backend<br>     is the downtime for the whole backend, not the sum of the server downtime.<br> 25. qlimit […s]: configured maxqueue for the server, or nothing in the<br>     value is 0 (default, meaning no limit)<br> 26. pid [lfbs]: process id (0 for first instance, 1 for second, …)<br> 27. iid [lfbs]: unique proxy id<br> 28. sid [l..s]: server id (unique inside a proxy)<br> 29. throttle […s]: current throttle percentage for the server, when<br>     slowstart is active, or no value if not in slowstart.<br> 30. lbtot [..bs]: total number of times a server was selected, either for new<br>     sessions, or when re-dispatching. the server counter is the number<br>     of times that server was selected.<br> 31. tracked […s]: id of proxy/server if tracking is enabled.<br> 32. type [lfbs]: (0=frontend, 1=backend, 2=server, 3=socket/listener)<br> 33. rate [.fbs]: number of sessions per second over last elapsed second<br> 34. rate_lim [.f..]: configured limit on new sessions per second<br> 35. rate_max [.fbs]: max number of new sessions per second<br> 36. check_status […s]: status of last health check, one of:<br>        unk     -&gt; unknown<br>        ini     -&gt; initializing<br>        sockerr -&gt; socket error<br>        l4ok    -&gt; check passed on layer 4, no upper layers testing enabled<br>        l4tout  -&gt; layer 1-4 timeout<br>        l4con   -&gt; layer 1-4 connection problem, for example<br>                   “connection refused” (tcp rst) or “no route to host” (icmp)<br>        l6ok    -&gt; check passed on layer 6<br>        l6tout  -&gt; layer 6 (ssl) timeout<br>        l6rsp   -&gt; layer 6 invalid response - protocol error<br>        l7ok    -&gt; check passed on layer 7<br>        l7okc   -&gt; check conditionally passed on layer 7, for example 404 with<br>                   disable-on-404<br>        l7tout  -&gt; layer 7 (http/smtp) timeout<br>        l7rsp   -&gt; layer 7 invalid response - protocol error<br>        l7sts   -&gt; layer 7 response error, for example http 5xx<br> 37. check_code […s]: layer5-7 code, if available<br> 38. check_duration […s]: time in ms took to finish last health check<br> 39. hrsp_1xx [.fbs]: http responses with 1xx code<br> 40. hrsp_2xx [.fbs]: http responses with 2xx code<br> 41. hrsp_3xx [.fbs]: http responses with 3xx code<br> 42. hrsp_4xx [.fbs]: http responses with 4xx code<br> 43. hrsp_5xx [.fbs]: http responses with 5xx code<br> 44. hrsp_other [.fbs]: http responses with other codes (protocol error)<br> 45. hanafail […s]: failed health checks details<br> 46. req_rate [.f..]: http requests per second over last elapsed second<br> 47. req_rate_max [.f..]: max number of http requests per second observed<br> 48. req_tot [.f..]: total number of http requests received<br> 49. cli_abrt [..bs]: number of data transfers aborted by the client<br> 50. srv_abrt [..bs]: number of data transfers aborted by the server<br>     (inc. in eresp)<br> 51. comp_in [.fb.]: number of http response bytes fed to the compressor<br> 52. comp_out [.fb.]: number of http response bytes emitted by the compressor<br> 53. comp_byp [.fb.]: number of bytes that bypassed the http compressor<br>     (cpu/bw limit)<br> 54. comp_rsp [.fb.]: number of http responses that were compressed<br> 55. lastsess [..bs]: number of seconds since last session assigned to<br>     server/backend<br> 56. last_chk […s]: last health check contents or textual error<br> 57. last_agt […s]: last agent check contents or textual error<br> 58. qtime [..bs]: the average queue time in ms over the 1024 last requests<br> 59. ctime [..bs]: the average connect time in ms over the 1024 last requests<br> 60. rtime [..bs]: the average response time in ms over the 1024 last requests<br>     (0 for tcp)<br> 61. ttime [..bs]: the average total session time in ms over the 1024 last<br>     requests</p>\n<h2 id=\"9-2-unix-socket-commands\"><a href=\"#9-2-unix-socket-commands\" class=\"headerlink\" title=\"9.2. unix socket commands\"></a>9.2. unix socket commands</h2><p>the stats socket is not enabled by default. in order to enable it, it is<br>necessary to add one line in the global section of the haproxy configuration.<br>a second line is recommended to set a larger timeout, always appreciated when<br>issuing commands by hand :</p>\n<pre><code>global\n    stats socket /var/run/haproxy.sock mode 600 level admin\n    stats timeout 2m\n</code></pre><p>it is also possible to add multiple instances of the stats socket by repeating<br>the line, and make them listen to a tcp port instead of a unix socket. this is<br>never done by default because this is dangerous, but can be handy in some<br>situations :</p>\n<pre><code>global\n    stats socket /var/run/haproxy.sock mode 600 level admin\n    stats socket ipv4@192.168.0.1:9999 level admin\n    stats timeout 2m\n</code></pre><p>to access the socket, an external utility such as “socat” is required. socat is a<br>swiss-army knife to connect anything to anything. we use it to connect terminals<br>to the socket, or a couple of stdin/stdout pipes to it for scripts. the two main<br>syntaxes we’ll use are the following :</p>\n<pre><code># socat /var/run/haproxy.sock stdio\n# socat /var/run/haproxy.sock readline\n</code></pre><p>the first one is used with scripts. it is possible to send the output of a<br>script to haproxy, and pass haproxy’s output to another script. that’s useful<br>for retrieving counters or attack traces for example.</p>\n<p>the second one is only useful for issuing commands by hand. it has the benefit<br>that the terminal is handled by the readline library which supports line<br>editing and history, which is very convenient when issuing repeated commands<br>(eg: watch a counter).</p>\n<p>the socket supports two operation modes :</p>\n<ul>\n<li>interactive</li>\n<li>non-interactive</li>\n</ul>\n<p>the non-interactive mode is the default when socat connects to the socket. in<br>this mode, a single line may be sent. it is processed as a whole, responses are<br>sent back, and the connection closes after the end of the response. this is the<br>mode that scripts and monitoring tools use. it is possible to send multiple<br>commands in this mode, they need to be delimited by a semi-colon (‘;’). for<br>example :</p>\n<pre><code># echo &quot;show info;show stat;show table&quot; | socat /var/run/haproxy stdio\n</code></pre><p>the interactive mode displays a prompt (‘&gt;’) and waits for commands to be<br>entered on the line, then processes them, and displays the prompt again to wait<br>for a new command. this mode is entered via the “prompt” command which must be<br>sent on the first line in non-interactive mode. the mode is a flip switch, if<br>“prompt” is sent in interactive mode, it is disabled and the connection closes<br>after processing the last command of the same line.</p>\n<p>for this reason, when debugging by hand, it’s quite common to start with the<br>“prompt” command :</p>\n<h1 id=\"socat-var-run-haproxy-readline\"><a href=\"#socat-var-run-haproxy-readline\" class=\"headerlink\" title=\"socat /var/run/haproxy readline\"></a>socat /var/run/haproxy readline</h1><p>   prompt</p>\n<blockquote>\n<p>show info<br>   …</p>\n</blockquote>\n<p>since multiple commands may be issued at once, haproxy uses the empty line as a<br>delimiter to mark an end of output for each command, and takes care of ensuring<br>that no command can emit an empty line on output. a script can thus easily<br>parse the output even when multiple commands were pipelined on a single line.</p>\n<p>it is important to understand that when multiple haproxy processes are started<br>on the same sockets, any process may pick up the request and will output its<br>own stats.</p>\n<p>the list of commands currently supported on the stats socket is provided below.<br>if an unknown command is sent, haproxy displays the usage message which reminds<br>all supported commands. some commands support a more complex syntax, generally<br>it will explain what part of the command is invalid when this happens.</p>\n<p>add acl <acl> <pattern><br>  add an entry into the acl <acl>. <acl> is the #<id> or the <file> returned by<br>  “show acl”. this command does not verify if the entry already exists. this<br>  command cannot be used if the reference <acl> is a file also used with a map.<br>  in this case, you must use the command “add map” in place of “add acl”.</acl></file></id></acl></acl></pattern></acl></p>\n<p>add map <map> <key> <value><br>  add an entry into the map <map> to associate the value <value> to the key<br>  <key>. this command does not verify if the entry already exists. it is<br>  mainly used to fill a map after a clear operation. note that if the reference<br>  <map> is a file and is shared with a map, this map will contain also a new<br>  pattern entry.</map></key></value></map></value></key></map></p>\n<p>clear counters<br>  clear the max values of the statistics counters in each proxy (frontend &amp;<br>  backend) and in each server. the cumulated counters are not affected. this<br>  can be used to get clean counters after an incident, without having to<br>  restart nor to clear traffic counters. this command is restricted and can<br>  only be issued on sockets configured for levels “operator” or “admin”.</p>\n<p>clear counters all<br>  clear all statistics counters in each proxy (frontend &amp; backend) and in each<br>  server. this has the same effect as restarting. this command is restricted<br>  and can only be issued on sockets configured for level “admin”.</p>\n<p>clear acl <acl><br>  remove all entries from the acl <acl>. <acl> is the #<id> or the <file><br>  returned by “show acl”. note that if the reference <acl> is a file and is<br>  shared with a map, this map will be also cleared.</acl></file></id></acl></acl></acl></p>\n<p>clear map <map><br>  remove all entries from the map <map>. <map> is the #<id> or the <file><br>  returned by “show map”. note that if the reference <map> is a file and is<br>  shared with a acl, this acl will be also cleared.</map></file></id></map></map></map></p>\n<p>clear table <table> [ data.<type> <operator> <value> ] | [ key <key> ]<br>  remove entries from the stick-table <table>.</table></key></value></operator></type></table></p>\n<p>  this is typically used to unblock some users complaining they have been<br>  abusively denied access to a service, but this can also be used to clear some<br>  stickiness entries matching a server that is going to be replaced (see “show<br>  table” below for details).  note that sometimes, removal of an entry will be<br>  refused because it is currently tracked by a session. retrying a few seconds<br>  later after the session ends is usual enough.</p>\n<p>  in the case where no options arguments are given all entries will be removed.</p>\n<p>  when the “data.” form is used entries matching a filter applied using the<br>  stored data (see “stick-table” in section 4.2) are removed.  a stored data<br>  type must be specified in <type>, and this data type must be stored in the<br>  table otherwise an error is reported. the data is compared according to<br>  <operator> with the 64-bit integer <value>.  operators are the same as with<br>  the acls :</value></operator></type></p>\n<pre><code>- eq : match entries whose data is equal to this value\n- ne : match entries whose data is not equal to this value\n- le : match entries whose data is less than or equal to this value\n- ge : match entries whose data is greater than or equal to this value\n- lt : match entries whose data is less than this value\n- gt : match entries whose data is greater than this value\n</code></pre><p>  when the key form is used the entry <key> is removed.  the key must be of the<br>  same type as the table, which currently is limited to ipv4, ipv6, integer and<br>  string.</key></p>\n<p>  example :<br>        $ echo “show table http_proxy” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \\\n      bytes_out_rate(60000)=187\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;clear table http_proxy key 127.0.0.1&quot; | socat stdio /tmp/sock1\n\n    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:1\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n    $ echo &quot;clear table http_proxy data.gpc0 eq 1&quot; | socat stdio /tmp/sock1\n    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:1\n</code></pre><p>del acl <acl> [<key>|#<ref>]<br>  delete all the acl entries from the acl <acl> corresponding to the key <key>.<br>  <acl> is the #<id> or the <file> returned by “show acl”. if the <ref> is used,<br>  this command delete only the listed reference. the reference can be found with<br>  listing the content of the acl. note that if the reference <acl> is a file and<br>  is shared with a map, the entry will be also deleted in the map.</acl></ref></file></id></acl></key></acl></ref></key></acl></p>\n<p>del map <map> [<key>|#<ref>]<br>  delete all the map entries from the map <map> corresponding to the key <key>.<br>  <map> is the #<id> or the <file> returned by “show map”. if the <ref> is used,<br>  this command delete only the listed reference. the reference can be found with<br>  listing the content of the map. note that if the reference <map> is a file and<br>  is shared with a acl, the entry will be also deleted in the map.</map></ref></file></id></map></key></map></ref></key></map></p>\n<p>disable agent <backend>/<server><br>  mark the auxiliary agent check as temporarily stopped.</server></backend></p>\n<p>  in the case where an agent check is being run as a auxiliary check, due<br>  to the agent-check parameter of a server directive, new checks are only<br>  initialised when the agent is in the enabled. thus, disable agent will<br>  prevent any new agent checks from begin initiated until the agent<br>  re-enabled using enable agent.</p>\n<p>  when an agent is disabled the processing of an auxiliary agent check that<br>  was initiated while the agent was set as enabled is as follows: all<br>  results that would alter the weight, specifically “drain” or a weight<br>  returned by the agent, are ignored. the processing of agent check is<br>  otherwise unchanged.</p>\n<p>  the motivation for this feature is to allow the weight changing effects<br>  of the agent checks to be paused to allow the weight of a server to be<br>  configured using set weight without being overridden by the agent.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable frontend <frontend><br>  mark the frontend as temporarily stopped. this corresponds to the mode which<br>  is used during a soft restart : the frontend releases the port but can be<br>  enabled again if needed. this should be used with care as some non-linux oses<br>  are unable to enable it back. this is intended to be used in environments<br>  where stopping a proxy is not even imaginable but a misconfigured proxy must<br>  be fixed. that way it’s possible to release the port and bind it into another<br>  process to restore operations. the frontend will appear with status “stop”<br>  on the stats page.</frontend></p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable health <backend>/<server><br>  mark the primary health check as temporarily stopped. this will disable<br>  sending of health checks, and the last health check result will be ignored.<br>  the server will be in unchecked state and considered up unless an auxiliary<br>  agent check forces it down.</server></backend></p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable server <backend>/<server><br>  mark the server down for maintenance. in this mode, no more checks will be<br>  performed on the server until it leaves maintenance.<br>  if the server is tracked by other servers, those servers will be set to down<br>  during the maintenance.</server></backend></p>\n<p>  in the statistics page, a server down for maintenance will appear with a<br>  “maint” status, its tracking servers with the “maint(via)” one.</p>\n<p>  both the backend and the server may be specified either by their name or by<br>  their numeric id, prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable agent <backend>/<server><br>  resume auxiliary agent check that was temporarily stopped.</server></backend></p>\n<p>  see “disable agent” for details of the effect of temporarily starting<br>  and stopping an auxiliary agent.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable frontend <frontend><br>  resume a frontend which was temporarily stopped. it is possible that some of<br>  the listening ports won’t be able to bind anymore (eg: if another process<br>  took them since the ‘disable frontend’ operation). if this happens, an error<br>  is displayed. some operating systems might not be able to resume a frontend<br>  which was disabled.</frontend></p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable health <backend>/<server><br>  resume a primary health check that was temporarily stopped. this will enable<br>  sending of health checks again. please see “disable health” for details.</server></backend></p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable server <backend>/<server><br>  if the server was previously marked as down for maintenance, this marks the<br>  server up and checks are re-enabled.</server></backend></p>\n<p>  both the backend and the server may be specified either by their name or by<br>  their numeric id, prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>get map <map> <value><br>get acl <acl> <value><br>  lookup the value <value> in the map <map> or in the acl <acl>. <map> or <acl><br>  are the #<id> or the <file> returned by “show map” or “show acl”. this command<br>  returns all the matching patterns associated with this map. this is useful for<br>  debugging maps and acls. the output format is composed by one line par<br>  matching type. each line is composed by space-delimited series of words.</file></id></acl></map></acl></map></value></value></acl></value></map></p>\n<p>  the first two words are:</p>\n<pre><code>&lt;match method&gt;:   the match method applied. it can be &quot;found&quot;, &quot;bool&quot;,\n                  &quot;int&quot;, &quot;ip&quot;, &quot;bin&quot;, &quot;len&quot;, &quot;str&quot;, &quot;beg&quot;, &quot;sub&quot;, &quot;dir&quot;,\n                  &quot;dom&quot;, &quot;end&quot; or &quot;reg&quot;.\n\n&lt;match result&gt;:   the result. can be &quot;match&quot; or &quot;no-match&quot;.\n</code></pre><p>  the following words are returned only if the pattern matches an entry.</p>\n<pre><code>&lt;index type&gt;:     &quot;tree&quot; or &quot;list&quot;. the internal lookup algorithm.\n\n&lt;case&gt;:           &quot;case-insensitive&quot; or &quot;case-sensitive&quot;. the\n                  interpretation of the case.\n\n&lt;entry matched&gt;:  match=&quot;&lt;entry&gt;&quot;. return the matched pattern. it is\n                  useful with regular expressions.\n</code></pre><p>  the two last word are used to show the returned value and its type. with the<br>  “acl” case, the pattern doesn’t exist.</p>\n<pre><code>return=nothing:        no return because there are no &quot;map&quot;.\nreturn=&quot;&lt;value&gt;&quot;:      the value returned in the string format.\nreturn=cannot-display: the value cannot be converted as string.\n\ntype=&quot;&lt;type&gt;&quot;:         the type of the returned sample.\n</code></pre><p>get weight <backend>/<server><br>  report the current weight and the initial weight of server <server> in<br>  backend <backend> or an error if either doesn’t exist. the initial weight is<br>  the one that appears in the configuration file. both are normally equal<br>  unless the current weight has been changed. both the backend and the server<br>  may be specified either by their name or by their numeric id, prefixed with a<br>  sharp (‘#’).</backend></server></server></backend></p>\n<p>help<br>  print the list of known keywords and their basic usage. the same help screen<br>  is also displayed for unknown commands.</p>\n<p>prompt<br>  toggle the prompt at the beginning of the line and enter or leave interactive<br>  mode. in interactive mode, the connection is not closed after a command<br>  completes. instead, the prompt will appear again, indicating the user that<br>  the interpreter is waiting for a new command. the prompt consists in a right<br>  angle bracket followed by a space “&gt; “. this mode is particularly convenient<br>  when one wants to periodically check information such as stats or errors.<br>  it is also a good idea to enter interactive mode before issuing a “help”<br>  command.</p>\n<p>quit<br>  close the connection when in interactive mode.</p>\n<p>set map <map> [<key>|#<ref>] <value><br>  modify the value corresponding to each key <key> in a map <map>. <map> is the</map></map></key></value></ref></key></map></p>\n<p>  #<id> or <file> returned by “show map”. if the <ref> is used in place of<br>  <key>, only the entry pointed by <ref> is changed. the new value is <value>.</value></ref></key></ref></file></id></p>\n<p>set maxconn frontend <frontend> <value><br>  dynamically change the specified frontend’s maxconn setting. any positive<br>  value is allowed including zero, but setting values larger than the global<br>  maxconn does not make much sense. if the limit is increased and connections<br>  were pending, they will immediately be accepted. if it is lowered to a value<br>  below the current number of connections, new connections acceptation will be<br>  delayed until the threshold is reached. the frontend might be specified by<br>  either its name or its numeric id prefixed with a sharp (‘#’).</value></frontend></p>\n<p>set maxconn global <maxconn><br>  dynamically change the global maxconn setting within the range defined by the<br>  initial global maxconn setting. if it is increased and connections were<br>  pending, they will immediately be accepted. if it is lowered to a value below<br>  the current number of connections, new connections acceptation will be<br>  delayed until the threshold is reached. a value of zero restores the initial<br>  setting.</maxconn></p>\n<p>set rate-limit connections global <value><br>  change the process-wide connection rate limit, which is set by the global<br>  ‘maxconnrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of connections per second.</value></p>\n<p>set rate-limit http-compression global <value><br>  change the maximum input compression rate, which is set by the global<br>  ‘maxcomprate’ setting. a value of zero disables the limitation. the value is<br>  passed in number of kilobytes per second. the value is available in the “show<br>  info” on the line “compressbpsratelim” in bytes.</value></p>\n<p>set rate-limit sessions global <value><br>  change the process-wide session rate limit, which is set by the global<br>  ‘maxsessrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of sessions per second.</value></p>\n<p>set rate-limit ssl-sessions global <value><br>  change the process-wide ssl session rate limit, which is set by the global<br>  ‘maxsslrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of sessions per second sent to the ssl stack. it applies<br>  before the handshake in order to protect the stack against handshake abuses.</value></p>\n<p>set server <backend>/<server> addr <ip4 or=\"\" ip6=\"\" address=\"\"><br>  replace the current ip address of a server by the one provided.</ip4></server></backend></p>\n<p>set server <backend>/<server> agent [ up | down ]<br>  force a server’s agent to a new state. this can be useful to immediately<br>  switch a server’s state regardless of some slow agent checks for example.<br>  note that the change is propagated to tracking servers if any.</server></backend></p>\n<p>set server <backend>/<server> health [ up | stopping | down ]<br>  force a server’s health to a new state. this can be useful to immediately<br>  switch a server’s state regardless of some slow health checks for example.<br>  note that the change is propagated to tracking servers if any.</server></backend></p>\n<p>set server <backend>/<server> state [ ready | drain | maint ]<br>  force a server’s administrative state to a new state. this can be useful to<br>  disable load balancing and/or any traffic to a server. setting the state to<br>  “ready” puts the server in normal mode, and the command is the equivalent of<br>  the “enable server” command. setting the state to “maint” disables any traffic<br>  to the server as well as any health checks. this is the equivalent of the<br>  “disable server” command. setting the mode to “drain” only removes the server<br>  from load balancing but still allows it to be checked and to accept new<br>  persistent connections. changes are propagated to tracking servers if any.</server></backend></p>\n<p>set server <backend>/<server> weight <weight>[%]<br>  change a server’s weight to the value passed in argument. this is the exact<br>  equivalent of the “set weight” command below.</weight></server></backend></p>\n<p>set ssl ocsp-response <response><br>  this command is used to update an ocsp response for a certificate (see “crt”<br>  on “bind” lines). same controls are performed as during the initial loading of<br>  the response. the <response> must be passed as a base64 encoded string of the<br>  der encoded response from the ocsp server.</response></response></p>\n<p>  example:<br>    openssl ocsp -issuer issuer.pem -cert server.pem \\<br>                 -host ocsp.issuer.com:80 -respout resp.der<br>    echo “set ssl ocsp-response $(base64 -w 10000 resp.der)” | \\<br>                 socat stdio /var/run/haproxy.stat</p>\n<p>set ssl tls-key <id> <tlskey><br>  set the next tls key for the <id> listener to <tlskey>. this key becomes the<br>  ultimate key, while the penultimate one is used for encryption (others just<br>  decrypt). the oldest tls key present is overwritten. <id> is either a numeric</id></tlskey></id></tlskey></id></p>\n<p>  #<id> or <file> returned by “show tls-keys”. <tlskey> is a base64 encoded 48<br>  bit tls ticket key (ex. openssl rand -base64 48).</tlskey></file></id></p>\n<p>set table <table> key <key> [data.<data_type> <value>]*<br>  create or update a stick-table entry in the table. if the key is not present,<br>  an entry is inserted. see stick-table in section 4.2 to find all possible<br>  values for <data_type>. the most likely use consists in dynamically entering<br>  entries for source ip addresses, with a flag in gpc0 to dynamically block an<br>  ip address or affect its quality of service. it is possible to pass multiple<br>  data_types in a single call.</data_type></value></data_type></key></table></p>\n<p>set timeout cli <delay><br>  change the cli interface timeout for current connection. this can be useful<br>  during long debugging sessions where the user needs to constantly inspect<br>  some indicators without being disconnected. the delay is passed in seconds.</delay></p>\n<p>set weight <backend>/<server> <weight>[%]<br>  change a server’s weight to the value passed in argument. if the value ends<br>  with the ‘%’ sign, then the new weight will be relative to the initially<br>  configured weight.  absolute weights are permitted between 0 and 256.<br>  relative weights must be positive with the resulting absolute weight is<br>  capped at 256.  servers which are part of a farm running a static<br>  load-balancing algorithm have stricter limitations because the weight<br>  cannot change once set. thus for these servers, the only accepted values<br>  are 0 and 100% (or 0 and the initial weight). changes take effect<br>  immediately, though certain lb algorithms require a certain amount of<br>  requests to consider changes. a typical usage of this command is to<br>  disable a server during an update by setting its weight to zero, then to<br>  enable it again after the update by setting it back to 100%. this command<br>  is restricted and can only be issued on sockets configured for level<br>  “admin”. both the backend and the server may be specified either by their<br>  name or by their numeric id, prefixed with a sharp (‘#’).</weight></server></backend></p>\n<p>show errors [<iid>]<br>  dump last known request and response errors collected by frontends and<br>  backends. if <iid> is specified, the limit the dump to errors concerning<br>  either frontend or backend whose id is <iid>. this command is restricted<br>  and can only be issued on sockets configured for levels “operator” or<br>  “admin”.</iid></iid></iid></p>\n<p>  the errors which may be collected are the last request and response errors<br>  caused by protocol violations, often due to invalid characters in header<br>  names. the report precisely indicates what exact character violated the<br>  protocol. other important information such as the exact date the error was<br>  detected, frontend and backend names, the server name (when known), the<br>  internal session id and the source address which has initiated the session<br>  are reported too.</p>\n<p>  all characters are returned, and non-printable characters are encoded. the<br>  most common ones (\\t = 9, \\n = 10, \\r = 13 and \\e = 27) are encoded as one<br>  letter following a backslash. the backslash itself is encoded as ‘\\‘ to<br>  avoid confusion. other non-printable characters are encoded ‘\\xnn’ where<br>  nn is the two-digits hexadecimal representation of the character’s ascii<br>  code.</p>\n<p>  lines are prefixed with the position of their first character, starting at 0<br>  for the beginning of the buffer. at most one input line is printed per line,<br>  and large lines will be broken into multiple consecutive output lines so that<br>  the output never goes beyond 79 characters wide. it is easy to detect if a<br>  line was broken, because it will not end with ‘\\n’ and the next line’s offset<br>  will be followed by a ‘+’ sign, indicating it is a continuation of previous<br>  line.</p>\n<p>  example :<br>        $ echo “show errors” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; [04/mar/2009:15:46:56.081] backend http-in (#2) : invalid response\n      src 127.0.0.1, session #54, frontend fe-eth0 (#1), server s2 (#1)\n      response length 213 bytes, error at position 23:\n\n      00000  http/1.0 200 ok\\r\\n\n      00017  header/bizarre:blah\\r\\n\n      00038  location: blah\\r\\n\n      00054  long-line: this is a very long line which should b\n      00104+ e broken into multiple lines on the output buffer,\n      00154+  otherwise it would be too large to print in a ter\n      00204+ minal\\r\\n\n      00211  \\r\\n\n\nin the example above, we see that the backend &quot;http-in&quot; which has internal\nid 2 has blocked an invalid response from its server s2 which has internal\nid 1\\. the request was on session 54 initiated by source 127.0.0.1 and\nreceived by frontend fe-eth0 whose id is 1\\. the total response length was\n213 bytes when the error was detected, and the error was at byte 23\\. this\nis the slash (&apos;/&apos;) in header name &quot;header/bizarre&quot;, which is not a valid\nhttp character for a header name.\n</code></pre><p>show info<br>  dump info about haproxy status on current process.</p>\n<p>show map [<map>]<br>  dump info about map converters. without argument, the list of all available<br>  maps is returned. if a <map> is specified, its contents are dumped. <map> is<br>  the #<id> or <file>. the first column is a unique identifier. it can be used<br>  as reference for the operation “del map” and “set map”. the second column is<br>  the pattern and the third column is the sample if available. the data returned<br>  are not directly a list of available maps, but are the list of all patterns<br>  composing any map. many of these patterns can be shared with acl.</file></id></map></map></map></p>\n<p>show acl [<acl>]<br>  dump info about acl converters. without argument, the list of all available<br>  acls is returned. if a <acl> is specified, its contents are dumped. <acl> if<br>  the #<id> or <file>. the dump format is the same than the map even for the<br>  sample value. the data returned are not a list of available acl, but are the<br>  list of all patterns composing any acl. many of these patterns can be shared<br>  with maps.</file></id></acl></acl></acl></p>\n<p>show pools<br>  dump the status of internal memory pools. this is useful to track memory<br>  usage when suspecting a memory leak for example. it does exactly the same<br>  as the sigquit when running in foreground except that it does not flush<br>  the pools.</p>\n<p>show sess<br>  dump all known sessions. avoid doing this on slow connections as this can<br>  be huge. this command is restricted and can only be issued on sockets<br>  configured for levels “operator” or “admin”.</p>\n<p>show sess <id><br>  display a lot of internal information about the specified session identifier.<br>  this identifier is the first field at the beginning of the lines in the dumps<br>  of “show sess” (it corresponds to the session pointer). those information are<br>  useless to most users but may be used by haproxy developers to troubleshoot a<br>  complex bug. the output format is intentionally not documented so that it can<br>  freely evolve depending on demands. you may find a description of all fields<br>  returned in src/dumpstats.c</id></p>\n<p>  the special id “all” dumps the states of all sessions, which must be avoided<br>  as much as possible as it is highly cpu intensive and can take a lot of time.</p>\n<p>show stat [<iid> <type> <sid>]<br>  dump statistics in the csv format. by passing <id>, <type> and <sid>, it is<br>  possible to dump only selected items :</sid></type></id></sid></type></iid></p>\n<pre><code>- &lt;iid&gt; is a proxy id, -1 to dump everything\n- &lt;type&gt; selects the type of dumpable objects : 1 for frontends, 2 for\n   backends, 4 for servers, -1 for everything. these values can be ored,\n   for example:\n      1 + 2     = 3   -&gt; frontend + backend.\n      1 + 2 + 4 = 7   -&gt; frontend + backend + server.\n- &lt;sid&gt; is a server id, -1 to dump everything from the selected proxy.\n</code></pre><p>  example :<br>        $ echo “show info;show stat” | socat stdio unix-connect:/tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; name: haproxy\n    version: 1.4-dev2-49\n    release_date: 2009/09/23\n    nbproc: 1\n    process_num: 1\n    (...)\n\n    # pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)\n    stats,frontend,,,0,0,1000,0,0,0,0,0,0,,,,,open,,,,,,,,,1,1,0, (...)\n    stats,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,0,0,0,,0,250,(...)\n    (...)\n    www1,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,1,1,0,,0,250, (...)\n\n    $\n\nhere, two commands have been issued at once. that way it&apos;s easy to find\nwhich process the stats apply to in multi-process mode. notice the empty\nline after the information output which marks the end of the first block.\na similar empty line appears at the end of the second block (stats) so that\nthe reader knows the output has not been truncated.\n</code></pre><p>show stat resolvers <resolvers section=\"\" id=\"\"><br>  dump statistics for the given resolvers section.<br>  for each name server, the following counters are reported:<br>    sent: number of dns requests sent to this server<br>    valid: number of dns valid responses received from this server<br>    update: number of dns responses used to update the server’s ip address<br>    cname: number of cname responses<br>    cname_error: cname errors encountered with this server<br>    any_err: number of empty response (ie: server does not support any type)<br>    nx: non existent domain response received from this server<br>    timeout: how many time this server did not answer in time<br>    refused: number of requests refused by this server<br>    other: any other dns errors<br>    invalid: invalid dns response (from a protocol point of view)<br>    too_big: too big response<br>    outdated: number of response arrived too late (after an other name server)<br>show table<br>  dump general information on all known stick-tables. their name is returned<br>  (the name of the proxy which holds them), their type (currently zero, always<br>  ip), their size in maximum possible number of entries, and the number of<br>  entries currently in use.</resolvers></p>\n<p>  example :<br>        $ echo “show table” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: front_pub, type: ip, size:204800, used:171454\n&gt;&gt;&gt; # table: back_rdp, type: ip, size:204800, used:0\n</code></pre><p>show table <name> [ data.<type> <operator> <value> ] | [ key <key> ]<br>  dump contents of stick-table <name>. in this mode, a first line of generic<br>  information about the table is reported as with “show table”, then all<br>  entries are dumped. since this can be quite heavy, it is possible to specify<br>  a filter in order to specify what entries to display.</name></key></value></operator></type></name></p>\n<p>  when the “data.” form is used the filter applies to the stored data (see<br>  “stick-table” in section 4.2).  a stored data type must be specified<br>  in <type>, and this data type must be stored in the table otherwise an<br>  error is reported. the data is compared according to <operator> with the<br>  64-bit integer <value>.  operators are the same as with the acls :</value></operator></type></p>\n<pre><code>- eq : match entries whose data is equal to this value\n- ne : match entries whose data is not equal to this value\n- le : match entries whose data is less than or equal to this value\n- ge : match entries whose data is greater than or equal to this value\n- lt : match entries whose data is less than this value\n- gt : match entries whose data is greater than this value\n</code></pre><p>  when the key form is used the entry <key> is shown.  the key must be of the<br>  same type as the table, which currently is limited to ipv4, ipv6, integer,<br>  and string.</key></p>\n<p>  example :<br>        $ echo “show table http_proxy” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \\\n      bytes_out_rate(60000)=187\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy data.gpc0 gt 0&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy data.conn_rate gt 5&quot; | \\\n        socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy key 127.0.0.2&quot; | \\\n        socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n</code></pre><p>  when the data criterion applies to a dynamic value dependent on time such as<br>  a bytes rate, the value is dynamically computed during the evaluation of the<br>  entry in order to decide whether it has to be dumped or not. this means that<br>  such a filter could match for some time then not match anymore because as<br>  time goes, the average event rate drops.</p>\n<p>  it is possible to use this to extract lists of ip addresses abusing the<br>  service, in order to monitor them or even blacklist them in a firewall.<br>  example :<br>        $ echo “show table http_proxy data.gpc0 gt 0” \\<br>          | socat stdio /tmp/sock1 \\<br>          | fgrep ‘key=’ | cut -d’ ‘ -f2 | cut -d= -f2 &gt; abusers-ip.txt<br>          ( or | awk ‘/key/{ print a[split($2,a,”=”)]; }’ )</p>\n<p>show tls-keys<br>  dump all loaded tls ticket keys. the tls ticket key reference id and the<br>  file from which the keys have been loaded is shown. both of those can be<br>  used to update the tls keys using “set ssl tls-key”.</p>\n<p>shutdown frontend <frontend><br>  completely delete the specified frontend. all the ports it was bound to will<br>  be released. it will not be possible to enable the frontend anymore after<br>  this operation. this is intended to be used in environments where stopping a<br>  proxy is not even imaginable but a misconfigured proxy must be fixed. that<br>  way it’s possible to release the port and bind it into another process to<br>  restore operations. the frontend will not appear at all on the stats page<br>  once it is terminated.</frontend></p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>shutdown session <id><br>  immediately terminate the session matching the specified session identifier.<br>  this identifier is the first field at the beginning of the lines in the dumps<br>  of “show sess” (it corresponds to the session pointer). this can be used to<br>  terminate a long-running session without waiting for a timeout or when an<br>  endless transfer is ongoing. such terminated sessions are reported with a ‘k’<br>  flag in the logs.</id></p>\n<p>shutdown sessions server <backend>/<server><br>  immediately terminate all the sessions attached to the specified server. this<br>  can be used to terminate long-running sessions after a server is put into<br>  maintenance mode, for instance. such terminated sessions are reported with a<br>  ‘k’ flag in the logs.</server></backend></p>\n<p>/*</p>\n<ul>\n<li>local variables:</li>\n<li>fill-column: 79</li>\n<li>end:<br>*/</li>\n</ul>\n","excerpt":"","more":"<hr>\n<pre><code>       haproxy\n configuration manual\n----------------------\n     version 1.6\n    willy tarreau\n     2015/07/22\n</code></pre><p>this document covers the configuration language as implemented in the version<br>specified above. it does not provide any hint, example or advice. for such<br>documentation, please refer to the reference manual or the architecture manual.<br>the summary below is meant to help you search sections by name and navigate<br>through the document.</p>\n<p>note to documentation contributors :<br>    this document is formatted with 80 columns per line, with even number of<br>    spaces for indentation and without tabs. please follow these rules strictly<br>    so that it remains easily printable everywhere. if a line needs to be<br>    printed verbatim and does not fit, please end each line with a backslash<br>    (‘\\’) and continue on next line, indented by two characters. it is also<br>    sometimes useful to prefix all output lines (logs, console outs) with 3<br>    closing angle brackets (‘&gt;&gt;&gt;’) in order to help get the difference between<br>    inputs and outputs when it can become ambiguous. if you add sections,<br>    please update the summary below for easier searching.</p>\n<h2 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h2><p>1.    quick reminder about http<br>1.1.      the http transaction model<br>1.2.      http request<br>1.2.1.        the request line<br>1.2.2.        the request headers<br>1.3.      http response<br>1.3.1.        the response line<br>1.3.2.        the response headers</p>\n<p>2.    configuring haproxy<br>2.1.      configuration file format<br>2.2.      quoting and escaping<br>2.3.      environment variables<br>2.4.      time format<br>2.5.      examples</p>\n<p>3.    global parameters<br>3.1.      process management and security<br>3.2.      performance tuning<br>3.3.      debugging<br>3.4.      userlists<br>3.5.      peers</p>\n<p>4.    proxies<br>4.1.      proxy keywords matrix<br>4.2.      alphabetically sorted keywords reference</p>\n<p>5.    bind and server options<br>5.1.      bind options<br>5.2.      server and default-server options<br>5.3.      server dns resolution<br>5.3.1.      global overview<br>5.3.2.      the resolvers section</p>\n<p>6.    http header manipulation</p>\n<p>7.    using acls and fetching samples<br>7.1.      acl basics<br>7.1.1.      matching booleans<br>7.1.2.      matching integers<br>7.1.3.      matching strings<br>7.1.4.      matching regular expressions (regexes)<br>7.1.5.      matching arbitrary data blocks<br>7.1.6.      matching ipv4 and ipv6 addresses<br>7.2.      using acls to form conditions<br>7.3.      fetching samples<br>7.3.1.        converters<br>7.3.2.        fetching samples from internal states<br>7.3.3.        fetching samples at layer 4<br>7.3.4.        fetching samples at layer 5<br>7.3.5.        fetching samples from buffer contents (layer 6)<br>7.3.6.        fetching http samples (layer 7)<br>7.4.      pre-defined acls</p>\n<p>8.    logging<br>8.1.      log levels<br>8.2.      log formats<br>8.2.1.        default log format<br>8.2.2.        tcp log format<br>8.2.3.        http log format<br>8.2.4.        custom log format<br>8.2.5.        error log format<br>8.3.      advanced logging options<br>8.3.1.        disabling logging of external tests<br>8.3.2.        logging before waiting for the session to terminate<br>8.3.3.        raising log level upon errors<br>8.3.4.        disabling logging of successful connections<br>8.4.      timing events<br>8.5.      session state at disconnection<br>8.6.      non-printable characters<br>8.7.      capturing http cookies<br>8.8.      capturing http headers<br>8.9.      examples of logs</p>\n<p>9.    statistics and monitoring<br>9.1.      csv format<br>9.2.      unix socket commands</p>\n<h2 id=\"1-quick-reminder-about-http\"><a href=\"#1-quick-reminder-about-http\" class=\"headerlink\" title=\"1. quick reminder about http\"></a>1. quick reminder about http</h2><p>when haproxy is running in http mode, both the request and the response are<br>fully analyzed and indexed, thus it becomes possible to build matching criteria<br>on almost anything found in the contents.</p>\n<p>however, it is important to understand how http requests and responses are<br>formed, and how haproxy decomposes them. it will then become easier to write<br>correct rules and to debug existing configurations.</p>\n<h2 id=\"1-1-the-http-transaction-model\"><a href=\"#1-1-the-http-transaction-model\" class=\"headerlink\" title=\"1.1. the http transaction model\"></a>1.1. the http transaction model</h2><p>the http protocol is transaction-driven. this means that each request will lead<br>to one and only one response. traditionally, a tcp connection is established<br>from the client to the server, a request is sent by the client on the<br>connection, the server responds and the connection is closed. a new request<br>will involve a new connection :</p>\n<p>  [con1] [req1] … [resp1] [clo1] [con2] [req2] … [resp2] [clo2] …</p>\n<p>in this mode, called the “http close” mode, there are as many connection<br>establishments as there are http transactions. since the connection is closed<br>by the server after the response, the client does not need to know the content<br>length.</p>\n<p>due to the transactional nature of the protocol, it was possible to improve it<br>to avoid closing a connection between two subsequent transactions. in this mode<br>however, it is mandatory that the server indicates the content length for each<br>response so that the client does not wait indefinitely. for this, a special<br>header is used: “content-length”. this mode is called the “keep-alive” mode :</p>\n<p>  [con] [req1] … [resp1] [req2] … [resp2] [clo] …</p>\n<p>its advantages are a reduced latency between transactions, and less processing<br>power required on the server side. it is generally better than the close mode,<br>but not always because the clients often limit their concurrent connections to<br>a smaller value.</p>\n<p>a last improvement in the communications is the pipelining mode. it still uses<br>keep-alive, but the client does not wait for the first response to send the<br>second request. this is useful for fetching large number of images composing a<br>page :</p>\n<p>  [con] [req1] [req2] … [resp1] [resp2] [clo] …</p>\n<p>this can obviously have a tremendous benefit on performance because the network<br>latency is eliminated between subsequent requests. many http agents do not<br>correctly support pipelining since there is no way to associate a response with<br>the corresponding request in http. for this reason, it is mandatory for the<br>server to reply in the exact same order as the requests were received.</p>\n<p>by default haproxy operates in keep-alive mode with regards to persistent<br>connections: for each connection it processes each request and response, and<br>leaves the connection idle on both sides between the end of a response and the<br>start of a new request.</p>\n<p>haproxy supports 5 connection modes :</p>\n<ul>\n<li>keep alive    : all requests and responses are processed (default)</li>\n<li>tunnel        : only the first request and response are processed,<pre><code>everything else is forwarded with no analysis.\n</code></pre></li>\n<li>passive close : tunnel with “connection: close” added in both directions.</li>\n<li>server close  : the server-facing connection is closed after the response.</li>\n<li>forced close  : the connection is actively closed after end of response.</li>\n</ul>\n<h2 id=\"1-2-http-request\"><a href=\"#1-2-http-request\" class=\"headerlink\" title=\"1.2. http request\"></a>1.2. http request</h2><p>first, let’s consider this http request :</p>\n<p>  line     contents<br>  number<br>     1     get /serv/login.php?lang=en&amp;profile=2 http/1.1<br>     2     host: www.mydomain.com<br>     3     user-agent: my small browser<br>     4     accept: image/jpeg, image/gif<br>     5     accept: image/png</p>\n<h2 id=\"1-2-1-the-request-line\"><a href=\"#1-2-1-the-request-line\" class=\"headerlink\" title=\"1.2.1. the request line\"></a>1.2.1. the request line</h2><p>line 1 is the “request line”. it is always composed of 3 fields :</p>\n<ul>\n<li>a method      : get</li>\n<li>a uri         : /serv/login.php?lang=en&amp;profile=2</li>\n<li>a version tag : http/1.1</li>\n</ul>\n<p>all of them are delimited by what the standard calls lws (linear white spaces),<br>which are commonly spaces, but can also be tabs or line feeds/carriage returns<br>followed by spaces/tabs. the method itself cannot contain any colon (‘:’) and<br>is limited to alphabetic letters. all those various combinations make it<br>desirable that haproxy performs the splitting itself rather than leaving it to<br>the user to write a complex or inaccurate regular expression.</p>\n<p>the uri itself can have several forms :</p>\n<ul>\n<li><p>a “relative uri” :</p>\n<p>  /serv/login.php?lang=en&amp;profile=2</p>\n<p>it is a complete url without the host part. this is generally what is<br>received by servers, reverse proxies and transparent proxies.</p>\n</li>\n<li><p>an “absolute uri”, also called a “url” :</p>\n<p>  <a href=\"http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2\">http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2</a></p>\n<p>it is composed of a “scheme” (the protocol name followed by ‘://‘), a host<br>name or address, optionally a colon (‘:’) followed by a port number, then<br>a relative uri beginning at the first slash (‘/‘) after the address part.<br>this is generally what proxies receive, but a server supporting http/1.1<br>must accept this form too.</p>\n</li>\n<li><p>a star (‘*’) : this form is only accepted in association with the options<br>method and is not relayable. it is used to inquiry a next hop’s<br>capabilities.</p>\n</li>\n<li><p>an address:port combination : 192.168.0.12:80<br>this is used with the connect method, which is used to establish tcp<br>tunnels through http proxies, generally for https, but sometimes for<br>other protocols too.</p>\n</li>\n</ul>\n<p>in a relative uri, two sub-parts are identified. the part before the question<br>mark is called the “path”. it is typically the relative path to static objects<br>on the server. the part after the question mark is called the “query string”.<br>it is mostly used with get requests sent to dynamic scripts and is very<br>specific to the language, framework or application in use.</p>\n<h2 id=\"1-2-2-the-request-headers\"><a href=\"#1-2-2-the-request-headers\" class=\"headerlink\" title=\"1.2.2. the request headers\"></a>1.2.2. the request headers</h2><p>the headers start at the second line. they are composed of a name at the<br>beginning of the line, immediately followed by a colon (‘:’). traditionally,<br>an lws is added after the colon but that’s not required. then come the values.<br>multiple identical headers may be folded into one single line, delimiting the<br>values with commas, provided that their order is respected. this is commonly<br>encountered in the “cookie:” field. a header may span over multiple lines if<br>the subsequent lines begin with an lws. in the example in 1.2, lines 4 and 5<br>define a total of 3 values for the “accept:” header.</p>\n<p>contrary to a common mis-conception, header names are not case-sensitive, and<br>their values are not either if they refer to other header names (such as the<br>“connection:” header).</p>\n<p>the end of the headers is indicated by the first empty line. people often say<br>that it’s a double line feed, which is not exact, even if a double line feed<br>is one valid form of empty line.</p>\n<p>fortunately, haproxy takes care of all these complex combinations when indexing<br>headers, checking values and counting them, so there is no reason to worry<br>about the way they could be written, but it is important not to accuse an<br>application of being buggy if it does unusual, valid things.</p>\n<p>important note:<br>   as suggested by rfc2616, haproxy normalizes headers by replacing line breaks<br>   in the middle of headers by lws in order to join multi-line headers. this<br>   is necessary for proper analysis and helps less capable http parsers to work<br>   correctly and not to be fooled by such complex constructs.</p>\n<h2 id=\"1-3-http-response\"><a href=\"#1-3-http-response\" class=\"headerlink\" title=\"1.3. http response\"></a>1.3. http response</h2><p>an http response looks very much like an http request. both are called http<br>messages. let’s consider this http response :</p>\n<p>  line     contents<br>  number<br>     1     http/1.1 200 ok<br>     2     content-length: 350<br>     3     content-type: text/html</p>\n<p>as a special case, http supports so called “informational responses” as status<br>codes 1xx. these messages are special in that they don’t convey any part of the<br>response, they’re just used as sort of a signaling message to ask a client to<br>continue to post its request for instance. in the case of a status 100 response<br>the requested information will be carried by the next non-100 response message<br>following the informational one. this implies that multiple responses may be<br>sent to a single request, and that this only works when keep-alive is enabled<br>(1xx messages are http/1.1 only). haproxy handles these messages and is able to<br>correctly forward and skip them, and only process the next non-100 response. as<br>such, these messages are neither logged nor transformed, unless explicitly<br>state otherwise. status 101 messages indicate that the protocol is changing<br>over the same connection and that haproxy must switch to tunnel mode, just as<br>if a connect had occurred. then the upgrade header would contain additional<br>information about the type of protocol the connection is switching to.</p>\n<h2 id=\"1-3-1-the-response-line\"><a href=\"#1-3-1-the-response-line\" class=\"headerlink\" title=\"1.3.1. the response line\"></a>1.3.1. the response line</h2><p>line 1 is the “response line”. it is always composed of 3 fields :</p>\n<ul>\n<li>a version tag : http/1.1</li>\n<li>a status code : 200</li>\n<li>a reason      : ok</li>\n</ul>\n<p>the status code is always 3-digit. the first digit indicates a general status :</p>\n<ul>\n<li>1xx = informational message to be skipped (eg: 100, 101)</li>\n<li>2xx = ok, content is following   (eg: 200, 206)</li>\n<li>3xx = ok, no content following   (eg: 302, 304)</li>\n<li>4xx = error caused by the client (eg: 401, 403, 404)</li>\n<li>5xx = error caused by the server (eg: 500, 502, 503)</li>\n</ul>\n<p>please refer to rfc2616 for the detailed meaning of all such codes. the<br>“reason” field is just a hint, but is not parsed by clients. anything can be<br>found there, but it’s a common practice to respect the well-established<br>messages. it can be composed of one or multiple words, such as “ok”, “found”,<br>or “authentication required”.</p>\n<p>haproxy may emit the following status codes by itself :</p>\n<p>  code  when / reason<br>   200  access to stats page, and when replying to monitoring requests<br>   301  when performing a redirection, depending on the configured code<br>   302  when performing a redirection, depending on the configured code<br>   303  when performing a redirection, depending on the configured code<br>   307  when performing a redirection, depending on the configured code<br>   308  when performing a redirection, depending on the configured code<br>   400  for an invalid or too large request<br>   401  when an authentication is required to perform the action (when<br>        accessing the stats page)<br>   403  when a request is forbidden by a “block” acl or “reqdeny” filter<br>   408  when the request timeout strikes before the request is complete<br>   500  when haproxy encounters an unrecoverable internal error, such as a<br>        memory allocation failure, which should never happen<br>   502  when the server returns an empty, invalid or incomplete response, or<br>        when an “rspdeny” filter blocks the response.<br>   503  when no server was available to handle the request, or in response to<br>        monitoring requests which match the “monitor fail” condition<br>   504  when the response timeout strikes before the server responds</p>\n<p>the error 4xx and 5xx codes above may be customized (see “errorloc” in section<br>4.2).</p>\n<h2 id=\"1-3-2-the-response-headers\"><a href=\"#1-3-2-the-response-headers\" class=\"headerlink\" title=\"1.3.2. the response headers\"></a>1.3.2. the response headers</h2><p>response headers work exactly like request headers, and as such, haproxy uses<br>the same parsing function for both. please refer to paragraph 1.2.2 for more<br>details.</p>\n<h2 id=\"2-configuring-haproxy\"><a href=\"#2-configuring-haproxy\" class=\"headerlink\" title=\"2. configuring haproxy\"></a>2. configuring haproxy</h2><h2 id=\"2-1-configuration-file-format\"><a href=\"#2-1-configuration-file-format\" class=\"headerlink\" title=\"2.1. configuration file format\"></a>2.1. configuration file format</h2><p>haproxy’s configuration process involves 3 major sources of parameters :</p>\n<ul>\n<li>the arguments from the command-line, which always take precedence</li>\n<li>the “global” section, which sets process-wide parameters</li>\n<li>the proxies sections which can take form of “defaults”, “listen”,<br>“frontend” and “backend”.</li>\n</ul>\n<p>the configuration file syntax consists in lines beginning with a keyword<br>referenced in this manual, optionally followed by one or several parameters<br>delimited by spaces.</p>\n<h2 id=\"2-2-quoting-and-escaping\"><a href=\"#2-2-quoting-and-escaping\" class=\"headerlink\" title=\"2.2. quoting and escaping\"></a>2.2. quoting and escaping</h2><p>haproxy’s configuration introduces a quoting and escaping system similar to<br>many programming languages. the configuration file supports 3 types: escaping<br>with a backslash, weak quoting with double quotes, and strong quoting with<br>single quotes.</p>\n<p>if spaces have to be entered in strings, then they must be escaped by preceding<br>them by a backslash (‘\\’) or by quoting them. backslashes also have to be<br>escaped by doubling or strong quoting them.</p>\n<p>escaping is achieved by preceding a special character by a backslash (‘\\’):</p>\n<p>  \\    to mark a space and differentiate it from a delimiter<br>  #   to mark a hash and differentiate it from a comment<br>  \\   to use a backslash<br>  \\’   to use a single quote and differentiate it from strong quoting<br>  \\”   to use a double quote and differentiate it from weak quoting</p>\n<p>weak quoting is achieved by using double quotes (“”). weak quoting prevents<br>the interpretation of:</p>\n<pre><code>space as a parameter separator\n</code></pre><p>  ‘    single quote as a strong quoting delimiter</p>\n<h1 id=\"hash-as-a-comment-start\"><a href=\"#hash-as-a-comment-start\" class=\"headerlink\" title=\"hash as a comment start\"></a>hash as a comment start</h1><p>weak quoting permits the interpretation of variables, if you want to use a non<br>-interpreted dollar within a double quoted string, you should escape it with a<br>backslash (“\\$”), it does not work outside weak quoting.</p>\n<p>interpretation of escaping and special characters are not prevented by weak<br>quoting.</p>\n<p>strong quoting is achieved by using single quotes (‘’). inside single quotes,<br>nothing is interpreted, it’s the efficient way to quote regexes.</p>\n<p>quoted and escaped strings are replaced in memory by their interpreted<br>equivalent, it allows you to perform concatenation.</p>\n<p>  example:</p>\n<pre><code># those are equivalents:\nlog-format %{+q}o\\ %t\\ %s\\ %{-q}r\nlog-format &quot;%{+q}o %t %s %{-q}r&quot;\nlog-format &apos;%{+q}o %t %s %{-q}r&apos;\nlog-format &quot;%{+q}o %t&quot;&apos; %s %{-q}r&apos;\nlog-format &quot;%{+q}o %t&quot;&apos; %s&apos;\\ %{-q}r\n\n# those are equivalents:\nreqrep &quot;^([^\\ :]*)\\ /static/(.*)&quot;     \\1\\ /\\2\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &apos;\\1 /\\2&apos;\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &quot;\\1 /\\2&quot;\nreqrep &quot;^([^ :]*)\\ /static/(.*)&quot;     &quot;\\1\\ /\\2&quot;\n</code></pre><h2 id=\"2-3-environment-variables\"><a href=\"#2-3-environment-variables\" class=\"headerlink\" title=\"2.3. environment variables\"></a>2.3. environment variables</h2><p>haproxy’s configuration supports environment variables. those variables are<br>interpreted only within double quotes. variables are expanded during the<br>configuration parsing. variable names must be preceded by a dollar (“$”) and<br>optionally enclosed with braces (“{}”) similarly to what is done in bourne<br>shell. variable names can contain alphanumerical characters or the character<br>underscore (“_”) but should not start with a digit.</p>\n<p>  example:</p>\n<pre><code>bind &quot;fd@${fd_app1}&quot;\n\nlog &quot;${local_syslog}:514&quot; local0 notice   # send to local server\n\nuser &quot;$haproxy_user&quot;\n</code></pre><h2 id=\"2-4-time-format\"><a href=\"#2-4-time-format\" class=\"headerlink\" title=\"2.4. time format\"></a>2.4. time format</h2><p>some parameters involve values representing time, such as timeouts. these<br>values are generally expressed in milliseconds (unless explicitly stated<br>otherwise) but may be expressed in any other unit by suffixing the unit to the<br>numeric value. it is important to consider this because it will not be repeated<br>for every keyword. supported units are :</p>\n<ul>\n<li>us : microseconds. 1 microsecond = 1/1000000 second</li>\n<li>ms : milliseconds. 1 millisecond = 1/1000 second. this is the default.</li>\n<li>s  : seconds. 1s = 1000ms</li>\n<li>m  : minutes. 1m = 60s = 60000ms</li>\n<li>h  : hours.   1h = 60m = 3600s = 3600000ms</li>\n<li>d  : days.    1d = 24h = 1440m = 86400s = 86400000ms</li>\n</ul>\n<h2 id=\"2-4-examples\"><a href=\"#2-4-examples\" class=\"headerlink\" title=\"2.4. examples\"></a>2.4. examples</h2><pre><code># simple configuration for an http proxy listening on port 80 on all\n# interfaces and forwarding requests to a single backend &quot;servers&quot; with a\n# single server &quot;server1&quot; listening on 127.0.0.1:8000\nglobal\n    daemon\n    maxconn 256\n\ndefaults\n    mode http\n    timeout connect 5000ms\n    timeout client 50000ms\n    timeout server 50000ms\n\nfrontend http-in\n    bind *:80\n    default_backend servers\n\nbackend servers\n    server server1 127.0.0.1:8000 maxconn 32\n\n# the same configuration defined with a single listen block. shorter but\n# less expressive, especially in http mode.\nglobal\n    daemon\n    maxconn 256\n\ndefaults\n    mode http\n    timeout connect 5000ms\n    timeout client 50000ms\n    timeout server 50000ms\n\nlisten http-in\n    bind *:80\n    server server1 127.0.0.1:8000 maxconn 32\n</code></pre><p>assuming haproxy is in $path, test these configurations in a shell with:</p>\n<pre><code>$ sudo haproxy -f configuration.conf -c\n</code></pre><h2 id=\"3-global-parameters\"><a href=\"#3-global-parameters\" class=\"headerlink\" title=\"3. global parameters\"></a>3. global parameters</h2><p>parameters in the “global” section are process-wide and often os-specific. they<br>are generally set once for all and do not need being changed once correct. some<br>of them have command-line equivalents.</p>\n<p>the following keywords are supported in the “global” section :</p>\n<ul>\n<li><p>process management and security</p>\n<ul>\n<li>ca-base</li>\n<li>chroot</li>\n<li>crt-base</li>\n<li>daemon</li>\n<li>external-check</li>\n<li>gid</li>\n<li>group</li>\n<li>log</li>\n<li>log-send-hostname</li>\n<li>nbproc</li>\n<li>pidfile</li>\n<li>uid</li>\n<li>ulimit-n</li>\n<li>user</li>\n<li>stats</li>\n<li>ssl-server-verify</li>\n<li>node</li>\n<li>description</li>\n<li>unix-bind</li>\n<li>51degrees-data-file</li>\n<li>51degrees-property-name-list</li>\n<li>51degrees-property-separator</li>\n<li>51degrees-cache-size</li>\n</ul>\n</li>\n<li><p>performance tuning</p>\n<ul>\n<li>max-spread-checks</li>\n<li>maxconn</li>\n<li>maxconnrate</li>\n<li>maxcomprate</li>\n<li>maxcompcpuusage</li>\n<li>maxpipes</li>\n<li>maxsessrate</li>\n<li>maxsslconn</li>\n<li>maxsslrate</li>\n<li>noepoll</li>\n<li>nokqueue</li>\n<li>nopoll</li>\n<li>nosplice</li>\n<li>nogetaddrinfo</li>\n<li>spread-checks</li>\n<li>tune.bufsize</li>\n<li>tune.chksize</li>\n<li>tune.comp.maxlevel</li>\n<li>tune.http.cookielen</li>\n<li>tune.http.maxhdr</li>\n<li>tune.idletimer</li>\n<li>tune.lua.forced-yield</li>\n<li>tune.lua.maxmem</li>\n<li>tune.lua.session-timeout</li>\n<li>tune.lua.task-timeout</li>\n<li>tune.maxaccept</li>\n<li>tune.maxpollevents</li>\n<li>tune.maxrewrite</li>\n<li>tune.pattern.cache-size</li>\n<li>tune.pipesize</li>\n<li>tune.rcvbuf.client</li>\n<li>tune.rcvbuf.server</li>\n<li>tune.sndbuf.client</li>\n<li>tune.sndbuf.server</li>\n<li>tune.ssl.cachesize</li>\n<li>tune.ssl.lifetime</li>\n<li>tune.ssl.force-private-cache</li>\n<li>tune.ssl.maxrecord</li>\n<li>tune.ssl.default-dh-param</li>\n<li>tune.ssl.ssl-ctx-cache-size</li>\n<li>tune.vars.global-max-size</li>\n<li>tune.vars.reqres-max-size</li>\n<li>tune.vars.sess-max-size</li>\n<li>tune.vars.txn-max-size</li>\n<li>tune.zlib.memlevel</li>\n<li>tune.zlib.windowsize</li>\n</ul>\n</li>\n<li><p>debugging</p>\n<ul>\n<li>debug</li>\n<li>quiet</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-1-process-management-and-security\"><a href=\"#3-1-process-management-and-security\" class=\"headerlink\" title=\"3.1. process management and security\"></a>3.1. process management and security</h2><p>ca-base <dir><br>  assigns a default directory to fetch ssl ca certificates and crls from when a<br>  relative path is used with “ca-file” or “crl-file” directives. absolute<br>  locations specified in “ca-file” and “crl-file” prevail and ignore “ca-base”.</p>\n<p>chroot <jail dir><br>  changes current directory to <jail dir> and performs a chroot() there before<br>  dropping privileges. this increases the security level in case an unknown<br>  vulnerability would be exploited, since it would make it very hard for the<br>  attacker to exploit the system. this only works when the process is started<br>  with superuser privileges. it is important to ensure that <jail_dir> is both<br>  empty and unwritable to anyone.</p>\n<p>cpu-map &lt;”all”|”odd”|”even”|process_num&gt; <cpu-set>…<br>  on linux 2.6 and above, it is possible to bind a process to a specific cpu<br>  set. this means that the process will never run on other cpus. the “cpu-map”<br>  directive specifies cpu sets for process sets. the first argument is the<br>  process number to bind. this process must have a number between 1 and 32 or<br>  64, depending on the machine’s word size, and any process ids above nbproc<br>  are ignored. it is possible to specify all processes at once using “all”,<br>  only odd numbers using “odd” or even numbers using “even”, just like with the<br>  “bind-process” directive. the second and forthcoming arguments are cpu sets.<br>  each cpu set is either a unique number between 0 and 31 or 63 or a range with<br>  two such numbers delimited by a dash (‘-‘). multiple cpu numbers or ranges<br>  may be specified, and the processes will be allowed to bind to all of them.<br>  obviously, multiple “cpu-map” directives may be specified. each “cpu-map”<br>  directive will replace the previous ones when they overlap.</p>\n<p>crt-base <dir><br>  assigns a default directory to fetch ssl certificates from when a relative<br>  path is used with “crtfile” directives. absolute locations specified after<br>  “crtfile” prevail and ignore “crt-base”.</p>\n<p>daemon<br>  makes the process fork into background. this is the recommended mode of<br>  operation. it is equivalent to the command line “-d” argument. it can be<br>  disabled by the command line “-db” argument.</p>\n<p>deviceatlas-json-file <path><br>  sets the path of the deviceatlas json data file to be loaded by the api.<br>  the path must be a valid json data file and accessible by haproxy process.</p>\n<p>deviceatlas-log-level <value><br>  sets the level of informations returned by the api. this directive is<br>  optional and set to 0 by default if not set.</p>\n<p>deviceatlas-separator <char><br>  sets the character separator for the api properties results. this directive<br>  is optional and set to | by default if not set.</p>\n<p>external-check<br>  allows the use of an external agent to perform health checks.<br>  this is disabled by default as a security precaution.<br>  see “option external-check”.</p>\n<p>gid <number><br>  changes the process’ group id to <number>. it is recommended that the group<br>  id is dedicated to haproxy or to a small set of similar daemons. haproxy must<br>  be started with a user belonging to this group, or with superuser privileges.<br>  note that if haproxy is started from a user having supplementary groups, it<br>  will only be able to drop these groups if started with superuser privileges.<br>  see also “group” and “uid”.</p>\n<p>group <group name><br>  similar to “gid” but uses the gid of group name <group name> from /etc/group.<br>  see also “gid” and “user”.</p>\n<p>log <address> [len <length>] <facility> [max level [min level]]<br>  adds a global syslog server. up to two global servers can be defined. they<br>  will receive logs for startups and exits, as well as all logs from proxies<br>  configured with “log global”.</p>\n<p>  <address> can be one of:</p>\n<pre><code>- an ipv4 address optionally followed by a colon and a udp port. if\n  no port is specified, 514 is used by default (the standard syslog\n  port).\n\n- an ipv6 address followed by a colon and optionally a udp port. if\n  no port is specified, 514 is used by default (the standard syslog\n  port).\n\n- a filesystem path to a unix domain socket, keeping in mind\n  considerations for chroot (be sure the path is accessible inside\n  the chroot) and uid/gid (be sure the path is appropriately\n  writeable).\n\nyou may want to reference some environment variables in the address\nparameter, see section 2.3 about environment variables.\n</code></pre><p>  <length> is an optional maximum line length. log lines larger than this value<br>           will be truncated before being sent. the reason is that syslog<br>           servers act differently on log line length. all servers support the<br>           default value of 1024, but some servers simply drop larger lines<br>           while others do log them. if a server supports long lines, it may<br>           make sense to set this value here in order to avoid truncating long<br>           lines. similarly, if a server drops long lines, it is preferable to<br>           truncate them before sending them. accepted values are 80 to 65535<br>           inclusive. the default value of 1024 is generally fine for all<br>           standard usages. some specific cases of long captures or<br>           json-formated logs may require larger values.</p>\n<p>  <facility> must be one of the 24 standard syslog facilities :</p>\n<pre><code>kern   user   mail   daemon auth   syslog lpr    news\nuucp   cron   auth2  ftp    ntp    audit  alert  cron2\nlocal0 local1 local2 local3 local4 local5 local6 local7\n</code></pre><p>  an optional level can be specified to filter outgoing messages. by default,<br>  all messages are sent. if a maximum level is specified, only messages with a<br>  severity at least as important as this level will be sent. an optional minimum<br>  level can be specified. if it is set, logs emitted with a more severe level<br>  than this one will be capped to this level. this is used to avoid sending<br>  “emerg” messages on all terminals on some default syslog configurations.<br>  eight levels are known :</p>\n<pre><code>emerg  alert  crit   err    warning notice info  debug\n</code></pre><p>log-send-hostname [<string>]<br>  sets the hostname field in the syslog header. if optional “string” parameter<br>  is set the header is set to the string contents, otherwise uses the hostname<br>  of the system. generally used if one is not relaying logs through an<br>  intermediate syslog server or for simply customizing the hostname printed in<br>  the logs.</p>\n<p>log-tag <string><br>  sets the tag field in the syslog header to this string. it defaults to the<br>  program name as launched from the command line, which usually is “haproxy”.<br>  sometimes it can be useful to differentiate between multiple processes<br>  running on the same host. see also the per-proxy “log-tag” directive.</p>\n<p>lua-load <file><br>  this global directive loads and executes a lua file. this directive can be<br>  used multiple times.</p>\n<p>nbproc <number><br>  creates <number> processes when going daemon. this requires the “daemon”<br>  mode. by default, only one process is created, which is the recommended mode<br>  of operation. for systems limited to small sets of file descriptors per<br>  process, it may be needed to fork multiple daemons. using multiple processes<br>  is harder to debug and is really discouraged. see also “daemon”.</p>\n<p>pidfile <pidfile><br>  writes pids of all daemons into file <pidfile>. this option is equivalent to<br>  the “-p” command line argument. the file must be accessible to the user<br>  starting the process. see also “daemon”.</p>\n<p>stats bind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] …<br>  limits the stats socket to a certain set of processes numbers. by default the<br>  stats socket is bound to all processes, causing a warning to be emitted when<br>  nbproc is greater than 1 because there is no way to select the target process<br>  when connecting. however, by using this setting, it becomes possible to pin<br>  the stats socket to a specific set of processes, typically the first one. the<br>  warning will automatically be disabled when this setting is used, whatever<br>  the number of processes used. the maximum process id depends on the machine’s<br>  word size (32 or 64). a better option consists in using the “process” setting<br>  of the “stats socket” line to force the process on each line.</p>\n<p>ssl-default-bind-ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it sets<br>  the default string describing the list of cipher algorithms (“cipher suite”)<br>  that are negotiated during the ssl/tls handshake for all “bind” lines which<br>  do not explicitly define theirs. the format of the string is defined in<br>  “man 1 ciphers” from openssl man pages, and can be for instance a string such<br>  as “aes:all:!anull:!enull:+rc4:@strength” (without quotes). please check the<br>  “bind” keyword for more information.</p>\n<p>ssl-default-bind-options [<option>]…<br>  this setting is only available when support for openssl was built in. it sets<br>  default ssl-options to force on all “bind” lines. please check the “bind”<br>  keyword to see available options.</p>\n<p>  example:<br>        global<br>           ssl-default-bind-options no-sslv3 no-tls-tickets</p>\n<p>ssl-default-server-ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it<br>  sets the default string describing the list of cipher algorithms that are<br>  negotiated during the ssl/tls handshake with the server, for all “server”<br>  lines which do not explicitly define theirs. the format of the string is<br>  defined in “man 1 ciphers”. please check the “server” keyword for more<br>  information.</p>\n<p>ssl-default-server-options [<option>]…<br>  this setting is only available when support for openssl was built in. it sets<br>  default ssl-options to force on all “server” lines. please check the “server”<br>  keyword to see available options.</p>\n<p>ssl-dh-param-file <file><br>  this setting is only available when support for openssl was built in. it sets<br>  the default dh parameters that are used during the ssl/tls handshake when<br>  ephemeral diffie-hellman (dhe) key exchange is used, for all “bind” lines<br>  which do not explicitely define theirs. it will be overridden by custom dh<br>  parameters found in a bind certificate file if any. if custom dh parameters<br>  are not specified either by using ssl-dh-param-file or by setting them directly<br>  in the certificate file, pre-generated dh parameters of the size specified<br>  by tune.ssl.default-dh-param will be used. custom parameters are known to be<br>  more secure and therefore their use is recommended.<br>  custom dh parameters may be generated by using the openssl command<br>  “openssl dhparam <size>“, where size should be at least 2048, as 1024-bit dh<br>  parameters should not be considered secure anymore.</p>\n<p>ssl-server-verify [none|required]<br>  the default behavior for ssl verify on servers side. if specified to ‘none’,<br>  servers certificates are not verified. the default is ‘required’ except if<br>  forced using cmdline option ‘-dv’.</p>\n<p>stats socket [<address:port>|<path>] [param*]<br>  binds a unix socket to <path> or a tcpv4/v6 address to <address:port>.<br>  connections to this socket will return various statistics outputs and even<br>  allow some commands to be issued to change some runtime settings. please<br>  consult section 9.2 “unix socket commands” for more details.</p>\n<p>  all parameters supported by “bind” lines are supported, for instance to<br>  restrict access to some users or their access rights. please consult<br>  section 5.1 for more information.</p>\n<p>stats timeout <timeout, in milliseconds><br>  the default timeout on the stats socket is set to 10 seconds. it is possible<br>  to change this value with “stats timeout”. the value must be passed in<br>  milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.</p>\n<p>stats maxconn <connections><br>  by default, the stats socket is limited to 10 concurrent connections. it is<br>  possible to change this value with “stats maxconn”.</p>\n<p>uid <number><br>  changes the process’ user id to <number>. it is recommended that the user id<br>  is dedicated to haproxy or to a small set of similar daemons. haproxy must<br>  be started with superuser privileges in order to be able to switch to another<br>  one. see also “gid” and “user”.</p>\n<p>ulimit-n <number><br>  sets the maximum number of per-process file-descriptors to <number>. by<br>  default, it is automatically computed, so it is recommended not to use this<br>  option.</p>\n<p>unix-bind [ prefix <prefix> ] [ mode <mode> ] [ user <user> ] [ uid <uid> ]<br>          [ group <group> ] [ gid <gid> ]</p>\n<p>  fixes common settings to unix listening sockets declared in “bind” statements.<br>  this is mainly used to simplify declaration of those unix sockets and reduce<br>  the risk of errors, since those settings are most commonly required but are<br>  also process-specific. the <prefix> setting can be used to force all socket<br>  path to be relative to that directory. this might be needed to access another<br>  component’s chroot. note that those paths are resolved before haproxy chroots<br>  itself, so they are absolute. the <mode>, <user>, <uid>, <group> and <gid><br>  all have the same meaning as their homonyms used by the “bind” statement. if<br>  both are specified, the “bind” statement has priority, meaning that the<br>  “unix-bind” settings may be seen as process-wide default settings.</p>\n<p>user <user name><br>  similar to “uid” but uses the uid of user name <user name> from /etc/passwd.<br>  see also “uid” and “group”.</p>\n<p>node <name><br>  only letters, digits, hyphen and underscore are allowed, like in dns names.</p>\n<p>  this statement is useful in ha configurations where two or more processes or<br>  servers share the same ip address. by setting a different node-name on all<br>  nodes, it becomes easy to immediately spot what server is handling the<br>  traffic.</p>\n<p>description <text><br>  add a text that describes the instance.</p>\n<p>  please note that it is required to escape certain characters (# for example)<br>  and this text is inserted into a html page so you should avoid using<br>  “&lt;” and “&gt;” characters.</p>\n<p>51degrees-data-file <file path><br>  the path of the 51degrees data file to provide device detection services. the<br>  file should be unzipped and accessible by haproxy with relevavnt permissions.</p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-property-name-list [<string>]<br>  a list of 51degrees property names to be load from the dataset. a full list<br>  of names is available on the 51degrees website:<br>  <a href=\"https://51degrees.com/resources/property-dictionary\">https://51degrees.com/resources/property-dictionary</a></p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-property-separator <char><br>  a char that will be appended to every property value in a response header<br>  containing 51degrees results. if not set that will be set as ‘,’.</p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<p>51degrees-cache-size <number><br>  sets the size of the 51degrees converter cache to <number> entries. this<br>  is an lru cache which reminds previous device detections and their results.<br>  by default, this cache is disabled.</p>\n<p>  please note that this option is only available when haproxy has been<br>  compiled with use_51degrees.</p>\n<h2 id=\"3-2-performance-tuning\"><a href=\"#3-2-performance-tuning\" class=\"headerlink\" title=\"3.2. performance tuning\"></a>3.2. performance tuning</h2><p>max-spread-checks <delay in milliseconds><br>  by default, haproxy tries to spread the start of health checks across the<br>  smallest health check interval of all the servers in a farm. the principle is<br>  to avoid hammering services running on the same server. but when using large<br>  check intervals (10 seconds or more), the last servers in the farm take some<br>  time before starting to be tested, which can be a problem. this parameter is<br>  used to enforce an upper bound on delay between the first and the last check,<br>  even if the servers’ check intervals are larger. when servers run with<br>  shorter intervals, their intervals will be respected though.</p>\n<p>maxconn <number><br>  sets the maximum per-process number of concurrent connections to <number>. it<br>  is equivalent to the command-line argument “-n”. proxies will stop accepting<br>  connections when this limit is reached. the “ulimit-n” parameter is<br>  automatically adjusted according to this value. see also “ulimit-n”. note:<br>  the “select” poller cannot reliably use more than 1024 file descriptors on<br>  some platforms. if your platform only supports select and reports “select<br>  failed” on startup, you need to reduce maxconn until it works (slightly<br>  below 500 in general). if this value is not set, it will default to the value<br>  set in default_maxconn at build time (reported in haproxy -vv) if no memory<br>  limit is enforced, or will be computed based on the memory limit, the buffer<br>  size, memory allocated to compression, ssl cache size, and use or not of ssl<br>  and the associated maxsslconn (which can also be automatic).</p>\n<p>maxconnrate <number><br>  sets the maximum per-process number of connections per second to <number>.<br>  proxies will stop accepting connections when this limit is reached. it can be<br>  used to limit the global capacity regardless of each frontend capacity. it is<br>  important to note that this can only be used as a service protection measure,<br>  as there will not necessarily be a fair share between frontends when the<br>  limit is reached, so it’s a good idea to also limit each frontend to some<br>  value close to its expected share. also, lowering tune.maxaccept can improve<br>  fairness.</p>\n<p>maxcomprate <number><br>  sets the maximum per-process input compression rate to <number> kilobytes<br>  per second.  for each session, if the maximum is reached, the compression<br>  level will be decreased during the session. if the maximum is reached at the<br>  beginning of a session, the session will not compress at all. if the maximum<br>  is not reached, the compression level will be increased up to<br>  tune.comp.maxlevel.  a value of zero means there is no limit, this is the<br>  default value.</p>\n<p>maxcompcpuusage <number><br>  sets the maximum cpu usage haproxy can reach before stopping the compression<br>  for new requests or decreasing the compression level of current requests.<br>  it works like ‘maxcomprate’ but measures cpu usage instead of incoming data<br>  bandwidth. the value is expressed in percent of the cpu used by haproxy. in<br>  case of multiple processes (nbproc &gt; 1), each process manages its individual<br>  usage. a value of 100 disable the limit. the default value is 100. setting<br>  a lower value will prevent the compression work from slowing the whole<br>  process down and from introducing high latencies.</p>\n<p>maxpipes <number><br>  sets the maximum per-process number of pipes to <number>. currently, pipes<br>  are only used by kernel-based tcp splicing. since a pipe contains two file<br>  descriptors, the “ulimit-n” value will be increased accordingly. the default<br>  value is maxconn/4, which seems to be more than enough for most heavy usages.<br>  the splice code dynamically allocates and releases pipes, and can fall back<br>  to standard copy, so setting this value too low may only impact performance.</p>\n<p>maxsessrate <number><br>  sets the maximum per-process number of sessions per second to <number>.<br>  proxies will stop accepting connections when this limit is reached. it can be<br>  used to limit the global capacity regardless of each frontend capacity. it is<br>  important to note that this can only be used as a service protection measure,<br>  as there will not necessarily be a fair share between frontends when the<br>  limit is reached, so it’s a good idea to also limit each frontend to some<br>  value close to its expected share. also, lowering tune.maxaccept can improve<br>  fairness.</p>\n<p>maxsslconn <number><br>  sets the maximum per-process number of concurrent ssl connections to<br>  <number>. by default there is no ssl-specific limit, which means that the<br>  global maxconn setting will apply to all connections. setting this limit<br>  avoids having openssl use too much memory and crash when malloc returns null<br>  (since it unfortunately does not reliably check for such conditions). note<br>  that the limit applies both to incoming and outgoing connections, so one<br>  connection which is deciphered then ciphered accounts for 2 ssl connections.<br>  if this value is not set, but a memory limit is enforced, this value will be<br>  automatically computed based on the memory limit, maxconn,  the buffer size,<br>  memory allocated to compression, ssl cache size, and use of ssl in either<br>  frontends, backends or both. if neither maxconn nor maxsslconn are specified<br>  when there is a memory limit, haproxy will automatically adjust these values<br>  so that 100% of the connections can be made over ssl with no risk, and will<br>  consider the sides where it is enabled (frontend, backend, both).</p>\n<p>maxsslrate <number><br>  sets the maximum per-process number of ssl sessions per second to <number>.<br>  ssl listeners will stop accepting connections when this limit is reached. it<br>  can be used to limit the global ssl cpu usage regardless of each frontend<br>  capacity. it is important to note that this can only be used as a service<br>  protection measure, as there will not necessarily be a fair share between<br>  frontends when the limit is reached, so it’s a good idea to also limit each<br>  frontend to some value close to its expected share. it is also important to<br>  note that the sessions are accounted before they enter the ssl stack and not<br>  after, which also protects the stack against bad handshakes. also, lowering<br>  tune.maxaccept can improve fairness.</p>\n<p>maxzlibmem <number><br>  sets the maximum amount of ram in megabytes per process usable by the zlib.<br>  when the maximum amount is reached, future sessions will not compress as long<br>  as ram is unavailable. when sets to 0, there is no limit.<br>  the default value is 0. the value is available in bytes on the unix socket<br>  with “show info” on the line “maxzlibmemusage”, the memory used by zlib is<br>  “zlibmemusage” in bytes.</p>\n<p>noepoll<br>  disables the use of the “epoll” event polling system on linux. it is<br>  equivalent to the command-line argument “-de”. the next polling system<br>  used will generally be “poll”. see also “nopoll”.</p>\n<p>nokqueue<br>  disables the use of the “kqueue” event polling system on bsd. it is<br>  equivalent to the command-line argument “-dk”. the next polling system<br>  used will generally be “poll”. see also “nopoll”.</p>\n<p>nopoll<br>  disables the use of the “poll” event polling system. it is equivalent to the<br>  command-line argument “-dp”. the next polling system used will be “select”.<br>  it should never be needed to disable “poll” since it’s available on all<br>  platforms supported by haproxy. see also “nokqueue” and “noepoll”.</p>\n<p>nosplice<br>  disables the use of kernel tcp splicing between sockets on linux. it is<br>  equivalent to the command line argument “-ds”.  data will then be copied<br>  using conventional and more portable recv/send calls. kernel tcp splicing is<br>  limited to some very recent instances of kernel 2.6. most versions between<br>  2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not<br>  be used. this option makes it easier to globally disable kernel splicing in<br>  case of doubt. see also “option splice-auto”, “option splice-request” and<br>  “option splice-response”.</p>\n<p>nogetaddrinfo<br>  disables the use of getaddrinfo(3) for name resolving. it is equivalent to<br>  the command line argument “-dg”. deprecated gethostbyname(3) will be used.</p>\n<p>spread-checks <0..50, in percent><br>  sometimes it is desirable to avoid sending agent and health checks to<br>  servers at exact intervals, for instance when many logical servers are<br>  located on the same physical server. with the help of this parameter, it<br>  becomes possible to add some randomness in the check interval between 0<br>  and +/- 50%. a value between 2 and 5 seems to show good results. the<br>  default value remains at 0.</p>\n<p>tune.buffers.limit <number><br>  sets a hard limit on the number of buffers which may be allocated per process.<br>  the default value is zero which means unlimited. the minimum non-zero value<br>  will always be greater than “tune.buffers.reserve” and should ideally always<br>  be about twice as large. forcing this value can be particularly useful to<br>  limit the amount of memory a process may take, while retaining a sane<br>  behaviour. when this limit is reached, sessions which need a buffer wait for<br>  another one to be released by another session. since buffers are dynamically<br>  allocated and released, the waiting time is very short and not perceptible<br>  provided that limits remain reasonable. in fact sometimes reducing the limit<br>  may even increase performance by increasing the cpu cache’s efficiency. tests<br>  have shown good results on average http traffic with a limit to 1/10 of the<br>  expected global maxconn setting, which also significantly reduces memory<br>  usage. the memory savings come from the fact that a number of connections<br>  will not allocate 2*tune.bufsize. it is best not to touch this value unless<br>  advised to do so by an haproxy core developer.</p>\n<p>tune.buffers.reserve <number><br>  sets the number of buffers which are pre-allocated and reserved for use only<br>  during memory shortage conditions resulting in failed memory allocations. the<br>  minimum value is 2 and is also the default. there is no reason a user would<br>  want to change this value, it’s mostly aimed at haproxy core developers.</p>\n<p>tune.bufsize <number><br>  sets the buffer size to this size (in bytes). lower values allow more<br>  sessions to coexist in the same amount of ram, and higher values allow some<br>  applications with very large cookies to work. the default value is 16384 and<br>  can be changed at build time. it is strongly recommended not to change this<br>  from the default value, as very low values will break some services such as<br>  statistics, and values larger than default size will increase memory usage,<br>  possibly causing the system to run out of memory. at least the global maxconn<br>  parameter should be decreased by the same factor as this one is increased.<br>  if http request is larger than (tune.bufsize - tune.maxrewrite), haproxy will<br>  return http 400 (bad request) error. similarly if an http response is larger<br>  than this size, haproxy will return http 502 (bad gateway).</p>\n<p>tune.chksize <number><br>  sets the check buffer size to this size (in bytes). higher values may help<br>  find string or regex patterns in very large pages, though doing so may imply<br>  more memory and cpu usage. the default value is 16384 and can be changed at<br>  build time. it is not recommended to change this value, but to use better<br>  checks whenever possible.</p>\n<p>tune.comp.maxlevel <number><br>  sets the maximum compression level. the compression level affects cpu<br>  usage during compression. this value affects cpu usage during compression.<br>  each session using compression initializes the compression algorithm with<br>  this value. the default value is 1.</p>\n<p>tune.http.cookielen <number><br>  sets the maximum length of captured cookies. this is the maximum value that<br>  the “capture cookie xxx len yyy” will be allowed to take, and any upper value<br>  will automatically be truncated to this one. it is important not to set too<br>  high a value because all cookie captures still allocate this size whatever<br>  their configured value (they share a same pool). this value is per request<br>  per response, so the memory allocated is twice this value per connection.<br>  when not specified, the limit is set to 63 characters. it is recommended not<br>  to change this value.</p>\n<p>tune.http.maxhdr <number><br>  sets the maximum number of headers in a request. when a request comes with a<br>  number of headers greater than this value (including the first line), it is<br>  rejected with a “400 bad request” status code. similarly, too large responses<br>  are blocked with “502 bad gateway”. the default value is 101, which is enough<br>  for all usages, considering that the widely deployed apache server uses the<br>  same limit. it can be useful to push this limit further to temporarily allow<br>  a buggy application to work by the time it gets fixed. keep in mind that each<br>  new header consumes 32bits of memory for each session, so don’t push this<br>  limit too high.</p>\n<p>tune.idletimer <timeout><br>  sets the duration after which haproxy will consider that an empty buffer is<br>  probably associated with an idle stream. this is used to optimally adjust<br>  some packet sizes while forwarding large and small data alternatively. the<br>  decision to use splice() or to send large buffers in ssl is modulated by this<br>  parameter. the value is in milliseconds between 0 and 65535. a value of zero<br>  means that haproxy will not try to detect idle streams. the default is 1000,<br>  which seems to correctly detect end user pauses (eg: read a page before<br>  clicking). there should be not reason for changing this value. please check<br>  tune.ssl.maxrecord below.</p>\n<p>tune.lua.forced-yield <number><br>  this directive forces the lua engine to execute a yield each <number> of<br>  instructions executed. this permits interruptng a long script and allows the<br>  haproxy scheduler to process other tasks like accepting connections or<br>  forwarding traffic. the default value is 10000 instructions. if haproxy often<br>  executes some lua code but more reactivity is required, this value can be<br>  lowered. if the lua code is quite long and its result is absolutely required<br>  to process the data, the <number> can be increased.</p>\n<p>tune.lua.maxmem<br>  sets the maximum amount of ram in megabytes per process usable by lua. by<br>  default it is zero which means unlimited. it is important to set a limit to<br>  ensure that a bug in a script will not result in the system running out of<br>  memory.</p>\n<p>tune.lua.session-timeout <timeout><br>  this is the execution timeout for the lua sessions. this is useful for<br>  preventing infinite loops or spending too much time in lua. this timeout has a<br>  priority over other timeouts. for example, if this timeout is set to 4s and<br>  you run a 5s sleep, the code will be interrupted with an error after waiting<br>  4s.</p>\n<p>tune.lua.task-timeout <timeout><br>  purpose is the same as “tune.lua.session-timeout”, but this timeout is<br>  dedicated to the tasks. by default, this timeout isn’t set because a task may<br>  remain alive during of the lifetime of haproxy. for example, a task used to<br>  check servers.</p>\n<p>tune.maxaccept <number><br>  sets the maximum number of consecutive connections a process may accept in a<br>  row before switching to other work. in single process mode, higher numbers<br>  give better performance at high connection rates. however in multi-process<br>  modes, keeping a bit of fairness between processes generally is better to<br>  increase performance. this value applies individually to each listener, so<br>  that the number of processes a listener is bound to is taken into account.<br>  this value defaults to 64. in multi-process mode, it is divided by twice<br>  the number of processes the listener is bound to. setting this value to -1<br>  completely disables the limitation. it should normally not be needed to tweak<br>  this value.</p>\n<p>tune.maxpollevents <number><br>  sets the maximum amount of events that can be processed at once in a call to<br>  the polling system. the default value is adapted to the operating system. it<br>  has been noticed that reducing it below 200 tends to slightly decrease<br>  latency at the expense of network bandwidth, and increasing it above 200<br>  tends to trade latency for slightly increased bandwidth.</p>\n<p>tune.maxrewrite <number><br>  sets the reserved buffer space to this size in bytes. the reserved space is<br>  used for header rewriting or appending. the first reads on sockets will never<br>  fill more than bufsize-maxrewrite. historically it has defaulted to half of<br>  bufsize, though that does not make much sense since there are rarely large<br>  numbers of headers to add. setting it too high prevents processing of large<br>  requests or responses. setting it too low prevents addition of new headers<br>  to already large requests or to post requests. it is generally wise to set it<br>  to about 1024. it is automatically readjusted to half of bufsize if it is<br>  larger than that. this means you don’t have to worry about it when changing<br>  bufsize.</p>\n<p>tune.pattern.cache-size <number><br>  sets the size of the pattern lookup cache to <number> entries. this is an lru<br>  cache which reminds previous lookups and their results. it is used by acls<br>  and maps on slow pattern lookups, namely the ones using the “sub”, “reg”,<br>  “dir”, “dom”, “end”, “bin” match methods as well as the case-insensitive<br>  strings. it applies to pattern expressions which means that it will be able<br>  to memorize the result of a lookup among all the patterns specified on a<br>  configuration line (including all those loaded from files). it automatically<br>  invalidates entries which are updated using http actions or on the cli. the<br>  default cache size is set to 10000 entries, which limits its footprint to<br>  about 5 mb on 32-bit systems and 8 mb on 64-bit systems. there is a very low<br>  risk of collision in this cache, which is in the order of the size of the<br>  cache divided by 2^64. typically, at 10000 requests per second with the<br>  default cache size of 10000 entries, there’s 1% chance that a brute force<br>  attack could cause a single collision after 60 years, or 0.1% after 6 years.<br>  this is considered much lower than the risk of a memory corruption caused by<br>  aging components. if this is not acceptable, the cache can be disabled by<br>  setting this parameter to 0.</p>\n<p>tune.pipesize <number><br>  sets the kernel pipe buffer size to this size (in bytes). by default, pipes<br>  are the default size for the system. but sometimes when using tcp splicing,<br>  it can improve performance to increase pipe sizes, especially if it is<br>  suspected that pipes are not filled and that many calls to splice() are<br>  performed. this has an impact on the kernel’s memory footprint, so this must<br>  not be changed if impacts are not understood.</p>\n<p>tune.rcvbuf.client <number><br>tune.rcvbuf.server <number><br>  forces the kernel socket receive buffer size on the client or the server side<br>  to the specified value in bytes. this value applies to all tcp/http frontends<br>  and backends. it should normally never be set, and the default size (0) lets<br>  the kernel autotune this value depending on the amount of available memory.<br>  however it can sometimes help to set it to very low values (eg: 4096) in<br>  order to save kernel memory by preventing it from buffering too large amounts<br>  of received data. lower values will significantly increase cpu usage though.</p>\n<p>tune.sndbuf.client <number><br>tune.sndbuf.server <number><br>  forces the kernel socket send buffer size on the client or the server side to<br>  the specified value in bytes. this value applies to all tcp/http frontends<br>  and backends. it should normally never be set, and the default size (0) lets<br>  the kernel autotune this value depending on the amount of available memory.<br>  however it can sometimes help to set it to very low values (eg: 4096) in<br>  order to save kernel memory by preventing it from buffering too large amounts<br>  of received data. lower values will significantly increase cpu usage though.<br>  another use case is to prevent write timeouts with extremely slow clients due<br>  to the kernel waiting for a large part of the buffer to be read before<br>  notifying haproxy again.</p>\n<p>tune.ssl.cachesize <number><br>  sets the size of the global ssl session cache, in a number of blocks. a block<br>  is large enough to contain an encoded session without peer certificate.<br>  an encoded session with peer certificate is stored in multiple blocks<br>  depending on the size of the peer certificate. a block uses approximately<br>  200 bytes of memory. the default value may be forced at build time, otherwise<br>  defaults to 20000.  when the cache is full, the most idle entries are purged<br>  and reassigned. higher values reduce the occurrence of such a purge, hence<br>  the number of cpu-intensive ssl handshakes by ensuring that all users keep<br>  their session as long as possible. all entries are pre-allocated upon startup<br>  and are shared between all processes if “nbproc” is greater than 1. setting<br>  this value to 0 disables the ssl session cache.</p>\n<p>tune.ssl.force-private-cache<br>  this boolean disables ssl session cache sharing between all processes. it<br>  should normally not be used since it will force many renegotiations due to<br>  clients hitting a random process. but it may be required on some operating<br>  systems where none of the ssl cache synchronization method may be used. in<br>  this case, adding a first layer of hash-based load balancing before the ssl<br>  layer might limit the impact of the lack of session sharing.</p>\n<p>tune.ssl.lifetime <timeout><br>  sets how long a cached ssl session may remain valid. this time is expressed<br>  in seconds and defaults to 300 (5 min). it is important to understand that it<br>  does not guarantee that sessions will last that long, because if the cache is<br>  full, the longest idle sessions will be purged despite their configured<br>  lifetime. the real usefulness of this setting is to prevent sessions from<br>  being used for too long.</p>\n<p>tune.ssl.maxrecord <number><br>  sets the maximum amount of bytes passed to ssl_write() at a time. default<br>  value 0 means there is no limit. over ssl/tls, the client can decipher the<br>  data only once it has received a full record. with large records, it means<br>  that clients might have to download up to 16kb of data before starting to<br>  process them. limiting the value can improve page load times on browsers<br>  located over high latency or low bandwidth networks. it is suggested to find<br>  optimal values which fit into 1 or 2 tcp segments (generally 1448 bytes over<br>  ethernet with tcp timestamps enabled, or 1460 when timestamps are disabled),<br>  keeping in mind that ssl/tls add some overhead. typical values of 1419 and<br>  2859 gave good results during tests. use “strace -e trace=write” to find the<br>  best value. haproxy will automatically switch to this setting after an idle<br>  stream has been detected (see tune.idletimer above).</p>\n<p>tune.ssl.default-dh-param <number><br>  sets the maximum size of the diffie-hellman parameters used for generating<br>  the ephemeral/temporary diffie-hellman key in case of dhe key exchange. the<br>  final size will try to match the size of the server’s rsa (or dsa) key (e.g,<br>  a 2048 bits temporary dh key for a 2048 bits rsa key), but will not exceed<br>  this maximum value. default value if 1024. only 1024 or higher values are<br>  allowed. higher values will increase the cpu load, and values greater than<br>  1024 bits are not supported by java 7 and earlier clients. this value is not<br>  used if static diffie-hellman parameters are supplied either directly<br>  in the certificate file or by using the ssl-dh-param-file parameter.</p>\n<p>tune.ssl.ssl-ctx-cache-size <number><br>  sets the size of the cache used to store generated certificates to <number><br>  entries. this is a lru cache. because generating a ssl certificate<br>  dynamically is expensive, they are cached. the default cache size is set to<br>  1000 entries.</p>\n<p>tune.vars.global-max-size <size><br>tune.vars.reqres-max-size <size><br>tune.vars.sess-max-size <size><br>tune.vars.txn-max-size <size><br>  these four tunes helps to manage the allowed amount of memory used by the<br>  variables system. “global” limits the memory for all the systems. “sess” limit<br>  the memory by session, “txn” limits the memory by transaction and “reqres”<br>  limits the memory for each request or response processing. during the<br>  accounting, “sess” embbed “txn” and “txn” embed “reqres”.</p>\n<p>  by example, we considers that “tune.vars.sess-max-size” is fixed to 100,<br>  “tune.vars.txn-max-size” is fixed to 100, “tune.vars.reqres-max-size” is<br>  also fixed to 100. if we create a variable “txn.var” that contains 100 bytes,<br>  we cannot create any more variable in the other contexts.</p>\n<p>tune.zlib.memlevel <number><br>  sets the memlevel parameter in zlib initialization for each session. it<br>  defines how much memory should be allocated for the internal compression<br>  state. a value of 1 uses minimum memory but is slow and reduces compression<br>  ratio, a value of 9 uses maximum memory for optimal speed.  can be a value<br>  between 1 and 9. the default value is 8.</p>\n<p>tune.zlib.windowsize <number><br>  sets the window size (the size of the history buffer) as a parameter of the<br>  zlib initialization for each session. larger values of this parameter result<br>  in better compression at the expense of memory usage.  can be a value between<br>  8 and 15.  the default value is 15.</p>\n<h2 id=\"3-3-debugging\"><a href=\"#3-3-debugging\" class=\"headerlink\" title=\"3.3. debugging\"></a>3.3. debugging</h2><p>debug<br>  enables debug mode which dumps to stdout all exchanges, and disables forking<br>  into background. it is the equivalent of the command-line argument “-d”. it<br>  should never be used in a production configuration since it may prevent full<br>  system startup.</p>\n<p>quiet<br>  do not display any message during startup. it is equivalent to the command-<br>  line argument “-q”.</p>\n<h2 id=\"3-4-userlists\"><a href=\"#3-4-userlists\" class=\"headerlink\" title=\"3.4. userlists\"></a>3.4. userlists</h2><p>it is possible to control access to frontend/backend/listen sections or to<br>http stats by allowing only authenticated and authorized users. to do this,<br>it is required to create at least one userlist and to define users.</p>\n<p>userlist <listname><br>  creates new userlist with name <listname>. many independent userlists can be<br>  used to store authentication &amp; authorization data for independent customers.</p>\n<p>group <groupname> [users <user>,<user>,(…)]<br>  adds group <groupname> to the current userlist. it is also possible to<br>  attach users to this group by using a comma separated list of names<br>  proceeded by “users” keyword.</p>\n<p>user <username> [password|insecure-password <password>]<br>                [groups <group>,<group>,(…)]<br>  adds user <username> to the current userlist. both secure (encrypted) and<br>  insecure (unencrypted) passwords can be used. encrypted passwords are<br>  evaluated using the crypt(3) function so depending of the system’s<br>  capabilities, different algorithms are supported. for example modern glibc<br>  based linux system supports md5, sha-256, sha-512 and of course classic,<br>  des-based method of encrypting passwords.</p>\n<p>  example:<br>        userlist l1<br>          group g1 users tiger,scott<br>          group g2 users xdb,scott</p>\n<pre><code>  user tiger password $6$k6y3o.ep$jlkbx9za9667qe4(...)xhswrv6j.c0/d7cv91\n  user scott insecure-password elgato\n  user xdb insecure-password hello\n\nuserlist l2\n  group g1\n  group g2\n\n  user tiger password $6$k6y3o.ep$jlkbx(...)xhswrv6j.c0/d7cv91 groups g1\n  user scott insecure-password elgato groups g1,g2\n  user xdb insecure-password hello groups g2\n</code></pre><p>  please note that both lists are functionally identical.</p>\n<h2 id=\"3-5-peers\"><a href=\"#3-5-peers\" class=\"headerlink\" title=\"3.5. peers\"></a>3.5. peers</h2><p>it is possible to propagate entries of any data-types in stick-tables between<br>several haproxy instances over tcp connections in a multi-master fashion. each<br>instance pushes its local updates and insertions to remote peers. the pushed<br>values overwrite remote ones without aggregation. interrupted exchanges are<br>automatically detected and recovered from the last known point.<br>in addition, during a soft restart, the old process connects to the new one<br>using such a tcp connection to push all its entries before the new process<br>tries to connect to other peers. that ensures very fast replication during a<br>reload, it typically takes a fraction of a second even for large tables.<br>note that server ids are used to identify servers remotely, so it is important<br>that configurations look similar or at least that the same ids are forced on<br>each server on all participants.</p>\n<p>peers <peersect><br>  creates a new peer list with name <peersect>. it is an independent section,<br>  which is referenced by one or more stick-tables.</p>\n<p>disabled<br>  disables a peers section. it disables both listening and any synchronization<br>  related to this section. this is provided to disable synchronization of stick<br>  tables without having to comment out all “peers” references.</p>\n<p>enable<br>  this re-enables a disabled peers section which was previously disabled.</p>\n<p>peer <peername> <ip>:<port><br>  defines a peer inside a peers section.<br>  if <peername> is set to the local peer name (by default hostname, or forced<br>  using “-l” command line option), haproxy will listen for incoming remote peer<br>  connection on <ip>:<port>. otherwise, <ip>:<port> defines where to connect to<br>  to join the remote peer, and <peername> is used at the protocol level to<br>  identify and validate the remote peer on the server side.</p>\n<p>  during a soft restart, local peer <ip>:<port> is used by the old instance to<br>  connect the new one and initiate a complete replication (teaching process).</p>\n<p>  it is strongly recommended to have the exact same peers declaration on all<br>  peers and to only rely on the “-l” command line argument to change the local<br>  peer name. this makes it easier to maintain coherent configuration files<br>  across all peers.</p>\n<p>  you may want to reference some environment variables in the address<br>  parameter, see section 2.3 about environment variables.</p>\n<p>  example:<br>    peers mypeers<br>        peer haproxy1 192.168.0.1:1024<br>        peer haproxy2 192.168.0.2:1024<br>        peer haproxy3 10.2.0.1:1024</p>\n<pre><code>backend mybackend\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 20k peers mypeers\n    stick on src\n\n    server srv1 192.168.0.30:80\n    server srv2 192.168.0.31:80\n</code></pre><h2 id=\"3-6-mailers\"><a href=\"#3-6-mailers\" class=\"headerlink\" title=\"3.6. mailers\"></a>3.6. mailers</h2><p>it is possible to send email alerts when the state of servers changes.<br>if configured email alerts are sent to each mailer that is configured<br>in a mailers section. email is sent to mailers using smtp.</p>\n<p>mailer <mailersect><br>  creates a new mailer list with the name <mailersect>. it is an<br>  independent section which is referenced by one or more proxies.</p>\n<p>mailer <mailername> <ip>:<port><br>  defines a mailer inside a mailers section.</p>\n<p>  example:<br>    mailers mymailers<br>        mailer smtp1 192.168.0.1:587<br>        mailer smtp2 192.168.0.2:587</p>\n<pre><code>backend mybackend\n    mode tcp\n    balance roundrobin\n\n    email-alert mailers mymailers\n    email-alert from test1@horms.org\n    email-alert to test2@horms.org\n\n    server srv1 192.168.0.30:80\n    server srv2 192.168.0.31:80\n</code></pre><h2 id=\"4-proxies\"><a href=\"#4-proxies\" class=\"headerlink\" title=\"4. proxies\"></a>4. proxies</h2><p>proxy configuration can be located in a set of sections :</p>\n<ul>\n<li>defaults [<name>]</li>\n<li>frontend <name></li>\n<li>backend  <name></li>\n<li>listen   <name></li>\n</ul>\n<p>a “defaults” section sets default parameters for all other sections following<br>its declaration. those default parameters are reset by the next “defaults”<br>section. see below for the list of parameters which can be set in a “defaults”<br>section. the name is optional but its use is encouraged for better readability.</p>\n<p>a “frontend” section describes a set of listening sockets accepting client<br>connections.</p>\n<p>a “backend” section describes a set of servers to which the proxy will connect<br>to forward incoming connections.</p>\n<p>a “listen” section defines a complete proxy with its frontend and backend<br>parts combined in one section. it is generally useful for tcp-only traffic.</p>\n<p>all proxy names must be formed from upper and lower case letters, digits,<br>‘-‘ (dash), ‘_’ (underscore) , ‘.’ (dot) and ‘:’ (colon). acl names are<br>case-sensitive, which means that “www” and “www” are two different proxies.</p>\n<p>historically, all proxy names could overlap, it just caused troubles in the<br>logs. since the introduction of content switching, it is mandatory that two<br>proxies with overlapping capabilities (frontend/backend) have different names.<br>however, it is still permitted that a frontend and a backend share the same<br>name, as this configuration seems to be commonly encountered.</p>\n<p>right now, two major proxy modes are supported : “tcp”, also known as layer 4,<br>and “http”, also known as layer 7. in layer 4 mode, haproxy simply forwards<br>bidirectional traffic between two sides. in layer 7 mode, haproxy analyzes the<br>protocol, and can interact with it by allowing, blocking, switching, adding,<br>modifying, or removing arbitrary contents in requests or responses, based on<br>arbitrary criteria.</p>\n<p>in http mode, the processing applied to requests and responses flowing over<br>a connection depends in the combination of the frontend’s http options and<br>the backend’s. haproxy supports 5 connection modes :</p>\n<ul>\n<li><p>kal : keep alive (“option http-keep-alive”) which is the default mode : all<br>requests and responses are processed, and connections remain open but idle<br>between responses and new requests.</p>\n</li>\n<li><p>tun: tunnel (“option http-tunnel”) : this was the default mode for versions<br>1.0 to 1.5-dev21 : only the first request and response are processed, and<br>everything else is forwarded with no analysis at all. this mode should not<br>be used as it creates lots of trouble with logging and http processing.</p>\n</li>\n<li><p>pcl: passive close (“option httpclose”) : exactly the same as tunnel mode,<br>but with “connection: close” appended in both directions to try to make<br>both ends close after the first request/response exchange.</p>\n</li>\n<li><p>scl: server close (“option http-server-close”) : the server-facing<br>connection is closed after the end of the response is received, but the<br>client-facing connection remains open.</p>\n</li>\n<li><p>fcl: forced close (“option forceclose”) : the connection is actively closed<br>after the end of the response.</p>\n</li>\n</ul>\n<p>the effective mode that will be applied to a connection passing through a<br>frontend and a backend can be determined by both proxy modes according to the<br>following matrix, but in short, the modes are symmetric, keep-alive is the<br>weakest option and force close is the strongest.</p>\n<pre><code>              backend mode\n\n    | kal | tun | pcl | scl | fcl\n----+-----+-----+-----+-----+----\nkal | kal | tun | pcl | scl | fcl\n----+-----+-----+-----+-----+----\ntun | tun | tun | pcl | scl | fcl\n</code></pre><p> frontend   —-+—–+—–+—–+—–+—-<br>   mode     pcl | pcl | pcl | pcl | fcl | fcl<br>            —-+—–+—–+—–+—–+—-<br>            scl | scl | scl | fcl | scl | fcl<br>            —-+—–+—–+—–+—–+—-<br>            fcl | fcl | fcl | fcl | fcl | fcl</p>\n<h2 id=\"4-1-proxy-keywords-matrix\"><a href=\"#4-1-proxy-keywords-matrix\" class=\"headerlink\" title=\"4.1. proxy keywords matrix\"></a>4.1. proxy keywords matrix</h2><p>the following list of keywords is supported. most of them may only be used in a<br>limited set of section types. some of them are marked as “deprecated” because<br>they are inherited from an old syntax which may be confusing or functionally<br>limited, and there are new recommended keywords to replace them. keywords<br>marked with “(*)” can be optionally inverted using the “no” prefix, eg. “no<br>option contstats”. this makes sense when the option has been enabled by default<br>and must be disabled for a specific instance. such options may also be prefixed<br>with “default” in order to restore default settings regardless of what has been<br>specified in a previous “defaults” section.</p>\n<p> keyword                              defaults   frontend   listen    backend<br>————————————+———-+———-+———+———<br>acl                                       -          x         x         x<br>appsession                                -          -         x         x<br>backlog                                   x          x         x         -<br>balance                                   x          -         x         x<br>bind                                      -          x         x         -<br>bind-process                              x          x         x         x<br>block                                     -          x         x         x<br>capture cookie                            -          x         x         -<br>capture request header                    -          x         x         -<br>capture response header                   -          x         x         -<br>clitimeout                  (deprecated)  x          x         x         -<br>compression                               x          x         x         x<br>contimeout                  (deprecated)  x          -         x         x<br>cookie                                    x          -         x         x<br>declare capture                           -          x         x         -<br>default-server                            x          -         x         x<br>default_backend                           x          x         x         -<br>description                               -          x         x         x<br>disabled                                  x          x         x         x<br>dispatch                                  -          -         x         x<br>email-alert from                          x          x         x         x<br>email-alert level                         x          x         x         x<br>email-alert mailers                       x          x         x         x<br>email-alert myhostname                    x          x         x         x<br>email-alert to                            x          x         x         x<br>enabled                                   x          x         x         x<br>errorfile                                 x          x         x         x<br>errorloc                                  x          x         x         x<br>errorloc302                               x          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>errorloc303                               x          x         x         x<br>force-persist                             -          x         x         x<br>fullconn                                  x          -         x         x<br>grace                                     x          x         x         x<br>hash-type                                 x          -         x         x<br>http-check disable-on-404                 x          -         x         x<br>http-check expect                         -          -         x         x<br>http-check send-state                     x          -         x         x<br>http-request                              -          x         x         x<br>http-response                             -          x         x         x<br>http-send-name-header                     -          -         x         x<br>id                                        -          x         x         x<br>ignore-persist                            -          x         x         x<br>log                                  (<em>)  x          x         x         x<br>log-format                                x          x         x         -<br>log-tag                                   x          x         x         x<br>max-keep-alive-queue                      x          -         x         x<br>maxconn                                   x          x         x         -<br>mode                                      x          x         x         x<br>monitor fail                              -          x         x         -<br>monitor-net                               x          x         x         -<br>monitor-uri                               x          x         x         -<br>option abortonclose                  (</em>)  x          -         x         x<br>option accept-invalid-http-request   (<em>)  x          x         x         -<br>option accept-invalid-http-response  (</em>)  x          -         x         x<br>option allbackups                    (<em>)  x          -         x         x<br>option checkcache                    (</em>)  x          -         x         x<br>option clitcpka                      (<em>)  x          x         x         -<br>option contstats                     (</em>)  x          x         x         -<br>option dontlog-normal                (<em>)  x          x         x         -<br>option dontlognull                   (</em>)  x          x         x         -<br>option forceclose                    (<em>)  x          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>option forwardfor                         x          x         x         x<br>option http-buffer-request           (</em>)  x          x         x         x<br>option http-ignore-probes            (<em>)  x          x         x         -<br>option http-keep-alive               (</em>)  x          x         x         x<br>option http-no-delay                 (<em>)  x          x         x         x<br>option http-pretend-keepalive        (</em>)  x          x         x         x<br>option http-server-close             (<em>)  x          x         x         x<br>option http-tunnel                   (</em>)  x          x         x         x<br>option http-use-proxy-header         (<em>)  x          x         x         -<br>option httpchk                            x          -         x         x<br>option httpclose                     (</em>)  x          x         x         x<br>option httplog                            x          x         x         x<br>option http_proxy                    (<em>)  x          x         x         x<br>option independent-streams           (</em>)  x          x         x         x<br>option ldap-check                         x          -         x         x<br>option external-check                     x          -         x         x<br>option log-health-checks             (<em>)  x          -         x         x<br>option log-separate-errors           (</em>)  x          x         x         -<br>option logasap                       (<em>)  x          x         x         -<br>option mysql-check                        x          -         x         x<br>option pgsql-check                        x          -         x         x<br>option nolinger                      (</em>)  x          x         x         x<br>option originalto                         x          x         x         x<br>option persist                       (<em>)  x          -         x         x<br>option redispatch                    (</em>)  x          -         x         x<br>option redis-check                        x          -         x         x<br>option smtpchk                            x          -         x         x<br>option socket-stats                  (<em>)  x          x         x         -<br>option splice-auto                   (</em>)  x          x         x         x<br>option splice-request                (<em>)  x          x         x         x<br>option splice-response               (</em>)  x          x         x         x<br>option srvtcpka                      (<em>)  x          -         x         x<br>option ssl-hello-chk                      x          -         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>option tcp-check                          x          -         x         x<br>option tcp-smart-accept              (</em>)  x          x         x         -<br>option tcp-smart-connect             (<em>)  x          -         x         x<br>option tcpka                              x          x         x         x<br>option tcplog                             x          x         x         x<br>option transparent                   (</em>)  x          -         x         x<br>external-check command                    x          -         x         x<br>external-check path                       x          -         x         x<br>persist rdp-cookie                        x          -         x         x<br>rate-limit sessions                       x          x         x         -<br>redirect                                  -          x         x         x<br>redisp                      (deprecated)  x          -         x         x<br>redispatch                  (deprecated)  x          -         x         x<br>reqadd                                    -          x         x         x<br>reqallow                                  -          x         x         x<br>reqdel                                    -          x         x         x<br>reqdeny                                   -          x         x         x<br>reqiallow                                 -          x         x         x<br>reqidel                                   -          x         x         x<br>reqideny                                  -          x         x         x<br>reqipass                                  -          x         x         x<br>reqirep                                   -          x         x         x<br>reqitarpit                                -          x         x         x<br>reqpass                                   -          x         x         x<br>reqrep                                    -          x         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>reqtarpit                                 -          x         x         x<br>retries                                   x          -         x         x<br>rspadd                                    -          x         x         x<br>rspdel                                    -          x         x         x<br>rspdeny                                   -          x         x         x<br>rspidel                                   -          x         x         x<br>rspideny                                  -          x         x         x<br>rspirep                                   -          x         x         x<br>rsprep                                    -          x         x         x<br>server                                    -          -         x         x<br>source                                    x          -         x         x<br>srvtimeout                  (deprecated)  x          -         x         x<br>stats admin                               -          -         x         x<br>stats auth                                x          -         x         x<br>stats enable                              x          -         x         x<br>stats hide-version                        x          -         x         x<br>stats http-request                        -          -         x         x<br>stats realm                               x          -         x         x<br>stats refresh                             x          -         x         x<br>stats scope                               x          -         x         x<br>stats show-desc                           x          -         x         x<br>stats show-legends                        x          -         x         x<br>stats show-node                           x          -         x         x<br>stats uri                                 x          -         x         x<br>– keyword ————————– defaults - frontend - listen – backend -<br>stick match                               -          -         x         x<br>stick on                                  -          -         x         x<br>stick store-request                       -          -         x         x<br>stick store-response                      -          -         x         x<br>stick-table                               -          -         x         x<br>tcp-check connect                         -          -         x         x<br>tcp-check expect                          -          -         x         x<br>tcp-check send                            -          -         x         x<br>tcp-check send-binary                     -          -         x         x<br>tcp-request connection                    -          x         x         -<br>tcp-request content                       -          x         x         x<br>tcp-request inspect-delay                 -          x         x         x<br>tcp-response content                      -          -         x         x<br>tcp-response inspect-delay                -          -         x         x<br>timeout check                             x          -         x         x<br>timeout client                            x          x         x         -<br>timeout client-fin                        x          x         x         -<br>timeout clitimeout          (deprecated)  x          x         x         -<br>timeout connect                           x          -         x         x<br>timeout contimeout          (deprecated)  x          -         x         x<br>timeout http-keep-alive                   x          x         x         x<br>timeout http-request                      x          x         x         x<br>timeout queue                             x          -         x         x<br>timeout server                            x          -         x         x<br>timeout server-fin                        x          -         x         x<br>timeout srvtimeout          (deprecated)  x          -         x         x<br>timeout tarpit                            x          x         x         x<br>timeout tunnel                            x          -         x         x<br>transparent                 (deprecated)  x          -         x         x<br>unique-id-format                          x          x         x         -<br>unique-id-header                          x          x         x         -<br>use_backend                               -          x         x         -<br>use-server                                -          -         x         x<br>————————————+———-+———-+———+———<br> keyword                              defaults   frontend   listen    backend</p>\n<h2 id=\"4-2-alphabetically-sorted-keywords-reference\"><a href=\"#4-2-alphabetically-sorted-keywords-reference\" class=\"headerlink\" title=\"4.2. alphabetically sorted keywords reference\"></a>4.2. alphabetically sorted keywords reference</h2><p>this section provides a description of each keyword and its usage.</p>\n<p>acl <aclname> <criterion> [flags] [operator] <value> …<br>  declare or complete an access list.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  example:<br>        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3<br>        acl invalid_src  src_port     0:1023<br>        acl local_dst    hdr(host) -i localhost</p>\n<p>  see section 7 about acl usage.</p>\n<p>appsession <cookie> len <length> timeout <holdtime><br>           [request-learn] [prefix] [mode <path-parameters|query-string>]<br>  define session stickiness on an existing application cookie.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <cookie>   this is the name of the cookie used by the application and which<br>               haproxy will have to learn for each new session.</p>\n<pre><code>&lt;length&gt;   this is the max number of characters that will be memorized and\n           checked in each cookie value.\n\n&lt;holdtime&gt; this is the time after which the cookie will be removed from\n           memory if unused. if no unit is specified, this time is in\n           milliseconds.\n\nrequest-learn\n           if this option is specified, then haproxy will be able to learn\n           the cookie found in the request in case the server does not\n           specify any in response. this is typically what happens with\n           phpsessid cookies, or when haproxy&apos;s session expires before\n           the application&apos;s session and the correct server is selected.\n           it is recommended to specify this option to improve reliability.\n\nprefix     when this option is specified, haproxy will match on the cookie\n           prefix (or url parameter prefix). the appsession value is the\n           data following this prefix.\n\n           example :\n           appsession aspsessionid len 64 timeout 3h prefix\n\n           this will match the cookie aspsessionidxxxx=xxxxx,\n           the appsession value will be xxxx=xxxxx.\n\nmode       this option allows to change the url parser mode.\n           2 modes are currently supported :\n           - path-parameters :\n             the parser looks for the appsession in the path parameters\n             part (each parameter is separated by a semi-colon), which is\n             convenient for jsessionid for example.\n             this is the default mode if the option is not set.\n           - query-string :\n             in this mode, the parser will look for the appsession in the\n             query string.\n</code></pre><p>  when an application cookie is defined in a backend, haproxy will check when<br>  the server sets such a cookie, and will store its value in a table, and<br>  associate it with the server’s identifier. up to <length> characters from<br>  the value will be retained. on each connection, haproxy will look for this<br>  cookie both in the “cookie:” headers, and as a url parameter (depending on<br>  the mode used). if a known value is found, the client will be directed to the<br>  server associated with this value. otherwise, the load balancing algorithm is<br>  applied. cookies are automatically removed from memory when they have been<br>  unused for a duration longer than <holdtime>.</p>\n<p>  the definition of an application cookie is limited to one per backend.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :<br>        appsession jsessionid len 52 timeout 3h</p>\n<p>  see also : “cookie”, “capture cookie”, “balance”, “stick”, “stick-table”,<br>             “ignore-persist”, “nbproc” and “bind-process”.</p>\n<p>backlog <conns><br>  give hints to the system about the approximate listen backlog desired size<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <conns>   is the number of pending connections. depending on the operating<br>              system, it may represent the number of already acknowledged<br>              connections, of non-acknowledged ones, or both.</p>\n<p>  in order to protect against syn flood attacks, one solution is to increase<br>  the system’s syn backlog size. depending on the system, sometimes it is just<br>  tunable via a system parameter, sometimes it is not adjustable at all, and<br>  sometimes the system relies on hints given by the application at the time of<br>  the listen() syscall. by default, haproxy passes the frontend’s maxconn value<br>  to the listen() syscall. on systems which can make use of this value, it can<br>  sometimes be useful to be able to specify a different value, hence this<br>  backlog parameter.</p>\n<p>  on linux 2.4, the parameter is ignored by the system. on linux 2.6, it is<br>  used as a hint and the system accepts up to the smallest greater power of<br>  two, and never more than some limits (usually 32768).</p>\n<p>  see also : “maxconn” and the target operating system’s tuning guide.</p>\n<p>balance <algorithm> [ <arguments> ]<br>balance url_param <param> [check_post]<br>  define the load balancing algorithm to be used in a backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <algorithm> is the algorithm used to select a server when doing load<br>                balancing. this only applies when no persistence information<br>                is available, or when a connection is redispatched to another<br>                server. <algorithm> may be one of the following :</p>\n<pre><code>  roundrobin  each server is used in turns, according to their weights.\n              this is the smoothest and fairest algorithm when the server&apos;s\n              processing time remains equally distributed. this algorithm\n              is dynamic, which means that server weights may be adjusted\n              on the fly for slow starts for instance. it is limited by\n              design to 4095 active servers per backend. note that in some\n              large farms, when a server becomes up after having been down\n              for a very short time, it may sometimes take a few hundreds\n              requests for it to be re-integrated into the farm and start\n              receiving traffic. this is normal, though very rare. it is\n              indicated here in case you would have the chance to observe\n              it, so that you don&apos;t worry.\n\n  static-rr   each server is used in turns, according to their weights.\n              this algorithm is as similar to roundrobin except that it is\n              static, which means that changing a server&apos;s weight on the\n              fly will have no effect. on the other hand, it has no design\n              limitation on the number of servers, and when a server goes\n              up, it is always immediately reintroduced into the farm, once\n              the full map is recomputed. it also uses slightly less cpu to\n              run (around -1%).\n\n  leastconn   the server with the lowest number of connections receives the\n              connection. round-robin is performed within groups of servers\n              of the same load to ensure that all servers will be used. use\n              of this algorithm is recommended where very long sessions are\n              expected, such as ldap, sql, tse, etc... but is not very well\n              suited for protocols using short sessions such as http. this\n              algorithm is dynamic, which means that server weights may be\n              adjusted on the fly for slow starts for instance.\n\n  first       the first server with available connection slots receives the\n              connection. the servers are chosen from the lowest numeric\n              identifier to the highest (see server parameter &quot;id&quot;), which\n              defaults to the server&apos;s position in the farm. once a server\n              reaches its maxconn value, the next server is used. it does\n              not make sense to use this algorithm without setting maxconn.\n              the purpose of this algorithm is to always use the smallest\n              number of servers so that extra servers can be powered off\n              during non-intensive hours. this algorithm ignores the server\n              weight, and brings more benefit to long session such as rdp\n              or imap than http, though it can be useful there too. in\n              order to use this algorithm efficiently, it is recommended\n              that a cloud controller regularly checks server usage to turn\n              them off when unused, and regularly checks backend queue to\n              turn new servers on when the queue inflates. alternatively,\n              using &quot;http-check send-state&quot; may inform servers on the load.\n\n  source      the source ip address is hashed and divided by the total\n              weight of the running servers to designate which server will\n              receive the request. this ensures that the same client ip\n              address will always reach the same server as long as no\n              server goes down or up. if the hash result changes due to the\n              number of running servers changing, many clients will be\n              directed to a different server. this algorithm is generally\n              used in tcp mode where no cookie may be inserted. it may also\n              be used on the internet to provide a best-effort stickiness\n              to clients which refuse session cookies. this algorithm is\n              static by default, which means that changing a server&apos;s\n              weight on the fly will have no effect, but this can be\n              changed using &quot;hash-type&quot;.\n\n  uri         this algorithm hashes either the left part of the uri (before\n              the question mark) or the whole uri (if the &quot;whole&quot; parameter\n              is present) and divides the hash value by the total weight of\n              the running servers. the result designates which server will\n              receive the request. this ensures that the same uri will\n              always be directed to the same server as long as no server\n              goes up or down. this is used with proxy caches and\n              anti-virus proxies in order to maximize the cache hit rate.\n              note that this algorithm may only be used in an http backend.\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n              this algorithm supports two optional parameters &quot;len&quot; and\n              &quot;depth&quot;, both followed by a positive integer number. these\n              options may be helpful when it is needed to balance servers\n              based on the beginning of the uri only. the &quot;len&quot; parameter\n              indicates that the algorithm should only consider that many\n              characters at the beginning of the uri to compute the hash.\n              note that having &quot;len&quot; set to 1 rarely makes sense since most\n              uris start with a leading &quot;/&quot;.\n\n              the &quot;depth&quot; parameter indicates the maximum directory depth\n              to be used to compute the hash. one level is counted for each\n              slash in the request. if both parameters are specified, the\n              evaluation stops when either is reached.\n\n  url_param   the url parameter specified in argument will be looked up in\n              the query string of each http get request.\n\n              if the modifier &quot;check_post&quot; is used, then an http post\n              request entity will be searched for the parameter argument,\n              when it is not found in a query string after a question mark\n              (&apos;?&apos;) in the url. the message body will only start to be\n              analyzed once either the advertised amount of data has been\n              received or the request buffer is full. in the unlikely event\n              that chunked encoding is used, only the first chunk is\n              scanned. parameter values separated by a chunk boundary, may\n              be randomly balanced if at all. this keyword used to support\n              an optional &lt;max_wait&gt; parameter which is now ignored.\n\n              if the parameter is found followed by an equal sign (&apos;=&apos;) and\n              a value, then the value is hashed and divided by the total\n              weight of the running servers. the result designates which\n              server will receive the request.\n\n              this is used to track user identifiers in requests and ensure\n              that a same user id will always be sent to the same server as\n              long as no server goes up or down. if no value is found or if\n              the parameter is not found, then a round robin algorithm is\n              applied. note that this algorithm may only be used in an http\n              backend. this algorithm is static by default, which means\n              that changing a server&apos;s weight on the fly will have no\n              effect, but this can be changed using &quot;hash-type&quot;.\n\n  hdr(&lt;name&gt;) the http header &lt;name&gt; will be looked up in each http\n              request. just as with the equivalent acl &apos;hdr()&apos; function,\n              the header name in parenthesis is not case sensitive. if the\n              header is absent or if it does not contain any value, the\n              roundrobin algorithm is applied instead.\n\n              an optional &apos;use_domain_only&apos; parameter is available, for\n              reducing the hash algorithm to the main domain part with some\n              specific headers such as &apos;host&apos;. for instance, in the host\n              value &quot;haproxy.1wt.eu&quot;, only &quot;1wt&quot; will be considered.\n\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n  rdp-cookie\n  rdp-cookie(&lt;name&gt;)\n              the rdp cookie &lt;name&gt; (or &quot;mstshash&quot; if omitted) will be\n              looked up and hashed for each incoming tcp request. just as\n              with the equivalent acl &apos;req_rdp_cookie()&apos; function, the name\n              is not case-sensitive. this mechanism is useful as a degraded\n              persistence mode, as it makes it possible to always send the\n              same user (or the same session id) to the same server. if the\n              cookie is not found, the normal roundrobin algorithm is\n              used instead.\n\n              note that for this to work, the frontend must ensure that an\n              rdp cookie is already present in the request buffer. for this\n              you must use &apos;tcp-request content accept&apos; rule combined with\n              a &apos;req_rdp_cookie_cnt&apos; acl.\n\n              this algorithm is static by default, which means that\n              changing a server&apos;s weight on the fly will have no effect,\n              but this can be changed using &quot;hash-type&quot;.\n\n              see also the rdp_cookie pattern fetch function.\n\n&lt;arguments&gt; is an optional list of arguments which may be needed by some\n            algorithms. right now, only &quot;url_param&quot; and &quot;uri&quot; support an\n            optional argument.\n</code></pre><p>  the load balancing algorithm of a backend is set to roundrobin when no other<br>  algorithm, mode nor option have been set. the algorithm may only be set once<br>  for each backend.</p>\n<p>  examples :<br>        balance roundrobin<br>        balance url_param userid<br>        balance url_param session_id check_post 64<br>        balance hdr(user-agent)<br>        balance hdr(host)<br>        balance hdr(host) use_domain_only</p>\n<p>  note: the following caveats and limitations on using the “check_post”<br>  extension with “url_param” must be considered :</p>\n<pre><code>- all post requests are eligible for consideration, because there is no way\n  to determine if the parameters will be found in the body or entity which\n  may contain binary data. therefore another method may be required to\n  restrict consideration of post requests that have no url parameters in\n  the body. (see acl reqideny http_end)\n\n- using a &lt;max_wait&gt; value larger than the request buffer size does not\n  make sense and is useless. the buffer size is set at build time, and\n  defaults to 16 kb.\n\n- content-encoding is not supported, the parameter search will probably\n  fail; and load balancing will fall back to round robin.\n\n- expect: 100-continue is not supported, load balancing will fall back to\n  round robin.\n\n- transfer-encoding (rfc2616 3.6.1) is only supported in the first chunk.\n  if the entire parameter value is not present in the first chunk, the\n  selection of server is undefined (actually, defined by how little\n  actually appeared in the first chunk).\n\n- this feature does not support generation of a 100, 411 or 501 response.\n\n- in some cases, requesting &quot;check_post&quot; may attempt to scan the entire\n  contents of a message body. scanning normally terminates when linear\n  white space or control characters are found, indicating the end of what\n  might be a url parameter list. this is probably not a concern with sgml\n  type message bodies.\n</code></pre><p>  see also : “dispatch”, “cookie”, “appsession”, “transparent”, “hash-type” and<br>             “http_proxy”.</p>\n<p>bind [<address>]:<port_range> [, …] [param<em>]<br>bind /<path> [, …] [param</em>]<br>  define one or several listening addresses and/or ports in a frontend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <address>     is optional and can be a host name, an ipv4 address, an ipv6<br>                  address, or ‘<em>‘. it designates the address the frontend will<br>                  listen on. if unset, all ipv4 addresses of the system will be<br>                  listened on. the same will apply for ‘</em>‘ or the system’s<br>                  special address “0.0.0.0”. the ipv6 equivalent is ‘::’.<br>                  optionally, an address family prefix may be used before the<br>                  address to force the family regardless of the address format,<br>                  which can be useful to specify a path to a unix socket with<br>                  no slash (‘/‘). currently supported prefixes are :</p>\n<pre><code>                - &apos;ipv4@&apos;  -&gt; address is always ipv4\n                - &apos;ipv6@&apos;  -&gt; address is always ipv6\n                - &apos;unix@&apos;  -&gt; address is a path to a local unix socket\n                - &apos;abns@&apos;  -&gt; address is in abstract namespace (linux only).\n                  note: since abstract sockets are not &quot;rebindable&quot;, they\n                        do not cope well with multi-process mode during\n                        soft-restart, so it is better to avoid them if\n                        nbproc is greater than 1\\. the effect is that if the\n                        new process fails to start, only one of the old ones\n                        will be able to rebind to the socket.\n                - &apos;fd@&lt;n&gt;&apos; -&gt; use file descriptor &lt;n&gt; inherited from the\n                  parent. the fd must be bound and may or may not already\n                  be listening.\n              you may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment\n              variables.\n\n&lt;port_range&gt;  is either a unique tcp port, or a port range for which the\n              proxy will accept connections for the ip address specified\n              above. the port is mandatory for tcp listeners. note that in\n              the case of an ipv6 address, the port is always the number\n              after the last colon (&apos;:&apos;). a range can either be :\n               - a numerical port (ex: &apos;80&apos;)\n               - a dash-delimited ports range explicitly stating the lower\n                 and upper bounds (ex: &apos;2000-2100&apos;) which are included in\n                 the range.\n\n              particular care must be taken against port ranges, because\n              every &lt;address:port&gt; couple consumes one socket (= a file\n              descriptor), so it&apos;s easy to consume lots of descriptors\n              with a simple range, and to run out of sockets. also, each\n              &lt;address:port&gt; couple must be used only once among all\n              instances running on a same system. please note that binding\n              to ports lower than 1024 generally require particular\n              privileges to start the program, which are independent of\n              the &apos;uid&apos; parameter.\n\n&lt;path&gt;        is a unix socket path beginning with a slash (&apos;/&apos;). this is\n              alternative to the tcp listening port. haproxy will then\n              receive unix connections on the socket located at this place.\n              the path must begin with a slash and by default is absolute.\n              it can be relative to the prefix defined by &quot;unix-bind&quot; in\n              the global section. note that the total length of the prefix\n              followed by the socket path cannot exceed some system limits\n              for unix sockets, which commonly are set to 107 characters.\n\n&lt;param*&gt;      is a list of parameters common to all sockets declared on the\n              same line. these numerous parameters depend on os and build\n              options and have a complete section dedicated to them. please\n              refer to section 5 to for more details.\n</code></pre><p>  it is possible to specify a list of address:port combinations delimited by<br>  commas. the frontend will then listen on all of these addresses. there is no<br>  fixed limit to the number of addresses and ports which can be listened on in<br>  a frontend, as well as there is no limit to the number of “bind” statements<br>  in a frontend.</p>\n<p>  example :<br>        listen http_proxy<br>            bind :80,:443<br>            bind 10.0.0.1:10080,10.0.0.1:10443<br>            bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy</p>\n<pre><code>listen http_https_proxy\n    bind :80\n    bind :443 ssl crt /etc/haproxy/site.pem\n\nlisten http_https_proxy_explicit\n    bind ipv6@:80\n    bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem\n    bind unix@ssl-frontend.sock user root mode 600 accept-proxy\n\nlisten external_bind_app1\n    bind &quot;fd@${fd_app1}&quot;\n</code></pre><p>  see also : “source”, “option forwardfor”, “unix-bind” and the proxy protocol<br>             documentation, and section 5 about bind options.</p>\n<p>bind-process [ all | odd | even | <number 1-64>[-<number 1-64>] ] …<br>  limit visibility of an instance to a certain set of processes numbers.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    all           all process will see this instance. this is the default. it<br>                  may be used to override a default value.</p>\n<pre><code>odd           this instance will be enabled on processes 1,3,5,...63\\. this\n              option may be combined with other numbers.\n\neven          this instance will be enabled on processes 2,4,6,...64\\. this\n              option may be combined with other numbers. do not use it\n              with less than 2 processes otherwise some instances might be\n              missing from all processes.\n\nnumber        the instance will be enabled on this process number or range,\n              whose values must all be between 1 and 32 or 64 depending on\n              the machine&apos;s word size. if a proxy is bound to process\n              numbers greater than the configured global.nbproc, it will\n              either be forced to process #1 if a single process was\n              specified, or to all processes otherwise.\n</code></pre><p>  this keyword limits binding of certain instances to certain processes. this<br>  is useful in order not to have too many processes listening to the same<br>  ports. for instance, on a dual-core machine, it might make sense to set<br>  ‘nbproc 2’ in the global section, then distributes the listeners among ‘odd’<br>  and ‘even’ instances.</p>\n<p>  at the moment, it is not possible to reference more than 32 or 64 processes<br>  using this keyword, but this should be more than enough for most setups.<br>  please note that ‘all’ really means all processes regardless of the machine’s<br>  word size, and is not limited to the first 32 or 64.</p>\n<p>  each “bind” line may further be limited to a subset of the proxy’s processes,<br>  please consult the “process” bind keyword in section 5.1.</p>\n<p>  when a frontend has no explicit “bind-process” line, it tries to bind to all<br>  the processes referenced by its “bind” lines. that means that frontends can<br>  easily adapt to their listeners’ processes.</p>\n<p>  if some backends are referenced by frontends bound to other processes, the<br>  backend automatically inherits the frontend’s processes.</p>\n<p>  example :<br>        listen app_ip1<br>            bind 10.0.0.1:80<br>            bind-process odd</p>\n<pre><code>listen app_ip2\n    bind 10.0.0.2:80\n    bind-process even\n\nlisten management\n    bind 10.0.0.3:80\n    bind-process 1 2 3 4\n\nlisten management\n    bind 10.0.0.4:80\n    bind-process 1-4\n</code></pre><p>  see also : “nbproc” in global section, and “process” in section 5.1.</p>\n<p>block { if | unless } <condition><br>  block a layer 7 request if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</p>\n<p>  the http request will be blocked very early in the layer 7 processing<br>  if/unless <condition> is matched. a 403 error will be returned if the request<br>  is blocked. the condition has to reference acls (see section 7). this is<br>  typically used to deny access to certain sensitive resources if some<br>  conditions are met or not met. there is no fixed limit to the number of<br>  “block” statements per instance.</p>\n<p>  example:<br>        acl invalid_src  src          0.0.0.0/7 224.0.0.0/3<br>        acl invalid_src  src_port     0:1023<br>        acl local_dst    hdr(host) -i localhost<br>        block if invalid_src || local_dst</p>\n<p>  see section 7 about acl usage.</p>\n<p>capture cookie <name> len <length><br>  capture and log a cookie in the request and in the response.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the beginning of the name of the cookie to capture. in order<br>              to match the exact name, simply suffix the name with an equal<br>              sign (‘=’). the full name will appear in the logs, which is<br>              useful with application servers which adjust both the cookie name<br>              and value (eg: aspsessionxxxxx).</p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to report in the logs, which\n          include the cookie name, the equal sign and the value, all in the\n          standard &quot;name=value&quot; form. the string will be truncated on the\n          right if it exceeds &lt;length&gt;.\n</code></pre><p>  only the first cookie is captured. both the “cookie” request headers and the<br>  “set-cookie” response headers are monitored. this is particularly useful to<br>  check for application bugs causing session crossing or stealing between<br>  users, because generally the user’s cookies can only change on a login page.</p>\n<p>  when the cookie was not presented by the client, the associated log column<br>  will report “-“. when a request does not cause a cookie to be assigned by the<br>  server, a “-“ is reported in the response column.</p>\n<p>  the capture is performed in the frontend only because it is necessary that<br>  the log format does not change for a given frontend depending on the<br>  backends. this may change in the future. note that there can be only one<br>  “capture cookie” statement in a frontend. the maximum capture length is set<br>  by the global “tune.http.cookielen” setting and defaults to 63 characters. it<br>  is not possible to specify a capture in a “defaults” section.</p>\n<p>  example:<br>        capture cookie aspsession len 32</p>\n<p>  see also : “capture request header”, “capture response header” as well as<br>            section 8 about logging.</p>\n<p>capture request header <name> len <length><br>  capture and log the last occurrence of the specified request header.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the name of the header to capture. the header names are not<br>              case-sensitive, but it is a common practice to write them as they<br>              appear in the requests, with the first letter of each word in<br>              upper case. the header name will not appear in the logs, only the<br>              value is reported, but the position in the logs is respected.</p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to extract from the value and\n          report in the logs. the string will be truncated on the right if\n          it exceeds &lt;length&gt;.\n</code></pre><p>  the complete value of the last occurrence of the header is captured. the<br>  value will be added to the logs between braces (‘{}’). if multiple headers<br>  are captured, they will be delimited by a vertical bar (‘|’) and will appear<br>  in the same order they were declared in the configuration. non-existent<br>  headers will be logged just as an empty string. common uses for request<br>  header captures include the “host” field in virtual hosting environments, the<br>  “content-length” when uploads are supported, “user-agent” to quickly<br>  differentiate between real users and robots, and “x-forwarded-for” in proxied<br>  environments to find where the request came from.</p>\n<p>  note that when capturing headers such as “user-agent”, some spaces may be<br>  logged, making the log analysis more difficult. thus be careful about what<br>  you log if you know your log parser is not smart enough to rely on the<br>  braces.</p>\n<p>  there is no limit to the number of captured request headers nor to their<br>  length, though it is wise to keep them low to limit memory usage per session.<br>  in order to keep log format consistent for a same frontend, header captures<br>  can only be declared in a frontend. it is not possible to specify a capture<br>  in a “defaults” section.</p>\n<p>  example:<br>        capture request header host len 15<br>        capture request header x-forwarded-for len 15<br>        capture request header referrer len 15</p>\n<p>  see also : “capture cookie”, “capture response header” as well as section 8<br>             about logging.</p>\n<p>capture response header <name> len <length><br>  capture and log the last occurrence of the specified response header.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <name>    is the name of the header to capture. the header names are not<br>              case-sensitive, but it is a common practice to write them as they<br>              appear in the response, with the first letter of each word in<br>              upper case. the header name will not appear in the logs, only the<br>              value is reported, but the position in the logs is respected.</p>\n<pre><code>&lt;length&gt;  is the maximum number of characters to extract from the value and\n          report in the logs. the string will be truncated on the right if\n          it exceeds &lt;length&gt;.\n</code></pre><p>  the complete value of the last occurrence of the header is captured. the<br>  result will be added to the logs between braces (‘{}’) after the captured<br>  request headers. if multiple headers are captured, they will be delimited by<br>  a vertical bar (‘|’) and will appear in the same order they were declared in<br>  the configuration. non-existent headers will be logged just as an empty<br>  string. common uses for response header captures include the “content-length”<br>  header which indicates how many bytes are expected to be returned, the<br>  “location” header to track redirections.</p>\n<p>  there is no limit to the number of captured response headers nor to their<br>  length, though it is wise to keep them low to limit memory usage per session.<br>  in order to keep log format consistent for a same frontend, header captures<br>  can only be declared in a frontend. it is not possible to specify a capture<br>  in a “defaults” section.</p>\n<p>  example:<br>        capture response header content-length len 9<br>        capture response header location len 15</p>\n<p>  see also : “capture cookie”, “capture request header” as well as section 8<br>             about logging.</p>\n<p>clitimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the client side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value is specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase, when the client sends the request, and during the<br>  response while it is reading data sent by the server. the value is specified<br>  in milliseconds by default, but can be in any other unit if the number is<br>  suffixed by the unit, as specified at the top of this document. in tcp mode<br>  (and to a lesser extent, in http mode), it is highly recommended that the<br>  client timeout remains equal to the server timeout in order to avoid complex<br>  situations to debug. it is a good practice to cover one or several tcp packet<br>  losses by specifying timeouts that are slightly above multiples of 3 seconds<br>  (eg: 4 or 5 seconds).</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for compatibility but is currently deprecated.<br>  please use “timeout client” instead.</p>\n<p>  see also : “timeout client”, “timeout http-request”, “timeout server”, and<br>             “srvtimeout”.</p>\n<p>compression algo <algorithm> …<br>compression type <mime type> …<br>compression offload<br>  enable http compression.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    algo     is followed by the list of supported compression algorithms.<br>    type     is followed by the list of mime types that will be compressed.<br>    offload  makes haproxy work as a compression offloader only (see notes).</p>\n<p>  the currently supported algorithms are :<br>    identity     this is mostly for debugging, and it was useful for developing<br>                 the compression feature. identity does not apply any change on<br>                 data.</p>\n<pre><code>gzip         applies gzip compression. this setting is only available when\n             support for zlib was built in.\n\ndeflate      same as &quot;gzip&quot;, but with deflate algorithm and zlib format.\n             note that this algorithm has ambiguous support on many\n             browsers and no support at all from recent ones. it is\n             strongly recommended not to use it for anything else than\n             experimentation. this setting is only available when support\n             for zlib was built in.\n\nraw-deflate  same as &quot;deflate&quot; without the zlib wrapper, and used as an\n             alternative when the browser wants &quot;deflate&quot;. all major\n             browsers understand it and despite violating the standards,\n             it is known to work better than &quot;deflate&quot;, at least on msie\n             and some versions of safari. do not use it in conjunction\n             with &quot;deflate&quot;, use either one or the other since both react\n             to the same accept-encoding token. this setting is only\n             available when support for zlib was built in.\n</code></pre><p>  compression will be activated depending on the accept-encoding request<br>  header. with identity, it does not take care of that header.<br>  if backend servers support http compression, these directives<br>  will be no-op: haproxy will see the compressed response and will not<br>  compress again. if backend servers do not support http compression and<br>  there is accept-encoding header in request, haproxy will compress the<br>  matching response.</p>\n<p>  the “offload” setting makes haproxy remove the accept-encoding header to<br>  prevent backend servers from compressing responses. it is strongly<br>  recommended not to do this because this means that all the compression work<br>  will be done on the single point where haproxy is located. however in some<br>  deployment scenarios, haproxy may be installed in front of a buggy gateway<br>  with broken http compression implementation which can’t be turned off.<br>  in that case haproxy can be used to prevent that gateway from emitting<br>  invalid payloads. in this case, simply removing the header in the<br>  configuration does not work because it applies before the header is parsed,<br>  so that prevents haproxy from compressing. the “offload” setting should<br>  then be used for such scenarios. note: for now, the “offload” setting is<br>  ignored when set in a defaults section.</p>\n<p>  compression is disabled when:</p>\n<pre><code>* the request does not advertise a supported compression algorithm in the\n  &quot;accept-encoding&quot; header\n* the response message is not http/1.1\n* http status code is not 200\n* response header &quot;transfer-encoding&quot; contains &quot;chunked&quot; (temporary\n  workaround)\n* response contain neither a &quot;content-length&quot; header nor a\n  &quot;transfer-encoding&quot; whose last value is &quot;chunked&quot;\n* response contains a &quot;content-type&quot; header whose first value starts with\n  &quot;multipart&quot;\n* the response contains the &quot;no-transform&quot; value in the &quot;cache-control&quot;\n  header\n* user-agent matches &quot;mozilla/4&quot; unless it is msie 6 with xp sp2, or msie 7\n  and later\n* the response contains a &quot;content-encoding&quot; header, indicating that the\n  response is already compressed (see compression offload)\n</code></pre><p>  note: the compression does not rewrite etag headers, and does not emit the<br>        warning header.</p>\n<p>  examples :<br>        compression algo gzip<br>        compression type text/html text/plain</p>\n<p>contimeout <timeout> (deprecated)<br>  set the maximum time to wait for a connection attempt to a server to succeed.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value is specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  if the server is located on the same lan as haproxy, the connection should be<br>  immediate (less than a few milliseconds). anyway, it is a good practice to<br>  cover one or several tcp packet losses by specifying timeouts that are<br>  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the<br>  connect timeout also presets the queue timeout to the same value if this one<br>  has not been specified. historically, the contimeout was also used to set the<br>  tarpit timeout in a listen section, which is not possible in a pure frontend.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of failed sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for backwards compatibility but is currently<br>  deprecated. please use “timeout connect”, “timeout queue” or “timeout tarpit”<br>  instead.</p>\n<p>  see also : “timeout connect”, “timeout queue”, “timeout tarpit”,<br>             “timeout server”, “contimeout”.</p>\n<p>cookie <name> [ rewrite | insert | prefix ] [ indirect ] [ nocache ]<br>              [ postonly ] [ preserve ] [ httponly ] [ secure ]<br>              [ domain <domain> ]* [ maxidle <idle> ] [ maxlife <life> ]<br>  enable cookie-based persistence in a backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the name of the cookie which will be monitored, modified or<br>              inserted in order to bring persistence. this cookie is sent to<br>              the client via a “set-cookie” header in the response, and is<br>              brought back by the client in a “cookie” header in all requests.<br>              special care should be taken to choose a name which does not<br>              conflict with any likely application cookie. also, if the same<br>              backends are subject to be used by the same clients (eg:<br>              http/https), care should be taken to use different cookie names<br>              between all backends if persistence between them is not desired.</p>\n<pre><code>rewrite   this keyword indicates that the cookie will be provided by the\n          server and that haproxy will have to modify its value to set the\n          server&apos;s identifier in it. this mode is handy when the management\n          of complex combinations of &quot;set-cookie&quot; and &quot;cache-control&quot;\n          headers is left to the application. the application can then\n          decide whether or not it is appropriate to emit a persistence\n          cookie. since all responses should be monitored, this mode only\n          works in http close mode. unless the application behaviour is\n          very complex and/or broken, it is advised not to start with this\n          mode for new deployments. this keyword is incompatible with\n          &quot;insert&quot; and &quot;prefix&quot;.\n\ninsert    this keyword indicates that the persistence cookie will have to\n          be inserted by haproxy in server responses if the client did not\n\n          already have a cookie that would have permitted it to access this\n          server. when used without the &quot;preserve&quot; option, if the server\n          emits a cookie with the same name, it will be remove before\n          processing.  for this reason, this mode can be used to upgrade\n          existing configurations running in the &quot;rewrite&quot; mode. the cookie\n          will only be a session cookie and will not be stored on the\n          client&apos;s disk. by default, unless the &quot;indirect&quot; option is added,\n          the server will see the cookies emitted by the client. due to\n          caching effects, it is generally wise to add the &quot;nocache&quot; or\n          &quot;postonly&quot; keywords (see below). the &quot;insert&quot; keyword is not\n          compatible with &quot;rewrite&quot; and &quot;prefix&quot;.\n\nprefix    this keyword indicates that instead of relying on a dedicated\n          cookie for the persistence, an existing one will be completed.\n          this may be needed in some specific environments where the client\n          does not support more than one single cookie and the application\n          already needs it. in this case, whenever the server sets a cookie\n          named &lt;name&gt;, it will be prefixed with the server&apos;s identifier\n          and a delimiter. the prefix will be removed from all client\n          requests so that the server still finds the cookie it emitted.\n          since all requests and responses are subject to being modified,\n          this mode requires the http close mode. the &quot;prefix&quot; keyword is\n          not compatible with &quot;rewrite&quot; and &quot;insert&quot;. note: it is highly\n          recommended not to use &quot;indirect&quot; with &quot;prefix&quot;, otherwise server\n          cookie updates would not be sent to clients.\n\nindirect  when this option is specified, no cookie will be emitted to a\n          client which already has a valid one for the server which has\n          processed the request. if the server sets such a cookie itself,\n          it will be removed, unless the &quot;preserve&quot; option is also set. in\n          &quot;insert&quot; mode, this will additionally remove cookies from the\n          requests transmitted to the server, making the persistence\n          mechanism totally transparent from an application point of view.\n          note: it is highly recommended not to use &quot;indirect&quot; with\n          &quot;prefix&quot;, otherwise server cookie updates would not be sent to\n          clients.\n\nnocache   this option is recommended in conjunction with the insert mode\n          when there is a cache between the client and haproxy, as it\n          ensures that a cacheable response will be tagged non-cacheable if\n          a cookie needs to be inserted. this is important because if all\n          persistence cookies are added on a cacheable home page for\n          instance, then all customers will then fetch the page from an\n          outer cache and will all share the same persistence cookie,\n          leading to one server receiving much more traffic than others.\n          see also the &quot;insert&quot; and &quot;postonly&quot; options.\n\npostonly  this option ensures that cookie insertion will only be performed\n          on responses to post requests. it is an alternative to the\n          &quot;nocache&quot; option, because post responses are not cacheable, so\n          this ensures that the persistence cookie will never get cached.\n          since most sites do not need any sort of persistence before the\n          first post which generally is a login request, this is a very\n          efficient method to optimize caching without risking to find a\n          persistence cookie in the cache.\n          see also the &quot;insert&quot; and &quot;nocache&quot; options.\n\npreserve  this option may only be used with &quot;insert&quot; and/or &quot;indirect&quot;. it\n          allows the server to emit the persistence cookie itself. in this\n          case, if a cookie is found in the response, haproxy will leave it\n          untouched. this is useful in order to end persistence after a\n          logout request for instance. for this, the server just has to\n          emit a cookie with an invalid value (eg: empty) or with a date in\n          the past. by combining this mechanism with the &quot;disable-on-404&quot;\n          check option, it is possible to perform a completely graceful\n          shutdown because users will definitely leave the server after\n          they logout.\n\nhttponly  this option tells haproxy to add an &quot;httponly&quot; cookie attribute\n          when a cookie is inserted. this attribute is used so that a\n          user agent doesn&apos;t share the cookie with non-http components.\n          please check rfc6265 for more information on this attribute.\n\nsecure    this option tells haproxy to add a &quot;secure&quot; cookie attribute when\n          a cookie is inserted. this attribute is used so that a user agent\n          never emits this cookie over non-secure channels, which means\n          that a cookie learned with this flag will be presented only over\n          ssl/tls connections. please check rfc6265 for more information on\n          this attribute.\n\ndomain    this option allows to specify the domain at which a cookie is\n          inserted. it requires exactly one parameter: a valid domain\n          name. if the domain begins with a dot, the browser is allowed to\n          use it for any host ending with that name. it is also possible to\n          specify several domain names by invoking this option multiple\n          times. some browsers might have small limits on the number of\n          domains, so be careful when doing that. for the record, sending\n          10 domains to msie 6 or firefox 2 works as expected.\n\nmaxidle   this option allows inserted cookies to be ignored after some idle\n          time. it only works with insert-mode cookies. when a cookie is\n          sent to the client, the date this cookie was emitted is sent too.\n          upon further presentations of this cookie, if the date is older\n          than the delay indicated by the parameter (in seconds), it will\n          be ignored. otherwise, it will be refreshed if needed when the\n          response is sent to the client. this is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (eg: after a farm size change). when\n          this option is set and a cookie has no date, it is always\n          accepted, but gets refreshed in the response. this maintains the\n          ability for admins to access their sites. cookies that have a\n          date in the future further than 24 hours are ignored. doing so\n          lets admins fix timezone issues without risking kicking users off\n          the site.\n\nmaxlife   this option allows inserted cookies to be ignored after some life\n          time, whether they&apos;re in use or not. it only works with insert\n          mode cookies. when a cookie is first sent to the client, the date\n          this cookie was emitted is sent too. upon further presentations\n          of this cookie, if the date is older than the delay indicated by\n          the parameter (in seconds), it will be ignored. if the cookie in\n          the request has no date, it is accepted and a date will be set.\n          cookies that have a date in the future further than 24 hours are\n          ignored. doing so lets admins fix timezone issues without risking\n          kicking users off the site. contrary to maxidle, this value is\n          not refreshed, only the first visit date counts. both maxidle and\n          maxlife may be used at the time. this is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (eg: after a farm size change). this\n          is stronger than the maxidle method in that it forces a\n          redispatch after some absolute delay.\n</code></pre><p>  there can be only one persistence cookie per http backend, and it can be<br>  declared in a defaults section. the value of the cookie will be the value<br>  indicated after the “cookie” keyword in a “server” statement. if no cookie<br>  is declared for a given server, the cookie is not set.</p>\n<p>  examples :<br>        cookie jsessionid prefix<br>        cookie srv insert indirect nocache<br>        cookie srv insert postonly indirect<br>        cookie srv insert indirect nocache maxidle 30m maxlife 8h</p>\n<p>  see also : “appsession”, “balance source”, “capture cookie”, “server”<br>             and “ignore-persist”.</p>\n<p>declare capture [ request | response ] len <length><br>  declares a capture slot.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments:<br>    <length> is the length allowed for the capture.</p>\n<p>  this declaration is only available in the frontend or listen section, but the<br>  reserved slot can be used in the backends. the “request” keyword allocates a<br>  capture slot for use in the request, and “response” allocates a capture slot<br>  for use in the response.</p>\n<p>  see also: “capture-req”, “capture-res” (sample converters),<br>            “http-request capture” and “http-response capture”.</p>\n<p>default-server [param<em>]<br>  change default options for a server in a backend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments:<br>    &lt;param</em>&gt;  is a list of parameters for this server. the “default-server”<br>              keyword accepts an important number of options and has a complete<br>              section dedicated to it. please refer to section 5 for more<br>              details.</p>\n<p>  example :<br>        default-server inter 1000 weight 13</p>\n<p>  see also: “server” and section 5 about server options</p>\n<p>default_backend <backend><br>  specify the backend to use when no “use_backend” rule has been matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <backend> is the name of the backend to use.</p>\n<p>  when doing content-switching between frontend and backends using the<br>  “use_backend” keyword, it is often useful to indicate which backend will be<br>  used when no rule has matched. it generally is the dynamic backend which<br>  will catch all undetermined requests.</p>\n<p>  example :</p>\n<pre><code>use_backend     dynamic  if  url_dyn\nuse_backend     static   if  url_css url_img extension_img\ndefault_backend dynamic\n</code></pre><p>  see also : “use_backend”</p>\n<p>description <string><br>  describe a listen, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments : string</p>\n<p>  allows to add a sentence to describe the related object in the haproxy html<br>  stats page. the description will be printed on the right of the object name<br>  it describes.<br>  no need to backslash spaces in the <string> arguments.</p>\n<p>disabled<br>  disable a proxy, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  the “disabled” keyword is used to disable an instance, mainly in order to<br>  liberate a listening port or to temporarily disable a service. the instance<br>  will still be created and its configuration will be checked, but it will be<br>  created in the “stopped” state and will appear as such in the statistics. it<br>  will not receive any traffic nor will it send any health-checks or logs. it<br>  is possible to disable many instances at once by adding the “disabled”<br>  keyword in a “defaults” section.</p>\n<p>  see also : “enabled”</p>\n<p>dispatch <address>:<port><br>  set a default server address<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :</p>\n<pre><code>&lt;address&gt; is the ipv4 address of the default server. alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up.\n\n&lt;ports&gt;   is a mandatory port specification. all connections will be sent\n          to this port, and it is not permitted to use port offsets as is\n          possible with normal servers.\n</code></pre><p>  the “dispatch” keyword designates a default server for use when no other<br>  server can take the connection. in the past it was used to forward non<br>  persistent connections to an auxiliary load balancer. due to its simple<br>  syntax, it has also been used for simple tcp relays. it is recommended not to<br>  use it for more clarity, and to use the “server” directive instead.</p>\n<p>  see also : “server”</p>\n<p>enabled<br>  enable a proxy, frontend or backend.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  the “enabled” keyword is used to explicitly enable an instance, when the<br>  defaults has been set to “disabled”. this is very rarely used.</p>\n<p>  see also : “disabled”</p>\n<p>errorfile <code> <file><br>  return a file contents instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 200, 400, 403, 405, 408, 429, 500, 502, 503, and<br>              504.</p>\n<pre><code>&lt;file&gt;    designates a file containing the full http response. it is\n          recommended to follow the common practice of appending &quot;.http&quot; to\n          the filename so that people do not confuse the response with html\n          error pages, and to use absolute paths, since files are read\n          before any chroot is performed.\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  the files are returned verbatim on the tcp socket. this allows any trick such<br>  as redirections to another url or site, as well as tricks to clean cookies,<br>  force enable or disable caching, etc… the package provides default error<br>  files returning the same contents as default errors.</p>\n<p>  the files should not exceed the configured buffer size (bufsize), which<br>  generally is 8 or 16 kb, otherwise they will be truncated. it is also wise<br>  not to put any reference to local contents (eg: images) in order to avoid<br>  loops between the client and haproxy when all servers are down, causing an<br>  error to be returned instead of an image. for better http compliance, it is<br>  recommended that all header lines end with cr-lf and not lf alone.</p>\n<p>  the files are read at the same time as the configuration and kept in memory.<br>  for this reason, the errors continue to be returned even when the process is<br>  chrooted, and no file change is considered while the process is running. a<br>  simple method for developing those files consists in associating them to the<br>  403 status code and interrogating a blocked url.</p>\n<p>  see also : “errorloc”, “errorloc302”, “errorloc303”</p>\n<p>  example :<br>        errorfile 400 /etc/haproxy/errorfiles/400badreq.http<br>        errorfile 408 /dev/null  # workaround chrome pre-connect bug<br>        errorfile 403 /etc/haproxy/errorfiles/403forbid.http<br>        errorfile 503 /etc/haproxy/errorfiles/503sorry.http</p>\n<p>errorloc <code> <url><br>errorloc302 <code> <url><br>  return an http redirection to a url instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 200, 400, 403, 408, 500, 502, 503, and 504.</p>\n<pre><code>&lt;url&gt;     it is the exact contents of the &quot;location&quot; header. it may contain\n          either a relative uri to an error page hosted on the same site,\n          or an absolute uri designating an error page on another site.\n          special care should be given to relative uris to avoid redirect\n          loops if the uri itself may generate the same error (eg: 500).\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  note that both keyword return the http 302 status code, which tells the<br>  client to fetch the designated url using the same http method. this can be<br>  quite problematic in case of non-get methods such as post, because the url<br>  sent to the client might not be allowed for something other than get. to<br>  workaround this problem, please use “errorloc303” which send the http 303<br>  status code, indicating to the client that the url must be fetched with a get<br>  request.</p>\n<p>  see also : “errorfile”, “errorloc303”</p>\n<p>errorloc303 <code> <url><br>  return an http redirection to a url instead of errors generated by haproxy<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <code>    is the http status code. currently, haproxy is capable of<br>              generating codes 400, 403, 408, 500, 502, 503, and 504.</p>\n<pre><code>&lt;url&gt;     it is the exact contents of the &quot;location&quot; header. it may contain\n          either a relative uri to an error page hosted on the same site,\n          or an absolute uri designating an error page on another site.\n          special care should be given to relative uris to avoid redirect\n          loops if the uri itself may generate the same error (eg: 500).\n</code></pre><p>  it is important to understand that this keyword is not meant to rewrite<br>  errors returned by the server, but errors detected and returned by haproxy.<br>  this is why the list of supported errors is limited to a small set.</p>\n<p>  code 200 is emitted in response to requests matching a “monitor-uri” rule.</p>\n<p>  note that both keyword return the http 303 status code, which tells the<br>  client to fetch the designated url using the same http get method. this<br>  solves the usual problems associated with “errorloc” and the 302 code. it is<br>  possible that some very old browsers designed before http/1.1 do not support<br>  it, but no such problem has been reported till now.</p>\n<p>  see also : “errorfile”, “errorloc”, “errorloc302”</p>\n<p>email-alert from <emailaddr><br>  declare the from email address to be used in both the envelope and header<br>  of email alerts.  this is the address that email alerts are sent from.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the from email address to use when sending email alerts\n</code></pre><p>  also requires “email-alert mailers” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert level”, “email-alert mailers”,<br>             “email-alert myhostname”, “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert level <level><br>  declare the maximum log level of messages for which email alerts will be<br>  sent. this acts as a filter on the sending of email alerts.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;level&gt; one of the 8 syslog levels:\n          emerg alert crit err warning notice info  debug\n        the above syslog levels are ordered from lowest to highest.\n</code></pre><p>  by default level is alert</p>\n<p>  also requires “email-alert from”, “email-alert mailers” and<br>  “email-alert to” to be set and if so sending email alerts is enabled<br>  for the proxy.</p>\n<p>  alerts are sent when :</p>\n<ul>\n<li>an un-paused server is marked as down and <level> is alert or lower</li>\n<li>a paused server is marked as down and <level> is notice or lower</li>\n<li>a server is marked as up or enters the drain state and <level><br>is notice or lower</li>\n<li><p>“option log-health-checks” is enabled, <level> is info or lower,<br> and a health check status update occurs</p>\n<p>see also : “email-alert from”, “email-alert mailers”,</p>\n<pre><code>&quot;email-alert myhostname&quot;, &quot;email-alert to&quot;,\nsection 3.6 about mailers.\n</code></pre></li>\n</ul>\n<p>email-alert mailers <mailersect><br>  declare the mailers to be used when sending email alerts<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;mailersect&gt; is the name of the mailers section to send email alerts.\n</code></pre><p>  also requires “email-alert from” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert myhostname”,<br>             “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert myhostname <hostname><br>  declare the to hostname address to be used when communicating with<br>  mailers.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the to email address to use when sending email alerts\n</code></pre><p>  by default the systems hostname is used.</p>\n<p>  also requires “email-alert from”, “email-alert mailers” and<br>  “email-alert to” to be set and if so sending email alerts is enabled<br>  for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert mailers”,<br>             “email-alert to”, section 3.6 about mailers.</p>\n<p>email-alert to <emailaddr><br>  declare both the recipent address in the envelope and to address in the<br>  header of email alerts. this is the address that email alerts are sent to.<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;emailaddr&gt; is the to email address to use when sending email alerts\n</code></pre><p>  also requires “email-alert mailers” and “email-alert to” to be set<br>  and if so sending email alerts is enabled for the proxy.</p>\n<p>  see also : “email-alert from”, “email-alert level”, “email-alert mailers”,<br>             “email-alert myhostname”, section 3.6 about mailers.</p>\n<p>force-persist { if | unless } <condition><br>  declare a condition to force persistence on down servers<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes</p>\n<p>  by default, requests are not dispatched to down servers. it is possible to<br>  force this using “option persist”, but it is unconditional and redispatches<br>  to a valid server if “option redispatch” is set. that leaves with very little<br>  possibilities to force some requests to reach a server which is artificially<br>  marked down for maintenance operations.</p>\n<p>  the “force-persist” statement allows one to declare various acl-based<br>  conditions which, when met, will cause a request to ignore the down status of<br>  a server and still try to connect to it. that makes it possible to start a<br>  server, still replying an error to the health checks, and run a specially<br>  configured browser to test the service. among the handy methods, one could<br>  use a specific source ip address, or a specific cookie. the cookie also has<br>  the advantage that it can easily be added/removed on the browser from a test<br>  page. once the service is validated, it is then possible to open the service<br>  to the world by returning a valid response to health checks.</p>\n<p>  the forced persistence is enabled when an “if” condition is met, or unless an<br>  “unless” condition is met. the final redispatch is always disabled when this<br>  is used.</p>\n<p>  see also : “option redispatch”, “ignore-persist”, “persist”,<br>             and section 7 about acl usage.</p>\n<p>fullconn <conns><br>  specify at what backend load the servers will reach their maxconn<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <conns>   is the number of connections on the backend which will make the<br>              servers use the maximal number of connections.</p>\n<p>  when a server has a “maxconn” parameter specified, it means that its number<br>  of concurrent connections will never go higher. additionally, if it has a<br>  “minconn” parameter, it indicates a dynamic limit following the backend’s<br>  load. the server will then always accept at least <minconn> connections,<br>  never more than <maxconn>, and the limit will be on the ramp between both<br>  values when the backend has less than <conns> concurrent connections. this<br>  makes it possible to limit the load on the servers during normal loads, but<br>  push it further for important loads without overloading the servers during<br>  exceptional loads.</p>\n<p>  since it’s hard to get this value right, haproxy automatically sets it to<br>  10% of the sum of the maxconns of all frontends that may branch to this<br>  backend (based on “use_backend” and “default_backend” rules). that way it’s<br>  safe to leave it unset. however, “use_backend” involving dynamic names are<br>  not counted since there is no way to know if they could match or not.</p>\n<p>  example :</p>\n<pre><code># the servers will accept between 100 and 1000 concurrent connections each\n# and the maximum of 1000 will be reached when the backend reaches 10000\n# connections.\nbackend dynamic\n   fullconn   10000\n   server     srv1   dyn1:80 minconn 100 maxconn 1000\n   server     srv2   dyn2:80 minconn 100 maxconn 1000\n</code></pre><p>  see also : “maxconn”, “server”</p>\n<p>grace <time><br>  maintain a proxy operational for some time after a soft stop<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <time>    is the time (by default in milliseconds) for which the instance<br>              will remain operational with the frontend sockets still listening<br>              when a soft-stop is received via the sigusr1 signal.</p>\n<p>  this may be used to ensure that the services disappear in a certain order.<br>  this was designed so that frontends which are dedicated to monitoring by an<br>  external equipment fail immediately while other ones remain up for the time<br>  needed by the equipment to detect the failure.</p>\n<p>  note that currently, there is very little benefit in using this parameter,<br>  and it may in fact complicate the soft-reconfiguration process more than<br>  simplify it.</p>\n<p>hash-type <method> <function> <modifier><br>  specify a method to use for mapping hashes to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <method> is the method used to select a server from the hash computed by<br>             the <function> :</p>\n<pre><code>  map-based   the hash table is a static array containing all alive servers.\n              the hashes will be very smooth, will consider weights, but\n              will be static in that weight changes while a server is up\n              will be ignored. this means that there will be no slow start.\n              also, since a server is selected by its position in the array,\n              most mappings are changed when the server count changes. this\n              means that when a server goes up or down, or when a server is\n              added to a farm, most connections will be redistributed to\n              different servers. this can be inconvenient with caches for\n              instance.\n\n  consistent  the hash table is a tree filled with many occurrences of each\n              server. the hash key is looked up in the tree and the closest\n              server is chosen. this hash is dynamic, it supports changing\n              weights while the servers are up, so it is compatible with the\n              slow start feature. it has the advantage that when a server\n              goes up or down, only its associations are moved. when a\n              server is added to the farm, only a few part of the mappings\n              are redistributed, making it an ideal method for caches.\n              however, due to its principle, the distribution will never be\n              very smooth and it may sometimes be necessary to adjust a\n              server&apos;s weight or its id to get a more balanced distribution.\n              in order to get the same distribution on multiple load\n              balancers, it is important that all servers have the exact\n              same ids. note: consistent hash uses sdbm and avalanche if no\n              hash function is specified.\n\n&lt;function&gt; is the hash function to be used :\n\n   sdbm   this function was created initially for sdbm (a public-domain\n          reimplementation of ndbm) database library. it was found to do\n          well in scrambling bits, causing better distribution of the keys\n          and fewer splits. it also happens to be a good general hashing\n          function with good distribution, unless the total server weight\n          is a multiple of 64, in which case applying the avalanche\n          modifier may help.\n\n   djb2   this function was first proposed by dan bernstein many years ago\n          on comp.lang.c. studies have shown that for certain workload this\n          function provides a better distribution than sdbm. it generally\n          works well with text-based inputs though it can perform extremely\n          poorly with numeric-only input or when the total server weight is\n          a multiple of 33, unless the avalanche modifier is also used.\n\n   wt6    this function was designed for haproxy while testing other\n          functions in the past. it is not as smooth as the other ones, but\n          is much less sensible to the input data set or to the number of\n          servers. it can make sense as an alternative to sdbm+avalanche or\n          djb2+avalanche for consistent hashing or when hashing on numeric\n          data such as a source ip address or a visitor identifier in a url\n          parameter.\n\n   crc32  this is the most common crc32 implementation as used in ethernet,\n          gzip, png, etc. it is slower than the other ones but may provide\n          a better distribution or less predictable results especially when\n          used on strings.\n\n&lt;modifier&gt; indicates an optional method applied after hashing the key :\n\n   avalanche   this directive indicates that the result from the hash\n               function above should not be used in its raw form but that\n               a 4-byte full avalanche hash must be applied first. the\n               purpose of this step is to mix the resulting bits from the\n               previous hash in order to avoid any undesired effect when\n               the input contains some limited values or when the number of\n               servers is a multiple of one of the hash&apos;s components (64\n               for sdbm, 33 for djb2). enabling avalanche tends to make the\n               result less predictable, but it&apos;s also not as smooth as when\n               using the original function. some testing might be needed\n               with some workloads. this hash is one of the many proposed\n               by bob jenkins.\n</code></pre><p>  the default hash type is “map-based” and is recommended for most usages. the<br>  default function is “sdbm”, the selection of a function should be based on<br>  the range of the values being hashed.</p>\n<p>  see also : “balance”, “server”</p>\n<p>http-check disable-on-404<br>  enable a maintenance mode upon http/404 response to health-checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is set, a server which returns an http code 404 will be<br>  excluded from further load-balancing, but will still receive persistent<br>  connections. this provides a very convenient method for web administrators<br>  to perform a graceful shutdown of their servers. it is also important to note<br>  that a server which is detected as failed while it was in this mode will not<br>  generate an alert, just a notice. if the server responds 2xx or 3xx again, it<br>  will immediately be reinserted into the farm. the status on the stats page<br>  reports “nolb” for a server in this mode. it is important to note that this<br>  option only works in conjunction with the “httpchk” option. if this option<br>  is used with “http-check expect”, then it has precedence over it so that 404<br>  responses will still be considered as soft-stop.</p>\n<p>  see also : “option httpchk”, “http-check expect”</p>\n<p>http-check expect [!] <match> <pattern><br>  make http health checks consider response contents or specific status codes<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <match>   is a keyword indicating how to look for a specific pattern in the<br>              response. the keyword may be one of “status”, “rstatus”,<br>              “string”, or “rstring”. the keyword may be preceded by an<br>              exclamation mark (“!”) to negate the match. spaces are allowed<br>              between the exclamation mark and the keyword. see below for more<br>              details on the supported keywords.</p>\n<pre><code>&lt;pattern&gt; is the pattern to look for. it may be a string or a regular\n          expression. if the pattern contains spaces, they must be escaped\n          with the usual backslash (&apos;\\&apos;).\n</code></pre><p>  by default, “option httpchk” considers that response statuses 2xx and 3xx<br>  are valid, and that others are invalid. when “http-check expect” is used,<br>  it defines what is considered valid or invalid. only one “http-check”<br>  statement is supported in a backend. if a server fails to respond or times<br>  out, the check obviously fails. the available matches are :</p>\n<pre><code>status &lt;string&gt; : test the exact string match for the http status code.\n                  a health check response will be considered valid if the\n                  response&apos;s status code is exactly this string. if the\n                  &quot;status&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the status code matches.\n\nrstatus &lt;regex&gt; : test a regular expression for the http status code.\n                  a health check response will be considered valid if the\n                  response&apos;s status code matches the expression. if the\n                  &quot;rstatus&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the status code matches.\n                  this is mostly used to check for multiple codes.\n\nstring &lt;string&gt; : test the exact string match in the http response body.\n                  a health check response will be considered valid if the\n                  response&apos;s body contains this exact string. if the\n                  &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body contains this\n                  string. this can be used to look for a mandatory word at\n                  the end of a dynamic page, or to detect a failure when a\n                  specific error appears on the check page (eg: a stack\n                  trace).\n\nrstring &lt;regex&gt; : test a regular expression on the http response body.\n                  a health check response will be considered valid if the\n                  response&apos;s body matches this expression. if the &quot;rstring&quot;\n                  keyword is prefixed with &quot;!&quot;, then the response will be\n                  considered invalid if the body matches the expression.\n                  this can be used to look for a mandatory word at the end\n                  of a dynamic page, or to detect a failure when a specific\n                  error appears on the check page (eg: a stack trace).\n</code></pre><p>  it is important to note that the responses will be limited to a certain size<br>  defined by the global “tune.chksize” option, which defaults to 16384 bytes.<br>  thus, too large responses may not contain the mandatory pattern when using<br>  “string” or “rstring”. if a large response is absolutely required, it is<br>  possible to change the default max size by setting the global variable.<br>  however, it is worth keeping in mind that parsing very large responses can<br>  waste some cpu cycles, especially when regular expressions are used, and that<br>  it is always better to focus the checks on smaller resources.</p>\n<p>  also “http-check expect” doesn’t support http keep-alive. keep in mind that it<br>  will automatically append a “connection: close” header, meaning that this<br>  header should not be present in the request provided by “option httpchk”.</p>\n<p>  last, if “http-check expect” is combined with “http-check disable-on-404”,<br>  then this last one has precedence when the server responds with 404.</p>\n<p>  examples :</p>\n<pre><code># only accept status 200 as valid\nhttp-check expect status 200\n\n# consider sql errors as errors\nhttp-check expect ! string sql\\ error\n\n# consider status 5xx only as errors\nhttp-check expect ! rstatus ^5\n\n# check that we have a correct hexadecimal tag before /html\nhttp-check expect rstring &lt;!--tag:[0-9a-f]*&lt;/html&gt;\n</code></pre><p>  see also : “option httpchk”, “http-check disable-on-404”</p>\n<p>http-check send-state<br>  enable emission of a state header with http health checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is set, haproxy will systematically send a special header<br>  “x-haproxy-server-state” with a list of parameters indicating to each server<br>  how they are seen by haproxy. this can be used for instance when a server is<br>  manipulated without access to haproxy and the operator needs to know whether<br>  haproxy still sees it up or not, or if the server is the last one in a farm.</p>\n<p>  the header is composed of fields delimited by semi-colons, the first of which<br>  is a word (“up”, “down”, “nolb”), possibly followed by a number of valid<br>  checks on the total number before transition, just as appears in the stats<br>  interface. next headers are in the form “<variable>=<value>“, indicating in<br>  no specific order some values available in the stats interface :</p>\n<pre><code>- a variable &quot;address&quot;, containing the address of the backend server.\n  this corresponds to the &lt;address&gt; field in the server declaration. for\n  unix domain sockets, it will read &quot;unix&quot;.\n\n- a variable &quot;port&quot;, containing the port of the backend server. this\n  corresponds to the &lt;port&gt; field in the server declaration. for unix\n  domain sockets, it will read &quot;unix&quot;.\n\n- a variable &quot;name&quot;, containing the name of the backend followed by a slash\n  (&quot;/&quot;) then the name of the server. this can be used when a server is\n  checked in multiple backends.\n\n- a variable &quot;node&quot; containing the name of the haproxy node, as set in the\n  global &quot;node&quot; variable, otherwise the system&apos;s hostname if unspecified.\n\n- a variable &quot;weight&quot; indicating the weight of the server, a slash (&quot;/&quot;)\n  and the total weight of the farm (just counting usable servers). this\n  helps to know if other servers are available to handle the load when this\n  one fails.\n\n- a variable &quot;scur&quot; indicating the current number of concurrent connections\n  on the server, followed by a slash (&quot;/&quot;) then the total number of\n  connections on all servers of the same backend.\n\n- a variable &quot;qcur&quot; indicating the current number of requests in the\n  server&apos;s queue.\n</code></pre><p>  example of a header received by the application server :</p>\n<pre><code>&gt;&gt;&gt;  x-haproxy-server-state: up 2/3; name=bck/srv2; node=lb1; weight=1/2; \\\n       scur=13/22; qcur=0\n</code></pre><p>  see also : “option httpchk”, “http-check disable-on-404”</p>\n<p>http-request { allow | deny | tarpit | auth [realm <realm>] | redirect <rule> |<br>              add-header <name> <fmt> | set-header <name> <fmt> |<br>              capture <sample> [ len <length> | id <id> ] |<br>              del-header <name> | set-nice <nice> | set-log-level <level> |<br>              replace-header <name> <match-regex> <replace-fmt> |<br>              replace-value <name> <match-regex> <replace-fmt> |<br>              set-method <fmt> | set-path <fmt> | set-query <fmt> |<br>              set-uri <fmt> | set-tos <tos> | set-mark <mark> |<br>              add-acl(<file name>) <key fmt> |<br>              del-acl(<file name>) <key fmt> |<br>              del-map(<file name>) <key fmt> |<br>              set-map(<file name>) <key fmt> <value fmt> |<br>              set-var(<var name>) <expr> |<br>              { track-sc0 | track-sc1 | track-sc2 } <key> [table <table>] |<br>              lua <function name><br>             }<br>             [ { if | unless } <condition> ]<br>  access control for layer 7 requests</p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    yes   |   yes  |   yes</p>\n<p>  the http-request statement defines a set of rules which apply to layer 7<br>  processing. the rules are evaluated in their declaration order when they are<br>  met in a frontend, listen or backend section. any rule may optionally be<br>  followed by an acl-based condition, in which case it will only be evaluated<br>  if the condition is true.</p>\n<p>  the first keyword is the rule’s action. currently supported actions include :</p>\n<pre><code>- &quot;allow&quot; : this stops the evaluation of the rules and lets the request\n  pass the check. no further &quot;http-request&quot; rules are evaluated.\n\n- &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects\n  the request and emits an http 403 error. no further &quot;http-request&quot; rules\n  are evaluated.\n\n- &quot;tarpit&quot; : this stops the evaluation of the rules and immediately blocks\n  the request without responding for a delay specified by &quot;timeout tarpit&quot;\n  or &quot;timeout connect&quot; if the former is not set. after that delay, if the\n  client is still connected, an http error 500 is returned so that the\n  client does not suspect it has been tarpitted. logs will report the flags\n  &quot;pt&quot;. the goal of the tarpit rule is to slow down robots during an attack\n  when they&apos;re limited on the number of concurrent requests. it can be very\n  efficient against very dumb robots, and will significantly reduce the\n  load on firewalls compared to a &quot;deny&quot; rule. but when facing &quot;correctly&quot;\n  developed robots, it can make things worse by forcing haproxy and the\n  front firewall to support insane number of concurrent connections.\n\n- &quot;auth&quot; : this stops the evaluation of the rules and immediately responds\n  with an http 401 or 407 error code to invite the user to present a valid\n  user name and password. no further &quot;http-request&quot; rules are evaluated. an\n  optional &quot;realm&quot; parameter is supported, it sets the authentication realm\n  that is returned with the response (typically the application&apos;s name).\n\n- &quot;redirect&quot; : this performs an http redirection based on a redirect rule.\n  this is exactly the same as the &quot;redirect&quot; statement except that it\n  inserts a redirect rule which can be processed in the middle of other\n  &quot;http-request&quot; rules and that these rules use the &quot;log-format&quot; strings.\n  see the &quot;redirect&quot; keyword for the rule&apos;s syntax.\n\n- &quot;add-header&quot; appends an http header field whose name is specified in\n  &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format\n  rules (see custom log format in section 8.2.4). this is particularly\n  useful to pass connection-specific information to the server (eg: the\n  client&apos;s ssl certificate), or to combine several headers into one. this\n  rule is not final, so it is possible to add other similar rules. note\n  that header addition is performed immediately, so one rule might reuse\n  the resulting header from a previous rule.\n\n- &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name\n  is first removed if it existed. this is useful when passing security\n  information to the server, where the header must not be manipulated by\n  external users. note that the new value is computed before the removal so\n  it is possible to concatenate a value to an existing header.\n\n- &quot;del-header&quot; removes all http header fields whose name is specified in\n  &lt;name&gt;.\n\n- &quot;replace-header&quot; matches the regular expression in all occurrences of\n  header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with\n  the &lt;replace-fmt&gt; argument. format characters are allowed in replace-fmt\n  and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. the match is only\n  case-sensitive. it is important to understand that this action only\n  considers whole header lines, regardless of the number of values they\n  may contain. this usage is suited to headers naturally containing commas\n  in their value, such as if-modified-since and so on.\n\n  example:\n\n    http-request replace-header cookie foo=([^;]*);(.*) foo=\\1;ip=%bi;\\2\n\n  applied to:\n\n    cookie: foo=foobar; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n  outputs:\n\n    cookie: foo=foobar;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt;\n\n  assuming the backend ip is 192.168.1.20\n\n- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the\n  regex against every comma-delimited value of the header field &lt;name&gt;\n  instead of the entire header. this is suited for all headers which are\n  allowed to carry more than one value. an example could be the accept\n  header.\n\n  example:\n\n    http-request replace-value x-forwarded-for ^192\\.168\\.(.*)$ 172.16.\\1\n\n  applied to:\n\n    x-forwarded-for: 192.168.10.1, 192.168.13.24, 10.0.0.37\n\n  outputs:\n\n    x-forwarded-for: 172.16.10.1, 172.16.13.24, 10.0.0.37\n\n- &quot;set-method&quot; rewrites the request method with the result of the\n  evaluation of format string &lt;fmt&gt;. there should be very few valid reasons\n  for having to do so as this is more likely to break something than to fix\n  it.\n\n- &quot;set-path&quot; rewrites the request path with the result of the evaluation of\n  format string &lt;fmt&gt;. the query string, if any, is left intact. if a\n  scheme and authority is found before the path, they are left intact as\n  well. if the request doesn&apos;t have a path (&quot;*&quot;), this one is replaced with\n  the format. this can be used to prepend a directory component in front of\n  a path for example. see also &quot;set-query&quot; and &quot;set-uri&quot;.\n\n  example :\n      # prepend the host name before the path\n      http-request set-path /%[hdr(host)]%[path]\n\n- &quot;set-query&quot; rewrites the request&apos;s query string which appears after the\n  first question mark (&quot;?&quot;) with the result of the evaluation of format\n  string &lt;fmt&gt;. the part prior to the question mark is left intact. if the\n  request doesn&apos;t contain a question mark and the new value is not empty,\n  then one is added at the end of the uri, followed by the new value. if\n  a question mark was present, it will never be removed even if the value\n  is empty. this can be used to add or remove parameters from the query\n  string. see also &quot;set-query&quot; and &quot;set-uri&quot;.\n\n  example :\n      # replace &quot;%3d&quot; with &quot;=&quot; in the query string\n      http-request set-query %[query,regsub(%3d,=,g)]\n\n- &quot;set-uri&quot; rewrites the request uri with the result of the evaluation of\n  format string &lt;fmt&gt;. the scheme, authority, path and query string are all\n  replaced at once. this can be used to rewrite hosts in front of proxies,\n  or to perform complex modifications to the uri such as moving parts\n  between the path and the query string. see also &quot;set-path&quot; and\n  &quot;set-query&quot;.\n\n- &quot;set-nice&quot; sets the &quot;nice&quot; factor of the current request being processed.\n  it only has effect against the other requests being processed at the same\n  time. the default value is 0, unless altered by the &quot;nice&quot; setting on the\n  &quot;bind&quot; line. the accepted range is -1024..1024\\. the higher the value, the\n  nicest the request will be. lower values will make the request more\n  important than other ones. this can be useful to improve the speed of\n  some requests, or lower the priority of non-important requests. using\n  this setting without prior experimentation can cause some major slowdown.\n\n- &quot;set-log-level&quot; is used to change the log level of the current request\n  when a certain condition is met. valid levels are the 8 syslog levels\n  (see the &quot;log&quot; keyword) plus the special level &quot;silent&quot; which disables\n  logging for this request. this rule is not final so the last matching\n  rule wins. this rule can be useful to disable health checks coming from\n  another equipment.\n\n- &quot;set-tos&quot; is used to set the tos or dscp field value of packets sent to\n  the client to the value passed in &lt;tos&gt; on platforms which support this.\n  this value represents the whole 8 bits of the ip tos field, and can be\n  expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). note\n  that only the 6 higher bits are used in dscp or tos, and the two lower\n  bits are always 0\\. this can be used to adjust some routing behaviour on\n  border routers based on some information from the request. see rfc 2474,\n  2597, 3260 and 4594 for more information.\n\n- &quot;set-mark&quot; is used to set the netfilter mark on all packets sent to the\n  client to the value passed in &lt;mark&gt; on platforms which support it. this\n  value is an unsigned 32 bit value which can be matched by netfilter and\n  by the routing table. it can be expressed both in decimal or hexadecimal\n  format (prefixed by &quot;0x&quot;). this can be useful to force certain packets to\n  take a different route (for example a cheaper network path for bulk\n  downloads). this works on linux kernels 2.6.32 and above and requires\n  admin privileges.\n\n- &quot;add-acl&quot; is used to add a new entry into an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the new entry. it\n  performs a lookup in the acl before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;add acl&quot; command from the\n  stats socket, but can be triggered by an http request.\n\n- &quot;del-acl&quot; is used to delete an entry from an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it is the equivalent of the &quot;del acl&quot; command from the stats socket, but\n  can be triggered by an http request.\n\n- &quot;del-map&quot; is used to delete an entry from a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it takes one argument: &quot;file name&quot; it is the equivalent of the &quot;del map&quot;\n  command from the stats socket, but can be triggered by an http request.\n\n- &quot;set-map&quot; is used to add a new entry into a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes 2 arguments: &lt;key fmt&gt;,\n  which follows log-format rules, used to collect map key, and &lt;value fmt&gt;,\n  which follows log-format rules, used to collect content for the new entry.\n  it performs a lookup in the map before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;set map&quot; command from the\n  stats socket, but can be triggered by an http request.\n\n- capture &lt;sample&gt; [ len &lt;length&gt; | id &lt;id&gt; ] :\n  captures sample expression &lt;sample&gt; from the request buffer, and converts\n  it to a string of at most &lt;len&gt; characters. the resulting string is\n  stored into the next request &quot;capture&quot; slot, so it will possibly appear\n  next to some captured http headers. it will then automatically appear in\n  the logs, and it will be possible to extract it using sample fetch rules\n  to feed it into headers or anything. the length should be limited given\n  that this size will be allocated for each capture during the whole\n  session life. please check section 7.3 (fetching samples) and &quot;capture\n  request header&quot; for more information.\n\n  if the keyword &quot;id&quot; is used instead of &quot;len&quot;, the action tries to store\n  the captured string in a previously declared capture slot. this is useful\n  to run captures in backends. the slot id can be declared by a previous\n  directive &quot;http-request capture&quot; or with the &quot;declare capture&quot; keyword.\n\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;] :\n  enables tracking of sticky counters from current request. these rules\n  do not stop evaluation and do not change default action. three sets of\n  counters may be simultaneously tracked by the same connection. the first\n  &quot;track-sc0&quot; rule executed enables tracking of the counters of the\n  specified table as the first set. the first &quot;track-sc1&quot; rule executed\n  enables tracking of the counters of the specified table as the second\n  set. the first &quot;track-sc2&quot; rule executed enables tracking of the\n  counters of the specified table as the third set. it is a recommended\n  practice to use the first set of counters for the per-frontend counters\n  and the second set for the per-backend ones. but this is just a\n  guideline, all may be used everywhere.\n\n  these actions take one or two arguments :\n    &lt;key&gt;   is mandatory, and is a sample expression rule as described\n            in section 7.3\\. it describes what elements of the incoming\n            request or connection will be analysed, extracted, combined,\n            and used to select which table entry to update the counters.\n\n    &lt;table&gt; is an optional table to be used instead of the default one,\n            which is the stick-table declared in the current proxy. all\n            the counters for the matches and updates for the key will\n            then be performed in that table until the session ends.\n\n  once a &quot;track-sc*&quot; rule is executed, the key is looked up in the table\n  and if it is not found, an entry is allocated for it. then a pointer to\n  that entry is kept during all the session&apos;s life, and this entry&apos;s\n  counters are updated as often as possible, every time the session&apos;s\n  counters are updated, and also systematically when the session ends.\n  counters are only updated for events that happen after the tracking has\n  been started. as an exception, connection counters and request counters\n  are systematically updated so that they reflect useful information.\n\n  if the entry tracks concurrent connection counters, one connection is\n  counted for as long as the entry is tracked, and the entry will not\n  expire during that time. tracking counters also provides a performance\n  advantage over just checking the keys, because only one table lookup is\n  performed for all acl checks that make use of it.\n\n- &quot;lua&quot; is used to run a lua function if the action is executed. the single\n  parameter is the name of the function to run. the prototype of the\n  function is documented in the api documentation.\n\n- set-var(&lt;var-name&gt;) &lt;expr&gt; :\n  is used to set the contents of a variable. the variable is declared\n  inline.\n\n    &lt;var-name&gt; the name of the variable starts by an indication about its\n               scope. the allowed scopes are:\n                 &quot;sess&quot; : the variable is shared with all the session,\n                 &quot;txn&quot;  : the variable is shared with all the transaction\n                          (request and response)\n                 &quot;req&quot;  : the variable is shared only during the request\n                          processing\n                 &quot;res&quot;  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a &apos;.&apos;.\n               the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos;,\n               and &apos;_&apos;.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-request set-var(req.my_var) req.fhdr(user-agent),lower\n\n- set-src &lt;expr&gt; :\n  is used to set the source ip address to the value of specified\n  expression. useful when a proxy in front of haproxy rewrites source ip,\n  but provides the correct ip in a http header; or you want to mask\n  source ip for privacy.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-request set-src hdr(x-forwarded-for)\n     http-request set-src src,ipmask(24)\n\n  when set-src is successful, the source port is set to 0.\n</code></pre><p>  there is no limit to the number of http-request statements per instance.</p>\n<p>  it is important to know that http-request rules are processed very early in<br>  the http processing, just after “block” rules and before “reqdel” or “reqrep”<br>  rules. that way, headers added by “add-header”/“set-header” are visible by<br>  almost all further acl rules.</p>\n<p>  example:<br>        acl nagios src 192.168.129.3<br>        acl local_net src 192.168.0.0/16<br>        acl auth_ok http_auth(l1)</p>\n<pre><code>http-request allow if nagios\nhttp-request allow if local_net auth_ok\nhttp-request auth realm gimme if local_net auth_ok\nhttp-request deny\n</code></pre><p>  example:<br>        acl auth_ok http_auth_group(l1) g1<br>        http-request auth unless auth_ok</p>\n<p>  example:<br>        http-request set-header x-haproxy-current-date %t<br>        http-request set-header x-ssl                  %[ssl_fc]<br>        http-request set-header x-ssl-session_id       %[ssl_fc_session_id]<br>        http-request set-header x-ssl-client-verify    %[ssl_c_verify]<br>        http-request set-header x-ssl-client-dn        %{+q}[ssl_c_s_dn]<br>        http-request set-header x-ssl-client-cn        %{+q}[ssl_c_s_dn(cn)]<br>        http-request set-header x-ssl-issuer           %{+q}[ssl_c_i_dn]<br>        http-request set-header x-ssl-client-notbefore %{+q}[ssl_c_notbefore]<br>        http-request set-header x-ssl-client-notafter  %{+q}[ssl_c_notafter]</p>\n<p>  example:<br>        acl key req.hdr(x-add-acl-key) -m found<br>        acl add path /addacl<br>        acl del path /delacl</p>\n<pre><code>acl myhost hdr(host) -f myhost.lst\n\nhttp-request add-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key add\nhttp-request del-acl(myhost.lst) %[req.hdr(x-add-acl-key)] if key del\n</code></pre><p>  example:<br>        acl value  req.hdr(x-value) -m found<br>        acl setmap path /setmap<br>        acl delmap path /delmap</p>\n<pre><code>use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\nhttp-request set-map(map.lst) %[src] %[req.hdr(x-value)] if setmap value\nhttp-request del-map(map.lst) %[src]                     if delmap\n</code></pre><p>  see also : “stats http-request”, section 3.4 about userlists and section 7<br>             about acl usage.</p>\n<p>http-response { allow | deny | add-header <name> <fmt> | set-nice <nice> |<br>                capture <sample> id <id> | redirect <rule> |<br>                set-header <name> <fmt> | del-header <name> |<br>                replace-header <name> <regex-match> <replace-fmt> |<br>                replace-value <name> <regex-match> <replace-fmt> |<br>                set-log-level <level> | set-mark <mark> | set-tos <tos> |<br>                add-acl(<file name>) <key fmt> |<br>                del-acl(<file name>) <key fmt> |<br>                del-map(<file name>) <key fmt> |<br>                set-map(<file name>) <key fmt> <value fmt> |<br>                set-var(<var-name>) <expr> |<br>                lua <function name><br>              }<br>              [ { if | unless } <condition> ]<br>  access control for layer 7 responses</p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    yes   |   yes  |   yes</p>\n<p>  the http-response statement defines a set of rules which apply to layer 7<br>  processing. the rules are evaluated in their declaration order when they are<br>  met in a frontend, listen or backend section. any rule may optionally be<br>  followed by an acl-based condition, in which case it will only be evaluated<br>  if the condition is true. since these rules apply on responses, the backend<br>  rules are applied first, followed by the frontend’s rules.</p>\n<p>  the first keyword is the rule’s action. currently supported actions include :</p>\n<pre><code>- &quot;allow&quot; : this stops the evaluation of the rules and lets the response\n  pass the check. no further &quot;http-response&quot; rules are evaluated for the\n  current section.\n\n- &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects\n  the response and emits an http 502 error. no further &quot;http-response&quot;\n  rules are evaluated.\n\n- &quot;add-header&quot; appends an http header field whose name is specified in\n  &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format\n  rules (see custom log format in section 8.2.4). this may be used to send\n  a cookie to a client for example, or to pass some internal information.\n  this rule is not final, so it is possible to add other similar rules.\n  note that header addition is performed immediately, so one rule might\n  reuse the resulting header from a previous rule.\n\n- &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name\n  is first removed if it existed. this is useful when passing security\n  information to the server, where the header must not be manipulated by\n  external users.\n\n- &quot;del-header&quot; removes all http header fields whose name is specified in\n  &lt;name&gt;.\n\n- &quot;replace-header&quot; matches the regular expression in all occurrences of\n  header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with\n  the &lt;replace-fmt&gt; argument. format characters are allowed in replace-fmt\n  and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. the match is only\n  case-sensitive. it is important to understand that this action only\n  considers whole header lines, regardless of the number of values they\n  may contain. this usage is suited to headers naturally containing commas\n  in their value, such as set-cookie, expires and so on.\n\n  example:\n\n    http-response replace-header set-cookie (c=[^;]*);(.*) \\1;ip=%bi;\\2\n\n  applied to:\n\n    set-cookie: c=1; expires=tue, 14-jun-2016 01:40:45 gmt\n\n  outputs:\n\n    set-cookie: c=1;ip=192.168.1.20; expires=tue, 14-jun-2016 01:40:45 gmt\n\n  assuming the backend ip is 192.168.1.20.\n\n- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the\n  regex against every comma-delimited value of the header field &lt;name&gt;\n  instead of the entire header. this is suited for all headers which are\n  allowed to carry more than one value. an example could be the accept\n  header.\n\n  example:\n\n    http-response replace-value cache-control ^public$ private\n\n  applied to:\n\n    cache-control: max-age=3600, public\n\n  outputs:\n\n    cache-control: max-age=3600, private\n\n- &quot;set-nice&quot; sets the &quot;nice&quot; factor of the current request being processed.\n  it only has effect against the other requests being processed at the same\n  time. the default value is 0, unless altered by the &quot;nice&quot; setting on the\n  &quot;bind&quot; line. the accepted range is -1024..1024\\. the higher the value, the\n  nicest the request will be. lower values will make the request more\n  important than other ones. this can be useful to improve the speed of\n  some requests, or lower the priority of non-important requests. using\n  this setting without prior experimentation can cause some major slowdown.\n\n- &quot;set-log-level&quot; is used to change the log level of the current request\n  when a certain condition is met. valid levels are the 8 syslog levels\n  (see the &quot;log&quot; keyword) plus the special level &quot;silent&quot; which disables\n  logging for this request. this rule is not final so the last matching\n  rule wins. this rule can be useful to disable health checks coming from\n  another equipment.\n\n- &quot;set-tos&quot; is used to set the tos or dscp field value of packets sent to\n  the client to the value passed in &lt;tos&gt; on platforms which support this.\n  this value represents the whole 8 bits of the ip tos field, and can be\n  expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). note\n  that only the 6 higher bits are used in dscp or tos, and the two lower\n  bits are always 0\\. this can be used to adjust some routing behaviour on\n  border routers based on some information from the request. see rfc 2474,\n  2597, 3260 and 4594 for more information.\n\n- &quot;set-mark&quot; is used to set the netfilter mark on all packets sent to the\n  client to the value passed in &lt;mark&gt; on platforms which support it. this\n  value is an unsigned 32 bit value which can be matched by netfilter and\n  by the routing table. it can be expressed both in decimal or hexadecimal\n  format (prefixed by &quot;0x&quot;). this can be useful to force certain packets to\n  take a different route (for example a cheaper network path for bulk\n  downloads). this works on linux kernels 2.6.32 and above and requires\n  admin privileges.\n\n- &quot;add-acl&quot; is used to add a new entry into an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the new entry. it\n  performs a lookup in the acl before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;add acl&quot; command from the\n  stats socket, but can be triggered by an http response.\n\n- &quot;del-acl&quot; is used to delete an entry from an acl. the acl must be loaded\n  from a file (even a dummy empty file). the file name of the acl to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it is the equivalent of the &quot;del acl&quot; command from the stats socket, but\n  can be triggered by an http response.\n\n- &quot;del-map&quot; is used to delete an entry from a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes one argument: &lt;key fmt&gt;,\n  which follows log-format rules, to collect content of the entry to delete.\n  it takes one argument: &quot;file name&quot; it is the equivalent of the &quot;del map&quot;\n  command from the stats socket, but can be triggered by an http response.\n\n- &quot;set-map&quot; is used to add a new entry into a map. the map must be loaded\n  from a file (even a dummy empty file). the file name of the map to be\n  updated is passed between parentheses. it takes 2 arguments: &lt;key fmt&gt;,\n  which follows log-format rules, used to collect map key, and &lt;value fmt&gt;,\n  which follows log-format rules, used to collect content for the new entry.\n  it performs a lookup in the map before insertion, to avoid duplicated (or\n  more) values. this lookup is done by a linear search and can be expensive\n  with large lists! it is the equivalent of the &quot;set map&quot; command from the\n  stats socket, but can be triggered by an http response.\n\n- &quot;lua&quot; is used to run a lua function if the action is executed. the single\n  parameter is the name of the function to run. the prototype of the\n  function is documented in the api documentation.\n\n- capture &lt;sample&gt; id &lt;id&gt; :\n  captures sample expression &lt;sample&gt; from the response buffer, and converts\n  it to a string. the resulting string is stored into the next request\n  &quot;capture&quot; slot, so it will possibly appear next to some captured http\n  headers. it will then automatically appear in the logs, and it will be\n  possible to extract it using sample fetch rules to feed it into headers or\n  anything. please check section 7.3 (fetching samples) and &quot;capture\n  response header&quot; for more information.\n\n  the keyword &quot;id&quot; is the id of the capture slot which is used for storing\n  the string. the capture slot must be defined in an associated frontend.\n  this is useful to run captures in backends. the slot id can be declared by\n  a previous directive &quot;http-response capture&quot; or with the &quot;declare capture&quot;\n  keyword.\n\n- &quot;redirect&quot; : this performs an http redirection based on a redirect rule.\n  this supports a format string similarly to &quot;http-request redirect&quot; rules,\n  with the exception that only the &quot;location&quot; type of redirect is possible\n  on the response. see the &quot;redirect&quot; keyword for the rule&apos;s syntax. when\n  a redirect rule is applied during a response, connections to the server\n  are closed so that no data can be forwarded from the server to the client.\n\n- set-var(&lt;var-name&gt;) expr:\n  is used to set the contents of a variable. the variable is declared\n  inline.\n\n    &lt;var-name&gt; the name of the variable starts by an indication about its\n               scope. the allowed scopes are:\n                 &quot;sess&quot; : the variable is shared with all the session,\n                 &quot;txn&quot;  : the variable is shared with all the transaction\n                          (request and response)\n                 &quot;req&quot;  : the variable is shared only during the request\n                          processing\n                 &quot;res&quot;  : the variable is shared only during the response\n                          processing.\n               this prefix is followed by a name. the separator is a &apos;.&apos;.\n               the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos;,\n               and &apos;_&apos;.\n\n     &lt;expr&gt;    is a standard haproxy expression formed by a sample-fetch\n               followed by some converters.\n\n  example:\n\n     http-response set-var(sess.last_redir) res.hdr(location)\n</code></pre><p>  there is no limit to the number of http-response statements per instance.</p>\n<p>  it is important to know that http-response rules are processed very early in<br>  the http processing, before “reqdel” or “reqrep” rules. that way, headers<br>  added by “add-header”/“set-header” are visible by almost all further acl<br>  rules.</p>\n<p>  example:<br>         acl key_acl res.hdr(x-acl-key) -m found</p>\n<pre><code>acl myhost hdr(host) -f myhost.lst\n\nhttp-response add-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\nhttp-response del-acl(myhost.lst) %[res.hdr(x-acl-key)] if key_acl\n</code></pre><p>  example:<br>         acl value  res.hdr(x-value) -m found</p>\n<pre><code>use_backend bk_appli if { hdr(host),map_str(map.lst) -m found }\n\nhttp-response set-map(map.lst) %[src] %[res.hdr(x-value)] if value\nhttp-response del-map(map.lst) %[src]                     if ! value\n</code></pre><p>  see also : “http-request”, section 3.4 about userlists and section 7 about<br>             acl usage.</p>\n<p>http-send-name-header [<header>]<br>  add the server name to a request. use the header string given by <header></p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                               yes    |    no    |   yes  |   yes</p>\n<p>  arguments :</p>\n<pre><code>&lt;header&gt;  the header string to use to send the server name\n</code></pre><p>  the “http-send-name-header” statement causes the name of the target<br>  server to be added to the headers of an http request.  the name<br>  is added with the header string proved.</p>\n<p>  see also : “server”</p>\n<p>id <value><br>  set a persistent id to a proxy.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  set a persistent id for the proxy. this id must be unique and positive.<br>  an unused id will automatically be assigned if unset. the first assigned<br>  value will be 1. this id is currently only returned in statistics.</p>\n<p>ignore-persist { if | unless } <condition><br>  declare a condition to ignore persistence<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   yes</p>\n<p>  by default, when cookie persistence is enabled, every requests containing<br>  the cookie are unconditionally persistent (assuming the target server is up<br>  and running).</p>\n<p>  the “ignore-persist” statement allows one to declare various acl-based<br>  conditions which, when met, will cause a request to ignore persistence.<br>  this is sometimes useful to load balance requests for static files, which<br>  often don’t require persistence. this can also be used to fully disable<br>  persistence for a specific user-agent (for example, some web crawler bots).</p>\n<p>  combined with “appsession”, it can also help reduce haproxy memory usage, as<br>  the appsession table won’t grow if persistence is ignored.</p>\n<p>  the persistence is ignored when an “if” condition is met, or unless an<br>  “unless” condition is met.</p>\n<p>  see also : “force-persist”, “cookie”, and section 7 about acl usage.</p>\n<p>log global<br>log <address> [len <length>] <facility> [<level> [<minlevel>]]<br>no log<br>  enable per-instance logging of events and traffic.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  prefix :<br>    no         should be used when the logger list must be flushed. for example,<br>               if you don’t want to inherit from the default logger list. this<br>               prefix does not allow arguments.</p>\n<p>  arguments :<br>    global     should be used when the instance’s logging parameters are the<br>               same as the global ones. this is the most common usage. “global”<br>               replaces <address>, <facility> and <level> with those of the log<br>               entries found in the “global” section. only one “log global”<br>               statement may be used per instance, and this form takes no other<br>               parameter.</p>\n<pre><code>&lt;address&gt;  indicates where to send the logs. it takes the same format as\n           for the &quot;global&quot; section&apos;s logs, and can be one of :\n\n           - an ipv4 address optionally followed by a colon (&apos;:&apos;) and a udp\n             port. if no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - an ipv6 address followed by a colon (&apos;:&apos;) and optionally a udp\n             port. if no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - a filesystem path to a unix domain socket, keeping in mind\n             considerations for chroot (be sure the path is accessible\n             inside the chroot) and uid/gid (be sure the path is\n             appropriately writeable).\n\n          you may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment variables.\n\n&lt;length&gt;   is an optional maximum line length. log lines larger than this\n           value will be truncated before being sent. the reason is that\n           syslog servers act differently on log line length. all servers\n           support the default value of 1024, but some servers simply drop\n           larger lines while others do log them. if a server supports long\n           lines, it may make sense to set this value here in order to avoid\n           truncating long lines. similarly, if a server drops long lines,\n           it is preferable to truncate them before sending them. accepted\n           values are 80 to 65535 inclusive. the default value of 1024 is\n           generally fine for all standard usages. some specific cases of\n           long captures or json-formated logs may require larger values.\n\n&lt;facility&gt; must be one of the 24 standard syslog facilities :\n\n             kern   user   mail   daemon auth   syslog lpr    news\n             uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n             local0 local1 local2 local3 local4 local5 local6 local7\n\n&lt;level&gt;    is optional and can be specified to filter outgoing messages. by\n           default, all messages are sent. if a level is specified, only\n           messages with a severity at least as important as this level\n           will be sent. an optional minimum level can be specified. if it\n           is set, logs emitted with a more severe level than this one will\n           be capped to this level. this is used to avoid sending &quot;emerg&quot;\n           messages on all terminals on some default syslog configurations.\n           eight levels are known :\n\n             emerg  alert  crit   err    warning notice info  debug\n</code></pre><p>  it is important to keep in mind that it is the frontend which decides what to<br>  log from a connection, and that in case of content switching, the log entries<br>  from the backend will be ignored. connections are logged at level “info”.</p>\n<p>  however, backend log declaration define how and where servers status changes<br>  will be logged. level “notice” will be used to indicate a server going up,<br>  “warning” will be used for termination signals and definitive service<br>  termination, and “alert” will be used for when a server goes down.</p>\n<p>  note : according to rfc3164, messages are truncated to 1024 bytes before<br>         being emitted.</p>\n<p>  example :<br>    log global<br>    log 127.0.0.1:514 local0 notice         # only send important events<br>    log 127.0.0.1:514 local0 notice notice  # same but limit output level<br>    log “${local_syslog}:514” local0 notice   # send to local server</p>\n<p>log-format <string><br>  specifies the log format string to use for traffic logs<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |    no</p>\n<p>  this directive specifies the log format string that will be used for all logs<br>  resulting from traffic passing through the frontend using this line. if the<br>  directive is used in a defaults section, all subsequent frontends will use<br>  the same log format. please see section 8.2.4 which covers the log format<br>  string in depth.</p>\n<p>log-tag <string><br>  specifies the log tag to use for all outgoing logs<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<p>  sets the tag field in the syslog header to this string. it defaults to the<br>  log-tag set in the global section, otherwise the program name as launched<br>  from the command line, which usually is “haproxy”. sometimes it can be useful<br>  to differentiate between multiple processes running on the same host, or to<br>  differentiate customer instances running in the same process. in the backend,<br>  logs about servers up/down will use this tag. as a hint, it can be convenient<br>  to set a log-tag related to a hosted customer in a defaults section then put<br>  all the frontends and backends for that customer, then start another customer<br>  in a new defaults section. see also the global “log-tag” directive.</p>\n<p>max-keep-alive-queue <value><br>  set the maximum server queue size for maintaining keep-alive connections<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes</p>\n<p>  http keep-alive tries to reuse the same server connection whenever possible,<br>  but sometimes it can be counter-productive, for example if a server has a lot<br>  of connections while other ones are idle. this is especially true for static<br>  servers.</p>\n<p>  the purpose of this setting is to set a threshold on the number of queued<br>  connections at which haproxy stops trying to reuse the same server and prefers<br>  to find another one. the default value, -1, means there is no limit. a value<br>  of zero means that keep-alive requests will never be queued. for very close<br>  servers which can be reached with a low latency and which are not sensible to<br>  breaking keep-alive, a low value is recommended (eg: local static server can<br>  use a value of 10 or less). for remote servers suffering from a high latency,<br>  higher values might be needed to cover for the latency and/or the cost of<br>  picking a different server.</p>\n<p>  note that this has no impact on responses which are maintained to the same<br>  server consecutively to a 401 response. they will still go to the same server<br>  even if they have to be queued.</p>\n<p>  see also : “option http-server-close”, “option prefer-last-server”, server<br>             “maxconn” and cookie persistence.</p>\n<p>maxconn <conns><br>  fix the maximum number of concurrent connections on a frontend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <conns>   is the maximum number of concurrent connections the frontend will<br>              accept to serve. excess connections will be queued by the system<br>              in the socket’s listen queue and will be served once a connection<br>              closes.</p>\n<p>  if the system supports it, it can be useful on big sites to raise this limit<br>  very high so that haproxy manages connection queues, instead of leaving the<br>  clients with unanswered connection attempts. this value should not exceed the<br>  global maxconn. also, keep in mind that a connection contains two buffers<br>  of 8kb each, as well as some other data resulting in about 17 kb of ram being<br>  consumed per established connection. that means that a medium system equipped<br>  with 1gb of ram can withstand around 40000-50000 concurrent connections if<br>  properly tuned.</p>\n<p>  also, when <conns> is set to large values, it is possible that the servers<br>  are not sized to accept such loads, and for this reason it is generally wise<br>  to assign them some reasonable connection limits.</p>\n<p>  by default, this value is set to 2000.</p>\n<p>  see also : “server”, global section’s “maxconn”, “fullconn”</p>\n<p>mode { tcp|http|health }<br>  set the running mode or protocol of the instance<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    tcp       the instance will work in pure tcp mode. a full-duplex connection<br>              will be established between clients and servers, and no layer 7<br>              examination will be performed. this is the default mode. it<br>              should be used for ssl, ssh, smtp, …</p>\n<pre><code>http      the instance will work in http mode. the client request will be\n          analyzed in depth before connecting to any server. any request\n          which is not rfc-compliant will be rejected. layer 7 filtering,\n          processing and switching will be possible. this is the mode which\n          brings haproxy most of its value.\n\nhealth    the instance will work in &quot;health&quot; mode. it will just reply &quot;ok&quot;\n          to incoming connections and close the connection. alternatively,\n          if the &quot;httpchk&quot; option is set, &quot;http/1.0 200 ok&quot; will be sent\n          instead. nothing will be logged in either case. this mode is used\n          to reply to external components health checks. this mode is\n          deprecated and should not be used anymore as it is possible to do\n          the same and even better by combining tcp or http modes with the\n          &quot;monitor&quot; keyword.\n</code></pre><p>  when doing content switching, it is mandatory that the frontend and the<br>  backend are in the same mode (generally http), otherwise the configuration<br>  will be refused.</p>\n<p>  example :<br>     defaults http_instances<br>         mode http</p>\n<p>  see also : “monitor”, “monitor-net”</p>\n<p>monitor fail { if | unless } <condition><br>  add a condition to report a failure to a monitor http request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments :<br>    if <cond>     the monitor request will fail if the condition is satisfied,<br>                  and will succeed otherwise. the condition should describe a<br>                  combined test which must induce a failure if all conditions<br>                  are met, for instance a low number of servers both in a<br>                  backend and its backup.</p>\n<pre><code>unless &lt;cond&gt; the monitor request will succeed only if the condition is\n              satisfied, and will fail otherwise. such a condition may be\n              based on a test on the presence of a minimum number of active\n              servers in a list of backends.\n</code></pre><p>  this statement adds a condition which can force the response to a monitor<br>  request to report a failure. by default, when an external component queries<br>  the uri dedicated to monitoring, a 200 response is returned. when one of the<br>  conditions above is met, haproxy will return 503 instead of 200. this is<br>  very useful to report a site failure to an external component which may base<br>  routing advertisements between multiple sites on the availability reported by<br>  haproxy. in this case, one would rely on an acl involving the “nbsrv”<br>  criterion. note that “monitor fail” only works in http mode. both status<br>  messages may be tweaked using “errorfile” or “errorloc” if needed.</p>\n<p>  example:<br>     frontend www<br>        mode http<br>        acl site_dead nbsrv(dynamic) lt 2<br>        acl site_dead nbsrv(static)  lt 2<br>        monitor-uri   /site_alive<br>        monitor fail  if site_dead</p>\n<p>  see also : “monitor-net”, “monitor-uri”, “errorfile”, “errorloc”</p>\n<p>monitor-net <source><br>  declare a source network which is limited to monitor requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <source>  is the source ipv4 address or network which will only be able to<br>              get monitor responses to any request. it can be either an ipv4<br>              address, a host name, or an address followed by a slash (‘/‘)<br>              followed by a mask.</p>\n<p>  in tcp mode, any connection coming from a source matching <source> will cause<br>  the connection to be immediately closed without any log. this allows another<br>  equipment to probe the port and verify that it is still listening, without<br>  forwarding the connection to a remote server.</p>\n<p>  in http mode, a connection coming from a source matching <source> will be<br>  accepted, the following response will be sent without waiting for a request,<br>  then the connection will be closed : “http/1.0 200 ok”. this is normally<br>  enough for any front-end http probe to detect that the service is up and<br>  running without forwarding the request to a backend server. note that this<br>  response is sent in raw format, without any transformation. this is important<br>  as it means that it will not be ssl-encrypted on ssl listeners.</p>\n<p>  monitor requests are processed very early, just after tcp-request connection<br>  acls which are the only ones able to block them. these connections are short<br>  lived and never wait for any data from the client. they cannot be logged, and<br>  it is the intended purpose. they are only used to report haproxy’s health to<br>  an upper component, nothing more. please note that “monitor fail” rules do<br>  not apply to connections intercepted by “monitor-net”.</p>\n<p>  last, please note that only one “monitor-net” statement can be specified in<br>  a frontend. if more than one is found, only the last one will be considered.</p>\n<p>  example :</p>\n<pre><code># addresses .252 and .253 are just probing us.\nfrontend www\n    monitor-net 192.168.0.252/31\n</code></pre><p>  see also : “monitor fail”, “monitor-uri”</p>\n<p>monitor-uri <uri><br>  intercept a uri used by external components’ monitor requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <uri>     is the exact uri which we want to intercept to return haproxy’s<br>              health status instead of forwarding the request.</p>\n<p>  when an http request referencing <uri> will be received on a frontend,<br>  haproxy will not forward it nor log it, but instead will return either<br>  “http/1.0 200 ok” or “http/1.0 503 service unavailable”, depending on failure<br>  conditions defined with “monitor fail”. this is normally enough for any<br>  front-end http probe to detect that the service is up and running without<br>  forwarding the request to a backend server. note that the http method, the<br>  version and all headers are ignored, but the request must at least be valid<br>  at the http level. this keyword may only be used with an http-mode frontend.</p>\n<p>  monitor requests are processed very early. it is not possible to block nor<br>  divert them using acls. they cannot be logged either, and it is the intended<br>  purpose. they are only used to report haproxy’s health to an upper component,<br>  nothing more. however, it is possible to add any number of conditions using<br>  “monitor fail” and acls so that the result can be adjusted to whatever check<br>  can be imagined (most often the number of available servers in a backend).</p>\n<p>  example :</p>\n<pre><code># use /haproxy_test to report haproxy&apos;s status\nfrontend www\n    mode http\n    monitor-uri /haproxy_test\n</code></pre><p>  see also : “monitor fail”, “monitor-net”</p>\n<p>option abortonclose<br>no option abortonclose<br>  enable or disable early dropping of aborted requests pending in queues.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  in presence of very high loads, the servers will take some time to respond.<br>  the per-instance connection queue will inflate, and the response time will<br>  increase respective to the size of the queue times the average per-session<br>  response time. when clients will wait for more than a few seconds, they will<br>  often hit the “stop” button on their browser, leaving a useless request in<br>  the queue, and slowing down other users, and the servers as well, because the<br>  request will eventually be served, then aborted at the first error<br>  encountered while delivering the response.</p>\n<p>  as there is no way to distinguish between a full stop and a simple output<br>  close on the client side, http agents should be conservative and consider<br>  that the client might only have closed its output channel while waiting for<br>  the response. however, this introduces risks of congestion when lots of users<br>  do the same, and is completely useless nowadays because probably no client at<br>  all will close the session while waiting for the response. some http agents<br>  support this behaviour (squid, apache, haproxy), and others do not (tux, most<br>  hardware-based load balancers). so the probability for a closed input channel<br>  to represent a user hitting the “stop” button is close to 100%, and the risk<br>  of being the single component to break rare but valid traffic is extremely<br>  low, which adds to the temptation to be able to abort a session early while<br>  still not served and not pollute the servers.</p>\n<p>  in haproxy, the user can choose the desired behaviour using the option<br>  “abortonclose”. by default (without the option) the behaviour is http<br>  compliant and aborted requests will be served. but when the option is<br>  specified, a session with an incoming channel closed will be aborted while<br>  it is still possible, either pending in the queue for a connection slot, or<br>  during the connection establishment if the server has not yet acknowledged<br>  the connection request. this considerably reduces the queue size and the load<br>  on saturated servers when users are tempted to click on stop, which in turn<br>  reduces the response time for other users.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “timeout queue” and server’s “maxconn” and “maxqueue” parameters</p>\n<p>option accept-invalid-http-request<br>no option accept-invalid-http-request<br>  enable or disable relaxing of http request parsing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, haproxy complies with rfc7230 in terms of message parsing. this<br>  means that invalid characters in header names are not permitted and cause an<br>  error to be returned to the client. this is the desired behaviour as such<br>  forbidden characters are essentially used to build attacks exploiting server<br>  weaknesses, and bypass security filtering. sometimes, a buggy browser or<br>  server will emit invalid header names for whatever reason (configuration,<br>  implementation) and the issue will not be immediately fixed. in such a case,<br>  it is possible to relax haproxy’s header name parser to accept any character<br>  even if that does not make sense, by specifying this option. similarly, the<br>  list of characters allowed to appear in a uri is well defined by rfc3986, and<br>  chars 0-31, 32 (space), 34 (‘“‘), 60 (‘&lt;’), 62 (‘&gt;’), 92 (‘\\’), 94 (‘^’), 96<br>  (‘`’), 123 (‘{‘), 124 (‘|’), 125 (‘}’), 127 (delete) and anything above are<br>  not allowed at all. haproxy always blocks a number of them (0..32, 127). the<br>  remaining ones are blocked by default unless this option is enabled. this<br>  option also relaxes the test on the http version, it allows http/0.9 requests<br>  to pass through (no version specified) and multiple digits for both the major<br>  and the minor version.</p>\n<p>  this option should never be enabled by default as it hides application bugs<br>  and open security breaches. it should only be deployed after a problem has<br>  been confirmed.</p>\n<p>  when this option is enabled, erroneous header names will still be accepted in<br>  requests, but the complete request will be captured in order to permit later<br>  analysis using the “show errors” request on the unix stats socket. similarly,<br>  requests containing invalid chars in the uri part will be logged. doing this<br>  also helps confirming that the issue has been solved.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option accept-invalid-http-response” and “show errors” on the<br>             stats socket.</p>\n<p>option accept-invalid-http-response<br>no option accept-invalid-http-response<br>  enable or disable relaxing of http response parsing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, haproxy complies with rfc7230 in terms of message parsing. this<br>  means that invalid characters in header names are not permitted and cause an<br>  error to be returned to the client. this is the desired behaviour as such<br>  forbidden characters are essentially used to build attacks exploiting server<br>  weaknesses, and bypass security filtering. sometimes, a buggy browser or<br>  server will emit invalid header names for whatever reason (configuration,<br>  implementation) and the issue will not be immediately fixed. in such a case,<br>  it is possible to relax haproxy’s header name parser to accept any character<br>  even if that does not make sense, by specifying this option. this option also<br>  relaxes the test on the http version format, it allows multiple digits for<br>  both the major and the minor version.</p>\n<p>  this option should never be enabled by default as it hides application bugs<br>  and open security breaches. it should only be deployed after a problem has<br>  been confirmed.</p>\n<p>  when this option is enabled, erroneous header names will still be accepted in<br>  responses, but the complete response will be captured in order to permit<br>  later analysis using the “show errors” request on the unix stats socket.<br>  doing this also helps confirming that the issue has been solved.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option accept-invalid-http-request” and “show errors” on the<br>             stats socket.</p>\n<p>option allbackups<br>no option allbackups<br>  use either all backup servers at a time or only the first one<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the first operational backup server gets all traffic when normal<br>  servers are all down. sometimes, it may be preferred to use multiple backups<br>  at once, because one will not be enough. when “option allbackups” is enabled,<br>  the load balancing will be performed among all backup servers when all normal<br>  ones are unavailable. the same load balancing algorithm will be used and the<br>  servers’ weights will be respected. thus, there will not be any priority<br>  order between the backup servers anymore.</p>\n<p>  this option is mostly used with static server farms dedicated to return a<br>  “sorry” page when an application is completely offline.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option checkcache<br>no option checkcache<br>  analyze all server responses and block responses with cacheable cookies<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |     no   |   yes  |   yes<br>  arguments : none</p>\n<p>  some high-level frameworks set application cookies everywhere and do not<br>  always let enough control to the developer to manage how the responses should<br>  be cached. when a session cookie is returned on a cacheable object, there is a<br>  high risk of session crossing or stealing between users traversing the same<br>  caches. in some situations, it is better to block the response than to let<br>  some sensitive session information go in the wild.</p>\n<p>  the option “checkcache” enables deep inspection of all server responses for<br>  strict compliance with http specification in terms of cacheability. it<br>  carefully checks “cache-control”, “pragma” and “set-cookie” headers in server<br>  response to check if there’s a risk of caching a cookie on a client-side<br>  proxy. when this option is enabled, the only responses which can be delivered<br>  to the client are :</p>\n<pre><code>- all those without &quot;set-cookie&quot; header ;\n- all those with a return code other than 200, 203, 206, 300, 301, 410,\n  provided that the server has not set a &quot;cache-control: public&quot; header ;\n- all those that come from a post request, provided that the server has not\n  set a &apos;cache-control: public&apos; header ;\n- those with a &apos;pragma: no-cache&apos; header\n- those with a &apos;cache-control: private&apos; header\n- those with a &apos;cache-control: no-store&apos; header\n- those with a &apos;cache-control: max-age=0&apos; header\n- those with a &apos;cache-control: s-maxage=0&apos; header\n- those with a &apos;cache-control: no-cache&apos; header\n- those with a &apos;cache-control: no-cache=&quot;set-cookie&quot;&apos; header\n- those with a &apos;cache-control: no-cache=&quot;set-cookie,&apos; header\n  (allowing other fields after set-cookie)\n</code></pre><p>  if a response doesn’t respect these requirements, then it will be blocked<br>  just as if it was from an “rspdeny” filter, with an “http 502 bad gateway”.<br>  the session state shows “ph–” meaning that the proxy blocked the response<br>  during headers processing. additionally, an alert will be sent in the logs so<br>  that admins are informed that there’s something to be fixed.</p>\n<p>  due to the high impact on the application, the application should be tested<br>  in depth with the option enabled before going to production. it is also a<br>  good practice to always activate it during tests, even if it is not used in<br>  production, as it will report potentially dangerous application behaviours.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option clitcpka<br>no option clitcpka<br>  enable or disable the sending of tcp keepalive packets on the client side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “clitcpka” enables the emission of tcp keep-alive probes on the<br>  client side of a connection, which should help when session expirations are<br>  noticed between haproxy and a client.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option srvtcpka”, “option tcpka”</p>\n<p>option contstats<br>  enable continuous traffic statistics updates<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, counters used for statistics calculation are incremented<br>  only when a session finishes. it works quite well when serving small<br>  objects, but with big ones (for example large images or archives) or<br>  with a/v streaming, a graph generated from haproxy counters looks like<br>  a hedgehog. with this option enabled counters get incremented continuously,<br>  during a whole session. recounting touches a hotpath directly so<br>  it is not enabled by default, as it has small performance impact (~0.5%).</p>\n<p>option dontlog-normal<br>no option dontlog-normal<br>  enable or disable logging of normal, successful connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  there are large sites dealing with several thousand connections per second<br>  and for which logging is a major pain. some of them are even forced to turn<br>  logs off and cannot debug production issues. setting this option ensures that<br>  normal connections, those which experience no error, no timeout, no retry nor<br>  redispatch, will not be logged. this leaves disk space for anomalies. in http<br>  mode, the response status code is checked and return codes 5xx will still be<br>  logged.</p>\n<p>  it is strongly discouraged to use this option as most of the time, the key to<br>  complex issues is in the normal logs which will not be logged here. if you<br>  need to separate logs, see the “log-separate-errors” option instead.</p>\n<p>  see also : “log”, “dontlognull”, “log-separate-errors” and section 8 about<br>             logging.</p>\n<p>option dontlognull<br>no option dontlognull<br>  enable or disable logging of null connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  in certain environments, there are components which will regularly connect to<br>  various systems to ensure that they are still alive. it can be the case from<br>  another load balancer as well as from monitoring systems. by default, even a<br>  simple port probe or scan will produce a log. if those connections pollute<br>  the logs too much, it is possible to enable option “dontlognull” to indicate<br>  that a connection on which no data has been transferred will not be logged,<br>  which typically corresponds to those probes. note that errors will still be<br>  returned to the client and accounted for in the stats. if this is not what is<br>  desired, option http-ignore-probes can be used instead.</p>\n<p>  it is generally recommended not to use this option in uncontrolled<br>  environments (eg: internet), otherwise scans and other malicious activities<br>  would not be logged.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “log”, “http-ignore-probes”, “monitor-net”, “monitor-uri”, and<br>             section 8 about logging.</p>\n<p>option forceclose<br>no option forceclose<br>  enable or disable active connection closing after response is transferred.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  some http servers do not necessarily close the connections when they receive<br>  the “connection: close” set by “option httpclose”, and if the client does not<br>  close either, then the connection remains open till the timeout expires. this<br>  causes high number of simultaneous connections on the servers and shows high<br>  global session times in the logs.</p>\n<p>  when this happens, it is possible to use “option forceclose”. it will<br>  actively close the outgoing server channel as soon as the server has finished<br>  to respond and release some resources earlier than with “option httpclose”.</p>\n<p>  this option may also be combined with “option http-pretend-keepalive”, which<br>  will disable sending of the “connection: close” header, but will still cause<br>  the connection to be closed once the whole response is received.</p>\n<p>  this option disables and replaces any previous “option httpclose”, “option<br>  http-server-close”, “option http-keep-alive”, or “option http-tunnel”.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option httpclose” and “option http-pretend-keepalive”</p>\n<p>option forwardfor [ except <network> ] [ header <name> ] [ if-none ]<br>  enable insertion of the x-forwarded-for header to requests sent to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <network> is an optional argument used to disable this option for sources<br>              matching <network><br>    <name>    an optional argument to specify a different “x-forwarded-for”<br>              header name.</p>\n<p>  since haproxy works in reverse-proxy mode, the servers see its ip address as<br>  their client address. this is sometimes annoying when the client’s ip address<br>  is expected in server logs. to solve this problem, the well-known http header<br>  “x-forwarded-for” may be added by haproxy to all requests sent to the server.<br>  this header contains a value representing the client’s ip address. since this<br>  header is always appended at the end of the existing header list, the server<br>  must be configured to always use the last occurrence of this header only. see<br>  the server’s manual to find how to enable use of this standard header. note<br>  that only the last occurrence of the header must be used, since it is really<br>  possible that the client has already brought one.</p>\n<p>  the keyword “header” may be used to supply a different header name to replace<br>  the default “x-forwarded-for”. this can be useful where you might already<br>  have a “x-forwarded-for” header from a different application (eg: stunnel),<br>  and you need preserve it. also if your backend server doesn’t use the<br>  “x-forwarded-for” header and requires different one (eg: zeus web servers<br>  require “x-cluster-client-ip”).</p>\n<p>  sometimes, a same haproxy instance may be shared between a direct client<br>  access and a reverse-proxy access (for instance when an ssl reverse-proxy is<br>  used to decrypt https traffic). it is possible to disable the addition of the<br>  header for a known source address or network by adding the “except” keyword<br>  followed by the network address. in this case, any source ip matching the<br>  network will not cause an addition of this header. most common uses are with<br>  private networks or 127.0.0.1.</p>\n<p>  alternatively, the keyword “if-none” states that the header will only be<br>  added if it is not present. this should only be used in perfectly trusted<br>  environment, as this might cause a security issue if headers reaching haproxy<br>  are under the control of the end-user.</p>\n<p>  this option may be specified either in the frontend or in the backend. if at<br>  least one of them uses it, the header will be added. note that the backend’s<br>  setting of the header subargument takes precedence over the frontend’s if<br>  both are defined. in the case of the “if-none” argument, if at least one of<br>  the frontend or the backend does not specify it, it wants the addition to be<br>  mandatory, so it wins.</p>\n<p>  examples :</p>\n<pre><code># public http address also used by stunnel on the same machine\nfrontend www\n    mode http\n    option forwardfor except 127.0.0.1  # stunnel already adds the header\n\n# those servers want the ip address in x-client\nbackend www\n    mode http\n    option forwardfor header x-client\n</code></pre><p>  see also : “option httpclose”, “option http-server-close”,<br>             “option forceclose”, “option http-keep-alive”</p>\n<p>option http-buffer-request<br>no option http-buffer-request<br>  enable or disable waiting for whole http request body before proceeding<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  it is sometimes desirable to wait for the body of an http request before<br>  taking a decision. this is what is being done by “balance url_param” for<br>  example. the first use case is to buffer requests from slow clients before<br>  connecting to the server. another use case consists in taking the routing<br>  decision based on the request body’s contents. this option placed in a<br>  frontend or backend forces the http processing to wait until either the whole<br>  body is received, or the request buffer is full, or the first chunk is<br>  complete in case of chunked encoding. it can have undesired side effects with<br>  some applications abusing http by expecting unbufferred transmissions between<br>  the frontend and the backend, so this should definitely not be used by<br>  default.</p>\n<p>  see also : “option http-no-delay”</p>\n<p>option http-ignore-probes<br>no option http-ignore-probes<br>  enable or disable logging of null connections and request timeouts<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  recently some browsers started to implement a “pre-connect” feature<br>  consisting in speculatively connecting to some recently visited web sites<br>  just in case the user would like to visit them. this results in many<br>  connections being established to web sites, which end up in 408 request<br>  timeout if the timeout strikes first, or 400 bad request when the browser<br>  decides to close them first. these ones pollute the log and feed the error<br>  counters. there was already “option dontlognull” but it’s insufficient in<br>  this case. instead, this option does the following things :</p>\n<pre><code>- prevent any 400/408 message from being sent to the client if nothing\n  was received over a connection before it was closed ;\n- prevent any log from being emitted in this situation ;\n- prevent any error counter from being incremented\n</code></pre><p>  that way the empty connection is silently ignored. note that it is better<br>  not to use this unless it is clear that it is needed, because it will hide<br>  real problems. the most common reason for not receiving a request and seeing<br>  a 408 is due to an mtu inconsistency between the client and an intermediary<br>  element such as a vpn, which blocks too large packets. these issues are<br>  generally seen with post requests as well as get with large cookies. the logs<br>  are often the only way to detect them.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “log”, “dontlognull”, “errorfile”, and section 8 about logging.</p>\n<p>option http-keep-alive<br>no option http-keep-alive<br>  enable or disable http keep-alive from client to server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and the<br>  start of a new request. this mode may be changed by several options such as<br>  “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”. this option allows to set back the keep-alive mode,<br>  which can be useful when another mode was used in a defaults section.</p>\n<p>  setting “option http-keep-alive” enables http keep-alive mode on the client-<br>  and server- sides. this provides the lowest latency on the client side (slow<br>  network) and the fastest session reuse on the server side at the expense<br>  of maintaining idle connections to the servers. in general, it is possible<br>  with this option to achieve approximately twice the request rate that the<br>  “http-server-close” option achieves on small objects. there are mainly two<br>  situations where this option may be useful :</p>\n<pre><code>- when the server is non-http compliant and authenticates the connection\n  instead of requests (eg: ntlm authentication)\n\n- when the cost of establishing the connection to the server is significant\n  compared to the cost of retrieving the associated object from the server.\n</code></pre><p>  this last case can happen when the server is a fast static server of cache.<br>  in this case, the server will need to be properly tuned to support high enough<br>  connection counts because connections will last until the client sends another<br>  request.</p>\n<p>  if the client request has to go to another backend or another server due to<br>  content switching or the load balancing algorithm, the idle connection will<br>  immediately be closed and a new one re-opened. option “prefer-last-server” is<br>  available to try optimize server selection so that if the server currently<br>  attached to an idle connection is usable, it will be used.</p>\n<p>  in general it is preferred to use “option http-server-close” with application<br>  servers, and some static servers might benefit from “option http-keep-alive”.</p>\n<p>  at the moment, logs will not indicate whether requests came from the same<br>  session or not. the accept date reported in the logs corresponds to the end<br>  of the previous request, and the request time corresponds to the time spent<br>  waiting for a new request. the keep-alive request time is still bound to the<br>  timeout defined by “timeout http-keep-alive” or “timeout http-request” if<br>  not set.</p>\n<p>  this option disables and replaces any previous “option httpclose”, “option<br>  http-server-close”, “option forceclose” or “option http-tunnel”. when backend<br>  and frontend options differ, all of these 4 options have precedence over<br>  “option http-keep-alive”.</p>\n<p>  see also : “option forceclose”, “option http-server-close”,<br>             “option prefer-last-server”, “option http-pretend-keepalive”,<br>             “option httpclose”, and “1.1. the http transaction model”.</p>\n<p>option http-no-delay<br>no option http-no-delay<br>  instruct the system to favor low interactive delays over performance in http<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  in http, each payload is unidirectional and has no notion of interactivity.<br>  any agent is expected to queue data somewhat for a reasonably low delay.<br>  there are some very rare server-to-server applications that abuse the http<br>  protocol and expect the payload phase to be highly interactive, with many<br>  interleaved data chunks in both directions within a single request. this is<br>  absolutely not supported by the http specification and will not work across<br>  most proxies or servers. when such applications attempt to do this through<br>  haproxy, it works but they will experience high delays due to the network<br>  optimizations which favor performance by instructing the system to wait for<br>  enough data to be available in order to only send full packets. typical<br>  delays are around 200 ms per round trip. note that this only happens with<br>  abnormal uses. normal uses such as connect requests nor websockets are not<br>  affected.</p>\n<p>  when “option http-no-delay” is present in either the frontend or the backend<br>  used by a connection, all such optimizations will be disabled in order to<br>  make the exchanges as fast as possible. of course this offers no guarantee on<br>  the functionality, as it may break at any other place. but if it works via<br>  haproxy, it will work as fast as possible. this option should never be used<br>  by default, and should never be used at all unless such a buggy application<br>  is discovered. the impact of using this option is an increase of bandwidth<br>  usage and cpu usage, which may significantly lower performance in high<br>  latency environments.</p>\n<p>  see also : “option http-buffer-request”</p>\n<p>option http-pretend-keepalive<br>no option http-pretend-keepalive<br>  define whether haproxy will announce keepalive to the server or not<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when running with “option http-server-close” or “option forceclose”, haproxy<br>  adds a “connection: close” header to the request forwarded to the server.<br>  unfortunately, when some servers see this header, they automatically refrain<br>  from using the chunked encoding for responses of unknown length, while this<br>  is totally unrelated. the immediate effect is that this prevents haproxy from<br>  maintaining the client connection alive. a second effect is that a client or<br>  a cache could receive an incomplete response without being aware of it, and<br>  consider the response complete.</p>\n<p>  by setting “option http-pretend-keepalive”, haproxy will make the server<br>  believe it will keep the connection alive. the server will then not fall back<br>  to the abnormal undesired above. when haproxy gets the whole response, it<br>  will close the connection with the server just as it would do with the<br>  “forceclose” option. that way the client gets a normal response and the<br>  connection is correctly closed on the server side.</p>\n<p>  it is recommended not to enable this option by default, because most servers<br>  will more efficiently close the connection themselves after the last packet,<br>  and release its buffers slightly earlier. also, the added packet on the<br>  network could slightly reduce the overall peak performance. however it is<br>  worth noting that when this option is enabled, haproxy will have slightly<br>  less work to do. so if haproxy is the bottleneck on the whole architecture,<br>  enabling this option might save a few cpu cycles.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  this option may be combined with “option httpclose”, which will cause<br>  keepalive to be announced to the server and close to be announced to the<br>  client. this practice is discouraged though.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close”, and<br>             “option http-keep-alive”</p>\n<p>option http-server-close<br>no option http-server-close<br>  enable or disable http connection closing on the server side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”. setting “option http-server-close” enables http<br>  connection-close mode on the server side while keeping the ability to support<br>  http keep-alive and pipelining on the client side.  this provides the lowest<br>  latency on the client side (slow network) and the fastest session reuse on<br>  the server side to save server resources, similarly to “option forceclose”.<br>  it also permits non-keepalive capable servers to be served in keep-alive mode<br>  to the clients if they conform to the requirements of rfc2616. please note<br>  that some servers do not always conform to those requirements when they see<br>  “connection: close” in the request. the effect will be that keep-alive will<br>  never be used. a workaround consists in enabling “option<br>  http-pretend-keepalive”.</p>\n<p>  at the moment, logs will not indicate whether requests came from the same<br>  session or not. the accept date reported in the logs corresponds to the end<br>  of the previous request, and the request time corresponds to the time spent<br>  waiting for a new request. the keep-alive request time is still bound to the<br>  timeout defined by “timeout http-keep-alive” or “timeout http-request” if<br>  not set.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  it disables and replaces any previous “option httpclose”, “option forceclose”,<br>  “option http-tunnel” or “option http-keep-alive”. please check section 4<br>  (“proxies”) to see how this option combines with others when frontend and<br>  backend options differ.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-pretend-keepalive”,<br>             “option httpclose”, “option http-keep-alive”, and<br>             “1.1. the http transaction model”.</p>\n<p>option http-tunnel<br>no option http-tunnel<br>  disable or enable http connection processing after first transaction<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”.</p>\n<p>  option “http-tunnel” disables any http processing past the first request and<br>  the first response. this is the mode which was used by default in versions<br>  1.0 to 1.5-dev21. it is the mode with the lowest processing overhead, which<br>  is normally not needed anymore unless in very specific cases such as when<br>  using an in-house protocol that looks like http but is not compatible, or<br>  just to log one request per client in order to reduce log size. note that<br>  everything which works at the http level, including header parsing/addition,<br>  cookie processing or content switching will only work for the first request<br>  and will be ignored after the first response.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close”,<br>             “option httpclose”, “option http-keep-alive”, and<br>             “1.1. the http transaction model”.</p>\n<p>option http-use-proxy-header<br>no option http-use-proxy-header<br>  make use of non-standard proxy-connection header instead of connection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  while rfc2616 explicitly states that http/1.1 agents must use the<br>  connection header to indicate their wish of persistent or non-persistent<br>  connections, both browsers and proxies ignore this header for proxied<br>  connections and make use of the undocumented, non-standard proxy-connection<br>  header instead. the issue begins when trying to put a load balancer between<br>  browsers and such proxies, because there will be a difference between what<br>  haproxy understands and what the client and the proxy agree on.</p>\n<p>  by setting this option in a frontend, haproxy can automatically switch to use<br>  that non-standard header if it sees proxied requests. a proxied request is<br>  defined here as one where the uri begins with neither a ‘/‘ nor a ‘*’. the<br>  choice of header only affects requests passing through proxies making use of<br>  one of the “httpclose”, “forceclose” and “http-server-close” options. note<br>  that this option can only be specified in a frontend and will affect the<br>  request along its whole life.</p>\n<p>  also, when this option is set, a request which requires authentication will<br>  automatically switch to use proxy authentication headers if it is itself a<br>  proxied request. that makes it possible to check or enforce authentication in<br>  front of an existing proxy.</p>\n<p>  this option should normally never be used, except in front of a proxy.</p>\n<p>  see also : “option httpclose”, “option forceclose” and “option<br>             http-server-close”.</p>\n<p>option httpchk<br>option httpchk <uri><br>option httpchk <method> <uri><br>option httpchk <method> <uri> <version><br>  enable http protocol to check on the servers health<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <method>  is the optional http method used with the requests. when not set,<br>              the “options” method is used, as it generally requires low server<br>              processing and is easy to filter out from the logs. any method<br>              may be used, though it is not recommended to invent non-standard<br>              ones.</p>\n<pre><code>&lt;uri&gt;     is the uri referenced in the http requests. it defaults to &quot; / &quot;\n          which is accessible by default on almost any server, but may be\n          changed to any other uri. query strings are permitted.\n\n&lt;version&gt; is the optional http version string. it defaults to &quot;http/1.0&quot;\n          but some servers might behave incorrectly in http 1.0, so turning\n          it to http/1.1 may sometimes help. note that the host field is\n          mandatory in http/1.1, and as a trick, it is possible to pass it\n          after &quot;\\r\\n&quot; following the version string.\n</code></pre><p>  by default, server health checks only consist in trying to establish a tcp<br>  connection. when “option httpchk” is specified, a complete http request is<br>  sent once the tcp connection is established, and responses 2xx and 3xx are<br>  considered valid, while all other ones indicate a server failure, including<br>  the lack of any response.</p>\n<p>  the port and interval are specified in the server configuration.</p>\n<p>  this option does not necessarily require an http backend, it also works with<br>  plain tcp backends. this is particularly useful to check simple scripts bound<br>  to some dedicated ports using the inetd daemon.</p>\n<p>  examples :</p>\n<pre><code># relay https traffic to apache instance and check service availability\n# using http request &quot;options * http/1.1&quot; on port 80.\nbackend https_relay\n    mode tcp\n    option httpchk options * http/1.1\\r\\nhost:\\ www\n    server apache1 192.168.1.1:443 check port 80\n</code></pre><p>  see also : “option ssl-hello-chk”, “option smtpchk”, “option mysql-check”,<br>             “option pgsql-check”, “http-check” and the “check”, “port” and<br>             “inter” server options.</p>\n<p>option httpclose<br>no option httpclose<br>  enable or disable passive http connection closing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default haproxy operates in keep-alive mode with regards to persistent<br>  connections: for each connection it processes each request and response, and<br>  leaves the connection idle on both sides between the end of a response and<br>  the start of a new request. this mode may be changed by several options such<br>  as “option http-server-close”, “option forceclose”, “option httpclose” or<br>  “option http-tunnel”.</p>\n<p>  if “option httpclose” is set, haproxy will work in http tunnel mode and check<br>  if a “connection: close” header is already set in each direction, and will<br>  add one if missing. each end should react to this by actively closing the tcp<br>  connection after each transfer, thus resulting in a switch to the http close<br>  mode. any “connection” header different from “close” will also be removed.<br>  note that this option is deprecated since what it does is very cheap but not<br>  reliable. using “option http-server-close” or “option forceclose” is strongly<br>  recommended instead.</p>\n<p>  it seldom happens that some servers incorrectly ignore this header and do not<br>  close the connection even though they reply “connection: close”. for this<br>  reason, they are not compatible with older http 1.0 browsers. if this happens<br>  it is possible to use the “option forceclose” which actively closes the<br>  request connection once the server responds. option “forceclose” also<br>  releases the server connection earlier because it does not have to wait for<br>  the client to acknowledge it.</p>\n<p>  this option may be set both in a frontend and in a backend. it is enabled if<br>  at least one of the frontend or backend holding a connection has it enabled.<br>  it disables and replaces any previous “option http-server-close”,<br>  “option forceclose”, “option http-keep-alive” or “option http-tunnel”. please<br>  check section 4 (“proxies”) to see how this option combines with others when<br>  frontend and backend options differ.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option forceclose”, “option http-server-close” and<br>             “1.1. the http transaction model”.</p>\n<p>option httplog [ clf ]<br>  enable logging of http request, session state and timers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    clf       if the “clf” argument is added, then the output format will be<br>              the clf format instead of haproxy’s default http format. you can<br>              use this when you need to feed haproxy’s logs through a specific<br>              log analyser which only support the clf format and which is not<br>              extensible.</p>\n<p>  by default, the log output format is very poor, as it only contains the<br>  source and destination addresses, and the instance name. by specifying<br>  “option httplog”, each log line turns into a much richer format including,<br>  but not limited to, the http request, the connection timers, the session<br>  status, the connections numbers, the captured headers and cookies, the<br>  frontend, backend and server name, and of course the source address and<br>  ports.</p>\n<p>  this option may be set either in the frontend or the backend.</p>\n<p>  specifying only “option httplog” will automatically clear the ‘clf’ mode<br>  if it was set by default.</p>\n<p>  see also :  section 8 about logging.</p>\n<p>option http_proxy<br>no option http_proxy<br>  enable or disable plain http proxy mode<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  it sometimes happens that people need a pure http proxy which understands<br>  basic proxy requests without caching nor any fancy feature. in this case,<br>  it may be worth setting up an haproxy instance with the “option http_proxy”<br>  set. in this mode, no server is declared, and the connection is forwarded to<br>  the ip address and port found in the url after the “http://“ scheme.</p>\n<p>  no host address resolution is performed, so this only works when pure ip<br>  addresses are passed. since this option’s usage perimeter is rather limited,<br>  it will probably be used only by experts who know they need exactly it. last,<br>  if the clients are susceptible of sending keep-alive requests, it will be<br>  needed to add “option httpclose” to ensure that all requests will correctly<br>  be analyzed.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  example :</p>\n<pre><code># this backend understands http proxy requests and forwards them directly.\nbackend direct_forward\n    option httpclose\n    option http_proxy\n</code></pre><p>  see also : “option httpclose”</p>\n<p>option independent-streams<br>no option independent-streams<br>  enable or disable independent timeout processing for both directions<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |  yes<br>  arguments : none</p>\n<p>  by default, when data is sent over a socket, both the write timeout and the<br>  read timeout for that socket are refreshed, because we consider that there is<br>  activity on that socket, and we have no other means of guessing if we should<br>  receive data or not.</p>\n<p>  while this default behaviour is desirable for almost all applications, there<br>  exists a situation where it is desirable to disable it, and only refresh the<br>  read timeout if there are incoming data. this happens on sessions with large<br>  timeouts and low amounts of exchanged data such as telnet session. if the<br>  server suddenly disappears, the output data accumulates in the system’s<br>  socket buffers, both timeouts are correctly refreshed, and there is no way<br>  to know the server does not receive them, so we don’t timeout. however, when<br>  the underlying protocol always echoes sent data, it would be enough by itself<br>  to detect the issue using the read timeout. note that this problem does not<br>  happen with more verbose protocols because data won’t accumulate long in the<br>  socket buffers.</p>\n<p>  when this option is set on the frontend, it will disable read timeout updates<br>  on data sent to the client. there probably is little use of this case. when<br>  the option is set on the backend, it will disable read timeout updates on<br>  data sent to the server. doing so will typically break large http posts from<br>  slow lines, so use it with caution.</p>\n<p>  note: older versions used to call this setting “option independent-streams”<br>        with a spelling mistake. this spelling is still supported but<br>        deprecated.</p>\n<p>  see also : “timeout client”, “timeout server” and “timeout tunnel”</p>\n<p>option ldap-check<br>  use ldapv3 health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  it is possible to test that the server correctly talks ldapv3 instead of just<br>  testing that it accepts the tcp connection. when this option is set, an<br>  ldapv3 anonymous simple bind message is sent to the server, and the response<br>  is analyzed to find an ldapv3 bind response message.</p>\n<p>  the server is considered valid only when the ldap response contains success<br>  resultcode (<a href=\"http://tools.ietf.org/html/rfc4511#section-4.1.9\">http://tools.ietf.org/html/rfc4511#section-4.1.9</a>).</p>\n<p>  logging of bind requests is server dependent see your documentation how to<br>  configure it.</p>\n<p>  example :<br>        option ldap-check</p>\n<p>  see also : “option httpchk”</p>\n<p>option external-check<br>  use external processes for server health checks<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  it is possible to test the health of a server using an external command.<br>  this is achieved by running the executable set using “external-check<br>  command”.</p>\n<p>  requires the “external-check” global to be set.</p>\n<p>  see also : “external-check”, “external-check command”, “external-check path”</p>\n<p>option log-health-checks<br>no option log-health-checks<br>  enable or disable logging of health checks status updates<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |  yes<br>  arguments : none</p>\n<p>  by default, failed health check are logged if server is up and successful<br>  health checks are logged if server is down, so the amount of additional<br>  information is limited.</p>\n<p>  when this option is enabled, any change of the health check status or to<br>  the server’s health will be logged, so that it becomes possible to know<br>  that a server was failing occasional checks before crashing, or exactly when<br>  it failed to respond a valid http status, then when the port started to<br>  reject connections, then when the server stopped responding at all.</p>\n<p>  note that status changes not caused by health checks (eg: enable/disable on<br>  the cli) are intentionally not logged by this option.</p>\n<p>  see also: “option httpchk”, “option ldap-check”, “option mysql-check”,<br>            “option pgsql-check”, “option redis-check”, “option smtpchk”,<br>            “option tcp-check”, “log” and section 8 about logging.</p>\n<p>option log-separate-errors<br>no option log-separate-errors<br>  change log level for non-completely successful connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  sometimes looking for errors in logs is not easy. this option makes haproxy<br>  raise the level of logs containing potentially interesting information such<br>  as errors, timeouts, retries, redispatches, or http status codes 5xx. the<br>  level changes from “info” to “err”. this makes it possible to log them<br>  separately to a different file with most syslog daemons. be careful not to<br>  remove them from the original file, otherwise you would lose ordering which<br>  provides very important information.</p>\n<p>  using this option, large sites dealing with several thousand connections per<br>  second may log normal traffic to a rotating buffer and only archive smaller<br>  error logs.</p>\n<p>  see also : “log”, “dontlognull”, “dontlog-normal” and section 8 about<br>             logging.</p>\n<p>option logasap<br>no option logasap<br>  enable or disable early logging of http requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments : none</p>\n<p>  by default, http requests are logged upon termination so that the total<br>  transfer time and the number of bytes appear in the logs. when large objects<br>  are being transferred, it may take a while before the request appears in the<br>  logs. using “option logasap”, the request gets logged as soon as the server<br>  sends the complete headers. the only missing information in the logs will be<br>  the total number of bytes which will indicate everything except the amount<br>  of data transferred, and the total time which will not take the transfer<br>  time into account. in such a situation, it’s a good practice to capture the<br>  “content-length” response header so that the logs at least indicate how many<br>  bytes are expected to be transferred.</p>\n<p>  examples :<br>      listen http_proxy 0.0.0.0:80<br>          mode http<br>          option httplog<br>          option logasap<br>          log 192.168.2.200 local3</p>\n<pre><code>&gt;&gt;&gt; feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n      static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \\\n      &quot;get /image.iso http/1.0&quot;\n</code></pre><p>  see also : “option httplog”, “capture response header”, and section 8 about<br>             logging.</p>\n<p>option mysql-check [ user <username> [ post-41 ] ]<br>  use mysql health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <username> this is the username which will be used when connecting to mysql<br>               server.<br>    post-41    send post v4.1 client compatible checks</p>\n<p>  if you specify a username, the check consists of sending two mysql packet,<br>  one client authentication packet, and one quit packet, to correctly close<br>  mysql session. we then parse the mysql handshake initialisation packet and/or<br>  error packet. it is a basic but useful test which does not produce error nor<br>  aborted connect on the server. however, it requires adding an authorization<br>  in the mysql table, like this :</p>\n<pre><code>use mysql;\ninsert into user (host,user) values (&apos;&lt;ip_of_haproxy&gt;&apos;,&apos;&lt;username&gt;&apos;);\nflush privileges;\n</code></pre><p>  if you don’t specify a username (it is deprecated and not recommended), the<br>  check only consists in parsing the mysql handshake initialisation packet or<br>  error packet, we don’t send anything in this mode. it was reported that it<br>  can generate lockout if check is too frequent and/or if there is not enough<br>  traffic. in fact, you need in this case to check mysql “max_connect_errors”<br>  value as if a connection is established successfully within fewer than mysql<br>  “max_connect_errors” attempts after a previous connection was interrupted,<br>  the error count for the host is cleared to zero. if haproxy’s server get<br>  blocked, the “flush hosts” statement is the only way to unblock it.</p>\n<p>  remember that this does not check database presence nor database consistency.<br>  to do this, you can use an external check with xinetd for example.</p>\n<p>  the check requires mysql &gt;=3.22, for older version, please use tcp check.</p>\n<p>  most often, an incoming mysql server needs to see the client’s ip address for<br>  various purposes, including ip privilege matching and connection logging.<br>  when possible, it is often wise to masquerade the client’s ip address when<br>  connecting to the server using the “usesrc” argument of the “source” keyword,<br>  which requires the cttproxy feature to be compiled in, and the mysql server<br>  to route the client via the machine hosting haproxy.</p>\n<p>  see also: “option httpchk”</p>\n<p>option nolinger<br>no option nolinger<br>  enable or disable immediate session resource cleaning after close<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when clients or servers abort connections in a dirty way (eg: they are<br>  physically disconnected), the session timeouts triggers and the session is<br>  closed. but it will remain in fin_wait1 state for some time in the system,<br>  using some resources and possibly limiting the ability to establish newer<br>  connections.</p>\n<p>  when this happens, it is possible to activate “option nolinger” which forces<br>  the system to immediately remove any socket’s pending data on close. thus,<br>  the session is instantly purged from the system’s tables. this usually has<br>  side effects such as increased number of tcp resets due to old retransmits<br>  getting immediately rejected. some firewalls may sometimes complain about<br>  this too.</p>\n<p>  for this reason, it is not recommended to use this option when not absolutely<br>  needed. you know that you need it when you have thousands of fin_wait1<br>  sessions on your system (time_wait ones do not count).</p>\n<p>  this option may be used both on frontends and backends, depending on the side<br>  where it is required. use it on the frontend for clients, and on the backend<br>  for servers.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>option originalto [ except <network> ] [ header <name> ]<br>  enable insertion of the x-original-to header to requests sent to servers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <network> is an optional argument used to disable this option for sources<br>              matching <network><br>    <name>    an optional argument to specify a different “x-original-to”<br>              header name.</p>\n<p>  since haproxy can work in transparent mode, every request from a client can<br>  be redirected to the proxy and haproxy itself can proxy every request to a<br>  complex squid environment and the destination host from so_original_dst will<br>  be lost. this is annoying when you want access rules based on destination ip<br>  addresses. to solve this problem, a new http header “x-original-to” may be<br>  added by haproxy to all requests sent to the server. this header contains a<br>  value representing the original destination ip address. since this must be<br>  configured to always use the last occurrence of this header only. note that<br>  only the last occurrence of the header must be used, since it is really<br>  possible that the client has already brought one.</p>\n<p>  the keyword “header” may be used to supply a different header name to replace<br>  the default “x-original-to”. this can be useful where you might already<br>  have a “x-original-to” header from a different application, and you need<br>  preserve it. also if your backend server doesn’t use the “x-original-to”<br>  header and requires different one.</p>\n<p>  sometimes, a same haproxy instance may be shared between a direct client<br>  access and a reverse-proxy access (for instance when an ssl reverse-proxy is<br>  used to decrypt https traffic). it is possible to disable the addition of the<br>  header for a known source address or network by adding the “except” keyword<br>  followed by the network address. in this case, any source ip matching the<br>  network will not cause an addition of this header. most common uses are with<br>  private networks or 127.0.0.1.</p>\n<p>  this option may be specified either in the frontend or in the backend. if at<br>  least one of them uses it, the header will be added. note that the backend’s<br>  setting of the header subargument takes precedence over the frontend’s if<br>  both are defined.</p>\n<p>  examples :</p>\n<pre><code># original destination address\nfrontend www\n    mode http\n    option originalto except 127.0.0.1\n\n# those servers want the ip address in x-client-dst\nbackend www\n    mode http\n    option originalto header x-client-dst\n</code></pre><p>  see also : “option httpclose”, “option http-server-close”,<br>             “option forceclose”</p>\n<p>option persist<br>no option persist<br>  enable or disable forced persistence on down servers<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when an http request reaches a backend with a cookie which references a dead<br>  server, by default it is redispatched to another server. it is possible to<br>  force the request to be sent to the dead server first using “option persist”<br>  if absolutely needed. a common use case is when servers are under extreme<br>  load and spend their time flapping. in this case, the users would still be<br>  directed to the server they opened the session on, in the hope they would be<br>  correctly served. it is recommended to use “option redispatch” in conjunction<br>  with this option so that in the event it would not be possible to connect to<br>  the server at all (server definitely dead), the client would finally be<br>  redirected to another valid server.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option redispatch”, “retries”, “force-persist”</p>\n<p>option pgsql-check [ user <username> ]<br>  use postgresql health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <username> this is the username which will be used when connecting to<br>               postgresql server.</p>\n<p>  the check sends a postgresql startupmessage and waits for either<br>  authentication request or errorresponse message. it is a basic but useful<br>  test which does not produce error nor aborted connect on the server.<br>  this check is identical with the “mysql-check”.</p>\n<p>  see also: “option httpchk”</p>\n<p>option prefer-last-server<br>no option prefer-last-server<br>  allow multiple load balanced requests to remain on the same server<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when the load balancing algorithm in use is not deterministic, and a previous<br>  request was sent to a server to which haproxy still holds a connection, it is<br>  sometimes desirable that subsequent requests on a same session go to the same<br>  server as much as possible. note that this is different from persistence, as<br>  we only indicate a preference which haproxy tries to apply without any form<br>  of warranty. the real use is for keep-alive connections sent to servers. when<br>  this option is used, haproxy will try to reuse the same connection that is<br>  attached to the server instead of rebalancing to another server, causing a<br>  close of the connection. this can make sense for static file servers. it does<br>  not make much sense to use this in combination with hashing algorithms. note,<br>  haproxy already automatically tries to stick to a server which sends a 401 or<br>  to a proxy which sends a 407 (authentication required). this is mandatory for<br>  use with the broken ntlm authentication challenge, and significantly helps in<br>  troubleshooting some faulty applications. option prefer-last-server might be<br>  desirable in these environments as well, to avoid redistributing the traffic<br>  after every other response.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also: “option http-keep-alive”</p>\n<p>option redispatch<br>option redispatch <interval><br>no option redispatch<br>  enable or disable session redistribution in case of connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <interval> the optional integer value that controls how often redispatches<br>               occur when retrying connections. positive value p indicates a<br>               redispatch is desired on every pth retry, and negative value<br>               n indicate a redispath is desired on the nth retry prior to the<br>               last retry. for example, the default of -1 preserves the<br>               historical behaviour of redispatching on the last retry, a<br>               positive value of 1 would indicate a redispatch on every retry,<br>               and a positive value of 3 would indicate a redispatch on every<br>               third retry. you can disable redispatches with a value of 0.</p>\n<p>  in http mode, if a server designated by a cookie is down, clients may<br>  definitely stick to it because they cannot flush the cookie, so they will not<br>  be able to access the service anymore.</p>\n<p>  specifying “option redispatch” will allow the proxy to break their<br>  persistence and redistribute them to a working server.</p>\n<p>  it also allows to retry connections to another server in case of multiple<br>  connection failures. of course, it requires having “retries” set to a nonzero<br>  value.</p>\n<p>  this form is the preferred form, which replaces both the “redispatch” and<br>  “redisp” keywords.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “redispatch”, “retries”, “force-persist”</p>\n<p>option redis-check<br>  use redis health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  it is possible to test that the server correctly talks redis protocol instead<br>  of just testing that it accepts the tcp connection. when this option is set,<br>  a ping redis command is sent to the server, and the response is analyzed to<br>  find the “+pong” response message.</p>\n<p>  example :<br>        option redis-check</p>\n<p>  see also : “option httpchk”</p>\n<p>option smtpchk<br>option smtpchk <hello> <domain><br>  use smtp health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <hello>   is an optional argument. it is the “hello” command to use. it can<br>              be either “helo” (for smtp) or “ehlo” (for estmp). all other<br>              values will be turned into the default command (“helo”).</p>\n<pre><code>&lt;domain&gt;  is the domain name to present to the server. it may only be\n          specified (and is mandatory) if the hello command has been\n          specified. by default, &quot;localhost&quot; is used.\n</code></pre><p>  when “option smtpchk” is set, the health checks will consist in tcp<br>  connections followed by an smtp command. by default, this command is<br>  “helo localhost”. the server’s return code is analyzed and only return codes<br>  starting with a “2” will be considered as valid. all other responses,<br>  including a lack of response will constitute an error and will indicate a<br>  dead server.</p>\n<p>  this test is meant to be used with smtp servers or relays. depending on the<br>  request, it is possible that some servers do not log each connection attempt,<br>  so you may want to experiment to improve the behaviour. using telnet on port<br>  25 is often easier than adjusting the configuration.</p>\n<p>  most often, an incoming smtp server needs to see the client’s ip address for<br>  various purposes, including spam filtering, anti-spoofing and logging. when<br>  possible, it is often wise to masquerade the client’s ip address when<br>  connecting to the server using the “usesrc” argument of the “source” keyword,<br>  which requires the cttproxy feature to be compiled in.</p>\n<p>  example :<br>        option smtpchk helo mydomain.org</p>\n<p>  see also : “option httpchk”, “source”</p>\n<p>option socket-stats<br>no option socket-stats</p>\n<p>  enable or disable collecting &amp; providing separate statistics for each socket.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no</p>\n<p>  arguments : none</p>\n<p>option splice-auto<br>no option splice-auto<br>  enable or disable automatic kernel acceleration on sockets in both directions<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will automatically evaluate the opportunity to use kernel tcp splicing to<br>  forward data between the client and the server, in either direction. haproxy<br>  uses heuristics to estimate if kernel splicing might improve performance or<br>  not. both directions are handled independently. note that the heuristics used<br>  are not much aggressive in order to limit excessive use of splicing. this<br>  option requires splicing to be enabled at compile time, and may be globally<br>  disabled with the global option “nosplice”. since splice uses pipes, using it<br>  requires that there are enough spare pipes.</p>\n<p>  important note: kernel-based tcp splicing is a linux-specific feature which<br>  first appeared in kernel 2.6.25. it offers kernel-based acceleration to<br>  transfer data between sockets without copying these data to user-space, thus<br>  providing noticeable performance gains and cpu cycles savings. since many<br>  early implementations are buggy, corrupt data and/or are inefficient, this<br>  feature is not enabled by default, and it should be used with extreme care.<br>  while it is not possible to detect the correctness of an implementation,<br>  2.6.29 is the first version offering a properly working implementation. in<br>  case of doubt, splicing may be globally disabled using the global “nosplice”<br>  keyword.</p>\n<p>  example :<br>        option splice-auto</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-request”, “option splice-response”, and global<br>             options “nosplice” and “maxpipes”</p>\n<p>option splice-request<br>no option splice-request<br>  enable or disable automatic kernel acceleration on sockets for requests<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will use kernel tcp splicing whenever possible to forward data going from<br>  the client to the server. it might still use the recv/send scheme if there<br>  are no spare pipes left. this option requires splicing to be enabled at<br>  compile time, and may be globally disabled with the global option “nosplice”.<br>  since splice uses pipes, using it requires that there are enough spare pipes.</p>\n<p>  important note: see “option splice-auto” for usage limitations.</p>\n<p>  example :<br>        option splice-request</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-auto”, “option splice-response”, and global options<br>             “nosplice” and “maxpipes”</p>\n<p>option splice-response<br>no option splice-response<br>  enable or disable automatic kernel acceleration on sockets for responses<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when this option is enabled either on a frontend or on a backend, haproxy<br>  will use kernel tcp splicing whenever possible to forward data going from<br>  the server to the client. it might still use the recv/send scheme if there<br>  are no spare pipes left. this option requires splicing to be enabled at<br>  compile time, and may be globally disabled with the global option “nosplice”.<br>  since splice uses pipes, using it requires that there are enough spare pipes.</p>\n<p>  important note: see “option splice-auto” for usage limitations.</p>\n<p>  example :<br>        option splice-response</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option splice-auto”, “option splice-request”, and global options<br>             “nosplice” and “maxpipes”</p>\n<p>option srvtcpka<br>no option srvtcpka<br>  enable or disable the sending of tcp keepalive packets on the server side<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “srvtcpka” enables the emission of tcp keep-alive probes on the<br>  server side of a connection, which should help when session expirations are<br>  noticed between haproxy and a server.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option clitcpka”, “option tcpka”</p>\n<p>option ssl-hello-chk<br>  use sslv3 client hello health checks for server testing<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  when some ssl-based protocols are relayed in tcp mode through haproxy, it is<br>  possible to test that the server correctly talks ssl instead of just testing<br>  that it accepts the tcp connection. when “option ssl-hello-chk” is set, pure<br>  sslv3 client hello messages are sent once the connection is established to<br>  the server, and the response is analyzed to find an ssl server hello message.<br>  the server is considered valid only when the response contains this server<br>  hello message.</p>\n<p>  all servers tested till there correctly reply to sslv3 client hello messages,<br>  and most servers tested do not even log the requests containing only hello<br>  messages, which is appreciable.</p>\n<p>  note that this check works even when ssl support was not built into haproxy<br>  because it forges the ssl message. when ssl support is available, it is best<br>  to use native ssl health checks instead of this one.</p>\n<p>  see also: “option httpchk”, “check-ssl”</p>\n<p>option tcp-check<br>  perform health checks using tcp-check send/expect sequences<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               yes    |    no    |   yes  |   yes</p>\n<p>  this health check method is intended to be combined with “tcp-check” command<br>  lists in order to support send/expect types of health check sequences.</p>\n<p>  tcp checks currently support 4 modes of operations :</p>\n<pre><code>- no &quot;tcp-check&quot; directive : the health check only consists in a connection\n  attempt, which remains the default mode.\n\n- &quot;tcp-check send&quot; or &quot;tcp-check send-binary&quot; only is mentioned : this is\n  used to send a string along with a connection opening. with some\n  protocols, it helps sending a &quot;quit&quot; message for example that prevents\n  the server from logging a connection error for each health check. the\n  check result will still be based on the ability to open the connection\n  only.\n\n- &quot;tcp-check expect&quot; only is mentioned : this is used to test a banner.\n  the connection is opened and haproxy waits for the server to present some\n  contents which must validate some rules. the check result will be based\n  on the matching between the contents and the rules. this is suited for\n  pop, imap, smtp, ftp, ssh, telnet.\n\n- both &quot;tcp-check send&quot; and &quot;tcp-check expect&quot; are mentioned : this is\n  used to test a hello-type protocol. haproxy sends a message, the server\n  responds and its response is analysed. the check result will be based on\n  the matching between the response contents and the rules. this is often\n  suited for protocols which require a binding or a request/response model.\n  ldap, mysql, redis and ssl are example of such protocols, though they\n  already all have their dedicated checks with a deeper understanding of\n  the respective protocols.\n  in this mode, many questions may be sent and many answers may be\n  analysed.\n\na fifth mode can be used to insert comments in different steps of the\nscript.\n\nfor each tcp-check rule you create, you can add a &quot;comment&quot; directive,\nfollowed by a string. this string will be reported in the log and stderr\nin debug mode. it is useful to make user-friendly error reporting.\nthe &quot;comment&quot; is of course optional.\n</code></pre><p>  examples :</p>\n<pre><code># perform a pop check (analyse only server&apos;s banner)\noption tcp-check\ntcp-check expect string +ok\\ pop3\\ ready comment pop\\ protocol\n\n# perform an imap check (analyse only server&apos;s banner)\noption tcp-check\ntcp-check expect string *\\ ok\\ imap4\\ ready comment imap\\ protocol\n\n# look for the redis master server after ensuring it speaks well\n# redis protocol, then it exits properly.\n# (send a command then analyse the response 3 times)\noption tcp-check\ntcp-check comment ping\\ phase\ntcp-check send ping\\r\\n\ntcp-check expect +ponge\ntcp-check comment role\\ check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check comment quit\\ phase\ntcp-check send quit\\r\\n\ntcp-check expect string +ok\n\nforge a http request, then analyse the response\n(send many headers before analyzing)\noption tcp-check\ntcp-check comment forge\\ and\\ send\\ http\\ request\ntcp-check send head\\ /\\ http/1.1\\r\\n\ntcp-check send host:\\ www.mydomain.com\\r\\n\ntcp-check send user-agent:\\ haproxy\\ tcpcheck\\r\\n\ntcp-check send \\r\\n\ntcp-check expect rstring http/1\\..\\ (2..|3..) comment check\\ http\\ response\n</code></pre><p>  see also : “tcp-check expect”, “tcp-check send”</p>\n<p>option tcp-smart-accept<br>no option tcp-smart-accept<br>  enable or disable the saving of one ack packet during the accept sequence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |    no<br>  arguments : none</p>\n<p>  when an http connection request comes in, the system acknowledges it on<br>  behalf of haproxy, then the client immediately sends its request, and the<br>  system acknowledges it too while it is notifying haproxy about the new<br>  connection. haproxy then reads the request and responds. this means that we<br>  have one tcp ack sent by the system for nothing, because the request could<br>  very well be acknowledged by haproxy when it sends its response.</p>\n<p>  for this reason, in http mode, haproxy automatically asks the system to avoid<br>  sending this useless ack on platforms which support it (currently at least<br>  linux). it must not cause any problem, because the system will send it anyway<br>  after 40 ms if the response takes more time than expected to come.</p>\n<p>  during complex network debugging sessions, it may be desirable to disable<br>  this optimization because delayed acks can make troubleshooting more complex<br>  when trying to identify where packets are delayed. it is then possible to<br>  fall back to normal behaviour by specifying “no option tcp-smart-accept”.</p>\n<p>  it is also possible to force it for non-http proxies by simply specifying<br>  “option tcp-smart-accept”. for instance, it can make sense with some services<br>  such as smtp where the server speaks first.</p>\n<p>  it is recommended to avoid forcing this option in a defaults section. in case<br>  of doubt, consider setting it back to automatic values by prepending the<br>  “default” keyword before it, or disabling it using the “no” keyword.</p>\n<p>  see also : “option tcp-smart-connect”</p>\n<p>option tcp-smart-connect<br>no option tcp-smart-connect<br>  enable or disable the saving of one ack packet during the connect sequence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  on certain systems (at least linux), haproxy can ask the kernel not to<br>  immediately send an empty ack upon a connection request, but to directly<br>  send the buffer request instead. this saves one packet on the network and<br>  thus boosts performance. it can also be useful for some servers, because they<br>  immediately get the request along with the incoming connection.</p>\n<p>  this feature is enabled when “option tcp-smart-connect” is set in a backend.<br>  it is not enabled by default because it makes network troubleshooting more<br>  complex.</p>\n<p>  it only makes sense to enable it with protocols where the client speaks first<br>  such as http. in other situations, if there is no data to send in place of<br>  the ack, a normal ack is sent.</p>\n<p>  if this option has been enabled in a “defaults” section, it can be disabled<br>  in a specific instance by prepending the “no” keyword before it.</p>\n<p>  see also : “option tcp-smart-accept”</p>\n<p>option tcpka<br>  enable or disable the sending of tcp keepalive packets on both sides<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  when there is a firewall or any session-aware component between a client and<br>  a server, and when the protocol involves very long sessions with long idle<br>  periods (eg: remote desktops), there is a risk that one of the intermediate<br>  components decides to expire a session which has remained idle for too long.</p>\n<p>  enabling socket-level tcp keep-alives makes the system regularly send packets<br>  to the other end of the connection, leaving it active. the delay between<br>  keep-alive probes is controlled by the system only and depends both on the<br>  operating system and its tuning parameters.</p>\n<p>  it is important to understand that keep-alive packets are neither emitted nor<br>  received at the application level. it is only the network stacks which sees<br>  them. for this reason, even if one side of the proxy already uses keep-alives<br>  to maintain its connection alive, those keep-alive packets will not be<br>  forwarded to the other side of the proxy.</p>\n<p>  please note that this has nothing to do with http keep-alive.</p>\n<p>  using option “tcpka” enables the emission of tcp keep-alive probes on both<br>  the client and server sides of a connection. note that this is meaningful<br>  only in “defaults” or “listen” sections. if this option is used in a<br>  frontend, only the client side will get keep-alives, and if this option is<br>  used in a backend, only the server side will get keep-alives. for this<br>  reason, it is strongly recommended to explicitly use “option clitcpka” and<br>  “option srvtcpka” when the configuration is split between frontends and<br>  backends.</p>\n<p>  see also : “option clitcpka”, “option srvtcpka”</p>\n<p>option tcplog<br>  enable advanced logging of tcp connections with session state and timers<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the log output format is very poor, as it only contains the<br>  source and destination addresses, and the instance name. by specifying<br>  “option tcplog”, each log line turns into a much richer format including, but<br>  not limited to, the connection timers, the session status, the connections<br>  numbers, the frontend, backend and server name, and of course the source<br>  address and ports. this option is useful for pure tcp proxies in order to<br>  find which of the client or server disconnects or times out. for normal http<br>  proxies, it’s better to use “option httplog” which is even more complete.</p>\n<p>  this option may be set either in the frontend or the backend.</p>\n<p>  see also :  “option httplog”, and section 8 about logging.</p>\n<p>option transparent<br>no option transparent<br>  enable client-side transparent proxying<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  this option was introduced in order to provide layer 7 persistence to layer 3<br>  load balancers. the idea is to use the os’s ability to redirect an incoming<br>  connection for a remote address to a local process (here haproxy), and let<br>  this process know what address was initially requested. when this option is<br>  used, sessions without cookies will be forwarded to the original destination<br>  ip address of the incoming request (which should match that of another<br>  equipment), while requests with cookies will still be forwarded to the<br>  appropriate server.</p>\n<p>  note that contrary to a common belief, this option does not make haproxy<br>  present the client’s ip to the server when establishing the connection.</p>\n<p>  see also: the “usesrc” argument of the “source” keyword, and the<br>            “transparent” option of the “bind” keyword.</p>\n<p>external-check command <command><br>  executable to run when performing an external-check<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <command> is the external command to run</p>\n<p>  the arguments passed to the to the command are:</p>\n<p>  <proxy_address> <proxy_port> <server_address> <server_port></p>\n<p>  the <proxy_address> and <proxy_port> are derived from the first listener<br>  that is either ipv4, ipv6 or a unix socket. in the case of a unix socket<br>  listener the proxy_address will be the path of the socket and the<br>  <proxy_port> will be the string “not_used”. in a backend section, it’s not<br>  possible to determine a listener, and both <proxy_address> and <proxy_port><br>  will have the string value “not_used”.</p>\n<p>  some values are also provided through environment variables.</p>\n<p>  environment variables :<br>    haproxy_proxy_addr      the first bind address if available (or empty if not<br>                            applicable, for example in a “backend” section).</p>\n<pre><code>haproxy_proxy_id        the backend id.\n\nhaproxy_proxy_name      the backend name.\n\nhaproxy_proxy_port      the first bind port if available (or empty if not\n                        applicable, for example in a &quot;backend&quot; section or\n                        for a unix socket).\n\nhaproxy_server_addr     the server address.\n\nhaproxy_server_curconn  the current number of connections on the server.\n\nhaproxy_server_id       the server id.\n\nhaproxy_server_maxconn  the server max connections.\n\nhaproxy_server_name     the server name.\n\nhaproxy_server_port     the server port if available (or empty for a unix\n                        socket).\n\npath                    the path environment variable used when executing\n                        the command may be set using &quot;external-check path&quot;.\n</code></pre><p>  if the command executed and exits with a zero status then the check is<br>  considered to have passed, otherwise the check is considered to have<br>  failed.</p>\n<p>  example :<br>        external-check command /bin/true</p>\n<p>  see also : “external-check”, “option external-check”, “external-check path”</p>\n<p>external-check path <path><br>  the value of the path environment variable used when running an external-check<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <path> is the path used when executing external command to run</p>\n<p>  the default path is “”.</p>\n<p>  example :<br>        external-check path “/usr/bin:/bin”</p>\n<p>  see also : “external-check”, “option external-check”,<br>             “external-check command”</p>\n<p>persist rdp-cookie<br>persist rdp-cookie(<name>)<br>  enable rdp cookie-based persistence<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the optional name of the rdp cookie to check. if omitted, the<br>              default cookie name “msts” will be used. there currently is no<br>              valid reason to change this name.</p>\n<p>  this statement enables persistence based on an rdp cookie. the rdp cookie<br>  contains all information required to find the server in the list of known<br>  servers. so when this option is set in the backend, the request is analysed<br>  and if an rdp cookie is found, it is decoded. if it matches a known server<br>  which is still up (or if “option persist” is set), then the connection is<br>  forwarded to this server.</p>\n<p>  note that this only makes sense in a tcp backend, but for this to work, the<br>  frontend must have waited long enough to ensure that an rdp cookie is present<br>  in the request buffer. this is the same requirement as with the “rdp-cookie”<br>  load-balancing method. thus it is highly recommended to put all statements in<br>  a single “listen” section.</p>\n<p>  also, it is important to understand that the terminal server will emit this<br>  rdp cookie only if it is configured for “token redirection mode”, which means<br>  that the “ip address redirection” option is disabled.</p>\n<p>  example :<br>        listen tse-farm<br>            bind :3389</p>\n<pre><code># wait up to 5s for an rdp cookie in the request\ntcp-request inspect-delay 5s\ntcp-request content accept if rdp_cookie\n# apply rdp cookie persistence\npersist rdp-cookie\n# if server is unknown, let&apos;s balance on the same cookie.\n# alternatively, &quot;balance leastconn&quot; may be useful too.\nbalance rdp-cookie\nserver srv1 1.1.1.1:3389\nserver srv2 1.1.1.2:3389\n</code></pre><p>  see also : “balance rdp-cookie”, “tcp-request”, the “req_rdp_cookie” acl and<br>  the rdp_cookie pattern fetch function.</p>\n<p>rate-limit sessions <rate><br>  set a limit on the number of new sessions accepted per second on a frontend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <rate>    the <rate> parameter is an integer designating the maximum number<br>              of new sessions per second to accept on the frontend.</p>\n<p>  when the frontend reaches the specified number of new sessions per second, it<br>  stops accepting new connections until the rate drops below the limit again.<br>  during this time, the pending sessions will be kept in the socket’s backlog<br>  (in system buffers) and haproxy will not even be aware that sessions are<br>  pending. when applying very low limit on a highly loaded service, it may make<br>  sense to increase the socket’s backlog using the “backlog” keyword.</p>\n<p>  this feature is particularly efficient at blocking connection-based attacks<br>  or service abuse on fragile servers. since the session rate is measured every<br>  millisecond, it is extremely accurate. also, the limit applies immediately,<br>  no delay is needed at all to detect the threshold.</p>\n<p>  example : limit the connection rate on smtp to 10 per second max<br>        listen smtp<br>            mode tcp<br>            bind :25<br>            rate-limit sessions 10<br>            server 127.0.0.1:1025</p>\n<p>  note : when the maximum rate is reached, the frontend’s status is not changed<br>         but its sockets appear as “waiting” in the statistics if the<br>         “socket-stats” option is enabled.</p>\n<p>  see also : the “backlog” keyword and the “fe_sess_rate” acl criterion.</p>\n<p>redirect location <loc> [code <code>] <option> [{if | unless} <condition>]<br>redirect prefix   <pfx> [code <code>] <option> [{if | unless} <condition>]<br>redirect scheme   <sch> [code <code>] <option> [{if | unless} <condition>]<br>  return an http redirection if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</p>\n<p>  if/unless the condition is matched, the http request will lead to a redirect<br>  response. if no condition is specified, the redirect applies unconditionally.</p>\n<p>  arguments :<br>    <loc>     with “redirect location”, the exact value in <loc> is placed into<br>              the http “location” header. when used in an “http-request” rule,<br>              <loc> value follows the log-format rules and can include some<br>              dynamic values (see custom log format in section 8.2.4).</p>\n<pre><code>&lt;pfx&gt;     with &quot;redirect prefix&quot;, the &quot;location&quot; header is built from the\n          concatenation of &lt;pfx&gt; and the complete uri path, including the\n          query string, unless the &quot;drop-query&quot; option is specified (see\n          below). as a special case, if &lt;pfx&gt; equals exactly &quot;/&quot;, then\n          nothing is inserted before the original uri. it allows one to\n          redirect to the same url (for instance, to insert a cookie). when\n          used in an &quot;http-request&quot; rule, &lt;pfx&gt; value follows the log-format\n          rules and can include some dynamic values (see custom log format\n          in section 8.2.4).\n\n&lt;sch&gt;     with &quot;redirect scheme&quot;, then the &quot;location&quot; header is built by\n          concatenating &lt;sch&gt; with &quot;://&quot; then the first occurrence of the\n          &quot;host&quot; header, and then the uri path, including the query string\n          unless the &quot;drop-query&quot; option is specified (see below). if no\n          path is found or if the path is &quot;*&quot;, then &quot;/&quot; is used instead. if\n          no &quot;host&quot; header is found, then an empty host component will be\n          returned, which most recent browsers interpret as redirecting to\n          the same host. this directive is mostly used to redirect http to\n          https. when used in an &quot;http-request&quot; rule, &lt;sch&gt; value follows\n          the log-format rules and can include some dynamic values (see\n          custom log format in section 8.2.4).\n\n&lt;code&gt;    the code is optional. it indicates which type of http redirection\n          is desired. only codes 301, 302, 303, 307 and 308 are supported,\n          with 302 used by default if no code is specified. 301 means\n          &quot;moved permanently&quot;, and a browser may cache the location. 302\n          means &quot;moved permanently&quot; and means that the browser should not\n          cache the redirection. 303 is equivalent to 302 except that the\n          browser will fetch the location with a get method. 307 is just\n          like 302 but makes it clear that the same method must be reused.\n          likewise, 308 replaces 301 if the same method must be used.\n\n&lt;option&gt;  there are several options which can be specified to adjust the\n          expected behaviour of a redirection :\n\n  - &quot;drop-query&quot;\n    when this keyword is used in a prefix-based redirection, then the\n    location will be set without any possible query-string, which is useful\n    for directing users to a non-secure page for instance. it has no effect\n    with a location-type redirect.\n\n  - &quot;append-slash&quot;\n    this keyword may be used in conjunction with &quot;drop-query&quot; to redirect\n    users who use a url not ending with a &apos;/&apos; to the same one with the &apos;/&apos;.\n    it can be useful to ensure that search engines will only see one url.\n    for this, a return code 301 is preferred.\n\n  - &quot;set-cookie name[=value]&quot;\n    a &quot;set-cookie&quot; header will be added with name (and optionally &quot;=value&quot;)\n    to the response. this is sometimes used to indicate that a user has\n    been seen, for instance to protect against some types of dos. no other\n    cookie option is added, so the cookie will be a session cookie. note\n    that for a browser, a sole cookie name without an equal sign is\n    different from a cookie with an equal sign.\n\n  - &quot;clear-cookie name[=]&quot;\n    a &quot;set-cookie&quot; header will be added with name (and optionally &quot;=&quot;), but\n    with the &quot;max-age&quot; attribute set to zero. this will tell the browser to\n    delete this cookie. it is useful for instance on logout pages. it is\n    important to note that clearing the cookie &quot;name&quot; will not remove a\n    cookie set with &quot;name=value&quot;. you have to clear the cookie &quot;name=&quot; for\n    that, because the browser makes the difference.\n</code></pre><p>  example: move the login url only to https.<br>        acl clear      dst_port  80<br>        acl secure     dst_port  8080<br>        acl login_page url_beg   /login<br>        acl logout     url_beg   /logout<br>        acl uid_given  url_reg   /login?userid=[^&amp;]+<br>        acl cookie_set hdr_sub(cookie) seen=1</p>\n<pre><code>redirect prefix   https://mysite.com set-cookie seen=1 if !cookie_set\nredirect prefix   https://mysite.com           if login_page !secure\nredirect prefix   http://mysite.com drop-query if login_page !uid_given\nredirect location http://mysite.com/           if !login_page secure\nredirect location / clear-cookie userid=       if logout\n</code></pre><p>  example: send redirects for request for articles without a ‘/‘.<br>        acl missing_slash path_reg ^/article/[^/]*$<br>        redirect code 301 prefix / drop-query append-slash if missing_slash</p>\n<p>  example: redirect all http traffic to https when ssl is handled by haproxy.<br>        redirect scheme https if !{ ssl_fc }</p>\n<p>  example: append ‘www.’ prefix in front of all hosts not having it<br>        http-request redirect code 301 location www.%[hdr(host)]%[req.uri] \\<br>          unless { hdr_beg(host) -i www }</p>\n<p>  see section 7 about acl usage.</p>\n<p>redisp (deprecated)<br>redispatch (deprecated)<br>  enable or disable session redistribution in case of connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  in http mode, if a server designated by a cookie is down, clients may<br>  definitely stick to it because they cannot flush the cookie, so they will not<br>  be able to access the service anymore.</p>\n<p>  specifying “redispatch” will allow the proxy to break their persistence and<br>  redistribute them to a working server.</p>\n<p>  it also allows to retry last connection to another server in case of multiple<br>  connection failures. of course, it requires having “retries” set to a nonzero<br>  value.</p>\n<p>  this form is deprecated, do not use it in any new configuration, use the new<br>  “option redispatch” instead.</p>\n<p>  see also : “option redispatch”</p>\n<p>reqadd  <string> [{if | unless} <cond>]<br>  add a header at the end of the http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <string>  is the complete line to be added. any space or known delimiter<br>              must be escaped using a backslash (‘\\’). please refer to section<br>              6 about http header manipulation for more information.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a new line consisting in <string> followed by a line feed will be added after<br>  the last header of an http request.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses.</p>\n<p>  example : add “x-proto: ssl” to requests coming via port 81<br>     acl is-ssl  dst_port       81<br>     reqadd      x-proto:\\ ssl  if is-ssl</p>\n<p>  see also: “rspadd”, section 6 about http header manipulation, and section 7<br>            about acls.</p>\n<p>reqallow  <search> [{if | unless} <cond>]<br>reqiallow <search> [{if | unless} <cond>] (ignore case)<br>  definitely allow an http request if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqallow” keyword strictly matches case while “reqiallow”<br>              ignores case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will mark the request as allowed, even if any later test would<br>  result in a deny. the test applies both to the request line and to request<br>  headers. keep in mind that urls in request line are case-sensitive while<br>  header names are not.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># allow www.* but refuse *.local\nreqiallow ^host:\\ www\\.\nreqideny  ^host:\\ .*\\.local\n</code></pre><p>  see also: “reqdeny”, “block”, section 6 about http header manipulation, and<br>            section 7 about acls.</p>\n<p>reqdel  <search> [{if | unless} <cond>]<br>reqidel <search> [{if | unless} <cond>]  (ignore case)<br>  delete all headers matching a regular expression in an http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the “reqdel”<br>              keyword strictly matches case while “reqidel” ignores case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any header line matching extended regular expression <search> in the request<br>  will be completely deleted. most common use of this is to remove unwanted<br>  and/or dangerous headers or cookies from a request before passing it to the<br>  next servers.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. keep in mind that header names are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># remove x-forwarded-for header and server cookie\nreqidel ^x-forwarded-for:.*\nreqidel ^cookie:.*server=\n</code></pre><p>  see also: “reqadd”, “reqrep”, “rspdel”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqdeny  <search> [{if | unless} <cond>]<br>reqideny <search> [{if | unless} <cond>]  (ignore case)<br>  deny an http request if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqdeny” keyword strictly matches case while “reqideny” ignores<br>              case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will mark the request as denied, even if any later test would<br>  result in an allow. the test applies both to the request line and to request<br>  headers. keep in mind that urls in request line are case-sensitive while<br>  header names are not.</p>\n<p>  a denied request will generate an “http 403 forbidden” response once the<br>  complete request has been parsed. this is consistent with what is practiced<br>  using acls.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># refuse *.local, then allow www.*\nreqideny  ^host:\\ .*\\.local\nreqiallow ^host:\\ www\\.\n</code></pre><p>  see also: “reqallow”, “rspdeny”, “block”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqpass  <search> [{if | unless} <cond>]<br>reqipass <search> [{if | unless} <cond>]  (ignore case)<br>  ignore any http request line matching a regular expression in next rules<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqpass” keyword strictly matches case while “reqipass” ignores<br>              case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will skip next rules, without assigning any deny or allow verdict.<br>  the test applies both to the request line and to request headers. keep in<br>  mind that urls in request line are case-sensitive while header names are not.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  reqdeny, reqallow and reqpass should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># refuse *.local, then allow www.*, but ignore &quot;www.private.local&quot;\nreqipass  ^host:\\ www.private\\.local\nreqideny  ^host:\\ .*\\.local\nreqiallow ^host:\\ www\\.\n</code></pre><p>  see also: “reqallow”, “reqdeny”, “block”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>reqrep  <search> <string> [{if | unless} <cond>]<br>reqirep <search> <string> [{if | unless} <cond>]   (ignore case)<br>  replace a regular expression with a string in an http request line<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the “reqrep”<br>              keyword strictly matches case while “reqirep” ignores case.</p>\n<pre><code>&lt;string&gt;  is the complete line to be added. any space or known delimiter\n          must be escaped using a backslash (&apos;\\&apos;). references to matched\n          pattern groups are possible using the common \\n form, with n\n          being a single digit between 0 and 9\\. please refer to section\n          6 about http header manipulation for more information.\n\n&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any line matching extended regular expression <search> in the request (both<br>  the request line and header lines) will be completely replaced with <string>.<br>  most common use of this is to rewrite urls or domain names in “host” headers.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. note that for increased readability, it is suggested to add enough<br>  spaces between the request and the response. keep in mind that urls in<br>  request line are case-sensitive while header names are not.</p>\n<p>  example :</p>\n<pre><code># replace &quot;/static/&quot; with &quot;/&quot; at the beginning of any request path.\nreqrep ^([^\\ :]*)\\ /static/(.*)     \\1\\ /\\2\n# replace &quot;www.mydomain.com&quot; with &quot;www&quot; in the host name.\nreqirep ^host:\\ www.mydomain.com   host:\\ www\n</code></pre><p>  see also: “reqadd”, “reqdel”, “rsprep”, “tune.bufsize”, section 6 about<br>            http header manipulation, and section 7 about acls.</p>\n<p>reqtarpit  <search> [{if | unless} <cond>]<br>reqitarpit <search> [{if | unless} <cond>]  (ignore case)<br>  tarpit an http request containing a line matching a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              request line. this is an extended regular expression. parenthesis<br>              grouping is supported and no preliminary backslash is required.<br>              any space or known delimiter must be escaped using a backslash<br>              (‘\\’). the pattern applies to a full line at a time. the<br>              “reqtarpit” keyword strictly matches case while “reqitarpit”<br>              ignores case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a request containing any line which matches extended regular expression<br>  <search> will be tarpitted, which means that it will connect to nowhere, will<br>  be kept open for a pre-defined time, then will return an http error 500 so<br>  that the attacker does not suspect it has been tarpitted. the status 500 will<br>  be reported in the logs, but the completion flags will indicate “pt”. the<br>  delay is defined by “timeout tarpit”, or “timeout connect” if the former is<br>  not set.</p>\n<p>  the goal of the tarpit is to slow down robots attacking servers with<br>  identifiable requests. many robots limit their outgoing number of connections<br>  and stay connected waiting for a reply which can take several minutes to<br>  come. depending on the environment and attack, it may be particularly<br>  efficient at reducing the load on the network and firewalls.</p>\n<p>  examples :</p>\n<pre><code># ignore user-agents reporting any flavour of &quot;mozilla&quot; or &quot;msie&quot;, but\n# block all others.\nreqipass   ^user-agent:\\.*(mozilla|msie)\nreqitarpit ^user-agent:\n\n# block bad guys\nacl badguys src 10.1.0.3 172.16.13.20/28\nreqitarpit . if badguys\n</code></pre><p>  see also: “reqallow”, “reqdeny”, “reqpass”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>retries <value><br>  set the number of retries to perform on a server after a connection failure<br>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <value>   is the number of times a connection attempt should be retried on<br>              a server when a connection either is refused or times out. the<br>              default value is 3.</p>\n<p>  it is important to understand that this value applies to the number of<br>  connection attempts, not full requests. when a connection has effectively<br>  been established to a server, there will be no more retry.</p>\n<p>  in order to avoid immediate reconnections to a server which is restarting,<br>  a turn-around timer of min(“timeout connect”, one second) is applied before<br>  a retry occurs.</p>\n<p>  when “option redispatch” is set, the last retry may be performed on another<br>  server even if a cookie references a different server.</p>\n<p>  see also : “option redispatch”</p>\n<p>rspadd <string> [{if | unless} <cond>]<br>  add a header at the end of the http response<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <string>  is the complete line to be added. any space or known delimiter<br>              must be escaped using a backslash (‘\\’). please refer to section<br>              6 about http header manipulation for more information.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a new line consisting in <string> followed by a line feed will be added after<br>  the last header of an http response.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses.</p>\n<p>  see also: “reqadd”, section 6 about http header manipulation, and section 7<br>            about acls.</p>\n<p>rspdel  <search> [{if | unless} <cond>]<br>rspidel <search> [{if | unless} <cond>]  (ignore case)<br>  delete all headers matching a regular expression in an http response<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rspdel” keyword strictly matches case while “rspidel”<br>              ignores case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any header line matching extended regular expression <search> in the response<br>  will be completely deleted. most common use of this is to remove unwanted<br>  and/or sensitive headers or cookies from a response before passing it to the<br>  client.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. keep in mind that header names are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># remove the server header from responses\nrspidel ^server:.*\n</code></pre><p>  see also: “rspadd”, “rsprep”, “reqdel”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>rspdeny  <search> [{if | unless} <cond>]<br>rspideny <search> [{if | unless} <cond>]  (ignore case)<br>  block an http response if a line matches a regular expression<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rspdeny” keyword strictly matches case while “rspideny”<br>              ignores case.</p>\n<pre><code>&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  a response containing any line which matches extended regular expression<br>  <search> will mark the request as denied. the test applies both to the<br>  response line and to response headers. keep in mind that header names are not<br>  case-sensitive.</p>\n<p>  main use of this keyword is to prevent sensitive information leak and to<br>  block the response before it reaches the client. if a response is denied, it<br>  will be replaced with an http 502 error so that the client never retrieves<br>  any sensitive data.</p>\n<p>  it is easier, faster and more powerful to use acls to write access policies.<br>  rspdeny should be avoided in new designs.</p>\n<p>  example :</p>\n<pre><code># ensure that no content type matching ms-word will leak\nrspideny  ^content-type:\\.*/ms-word\n</code></pre><p>  see also: “reqdeny”, “acl”, “block”, section 6 about http header manipulation<br>            and section 7 about acls.</p>\n<p>rsprep  <search> <string> [{if | unless} <cond>]<br>rspirep <search> <string> [{if | unless} <cond>]  (ignore case)<br>  replace a regular expression with a string in an http response line<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <search>  is the regular expression applied to http headers and to the<br>              response line. this is an extended regular expression, so<br>              parenthesis grouping is supported and no preliminary backslash<br>              is required. any space or known delimiter must be escaped using<br>              a backslash (‘\\’). the pattern applies to a full line at a time.<br>              the “rsprep” keyword strictly matches case while “rspirep”<br>              ignores case.</p>\n<pre><code>&lt;string&gt;  is the complete line to be added. any space or known delimiter\n          must be escaped using a backslash (&apos;\\&apos;). references to matched\n          pattern groups are possible using the common \\n form, with n\n          being a single digit between 0 and 9\\. please refer to section\n          6 about http header manipulation for more information.\n\n&lt;cond&gt;    is an optional matching condition built from acls. it makes it\n          possible to ignore this rule when other conditions are not met.\n</code></pre><p>  any line matching extended regular expression <search> in the response (both<br>  the response line and header lines) will be completely replaced with<br>  <string>. most common use of this is to rewrite location headers.</p>\n<p>  header transformations only apply to traffic which passes through haproxy,<br>  and not to traffic generated by haproxy, such as health-checks or error<br>  responses. note that for increased readability, it is suggested to add enough<br>  spaces between the request and the response. keep in mind that header names<br>  are not case-sensitive.</p>\n<p>  example :</p>\n<pre><code># replace &quot;location: 127.0.0.1:8080&quot; with &quot;location: www.mydomain.com&quot;\nrspirep ^location:\\ 127.0.0.1:8080    location:\\ www.mydomain.com\n</code></pre><p>  see also: “rspadd”, “rspdel”, “reqrep”, section 6 about http header<br>            manipulation, and section 7 about acls.</p>\n<p>server <name> <address>[:[port]] [param*]<br>  declare a server in a backend<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <name>    is the internal name assigned to this server. this name will<br>              appear in logs and alerts.  if “http-send-name-header” is<br>              set, it will be added to the request header sent to the server.</p>\n<pre><code>&lt;address&gt; is the ipv4 or ipv6 address of the server. alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up. address &quot;0.0.0.0&quot; or &quot;*&quot; has a special meaning.\n          it indicates that the connection will be forwarded to the same ip\n          address as the one from the client connection. this is useful in\n          transparent proxy architectures where the client&apos;s connection is\n          intercepted and haproxy must forward to the original destination\n          address. this is more or less what the &quot;transparent&quot; keyword does\n          except that with a server it&apos;s possible to limit concurrency and\n          to report statistics. optionally, an address family prefix may be\n          used before the address to force the family regardless of the\n          address format, which can be useful to specify a path to a unix\n          socket with no slash (&apos;/&apos;). currently supported prefixes are :\n                - &apos;ipv4@&apos;  -&gt; address is always ipv4\n                - &apos;ipv6@&apos;  -&gt; address is always ipv6\n                - &apos;unix@&apos;  -&gt; address is a path to a local unix socket\n                - &apos;abns@&apos;  -&gt; address is in abstract namespace (linux only)\n          you may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment\n          variables.\n\n&lt;port&gt;    is an optional port specification. if set, all connections will\n          be sent to this port. if unset, the same port the client\n          connected to will be used. the port may also be prefixed by a &quot;+&quot;\n          or a &quot;-&quot;. in this case, the server&apos;s port will be determined by\n          adding this value to the client&apos;s port.\n\n&lt;param*&gt;  is a list of parameters for this server. the &quot;server&quot; keywords\n          accepts an important number of options and has a complete section\n          dedicated to it. please refer to section 5 for more details.\n</code></pre><p>  examples :<br>        server first  10.1.1.1:1080 cookie first  check inter 1000<br>        server second 10.1.1.2:1080 cookie second check inter 1000<br>        server transp ipv4@<br>        server backup “${srv_backup}:1080” backup<br>        server www1_dc1 “${lan_dc1}.101:80”<br>        server www1_dc2 “${lan_dc2}.101:80”</p>\n<p>  see also: “default-server”, “http-send-name-header” and section 5 about<br>             server options</p>\n<p>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | client | clientip } ]<br>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]<br>source <addr>[:<port>] [interface <name>]<br>  set the source address for outgoing connections<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <addr>    is the ipv4 address haproxy will bind to before connecting to a<br>              server. this address is also used as a source for health checks.</p>\n<pre><code>          the default value of 0.0.0.0 means that the system will select\n          the most appropriate address to reach its destination. optionally\n          an address family prefix may be used before the address to force\n          the family regardless of the address format, which can be useful\n          to specify a path to a unix socket with no slash (&apos;/&apos;). currently\n          supported prefixes are :\n            - &apos;ipv4@&apos; -&gt; address is always ipv4\n            - &apos;ipv6@&apos; -&gt; address is always ipv6\n            - &apos;unix@&apos; -&gt; address is a path to a local unix socket\n            - &apos;abns@&apos; -&gt; address is in abstract namespace (linux only)\n          you may want to reference some environment variables in the address\n          parameter, see section 2.3 about environment variables.\n\n&lt;port&gt;    is an optional port. it is normally not needed but may be useful\n          in some very specific contexts. the default value of zero means\n          the system will select a free port. note that port ranges are not\n          supported in the backend. if you want to force port ranges, you\n          have to specify them on each &quot;server&quot; line.\n\n&lt;addr2&gt;   is the ip address to present to the server when connections are\n          forwarded in full transparent proxy mode. this is currently only\n          supported on some patched linux kernels. when this address is\n          specified, clients connecting to the server will be presented\n          with this address, while health checks will still use the address\n          &lt;addr&gt;.\n\n&lt;port2&gt;   is the optional port to present to the server when connections\n          are forwarded in full transparent proxy mode (see &lt;addr2&gt; above).\n          the default value of zero means the system will select a free\n          port.\n\n&lt;hdr&gt;     is the name of a http header in which to fetch the ip to bind to.\n          this is the name of a comma-separated header list which can\n          contain multiple ip addresses. by default, the last occurrence is\n          used. this is designed to work with the x-forwarded-for header\n          and to automatically bind to the client&apos;s ip address as seen\n          by previous proxy, typically stunnel. in order to use another\n          occurrence from the last one, please see the &lt;occ&gt; parameter\n          below. when the header (or occurrence) is not found, no binding\n          is performed so that the proxy&apos;s default ip address is used. also\n          keep in mind that the header name is case insensitive, as for any\n          http header.\n\n&lt;occ&gt;     is the occurrence number of a value to be used in a multi-value\n          header. this is to be used in conjunction with &quot;hdr_ip(&lt;hdr&gt;)&quot;,\n          in order to specify which occurrence to use for the source ip\n          address. positive values indicate a position from the first\n          occurrence, 1 being the first one. negative values indicate\n          positions relative to the last one, -1 being the last one. this\n          is helpful for situations where an x-forwarded-for header is set\n          at the entry point of an infrastructure and must be used several\n          proxy layers away. when this value is not specified, -1 is\n          assumed. passing a zero here disables the feature.\n\n&lt;name&gt;    is an optional interface name to which to bind to for outgoing\n          traffic. on systems supporting this features (currently, only\n          linux), this allows one to bind all traffic to the server to\n          this interface even if it is not the one the system would select\n          based on routing tables. this should be used with extreme care.\n          note that using this option requires root privileges.\n</code></pre><p>  the “source” keyword is useful in complex environments where a specific<br>  address only is allowed to connect to the servers. it may be needed when a<br>  private address must be used through a public gateway for instance, and it is<br>  known that the system cannot determine the adequate source address by itself.</p>\n<p>  an extension which is available on certain patched linux kernels may be used<br>  through the “usesrc” optional keyword. it makes it possible to connect to the<br>  servers with an ip address which does not belong to the system itself. this<br>  is called “full transparent proxy mode”. for this to work, the destination<br>  servers have to route their traffic back to this address through the machine<br>  running haproxy, and ip forwarding must generally be enabled on this machine.</p>\n<p>  in this “full transparent proxy” mode, it is possible to force a specific ip<br>  address to be presented to the servers. this is not much used in fact. a more<br>  common use is to tell haproxy to present the client’s ip address. for this,<br>  there are two methods :</p>\n<pre><code>- present the client&apos;s ip and port addresses. this is the most transparent\n  mode, but it can cause problems when ip connection tracking is enabled on\n  the machine, because a same connection may be seen twice with different\n  states. however, this solution presents the huge advantage of not\n  limiting the system to the 64k outgoing address+port couples, because all\n  of the client ranges may be used.\n\n- present only the client&apos;s ip address and select a spare port. this\n  solution is still quite elegant but slightly less transparent (downstream\n  firewalls logs will not match upstream&apos;s). it also presents the downside\n  of limiting the number of concurrent connections to the usual 64k ports.\n  however, since the upstream and downstream ports are different, local ip\n  connection tracking on the machine will not be upset by the reuse of the\n  same session.\n</code></pre><p>  note that depending on the transparent proxy technology used, it may be<br>  required to force the source address. in fact, cttproxy version 2 requires an<br>  ip address in <addr> above, and does not support setting of “0.0.0.0” as the<br>  ip address because it creates nat entries which much match the exact outgoing<br>  address. tproxy version 4 and some other kernel patches which work in pure<br>  forwarding mode generally will not have this limitation.</p>\n<p>  this option sets the default source for all servers in the backend. it may<br>  also be specified in a “defaults” section. finer source address specification<br>  is possible at the server level using the “source” server option. refer to<br>  section 5 for more information.</p>\n<p>  in order to work, “usesrc” requires root privileges.</p>\n<p>  examples :<br>        backend private</p>\n<pre><code>    # connect to the servers using our 192.168.1.200 source address\n    source 192.168.1.200\n\nbackend transparent_ssl1\n    # connect to the ssl farm from the client&apos;s source address\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_ssl2\n    # connect to the ssl farm from the client&apos;s source address and port\n    # not recommended if ip conntrack is present on the local machine.\n    source 192.168.1.200 usesrc client\n\nbackend transparent_ssl3\n    # connect to the ssl farm from the client&apos;s source address. it\n    # is more conntrack-friendly.\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_smtp\n    # connect to the smtp farm from the client&apos;s source address/port\n    # with tproxy version 4.\n    source 0.0.0.0 usesrc clientip\n\nbackend transparent_http\n    # connect to the servers using the client&apos;s ip as seen by previous\n    # proxy.\n    source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)\n</code></pre><p>  see also : the “source” server option in section 5, the tproxy patches for<br>             the linux kernel on www.balabit.com, the “bind” keyword.</p>\n<p>srvtimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the server side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase of the server’s response, when it has to send the<br>  headers, as it directly represents the server’s processing time for the<br>  request. to find out what value to put there, it’s often good to start with<br>  what would be considered as unacceptable response times, then check the logs<br>  to observe the response time distribution, and adjust the value accordingly.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. in tcp mode (and to a lesser extent, in http mode), it is highly<br>  recommended that the client timeout remains equal to the server timeout in<br>  order to avoid complex situations to debug. whatever the expected server<br>  response times, it is a good practice to cover at least one or several tcp<br>  packet losses by specifying timeouts that are slightly above multiples of 3<br>  seconds (eg: 4 or 5 seconds minimum).</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter is provided for compatibility but is currently deprecated.<br>  please use “timeout server” instead.</p>\n<p>  see also : “timeout server”, “timeout tunnel”, “timeout client” and<br>             “clitimeout”.</p>\n<p>stats admin { if | unless } <cond><br>  enable statistics admin level if/unless a condition is matched<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</p>\n<p>  this statement enables the statistics admin level if/unless a condition is<br>  matched.</p>\n<p>  the admin level allows to enable/disable servers from the web interface. by<br>  default, statistics page is read-only for security reasons.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  currently, the post request is limited to the buffer size minus the reserved<br>  buffer space, which means that if the list of servers is too long, the<br>  request won’t be processed. it is recommended to alter few servers at a<br>  time.</p>\n<p>  example :</p>\n<pre><code># statistics admin level only for localhost\nbackend stats_localhost\n    stats enable\n    stats admin if localhost\n</code></pre><p>  example :</p>\n<pre><code># statistics admin level always enabled because of the authentication\nbackend stats_auth\n    stats enable\n    stats auth  admin:admin123\n    stats admin if true\n</code></pre><p>  example :</p>\n<pre><code># statistics admin level depends on the authenticated user\nuserlist stats-auth\n    group admin    users admin\n    user  admin    insecure-password admin123\n    group readonly users haproxy\n    user  haproxy  insecure-password haproxy\n\nbackend stats_auth\n    stats enable\n    acl auth       http_auth(stats-auth)\n    acl auth_admin http_auth_group(stats-auth) admin\n    stats http-request auth unless auth\n    stats admin if auth_admin\n</code></pre><p>  see also : “stats enable”, “stats auth”, “stats http-request”, “nbproc”,<br>             “bind-process”, section 3.4 about userlists and section 7 about<br>             acl usage.</p>\n<p>stats auth <user>:<passwd><br>  enable statistics with authentication and grant access to an account<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <user>    is a user name to grant access to</p>\n<pre><code>&lt;passwd&gt;  is the cleartext password associated to this user\n</code></pre><p>  this statement enables statistics with default settings, and restricts access<br>  to declared users only. it may be repeated as many times as necessary to<br>  allow as many users as desired. when a user tries to access the statistics<br>  without a valid account, a “401 forbidden” response will be returned so that<br>  the browser asks the user to provide a valid user and password. the real<br>  which will be returned to the browser is configurable using “stats realm”.</p>\n<p>  since the authentication method is http basic authentication, the passwords<br>  circulate in cleartext on the network. thus, it was decided that the<br>  configuration file would also use cleartext passwords to remind the users<br>  that those ones should not be sensitive and not shared with any other account.</p>\n<p>  it is also possible to reduce the scope of the proxies which appear in the<br>  report using “stats scope”.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats enable”, “stats realm”, “stats scope”, “stats uri”</p>\n<p>stats enable<br>  enable statistics reporting with default settings<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  this statement enables statistics reporting with default settings defined<br>  at build time. unless stated otherwise, these settings are used :</p>\n<pre><code>- stats uri   : /haproxy?stats\n- stats realm : &quot;haproxy statistics&quot;\n- stats auth  : no authentication\n- stats scope : no restriction\n</code></pre><p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats realm”, “stats uri”</p>\n<p>stats hide-version<br>  enable statistics and hide haproxy version reporting<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  by default, the stats page reports some useful status information along with<br>  the statistics. among them is haproxy’s version. however, it is generally<br>  considered dangerous to report precise version to anyone, as it can help them<br>  target known weaknesses with specific attacks. the “stats hide-version”<br>  statement removes the version from the statistics report. this is recommended<br>  for public sites or any site with a weak login/password.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats http-request { allow | deny | auth [realm <realm>] }<br>             [ { if | unless } <condition> ]<br>  access control for statistics</p>\n<p>  may be used in sections:   defaults | frontend | listen | backend<br>                                no    |    no    |   yes  |   yes</p>\n<p>  as “http-request”, these set of options allow to fine control access to<br>  statistics. each option may be followed by if/unless and acl.<br>  first option with matched condition (or option without condition) is final.<br>  for “deny” a 403 error will be returned, for “allow” normal processing is<br>  performed, for “auth” a 401/407 error code is returned so the client<br>  should be asked to enter a username and password.</p>\n<p>  there is no fixed limit to the number of http-request statements per<br>  instance.</p>\n<p>  see also : “http-request”, section 3.4 about userlists and section 7<br>             about acl usage.</p>\n<p>stats realm <realm><br>  enable statistics and set authentication realm<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <realm>   is the name of the http basic authentication realm reported to<br>              the browser. the browser uses it to display it in the pop-up<br>              inviting the user to enter a valid username and password.</p>\n<p>  the realm is read as a single word, so any spaces in it should be escaped<br>  using a backslash (‘\\’).</p>\n<p>  this statement is useful only in conjunction with “stats auth” since it is<br>  only related to authentication.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats uri”</p>\n<p>stats refresh <delay><br>  enable statistics with automatic refresh<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <delay>   is the suggested refresh delay, specified in seconds, which will<br>              be returned to the browser consulting the report page. while the<br>              browser is free to apply any delay, it will generally respect it<br>              and refresh the page this every seconds. the refresh interval may<br>              be specified in any other non-default time unit, by suffixing the<br>              unit after the value, as explained at the top of this document.</p>\n<p>  this statement is useful on monitoring displays with a permanent page<br>  reporting the load balancer’s activity. when set, the html report page will<br>  include a link “refresh”/“stop refresh” so that the user can select whether<br>  he wants automatic refresh of the page or not.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats scope { <name> | “.” }<br>  enable statistics and limit access scope<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <name>    is the name of a listen, frontend or backend section to be<br>              reported. the special name “.” (a single dot) designates the<br>              section in which the statement appears.</p>\n<p>  when this statement is specified, only the sections enumerated with this<br>  statement will appear in the report. all other ones will be hidden. this<br>  statement may appear as many times as needed if multiple sections need to be<br>  reported. please note that the name checking is performed as simple string<br>  comparisons, and that it is never checked that a give section name really<br>  exists.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”, “stats uri”</p>\n<p>stats show-desc [ <desc> ]<br>  enable reporting of a description on the statistics page.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes</p>\n<pre><code>&lt;desc&gt;    is an optional description to be reported. if unspecified, the\n          description from global section is automatically used instead.\n</code></pre><p>  this statement is useful for users that offer shared services to their<br>  customers, where node or description should be different for each customer.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.  by default description is not shown.</p>\n<p>  example :</p>\n<pre><code># internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-desc master node for europe, asia, africa\n    stats uri       /admin?stats\n    stats refresh   5s\n</code></pre><p>  see also: “show-node”, “stats enable”, “stats uri” and “description” in<br>            global section.</p>\n<p>stats show-legends<br>  enable reporting additional information on the statistics page<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments : none</p>\n<p>  enable reporting additional information on the statistics page :</p>\n<pre><code>- cap: capabilities (proxy)\n- mode: one of tcp, http or health (proxy)\n- id: snmp id (proxy, socket, server)\n- ip (socket, server)\n- cookie (backend, server)\n</code></pre><p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.  default behaviour is not to show this information.</p>\n<p>  see also: “stats enable”, “stats uri”.</p>\n<p>stats show-node [ <name> ]<br>  enable reporting of a host name on the statistics page.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments:<br>    <name>    is an optional name to be reported. if unspecified, the<br>              node name from global section is automatically used instead.</p>\n<p>  this statement is useful for users that offer shared services to their<br>  customers, where node or description might be different on a stats page<br>  provided for each customer.  default behaviour is not to show host name.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example:</p>\n<pre><code># internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-node europe-1\n    stats uri       /admin?stats\n    stats refresh   5s\n</code></pre><p>  see also: “show-desc”, “stats enable”, “stats uri”, and “node” in global<br>            section.</p>\n<p>stats uri <prefix><br>  enable statistics and define the uri prefix to access them<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <prefix>  is the prefix of any uri which will be redirected to stats. this<br>              prefix may contain a question mark (‘?’) to indicate part of a<br>              query string.</p>\n<p>  the statistics uri is intercepted on the relayed traffic, so it appears as a<br>  page within the normal application. it is strongly advised to ensure that the<br>  selected uri will never appear in the application, otherwise it will never be<br>  possible to reach it in the application.</p>\n<p>  the default uri compiled in haproxy is “/haproxy?stats”, but this may be<br>  changed at build time, so it’s better to always explicitly specify it here.<br>  it is generally a good idea to include a question mark in the uri so that<br>  intermediate proxies refrain from caching the results. also, since any string<br>  beginning with the prefix will be accepted as a stats request, the question<br>  mark helps ensuring that no valid uri will begin with the same words.</p>\n<p>  it is sometimes very convenient to use “/“ as the uri prefix, and put that<br>  statement in a “listen” instance of its own. that makes it easy to dedicate<br>  an address or a port to statistics only.</p>\n<p>  though this statement alone is enough to enable statistics reporting, it is<br>  recommended to set all other settings in order to avoid relying on default<br>  unobvious parameters.</p>\n<p>  example :</p>\n<pre><code># public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   haproxy\\ statistics\n    stats auth    admin1:admin123\n    stats auth    admin2:admin321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n</code></pre><p>  see also : “stats auth”, “stats enable”, “stats realm”</p>\n<p>stick match <pattern> [table <table>] [{if | unless} <cond>]<br>  define a request pattern matching condition to stick a user to a server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the incoming request or connection<br>               will be analysed in the hope to find a matching entry in a<br>               stickiness table. this rule is mandatory.</p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional matching condition. it makes it possible to match\n           on a certain criterion only when other conditions are met (or\n           not met). for instance, it could be used to match on a source ip\n           address except when a request passes through a known proxy, in\n           which case we&apos;d match on a header containing that ip address.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick match” statement<br>  describes a rule to extract the stickiness criterion from an incoming request<br>  or connection. see section 7 for a complete list of possible patterns and<br>  transformation rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick match” statement<br>  will apply, using “if” or “unless” followed by a condition. see section 7 for<br>  acl based conditions.</p>\n<p>  there is no limit on the number of “stick match” statements. the first that<br>  applies and matches will cause the request to be directed to the same server<br>  as was used for the request which created the entry. that way, multiple<br>  matches can be used as fallbacks.</p>\n<p>  the stick rules are checked after the persistence cookies, so they will not<br>  affect stickiness if a cookie has already been used to select a server. that<br>  way, it becomes very easy to insert cookies and match on ip addresses in<br>  order to maintain stickiness between http and https.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :</p>\n<pre><code># forward smtp users to the same server they just used for pop in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n</code></pre><p>  see also : “stick-table”, “stick on”, “nbproc”, “bind-process” and section 7<br>             about acls and samples fetching.</p>\n<p>stick on <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern to associate a user to a server<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</p>\n<p>  note : this form is exactly equivalent to “stick match” followed by<br>         “stick store-request”, all with the same arguments. please refer<br>         to both keywords for details. it is only provided as a convenience<br>         for writing more maintainable configurations.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  examples :</p>\n<pre><code># the following form ...\nstick on src table pop if !localhost\n\n# ...is strictly equivalent to this one :\nstick match src table pop if !localhost\nstick store-request src table pop if !localhost\n\n# use cookie persistence for http, and stick on source address for https as\n# well as http without cookie. share the same table between both accesses.\nbackend http\n    mode http\n    balance roundrobin\n    stick on src table https\n    cookie srv insert indirect nocache\n    server s1 192.168.1.1:80 cookie s1\n    server s2 192.168.1.1:80 cookie s2\n\nbackend https\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 200k expire 30m\n    stick on src\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n</code></pre><p>  see also : “stick match”, “stick store-request”, “nbproc” and “bind-process”.</p>\n<p>stick store-request <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern used to create an entry in a stickiness table<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the incoming request or connection<br>               will be analysed, extracted and stored in the table once a<br>               server is selected.</p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional storage condition. it makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           for instance, it could be used to store the source ip address\n           except when the request passes through a known proxy, in which\n           case we&apos;d store a converted form of a header containing that ip\n           address.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick store-request” statement<br>  describes a rule to decide what to extract from the request and when to do<br>  it, in order to store it into a stickiness table for further requests to<br>  match it using the “stick match” statement. obviously the extracted part must<br>  make sense and have a chance to be matched in a further request. storing a<br>  client’s ip address for instance often makes sense. storing an id found in a<br>  url parameter also makes sense. storing a source port will almost never make<br>  any sense because it will be randomly matched. see section 7 for a complete<br>  list of possible patterns and transformation rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick store-request”<br>  statement will apply, using “if” or “unless” followed by a condition. this<br>  condition will be evaluated while parsing the request, so any criteria can be<br>  used. see section 7 for acl based conditions.</p>\n<p>  there is no limit on the number of “stick store-request” statements, but<br>  there is a limit of 8 simultaneous stores per request or response. this<br>  makes it possible to store up to 8 criteria, all extracted from either the<br>  request or the response, regardless of the number of rules. only the 8 first<br>  ones which match will be kept. using this, it is possible to feed multiple<br>  tables at once in the hope to increase the chance to recognize a user on<br>  another protocol or access method. using multiple store-request rules with<br>  the same table is possible and may be used to find the best criterion to rely<br>  on, by arranging the rules by decreasing preference order. only the first<br>  extracted criterion for a given table will be stored. all subsequent store-<br>  request rules referencing the same table will be skipped and their acls will<br>  not be evaluated.</p>\n<p>  the “store-request” rules are evaluated once the server connection has been<br>  established, so that the table will contain the real server that processed<br>  the request.</p>\n<p>  note : consider not using this feature in multi-process mode (nbproc &gt; 1)<br>         unless you know what you do : memory is not shared between the<br>         processes, which can result in random behaviours.</p>\n<p>  example :</p>\n<pre><code># forward smtp users to the same server they just used for pop in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n</code></pre><p>  see also : “stick-table”, “stick on”, “nbproc”, “bind-process” and section 7<br>             about acls and sample fetching.</p>\n<p>stick-table type {ip | integer | string [len <length>] | binary [len <length>]}<br>            size <size> [expire <expire>] [nopurge] [peers <peersect>]<br>            [store <data_type>]*<br>  configure the stickiness table for the current section<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes</p>\n<p>  arguments :<br>    ip         a table declared with “type ip” will only store ipv4 addresses.<br>               this form is very compact (about 50 bytes per entry) and allows<br>               very fast entry lookup and stores with almost no overhead. this<br>               is mainly used to store client source ip addresses.</p>\n<pre><code>ipv6       a table declared with &quot;type ipv6&quot; will only store ipv6 addresses.\n           this form is very compact (about 60 bytes per entry) and allows\n           very fast entry lookup and stores with almost no overhead. this\n           is mainly used to store client source ip addresses.\n\ninteger    a table declared with &quot;type integer&quot; will store 32bit integers\n           which can represent a client identifier found in a request for\n           instance.\n\nstring     a table declared with &quot;type string&quot; will store substrings of up\n           to &lt;len&gt; characters. if the string provided by the pattern\n           extractor is larger than &lt;len&gt;, it will be truncated before\n           being stored. during matching, at most &lt;len&gt; characters will be\n           compared between the string in the table and the extracted\n           pattern. when not specified, the string is automatically limited\n           to 32 characters.\n\nbinary     a table declared with &quot;type binary&quot; will store binary blocks\n           of &lt;len&gt; bytes. if the block provided by the pattern\n           extractor is larger than &lt;len&gt;, it will be truncated before\n           being stored. if the block provided by the sample expression\n           is shorter than &lt;len&gt;, it will be padded by 0\\. when not\n           specified, the block is automatically limited to 32 bytes.\n\n&lt;length&gt;   is the maximum number of characters that will be stored in a\n           &quot;string&quot; type table (see type &quot;string&quot; above). or the number\n           of bytes of the block in &quot;binary&quot; type table. be careful when\n           changing this parameter as memory usage will proportionally\n           increase.\n\n&lt;size&gt;     is the maximum number of entries that can fit in the table. this\n           value directly impacts memory usage. count approximately\n           50 bytes per entry, plus the size of a string if any. the size\n           supports suffixes &quot;k&quot;, &quot;m&quot;, &quot;g&quot; for 2^10, 2^20 and 2^30 factors.\n\n[nopurge]  indicates that we refuse to purge older entries when the table\n           is full. when not specified and the table is full when haproxy\n           wants to store an entry in it, it will flush a few of the oldest\n           entries in order to release some space for the new ones. this is\n           most often the desired behaviour. in some specific cases, it\n           be desirable to refuse new entries instead of purging the older\n           ones. that may be the case when the amount of data to store is\n           far above the hardware limits and we prefer not to offer access\n           to new clients than to reject the ones already connected. when\n           using this parameter, be sure to properly set the &quot;expire&quot;\n           parameter (see below).\n\n&lt;peersect&gt; is the name of the peers section to use for replication. entries\n           which associate keys to server ids are kept synchronized with\n           the remote peers declared in this section. all entries are also\n           automatically learned from the local peer (old process) during a\n           soft restart.\n\n           note : each peers section may be referenced only by tables\n                  belonging to the same unique process.\n\n&lt;expire&gt;   defines the maximum duration of an entry in the table since it\n           was last created, refreshed or matched. the expiration delay is\n           defined using the standard time format, similarly as the various\n           timeouts. the maximum duration is slightly above 24 days. see\n           section 2.2 for more information. if this delay is not specified,\n           the session won&apos;t automatically expire, but older entries will\n           be removed once full. be sure not to use the &quot;nopurge&quot; parameter\n           if not expiration delay is specified.\n</code></pre><p>   <data_type> is used to store additional information in the stick-table. this<br>               may be used by acls in order to control various criteria related<br>               to the activity of the client matching the stick-table. for each<br>               item specified here, the size of each entry will be inflated so<br>               that the additional data can fit. several data types may be<br>               stored with an entry. multiple data types may be specified after<br>               the “store” keyword, as a comma-separated list. alternatively,<br>               it is possible to repeat the “store” keyword followed by one or<br>               several data types. except for the “server_id” type which is<br>               automatically detected and enabled, all data types must be<br>               explicitly declared to be stored. if an acl references a data<br>               type which is not stored, the acl will simply not match. some<br>               data types require an argument which must be passed just after<br>               the type between parenthesis. see below for the supported data<br>               types and their arguments.</p>\n<p>  the data types that can be stored with an entry are the following :</p>\n<pre><code>- server_id : this is an integer which holds the numeric id of the server a\n  request was assigned to. it is used by the &quot;stick match&quot;, &quot;stick store&quot;,\n  and &quot;stick on&quot; rules. it is automatically enabled when referenced.\n\n- gpc0 : first general purpose counter. it is a positive 32-bit integer\n  integer which may be used for anything. most of the time it will be used\n  to put a special tag on some entries, for instance to note that a\n  specific behaviour was detected and must be known for future matches.\n\n- gpc0_rate(&lt;period&gt;) : increment rate of the first general purpose counter\n  over a period. it is a positive 32-bit integer integer which may be used\n  for anything. just like &lt;gpc0&gt;, it counts events, but instead of keeping\n  a cumulative count, it maintains the rate at which the counter is\n  incremented. most of the time it will be used to measure the frequency of\n  occurrence of certain events (eg: requests to a specific url).\n\n- conn_cnt : connection count. it is a positive 32-bit integer which counts\n  the absolute number of connections received from clients which matched\n  this entry. it does not mean the connections were accepted, just that\n  they were received.\n\n- conn_cur : current connections. it is a positive 32-bit integer which\n  stores the concurrent connection counts for the entry. it is incremented\n  once an incoming connection matches the entry, and decremented once the\n  connection leaves. that way it is possible to know at any time the exact\n  number of concurrent connections for an entry.\n\n- conn_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming connection rate over that period, in connections per period. the\n  result is an integer which can be matched using acls.\n\n- sess_cnt : session count. it is a positive 32-bit integer which counts\n  the absolute number of sessions received from clients which matched this\n  entry. a session is a connection that was accepted by the layer 4 rules.\n\n- sess_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming session rate over that period, in sessions per period. the\n  result is an integer which can be matched using acls.\n\n- http_req_cnt : http request count. it is a positive 32-bit integer which\n  counts the absolute number of http requests received from clients which\n  matched this entry. it does not matter whether they are valid requests or\n  not. note that this is different from sessions when keep-alive is used on\n  the client side.\n\n- http_req_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  http request rate over that period, in requests per period. the result is\n  an integer which can be matched using acls. it does not matter whether\n  they are valid requests or not. note that this is different from sessions\n  when keep-alive is used on the client side.\n\n- http_err_cnt : http error count. it is a positive 32-bit integer which\n  counts the absolute number of http requests errors induced by clients\n  which matched this entry. errors are counted on invalid and truncated\n  requests, as well as on denied or tarpitted requests, and on failed\n  authentications. if the server responds with 4xx, then the request is\n  also counted as an error since it&apos;s an error triggered by the client\n  (eg: vulnerability scan).\n\n- http_err_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  http request error rate over that period, in requests per period (see\n  http_err_cnt above for what is accounted as an error). the result is an\n  integer which can be matched using acls.\n\n- bytes_in_cnt : client to server byte count. it is a positive 64-bit\n  integer which counts the cumulated amount of bytes received from clients\n  which matched this entry. headers are included in the count. this may be\n  used to limit abuse of upload features on photo or video servers.\n\n- bytes_in_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes an\n  integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  incoming bytes rate over that period, in bytes per period. it may be used\n  to detect users which upload too much and too fast. warning: with large\n  uploads, it is possible that the amount of uploaded data will be counted\n  once upon termination, thus causing spikes in the average transfer speed\n  instead of having a smooth one. this may partially be smoothed with\n  &quot;option contstats&quot; though this is not perfect yet. use of byte_in_cnt is\n  recommended for better fairness.\n\n- bytes_out_cnt : server to client byte count. it is a positive 64-bit\n  integer which counts the cumulated amount of bytes sent to clients which\n  matched this entry. headers are included in the count. this may be used\n  to limit abuse of bots sucking the whole site.\n\n- bytes_out_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). it takes\n  an integer parameter &lt;period&gt; which indicates in milliseconds the length\n  of the period over which the average is measured. it reports the average\n  outgoing bytes rate over that period, in bytes per period. it may be used\n  to detect users which download too much and too fast. warning: with large\n  transfers, it is possible that the amount of transferred data will be\n  counted once upon termination, thus causing spikes in the average\n  transfer speed instead of having a smooth one. this may partially be\n  smoothed with &quot;option contstats&quot; though this is not perfect yet. use of\n  byte_out_cnt is recommended for better fairness.\n</code></pre><p>  there is only one stick-table per proxy. at the moment of writing this doc,<br>  it does not seem useful to have multiple tables per proxy. if this happens<br>  to be required, simply create a dummy backend with a stick-table in it and<br>  reference it.</p>\n<p>  it is important to understand that stickiness based on learning information<br>  has some limitations, including the fact that all learned associations are<br>  lost upon restart. in general it can be good as a complement but not always<br>  as an exclusive stickiness.</p>\n<p>  last, memory requirements may be important when storing many data types.<br>  indeed, storing all indicators above at once in each entry requires 116 bytes<br>  per entry, or 116 mb for a 1-million entries table. this is definitely not<br>  something that can be ignored.</p>\n<p>  example:</p>\n<pre><code># keep track of counters of up to 1 million ip addresses over 5 minutes\n# and store a general purpose counter and the average connection rate\n# computed over a sliding window of 30 seconds.\nstick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)\n</code></pre><p>  see also : “stick match”, “stick on”, “stick store-request”, section 2.2<br>             about time format and section 7 about acls.</p>\n<p>stick store-response <pattern> [table <table>] [{if | unless} <condition>]<br>  define a request pattern used to create an entry in a stickiness table<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <pattern>  is a sample expression rule as described in section 7.3. it<br>               describes what elements of the response or connection will<br>               be analysed, extracted and stored in the table once a<br>               server is selected.</p>\n<pre><code>&lt;table&gt;    is an optional stickiness table name. if unspecified, the same\n           backend&apos;s table is used. a stickiness table is declared using\n           the &quot;stick-table&quot; statement.\n\n&lt;cond&gt;     is an optional storage condition. it makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           for instance, it could be used to store the ssl session id only\n           when the response is a ssl server hello.\n</code></pre><p>  some protocols or applications require complex stickiness rules and cannot<br>  always simply rely on cookies nor hashing. the “stick store-response”<br>  statement  describes a rule to decide what to extract from the response and<br>  when to do it, in order to store it into a stickiness table for further<br>  requests to match it using the “stick match” statement. obviously the<br>  extracted part must make sense and have a chance to be matched in a further<br>  request. storing an id found in a header of a response makes sense.<br>  see section 7 for a complete list of possible patterns and transformation<br>  rules.</p>\n<p>  the table has to be declared using the “stick-table” statement. it must be of<br>  a type compatible with the pattern. by default it is the one which is present<br>  in the same backend. it is possible to share a table with other backends by<br>  referencing it using the “table” keyword. if another table is referenced,<br>  the server’s id inside the backends are used. by default, all server ids<br>  start at 1 in each backend, so the server ordering is enough. but in case of<br>  doubt, it is highly recommended to force server ids using their “id” setting.</p>\n<p>  it is possible to restrict the conditions where a “stick store-response”<br>  statement will apply, using “if” or “unless” followed by a condition. this<br>  condition will be evaluated while parsing the response, so any criteria can<br>  be used. see section 7 for acl based conditions.</p>\n<p>  there is no limit on the number of “stick store-response” statements, but<br>  there is a limit of 8 simultaneous stores per request or response. this<br>  makes it possible to store up to 8 criteria, all extracted from either the<br>  request or the response, regardless of the number of rules. only the 8 first<br>  ones which match will be kept. using this, it is possible to feed multiple<br>  tables at once in the hope to increase the chance to recognize a user on<br>  another protocol or access method. using multiple store-response rules with<br>  the same table is possible and may be used to find the best criterion to rely<br>  on, by arranging the rules by decreasing preference order. only the first<br>  extracted criterion for a given table will be stored. all subsequent store-<br>  response rules referencing the same table will be skipped and their acls will<br>  not be evaluated. however, even if a store-request rule references a table, a<br>  store-response rule may also use the same table. this means that each table<br>  may learn exactly one element from the request and one element from the<br>  response at once.</p>\n<p>  the table will contain the real server that processed the request.</p>\n<p>  example :</p>\n<pre><code># learn ssl session id from both request and response and create affinity.\nbackend https\n    mode tcp\n    balance roundrobin\n    # maximum ssl session id length is 32 bytes.\n    stick-table type binary len 32 size 30k expire 30m\n\n    acl clienthello req_ssl_hello_type 1\n    acl serverhello rep_ssl_hello_type 2\n\n    # use tcp content accepts to detects ssl client and server hello.\n    tcp-request inspect-delay 5s\n    tcp-request content accept if clienthello\n\n    # no timeout on response inspect delay by default.\n    tcp-response content accept if serverhello\n\n    # ssl session id (sslid) may be present on a client or server hello.\n    # its length is coded on 1 byte at offset 43 and its value starts\n    # at offset 44.\n\n    # match and learn on request if client hello.\n    stick on payload_lv(43,1) if clienthello\n\n    # learn on response if server hello.\n    stick store-response payload_lv(43,1) if serverhello\n\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n</code></pre><p>  see also : “stick-table”, “stick on”, and section 7 about acls and pattern<br>             extraction.</p>\n<p>tcp-check connect [params*]<br>  opens a new connection<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</p>\n<p>  when an application lies on more than a single tcp port or when haproxy<br>  load-balance many services in a single backend, it makes sense to probe all<br>  the services individually before considering a server as operational.</p>\n<p>  when there are no tcp port configured on the server line neither server port<br>  directive, then the ‘tcp-check connect port <port>‘ must be the first step<br>  of the sequence.</p>\n<p>  in a tcp-check ruleset a ‘connect’ is required, it is also mandatory to start<br>  the ruleset with a ‘connect’ rule. purpose is to ensure admin know what they<br>  do.</p>\n<p>  parameters :<br>    they are optional and can be used to describe how haproxy should open and<br>    use the tcp connection.</p>\n<pre><code>port      if not set, check port or server port is used.\n          it tells haproxy where to open the connection to.\n          &lt;port&gt; must be a valid tcp port source integer, from 1 to 65535.\n\nsend-proxy   send a proxy protocol string\n\nssl          opens a ciphered connection\n\nexamples:\n     # check http and https services on a server.\n     # first open port 80 thanks to server line port directive, then\n     # tcp-check opens port 443, ciphered and run a request on it:\n     option tcp-check\n     tcp-check connect\n     tcp-check send get\\ /\\ http/1.0\\r\\n\n     tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n     tcp-check send \\r\\n\n     tcp-check expect rstring (2..|3..)\n     tcp-check connect port 443 ssl\n     tcp-check send get\\ /\\ http/1.0\\r\\n\n     tcp-check send host:\\ haproxy.1wt.eu\\r\\n\n     tcp-check send \\r\\n\n     tcp-check expect rstring (2..|3..)\n     server www 10.0.0.1 check port 80\n\n     # check both pop and imap from a single server:\n     option tcp-check\n     tcp-check connect port 110\n     tcp-check expect string +ok\\ pop3\\ ready\n     tcp-check connect port 143\n     tcp-check expect string *\\ ok\\ imap4\\ ready\n     server mail 10.0.0.1 check\n</code></pre><p>  see also : “option tcp-check”, “tcp-check send”, “tcp-check expect”</p>\n<p>tcp-check expect [!] <match> <pattern><br>  specify data to be collected and analysed during a generic health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</p>\n<p>  arguments :<br>    <match>   is a keyword indicating how to look for a specific pattern in the<br>              response. the keyword may be one of “string”, “rstring” or<br>              binary.<br>              the keyword may be preceded by an exclamation mark (“!”) to negate<br>              the match. spaces are allowed between the exclamation mark and the<br>              keyword. see below for more details on the supported keywords.</p>\n<pre><code>&lt;pattern&gt; is the pattern to look for. it may be a string or a regular\n          expression. if the pattern contains spaces, they must be escaped\n          with the usual backslash (&apos;\\&apos;).\n          if the match is set to binary, then the pattern must be passed as\n          a serie of hexadecimal digits in an even number. each sequence of\n          two digits will represent a byte. the hexadecimal digits may be\n          used upper or lower case.\n</code></pre><p>  the available matches are intentionally similar to their http-check cousins :</p>\n<pre><code>string &lt;string&gt; : test the exact string matches in the response buffer.\n                  a health check response will be considered valid if the\n                  response&apos;s buffer contains this exact string. if the\n                  &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body contains this\n                  string. this can be used to look for a mandatory pattern\n                  in a protocol response, or to detect a failure when a\n                  specific error appears in a protocol banner.\n\nrstring &lt;regex&gt; : test a regular expression on the response buffer.\n                  a health check response will be considered valid if the\n                  response&apos;s buffer matches this expression. if the\n                  &quot;rstring&quot; keyword is prefixed with &quot;!&quot;, then the response\n                  will be considered invalid if the body matches the\n                  expression.\n\nbinary &lt;hexstring&gt; : test the exact string in its hexadecimal form matches\n                     in the response buffer. a health check response will\n                     be considered valid if the response&apos;s buffer contains\n                     this exact hexadecimal string.\n                     purpose is to match data on binary protocols.\n</code></pre><p>  it is important to note that the responses will be limited to a certain size<br>  defined by the global “tune.chksize” option, which defaults to 16384 bytes.<br>  thus, too large responses may not contain the mandatory pattern when using<br>  “string”, “rstring” or binary. if a large response is absolutely required, it<br>  is possible to change the default max size by setting the global variable.<br>  however, it is worth keeping in mind that parsing very large responses can<br>  waste some cpu cycles, especially when regular expressions are used, and that<br>  it is always better to focus the checks on smaller resources. also, in its<br>  current state, the check will not find any string nor regex past a null<br>  character in the response. similarly it is not possible to request matching<br>  the null character.</p>\n<p>  examples :</p>\n<pre><code># perform a pop check\noption tcp-check\ntcp-check expect string +ok\\ pop3\\ ready\n\n# perform an imap check\noption tcp-check\ntcp-check expect string *\\ ok\\ imap4\\ ready\n\n# look for the redis master server\noption tcp-check\ntcp-check send ping\\r\\n\ntcp-check expect +pong\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check send quit\\r\\n\ntcp-check expect string +ok\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check send”,<br>             “tcp-check send-binary”, “http-check expect”, tune.chksize</p>\n<p>tcp-check send <data><br>  specify a string to be sent as a question during a generic health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</p>\n<pre><code>&lt;data&gt; : the data to be sent as a question during a generic health check\n         session. for now, &lt;data&gt; must be a string.\n</code></pre><p>  examples :</p>\n<pre><code># look for the redis master server\noption tcp-check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check expect”,<br>             “tcp-check send-binary”, tune.chksize</p>\n<p>tcp-check send-binary <hexastring><br>  specify an hexa digits string to be sent as a binary question during a raw<br>  tcp health check<br>  may be used in sections:   defaults | frontend | listen | backend<br>                               no     |    no    |   yes  |   yes</p>\n<pre><code>&lt;data&gt; : the data to be sent as a question during a generic health check\n         session. for now, &lt;data&gt; must be a string.\n&lt;hexastring&gt; : test the exact string in its hexadecimal form matches in the\n               response buffer. a health check response will be considered\n               valid if the response&apos;s buffer contains this exact\n               hexadecimal string.\n               purpose is to send binary data to ask on binary protocols.\n</code></pre><p>  examples :</p>\n<pre><code># redis check in binary\noption tcp-check\ntcp-check send-binary 50494e470d0a # ping\\r\\n\ntcp-check expect binary 2b504f4e47 # +pong\n</code></pre><p>  see also : “option tcp-check”, “tcp-check connect”, “tcp-check expect”,<br>             “tcp-check send”, tune.chksize</p>\n<p>tcp-request connection <action> [{if | unless} <condition>]<br>  perform an action on an incoming connection depending on a layer 4 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   no<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “reject”, “track-sc0”, “track-sc1”,<br>                “track-sc2”, and “expect-proxy”. see below for more details.</p>\n<pre><code>&lt;condition&gt; is a standard layer4-only acl-based condition (see section 7).\n</code></pre><p>  immediately after acceptance of a new incoming connection, it is possible to<br>  evaluate some conditions to decide whether this connection must be accepted<br>  or dropped or have its counters tracked. those conditions cannot make use of<br>  any data contents because the connection has not been read from yet, and the<br>  buffers are not yet allocated. this is used to selectively and very quickly<br>  accept or drop connections from various sources with a very low overhead. if<br>  some contents need to be inspected in order to take the decision, the<br>  “tcp-request content” statements must be used instead.</p>\n<p>  the “tcp-request connection” rules are evaluated in their exact declaration<br>  order. if no rule matches or if there is no rule, the default action is to<br>  accept the incoming connection. there is no specific limit to the number of<br>  rules which may be inserted.</p>\n<p>  four types of actions are supported :</p>\n<pre><code>- accept :\n    accepts the connection if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation.\n\n- reject :\n    rejects the connection if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation. rejected connections do not even become a\n    session, which is why they are accounted separately for in the stats,\n    as &quot;denied connections&quot;. they are not considered for the session\n    rate-limit and are not logged either. the reason is that these rules\n    should only be used to filter extremely high connection rates such as\n    the ones encountered during a massive ddos attack. under these extreme\n    conditions, the simple action of logging each event would make the\n    system collapse and would considerably lower the filtering capacity. if\n    logging is absolutely desired, then &quot;tcp-request content&quot; rules should\n    be used instead.\n\n- expect-proxy layer4 :\n    configures the client-facing connection to receive a proxy protocol\n    header before any byte is read from the socket. this is equivalent to\n    having the &quot;accept-proxy&quot; keyword on the &quot;bind&quot; line, except that using\n    the tcp rule allows the proxy protocol to be accepted only for certain\n    ip address ranges using an acl. this is convenient when multiple layers\n    of load balancers are passed through by traffic coming from public\n    hosts.\n\n- capture &lt;sample&gt; len &lt;length&gt; :\n    this only applies to &quot;tcp-request content&quot; rules. it captures sample\n    expression &lt;sample&gt; from the request buffer, and converts it to a\n    string of at most &lt;len&gt; characters. the resulting string is stored into\n    the next request &quot;capture&quot; slot, so it will possibly appear next to\n    some captured http headers. it will then automatically appear in the\n    logs, and it will be possible to extract it using sample fetch rules to\n    feed it into headers or anything. the length should be limited given\n    that this size will be allocated for each capture during the whole\n    session life. please check section 7.3 (fetching samples) and &quot;capture\n    request header&quot; for more information.\n\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;] :\n    enables tracking of sticky counters from current connection. these\n    rules do not stop evaluation and do not change default action. 3 sets\n    of counters may be simultaneously tracked by the same connection. the\n    first &quot;track-sc0&quot; rule executed enables tracking of the counters of the\n    specified table as the first set. the first &quot;track-sc1&quot; rule executed\n    enables tracking of the counters of the specified table as the second\n    set. the first &quot;track-sc2&quot; rule executed enables tracking of the\n    counters of the specified table as the third set. it is a recommended\n    practice to use the first set of counters for the per-frontend counters\n    and the second set for the per-backend ones. but this is just a\n    guideline, all may be used everywhere.\n\n    these actions take one or two arguments :\n      &lt;key&gt;   is mandatory, and is a sample expression rule as described\n              in section 7.3\\. it describes what elements of the incoming\n              request or connection will be analysed, extracted, combined,\n              and used to select which table entry to update the counters.\n              note that &quot;tcp-request connection&quot; cannot use content-based\n              fetches.\n\n     &lt;table&gt;  is an optional table to be used instead of the default one,\n              which is the stick-table declared in the current proxy. all\n              the counters for the matches and updates for the key will\n              then be performed in that table until the session ends.\n\n    once a &quot;track-sc*&quot; rule is executed, the key is looked up in the table\n    and if it is not found, an entry is allocated for it. then a pointer to\n    that entry is kept during all the session&apos;s life, and this entry&apos;s\n    counters are updated as often as possible, every time the session&apos;s\n    counters are updated, and also systematically when the session ends.\n    counters are only updated for events that happen after the tracking has\n    been started. for example, connection counters will not be updated when\n    tracking layer 7 information, since the connection event happens before\n    layer7 information is extracted.\n\n    if the entry tracks concurrent connection counters, one connection is\n    counted for as long as the entry is tracked, and the entry will not\n    expire during that time. tracking counters also provides a performance\n    advantage over just checking the keys, because only one table lookup is\n    performed for all acl checks that make use of it.\n</code></pre><p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  “track-sc*” actions as well as for changing the default action to a reject.</p>\n<p>  example: accept all connections from white-listed hosts, reject too fast<br>           connection without counting them, and track accepted connections.<br>           this results in connection rate being capped from abusive sources.</p>\n<pre><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection reject if { src_conn_rate gt 10 }\ntcp-request connection track-sc0 src\n</code></pre><p>  example: accept all connections from white-listed hosts, count all other<br>           connections and reject too fast ones. this results in abusive ones<br>           being blocked as long as they don’t slow down.</p>\n<pre><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection track-sc0 src\ntcp-request connection reject if { sc0_conn_rate gt 10 }\n</code></pre><p>  example: enable the proxy protocol for traffic coming from all known proxies.</p>\n<pre><code>tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request content”, “stick-table”</p>\n<p>tcp-request content <action> [{if | unless} <condition>]<br>  perform an action on a new session depending on a layer 4-7 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “reject”, “track-sc0”, “track-sc1”,<br>                “track-sc2”, “capture” and “lua”. see “tcp-request connection”<br>                above for their signification.</p>\n<pre><code>&lt;condition&gt; is a standard layer 4-7 acl-based condition (see section 7).\n</code></pre><p>  a request’s contents can be analysed at an early stage of request processing<br>  called “tcp content inspection”. during this stage, acl-based rules are<br>  evaluated every time the request contents are updated, until either an<br>  “accept” or a “reject” rule matches, or the tcp request inspection delay<br>  expires with no matching rule.</p>\n<p>  the first difference between these rules and “tcp-request connection” rules<br>  is that “tcp-request content” rules can make use of contents to take a<br>  decision. most often, these decisions will consider a protocol recognition or<br>  validity. the second difference is that content-based rules can be used in<br>  both frontends and backends. in case of http keep-alive with the client, all<br>  tcp-request content rules are evaluated again, so haproxy keeps a record of<br>  what sticky counters were assigned by a “tcp-request connection” versus a<br>  “tcp-request content” rule, and flushes all the content-related ones after<br>  processing an http request, so that they may be evaluated again by the rules<br>  being evaluated again for the next request. this is of particular importance<br>  when the rule tracks some l7 information or when it is conditioned by an<br>  l7-based acl, since tracking may change between requests.</p>\n<p>  content-based rules are evaluated in their exact declaration order. if no<br>  rule matches or if there is no rule, the default action is to accept the<br>  contents. there is no specific limit to the number of rules which may be<br>  inserted.</p>\n<p>  four types of actions are supported :</p>\n<pre><code>- accept : the request is accepted\n- reject : the request is rejected and the connection is closed\n- capture : the specified sample expression is captured\n- { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;]\n- lua &lt;function&gt;\n- set-var(&lt;var-name&gt;) &lt;expr&gt;\n</code></pre><p>  they have the same meaning as their counter-parts in “tcp-request connection”<br>  so please refer to that section for a complete description.</p>\n<p>  while there is nothing mandatory about it, it is recommended to use the<br>  track-sc0 in “tcp-request connection” rules, track-sc1 for “tcp-request<br>  content” rules in the frontend, and track-sc2 for “tcp-request content”<br>  rules in the backend, because that makes the configuration more readable<br>  and easier to troubleshoot, but this is just a guideline and all counters<br>  may be used everywhere.</p>\n<p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  “track-sc*” actions as well as for changing the default action to a reject.</p>\n<p>  it is perfectly possible to match layer 7 contents with “tcp-request content”<br>  rules, since http-specific acl matches are able to preliminarily parse the<br>  contents of a buffer before extracting the required data. if the buffered<br>  contents do not parse as a valid http message, then the acl does not match.<br>  the parser which is involved there is exactly the same as for all other http<br>  processing, so there is no risk of parsing something differently. in an http<br>  backend connected to from an http frontend, it is guaranteed that http<br>  contents will always be immediately present when the rule is evaluated first.</p>\n<p>  tracking layer7 information is also possible provided that the information<br>  are present when the rule is processed. the rule processing engine is able to<br>  wait until the inspect delay expires when the data to be tracked is not yet<br>  available.</p>\n<p>  the “lua” keyword is followed by a lua function name. it is used to run a lua<br>  function if the action is executed. the single parameter is the name of the<br>  function to run. the prototype of the function is documented in the api<br>  documentation.</p>\n<p>  the “set-var” is used to set the content of a variable. the variable is<br>  declared inline.</p>\n<pre><code>&lt;var-name&gt; the name of the variable starts by an indication about its scope.\n           the allowed scopes are:\n             &quot;sess&quot; : the variable is shared with all the session,\n             &quot;txn&quot;  : the variable is shared with all the transaction\n                      (request and response)\n             &quot;req&quot;  : the variable is shared only during the request\n                      processing\n             &quot;res&quot;  : the variable is shared only during the response\n                      processing.\n           this prefix is followed by a name. the separator is a &apos;.&apos;.\n           the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos; and &apos;_&apos;.\n\n&lt;expr&gt;     is a standard haproxy expression formed by a sample-fetch\n           followed by some converters.\n</code></pre><p>  example:</p>\n<pre><code>tcp-request content set-var(sess.my_var) src\n</code></pre><p>  example:</p>\n<pre><code># accept http requests containing a host header saying &quot;example.com&quot;\n# and reject everything else.\nacl is_host_com hdr(host) -i example.com\ntcp-request inspect-delay 30s\ntcp-request content accept if is_host_com\ntcp-request content reject\n</code></pre><p>  example:</p>\n<pre><code># reject smtp connection if client speaks first\ntcp-request inspect-delay 30s\nacl content_present req_len gt 0\ntcp-request content reject if content_present\n\n# forward https connection only if client speaks\ntcp-request inspect-delay 30s\nacl content_present req_len gt 0\ntcp-request content accept if content_present\ntcp-request content reject\n</code></pre><p>  example:</p>\n<pre><code># track the last ip from x-forwarded-for\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 hdr(x-forwarded-for,-1)\n</code></pre><p>  example:</p>\n<pre><code># track request counts per &quot;base&quot; (concatenation of host+url)\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 base table req-rate\n</code></pre><p>  example: track per-frontend and per-backend counters, block abusers at the<br>           frontend when the backend detects abuse.</p>\n<pre><code>frontend http\n    # use general purpose couter 0 in sc0 as a global abuse counter\n    # protecting all our sites\n    stick-table type ip size 1m expire 5m store gpc0\n    tcp-request connection track-sc0 src\n    tcp-request connection reject if { sc0_get_gpc0 gt 0 }\n    ...\n    use_backend http_dynamic if { path_end .php }\n\nbackend http_dynamic\n    # if a source makes too fast requests to this dynamic site (tracked\n    # by sc1), block it globally in the frontend.\n    stick-table type ip size 1m expire 5m store http_req_rate(10s)\n    acl click_too_fast sc1_http_req_rate gt 10\n    acl mark_as_abuser sc0_inc_gpc0 gt 0\n    tcp-request content track-sc1 src\n    tcp-request content reject if click_too_fast mark_as_abuser\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request connection”, “tcp-request inspect-delay”</p>\n<p>tcp-request inspect-delay <timeout><br>  set the maximum allowed time to wait for data during content inspection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  people using haproxy primarily as a tcp relay are often worried about the<br>  risk of passing any type of protocol to a server without any analysis. in<br>  order to be able to analyze the request contents, we must first withhold<br>  the data then analyze them. this statement simply enables withholding of<br>  data for at most the specified amount of time.</p>\n<p>  tcp content inspection applies very early when a connection reaches a<br>  frontend, then very early when the connection is forwarded to a backend. this<br>  means that a connection may experience a first delay in the frontend and a<br>  second delay in the backend if both have tcp-request rules.</p>\n<p>  note that when performing content inspection, haproxy will evaluate the whole<br>  rules for every new chunk which gets in, taking into account the fact that<br>  those data are partial. if no rule matches before the aforementioned delay,<br>  a last check is performed upon expiration, this time considering that the<br>  contents are definitive. if no delay is set, haproxy will not wait at all<br>  and will immediately apply a verdict based on the available information.<br>  obviously this is unlikely to be very useful and might even be racy, so such<br>  setups are not recommended.</p>\n<p>  as soon as a rule matches, the request is released and continues as usual. if<br>  the timeout is reached and no rule matches, the default policy will be to let<br>  it pass through unaffected.</p>\n<p>  for most protocols, it is enough to set it to a few seconds, as most clients<br>  send the full request immediately upon connection. add 3 or more seconds to<br>  cover tcp retransmits but that’s all. for some protocols, it may make sense<br>  to use large values, for instance to ensure that the client never talks<br>  before the server (eg: smtp), or to wait for a client to talk before passing<br>  data to the server (eg: ssl). note that the client timeout must cover at<br>  least the inspection delay, otherwise it will expire first. if the client<br>  closes the connection or if the buffer is full, the delay immediately expires<br>  since the contents will not be able to change anymore.</p>\n<p>  see also : “tcp-request content accept”, “tcp-request content reject”,<br>             “timeout client”.</p>\n<p>tcp-response content <action> [{if | unless} <condition>]<br>  perform an action on a session response depending on a layer 4-7 condition<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <action>    defines the action to perform if the condition applies. valid<br>                actions include : “accept”, “close”, “reject”, “lua”.</p>\n<pre><code>&lt;condition&gt; is a standard layer 4-7 acl-based condition (see section 7).\n</code></pre><p>  response contents can be analysed at an early stage of response processing<br>  called “tcp content inspection”. during this stage, acl-based rules are<br>  evaluated every time the response contents are updated, until either an<br>  “accept”, “close” or a “reject” rule matches, or a tcp response inspection<br>  delay is set and expires with no matching rule.</p>\n<p>  most often, these decisions will consider a protocol recognition or validity.</p>\n<p>  content-based rules are evaluated in their exact declaration order. if no<br>  rule matches or if there is no rule, the default action is to accept the<br>  contents. there is no specific limit to the number of rules which may be<br>  inserted.</p>\n<p>  two types of actions are supported :</p>\n<pre><code>- accept :\n    accepts the response if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation.\n\n- close :\n    immediately closes the connection with the server if the condition is\n    true (when used with &quot;if&quot;), or false (when used with &quot;unless&quot;). the\n    first such rule executed ends the rules evaluation. the main purpose of\n    this action is to force a connection to be finished between a client\n    and a server after an exchange when the application protocol expects\n    some long time outs to elapse first. the goal is to eliminate idle\n    connections which take significant resources on servers with certain\n    protocols.\n\n- reject :\n    rejects the response if the condition is true (when used with &quot;if&quot;)\n    or false (when used with &quot;unless&quot;). the first such rule executed ends\n    the rules evaluation. rejected session are immediately closed.\n\n- lua &lt;function&gt;\n    executes lua.\n\n- set-var(&lt;var-name&gt;) &lt;expr&gt;\n    sets a variable.\n</code></pre><p>  note that the “if/unless” condition is optional. if no condition is set on<br>  the action, it is simply performed unconditionally. that can be useful for<br>  for changing the default action to a reject.</p>\n<p>  it is perfectly possible to match layer 7 contents with “tcp-response<br>  content” rules, but then it is important to ensure that a full response has<br>  been buffered, otherwise no contents will match. in order to achieve this,<br>  the best solution involves detecting the http protocol during the inspection<br>  period.</p>\n<p>  the “lua” keyword is followed by a lua function name. it is used to run a lua<br>  function if the action is executed. the single parameter is the name of the<br>  function to run. the prototype of the function is documented in the api<br>  documentation.</p>\n<p>  the “set-var” is used to set the content of a variable. the variable is<br>  declared inline.</p>\n<pre><code>&lt;var-name&gt; the name of the variable starts by an indication about its scope.\n           the allowed scopes are:\n             &quot;sess&quot; : the variable is shared with all the session,\n             &quot;txn&quot;  : the variable is shared with all the transaction\n                      (request and response)\n             &quot;req&quot;  : the variable is shared only during the request\n                      processing\n             &quot;res&quot;  : the variable is shared only during the response\n                      processing.\n           this prefix is followed by a name. the separator is a &apos;.&apos;.\n           the name may only contain characters &apos;a-z&apos;, &apos;a-z&apos;, &apos;0-9&apos; and &apos;_&apos;.\n\n&lt;expr&gt;     is a standard haproxy expression formed by a sample-fetch\n           followed by some converters.\n</code></pre><p>  example:</p>\n<pre><code>tcp-request content set-var(sess.my_var) src\n</code></pre><p>  see section 7 about acl usage.</p>\n<p>  see also : “tcp-request content”, “tcp-response inspect-delay”</p>\n<p>tcp-response inspect-delay <timeout><br>  set the maximum allowed time to wait for a response during content inspection<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 no    |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  see also : “tcp-response content”, “tcp-request inspect-delay”.</p>\n<p>timeout check <timeout><br>  set additional check timeout, but only after a connection has been already<br>  established.</p>\n<p>  may be used in sections:    defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments:<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  if set, haproxy uses min(“timeout connect”, “inter”) as a connect timeout<br>  for check and “timeout check” as an additional read timeout. the “min” is<br>  used so that people running with <em>very</em> long “timeout connect” (eg. those<br>  who needed this due to the queue or tarpit) do not slow down their checks.<br>  (please also note that there is no valid reason to have such long connect<br>  timeouts, because “timeout queue” and “timeout tarpit” can always be used to<br>  avoid that).</p>\n<p>  if “timeout check” is not set haproxy uses “inter” for complete check<br>  timeout (connect + read) exactly like all &lt;1.3.15 version.</p>\n<p>  in most cases check request is much simpler and faster to handle than normal<br>  requests and people may want to kick out laggy servers so this timeout should<br>  be smaller than “timeout server”.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it.</p>\n<p>  see also: “timeout connect”, “timeout queue”, “timeout server”,<br>            “timeout tarpit”.</p>\n<p>timeout client <timeout><br>timeout clitimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the client side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase, when the client sends the request, and during the<br>  response while it is reading data sent by the server. the value is specified<br>  in milliseconds by default, but can be in any other unit if the number is<br>  suffixed by the unit, as specified at the top of this document. in tcp mode<br>  (and to a lesser extent, in http mode), it is highly recommended that the<br>  client timeout remains equal to the server timeout in order to avoid complex<br>  situations to debug. it is a good practice to cover one or several tcp packet<br>  losses by specifying timeouts that are slightly above multiples of 3 seconds<br>  (eg: 4 or 5 seconds). if some long-lived sessions are mixed with short-lived<br>  sessions (eg: websocket and http), it’s worth considering “timeout tunnel”,<br>  which overrides “timeout client” and “timeout server” for tunnels, as well as<br>  “timeout client-fin” for half-closed connections.</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “clitimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout clitimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also : “clitimeout”, “timeout server”, “timeout tunnel”.</p>\n<p>timeout client-fin <timeout><br>  set the inactivity timeout on the client side for half-closed connections.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   no<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the client is expected to acknowledge or<br>  send data while one direction is already shut down. this timeout is different<br>  from “timeout client” in that it only applies to connections which are closed<br>  in one direction. this is particularly useful to avoid keeping connections in<br>  fin_wait state for too long when clients do not disconnect cleanly. this<br>  problem is particularly common long connections such as rdp or websocket.<br>  note that this timeout can override “timeout tunnel” when a connection shuts<br>  down in one direction.</p>\n<p>  this parameter is specific to frontends, but can be specified once for all in<br>  “defaults” sections. by default it is not set, so half-closed connections<br>  will use the other timeouts (timeout.client or timeout.tunnel).</p>\n<p>  see also : “timeout client”, “timeout server-fin”, and “timeout tunnel”.</p>\n<p>timeout connect <timeout><br>timeout contimeout <timeout> (deprecated)<br>  set the maximum time to wait for a connection attempt to a server to succeed.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  if the server is located on the same lan as haproxy, the connection should be<br>  immediate (less than a few milliseconds). anyway, it is a good practice to<br>  cover one or several tcp packet losses by specifying timeouts that are<br>  slightly above multiples of 3 seconds (eg: 4 or 5 seconds). by default, the<br>  connect timeout also presets both queue and tarpit timeouts to the same value<br>  if these have not been specified.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of failed sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “contimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout contimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also: “timeout check”, “timeout queue”, “timeout server”, “contimeout”,<br>            “timeout tarpit”.</p>\n<p>timeout http-keep-alive <timeout><br>  set the maximum allowed time to wait for a new http request to appear<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  by default, the time to wait for a new request in case of keep-alive is set<br>  by “timeout http-request”. however this is not always convenient because some<br>  people want very short keep-alive timeouts in order to release connections<br>  faster, and others prefer to have larger ones but still have short timeouts<br>  once the request has started to present itself.</p>\n<p>  the “http-keep-alive” timeout covers these needs. it will define how long to<br>  wait for a new http request to start coming after a response was sent. once<br>  the first byte of request has been seen, the “http-request” timeout is used<br>  to wait for the complete request to come. note that empty lines prior to a<br>  new request do not refresh the timeout and are not counted as a new request.</p>\n<p>  there is also another difference between the two timeouts : when a connection<br>  expires during timeout http-keep-alive, no error is returned, the connection<br>  just closes. if the connection expires in “http-request” while waiting for a<br>  connection to complete, a http 408 error is returned.</p>\n<p>  in general it is optimal to set this value to a few tens to hundreds of<br>  milliseconds, to allow users to fetch all objects of a page at once but<br>  without waiting for further clicks. also, if set to a very small value (eg:<br>  1 millisecond) it will probably only accept pipelined requests but not the<br>  non-pipelined ones. it may be a nice trade-off for very large sites running<br>  with tens to hundreds of thousands of clients.</p>\n<p>  if this parameter is not set, the “http-request” timeout applies, and if both<br>  are not set, “timeout client” still applies at the lower level. it should be<br>  set in the frontend to take effect, unless the frontend is in tcp mode, in<br>  which case the http backend’s timeout will be used.</p>\n<p>  see also : “timeout http-request”, “timeout client”.</p>\n<p>timeout http-request <timeout><br>  set the maximum allowed time to wait for a complete http request<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  in order to offer dos protection, it may be required to lower the maximum<br>  accepted time to receive a complete http request without affecting the client<br>  timeout. this helps protecting against established connections on which<br>  nothing is sent. the client timeout cannot offer a good protection against<br>  this abuse because it is an inactivity timeout, which means that if the<br>  attacker sends one character every now and then, the timeout will not<br>  trigger. with the http request timeout, no matter what speed the client<br>  types, the request will be aborted if it does not complete in time. when the<br>  timeout expires, an http 408 response is sent to the client to inform it<br>  about the problem, and the connection is closed. the logs will report<br>  termination codes “cr”. some recent browsers are having problems with this<br>  standard, well-documented behaviour, so it might be needed to hide the 408<br>  code using “option http-ignore-probes” or “errorfile 408 /dev/null”. see<br>  more details in the explanations of the “cr” termination code in section 8.5.</p>\n<p>  note that this timeout only applies to the header part of the request, and<br>  not to any data. as soon as the empty line is received, this timeout is not<br>  used anymore. it is used again on keep-alive connections to wait for a second<br>  request if “timeout http-keep-alive” is not set.</p>\n<p>  generally it is enough to set it to a few seconds, as most clients send the<br>  full request immediately upon connection. add 3 or more seconds to cover tcp<br>  retransmits but that’s all. setting it to very low values (eg: 50 ms) will<br>  generally work on local networks as long as there are no packet losses. this<br>  will prevent people from sending bare http requests using telnet.</p>\n<p>  if this parameter is not set, the client timeout still applies between each<br>  chunk of the incoming request. it should be set in the frontend to take<br>  effect, unless the frontend is in tcp mode, in which case the http backend’s<br>  timeout will be used.</p>\n<p>  see also : “errorfile”, “http-ignore-probes”, “timeout http-keep-alive”, and<br>             “timeout client”.</p>\n<p>timeout queue <timeout><br>  set the maximum time to wait in the queue for a connection slot to be free<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  when a server’s maxconn is reached, connections are left pending in a queue<br>  which may be server-specific or global to the backend. in order not to wait<br>  indefinitely, a timeout is applied to requests pending in the queue. if the<br>  timeout is reached, it is considered that the request will almost never be<br>  served, so it is dropped and a 503 error is returned to the client.</p>\n<p>  the “timeout queue” statement allows to fix the maximum time for a request to<br>  be left pending in a queue. if unspecified, the same value as the backend’s<br>  connection timeout (“timeout connect”) is used, for backwards compatibility<br>  with older versions with no “timeout queue” parameter.</p>\n<p>  see also : “timeout connect”, “contimeout”.</p>\n<p>timeout server <timeout><br>timeout srvtimeout <timeout> (deprecated)<br>  set the maximum inactivity time on the server side.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data. in http mode, this timeout is particularly important to consider<br>  during the first phase of the server’s response, when it has to send the<br>  headers, as it directly represents the server’s processing time for the<br>  request. to find out what value to put there, it’s often good to start with<br>  what would be considered as unacceptable response times, then check the logs<br>  to observe the response time distribution, and adjust the value accordingly.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. in tcp mode (and to a lesser extent, in http mode), it is highly<br>  recommended that the client timeout remains equal to the server timeout in<br>  order to avoid complex situations to debug. whatever the expected server<br>  response times, it is a good practice to cover at least one or several tcp<br>  packet losses by specifying timeouts that are slightly above multiples of 3<br>  seconds (eg: 4 or 5 seconds minimum). if some long-lived sessions are mixed<br>  with short-lived sessions (eg: websocket and http), it’s worth considering<br>  “timeout tunnel”, which overrides “timeout client” and “timeout server” for<br>  tunnels.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it. an unspecified timeout results in an infinite timeout, which<br>  is not recommended. such a usage is accepted and works but reports a warning<br>  during startup because it may results in accumulation of expired sessions in<br>  the system if the system’s timeouts are not configured either.</p>\n<p>  this parameter replaces the old, deprecated “srvtimeout”. it is recommended<br>  to use it to write new configurations. the form “timeout srvtimeout” is<br>  provided only by backwards compatibility but its use is strongly discouraged.</p>\n<p>  see also : “srvtimeout”, “timeout client” and “timeout tunnel”.</p>\n<p>timeout server-fin <timeout><br>  set the inactivity timeout on the server side for half-closed connections.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the inactivity timeout applies when the server is expected to acknowledge or<br>  send data while one direction is already shut down. this timeout is different<br>  from “timeout server” in that it only applies to connections which are closed<br>  in one direction. this is particularly useful to avoid keeping connections in<br>  fin_wait state for too long when a remote server does not disconnect cleanly.<br>  this problem is particularly common long connections such as rdp or websocket.<br>  note that this timeout can override “timeout tunnel” when a connection shuts<br>  down in one direction. this setting was provided for completeness, but in most<br>  situations, it should not be needed.</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. by default it is not set, so half-closed connections<br>  will use the other timeouts (timeout.server or timeout.tunnel).</p>\n<p>  see also : “timeout client-fin”, “timeout server”, and “timeout tunnel”.</p>\n<p>timeout tarpit <timeout><br>  set the duration for which tarpitted connections will be maintained<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    yes   |   yes  |   yes<br>  arguments :<br>    <timeout> is the tarpit duration specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  when a connection is tarpitted using “reqtarpit”, it is maintained open with<br>  no activity for a certain amount of time, then closed. “timeout tarpit”<br>  defines how long it will be maintained open.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. if unspecified, the same value as the backend’s connection timeout<br>  (“timeout connect”) is used, for backwards compatibility with older versions<br>  with no “timeout tarpit” parameter.</p>\n<p>  see also : “timeout connect”, “contimeout”.</p>\n<p>timeout tunnel <timeout><br>  set the maximum inactivity time on the client and server side for tunnels.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments :<br>    <timeout> is the timeout value specified in milliseconds by default, but<br>              can be in any other unit if the number is suffixed by the unit,<br>              as explained at the top of this document.</p>\n<p>  the tunnel timeout applies when a bidirectional connection is established<br>  between a client and a server, and the connection remains inactive in both<br>  directions. this timeout supersedes both the client and server timeouts once<br>  the connection becomes a tunnel. in tcp, this timeout is used as soon as no<br>  analyser remains attached to either connection (eg: tcp content rules are<br>  accepted). in http, this timeout is used when a connection is upgraded (eg:<br>  when switching to the websocket protocol, or forwarding a connect request<br>  to a proxy), or after the first response when no keepalive/close option is<br>  specified.</p>\n<p>  since this timeout is usually used in conjunction with long-lived connections,<br>  it usually is a good idea to also set “timeout client-fin” to handle the<br>  situation where a client suddenly disappears from the net and does not<br>  acknowledge a close, or sends a shutdown and does not acknowledge pending<br>  data anymore. this can happen in lossy networks where firewalls are present,<br>  and is detected by the presence of large amounts of sessions in a fin_wait<br>  state.</p>\n<p>  the value is specified in milliseconds by default, but can be in any other<br>  unit if the number is suffixed by the unit, as specified at the top of this<br>  document. whatever the expected normal idle time, it is a good practice to<br>  cover at least one or several tcp packet losses by specifying timeouts that<br>  are slightly above multiples of 3 seconds (eg: 4 or 5 seconds minimum).</p>\n<p>  this parameter is specific to backends, but can be specified once for all in<br>  “defaults” sections. this is in fact one of the easiest solutions not to<br>  forget about it.</p>\n<p>  example :<br>        defaults http<br>            option http-server-close<br>            timeout connect 5s<br>            timeout client 30s<br>            timeout client-fin 30s<br>            timeout server 30s<br>            timeout tunnel  1h    # timeout to use with websocket and connect</p>\n<p>  see also : “timeout client”, “timeout client-fin”, “timeout server”.</p>\n<p>transparent (deprecated)<br>  enable client-side transparent proxying<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                 yes   |    no    |   yes  |   yes<br>  arguments : none</p>\n<p>  this keyword was introduced in order to provide layer 7 persistence to layer<br>  3 load balancers. the idea is to use the os’s ability to redirect an incoming<br>  connection for a remote address to a local process (here haproxy), and let<br>  this process know what address was initially requested. when this option is<br>  used, sessions without cookies will be forwarded to the original destination<br>  ip address of the incoming request (which should match that of another<br>  equipment), while requests with cookies will still be forwarded to the<br>  appropriate server.</p>\n<p>  the “transparent” keyword is deprecated, use “option transparent” instead.</p>\n<p>  note that contrary to a common belief, this option does not make haproxy<br>  present the client’s ip to the server when establishing the connection.</p>\n<p>  see also: “option transparent”</p>\n<p>unique-id-format <string><br>  generate a unique id for each request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  yes  |    yes   |   yes  |   no<br>  arguments :<br>    <string>   is a log-format string.</p>\n<p>  this keyword creates a id for each request using the custom log format. a<br>  unique id is useful to trace a request passing through many components of<br>  a complex infrastructure. the newly created id may also be logged using the<br>  %id tag the log-format string.</p>\n<p>  the format should be composed from elements that are guaranteed to be<br>  unique when combined together. for instance, if multiple haproxy instances<br>  are involved, it might be important to include the node name. it is often<br>  needed to log the incoming connection’s source and destination addresses<br>  and ports. note that since multiple requests may be performed over the same<br>  connection, including a request counter may help differentiate them.<br>  similarly, a timestamp may protect against a rollover of the counter.<br>  logging the process id will avoid collisions after a service restart.</p>\n<p>  it is recommended to use hexadecimal notation for many fields since it<br>  makes them more compact and saves space in logs.</p>\n<p>  example:</p>\n<pre><code>unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n\nwill generate:\n\n       7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n</code></pre><p>  see also: “unique-id-header”</p>\n<p>unique-id-header <name><br>  add a unique id header in the http request.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  yes  |    yes   |   yes  |   no<br>  arguments :<br>    <name>   is the name of the header.</p>\n<p>  add a unique-id header in the http request sent to the server, using the<br>  unique-id-format. it can’t work if the unique-id-format doesn’t exist.</p>\n<p>  example:</p>\n<pre><code>    unique-id-format %{+x}o\\ %ci:%cp_%fi:%fp_%ts_%rt:%pid\n    unique-id-header x-unique-id\n\n    will generate:\n\n       x-unique-id: 7f000001:8296_7f00001e:1f90_4f7b0a69_0003:790a\n\nsee also: &quot;unique-id-format&quot;\n</code></pre><p>use_backend <backend> [{if | unless} <condition>]<br>  switch to a specific backend if/unless an acl-based condition is matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    yes   |   yes  |   no<br>  arguments :<br>    <backend>   is the name of a valid backend or “listen” section, or a<br>                “log-format” string resolving to a backend name.</p>\n<pre><code>&lt;condition&gt; is a condition composed of acls, as described in section 7\\. if\n            it is omitted, the rule is unconditionally applied.\n</code></pre><p>  when doing content-switching, connections arrive on a frontend and are then<br>  dispatched to various backends depending on a number of conditions. the<br>  relation between the conditions and the backends is described with the<br>  “use_backend” keyword. while it is normally used with http processing, it can<br>  also be used in pure tcp, either without content using stateless acls (eg:<br>  source address validation) or combined with a “tcp-request” rule to wait for<br>  some payload.</p>\n<p>  there may be as many “use_backend” rules as desired. all of these rules are<br>  evaluated in their declaration order, and the first one which matches will<br>  assign the backend.</p>\n<p>  in the first form, the backend will be used if the condition is met. in the<br>  second form, the backend will be used if the condition is not met. if no<br>  condition is valid, the backend defined with “default_backend” will be used.<br>  if no default backend is defined, either the servers in the same section are<br>  used (in case of a “listen” section) or, in case of a frontend, no server is<br>  used and a 503 service unavailable response is returned.</p>\n<p>  note that it is possible to switch from a tcp frontend to an http backend. in<br>  this case, either the frontend has already checked that the protocol is http,<br>  and backend processing will immediately follow, or the backend will wait for<br>  a complete http request to get in. this feature is useful when a frontend<br>  must decode several protocols on a unique port, one of them being http.</p>\n<p>  when <backend> is a simple name, it is resolved at configuration time, and an<br>  error is reported if the specified backend does not exist. if <backend> is<br>  a log-format string instead, no check may be done at configuration time, so<br>  the backend name is resolved dynamically at run time. if the resulting<br>  backend name does not correspond to any valid backend, no other rule is<br>  evaluated, and the default_backend directive is applied instead. note that<br>  when using dynamic backend names, it is highly recommended to use a prefix<br>  that no other backend uses in order to ensure that an unauthorized backend<br>  cannot be forced from the request.</p>\n<p>  it is worth mentioning that “use_backend” rules with an explicit name are<br>  used to detect the association between frontends and backends to compute the<br>  backend’s “fullconn” setting. this cannot be done for dynamic names.</p>\n<p>  see also: “default_backend”, “tcp-request”, “fullconn”, “log-format”, and<br>            section 7 about acls.</p>\n<p>use-server <server> if <condition><br>use-server <server> unless <condition><br>  only use a specific server if/unless an acl-based condition is matched.<br>  may be used in sections :   defaults | frontend | listen | backend<br>                                  no   |    no    |   yes  |   yes<br>  arguments :<br>    <server>    is the name of a valid server in the same backend section.</p>\n<pre><code>&lt;condition&gt; is a condition composed of acls, as described in section 7.\n</code></pre><p>  by default, connections which arrive to a backend are load-balanced across<br>  the available servers according to the configured algorithm, unless a<br>  persistence mechanism such as a cookie is used and found in the request.</p>\n<p>  sometimes it is desirable to forward a particular request to a specific<br>  server without having to declare a dedicated backend for this server. this<br>  can be achieved using the “use-server” rules. these rules are evaluated after<br>  the “redirect” rules and before evaluating cookies, and they have precedence<br>  on them. there may be as many “use-server” rules as desired. all of these<br>  rules are evaluated in their declaration order, and the first one which<br>  matches will assign the server.</p>\n<p>  if a rule designates a server which is down, and “option persist” is not used<br>  and no force-persist rule was validated, it is ignored and evaluation goes on<br>  with the next rules until one matches.</p>\n<p>  in the first form, the server will be used if the condition is met. in the<br>  second form, the server will be used if the condition is not met. if no<br>  condition is valid, the processing continues and the server will be assigned<br>  according to other persistence mechanisms.</p>\n<p>  note that even if a rule is matched, cookie processing is still performed but<br>  does not assign the server. this allows prefixed cookies to have their prefix<br>  stripped.</p>\n<p>  the “use-server” statement works both in http and tcp mode. this makes it<br>  suitable for use with content-based inspection. for instance, a server could<br>  be selected in a farm according to the tls sni field. and if these servers<br>  have their weight set to zero, they will not be used for other traffic.</p>\n<p>  example :</p>\n<pre><code># intercept incoming tls requests based on the sni field\nuse-server www if { req_ssl_sni -i www.example.com }\nserver     www 192.168.0.1:443 weight 0\nuse-server mail if { req_ssl_sni -i mail.example.com }\nserver     mail 192.168.0.1:587 weight 0\nuse-server imap if { req_ssl_sni -i imap.example.com }\nserver     mail 192.168.0.1:993 weight 0\n# all the rest is forwarded to this server\nserver  default 192.168.0.2:443 check\n</code></pre><p>  see also: “use_backend”, section 5 about server and section 7 about acls.</p>\n<h2 id=\"5-bind-and-server-options\"><a href=\"#5-bind-and-server-options\" class=\"headerlink\" title=\"5. bind and server options\"></a>5. bind and server options</h2><p>the “bind”, “server” and “default-server” keywords support a number of settings<br>depending on some build options and on the system haproxy was built on. these<br>settings generally each consist in one word sometimes followed by a value,<br>written on the same line as the “bind” or “server” line. all these options are<br>described in this section.</p>\n<h2 id=\"5-1-bind-options\"><a href=\"#5-1-bind-options\" class=\"headerlink\" title=\"5.1. bind options\"></a>5.1. bind options</h2><p>the “bind” keyword supports a certain number of settings which are all passed<br>as arguments on the same line. the order in which those arguments appear makes<br>no importance, provided that they appear after the bind address. all of these<br>parameters are optional. some of them consist in a single words (booleans),<br>while other ones expect a value after them. in this case, the value must be<br>provided immediately after the setting name.</p>\n<p>the currently supported settings are the following ones.</p>\n<p>accept-proxy<br>  enforces the use of the proxy protocol over any connection accepted by any of<br>  the sockets declared on the same line. versions 1 and 2 of the proxy protocol<br>  are supported and correctly detected. the proxy protocol dictates the layer<br>  3/4 addresses of the incoming connection to be used everywhere an address is<br>  used, with the only exception of “tcp-request connection” rules which will<br>  only see the real connection address. logs will reflect the addresses<br>  indicated in the protocol, unless it is violated, in which case the real<br>  address will still be used.  this keyword combined with support from external<br>  components can be used as an efficient and reliable alternative to the<br>  x-forwarded-for mechanism which is not always reliable and not even always<br>  usable. see also “tcp-request connection expect-proxy” for a finer-grained<br>  setting of which client is allowed to use the protocol.</p>\n<p>alpn <protocols><br>  this enables the tls alpn extension and advertises the specified protocol<br>  list as supported on top of alpn. the protocol list consists in a comma-<br>  delimited list of protocol names, for instance: “http/1.1,http/1.0” (without<br>  quotes). this requires that the ssl library is build with support for tls<br>  extensions enabled (check with haproxy -vv). the alpn extension replaces the<br>  initial npn extension.</p>\n<p>backlog <backlog><br>  sets the socket’s backlog to this value. if unspecified, the frontend’s<br>  backlog is used instead, which generally defaults to the maxconn value.</p>\n<p>ecdhe <named curve><br>  this setting is only available when support for openssl was built in. it sets<br>  the named curve (rfc 4492) used to generate ecdh ephemeral keys. by default,<br>  used named curve is prime256v1.</p>\n<p>ca-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load ca certificates used to verify<br>  client’s certificate.</p>\n<p>ca-ignore-err [all|<errorid>,…]<br>  this setting is only available when support for openssl was built in.<br>  sets a comma separated list of errorids to ignore during verify at depth &gt; 0.<br>  if set to ‘all’, all errors are ignored. ssl handshake is not aborted if an<br>  error is ignored.</p>\n<p>ca-sign-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file containing both the ca certificate and the ca private<br>  key used to create and sign server’s certificates. this is a mandatory<br>  setting when the dynamic generation of certificates is enabled. see<br>  ‘generate-certificates’ for details.</p>\n<p>ca-sign-passphrase <passphrase><br>  this setting is only available when support for openssl was built in. it is<br>  the ca private key passphrase. this setting is optional and used only when<br>  the dynamic generation of certificates is enabled. see<br>  ‘generate-certificates’ for details.</p>\n<p>ciphers <ciphers><br>  this setting is only available when support for openssl was built in. it sets<br>  the string describing the list of cipher algorithms (“cipher suite”) that are<br>  negotiated during the ssl/tls handshake. the format of the string is defined<br>  in “man 1 ciphers” from openssl man pages, and can be for instance a string<br>  such as “aes:all:!anull:!enull:+rc4:@strength” (without quotes).</p>\n<p>crl-file <crlfile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load certificate revocation list used<br>  to verify client’s certificate.</p>\n<p>crt <cert><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file containing both the required certificates and any<br>  associated private keys. this file can be built by concatenating multiple<br>  pem files into one (e.g. cat cert.pem key.pem &gt; combined.pem). if your ca<br>  requires an intermediate certificate, this can also be concatenated into this<br>  file.</p>\n<p>  if the openssl used supports diffie-hellman, parameters present in this file<br>  are loaded.</p>\n<p>  if a directory name is used instead of a pem file, then all files found in<br>  that directory will be loaded in alphabetic order unless their name ends with<br>  ‘.issuer’, ‘.ocsp’ or ‘.sctl’ (reserved extensions). this directive may be<br>  specified multiple times in order to load certificates from multiple files or<br>  directories. the certificates will be presented to clients who provide a<br>  valid tls server name indication field matching one of their cn or alt<br>  subjects.  wildcards are supported, where a wildcard character ‘<em>‘ is used<br>  instead of the first hostname component (eg: </em>.example.org matches<br>  www.example.org but not www.sub.example.org).</p>\n<p>  if no sni is provided by the client or if the ssl library does not support<br>  tls extensions, or if the client provides an sni hostname which does not<br>  match any certificate, then the first loaded certificate will be presented.<br>  this means that when loading certificates from a directory, it is highly<br>  recommended to load the default one first as a file or to ensure that it will<br>  always be the first one in the directory.</p>\n<p>  note that the same cert may be loaded multiple times without side effects.</p>\n<p>  some cas (such as godaddy) offer a drop down list of server types that do not<br>  include haproxy when obtaining a certificate. if this happens be sure to<br>  choose a webserver that the ca believes requires an intermediate ca (for<br>  godaddy, selection apache tomcat will get the correct bundle, but many<br>  others, e.g. nginx, result in a wrong bundle that will not work for some<br>  clients).</p>\n<p>  for each pem file, haproxy checks for the presence of file at the same path<br>  suffixed by “.ocsp”. if such file is found, support for the tls certificate<br>  status request extension (also known as “ocsp stapling”) is automatically<br>  enabled. the content of this file is optional. if not empty, it must contain<br>  a valid ocsp response in der format. in order to be valid an ocsp response<br>  must comply with the following rules: it has to indicate a good status,<br>  it has to be a single response for the certificate of the pem file, and it<br>  has to be valid at the moment of addition. if these rules are not respected<br>  the ocsp response is ignored and a warning is emitted. in order to  identify<br>  which certificate an ocsp response applies to, the issuer’s certificate is<br>  necessary. if the issuer’s certificate is not found in the pem file, it will<br>  be loaded from a file at the same path as the pem file suffixed by “.issuer”<br>  if it exists otherwise it will fail with an error.</p>\n<p>  for each pem file, haproxy also checks for the presence of file at the same<br>  path suffixed by “.sctl”. if such file is found, support for certificate<br>  transparency (rfc6962) tls extension is enabled. the file must contain a<br>  valid signed certificate timestamp list, as described in rfc. file is parsed<br>  to check basic syntax, but no signatures are verified.</p>\n<p>crt-ignore-err <errors><br>  this setting is only available when support for openssl was built in. sets a<br>  comma separated list of errorids to ignore during verify at depth == 0.  if<br>  set to ‘all’, all errors are ignored. ssl handshake is not aborted if an error<br>  is ignored.</p>\n<p>crt-list <file><br>  this setting is only available when support for openssl was built in. it<br>  designates a list of pem file with an optional list of sni filter per<br>  certificate, with the following format for each line :</p>\n<pre><code>&lt;crtfile&gt; [[!]&lt;snifilter&gt; ...]\n</code></pre><p>  wildcards are supported in the sni filter. negative filter are also supported,<br>  only useful in combination with a wildcard filter to exclude a particular sni.<br>  the certificates will be presented to clients who provide a valid tls server<br>  name indication field matching one of the sni filters. if no sni filter is<br>  specified, the cn and alt subjects are used. this directive may be specified<br>  multiple times. see the “crt” option for more information. the default<br>  certificate is still needed to meet openssl expectations. if it is not used,<br>  the ‘strict-sni’ option may be used.</p>\n<p>defer-accept<br>  is an optional keyword which is supported only on certain linux kernels. it<br>  states that a connection will only be accepted once some data arrive on it,<br>  or at worst after the first retransmit. this should be used only on protocols<br>  for which the client talks first (eg: http). it can slightly improve<br>  performance by ensuring that most of the request is already available when<br>  the connection is accepted. on the other hand, it will not be able to detect<br>  connections which don’t talk. it is important to note that this option is<br>  broken in all kernels up to 2.6.31, as the connection is never accepted until<br>  the client talks. this can cause issues with front firewalls which would see<br>  an established connection while the proxy will only see it in syn_recv. this<br>  option is only supported on tcpv4/tcpv6 sockets and ignored by other ones.</p>\n<p>force-sslv3<br>  this option enforces use of sslv3 only on ssl connections instantiated from<br>  this listener. sslv3 is generally less expensive than the tls counterparts<br>  for high connection rates. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*” and “no-sslv3”.</p>\n<p>force-tlsv10<br>  this option enforces use of tlsv1.0 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*” and “no-sslv3”.</p>\n<p>force-tlsv11<br>  this option enforces use of tlsv1.1 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*”, and “no-sslv3”.</p>\n<p>force-tlsv12<br>  this option enforces use of tlsv1.2 only on ssl connections instantiated from<br>  this listener. this option is also available on global statement<br>  “ssl-default-bind-options”. see also “no-tlsv*”, and “no-sslv3”.</p>\n<p>generate-certificates<br>  this setting is only available when support for openssl was built in. it<br>  enables the dynamic ssl certificates generation. a ca certificate and its<br>  private key are necessary (see ‘ca-sign-file’). when haproxy is configured as<br>  a transparent forward proxy, ssl requests generate errors because of a common<br>  name mismatch on the certificate presented to the client. with this option<br>  enabled, haproxy will try to forge a certificate using the sni hostname<br>  indicated by the client. this is done only if no certificate matches the sni<br>  hostname (see ‘crt-list’). if an error occurs, the default certificate is<br>  used, else the ‘strict-sni’ option is set.<br>  it can also be used when haproxy is configured as a reverse proxy to ease the<br>  deployment of an architecture with many backends.</p>\n<p>  creating a ssl certificate is an expensive operation, so a lru cache is used<br>  to store forged certificates (see ‘tune.ssl.ssl-ctx-cache-size’). it<br>  increases the haproxy’s memroy footprint to reduce latency when the same<br>  certificate is used many times.</p>\n<p>gid <gid><br>  sets the group of the unix sockets to the designated system gid. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “group”<br>  setting except that the group id is used instead of its name. this setting is<br>  ignored by non unix sockets.</p>\n<p>group <group><br>  sets the group of the unix sockets to the designated system group. it can<br>  also be set by default in the global section’s “unix-bind” statement. note<br>  that some platforms simply ignore this. this setting is equivalent to the<br>  “gid” setting except that the group name is used instead of its gid. this<br>  setting is ignored by non unix sockets.</p>\n<p>id <id><br>  fixes the socket id. by default, socket ids are automatically assigned, but<br>  sometimes it is more convenient to fix them to ease monitoring. this value<br>  must be strictly positive and unique within the listener/frontend. this<br>  option can only be used when defining only a single socket.</p>\n<p>interface <interface><br>  restricts the socket to a specific interface. when specified, only packets<br>  received from that particular interface are processed by the socket. this is<br>  currently only supported on linux. the interface must be a primary system<br>  interface, not an aliased interface. it is also possible to bind multiple<br>  frontends to the same address if they are bound to different interfaces. note<br>  that binding to a network interface requires root privileges. this parameter<br>  is only compatible with tcpv4/tcpv6 sockets.</p>\n<p>level <level><br>  this setting is used with the stats sockets only to restrict the nature of<br>  the commands that can be issued on the socket. it is ignored by other<br>  sockets. <level> can be one of :</p>\n<ul>\n<li>“user” is the least privileged level ; only non-sensitive stats can be<br>read, and no change is allowed. it would make sense on systems where it<br>is not easy to restrict access to the socket.</li>\n<li>“operator” is the default level and fits most common uses. all data can<br>be read, and only non-sensitive changes are permitted (eg: clear max<br>counters).</li>\n<li>“admin” should be used with care, as everything is permitted (eg: clear<br>all counters).</li>\n</ul>\n<p>maxconn <maxconn><br>  limits the sockets to this number of concurrent connections. extraneous<br>  connections will remain in the system’s backlog until a connection is<br>  released. if unspecified, the limit will be the same as the frontend’s<br>  maxconn. note that in case of port ranges or multiple addresses, the same<br>  value will be applied to each socket. this setting enables different<br>  limitations on expensive sockets, for instance ssl entries which may easily<br>  eat all memory.</p>\n<p>mode <mode><br>  sets the octal mode used to define access permissions on the unix socket. it<br>  can also be set by default in the global section’s “unix-bind” statement.<br>  note that some platforms simply ignore this. this setting is ignored by non<br>  unix sockets.</p>\n<p>mss <maxseg><br>  sets the tcp maximum segment size (mss) value to be advertised on incoming<br>  connections. this can be used to force a lower mss for certain specific<br>  ports, for instance for connections passing through a vpn. note that this<br>  relies on a kernel feature which is theoretically supported under linux but<br>  was buggy in all versions prior to 2.6.28. it may or may not work on other<br>  operating systems. it may also not change the advertised value but change the<br>  effective size of outgoing segments. the commonly advertised value for tcpv4<br>  over ethernet networks is 1460 = 1500(mtu) - 40(ip+tcp). if this value is<br>  positive, it will be used as the advertised mss. if it is negative, it will<br>  indicate by how much to reduce the incoming connection’s advertised mss for<br>  outgoing segments. this parameter is only compatible with tcp v4/v6 sockets.</p>\n<p>name <name><br>  sets an optional name for these sockets, which will be reported on the stats<br>  page.</p>\n<p>nice <nice><br>  sets the ‘niceness’ of connections initiated from the socket. value must be<br>  in the range -1024..1024 inclusive, and defaults to zero. positive values<br>  means that such connections are more friendly to others and easily offer<br>  their place in the scheduler. on the opposite, negative values mean that<br>  connections want to run with a higher priority than others. the difference<br>  only happens under high loads when the system is close to saturation.<br>  negative values are appropriate for low-latency or administration services,<br>  and high values are generally recommended for cpu intensive tasks such as ssl<br>  processing or bulk transfers which are less sensible to latency. for example,<br>  it may make sense to use a positive value for an smtp socket and a negative<br>  one for an rdp socket.</p>\n<p>no-sslv3<br>  this setting is only available when support for openssl was built in. it<br>  disables support for sslv3 on any sockets instantiated from the listener when<br>  ssl is supported. note that sslv2 is forced disabled in the code and cannot<br>  be enabled using any configuration option. this option is also available on<br>  global statement “ssl-default-bind-options”. see also “force-tls*”,<br>  and “force-sslv3”.</p>\n<p>no-tls-tickets<br>  this setting is only available when support for openssl was built in. it<br>  disables the stateless session resumption (rfc 5077 tls ticket<br>  extension) and force to use stateful session resumption. stateless<br>  session resumption is more expensive in cpu usage. this option is also<br>  available on global statement “ssl-default-bind-options”.</p>\n<p>no-tlsv10<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.0 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>no-tlsv11<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.1 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>no-tlsv12<br>  this setting is only available when support for openssl was built in. it<br>  disables support for tlsv1.2 on any sockets instantiated from the listener<br>  when ssl is supported. note that sslv2 is forced disabled in the code and<br>  cannot be enabled using any configuration option. this option is also<br>  available on global statement “ssl-default-bind-options”. see also<br>  “force-tlsv*”, and “force-sslv3”.</p>\n<p>npn <protocols><br>  this enables the npn tls extension and advertises the specified protocol list<br>  as supported on top of npn. the protocol list consists in a comma-delimited<br>  list of protocol names, for instance: “http/1.1,http/1.0” (without quotes).<br>  this requires that the ssl library is build with support for tls extensions<br>  enabled (check with haproxy -vv). note that the npn extension has been<br>  replaced with the alpn extension (see the “alpn” keyword).</p>\n<p>process [ all | odd | even | <number 1-64>[-<number 1-64>] ]<br>  this restricts the list of processes on which this listener is allowed to<br>  run. it does not enforce any process but eliminates those which do not match.<br>  if the frontend uses a “bind-process” setting, the intersection between the<br>  two is applied. if in the end the listener is not allowed to run on any<br>  remaining process, a warning is emitted, and the listener will either run on<br>  the first process of the listener if a single process was specified, or on<br>  all of its processes if multiple processes were specified. for the unlikely<br>  case where several ranges are needed, this directive may be repeated. the<br>  main purpose of this directive is to be used with the stats sockets and have<br>  one different socket per process. the second purpose is to have multiple bind<br>  lines sharing the same ip:port but not the same process in a listener, so<br>  that the system can distribute the incoming connections into multiple queues<br>  and allow a smoother inter-process load balancing. currently linux 3.9 and<br>  above is known for supporting this. see also “bind-process” and “nbproc”.</p>\n<p>ssl<br>  this setting is only available when support for openssl was built in. it<br>  enables ssl deciphering on connections instantiated from this listener. a<br>  certificate is necessary (see “crt” above). all contents in the buffers will<br>  appear in clear text, so that acls and http processing will only have access<br>  to deciphered contents.</p>\n<p>strict-sni<br>  this setting is only available when support for openssl was built in. the<br>  ssl/tls negotiation is allow only if the client provided an sni which match<br>  a certificate. the default certificate is not used.<br>  see the “crt” option for more information.</p>\n<p>tcp-ut <delay><br>  sets the tcp user timeout for all incoming connections instanciated from this<br>  listening socket. this option is available on linux since version 2.6.37. it<br>  allows haproxy to configure a timeout for sockets which contain data not<br>  receiving an acknoledgement for the configured delay. this is especially<br>  useful on long-lived connections experiencing long idle periods such as<br>  remote terminals or database connection pools, where the client and server<br>  timeouts must remain high to allow a long period of idle, but where it is<br>  important to detect that the client has disappeared in order to release all<br>  resources associated with its connection (and the server’s session). the<br>  argument is a delay expressed in milliseconds by default. this only works<br>  for regular tcp connections, and is ignored for other protocols.</p>\n<p>tfo<br>  is an optional keyword which is supported only on linux kernels &gt;= 3.7. it<br>  enables tcp fast open on the listening socket, which means that clients which<br>  support this feature will be able to send a request and receive a response<br>  during the 3-way handshake starting from second connection, thus saving one<br>  round-trip after the first connection. this only makes sense with protocols<br>  that use high connection rates and where each round trip matters. this can<br>  possibly cause issues with many firewalls which do not accept data on syn<br>  packets, so this option should only be enabled once well tested. this option<br>  is only supported on tcpv4/tcpv6 sockets and ignored by other ones. you may<br>  need to build haproxy with use_tfo=1 if your libc doesn’t define<br>  tcp_fastopen.</p>\n<p>tls-ticket-keys <keyfile><br>  sets the tls ticket keys file to load the keys from. the keys need to be 48<br>  bytes long, encoded with base64 (ex. openssl rand -base64 48). number of keys<br>  is specified by the tls_tickets_no build option (default 3) and at least as<br>  many keys need to be present in the file. last tls_tickets_no keys will be<br>  used for decryption and the penultimate one for encryption. this enables easy<br>  key rotation by just appending new key to the file and reloading the process.<br>  keys must be periodically rotated (ex. every 12h) or perfect forward secrecy<br>  is compromised. it is also a good idea to keep the keys off any permanent<br>  storage such as hard drives (hint: use tmpfs and don’t swap those files).<br>  lifetime hint can be changed using tune.ssl.timeout.</p>\n<p>transparent<br>  is an optional keyword which is supported only on certain linux kernels. it<br>  indicates that the addresses will be bound even if they do not belong to the<br>  local machine, and that packets targeting any of these addresses will be<br>  intercepted just as if the addresses were locally configured. this normally<br>  requires that ip forwarding is enabled. caution! do not use this with the<br>  default address ‘*’, as it would redirect any traffic for the specified port.<br>  this keyword is available only when haproxy is built with use_linux_tproxy=1.<br>  this parameter is only compatible with tcpv4 and tcpv6 sockets, depending on<br>  kernel version. some distribution kernels include backports of the feature,<br>  so check for support with your vendor.</p>\n<p>v4v6<br>  is an optional keyword which is supported only on most recent systems<br>  including linux kernels &gt;= 2.4.21. it is used to bind a socket to both ipv4<br>  and ipv6 when it uses the default address. doing so is sometimes necessary<br>  on systems which bind to ipv6 only by default. it has no effect on non-ipv6<br>  sockets, and is overridden by the “v6only” option.</p>\n<p>v6only<br>  is an optional keyword which is supported only on most recent systems<br>  including linux kernels &gt;= 2.4.21. it is used to bind a socket to ipv6 only<br>  when it uses the default address. doing so is sometimes preferred to doing it<br>  system-wide as it is per-listener. it has no effect on non-ipv6 sockets and<br>  has precedence over the “v4v6” option.</p>\n<p>uid <uid><br>  sets the owner of the unix sockets to the designated system uid. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “user”<br>  setting except that the user numeric id is used instead of its name. this<br>  setting is ignored by non unix sockets.</p>\n<p>user <user><br>  sets the owner of the unix sockets to the designated system user. it can also<br>  be set by default in the global section’s “unix-bind” statement. note that<br>  some platforms simply ignore this. this setting is equivalent to the “uid”<br>  setting except that the user name is used instead of its uid. this setting is<br>  ignored by non unix sockets.</p>\n<p>verify [none|optional|required]<br>  this setting is only available when support for openssl was built in. if set<br>  to ‘none’, client certificate is not requested. this is the default. in other<br>  cases, a client certificate is requested. if the client does not provide a<br>  certificate after the request and if ‘verify’ is set to ‘required’, then the<br>  handshake is aborted, while it would have succeeded if set to ‘optional’. the<br>  certificate provided by the client is always verified using cas from<br>  ‘ca-file’ and optional crls from ‘crl-file’. on verify failure the handshake<br>  is aborted, regardless of the ‘verify’ option, unless the error code exactly<br>  matches one of those listed with ‘ca-ignore-err’ or ‘crt-ignore-err’.</p>\n<h2 id=\"5-2-server-and-default-server-options\"><a href=\"#5-2-server-and-default-server-options\" class=\"headerlink\" title=\"5.2. server and default-server options\"></a>5.2. server and default-server options</h2><p>the “server” and “default-server” keywords support a certain number of settings<br>which are all passed as arguments on the server line. the order in which those<br>arguments appear does not count, and they are all optional. some of those<br>settings are single words (booleans) while others expect one or several values<br>after them. in this case, the values must immediately follow the setting name.<br>except default-server, all those settings must be specified after the server’s<br>address if they are used:</p>\n<p>  server <name> <address>[:port] [settings …]<br>  default-server [settings …]</p>\n<p>the currently supported settings are the following ones.</p>\n<p>addr <ipv4|ipv6><br>  using the “addr” parameter, it becomes possible to use a different ip address<br>  to send health-checks. on some servers, it may be desirable to dedicate an ip<br>  address to specific component able to perform complex tests which are more<br>  suitable to health-checks than the application. this parameter is ignored if<br>  the “check” parameter is not set. see also the “port” parameter.</p>\n<p>  supported in default-server: no</p>\n<p>agent-check<br>  enable an auxiliary agent check which is run independently of a regular<br>  health check. an agent health check is performed by making a tcp connection<br>  to the port set by the “agent-port” parameter and reading an ascii string.<br>  the string is made of a series of words delimited by spaces, tabs or commas<br>  in any order, optionally terminated by ‘\\r’ and/or ‘\\n’, each consisting of :</p>\n<ul>\n<li><p>an ascii representation of a positive integer percentage, e.g. “75%”.<br>values in this format will set the weight proportional to the initial<br>weight of a server as configured when haproxy starts. note that a zero<br>weight is reported on the stats page as “drain” since it has the same<br>effect on the server (it’s removed from the lb farm).</p>\n</li>\n<li><p>the word “ready”. this will turn the server’s administrative state to the<br>ready mode, thus cancelling any drain or maint state</p>\n</li>\n<li><p>the word “drain”. this will turn the server’s administrative state to the<br>drain mode, thus it will not accept any new connections other than those<br>that are accepted via persistence.</p>\n</li>\n<li><p>the word “maint”. this will turn the server’s administrative state to the<br>maint mode, thus it will not accept any new connections at all, and health<br>checks will be stopped.</p>\n</li>\n<li><p>the words “down”, “failed”, or “stopped”, optionally followed by a<br>description string after a sharp (‘#’). all of these mark the server’s<br>operating state as down, but since the word itself is reported on the stats<br>page, the difference allows an administrator to know if the situation was<br>expected or not : the service may intentionally be stopped, may appear up<br>but fail some validity tests, or may be seen as down (eg: missing process,<br>or port not responding).</p>\n</li>\n<li><p>the word “up” sets back the server’s operating state as up if health checks<br>also report that the service is accessible.</p>\n<p>parameters which are not advertised by the agent are not changed. for<br>example, an agent might be designed to monitor cpu usage and only report a<br>relative weight and never interact with the operating status. similarly, an<br>agent could be designed as an end-user interface with 3 radio buttons<br>allowing an administrator to change only the administrative state. however,<br>it is important to consider that only the agent may revert its own actions,<br>so if a server is set to drain mode or to down state using the agent, the<br>agent must implement the other equivalent actions to bring the service into<br>operations again.</p>\n<p>failure to connect to the agent is not considered an error as connectivity<br>is tested by the regular health check which is enabled by the “check”<br>parameter. warning though, it is not a good idea to stop an agent after it<br>reports “down”, since only an agent reporting “up” will be able to turn the<br>server up again. note that the cli on the unix stats socket is also able to<br>force an agent’s result in order to workaround a bogus agent if needed.</p>\n<p>requires the “agent-port” parameter to be set. see also the “agent-inter”<br>parameter.</p>\n<p>supported in default-server: no</p>\n</li>\n</ul>\n<p>agent-inter <delay><br>  the “agent-inter” parameter sets the interval between two agent checks<br>  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.</p>\n<p>  just as with every other time-based parameter, it may be entered in any<br>  other explicit unit among { us, ms, s, m, h, d }. the “agent-inter”<br>  parameter also serves as a timeout for agent checks “timeout check” is<br>  not set. in order to reduce “resonance” effects when multiple servers are<br>  hosted on the same hardware, the agent and health checks of all servers<br>  are started with a small time offset between them. it is also possible to<br>  add some random noise in the agent and health checks interval using the<br>  global “spread-checks” keyword. this makes sense for instance when a lot<br>  of backends use the same servers.</p>\n<p>  see also the “agent-check” and “agent-port” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>agent-port <port><br>  the “agent-port” parameter sets the tcp port used for agent checks.</p>\n<p>  see also the “agent-check” and “agent-inter” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>backup<br>  when “backup” is present on a server line, the server is only used in load<br>  balancing when all other non-backup servers are unavailable. requests coming<br>  with a persistence cookie referencing the server will always be served<br>  though. by default, only the first operational backup server is used, unless<br>  the “allbackups” option is set in the backend. see also the “allbackups”<br>  option.</p>\n<p>  supported in default-server: no</p>\n<p>ca-file <cafile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load ca certificates used to verify<br>  server’s certificate.</p>\n<p>  supported in default-server: no</p>\n<p>check<br>  this option enables health checks on the server. by default, a server is<br>  always considered available. if “check” is set, the server is available when<br>  accepting periodic tcp connections, to ensure that it is really able to serve<br>  requests. the default address and port to send the tests to are those of the<br>  server, and the default source is the same as the one defined in the<br>  backend. it is possible to change the address using the “addr” parameter, the<br>  port using the “port” parameter, the source address using the “source”<br>  address, and the interval and timers using the “inter”, “rise” and “fall”<br>  parameters. the request method is define in the backend using the “httpchk”,<br>  “smtpchk”, “mysql-check”, “pgsql-check” and “ssl-hello-chk” options. please<br>  refer to those options and parameters for more information.</p>\n<p>  supported in default-server: no</p>\n<p>check-send-proxy<br>  this option forces emission of a proxy protocol line with outgoing health<br>  checks, regardless of whether the server uses send-proxy or not for the<br>  normal traffic. by default, the proxy protocol is enabled for health checks<br>  if it is already enabled for normal traffic and if no “port” nor “addr”<br>  directive is present. however, if such a directive is present, the<br>  “check-send-proxy” option needs to be used to force the use of the<br>  protocol. see also the “send-proxy” option for more information.</p>\n<p>  supported in default-server: no</p>\n<p>check-ssl<br>  this option forces encryption of all health checks over ssl, regardless of<br>  whether the server uses ssl or not for the normal traffic. this is generally<br>  used when an explicit “port” or “addr” directive is specified and ssl health<br>  checks are not inherited. it is important to understand that this option<br>  inserts an ssl transport layer below the checks, so that a simple tcp connect<br>  check becomes an ssl connect, which replaces the old ssl-hello-chk. the most<br>  common use is to send https checks by combining “httpchk” with ssl checks.<br>  all ssl settings are common to health checks and traffic (eg: ciphers).<br>  see the “ssl” option for more information.</p>\n<p>  supported in default-server: no</p>\n<p>ciphers <ciphers><br>  this option sets the string describing the list of cipher algorithms that is<br>  is negotiated during the ssl/tls handshake with the server. the format of the<br>  string is defined in “man 1 ciphers”. when ssl is used to communicate with<br>  servers on the local network, it is common to see a weaker set of algorithms<br>  than what is used over the internet. doing so reduces cpu usage on both the<br>  server and haproxy while still keeping it compatible with deployed software.<br>  some algorithms such as rc4-sha1 are reasonably cheap. if no security at all<br>  is needed and just connectivity, using des can be appropriate.</p>\n<p>  supported in default-server: no</p>\n<p>cookie <value><br>  the “cookie” parameter sets the cookie value assigned to the server to<br>  <value>. this value will be checked in incoming requests, and the first<br>  operational server possessing the same value will be selected. in return, in<br>  cookie insertion or rewrite modes, this value will be assigned to the cookie<br>  sent to the client. there is nothing wrong in having several servers sharing<br>  the same cookie value, and it is in fact somewhat common between normal and<br>  backup servers. see also the “cookie” keyword in backend section.</p>\n<p>  supported in default-server: no</p>\n<p>crl-file <crlfile><br>  this setting is only available when support for openssl was built in. it<br>  designates a pem file from which to load certificate revocation list used<br>  to verify server’s certificate.</p>\n<p>  supported in default-server: no</p>\n<p>crt <cert><br>  this setting is only available when support for openssl was built in.<br>  it designates a pem file from which to load both a certificate and the<br>  associated private key. this file can be built by concatenating both pem<br>  files into one. this certificate will be sent if the server send a client<br>  certificate request.</p>\n<p>  supported in default-server: no</p>\n<p>disabled<br>  the “disabled” keyword starts the server in the “disabled” state. that means<br>  that it is marked down in maintenance mode, and no connection other than the<br>  ones allowed by persist mode will reach it. it is very well suited to setup<br>  new servers, because normal traffic will never reach them, while it is still<br>  possible to test the service by making use of the force-persist mechanism.</p>\n<p>  supported in default-server: no</p>\n<p>error-limit <count><br>  if health observing is enabled, the “error-limit” parameter specifies the<br>  number of consecutive errors that triggers event selected by the “on-error”<br>  option. by default it is set to 10 consecutive errors.</p>\n<p>  supported in default-server: yes</p>\n<p>  see also the “check”, “error-limit” and “on-error”.</p>\n<p>fall <count><br>  the “fall” parameter states that a server will be considered as dead after<br>  <count> consecutive unsuccessful health checks. this value defaults to 3 if<br>  unspecified. see also the “check”, “inter” and “rise” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>force-sslv3<br>  this option enforces use of sslv3 only when ssl is used to communicate with<br>  the server. sslv3 is generally less expensive than the tls counterparts for<br>  high connection rates. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv10<br>  this option enforces use of tlsv1.0 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv11<br>  this option enforces use of tlsv1.1 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>force-tlsv12<br>  this option enforces use of tlsv1.2 only when ssl is used to communicate with<br>  the server. this option is also available on global statement<br>  “ssl-default-server-options”. see also “no-tlsv*”, “no-sslv3”.</p>\n<p>  supported in default-server: no</p>\n<p>id <value><br>  set a persistent id for the server. this id must be positive and unique for<br>  the proxy. an unused id will automatically be assigned if unset. the first<br>  assigned value will be 1. this id is currently only returned in statistics.</p>\n<p>  supported in default-server: no</p>\n<p>inter <delay><br>fastinter <delay><br>downinter <delay><br>  the “inter” parameter sets the interval between two consecutive health checks<br>  to <delay> milliseconds. if left unspecified, the delay defaults to 2000 ms.<br>  it is also possible to use “fastinter” and “downinter” to optimize delays<br>  between checks depending on the server state :</p>\n<pre><code>         server state            |             interval used\n---------------------------------+-----------------------------------------\n up 100% (non-transitional)      | &quot;inter&quot;\n---------------------------------+-----------------------------------------\n transitionally up (going down), |\n transitionally down (going up), | &quot;fastinter&quot; if set, &quot;inter&quot; otherwise.\n or yet unchecked.               |\n---------------------------------+-----------------------------------------\n down 100% (non-transitional)    | &quot;downinter&quot; if set, &quot;inter&quot; otherwise.\n---------------------------------+-----------------------------------------\n</code></pre><p>  just as with every other time-based parameter, they can be entered in any<br>  other explicit unit among { us, ms, s, m, h, d }. the “inter” parameter also<br>  serves as a timeout for health checks sent to servers if “timeout check” is<br>  not set. in order to reduce “resonance” effects when multiple servers are<br>  hosted on the same hardware, the agent and health checks of all servers<br>  are started with a small time offset between them. it is also possible to<br>  add some random noise in the agent and health checks interval using the<br>  global “spread-checks” keyword. this makes sense for instance when a lot<br>  of backends use the same servers.</p>\n<p>  supported in default-server: yes</p>\n<p>maxconn <maxconn><br>  the “maxconn” parameter specifies the maximal number of concurrent<br>  connections that will be sent to this server. if the number of incoming<br>  concurrent requests goes higher than this value, they will be queued, waiting<br>  for a connection to be released. this parameter is very important as it can<br>  save fragile servers from going down under extreme loads. if a “minconn”<br>  parameter is specified, the limit becomes dynamic. the default value is “0”<br>  which means unlimited. see also the “minconn” and “maxqueue” parameters, and<br>  the backend’s “fullconn” keyword.</p>\n<p>  supported in default-server: yes</p>\n<p>maxqueue <maxqueue><br>  the “maxqueue” parameter specifies the maximal number of connections which<br>  will wait in the queue for this server. if this limit is reached, next<br>  requests will be redispatched to other servers instead of indefinitely<br>  waiting to be served. this will break persistence but may allow people to<br>  quickly re-log in when the server they try to connect to is dying. the<br>  default value is “0” which means the queue is unlimited. see also the<br>  “maxconn” and “minconn” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>minconn <minconn><br>  when the “minconn” parameter is set, the maxconn limit becomes a dynamic<br>  limit following the backend’s load. the server will always accept at least<br>  <minconn> connections, never more than <maxconn>, and the limit will be on<br>  the ramp between both values when the backend has less than <fullconn><br>  concurrent connections. this makes it possible to limit the load on the<br>  server during normal loads, but push it further for important loads without<br>  overloading the server during exceptional loads. see also the “maxconn”<br>  and “maxqueue” parameters, as well as the “fullconn” backend keyword.</p>\n<p>  supported in default-server: yes</p>\n<p>no-ssl-reuse<br>  this option disables ssl session reuse when ssl is used to communicate with<br>  the server. it will force the server to perform a full handshake for every<br>  new connection. it’s probably only useful for benchmarking, troubleshooting,<br>  and for paranoid users.</p>\n<p>  supported in default-server: no</p>\n<p>no-sslv3<br>  this option disables support for sslv3 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tls-tickets<br>  this setting is only available when support for openssl was built in. it<br>  disables the stateless session resumption (rfc 5077 tls ticket<br>  extension) and force to use stateful session resumption. stateless<br>  session resumption is more expensive in cpu usage for servers. this option<br>  is also available on global statement “ssl-default-server-options”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv10<br>  this option disables support for tlsv1.0 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv11<br>  this option disables support for tlsv1.1 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>no-tlsv12<br>  this option disables support for tlsv1.2 when ssl is used to communicate with<br>  the server. note that sslv2 is disabled in the code and cannot be enabled<br>  using any configuration option. tlsv1 is more expensive than sslv3 so it<br>  often makes sense to disable it when communicating with local servers. this<br>  option is also available on global statement “ssl-default-server-options”.<br>  see also “force-sslv3”, “force-tlsv*”.</p>\n<p>  supported in default-server: no</p>\n<p>non-stick<br>  never add connections allocated to this sever to a stick-table.<br>  this may be used in conjunction with backup to ensure that<br>  stick-table persistence is disabled for backup servers.</p>\n<p>  supported in default-server: no</p>\n<p>observe <mode><br>  this option enables health adjusting based on observing communication with<br>  the server. by default this functionality is disabled and enabling it also<br>  requires to enable health checks. there are two supported modes: “layer4” and<br>  “layer7”. in layer4 mode, only successful/unsuccessful tcp connections are<br>  significant. in layer7, which is only allowed for http proxies, responses<br>  received from server are verified, like valid/wrong http code, unparsable<br>  headers, a timeout, etc. valid status codes include 100 to 499, 501 and 505.</p>\n<p>  supported in default-server: no</p>\n<p>  see also the “check”, “on-error” and “error-limit”.</p>\n<p>on-error <mode><br>  select what should happen when enough consecutive errors are detected.<br>  currently, four modes are available:</p>\n<ul>\n<li>fastinter: force fastinter</li>\n<li>fail-check: simulate a failed check, also forces fastinter (default)</li>\n<li>sudden-death: simulate a pre-fatal failed health check, one more failed<br>check will mark a server down, forces fastinter</li>\n<li><p>mark-down: mark the server immediately down and force fastinter</p>\n<p>supported in default-server: yes</p>\n<p>see also the “check”, “observe” and “error-limit”.</p>\n</li>\n</ul>\n<p>on-marked-down <action><br>  modify what occurs when a server is marked down.<br>  currently one action is available:</p>\n<ul>\n<li><p>shutdown-sessions: shutdown peer sessions. when this setting is enabled,<br>all connections to the server are immediately terminated when the server<br>goes down. it might be used if the health check detects more complex cases<br>than a simple connection status, and long timeouts would cause the service<br>to remain unresponsive for too long a time. for instance, a health check<br>might detect that a database is stuck and that there’s no chance to reuse<br>existing connections anymore. connections killed this way are logged with<br>a ‘d’ termination code (for “down”).</p>\n<p>actions are disabled by default</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>on-marked-up <action><br>  modify what occurs when a server is marked up.<br>  currently one action is available:</p>\n<ul>\n<li><p>shutdown-backup-sessions: shutdown sessions on all backup servers. this is<br>done only if the server is not in backup state and if it is not disabled<br>(it must have an effective weight &gt; 0). this can be used sometimes to force<br>an active server to take all the traffic back after recovery when dealing<br>with long sessions (eg: ldap, sql, …). doing this can cause more trouble<br>than it tries to solve (eg: incomplete transactions), so use this feature<br>with extreme care. sessions killed because a server comes up are logged<br>with an ‘u’ termination code (for “up”).</p>\n<p>actions are disabled by default</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>port <port><br>  using the “port” parameter, it becomes possible to use a different port to<br>  send health-checks. on some servers, it may be desirable to dedicate a port<br>  to a specific component able to perform complex tests which are more suitable<br>  to health-checks than the application. it is common to run a simple script in<br>  inetd for instance. this parameter is ignored if the “check” parameter is not<br>  set. see also the “addr” parameter.</p>\n<p>  supported in default-server: yes</p>\n<p>redir <prefix><br>  the “redir” parameter enables the redirection mode for all get and head<br>  requests addressing this server. this means that instead of having haproxy<br>  forward the request to the server, it will send an “http 302” response with<br>  the “location” header composed of this prefix immediately followed by the<br>  requested uri beginning at the leading ‘/‘ of the path component. that means<br>  that no trailing slash should be used after <prefix>. all invalid requests<br>  will be rejected, and all non-get or head requests will be normally served by<br>  the server. note that since the response is completely forged, no header<br>  mangling nor cookie insertion is possible in the response. however, cookies in<br>  requests are still analysed, making this solution completely usable to direct<br>  users to a remote location in case of local disaster. main use consists in<br>  increasing bandwidth for static servers by having the clients directly<br>  connect to them. note: never use a relative location here, it would cause a<br>  loop between the client and haproxy!</p>\n<p>  example :  server srv1 192.168.1.1:80 redir <a href=\"http://image1.mydomain.com\">http://image1.mydomain.com</a> check</p>\n<p>  supported in default-server: no</p>\n<p>rise <count><br>  the “rise” parameter states that a server will be considered as operational<br>  after <count> consecutive successful health checks. this value defaults to 2<br>  if unspecified. see also the “check”, “inter” and “fall” parameters.</p>\n<p>  supported in default-server: yes</p>\n<p>resolve-prefer <family><br>  when dns resolution is enabled for a server and multiple ip addresses from<br>  different families are returned, haproxy will prefer using an ip address<br>  from the family mentioned in the “resolve-prefer” parameter.<br>  available families: “ipv4” and “ipv6”</p>\n<p>  default value: ipv4</p>\n<p>  example: server s1 app1.domain.com:80 resolvers mydns resolve-prefer ipv6</p>\n<p>resolvers <id><br>  points to an existing “resolvers” section to resolve current server’s<br>  hostname.</p>\n<p>  example: server s1 app1.domain.com:80 resolvers mydns</p>\n<p>  see also chapter 5.3</p>\n<p>send-proxy<br>  the “send-proxy” parameter enforces use of the proxy protocol over any<br>  connection established to this server. the proxy protocol informs the other<br>  end about the layer 3/4 addresses of the incoming connection, so that it can<br>  know the client’s address or the public address it accessed to, whatever the<br>  upper layer protocol. for connections accepted by an “accept-proxy” listener,<br>  the advertised address will be used. only tcpv4 and tcpv6 address families<br>  are supported. other families such as unix sockets, will report an unknown<br>  family. servers using this option can fully be chained to another instance of<br>  haproxy listening with an “accept-proxy” setting. this setting must not be<br>  used if the server isn’t aware of the protocol. when health checks are sent<br>  to the server, the proxy protocol is automatically used when this option is<br>  set, unless there is an explicit “port” or “addr” directive, in which case an<br>  explicit “check-send-proxy” directive would also be needed to use the proxy<br>  protocol. see also the “accept-proxy” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2<br>  the “send-proxy-v2” parameter enforces use of the proxy protocol version 2<br>  over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. this setting must not be used if the<br>  server isn’t aware of this version of the protocol. see also the “send-proxy”<br>  option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2-ssl<br>  the “send-proxy-v2-ssl” parameter enforces use of the proxy protocol version<br>  2 over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. in addition, the ssl information extension<br>  of the proxy protocol is added to the proxy protocol header. this setting<br>  must not be used if the server isn’t aware of this version of the protocol.<br>  see also the “send-proxy-v2” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>send-proxy-v2-ssl-cn<br>  the “send-proxy-v2-ssl” parameter enforces use of the proxy protocol version<br>  2 over any connection established to this server. the proxy protocol informs<br>  the other end about the layer 3/4 addresses of the incoming connection, so<br>  that it can know the client’s address or the public address it accessed to,<br>  whatever the upper layer protocol. in addition, the ssl information extension<br>  of the proxy protocol, along along with the common name from the subject of<br>  the client certificate (if any), is added to the proxy protocol header. this<br>  setting must not be used if the server isn’t aware of this version of the<br>  protocol. see also the “send-proxy-v2” option of the “bind” keyword.</p>\n<p>  supported in default-server: no</p>\n<p>slowstart <start_time_in_ms><br>  the “slowstart” parameter for a server accepts a value in milliseconds which<br>  indicates after how long a server which has just come back up will run at<br>  full speed. just as with every other time-based parameter, it can be entered<br>  in any other explicit unit among { us, ms, s, m, h, d }. the speed grows<br>  linearly from 0 to 100% during this time. the limitation applies to two<br>  parameters :</p>\n<ul>\n<li><p>maxconn: the number of connections accepted by the server will grow from 1<br>to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).</p>\n</li>\n<li><p>weight: when the backend uses a dynamic weighted algorithm, the weight<br>grows linearly from 1 to 100%. in this case, the weight is updated at every<br>health-check. for this reason, it is important that the “inter” parameter<br>is smaller than the “slowstart”, in order to maximize the number of steps.</p>\n<p>the slowstart never applies when haproxy starts, otherwise it would cause<br>trouble to running servers. it only applies when a server has been previously<br>seen as failed.</p>\n<p>supported in default-server: yes</p>\n</li>\n</ul>\n<p>sni <expression><br>  the “sni” parameter evaluates the sample fetch expression, converts it to a<br>  string and uses the result as the host name sent in the sni tls extension to<br>  the server. a typical use case is to send the sni received from the client in<br>  a bridged https scenario, using the “ssl_fc_sni” sample fetch for the<br>  expression, though alternatives such as req.hdr(host) can also make sense.</p>\n<p>  supported in default-server: no</p>\n<p>source <addr>[:<pl>[-<ph>]] [usesrc { <addr2>[:<port2>] | client | clientip } ]<br>source <addr>[:<port>] [usesrc { <addr2>[:<port2>] | hdr_ip(<hdr>[,<occ>]) } ]<br>source <addr>[:<pl>[-<ph>]] [interface <name>] …<br>  the “source” parameter sets the source address which will be used when<br>  connecting to the server. it follows the exact same parameters and principle<br>  as the backend “source” keyword, except that it only applies to the server<br>  referencing it. please consult the “source” keyword for details.</p>\n<p>  additionally, the “source” statement on a server line allows one to specify a<br>  source port range by indicating the lower and higher bounds delimited by a<br>  dash (‘-‘). some operating systems might require a valid ip address when a<br>  source port range is specified. it is permitted to have the same ip/range for<br>  several servers. doing so makes it possible to bypass the maximum of 64k<br>  total concurrent connections. the limit will then reach 64k connections per<br>  server.</p>\n<p>  supported in default-server: no</p>\n<p>ssl<br>  this option enables ssl ciphering on outgoing connections to the server. it<br>  is critical to verify server certificates using “verify” when using ssl to<br>  connect to servers, otherwise the communication is prone to trivial man in<br>  the-middle attacks rendering ssl useless. when this option is used, health<br>  checks are automatically sent in ssl too unless there is a “port” or an<br>  “addr” directive indicating the check should be sent to a different location.<br>  see the “check-ssl” option to force ssl health checks.</p>\n<p>  supported in default-server: no</p>\n<p>track [<proxy>/]<server><br>  this option enables ability to set the current state of the server by tracking<br>  another one. it is possible to track a server which itself tracks another<br>  server, provided that at the end of the chain, a server has health checks<br>  enabled. if <proxy> is omitted the current one is used. if disable-on-404 is<br>  used, it has to be enabled on both proxies.</p>\n<p>  supported in default-server: no</p>\n<p>verify [none|required]<br>  this setting is only available when support for openssl was built in. if set<br>  to ‘none’, server certificate is not verified. in the other case, the<br>  certificate provided by the server is verified using cas from ‘ca-file’<br>  and optional crls from ‘crl-file’. if ‘ssl_server_verify’ is not specified<br>  in global  section, this is the default. on verify failure the handshake<br>  is aborted. it is critically important to verify server certificates when<br>  using ssl to connect to servers, otherwise the communication is prone to<br>  trivial man-in-the-middle attacks rendering ssl totally useless.</p>\n<p>  supported in default-server: no</p>\n<p>verifyhost <hostname><br>  this setting is only available when support for openssl was built in, and<br>  only takes effect if ‘verify required’ is also specified. when set, the<br>  hostnames in the subject and subjectalternatenames of the certificate<br>  provided by the server are checked. if none of the hostnames in the<br>  certificate match the specified hostname, the handshake is aborted. the<br>  hostnames in the server-provided certificate may include wildcards.</p>\n<p>  supported in default-server: no</p>\n<p>weight <weight><br>  the “weight” parameter is used to adjust the server’s weight relative to<br>  other servers. all servers will receive a load proportional to their weight<br>  relative to the sum of all weights, so the higher the weight, the higher the<br>  load. the default weight is 1, and the maximal value is 256. a value of 0<br>  means the server will not participate in load-balancing but will still accept<br>  persistent connections. if this parameter is used to distribute the load<br>  according to server’s capacity, it is recommended to start with values which<br>  can both grow and shrink, for instance between 10 and 100 to leave enough<br>  room above and below for later adjustments.</p>\n<p>  supported in default-server: yes</p>\n<h2 id=\"5-3-server-ip-address-resolution-using-dns\"><a href=\"#5-3-server-ip-address-resolution-using-dns\" class=\"headerlink\" title=\"5.3. server ip address resolution using dns\"></a>5.3. server ip address resolution using dns</h2><p>haproxy allows using a host name to be resolved to find out what is the server<br>ip address. by default, haproxy resolves the name when parsing the<br>configuration, at startup.<br>this is not sufficient in some cases, such as in amazon where a server’s ip<br>can change after a reboot or an elb virtual ip can change based on current<br>workload.<br>this chapter describes how haproxy can be configured to process server’s name<br>resolution at run time.<br>whether run time server name resolution has been enable or not, haproxy will<br>carry on doing the first resolution when parsing the configuration.</p>\n<h2 id=\"5-3-1-global-overview\"><a href=\"#5-3-1-global-overview\" class=\"headerlink\" title=\"5.3.1. global overview\"></a>5.3.1. global overview</h2><p>as we’ve seen in introduction, name resolution in haproxy occurs at two<br>different steps of the process life:</p>\n<p>  1. when starting up, haproxy parses the server line definition and matches a<br>     host name. it uses libc functions to get the host name resolved. this<br>     resolution relies on /etc/resolv.conf file.</p>\n<p>  2. at run time, when haproxy gets prepared to run a health check on a server,<br>     it verifies if the current name resolution is still considered as valid.<br>     if not, it processes a new resolution, in parallel of the health check.</p>\n<p>a few other events can trigger a name resolution at run time:</p>\n<ul>\n<li>when a server’s health check ends up in a connection timeout: this may be<br>because the server has a new ip address. so we need to trigger a name<br>resolution to know this new ip.</li>\n</ul>\n<p>a few things important to notice:</p>\n<ul>\n<li><p>all the name servers are queried in the mean time. haproxy will process the<br>first valid response.</p>\n</li>\n<li><p>a resolution is considered as invalid (nx, timeout, refused), when all the<br>servers return an error.</p>\n</li>\n</ul>\n<h2 id=\"5-3-2-the-resolvers-section\"><a href=\"#5-3-2-the-resolvers-section\" class=\"headerlink\" title=\"5.3.2. the resolvers section\"></a>5.3.2. the resolvers section</h2><p>this section is dedicated to host information related to name resolution in<br>haproxy.<br>there can be as many as resolvers section as needed. each section can contain<br>many name servers.</p>\n<p>resolvers <resolvers id><br>  creates a new name server list labelled <resolvers id></p>\n<p>a resolvers section accept the following parameters:</p>\n<p>nameserver <id> <ip>:<port><br>  dns server description:<br>    <id>   : label of the server, should be unique<br>    <ip>   : ip address of the server<br>    <port> : port where the dns service actually runs</p>\n<p>hold <status> <period><br>  defines <period> during which the last name resolution should be kept based<br>  on last resolution <status><br>    <status> : last name resolution status. only “valid” is accepted for now.<br>    <period> : interval between two successive name resolution when the last<br>               answer was in <status>. it follows the haproxy time format.<br>               <period> is in milliseconds by default.</p>\n<p>  default value is 10s for “valid”.</p>\n<p>  note: since the name resolution is triggered by the health checks, a new<br>        resolution is triggered after <period> modulo the <inter> parameter of<br>        the healch check.</p>\n<p>resolve_retries <nb><br>  defines the number <nb> of queries to send to resolve a server name before<br>  giving up.<br>  default value: 3</p>\n<p>timeout <event> <time><br>  defines timeouts related to name resolution<br>     <event> : the event on which the <time> timeout period applies to.<br>               events available are:</p>\n<pre><code>          - retry: time between two dns queries, when no response have\n                   been received.\n                   default value: 1s\n&lt;time&gt;  : time related to the event. it follows the haproxy time format.\n          &lt;time&gt; is expressed in milliseconds.\n</code></pre><p>example of a resolvers section (with default values):</p>\n<p>   resolvers mydns<br>     nameserver dns1 10.0.0.1:53<br>     nameserver dns2 10.0.0.2:53<br>     resolve_retries       3<br>     timeout retry         1s<br>     hold valid           10s</p>\n<h2 id=\"6-http-header-manipulation\"><a href=\"#6-http-header-manipulation\" class=\"headerlink\" title=\"6. http header manipulation\"></a>6. http header manipulation</h2><p>in http mode, it is possible to rewrite, add or delete some of the request and<br>response headers based on regular expressions. it is also possible to block a<br>request or a response if a particular header matches a regular expression,<br>which is enough to stop most elementary protocol attacks, and to protect<br>against information leak from the internal network.</p>\n<p>if haproxy encounters an “informational response” (status code 1xx), it is able<br>to process all rsp* rules which can allow, deny, rewrite or delete a header,<br>but it will refuse to add a header to any such messages as this is not<br>http-compliant. the reason for still processing headers in such responses is to<br>stop and/or fix any possible information leak which may happen, for instance<br>because another downstream equipment would unconditionally add a header, or if<br>a server name appears there. when such messages are seen, normal processing<br>still occurs on the next non-informational messages.</p>\n<p>this section covers common usage of the following keywords, described in detail<br>in section 4.2 :</p>\n<ul>\n<li>reqadd     <string></li>\n<li>reqallow   <search></li>\n<li>reqiallow  <search></li>\n<li>reqdel     <search></li>\n<li>reqidel    <search></li>\n<li>reqdeny    <search></li>\n<li>reqideny   <search></li>\n<li>reqpass    <search></li>\n<li>reqipass   <search></li>\n<li>reqrep     <search> <replace></li>\n<li>reqirep    <search> <replace></li>\n<li>reqtarpit  <search></li>\n<li>reqitarpit <search></li>\n<li>rspadd     <string></li>\n<li>rspdel     <search></li>\n<li>rspidel    <search></li>\n<li>rspdeny    <search></li>\n<li>rspideny   <search></li>\n<li>rsprep     <search> <replace></li>\n<li>rspirep    <search> <replace></li>\n</ul>\n<p>with all these keywords, the same conventions are used. the <search> parameter<br>is a posix extended regular expression (regex) which supports grouping through<br>parenthesis (without the backslash). spaces and other delimiters must be<br>prefixed with a backslash (‘\\’) to avoid confusion with a field delimiter.<br>other characters may be prefixed with a backslash to change their meaning :</p>\n<p>  \\t   for a tab<br>  \\r   for a carriage return (cr)<br>  \\n   for a new line (lf)<br>  \\    to mark a space and differentiate it from a delimiter<br>  #   to mark a sharp and differentiate it from a comment<br>  \\   to use a backslash in a regex<br>  \\\\ to use a backslash in the text (<em>2 for regex, </em>2 for haproxy)<br>  \\xxx to write the ascii hex code xx as in the c language</p>\n<p>the <replace> parameter contains the string to be used to replace the largest<br>portion of text matching the regex. it can make use of the special characters<br>above, and can reference a substring which is delimited by parenthesis in the<br>regex, by writing a backslash (‘\\’) immediately followed by one digit from 0 to<br>9 indicating the group position (0 designating the entire line). this practice<br>is very common to users of the “sed” program.</p>\n<p>the <string> parameter represents the string which will systematically be added<br>after the last header line. it can also use special character sequences above.</p>\n<h2 id=\"notes-related-to-these-keywords\"><a href=\"#notes-related-to-these-keywords\" class=\"headerlink\" title=\"notes related to these keywords :\"></a>notes related to these keywords :</h2><ul>\n<li><p>these keywords are not always convenient to allow/deny based on header<br>contents. it is strongly recommended to use acls with the “block” keyword<br>instead, resulting in far more flexible and manageable rules.</p>\n</li>\n<li><p>lines are always considered as a whole. it is not possible to reference<br>a header name only or a value only. this is important because of the way<br>headers are written (notably the number of spaces after the colon).</p>\n</li>\n<li><p>the first line is always considered as a header, which makes it possible to<br>rewrite or filter http requests uris or response codes, but in turn makes<br>it harder to distinguish between headers and request line. the regex prefix<br>^[^\\ \\t]<em>[\\ \\t] matches any http method followed by a space, and the prefix<br>^[^ \\t:]</em>: matches any header name followed by a colon.</p>\n</li>\n<li><p>for performances reasons, the number of characters added to a request or to<br>a response is limited at build time to values between 1 and 4 kb. this<br>should normally be far more than enough for most usages. if it is too short<br>on occasional usages, it is possible to gain some space by removing some<br>useless headers before adding new ones.</p>\n</li>\n<li><p>keywords beginning with “reqi” and “rspi” are the same as their counterpart<br>without the ‘i’ letter except that they ignore case when matching patterns.</p>\n</li>\n<li><p>when a request passes through a frontend then a backend, all req<em> rules<br>from the frontend will be evaluated, then all req</em> rules from the backend<br>will be evaluated. the reverse path is applied to responses.</p>\n</li>\n<li><p>req* statements are applied after “block” statements, so that “block” is<br>always the first one, but before “use_backend” in order to permit rewriting<br>before switching.</p>\n</li>\n</ul>\n<h2 id=\"7-using-acls-and-fetching-samples\"><a href=\"#7-using-acls-and-fetching-samples\" class=\"headerlink\" title=\"7. using acls and fetching samples\"></a>7. using acls and fetching samples</h2><p>haproxy is capable of extracting data from request or response streams, from<br>client or server information, from tables, environmental information etc…<br>the action of extracting such data is called fetching a sample. once retrieved,<br>these samples may be used for various purposes such as a key to a stick-table,<br>but most common usages consist in matching them against predefined constant<br>data called patterns.</p>\n<h2 id=\"7-1-acl-basics\"><a href=\"#7-1-acl-basics\" class=\"headerlink\" title=\"7.1. acl basics\"></a>7.1. acl basics</h2><p>the use of access control lists (acl) provides a flexible solution to perform<br>content switching and generally to take decisions based on content extracted<br>from the request, the response or any environmental status. the principle is<br>simple :</p>\n<ul>\n<li>extract a data sample from a stream, table or the environment</li>\n<li>optionally apply some format conversion to the extracted sample</li>\n<li>apply one or multiple pattern matching methods on this sample</li>\n<li>perform actions only when a pattern matches the sample</li>\n</ul>\n<p>the actions generally consist in blocking a request, selecting a backend, or<br>adding a header.</p>\n<p>in order to define a test, the “acl” keyword is used. the syntax is :</p>\n<p>   acl <aclname> <criterion> [flags] [operator] [<value>] …</p>\n<p>this creates a new acl <aclname> or completes an existing one with new tests.<br>those tests apply to the portion of request/response specified in <criterion><br>and may be adjusted with optional flags [flags]. some criteria also support<br>an operator which may be specified before the set of values. optionally some<br>conversion operators may be applied to the sample, and they will be specified<br>as a comma-delimited list of keywords just after the first keyword. the values<br>are of the type supported by the criterion, and are separated by spaces.</p>\n<p>acl names must be formed from upper and lower case letters, digits, ‘-‘ (dash),<br>‘_’ (underscore) , ‘.’ (dot) and ‘:’ (colon). acl names are case-sensitive,<br>which means that “my_acl” and “my_acl” are two different acls.</p>\n<p>there is no enforced limit to the number of acls. the unused ones do not affect<br>performance, they just consume a small amount of memory.</p>\n<p>the criterion generally is the name of a sample fetch method, or one of its acl<br>specific declinations. the default test method is implied by the output type of<br>this sample fetch method. the acl declinations can describe alternate matching<br>methods of a same sample fetch method. the sample fetch methods are the only<br>ones supporting a conversion.</p>\n<p>sample fetch methods return data which can be of the following types :</p>\n<ul>\n<li>boolean</li>\n<li>integer (signed or unsigned)</li>\n<li>ipv4 or ipv6 address</li>\n<li>string</li>\n<li>data block</li>\n</ul>\n<p>converters transform any of these data into any of these. for example, some<br>converters might convert a string to a lower-case string while other ones<br>would turn a string to an ipv4 address, or apply a netmask to an ip address.<br>the resulting sample is of the type of the last converter applied to the list,<br>which defaults to the type of the sample fetch method.</p>\n<p>each sample or converter returns data of a specific type, specified with its<br>keyword in this documentation. when an acl is declared using a standard sample<br>fetch method, certain types automatically involved a default matching method<br>which are summarized in the table below :</p>\n<p>   +———————+—————–+<br>   | sample or converter | default         |<br>   |    output type      | matching method |<br>   +———————+—————–+<br>   | boolean             | bool            |<br>   +———————+—————–+<br>   | integer             | int             |<br>   +———————+—————–+<br>   | ip                  | ip              |<br>   +———————+—————–+<br>   | string              | str             |<br>   +———————+—————–+<br>   | binary              | none, use “-m”  |<br>   +———————+—————–+</p>\n<p>note that in order to match a binary samples, it is mandatory to specify a<br>matching method, see below.</p>\n<p>the acl engine can match these types against patterns of the following types :</p>\n<ul>\n<li>boolean</li>\n<li>integer or integer range</li>\n<li>ip address / network</li>\n<li>string (exact, substring, suffix, prefix, subdir, domain)</li>\n<li>regular expression</li>\n<li>hex block</li>\n</ul>\n<p>the following acl flags are currently supported :</p>\n<p>   -i : ignore case during matching of all subsequent patterns.<br>   -f : load patterns from a file.<br>   -m : use a specific pattern matching method<br>   -n : forbid the dns resolutions<br>   -m : load the file pointed by -f like a map file.<br>   -u : force the unique id of the acl<br>   – : force end of flags. useful when a string looks like one of the flags.</p>\n<p>the “-f” flag is followed by the name of a file from which all lines will be<br>read as individual values. it is even possible to pass multiple “-f” arguments<br>if the patterns are to be loaded from multiple files. empty lines as well as<br>lines beginning with a sharp (‘#’) will be ignored. all leading spaces and tabs<br>will be stripped. if it is absolutely necessary to insert a valid pattern<br>beginning with a sharp, just prefix it with a space so that it is not taken for<br>a comment. depending on the data type and match method, haproxy may load the<br>lines into a binary tree, allowing very fast lookups. this is true for ipv4 and<br>exact string matching. in this case, duplicates will automatically be removed.</p>\n<p>the “-m” flag allows an acl to use a map file. if this flag is set, the file is<br>parsed as two column file. the first column contains the patterns used by the<br>acl, and the second column contain the samples. the sample can be used later by<br>a map. this can be useful in some rare cases where an acl would just be used to<br>check for the existence of a pattern in a map before a mapping is applied.</p>\n<p>the “-u” flag forces the unique id of the acl. this unique id is used with the<br>socket interface to identify acl and dynamically change its values. note that a<br>file is always identified by its name even if an id is set.</p>\n<p>also, note that the “-i” flag applies to subsequent entries and not to entries<br>loaded from files preceding it. for instance :</p>\n<pre><code>acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test\n</code></pre><p>in this example, each line of “exact-ua.lst” will be exactly matched against<br>the “user-agent” header of the request. then each line of “generic-ua” will be<br>case-insensitively matched. then the word “test” will be insensitively matched<br>as well.</p>\n<p>the “-m” flag is used to select a specific pattern matching method on the input<br>sample. all acl-specific criteria imply a pattern matching method and generally<br>do not need this flag. however, this flag is useful with generic sample fetch<br>methods to describe how they’re going to be matched against the patterns. this<br>is required for sample fetches which return data type for which there is no<br>obvious matching method (eg: string or binary). when “-m” is specified and<br>followed by a pattern matching method name, this method is used instead of the<br>default one for the criterion. this makes it possible to match contents in ways<br>that were not initially planned, or with sample fetch methods which return a<br>string. the matching method also affects the way the patterns are parsed.</p>\n<p>the “-n” flag forbids the dns resolutions. it is used with the load of ip files.<br>by default, if the parser cannot parse ip address it considers that the parsed<br>string is maybe a domain name and try dns resolution. the flag “-n” disable this<br>resolution. it is useful for detecting malformed ip lists. note that if the dns<br>server is not reachable, the haproxy configuration parsing may last many minutes<br>waiting fir the timeout. during this time no error messages are displayed. the<br>flag “-n” disable this behavior. note also that during the runtime, this<br>function is disabled for the dynamic acl modifications.</p>\n<p>there are some restrictions however. not all methods can be used with all<br>sample fetch methods. also, if “-m” is used in conjunction with “-f”, it must<br>be placed first. the pattern matching method must be one of the following :</p>\n<ul>\n<li><p>“found” : only check if the requested sample could be found in the stream,</p>\n<pre><code>but do not compare it against any pattern. it is recommended not\nto pass any pattern to avoid confusion. this matching method is\nparticularly useful to detect presence of certain contents such\nas headers, cookies, etc... even if they are empty and without\ncomparing them to anything nor counting them.\n</code></pre></li>\n<li><p>“bool”  : check the value as a boolean. it can only be applied to fetches</p>\n<pre><code>which return a boolean or integer value, and takes no pattern.\nvalue zero or false does not match, all other values do match.\n</code></pre></li>\n<li><p>“int”   : match the value as an integer. it can be used with integer and</p>\n<pre><code>boolean samples. boolean false is integer 0, true is integer 1.\n</code></pre></li>\n<li><p>“ip”    : match the value as an ipv4 or ipv6 address. it is compatible</p>\n<pre><code>with ip address samples only, so it is implied and never needed.\n</code></pre></li>\n<li><p>“bin”   : match the contents against an hexadecimal string representing a</p>\n<pre><code>binary sequence. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“len”   : match the sample’s length as an integer. this may be used with</p>\n<pre><code>binary or string samples.\n</code></pre></li>\n<li><p>“str”   : exact match : match the contents against a string. this may be</p>\n<pre><code>used with binary or string samples.\n</code></pre></li>\n<li><p>“sub”   : substring match : check that the contents contain at least one of</p>\n<pre><code>the provided string patterns. this may be used with binary or\nstring samples.\n</code></pre></li>\n<li><p>“reg”   : regex match : match the contents against a list of regular</p>\n<pre><code>expressions. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“beg”   : prefix match : check that the contents begin like the provided</p>\n<pre><code>string patterns. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“end”   : suffix match : check that the contents end like the provided</p>\n<pre><code>string patterns. this may be used with binary or string samples.\n</code></pre></li>\n<li><p>“dir”   : subdir match : check that a slash-delimited portion of the</p>\n<pre><code>contents exactly matches one of the provided string patterns.\nthis may be used with binary or string samples.\n</code></pre></li>\n<li><p>“dom”   : domain match : check that a dot-delimited portion of the contents</p>\n<pre><code>exactly match one of the provided string patterns. this may be\nused with binary or string samples.\n</code></pre></li>\n</ul>\n<p>for example, to quickly detect the presence of cookie “jsessionid” in an http<br>request, it is possible to do :</p>\n<pre><code>acl jsess_present cook(jsessionid) -m found\n</code></pre><p>in order to apply a regular expression on the 500 first bytes of data in the<br>buffer, one would use the following acl :</p>\n<pre><code>acl script_tag payload(0,500) -m reg -i &lt;script&gt;\n</code></pre><p>on systems where the regex library is much slower when using “-i”, it is<br>possible to convert the sample to lowercase before matching, like this :</p>\n<pre><code>acl script_tag payload(0,500),lower -m reg &lt;script&gt;\n</code></pre><p>all acl-specific criteria imply a default matching method. most often, these<br>criteria are composed by concatenating the name of the original sample fetch<br>method and the matching method. for example, “hdr_beg” applies the “beg” match<br>to samples retrieved using the “hdr” fetch method. since all acl-specific<br>criteria rely on a sample fetch method, it is always possible instead to use<br>the original sample fetch method and the explicit matching method using “-m”.</p>\n<p>if an alternate match is specified using “-m” on an acl-specific criterion,<br>the matching method is simply applied to the underlying sample fetch method.<br>for example, all acls below are exact equivalent :</p>\n<pre><code>acl short_form  hdr_beg(host)        www.\nacl alternate1  hdr_beg(host) -m beg www.\nacl alternate2  hdr_dom(host) -m beg www.\nacl alternate3  hdr(host)     -m beg www.\n</code></pre><p>the table below summarizes the compatibility matrix between sample or converter<br>types and the pattern types to fetch against. it indicates for each compatible<br>combination the name of the matching method to be used, surrounded with angle<br>brackets “&gt;” and “&lt;” when the method is the default one and will work by<br>default without “-m”.</p>\n<pre><code>                       +-------------------------------------------------+\n                       |                input sample type                |\n+----------------------+---------+---------+---------+---------+---------+\n|     pattern type     | boolean | integer |   ip    | string  | binary  |\n+----------------------+---------+---------+---------+---------+---------+\n| none (presence only) |  found  |  found  |  found  |  found  |  found  |\n+----------------------+---------+---------+---------+---------+---------+\n| none (boolean value) |&gt;  bool &lt;|   bool  |         |   bool  |         |\n+----------------------+---------+---------+---------+---------+---------+\n| integer (value)      |   int   |&gt;  int  &lt;|   int   |   int   |         |\n+----------------------+---------+---------+---------+---------+---------+\n| integer (length)     |   len   |   len   |   len   |   len   |   len   |\n+----------------------+---------+---------+---------+---------+---------+\n| ip address           |         |         |&gt;   ip  &lt;|    ip   |    ip   |\n+----------------------+---------+---------+---------+---------+---------+\n| exact string         |   str   |   str   |   str   |&gt;  str  &lt;|   str   |\n+----------------------+---------+---------+---------+---------+---------+\n| prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |\n+----------------------+---------+---------+---------+---------+---------+\n| suffix               |   end   |   end   |   end   |   end   |   end   |\n+----------------------+---------+---------+---------+---------+---------+\n| substring            |   sub   |   sub   |   sub   |   sub   |   sub   |\n+----------------------+---------+---------+---------+---------+---------+\n| subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |\n+----------------------+---------+---------+---------+---------+---------+\n| domain               |   dom   |   dom   |   dom   |   dom   |   dom   |\n+----------------------+---------+---------+---------+---------+---------+\n| regex                |   reg   |   reg   |   reg   |   reg   |   reg   |\n+----------------------+---------+---------+---------+---------+---------+\n| hex block            |         |         |         |   bin   |   bin   |\n+----------------------+---------+---------+---------+---------+---------+\n</code></pre><h2 id=\"7-1-1-matching-booleans\"><a href=\"#7-1-1-matching-booleans\" class=\"headerlink\" title=\"7.1.1. matching booleans\"></a>7.1.1. matching booleans</h2><p>in order to match a boolean, no value is needed and all values are ignored.<br>boolean matching is used by default for all fetch methods of type “boolean”.<br>when boolean matching is used, the fetched value is returned as-is, which means<br>that a boolean “true” will always match and a boolean “false” will never match.</p>\n<p>boolean matching may also be enforced using “-m bool” on fetch methods which<br>return an integer value. then, integer value 0 is converted to the boolean<br>“false” and all other values are converted to “true”.</p>\n<h2 id=\"7-1-2-matching-integers\"><a href=\"#7-1-2-matching-integers\" class=\"headerlink\" title=\"7.1.2. matching integers\"></a>7.1.2. matching integers</h2><p>integer matching applies by default to integer fetch methods. it can also be<br>enforced on boolean fetches using “-m int”. in this case, “false” is converted<br>to the integer 0, and “true” is converted to the integer 1.</p>\n<p>integer matching also supports integer ranges and operators. note that integer<br>matching only applies to positive values. a range is a value expressed with a<br>lower and an upper bound separated with a colon, both of which may be omitted.</p>\n<p>for instance, “1024:65535” is a valid range to represent a range of<br>unprivileged ports, and “1024:” would also work. “0:1023” is a valid<br>representation of privileged ports, and “:1023” would also work.</p>\n<p>as a special case, some acl functions support decimal numbers which are in fact<br>two integers separated by a dot. this is used with some version checks for<br>instance. all integer properties apply to those decimal numbers, including<br>ranges and operators.</p>\n<p>for an easier usage, comparison operators are also supported. note that using<br>operators with ranges does not make much sense and is strongly discouraged.<br>similarly, it does not make much sense to perform order comparisons with a set<br>of values.</p>\n<p>available operators for integer matching are :</p>\n<p>  eq : true if the tested value equals at least one value<br>  ge : true if the tested value is greater than or equal to at least one value<br>  gt : true if the tested value is greater than at least one value<br>  le : true if the tested value is less than or equal to at least one value<br>  lt : true if the tested value is less than at least one value</p>\n<p>for instance, the following acl matches any negative content-length header :</p>\n<p>  acl negative-length hdr_val(content-length) lt 0</p>\n<p>this one matches ssl versions between 3.0 and 3.1 (inclusive) :</p>\n<p>  acl sslv3 req_ssl_ver 3:3.1</p>\n<h2 id=\"7-1-3-matching-strings\"><a href=\"#7-1-3-matching-strings\" class=\"headerlink\" title=\"7.1.3. matching strings\"></a>7.1.3. matching strings</h2><p>string matching applies to string or binary fetch methods, and exists in 6<br>different forms :</p>\n<ul>\n<li><p>exact match     (-m str) : the extracted string must exactly match the<br>patterns ;</p>\n</li>\n<li><p>substring match (-m sub) : the patterns are looked up inside the<br>extracted string, and the acl matches if any of them is found inside ;</p>\n</li>\n<li><p>prefix match    (-m beg) : the patterns are compared with the beginning of<br>the extracted string, and the acl matches if any of them matches.</p>\n</li>\n<li><p>suffix match    (-m end) : the patterns are compared with the end of the<br>extracted string, and the acl matches if any of them matches.</p>\n</li>\n<li><p>subdir match    (-m sub) : the patterns are looked up inside the extracted<br>string, delimited with slashes (“/“), and the acl matches if any of them<br>matches.</p>\n</li>\n<li><p>domain match    (-m dom) : the patterns are looked up inside the extracted<br>string, delimited with dots (“.”), and the acl matches if any of them<br>matches.</p>\n</li>\n</ul>\n<p>string matching applies to verbatim strings as they are passed, with the<br>exception of the backslash (“\\”) which makes it possible to escape some<br>characters such as the space. if the “-i” flag is passed before the first<br>string, then the matching will be performed ignoring the case. in order<br>to match the string “-i”, either set it second, or pass the “–” flag<br>before the first string. same applies of course to match the string “–”.</p>\n<h2 id=\"7-1-4-matching-regular-expressions-regexes\"><a href=\"#7-1-4-matching-regular-expressions-regexes\" class=\"headerlink\" title=\"7.1.4. matching regular expressions (regexes)\"></a>7.1.4. matching regular expressions (regexes)</h2><p>just like with string matching, regex matching applies to verbatim strings as<br>they are passed, with the exception of the backslash (“\\”) which makes it<br>possible to escape some characters such as the space. if the “-i” flag is<br>passed before the first regex, then the matching will be performed ignoring<br>the case. in order to match the string “-i”, either set it second, or pass<br>the “–” flag before the first string. same principle applies of course to<br>match the string “–”.</p>\n<h2 id=\"7-1-5-matching-arbitrary-data-blocks\"><a href=\"#7-1-5-matching-arbitrary-data-blocks\" class=\"headerlink\" title=\"7.1.5. matching arbitrary data blocks\"></a>7.1.5. matching arbitrary data blocks</h2><p>it is possible to match some extracted samples against a binary block which may<br>not safely be represented as a string. for this, the patterns must be passed as<br>a series of hexadecimal digits in an even number, when the match method is set<br>to binary. each sequence of two digits will represent a byte. the hexadecimal<br>digits may be used upper or lower case.</p>\n<p>example :</p>\n<pre><code># match &quot;hello\\n&quot; in the input stream (\\x48 \\x65 \\x6c \\x6c \\x6f \\x0a)\nacl hello payload(0,6) -m bin 48656c6c6f0a\n</code></pre><h2 id=\"7-1-6-matching-ipv4-and-ipv6-addresses\"><a href=\"#7-1-6-matching-ipv4-and-ipv6-addresses\" class=\"headerlink\" title=\"7.1.6. matching ipv4 and ipv6 addresses\"></a>7.1.6. matching ipv4 and ipv6 addresses</h2><p>ipv4 addresses values can be specified either as plain addresses or with a<br>netmask appended, in which case the ipv4 address matches whenever it is<br>within the network. plain addresses may also be replaced with a resolvable<br>host name, but this practice is generally discouraged as it makes it more<br>difficult to read and debug configurations. if hostnames are used, you should<br>at least ensure that they are present in /etc/hosts so that the configuration<br>does not depend on any random dns match at the moment the configuration is<br>parsed.</p>\n<p>ipv6 may be entered in their usual form, with or without a netmask appended.<br>only bit counts are accepted for ipv6 netmasks. in order to avoid any risk of<br>trouble with randomly resolved ip addresses, host names are never allowed in<br>ipv6 patterns.</p>\n<p>haproxy is also able to match ipv4 addresses with ipv6 addresses in the<br>following situations :</p>\n<ul>\n<li>tested address is ipv4, pattern address is ipv4, the match applies<br>in ipv4 using the supplied mask if any.</li>\n<li>tested address is ipv6, pattern address is ipv6, the match applies<br>in ipv6 using the supplied mask if any.</li>\n<li>tested address is ipv6, pattern address is ipv4, the match applies in ipv4<br>using the pattern’s mask if the ipv6 address matches with 2002:ipv4::,<br>::ipv4 or ::ffff:ipv4, otherwise it fails.</li>\n<li>tested address is ipv4, pattern address is ipv6, the ipv4 address is first<br>converted to ipv6 by prefixing ::ffff: in front of it, then the match is<br>applied in ipv6 using the supplied ipv6 mask.</li>\n</ul>\n<h2 id=\"7-2-using-acls-to-form-conditions\"><a href=\"#7-2-using-acls-to-form-conditions\" class=\"headerlink\" title=\"7.2. using acls to form conditions\"></a>7.2. using acls to form conditions</h2><p>some actions are only performed upon a valid condition. a condition is a<br>combination of acls with operators. 3 operators are supported :</p>\n<ul>\n<li>and (implicit)</li>\n<li>or  (explicit with the “or” keyword or the “||” operator)</li>\n<li>negation with the exclamation mark (“!”)</li>\n</ul>\n<p>a condition is formed as a disjunctive form:</p>\n<p>   [!]acl1 [!]acl2 … [!]acln  { or [!]acl1 [!]acl2 … [!]acln } …</p>\n<p>such conditions are generally used after an “if” or “unless” statement,<br>indicating when the condition will trigger the action.</p>\n<p>for instance, to block http requests to the “*” url with methods other than<br>“options”, as well as post requests without content-length, and get or head<br>requests with a content-length greater than 0, and finally every request which<br>is not either get/head/post/options !</p>\n<p>   acl missing_cl hdr_cnt(content-length) eq 0<br>   block if http_url_star !meth_options || meth_post missing_cl<br>   block if meth_get http_content<br>   block unless meth_get or meth_post or meth_options</p>\n<p>to select a different backend for requests to static contents on the “www” site<br>and to every request on the “img”, “video”, “download” and “ftp” hosts :</p>\n<p>   acl url_static  path_beg         /static /images /img /css<br>   acl url_static  path_end         .gif .png .jpg .css .js<br>   acl host_www    hdr_beg(host) -i www<br>   acl host_static hdr_beg(host) -i img. video. download. ftp.</p>\n<h1 id=\"now-use-backend-“static”-for-all-static-only-hosts-and-for-static-urls\"><a href=\"#now-use-backend-“static”-for-all-static-only-hosts-and-for-static-urls\" class=\"headerlink\" title=\"now use backend “static” for all static-only hosts, and for static urls\"></a>now use backend “static” for all static-only hosts, and for static urls</h1><h1 id=\"of-host-“www”-use-backend-“www”-for-the-rest\"><a href=\"#of-host-“www”-use-backend-“www”-for-the-rest\" class=\"headerlink\" title=\"of host “www”. use backend “www” for the rest.\"></a>of host “www”. use backend “www” for the rest.</h1><p>   use_backend static if host_static or host_www url_static<br>   use_backend www    if host_www</p>\n<p>it is also possible to form rules using “anonymous acls”. those are unnamed acl<br>expressions that are built on the fly without needing to be declared. they must<br>be enclosed between braces, with a space before and after each brace (because<br>the braces must be seen as independent words). example :</p>\n<p>   the following rule :</p>\n<pre><code>acl missing_cl hdr_cnt(content-length) eq 0\nblock if meth_post missing_cl\n</code></pre><p>   can also be written that way :</p>\n<pre><code>block if meth_post { hdr_cnt(content-length) eq 0 }\n</code></pre><p>it is generally not recommended to use this construct because it’s a lot easier<br>to leave errors in the configuration when written that way. however, for very<br>simple rules matching only one source ip address for instance, it can make more<br>sense to use them than to declare acls with random names. another example of<br>good use is the following :</p>\n<p>   with named acls :</p>\n<pre><code>acl site_dead nbsrv(dynamic) lt 2\nacl site_dead nbsrv(static)  lt 2\nmonitor fail  if site_dead\n</code></pre><p>   with anonymous acls :</p>\n<pre><code>monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }\n</code></pre><p>see section 4.2 for detailed help on the “block” and “use_backend” keywords.</p>\n<h2 id=\"7-3-fetching-samples\"><a href=\"#7-3-fetching-samples\" class=\"headerlink\" title=\"7.3. fetching samples\"></a>7.3. fetching samples</h2><p>historically, sample fetch methods were only used to retrieve data to match<br>against patterns using acls. with the arrival of stick-tables, a new class of<br>sample fetch methods was created, most often sharing the same syntax as their<br>acl counterpart. these sample fetch methods are also known as “fetches”. as<br>of now, acls and fetches have converged. all acl fetch methods have been made<br>available as fetch methods, and acls may use any sample fetch method as well.</p>\n<p>this section details all available sample fetch methods and their output type.<br>some sample fetch methods have deprecated aliases that are used to maintain<br>compatibility with existing configurations. they are then explicitly marked as<br>deprecated and should not be used in new setups.</p>\n<p>the acl derivatives are also indicated when available, with their respective<br>matching methods. these ones all have a well defined default pattern matching<br>method, so it is never necessary (though allowed) to pass the “-m” option to<br>indicate how the sample will be matched using acls.</p>\n<p>as indicated in the sample type versus matching compatibility matrix above,<br>when using a generic sample fetch method in an acl, the “-m” option is<br>mandatory unless the sample type is one of boolean, integer, ipv4 or ipv6. when<br>the same keyword exists as an acl keyword and as a standard fetch method, the<br>acl engine will automatically pick the acl-only one by default.</p>\n<p>some of these keywords support one or multiple mandatory arguments, and one or<br>multiple optional arguments. these arguments are strongly typed and are checked<br>when the configuration is parsed so that there is no risk of running with an<br>incorrect argument (eg: an unresolved backend name). fetch function arguments<br>are passed between parenthesis and are delimited by commas.  when an argument<br>is optional, it will be indicated below between square brackets (‘[ ]’). when<br>all arguments are optional, the parenthesis may be omitted.</p>\n<p>thus, the syntax of a standard sample fetch method is one of the following :</p>\n<ul>\n<li>name</li>\n<li>name(arg1)</li>\n<li>name(arg1,arg2)</li>\n</ul>\n<h2 id=\"7-3-1-converters\"><a href=\"#7-3-1-converters\" class=\"headerlink\" title=\"7.3.1. converters\"></a>7.3.1. converters</h2><p>sample fetch methods may be combined with transformations to be applied on top<br>of the fetched sample (also called “converters”). these combinations form what<br>is called “sample expressions” and the result is a “sample”. initially this<br>was only supported by “stick on” and “stick store-request” directives but this<br>has now be extended to all places where samples may be used (acls, log-format,<br>unique-id-format, add-header, …).</p>\n<p>these transformations are enumerated as a series of specific keywords after the<br>sample fetch method. these keywords may equally be appended immediately after<br>the fetch keyword’s argument, delimited by a comma. these keywords can also<br>support some arguments (eg: a netmask) which must be passed in parenthesis.</p>\n<p>a certain category of converters are bitwise and arithmetic operators which<br>support performing basic operations on integers. some bitwise operations are<br>supported (and, or, xor, cpl) and some arithmetic operations are supported<br>(add, sub, mul, div, mod, neg). some comparators are provided (odd, even, not,<br>bool) which make it possible to report a match without having to write an acl.</p>\n<p>the currently available list of transformation keywords include :</p>\n<p>add(<value>)<br>  adds <value> to the input value of type signed integer, and returns the<br>  result as a signed integer. <value> can be a numeric value or a variable<br>  name. the name of the variable starts by an indication about its scope. the<br>  allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>and(<value>)<br>  performs a bitwise “and” between <value> and the input value of type signed<br>  integer, and returns the result as an signed integer. <value> can be a<br>  numeric value or a variable name. the name of the variable starts by an<br>  indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>base64<br>  converts a binary input sample to a base64 string. it is used to log or<br>  transfer binary content in a way that can be reliably transferred (eg:<br>  an ssl id can be copied in a header).</p>\n<p>bool<br>  returns a boolean true if the input value of type signed integer is<br>  non-null, otherwise returns false. used in conjunction with and(), it can be<br>  used to report true/false for bit testing on input values (eg: verify the<br>  presence of a flag).</p>\n<p>bytes(<offset>[,<length>])<br>  extracts some bytes from an input binary sample. the result is a binary<br>  sample starting at an offset (in bytes) of the original sample and<br>  optionnaly truncated at the given length.</p>\n<p>cpl<br>  takes the input value of type signed integer, applies a ones-complement<br>  (flips all bits) and returns the result as an signed integer.</p>\n<p>crc32([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the crc32<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  provided for compatibility with other software which want a crc32 to be<br>  computed on some input keys, so it follows the most common implementation as<br>  found in ethernet, gzip, png, etc… it is slower than the other algorithms<br>  but may provide a better or at least less predictable distribution. it must<br>  not be used for security purposes as a 32-bit hash is trivial to break. see<br>  also “djb2”, “sdbm”, “wt6” and the “hash-type” directive.</p>\n<p>da-csv(<prop>[,<prop>*])<br>  asks the deviceatlas converter to identify the user agent string passed on<br>  input, and to emit a string made of the concatenation of the properties<br>  enumerated in argument, delimited by the separator defined by the global<br>  keyword “deviceatlas-property-separator”, or by default the pipe character<br>  (‘|’). there’s a limit of 5 different properties imposed by the haproxy<br>  configuration language.</p>\n<p>  example:<br>    frontend www<br>    bind *:8881<br>    default_backend servers<br>    http-request set-header x-deviceatlas-data %[req.fhdr(user-agent),da-csv(primaryhardwaretype,osname,osversion,browsername,browserversion)]</p>\n<p>debug<br>  this converter is used as debug tool. it dumps on screen the content and the<br>  type of the input sample. the sample is returned as is on its output. this<br>  converter only exists when haproxy was built with debugging enabled.</p>\n<p>div(<value>)<br>  divides the input value of type signed integer by <value>, and returns the<br>  result as an signed integer. if <value> is null, the largest unsigned<br>  integer is returned (typically 2^63-1). <value> can be a numeric value or a<br>  variable name. the name of the variable starts by an indication about it<br>  scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>djb2([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the djb2<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “sdbm”, “wt6” and the<br>  “hash-type” directive.</p>\n<p>even<br>  returns a boolean true if the input value of type signed integer is even<br>  otherwise returns false. it is functionally equivalent to “not,and(1),bool”.</p>\n<p>field(<index>,<delimiters>)<br>  extracts the substring at the given index considering given delimiters from<br>  an input string. indexes start at 1 and delimiters are a string formatted<br>  list of chars.</p>\n<p>hex<br>  converts a binary input sample to an hex string containing two hex digits per<br>  input byte. it is used to log or transfer hex dumps of some binary input data<br>  in a way that can be reliably transferred (eg: an ssl id can be copied in a<br>  header).</p>\n<p>http_date([<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in a format suitable for use in http header fields. if<br>  an offset value is specified, then it is a number of seconds that is added to<br>  the date before the conversion is operated. this is particularly useful to<br>  emit date header fields, expires values in responses when combined with a<br>  positive offset, or last-modified values when the offset is negative.</p>\n<p>in_table(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, a boolean false<br>  is returned. otherwise a boolean true is returned. this can be used to verify<br>  the presence of a certain key in a table tracking some elements (eg: whether<br>  or not a source ip address or an authorization header was already seen).</p>\n<p>ipmask(<mask>)<br>  apply a mask to an ipv4 address, and use the result for lookups and storage.<br>  this can be used to make all hosts within a certain mask to share the same<br>  table entries and as such use the same server. the mask can be passed in<br>  dotted form (eg: 255.255.255.0) or in cidr form (eg: 24).</p>\n<p>json([<input-code>])<br>  escapes the input string and produces an ascii ouput string ready to use as a<br>  json string. the converter tries to decode the input string according to the<br>  <input-code> parameter. it can be “ascii”, “utf8”, “utf8s”, “utf8”” or<br>  “utf8ps”. the “ascii” decoder never fails. the “utf8” decoder detects 3 types<br>  of errors:</p>\n<ul>\n<li>bad utf-8 sequence (lone continuation byte, bad number of continuation<br>bytes, …)</li>\n<li>invalid range (the decoded value is within a utf-8 prohibited range),</li>\n<li><p>code overlong (the value is encoded with more bytes than necessary).</p>\n<p>the utf-8 json encoding can produce a “too long value” error when the utf-8<br>character is greater than 0xffff because the json string escape specification<br>only authorizes 4 hex digits for the value encoding. the utf-8 decoder exists<br>in 4 variants designated by a combination of two suffix letters : “p” for<br>“permissive” and “s” for “silently ignore”. the behaviors of the decoders<br>are :</p>\n</li>\n<li>“ascii”  : never fails ;</li>\n<li>“utf8”   : fails on any detected errors ;</li>\n<li>“utf8s”  : never fails, but removes characters corresponding to errors ;</li>\n<li>“utf8p”  : accepts and fixes the overlong errors, but fails on any other<pre><code>error ;\n</code></pre></li>\n<li><p>“utf8ps” : never fails, accepts and fixes the overlong errors, but removes</p>\n<pre><code>characters corresponding to the other errors.\n</code></pre><p>this converter is particularly useful for building properly escaped json for<br>logging to servers which consume json-formated traffic logs.</p>\n<p>example:<br>capture request header user-agent len 150<br>capture request header host len 15<br>log-format {“ip”:”%[src]”,”user-agent”:”%[capture.req.hdr(1),json]”}</p>\n<p>input request from client 127.0.0.1:<br>get / http/1.0<br>user-agent: very “ugly” ua 1/2</p>\n<p>output log:<br>{“ip”:”127.0.0.1”,”user-agent”:”very \\”ugly\\” ua 1\\/2”}</p>\n</li>\n</ul>\n<p>language(<value>[,<default>])<br>  returns the value with the highest q-factor from a list as extracted from the<br>  “accept-language” header using “req.fhdr”. values with no q-factor have a<br>  q-factor of 1. values with a q-factor of 0 are dropped. only values which<br>  belong to the list of semi-colon delimited <values> will be considered. the<br>  argument <value> syntax is “lang[;lang[;lang[;…]]]”. if no value matches the<br>  given list and a default value is provided, it is returned. note that language<br>  names may have a variant after a dash (‘-‘). if this variant is present in the<br>  list, it will be matched, but if it is not, only the base language is checked.<br>  the match is case-sensitive, and the output string is always one of those<br>  provided in arguments.  the ordering of arguments is meaningless, only the<br>  ordering of the values in the request counts, as the first value among<br>  multiple sharing the same q-factor is used.</p>\n<p>  example :</p>\n<pre><code># this configuration switches to the backend matching a\n# given language based on the request :\n\nacl es req.fhdr(accept-language),language(es;fr;en) -m str es\nacl fr req.fhdr(accept-language),language(es;fr;en) -m str fr\nacl en req.fhdr(accept-language),language(es;fr;en) -m str en\nuse_backend spanish if es\nuse_backend french  if fr\nuse_backend english if en\ndefault_backend choose_your_language\n</code></pre><p>lower<br>  convert a string sample to lower case. this can only be placed after a string<br>  sample fetch function or after a transformation keyword returning a string<br>  type. the result is of type string.</p>\n<p>ltime(<format>[,<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in local time using a format defined by the <format><br>  string using strftime(3). the purpose is to allow any date format to be used<br>  in logs. an optional <offset> in seconds may be applied to the input date<br>  (positive or negative). see the strftime() man page for the format supported<br>  by your operating system. see also the utime converter.</p>\n<p>  example :</p>\n<pre><code># emit two colons, one with the local time and another with ip:port\n# eg:  20140710162350 127.0.0.1:57325\nlog-format %[date,ltime(%y%m%d%h%m%s)]\\ %ci:%cp\n</code></pre><p>map(<map_file>[,<default_value>])<br>map_<match_type>(<map_file>[,<default_value>])<br>map_<match_type>_<output_type>(<map_file>[,<default_value>])<br>  search the input value from <map_file> using the <match_type> matching method,<br>  and return the associated value converted to the type <output_type>. if the<br>  input value cannot be found in the <map_file>, the converter returns the<br>  <default_value>. if the <default_value> is not set, the converter fails and<br>  acts as if no input value could be fetched. if the <match_type> is not set, it<br>  defaults to “str”. likewise, if the <output_type> is not set, it defaults to<br>  “str”. for convenience, the “map” keyword is an alias for “map_str” and maps a<br>  string to another string.</p>\n<p>  it is important to avoid overlapping between the keys : ip addresses and<br>  strings are stored in trees, so the first of the finest match will be used.<br>  other keys are stored in lists, so the first matching occurrence will be used.</p>\n<p>  the following array contains the list of all map functions avalaible sorted by<br>  input type, match type and output type.</p>\n<p>  input type | match method | output type str | output type int | output type ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | str          | map_str         | map_str_int     | map_str_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | beg          | map_beg         | map_beg_int     | map_end_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | sub          | map_sub         | map_sub_int     | map_sub_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | dir          | map_dir         | map_dir_int     | map_dir_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | dom          | map_dom         | map_dom_int     | map_dom_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | end          | map_end         | map_end_int     | map_end_ip<br>  ———–+————–+—————–+—————–+—————<br>    str      | reg          | map_reg         | map_reg_int     | map_reg_ip<br>  ———–+————–+—————–+—————–+—————<br>    int      | int          | map_int         | map_int_int     | map_int_ip<br>  ———–+————–+—————–+—————–+—————<br>    ip       | ip           | map_ip          | map_ip_int      | map_ip_ip<br>  ———–+————–+—————–+—————–+—————</p>\n<p>  the file contains one key + value per line. lines which start with ‘#’ are<br>  ignored, just like empty lines. leading tabs and spaces are stripped. the key<br>  is then the first “word” (series of non-space/tabs characters), and the value<br>  is what follows this series of space/tab till the end of the line excluding<br>  trailing spaces/tabs.</p>\n<p>  example :</p>\n<pre><code># this is a comment and is ignored\n   2.22.246.0/23    united kingdom      \\n\n&lt;-&gt;&lt;-----------&gt;&lt;--&gt;&lt;------------&gt;&lt;----&gt;\n |       |       |         |        `- trailing spaces ignored\n |       |       |         `---------- value\n |       |       `-------------------- middle spaces ignored\n |       `---------------------------- key\n `------------------------------------ leading spaces ignored\n</code></pre><p>mod(<value>)<br>  divides the input value of type signed integer by <value>, and returns the<br>  remainder as an signed integer. if <value> is null, then zero is returned.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>mul(<value>)<br>  multiplies the input value of type signed integer by <value>, and returns<br>  the product as an signed integer. in case of overflow, the largest possible<br>  value for the sign is returned so that the operation doesn’t wrap around.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>neg<br>  takes the input value of type signed integer, computes the opposite value,<br>  and returns the remainder as an signed integer. 0 is identity. this operator<br>  is provided for reversed subtracts : in order to subtract the input from a<br>  constant, simply perform a “neg,add(value)”.</p>\n<p>not<br>  returns a boolean false if the input value of type signed integer is<br>  non-null, otherwise returns true. used in conjunction with and(), it can be<br>  used to report true/false for bit testing on input values (eg: verify the<br>  absence of a flag).</p>\n<p>odd<br>  returns a boolean true if the input value of type signed integer is odd<br>  otherwise returns false. it is functionally equivalent to “and(1),bool”.</p>\n<p>or(<value>)<br>  performs a bitwise “or” between <value> and the input value of type signed<br>  integer, and returns the result as an signed integer. <value> can be a<br>  numeric value or a variable name. the name of the variable starts by an<br>  indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>regsub(<regex>,<subst>[,<flags>])<br>  applies a regex-based substitution to the input string. it does the same<br>  operation as the well-known “sed” utility with “s/<regex>/<subst>/“. by<br>  default it will replace in the input string the first occurrence of the<br>  largest part matching the regular expression <regex> with the substitution<br>  string <subst>. it is possible to replace all occurrences instead by adding<br>  the flag “g” in the third argument <flags>. it is also possible to make the<br>  regex case insensitive by adding the flag “i” in <flags>. since <flags> is a<br>  string, it is made up from the concatenation of all desired flags. thus if<br>  both “i” and “g” are desired, using “gi” or “ig” will have the same effect.<br>  it is important to note that due to the current limitations of the<br>  configuration parser, some characters such as closing parenthesis or comma<br>  are not possible to use in the arguments. the first use of this converter is<br>  to replace certain characters or sequence of characters with other ones.</p>\n<p>  example :</p>\n<pre><code># de-duplicate &quot;/&quot; in header &quot;x-path&quot;.\n# input:  x-path: /////a///b/c/xzxyz/\n# output: x-path: /a/b/c/xzxyz/\nhttp-request set-header x-path %[hdr(x-path),regsub(/+,/,g)]\n</code></pre><p>capture-req(<id>)<br>  capture the string entry in the request slot <id> and returns the entry as<br>  is. if the slot doesn’t exist, the capture fails silently.</p>\n<p>  see also: “declare capture”, “http-request capture”,<br>            “http-response capture”, “req.hdr.capture” and<br>            “res.hdr.capture” (sample fetches).</p>\n<p>capture-res(<id>)<br>  capture the string entry in the response slot <id> and returns the entry as<br>  is. if the slot doesn’t exist, the capture fails silently.</p>\n<p>  see also: “declare capture”, “http-request capture”,<br>            “http-response capture”, “req.hdr.capture” and<br>            “res.hdr.capture” (sample fetches).</p>\n<p>sdbm([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the sdbm<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “djb2”, “wt6” and the<br>  “hash-type” directive.</p>\n<p>set-var(<var name>)<br>  sets a variable with the input content and return the content on the output as<br>  is. the variable keep the value and the associated input type. the name of the<br>  variable starts by an indication about it scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>sub(<value>)<br>  subtracts <value> from the input value of type signed integer, and returns<br>  the result as an signed integer. note: in order to subtract the input from<br>  a constant, simply perform a “neg,add(value)”. <value> can be a numeric value<br>  or a variable name. the name of the variable starts by an indication about its<br>  scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<p>table_bytes_in_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average client-to-server<br>  bytes rate associated with the input sample in the designated table, measured<br>  in amount of bytes over the period configured in the table. see also the<br>  sc_bytes_in_rate sample fetch keyword.</p>\n<p>table_bytes_out_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average server-to-client<br>  bytes rate associated with the input sample in the designated table, measured<br>  in amount of bytes over the period configured in the table. see also the<br>  sc_bytes_out_rate sample fetch keyword.</p>\n<p>table_conn_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of incoming<br>  connections associated with the input sample in the designated table. see<br>  also the sc_conn_cnt sample fetch keyword.</p>\n<p>table_conn_cur(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current amount of concurrent<br>  tracked connections associated with the input sample in the designated table.<br>  see also the sc_conn_cur sample fetch keyword.</p>\n<p>table_conn_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average incoming connection<br>  rate associated with the input sample in the designated table. see also the<br>  sc_conn_rate sample fetch keyword.</p>\n<p>table_gpc0(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current value of the first<br>  general purpose counter associated with the input sample in the designated<br>  table. see also the sc_get_gpc0 sample fetch keyword.</p>\n<p>table_gpc0_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the frequency which the gpc0<br>  counter was incremented over the configured period in the table, associated<br>  with the input sample in the designated table. see also the sc_get_gpc0_rate<br>  sample fetch keyword.</p>\n<p>table_http_err_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of http<br>  errors associated with the input sample in the designated table. see also the<br>  sc_http_err_cnt sample fetch keyword.</p>\n<p>table_http_err_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the average rate of http errors associated with the<br>  input sample in the designated table, measured in amount of errors over the<br>  period configured in the table. see also the sc_http_err_rate sample fetch<br>  keyword.</p>\n<p>table_http_req_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of http<br>  requests associated with the input sample in the designated table. see also<br>  the sc_http_req_cnt sample fetch keyword.</p>\n<p>table_http_req_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the average rate of http requests associated with the<br>  input sample in the designated table, measured in amount of requests over the<br>  period configured in the table. see also the sc_http_req_rate sample fetch<br>  keyword.</p>\n<p>table_kbytes_in(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of client-<br>  to-server data associated with the input sample in the designated table,<br>  measured in kilobytes. the test is currently performed on 32-bit integers,<br>  which limits values to 4 terabytes. see also the sc_kbytes_in sample fetch<br>  keyword.</p>\n<p>table_kbytes_out(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of server-<br>  to-client data associated with the input sample in the designated table,<br>  measured in kilobytes. the test is currently performed on 32-bit integers,<br>  which limits values to 4 terabytes. see also the sc_kbytes_out sample fetch<br>  keyword.</p>\n<p>table_server_id(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the server id associated with<br>  the input sample in the designated table. a server id is associated to a<br>  sample by a “stick” rule when a connection to a server succeeds. a server id<br>  zero means that no server is associated with this key.</p>\n<p>table_sess_cnt(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the cumulated amount of incoming<br>  sessions associated with the input sample in the designated table. note that<br>  a session here refers to an incoming connection being accepted by the<br>  “tcp-request connection” rulesets. see also the sc_sess_cnt sample fetch<br>  keyword.</p>\n<p>table_sess_rate(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the average incoming session<br>  rate associated with the input sample in the designated table. note that a<br>  session here refers to an incoming connection being accepted by the<br>  “tcp-request connection” rulesets. see also the sc_sess_rate sample fetch<br>  keyword.</p>\n<p>table_trackers(<table>)<br>  uses the string representation of the input sample to perform a look up in<br>  the specified table. if the key is not found in the table, integer value zero<br>  is returned. otherwise the converter returns the current amount of concurrent<br>  connections tracking the same key as the input sample in the designated<br>  table. it differs from table_conn_cur in that it does not rely on any stored<br>  information but on the table’s reference count (the “use” value which is<br>  returned by “show table” on the cli). this may sometimes be more suited for<br>  layer7 tracking. it can be used to tell a server how many concurrent<br>  connections there are from a given address for example. see also the<br>  sc_trackers sample fetch keyword.</p>\n<p>upper<br>  convert a string sample to upper case. this can only be placed after a string<br>  sample fetch function or after a transformation keyword returning a string<br>  type. the result is of type string.</p>\n<p>url_dec<br>  takes an url-encoded string provided as input and returns the decoded<br>  version as output. the input and the output are of type string.</p>\n<p>utime(<format>[,<offset>])<br>  converts an integer supposed to contain a date since epoch to a string<br>  representing this date in utc time using a format defined by the <format><br>  string using strftime(3). the purpose is to allow any date format to be used<br>  in logs. an optional <offset> in seconds may be applied to the input date<br>  (positive or negative). see the strftime() man page for the format supported<br>  by your operating system. see also the ltime converter.</p>\n<p>  example :</p>\n<pre><code># emit two colons, one with the utc time and another with ip:port\n# eg:  20140710162350 127.0.0.1:57325\nlog-format %[date,utime(%y%m%d%h%m%s)]\\ %ci:%cp\n</code></pre><p>word(<index>,<delimiters>)<br>  extracts the nth word considering given delimiters from an input string.<br>  indexes start at 1 and delimiters are a string formatted list of chars.</p>\n<p>wt6([<avalanche>])<br>  hashes a binary input sample into an unsigned 32-bit quantity using the wt6<br>  hash function. optionally, it is possible to apply a full avalanche hash<br>  function to the output if the optional <avalanche> argument equals 1. this<br>  converter uses the same functions as used by the various hash-based load<br>  balancing algorithms, so it will provide exactly the same results. it is<br>  mostly intended for debugging, but can be used as a stick-table entry to<br>  collect rough statistics. it must not be used for security purposes as a<br>  32-bit hash is trivial to break. see also “crc32”, “djb2”, “sdbm”, and the<br>  “hash-type” directive.</p>\n<p>xor(<value>)<br>  performs a bitwise “xor” (exclusive or) between <value> and the input value<br>  of type signed integer, and returns the result as an signed integer.<br>  <value> can be a numeric value or a variable name. the name of the variable<br>  starts by an indication about its scope. the allowed scopes are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<h2 id=\"7-3-2-fetching-samples-from-internal-states\"><a href=\"#7-3-2-fetching-samples-from-internal-states\" class=\"headerlink\" title=\"7.3.2. fetching samples from internal states\"></a>7.3.2. fetching samples from internal states</h2><p>a first set of sample fetch methods applies to internal information which does<br>not even relate to any client information. these ones are sometimes used with<br>“monitor-fail” directives to report an internal status to external watchers.<br>the sample fetch methods described in this section are usable anywhere.</p>\n<p>always_false : boolean<br>  always returns the boolean “false” value. it may be used with acls as a<br>  temporary replacement for another one when adjusting configurations.</p>\n<p>always_true : boolean<br>  always returns the boolean “true” value. it may be used with acls as a<br>  temporary replacement for another one when adjusting configurations.</p>\n<p>avg_queue([<backend>]) : integer<br>  returns the total number of queued connections of the designated backend<br>  divided by the number of active servers. the current backend is used if no<br>  backend is specified. this is very similar to “queue” except that the size of<br>  the farm is considered, in order to give a more accurate measurement of the<br>  time it may take for a new connection to be processed. the main usage is with<br>  acl to return a sorry page to new users when it becomes certain they will get<br>  a degraded service, or to pass to the backend servers in a header so that<br>  they decide to work in degraded mode or to disable some functions to speed up<br>  the processing a bit. note that in the event there would not be any active<br>  server anymore, twice the number of queued connections would be considered as<br>  the measured value. this is a fair estimate, as we expect one server to get<br>  back soon anyway, but we still prefer to send new traffic to another backend<br>  if in better shape. see also the “queue”, “be_conn”, and “be_sess_rate”<br>  sample fetches.</p>\n<p>be_conn([<backend>]) : integer<br>  applies to the number of currently established connections on the backend,<br>  possibly including the connection being evaluated. if no backend name is<br>  specified, the current one is used. but it is also possible to check another<br>  backend. it can be used to use a specific farm when the nominal one is full.<br>  see also the “fe_conn”, “queue” and “be_sess_rate” criteria.</p>\n<p>be_sess_rate([<backend>]) : integer<br>  returns an integer value corresponding to the sessions creation rate on the<br>  backend, in number of new sessions per second. this is used with acls to<br>  switch to an alternate backend when an expensive or fragile one reaches too<br>  high a session rate, or to limit abuse of service (eg. prevent sucking of an<br>  online dictionary). it can also be useful to add this element to logs using a<br>  log-format directive.</p>\n<p>  example :</p>\n<pre><code># redirect to an error page if the dictionary is requested too often\nbackend dynamic\n    mode http\n    acl being_scanned be_sess_rate gt 100\n    redirect location /denied.html if being_scanned\n</code></pre><p>bin(<hexa>) : bin<br>  returns a binary chain. the input is the hexadecimal representation<br>  of the string.</p>\n<p>bool(<bool>) : bool<br>  returns a boolean value. <bool> can be ‘true’, ‘false’, ‘1’ or ‘0’.<br>  ‘false’ and ‘0’ are the same. ‘true’ and ‘1’ are the same.</p>\n<p>connslots([<backend>]) : integer<br>  returns an integer value corresponding to the number of connection slots<br>  still available in the backend, by totaling the maximum amount of<br>  connections on all servers and the maximum queue size. this is probably only<br>  used with acls.</p>\n<p>  the basic idea here is to be able to measure the number of connection “slots”<br>  still available (connection + queue), so that anything beyond that (intended<br>  usage; see “use_backend” keyword) can be redirected to a different backend.</p>\n<p>  ‘connslots’ = number of available server connection slots, + number of<br>  available server queue slots.</p>\n<p>  note that while “fe_conn” may be used, “connslots” comes in especially<br>  useful when you have a case of traffic going to one single ip, splitting into<br>  multiple backends (perhaps using acls to do name-based load balancing) and<br>  you want to be able to differentiate between different backends, and their<br>  available “connslots”.  also, whereas “nbsrv” only measures servers that are<br>  actually <em>down</em>, this fetch is more fine-grained and looks into the number of<br>  available connection slots as well. see also “queue” and “avg_queue”.</p>\n<p>  other caveats and notes: at this point in time, the code does not take care<br>  of dynamic connections. also, if any of the server maxconn, or maxqueue is 0,<br>  then this fetch clearly does not make sense, in which case the value returned<br>  will be -1.</p>\n<p>date([<offset>]) : integer<br>  returns the current date as the epoch (number of seconds since 01/01/1970).<br>  if an offset value is specified, then it is a number of seconds that is added<br>  to the current date before returning the value. this is particularly useful<br>  to compute relative dates, as both positive and negative offsets are allowed.<br>  it is useful combined with the http_date converter.</p>\n<p>  example :</p>\n<pre><code># set an expires header to now+1 hour in every response\nhttp-response set-header expires %[date(3600),http_date]\n</code></pre><p>env(<name>) : string<br>  returns a string containing the value of environment variable <name>. as a<br>  reminder, environment variables are per-process and are sampled when the<br>  process starts. this can be useful to pass some information to a next hop<br>  server, or with acls to take specific action when the process is started a<br>  certain way.</p>\n<p>  examples :</p>\n<pre><code># pass the via header to next hop with the local hostname in it\nhttp-request add-header via 1.1\\ %[env(hostname)]\n\n# reject cookie-less requests when the stop environment variable is set\nhttp-request deny if !{ cook(sessionid) -m found } { env(stop) -m found }\n</code></pre><p>fe_conn([<frontend>]) : integer<br>  returns the number of currently established connections on the frontend,<br>  possibly including the connection being evaluated. if no frontend name is<br>  specified, the current one is used. but it is also possible to check another<br>  frontend. it can be used to return a sorry page before hard-blocking, or to<br>  use a specific backend to drain new requests when the farm is considered<br>  full.  this is mostly used with acls but can also be used to pass some<br>  statistics to servers in http headers. see also the “dst_conn”, “be_conn”,<br>  “fe_sess_rate” fetches.</p>\n<p>fe_sess_rate([<frontend>]) : integer<br>  returns an integer value corresponding to the sessions creation rate on the<br>  frontend, in number of new sessions per second. this is used with acls to<br>  limit the incoming session rate to an acceptable range in order to prevent<br>  abuse of service at the earliest moment, for example when combined with other<br>  layer 4 acls in order to force the clients to wait a bit for the rate to go<br>  down below the limit. it can also be useful to add this element to logs using<br>  a log-format directive. see also the “rate-limit sessions” directive for use<br>  in frontends.</p>\n<p>  example :</p>\n<pre><code># this frontend limits incoming mails to 10/s with a max of 100\n# concurrent connections. we accept any connection below 10/s, and\n# force excess clients to wait for 100 ms. since clients are limited to\n# 100 max, there cannot be more than 10 incoming mails per second.\nfrontend mail\n    bind :25\n    mode tcp\n    maxconn 100\n    acl too_fast fe_sess_rate ge 10\n    tcp-request inspect-delay 100ms\n    tcp-request content accept if ! too_fast\n    tcp-request content accept if wait_end\n</code></pre><p>int(<integer>) : signed integer<br>  returns a signed integer.</p>\n<p>ipv4(<ipv4>) : ipv4<br>  returns an ipv4.</p>\n<p>ipv6(<ipv6>) : ipv6<br>  returns an ipv6.</p>\n<p>meth(<method>) : method<br>  returns a method.</p>\n<p>nbproc : integer<br>  returns an integer value corresponding to the number of processes that were<br>  started (it equals the global “nbproc” setting). this is useful for logging<br>  and debugging purposes.</p>\n<p>nbsrv([<backend>]) : integer<br>  returns an integer value corresponding to the number of usable servers of<br>  either the current backend or the named backend. this is mostly used with<br>  acls but can also be useful when added to logs. this is normally used to<br>  switch to an alternate backend when the number of servers is too low to<br>  to handle some load. it is useful to report a failure when combined with<br>  “monitor fail”.</p>\n<p>proc : integer<br>  returns an integer value corresponding to the position of the process calling<br>  the function, between 1 and global.nbproc. this is useful for logging and<br>  debugging purposes.</p>\n<p>queue([<backend>]) : integer<br>  returns the total number of queued connections of the designated backend,<br>  including all the connections in server queues. if no backend name is<br>  specified, the current one is used, but it is also possible to check another<br>  one. this is useful with acls or to pass statistics to backend servers. this<br>  can be used to take actions when queuing goes above a known level, generally<br>  indicating a surge of traffic or a massive slowdown on the servers. one<br>  possible action could be to reject new users but still accept old ones. see<br>  also the “avg_queue”, “be_conn”, and “be_sess_rate” fetches.</p>\n<p>rand([<range>]) : integer<br>  returns a random integer value within a range of <range> possible values,<br>  starting at zero. if the range is not specified, it defaults to 2^32, which<br>  gives numbers between 0 and 4294967295. it can be useful to pass some values<br>  needed to take some routing decisions for example, or just for debugging<br>  purposes. this random must not be used for security purposes.</p>\n<p>srv_conn([<backend>/]<server>) : integer<br>  returns an integer value corresponding to the number of currently established<br>  connections on the designated server, possibly including the connection being<br>  evaluated. if <backend> is omitted, then the server is looked up in the<br>  current backend. it can be used to use a specific farm when one server is<br>  full, or to inform the server about our view of the number of active<br>  connections with it. see also the “fe_conn”, “be_conn” and “queue” fetch<br>  methods.</p>\n<p>srv_is_up([<backend>/]<server>) : boolean<br>  returns true when the designated server is up, and false when it is either<br>  down or in maintenance mode. if <backend> is omitted, then the server is<br>  looked up in the current backend. it is mainly used to take action based on<br>  an external status reported via a health check (eg: a geographical site’s<br>  availability). another possible use which is more of a hack consists in<br>  using dummy servers as boolean variables that can be enabled or disabled from<br>  the cli, so that rules depending on those acls can be tweaked in realtime.</p>\n<p>srv_sess_rate([<backend>/]<server>) : integer<br>  returns an integer corresponding to the sessions creation rate on the<br>  designated server, in number of new sessions per second. if <backend> is<br>  omitted, then the server is looked up in the current backend. this is mostly<br>  used with acls but can make sense with logs too. this is used to switch to an<br>  alternate backend when an expensive or fragile one reaches too high a session<br>  rate, or to limit abuse of service (eg. prevent latent requests from<br>  overloading servers).</p>\n<p>  example :</p>\n<pre><code># redirect to a separate back\nacl srv1_full srv_sess_rate(be1/srv1) gt 50\nacl srv2_full srv_sess_rate(be1/srv2) gt 50\nuse_backend be2 if srv1_full or srv2_full\n</code></pre><p>stopping : boolean<br>  returns true if the process calling the function is currently stopping. this<br>  can be useful for logging, or for relaxing certain checks or helping close<br>  certain connections upon graceful shutdown.</p>\n<p>str(<string>) : string<br>  returns a string.</p>\n<p>table_avl([<table>]) : integer<br>  returns the total number of available entries in the current proxy’s<br>  stick-table or in the designated stick-table. see also table_cnt.</p>\n<p>table_cnt([<table>]) : integer<br>  returns the total number of entries currently in use in the current proxy’s<br>  stick-table or in the designated stick-table. see also src_conn_cnt and<br>  table_avl for other entry counting methods.</p>\n<p>var(<var-name>) : undefined<br>  returns a variable with the stored type. if the variable is not set, the<br>  sample fetch fails. the name of the variable starts by an indication about its<br>  scope. the scope allowed are:<br>    “sess” : the variable is shared with all the session,<br>    “txn”  : the variable is shared with all the transaction (request and<br>             response),<br>    “req”  : the variable is shared only during the request processing,<br>    “res”  : the variable is shared only during the response processing.<br>  this prefix is followed by a name. the separator is a ‘.’. the name may only<br>  contain characters ‘a-z’, ‘a-z’, ‘0-9’ and ‘_’.</p>\n<h2 id=\"7-3-3-fetching-samples-at-layer-4\"><a href=\"#7-3-3-fetching-samples-at-layer-4\" class=\"headerlink\" title=\"7.3.3. fetching samples at layer 4\"></a>7.3.3. fetching samples at layer 4</h2><p>the layer 4 usually describes just the transport layer which in haproxy is<br>closest to the connection, where no content is yet made available. the fetch<br>methods described here are usable as low as the “tcp-request connection” rule<br>sets unless they require some future information. those generally include<br>tcp/ip addresses and ports, as well as elements from stick-tables related to<br>the incoming connection. for retrieving a value from a sticky counters, the<br>counter number can be explicitly set as 0, 1, or 2 using the pre-defined<br>“sc0<em>“, “sc1</em>“, or “sc2<em>“ prefix, or it can be specified as the first integer<br>argument when using the “sc</em>“ prefix. an optional table may be specified with<br>the “sc*” form, in which case the currently tracked key will be looked up into<br>this alternate table instead of the table currently being tracked.</p>\n<p>be_id : integer<br>  returns an integer containing the current backend’s id. it can be used in<br>  frontends with responses to check which backend processed the request.</p>\n<p>dst : ip<br>  this is the destination ipv4 address of the connection on the client side,<br>  which is the address the client connected to. it can be useful when running<br>  in transparent mode. it is of type ip and works on both ipv4 and ipv6 tables.<br>  on ipv6 tables, ipv4 address is mapped to its ipv6 equivalent, according to<br>  rfc 4291.</p>\n<p>dst_conn : integer<br>  returns an integer value corresponding to the number of currently established<br>  connections on the same socket including the one being evaluated. it is<br>  normally used with acls but can as well be used to pass the information to<br>  servers in an http header or in logs. it can be used to either return a sorry<br>  page before hard-blocking, or to use a specific backend to drain new requests<br>  when the socket is considered saturated. this offers the ability to assign<br>  different limits to different listening ports or addresses. see also the<br>  “fe_conn” and “be_conn” fetches.</p>\n<p>dst_port : integer<br>  returns an integer value corresponding to the destination tcp port of the<br>  connection on the client side, which is the port the client connected to.<br>  this might be used when running in transparent mode, when assigning dynamic<br>  ports to some clients for a whole application session, to stick all users to<br>  a same server, or to pass the destination port information to a server using<br>  an http header.</p>\n<p>fe_id : integer<br>  returns an integer containing the current frontend’s id. it can be used in<br>  backends to check from which backend it was called, or to stick all users<br>  coming via a same frontend to the same server.</p>\n<p>sc_bytes_in_rate(<ctr>[,<table>]) : integer<br>sc0_bytes_in_rate([<table>]) : integer<br>sc1_bytes_in_rate([<table>]) : integer<br>sc2_bytes_in_rate([<table>]) : integer<br>  returns the average client-to-server bytes rate from the currently tracked<br>  counters, measured in amount of bytes over the period configured in the<br>  table. see also src_bytes_in_rate.</p>\n<p>sc_bytes_out_rate(<ctr>[,<table>]) : integer<br>sc0_bytes_out_rate([<table>]) : integer<br>sc1_bytes_out_rate([<table>]) : integer<br>sc2_bytes_out_rate([<table>]) : integer<br>  returns the average server-to-client bytes rate from the currently tracked<br>  counters, measured in amount of bytes over the period configured in the<br>  table. see also src_bytes_out_rate.</p>\n<p>sc_clr_gpc0(<ctr>[,<table>]) : integer<br>sc0_clr_gpc0([<table>]) : integer<br>sc1_clr_gpc0([<table>]) : integer<br>sc2_clr_gpc0([<table>]) : integer<br>  clears the first general purpose counter associated to the currently tracked<br>  counters, and returns its previous value. before the first invocation, the<br>  stored value is zero, so first invocation will always return zero. this is<br>  typically used as a second acl in an expression in order to mark a connection<br>  when a first acl was verified :</p>\n<pre><code># block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 5\nacl save  sc0_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n</code></pre><p>sc_conn_cnt(<ctr>[,<table>]) : integer<br>sc0_conn_cnt([<table>]) : integer<br>sc1_conn_cnt([<table>]) : integer<br>sc2_conn_cnt([<table>]) : integer<br>  returns the cumulated number of incoming connections from currently tracked<br>  counters. see also src_conn_cnt.</p>\n<p>sc_conn_cur(<ctr>[,<table>]) : integer<br>sc0_conn_cur([<table>]) : integer<br>sc1_conn_cur([<table>]) : integer<br>sc2_conn_cur([<table>]) : integer<br>  returns the current amount of concurrent connections tracking the same<br>  tracked counters. this number is automatically incremented when tracking<br>  begins and decremented when tracking stops. see also src_conn_cur.</p>\n<p>sc_conn_rate(<ctr>[,<table>]) : integer<br>sc0_conn_rate([<table>]) : integer<br>sc1_conn_rate([<table>]) : integer<br>sc2_conn_rate([<table>]) : integer<br>  returns the average connection rate from the currently tracked counters,<br>  measured in amount of connections over the period configured in the table.<br>  see also src_conn_rate.</p>\n<p>sc_get_gpc0(<ctr>[,<table>]) : integer<br>sc0_get_gpc0([<table>]) : integer<br>sc1_get_gpc0([<table>]) : integer<br>sc2_get_gpc0([<table>]) : integer<br>  returns the value of the first general purpose counter associated to the<br>  currently tracked counters. see also src_get_gpc0 and sc/sc0/sc1/sc2_inc_gpc0.</p>\n<p>sc_gpc0_rate(<ctr>[,<table>]) : integer<br>sc0_gpc0_rate([<table>]) : integer<br>sc1_gpc0_rate([<table>]) : integer<br>sc2_gpc0_rate([<table>]) : integer<br>  returns the average increment rate of the first general purpose counter<br>  associated to the currently tracked counters. it reports the frequency<br>  which the gpc0 counter was incremented over the configured period. see also<br>  src_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. note<br>  that the “gpc0_rate” counter must be stored in the stick-table for a value to<br>  be returned, as “gpc0” only holds the event count.</p>\n<p>sc_http_err_cnt(<ctr>[,<table>]) : integer<br>sc0_http_err_cnt([<table>]) : integer<br>sc1_http_err_cnt([<table>]) : integer<br>sc2_http_err_cnt([<table>]) : integer<br>  returns the cumulated number of http errors from the currently tracked<br>  counters. this includes the both request errors and 4xx error responses.<br>  see also src_http_err_cnt.</p>\n<p>sc_http_err_rate(<ctr>[,<table>]) : integer<br>sc0_http_err_rate([<table>]) : integer<br>sc1_http_err_rate([<table>]) : integer<br>sc2_http_err_rate([<table>]) : integer<br>  returns the average rate of http errors from the currently tracked counters,<br>  measured in amount of errors over the period configured in the table. this<br>  includes the both request errors and 4xx error responses. see also<br>  src_http_err_rate.</p>\n<p>sc_http_req_cnt(<ctr>[,<table>]) : integer<br>sc0_http_req_cnt([<table>]) : integer<br>sc1_http_req_cnt([<table>]) : integer<br>sc2_http_req_cnt([<table>]) : integer<br>  returns the cumulated number of http requests from the currently tracked<br>  counters. this includes every started request, valid or not. see also<br>  src_http_req_cnt.</p>\n<p>sc_http_req_rate(<ctr>[,<table>]) : integer<br>sc0_http_req_rate([<table>]) : integer<br>sc1_http_req_rate([<table>]) : integer<br>sc2_http_req_rate([<table>]) : integer<br>  returns the average rate of http requests from the currently tracked<br>  counters, measured in amount of requests over the period configured in<br>  the table. this includes every started request, valid or not. see also<br>  src_http_req_rate.</p>\n<p>sc_inc_gpc0(<ctr>[,<table>]) : integer<br>sc0_inc_gpc0([<table>]) : integer<br>sc1_inc_gpc0([<table>]) : integer<br>sc2_inc_gpc0([<table>]) : integer<br>  increments the first general purpose counter associated to the currently<br>  tracked counters, and returns its new value. before the first invocation,<br>  the stored value is zero, so first invocation will increase it to 1 and will<br>  return 1. this is typically used as a second acl in an expression in order<br>  to mark a connection when a first acl was verified :</p>\n<pre><code>acl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n</code></pre><p>sc_kbytes_in(<ctr>[,<table>]) : integer<br>sc0_kbytes_in([<table>]) : integer<br>sc1_kbytes_in([<table>]) : integer<br>sc2_kbytes_in([<table>]) : integer<br>  returns the total amount of client-to-server data from the currently tracked<br>  counters, measured in kilobytes. the test is currently performed on 32-bit<br>  integers, which limits values to 4 terabytes. see also src_kbytes_in.</p>\n<p>sc_kbytes_out(<ctr>[,<table>]) : integer<br>sc0_kbytes_out([<table>]) : integer<br>sc1_kbytes_out([<table>]) : integer<br>sc2_kbytes_out([<table>]) : integer<br>  returns the total amount of server-to-client data from the currently tracked<br>  counters, measured in kilobytes. the test is currently performed on 32-bit<br>  integers, which limits values to 4 terabytes. see also src_kbytes_out.</p>\n<p>sc_sess_cnt(<ctr>[,<table>]) : integer<br>sc0_sess_cnt([<table>]) : integer<br>sc1_sess_cnt([<table>]) : integer<br>sc2_sess_cnt([<table>]) : integer<br>  returns the cumulated number of incoming connections that were transformed<br>  into sessions, which means that they were accepted by a “tcp-request<br>  connection” rule, from the currently tracked counters. a backend may count<br>  more sessions than connections because each connection could result in many<br>  backend sessions if some http keep-alive is performed over the connection<br>  with the client. see also src_sess_cnt.</p>\n<p>sc_sess_rate(<ctr>[,<table>]) : integer<br>sc0_sess_rate([<table>]) : integer<br>sc1_sess_rate([<table>]) : integer<br>sc2_sess_rate([<table>]) : integer<br>  returns the average session rate from the currently tracked counters,<br>  measured in amount of sessions over the period configured in the table. a<br>  session is a connection that got past the early “tcp-request connection”<br>  rules. a backend may count more sessions than connections because each<br>  connection could result in many backend sessions if some http keep-alive is<br>  performed over the connection with the client. see also src_sess_rate.</p>\n<p>sc_tracked(<ctr>[,<table>]) : boolean<br>sc0_tracked([<table>]) : boolean<br>sc1_tracked([<table>]) : boolean<br>sc2_tracked([<table>]) : boolean<br>  returns true if the designated session counter is currently being tracked by<br>  the current session. this can be useful when deciding whether or not we want<br>  to set some values in a header passed to the server.</p>\n<p>sc_trackers(<ctr>[,<table>]) : integer<br>sc0_trackers([<table>]) : integer<br>sc1_trackers([<table>]) : integer<br>sc2_trackers([<table>]) : integer<br>  returns the current amount of concurrent connections tracking the same<br>  tracked counters. this number is automatically incremented when tracking<br>  begins and decremented when tracking stops. it differs from sc0_conn_cur in<br>  that it does not rely on any stored information but on the table’s reference<br>  count (the “use” value which is returned by “show table” on the cli). this<br>  may sometimes be more suited for layer7 tracking. it can be used to tell a<br>  server how many concurrent connections there are from a given address for<br>  example.</p>\n<p>so_id : integer<br>  returns an integer containing the current listening socket’s id. it is useful<br>  in frontends involving many “bind” lines, or to stick all users coming via a<br>  same socket to the same server.</p>\n<p>src : ip<br>  this is the source ipv4 address of the client of the session.  it is of type<br>  ip and works on both ipv4 and ipv6 tables. on ipv6 tables, ipv4 addresses are<br>  mapped to their ipv6 equivalent, according to rfc 4291. note that it is the<br>  tcp-level source address which is used, and not the address of a client<br>  behind a proxy. however if the “accept-proxy” bind directive is used, it can<br>  be the address of a client behind another proxy-protocol compatible component<br>  for all rule sets except “tcp-request connection” which sees the real address.</p>\n<p>  example:</p>\n<pre><code># add an http header in requests with the originating address&apos; country\nhttp-request set-header x-country %[src,map_ip(geoip.lst)]\n</code></pre><p>src_bytes_in_rate([<table>]) : integer<br>  returns the average bytes rate from the incoming connection’s source address<br>  in the current proxy’s stick-table or in the designated stick-table, measured<br>  in amount of bytes over the period configured in the table. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_in_rate.</p>\n<p>src_bytes_out_rate([<table>]) : integer<br>  returns the average bytes rate to the incoming connection’s source address in<br>  the current proxy’s stick-table or in the designated stick-table, measured in<br>  amount of bytes over the period configured in the table. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_bytes_out_rate.</p>\n<p>src_clr_gpc0([<table>]) : integer<br>  clears the first general purpose counter associated to the incoming<br>  connection’s source address in the current proxy’s stick-table or in the<br>  designated stick-table, and returns its previous value. if the address is not<br>  found, an entry is created and 0 is returned. this is typically used as a<br>  second acl in an expression in order to mark a connection when a first acl<br>  was verified :</p>\n<pre><code># block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse src_http_req_rate gt 10\nacl kill  src_inc_gpc0 gt 5\nacl save  src_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n</code></pre><p>src_conn_cnt([<table>]) : integer<br>  returns the cumulated number of connections initiated from the current<br>  incoming connection’s source address in the current proxy’s stick-table or in<br>  the designated stick-table. if the address is not found, zero is returned.<br>  see also sc/sc0/sc1/sc2_conn_cnt.</p>\n<p>src_conn_cur([<table>]) : integer<br>  returns the current amount of concurrent connections initiated from the<br>  current incoming connection’s source address in the current proxy’s<br>  stick-table or in the designated stick-table. if the address is not found,<br>  zero is returned. see also sc/sc0/sc1/sc2_conn_cur.</p>\n<p>src_conn_rate([<table>]) : integer<br>  returns the average connection rate from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of connections over the period configured in the table. if<br>  the address is not found, zero is returned. see also sc/sc0/sc1/sc2_conn_rate.</p>\n<p>src_get_gpc0([<table>]) : integer<br>  returns the value of the first general purpose counter associated to the<br>  incoming connection’s source address in the current proxy’s stick-table or in<br>  the designated stick-table. if the address is not found, zero is returned.<br>  see also sc/sc0/sc1/sc2_get_gpc0 and src_inc_gpc0.</p>\n<p>src_gpc0_rate([<table>]) : integer<br>  returns the average increment rate of the first general purpose counter<br>  associated to the incoming connection’s source address in the current proxy’s<br>  stick-table or in the designated stick-table. it reports the frequency<br>  which the gpc0 counter was incremented over the configured period. see also<br>  sc/sc0/sc1/sc2_gpc0_rate, src_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. note<br>  that the “gpc0_rate” counter must be stored in the stick-table for a value to<br>  be returned, as “gpc0” only holds the event count.</p>\n<p>src_http_err_cnt([<table>]) : integer<br>  returns the cumulated number of http errors from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated<br>  stick-table. this includes the both request errors and 4xx error responses.<br>  see also sc/sc0/sc1/sc2_http_err_cnt. if the address is not found, zero is<br>  returned.</p>\n<p>src_http_err_rate([<table>]) : integer<br>  returns the average rate of http errors from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of errors over the period configured in the table. this<br>  includes the both request errors and 4xx error responses. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_err_rate.</p>\n<p>src_http_req_cnt([<table>]) : integer<br>  returns the cumulated number of http requests from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated stick-<br>  table. this includes every started request, valid or not. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_cnt.</p>\n<p>src_http_req_rate([<table>]) : integer<br>  returns the average rate of http requests from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated stick-<br>  table, measured in amount of requests over the period configured in the<br>  table. this includes every started request, valid or not. if the address is<br>  not found, zero is returned. see also sc/sc0/sc1/sc2_http_req_rate.</p>\n<p>src_inc_gpc0([<table>]) : integer<br>  increments the first general purpose counter associated to the incoming<br>  connection’s source address in the current proxy’s stick-table or in the<br>  designated stick-table, and returns its new value. if the address is not<br>  found, an entry is created and 1 is returned. see also sc0/sc2/sc2_inc_gpc0.<br>  this is typically used as a second acl in an expression in order to mark a<br>  connection when a first acl was verified :</p>\n<pre><code>acl abuse src_http_req_rate gt 10\nacl kill  src_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n</code></pre><p>src_kbytes_in([<table>]) : integer<br>  returns the total amount of data received from the incoming connection’s<br>  source address in the current proxy’s stick-table or in the designated<br>  stick-table, measured in kilobytes. if the address is not found, zero is<br>  returned. the test is currently performed on 32-bit integers, which limits<br>  values to 4 terabytes. see also sc/sc0/sc1/sc2_kbytes_in.</p>\n<p>src_kbytes_out([<table>]) : integer<br>  returns the total amount of data sent to the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in kilobytes. if the address is not found, zero is returned. the<br>  test is currently performed on 32-bit integers, which limits values to 4<br>  terabytes. see also sc/sc0/sc1/sc2_kbytes_out.</p>\n<p>src_port : integer<br>  returns an integer value corresponding to the tcp source port of the<br>  connection on the client side, which is the port the client connected from.<br>  usage of this function is very limited as modern protocols do not care much<br>  about source ports nowadays.</p>\n<p>src_sess_cnt([<table>]) : integer<br>  returns the cumulated number of connections initiated from the incoming<br>  connection’s source ipv4 address in the current proxy’s stick-table or in the<br>  designated stick-table, that were transformed into sessions, which means that<br>  they were accepted by “tcp-request” rules. if the address is not found, zero<br>  is returned. see also sc/sc0/sc1/sc2_sess_cnt.</p>\n<p>src_sess_rate([<table>]) : integer<br>  returns the average session rate from the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table,<br>  measured in amount of sessions over the period configured in the table. a<br>  session is a connection that went past the early “tcp-request” rules. if the<br>  address is not found, zero is returned. see also sc/sc0/sc1/sc2_sess_rate.</p>\n<p>src_updt_conn_cnt([<table>]) : integer<br>  creates or updates the entry associated to the incoming connection’s source<br>  address in the current proxy’s stick-table or in the designated stick-table.<br>  this table must be configured to store the “conn_cnt” data type, otherwise<br>  the match will be ignored. the current count is incremented by one, and the<br>  expiration timer refreshed. the updated count is returned, so this match<br>  can’t return zero. this was used to reject service abusers based on their<br>  source address. note: it is recommended to use the more complete “track-sc*”<br>  actions in “tcp-request” rules instead.</p>\n<p>  example :</p>\n<pre><code># this frontend limits incoming ssh connections to 3 per 10 second for\n# each source address, and rejects excess connections until a 10 second\n# silence is observed. at most 20 addresses are tracked.\nlisten ssh\n    bind :22\n    mode tcp\n    maxconn 100\n    stick-table type ip size 20 expire 10s store conn_cnt\n    tcp-request content reject if { src_updt_conn_cnt gt 3 }\n    server local 127.0.0.1:22\n</code></pre><p>srv_id : integer<br>  returns an integer containing the server’s id when processing the response.<br>  while it’s almost only used with acls, it may be used for logging or<br>  debugging.</p>\n<h2 id=\"7-3-4-fetching-samples-at-layer-5\"><a href=\"#7-3-4-fetching-samples-at-layer-5\" class=\"headerlink\" title=\"7.3.4. fetching samples at layer 5\"></a>7.3.4. fetching samples at layer 5</h2><p>the layer 5 usually describes just the session layer which in haproxy is<br>closest to the session once all the connection handshakes are finished, but<br>when no content is yet made available. the fetch methods described here are<br>usable as low as the “tcp-request content” rule sets unless they require some<br>future information. those generally include the results of ssl negotiations.</p>\n<p>ssl_bc : boolean<br>  returns true when the back connection was made via an ssl/tls transport<br>  layer and is locally deciphered. this means the outgoing connection was made<br>  other a server with the “ssl” option.</p>\n<p>ssl_bc_alg_keysize : integer<br>  returns the symmetric cipher key size supported in bits when the outgoing<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_bc_cipher : string<br>  returns the name of the used cipher when the outgoing connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_bc_protocol : string<br>  returns the name of the used protocol when the outgoing connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_bc_unique_id : binary<br>  when the outgoing connection was made over an ssl/tls transport layer,<br>  returns the tls unique id as defined in rfc5929 section 3. the unique id<br>  can be encoded to base64 using the converter: “ssl_bc_unique_id,base64”.</p>\n<p>ssl_bc_session_id : binary<br>  returns the ssl id of the back connection when the outgoing connection was<br>  made over an ssl/tls transport layer. it is useful to log if we want to know<br>  if session was reused or not.</p>\n<p>ssl_bc_use_keysize : integer<br>  returns the symmetric cipher key size used in bits when the outgoing<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_c_ca_err : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the id of the first error detected during verification of the client<br>  certificate at depth &gt; 0, or 0 if no error was encountered during this<br>  verification process. please refer to your ssl library’s documentation to<br>  find the exhaustive list of error codes.</p>\n<p>ssl_c_ca_err_depth : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the depth in the ca chain of the first error detected during the<br>  verification of the client certificate. if no error is encountered, 0 is<br>  returned.</p>\n<p>ssl_c_der : binary<br>  returns the der formatted certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_c_err : integer<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the id of the first error detected during verification at depth 0, or<br>  0 if no error was encountered during this verification process. please refer<br>  to your ssl library’s documentation to find the exhaustive list of error<br>  codes.</p>\n<p>ssl_c_i_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the issuer of the certificate<br>  presented by the client when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_c_i_dn(ou,2)” the second organization unit, and<br>  “ssl_c_i_dn(cn)” retrieves the common name.</p>\n<p>ssl_c_key_alg : string<br>  returns the name of the algorithm used to generate the key of the certificate<br>  presented by the client when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_notafter : string<br>  returns the end date presented by the client as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_notbefore : string<br>  returns the start date presented by the client as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_c_s_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the subject of the certificate<br>  presented by the client when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_c_s_dn(ou,2)” the second organization unit, and<br>  “ssl_c_s_dn(cn)” retrieves the common name.</p>\n<p>ssl_c_serial : binary<br>  returns the serial of the certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_c_sha1 : binary<br>  returns the sha-1 fingerprint of the certificate presented by the client when<br>  the incoming connection was made over an ssl/tls transport layer. this can be<br>  used to stick a client to a server, or to pass this information to a server.<br>  note that the output is binary, so if you want to pass that signature to the<br>  server, you need to encode it in hex or base64, such as in the example below:</p>\n<pre><code>http-request set-header x-ssl-client-sha1 %[ssl_c_sha1,hex]\n</code></pre><p>ssl_c_sig_alg : string<br>  returns the name of the algorithm used to sign the certificate presented by<br>  the client when the incoming connection was made over an ssl/tls transport<br>  layer.</p>\n<p>ssl_c_used : boolean<br>  returns true if current ssl session uses a client certificate even if current<br>  connection uses ssl session resumption. see also “ssl_fc_has_crt”.</p>\n<p>ssl_c_verify : integer<br>  returns the verify result error id when the incoming connection was made over<br>  an ssl/tls transport layer, otherwise zero if no error is encountered. please<br>  refer to your ssl library’s documentation for an exhaustive list of error<br>  codes.</p>\n<p>ssl_c_version : integer<br>  returns the version of the certificate presented by the client when the<br>  incoming connection was made over an ssl/tls transport layer.</p>\n<p>ssl_f_der : binary<br>  returns the der formatted certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_f_i_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the issuer of the certificate<br>  presented by the frontend when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_f_i_dn(ou,2)” the second organization unit, and<br>  “ssl_f_i_dn(cn)” retrieves the common name.</p>\n<p>ssl_f_key_alg : string<br>  returns the name of the algorithm used to generate the key of the certificate<br>  presented by the frontend when the incoming connection was made over an<br>  ssl/tls transport layer.</p>\n<p>ssl_f_notafter : string<br>  returns the end date presented by the frontend as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_f_notbefore : string<br>  returns the start date presented by the frontend as a formatted string<br>  yymmddhhmmss[z] when the incoming connection was made over an ssl/tls<br>  transport layer.</p>\n<p>ssl_f_s_dn([<entry>[,<occ>]]) : string<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the full distinguished name of the subject of the certificate<br>  presented by the frontend when no <entry> is specified, or the value of the<br>  first given entry found from the beginning of the dn. if a positive/negative<br>  occurrence number is specified as the optional second argument, it returns<br>  the value of the nth given entry value from the beginning/end of the dn.<br>  for instance, “ssl_f_s_dn(ou,2)” the second organization unit, and<br>  “ssl_f_s_dn(cn)” retrieves the common name.</p>\n<p>ssl_f_serial : binary<br>  returns the serial of the certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer. when used for<br>  an acl, the value(s) to match against can be passed in hexadecimal form.</p>\n<p>ssl_f_sha1 : binary<br>  returns the sha-1 fingerprint of the certificate presented by the frontend<br>  when the incoming connection was made over an ssl/tls transport layer. this<br>  can be used to know which certificate was chosen using sni.</p>\n<p>ssl_f_sig_alg : string<br>  returns the name of the algorithm used to sign the certificate presented by<br>  the frontend when the incoming connection was made over an ssl/tls transport<br>  layer.</p>\n<p>ssl_f_version : integer<br>  returns the version of the certificate presented by the frontend when the<br>  incoming connection was made over an ssl/tls transport layer.</p>\n<p>ssl_fc : boolean<br>  returns true when the front connection was made via an ssl/tls transport<br>  layer and is locally deciphered. this means it has matched a socket declared<br>  with a “bind” line having the “ssl” option.</p>\n<p>  example :</p>\n<pre><code># this passes &quot;x-proto: https&quot; to servers when client connects over ssl\nlisten http-https\n    bind :80\n    bind :443 ssl crt /etc/haproxy.pem\n    http-request add-header x-proto https if { ssl_fc }\n</code></pre><p>ssl_fc_alg_keysize : integer<br>  returns the symmetric cipher key size supported in bits when the incoming<br>  connection was made over an ssl/tls transport layer.</p>\n<p>ssl_fc_alpn : string<br>  this extracts the application layer protocol negotiation field from an<br>  incoming connection made via a tls transport layer and locally deciphered by<br>  haproxy. the result is a string containing the protocol name advertised by<br>  the client. the ssl library must have been built with support for tls<br>  extensions enabled (check haproxy -vv). note that the tls alpn extension is<br>  not advertised unless the “alpn” keyword on the “bind” line specifies a<br>  protocol list. also, nothing forces the client to pick a protocol from this<br>  list, any other one may be requested. the tls alpn extension is meant to<br>  replace the tls npn extension. see also “ssl_fc_npn”.</p>\n<p>ssl_fc_cipher : string<br>  returns the name of the used cipher when the incoming connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_fc_has_crt : boolean<br>  returns true if a client certificate is present in an incoming connection over<br>  ssl/tls transport layer. useful if ‘verify’ statement is set to ‘optional’.<br>  note: on ssl session resumption with session id or tls ticket, client<br>  certificate is not present in the current connection but may be retrieved<br>  from the cache or the ticket. so prefer “ssl_c_used” if you want to check if<br>  current ssl session uses a client certificate.</p>\n<p>ssl_fc_has_sni : boolean<br>  this checks for the presence of a server name indication tls extension (sni)<br>  in an incoming connection was made over an ssl/tls transport layer. returns<br>  true when the incoming connection presents a tls sni field. this requires<br>  that the ssl library is build with support for tls extensions enabled (check<br>  haproxy -vv).</p>\n<p>ssl_fc_is_resumed: boolean<br>  returns true if the ssl/tls session has been resumed through the use of<br>  ssl session cache or tls tickets.</p>\n<p>ssl_fc_npn : string<br>  this extracts the next protocol negotiation field from an incoming connection<br>  made via a tls transport layer and locally deciphered by haproxy. the result<br>  is a string containing the protocol name advertised by the client. the ssl<br>  library must have been built with support for tls extensions enabled (check<br>  haproxy -vv). note that the tls npn extension is not advertised unless the<br>  “npn” keyword on the “bind” line specifies a protocol list. also, nothing<br>  forces the client to pick a protocol from this list, any other one may be<br>  requested. please note that the tls npn extension was replaced with alpn.</p>\n<p>ssl_fc_protocol : string<br>  returns the name of the used protocol when the incoming connection was made<br>  over an ssl/tls transport layer.</p>\n<p>ssl_fc_unique_id : binary<br>  when the incoming connection was made over an ssl/tls transport layer,<br>  returns the tls unique id as defined in rfc5929 section 3. the unique id<br>  can be encoded to base64 using the converter: “ssl_bc_unique_id,base64”.</p>\n<p>ssl_fc_session_id : binary<br>  returns the ssl id of the front connection when the incoming connection was<br>  made over an ssl/tls transport layer. it is useful to stick a given client to<br>  a server. it is important to note that some browsers refresh their session id<br>  every few minutes.</p>\n<p>ssl_fc_sni : string<br>  this extracts the server name indication tls extension (sni) field from an<br>  incoming connection made via an ssl/tls transport layer and locally<br>  deciphered by haproxy. the result (when present) typically is a string<br>  matching the https host name (253 chars or less). the ssl library must have<br>  been built with support for tls extensions enabled (check haproxy -vv).</p>\n<p>  this fetch is different from “req_ssl_sni” above in that it applies to the<br>  connection being deciphered by haproxy and not to ssl contents being blindly<br>  forwarded. see also “ssl_fc_sni_end” and “ssl_fc_sni_reg” below. this<br>  requires that the ssl library is build with support for tls extensions<br>  enabled (check haproxy -vv).</p>\n<p>  acl derivatives :<br>    ssl_fc_sni_end : suffix match<br>    ssl_fc_sni_reg : regex match</p>\n<p>ssl_fc_use_keysize : integer<br>  returns the symmetric cipher key size used in bits when the incoming<br>  connection was made over an ssl/tls transport layer.</p>\n<h2 id=\"7-3-5-fetching-samples-from-buffer-contents-layer-6\"><a href=\"#7-3-5-fetching-samples-from-buffer-contents-layer-6\" class=\"headerlink\" title=\"7.3.5. fetching samples from buffer contents (layer 6)\"></a>7.3.5. fetching samples from buffer contents (layer 6)</h2><p>fetching samples from buffer contents is a bit different from the previous<br>sample fetches above because the sampled data are ephemeral. these data can<br>only be used when they’re available and will be lost when they’re forwarded.<br>for this reason, samples fetched from buffer contents during a request cannot<br>be used in a response for example. even while the data are being fetched, they<br>can change. sometimes it is necessary to set some delays or combine multiple<br>sample fetch methods to ensure that the expected data are complete and usable,<br>for example through tcp request content inspection. please see the “tcp-request<br>content” keyword for more detailed information on the subject.</p>\n<p>payload(<offset>,<length>) : binary (deprecated)<br>  this is an alias for “req.payload” when used in the context of a request (eg:<br>  “stick on”, “stick match”), and for “res.payload” when used in the context of<br>  a response such as in “stick store response”.</p>\n<p>payload_lv(<offset1>,<length>[,<offset2>]) : binary (deprecated)<br>  this is an alias for “req.payload_lv” when used in the context of a request<br>  (eg: “stick on”, “stick match”), and for “res.payload_lv” when used in the<br>  context of a response such as in “stick store response”.</p>\n<p>req.len : integer<br>req_len : integer (deprecated)<br>  returns an integer value corresponding to the number of bytes present in the<br>  request buffer. this is mostly used in acl. it is important to understand<br>  that this test does not return false as long as the buffer is changing. this<br>  means that a check with equality to zero will almost always immediately match<br>  at the beginning of the session, while a test for more data will wait for<br>  that data to come in and return false only when haproxy is certain that no<br>  more data will come in. this test was designed to be used with tcp request<br>  content inspection.</p>\n<p>req.payload(<offset>,<length>) : binary<br>  this extracts a binary block of <length> bytes and starting at byte <offset><br>  in the request buffer. as a special case, if the <length> argument is zero,<br>  the the whole buffer from <offset> to the end is extracted. this can be used<br>  with acls in order to check for the presence of some content in a buffer at<br>  any location.</p>\n<p>  acl alternatives :<br>    payload(<offset>,<length>) : hex binary match</p>\n<p>req.payload_lv(<offset1>,<length>[,<offset2>]) : binary<br>  this extracts a binary block whose size is specified at <offset1> for <length><br>  bytes, and which starts at <offset2> if specified or just after the length in<br>  the request buffer. the <offset2> parameter also supports relative offsets if<br>  prepended with a ‘+’ or ‘-‘ sign.</p>\n<p>  acl alternatives :<br>    payload_lv(<offset1>,<length>[,<offset2>]) : hex binary match</p>\n<p>  example : please consult the example from the “stick store-response” keyword.</p>\n<p>req.proto_http : boolean<br>req_proto_http : boolean (deprecated)<br>  returns true when data in the request buffer look like http and correctly<br>  parses as such. it is the same parser as the common http request parser which<br>  is used so there should be no surprises. the test does not match until the<br>  request is complete, failed or timed out. this test may be used to report the<br>  protocol in tcp logs, but the biggest use is to block tcp request analysis<br>  until a complete http request is present in the buffer, for example to track<br>  a header.</p>\n<p>  example:</p>\n<pre><code># track request counts per &quot;base&quot; (concatenation of host+url)\ntcp-request inspect-delay 10s\ntcp-request content reject if !http\ntcp-request content track-sc0 base table req-rate\n</code></pre><p>req.rdp_cookie([<name>]) : string<br>rdp_cookie([<name>]) : string (deprecated)<br>  when the request buffer looks like the rdp protocol, extracts the rdp cookie<br>  <name>, or any cookie if unspecified. the parser only checks for the first<br>  cookie, as illustrated in the rdp protocol specification. the cookie name is<br>  case insensitive. generally the “msts” cookie name will be used, as it can<br>  contain the user name of the client connecting to the server if properly<br>  configured on the client. the “mstshash” cookie is often used as well for<br>  session stickiness to servers.</p>\n<p>  this differs from “balance rdp-cookie” in that any balancing algorithm may be<br>  used and thus the distribution of clients to backend servers is not linked to<br>  a hash of the rdp cookie. it is envisaged that using a balancing algorithm<br>  such as “balance roundrobin” or “balance leastconn” will lead to a more even<br>  distribution of clients to backend servers than the hash used by “balance<br>  rdp-cookie”.</p>\n<p>  acl derivatives :<br>    req_rdp_cookie([<name>]) : exact string match</p>\n<p>  example :<br>   listen tse-farm<br>       bind 0.0.0.0:3389</p>\n<pre><code># wait up to 5s for an rdp cookie in the request\ntcp-request inspect-delay 5s\ntcp-request content accept if rdp_cookie\n# apply rdp cookie persistence\npersist rdp-cookie\n# persist based on the mstshash cookie\n# this is only useful makes sense if\n# balance rdp-cookie is not used\nstick-table type string size 204800\nstick on req.rdp_cookie(mstshash)\nserver srv1 1.1.1.1:3389\nserver srv1 1.1.1.2:3389\n</code></pre><p>  see also : “balance rdp-cookie”, “persist rdp-cookie”, “tcp-request” and the<br>  “req_rdp_cookie” acl.</p>\n<p>req.rdp_cookie_cnt([name]) : integer<br>rdp_cookie_cnt([name]) : integer (deprecated)<br>  tries to parse the request buffer as rdp protocol, then returns an integer<br>  corresponding to the number of rdp cookies found. if an optional cookie name<br>  is passed, only cookies matching this name are considered. this is mostly<br>  used in acl.</p>\n<p>  acl derivatives :<br>    req_rdp_cookie_cnt([<name>]) : integer match</p>\n<p>req.ssl_ec_ext : boolean<br>  returns a boolean identifying if client sent the supported elliptic curves<br>  extension as defined in rfc4492, section 5.1. within the ssl clienthello<br>  message. this can be used to present ecc compatible clients with ec certificate<br>  and to use rsa for all others, on the same ip address. note that this only<br>  applies to raw contents found in the request buffer and not to contents<br>  deciphered via an ssl data layer, so this will not work with “bind” lines<br>  having the “ssl” option.</p>\n<p>req.ssl_hello_type : integer<br>req_ssl_hello_type : integer (deprecated)<br>  returns an integer value containing the type of the ssl hello message found<br>  in the request buffer if the buffer contains data that parse as a complete<br>  ssl (v3 or superior) client hello message. note that this only applies to raw<br>  contents found in the request buffer and not to contents deciphered via an<br>  ssl data layer, so this will not work with “bind” lines having the “ssl”<br>  option. this is mostly used in acl to detect presence of an ssl hello message<br>  that is supposed to contain an ssl session id usable for stickiness.</p>\n<p>req.ssl_sni : string<br>req_ssl_sni : string (deprecated)<br>  returns a string containing the value of the server name tls extension sent<br>  by a client in a tls stream passing through the request buffer if the buffer<br>  contains data that parse as a complete ssl (v3 or superior) client hello<br>  message. note that this only applies to raw contents found in the request<br>  buffer and not to contents deciphered via an ssl data layer, so this will not<br>  work with “bind” lines having the “ssl” option. sni normally contains the<br>  name of the host the client tries to connect to (for recent browsers). sni is<br>  useful for allowing or denying access to certain hosts when ssl/tls is used<br>  by the client. this test was designed to be used with tcp request content<br>  inspection. if content switching is needed, it is recommended to first wait<br>  for a complete client hello (type 1), like in the example below. see also<br>  “ssl_fc_sni”.</p>\n<p>  acl derivatives :<br>    req_ssl_sni : exact string match</p>\n<p>  examples :</p>\n<pre><code># wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req_ssl_hello_type 1 }\nuse_backend bk_allow if { req_ssl_sni -f allowed_sites }\ndefault_backend bk_sorry_page\n</code></pre><p>res.ssl_hello_type : integer<br>rep_ssl_hello_type : integer (deprecated)<br>  returns an integer value containing the type of the ssl hello message found<br>  in the response buffer if the buffer contains data that parses as a complete<br>  ssl (v3 or superior) hello message. note that this only applies to raw<br>  contents found in the response buffer and not to contents deciphered via an<br>  ssl data layer, so this will not work with “server” lines having the “ssl”<br>  option. this is mostly used in acl to detect presence of an ssl hello message<br>  that is supposed to contain an ssl session id usable for stickiness.</p>\n<p>req.ssl_ver : integer<br>req_ssl_ver : integer (deprecated)<br>  returns an integer value containing the version of the ssl/tls protocol of a<br>  stream present in the request buffer. both sslv2 hello messages and sslv3<br>  messages are supported. tlsv1 is announced as ssl version 3.1. the value is<br>  composed of the major version multiplied by 65536, added to the minor<br>  version. note that this only applies to raw contents found in the request<br>  buffer and not to contents deciphered via an ssl data layer, so this will not<br>  work with “bind” lines having the “ssl” option. the acl version of the test<br>  matches against a decimal notation in the form major.minor (eg: 3.1). this<br>  fetch is mostly used in acl.</p>\n<p>  acl derivatives :<br>    req_ssl_ver : decimal match</p>\n<p>res.len : integer<br>  returns an integer value corresponding to the number of bytes present in the<br>  response buffer. this is mostly used in acl. it is important to understand<br>  that this test does not return false as long as the buffer is changing. this<br>  means that a check with equality to zero will almost always immediately match<br>  at the beginning of the session, while a test for more data will wait for<br>  that data to come in and return false only when haproxy is certain that no<br>  more data will come in. this test was designed to be used with tcp response<br>  content inspection.</p>\n<p>res.payload(<offset>,<length>) : binary<br>  this extracts a binary block of <length> bytes and starting at byte <offset><br>  in the response buffer. as a special case, if the <length> argument is zero,<br>  the the whole buffer from <offset> to the end is extracted. this can be used<br>  with acls in order to check for the presence of some content in a buffer at<br>  any location.</p>\n<p>res.payload_lv(<offset1>,<length>[,<offset2>]) : binary<br>  this extracts a binary block whose size is specified at <offset1> for <length><br>  bytes, and which starts at <offset2> if specified or just after the length in<br>  the response buffer. the <offset2> parameter also supports relative offsets<br>  if prepended with a ‘+’ or ‘-‘ sign.</p>\n<p>  example : please consult the example from the “stick store-response” keyword.</p>\n<p>wait_end : boolean<br>  this fetch either returns true when the inspection period is over, or does<br>  not fetch. it is only used in acls, in conjunction with content analysis to<br>  avoid returning a wrong verdict early.  it may also be used to delay some<br>  actions, such as a delayed reject for some special addresses. since it either<br>  stops the rules evaluation or immediately returns true, it is recommended to<br>  use this acl as the last one in a rule.  please note that the default acl<br>  “wait_end” is always usable without prior declaration. this test was designed<br>  to be used with tcp request content inspection.</p>\n<p>  examples :</p>\n<pre><code># delay every incoming request by 2 seconds\ntcp-request inspect-delay 2s\ntcp-request content accept if wait_end\n\n# don&apos;t immediately tell bad guys they are rejected\ntcp-request inspect-delay 10s\nacl goodguys src 10.0.0.0/24\nacl badguys  src 10.0.1.0/24\ntcp-request content accept if goodguys\ntcp-request content reject if badguys wait_end\ntcp-request content reject\n</code></pre><h2 id=\"7-3-6-fetching-http-samples-layer-7\"><a href=\"#7-3-6-fetching-http-samples-layer-7\" class=\"headerlink\" title=\"7.3.6. fetching http samples (layer 7)\"></a>7.3.6. fetching http samples (layer 7)</h2><p>it is possible to fetch samples from http contents, requests and responses.<br>this application layer is also called layer 7. it is only possible to fetch the<br>data in this section when a full http request or response has been parsed from<br>its respective request or response buffer. this is always the case with all<br>http specific rules and for sections running with “mode http”. when using tcp<br>content inspection, it may be necessary to support an inspection delay in order<br>to let the request or response come in first. these fetches may require a bit<br>more cpu resources than the layer 4 ones, but not much since the request and<br>response are indexed.</p>\n<p>base : string<br>  this returns the concatenation of the first host header and the path part of<br>  the request, which starts at the first slash and ends before the question<br>  mark. it can be useful in virtual hosted environments to detect url abuses as<br>  well as to improve shared caches efficiency. using this with a limited size<br>  stick table also allows one to collect statistics about most commonly<br>  requested objects by host/path. with acls it can allow simple content<br>  switching rules involving the host and the path at the same time, such as<br>  “www.example.com/favicon.ico”. see also “path” and “uri”.</p>\n<p>  acl derivatives :<br>    base     : exact string match<br>    base_beg : prefix match<br>    base_dir : subdir match<br>    base_dom : domain match<br>    base_end : suffix match<br>    base_len : length match<br>    base_reg : regex match<br>    base_sub : substring match</p>\n<p>base32 : integer<br>  this returns a 32-bit hash of the value returned by the “base” fetch method<br>  above. this is useful to track per-url activity on high traffic sites without<br>  having to store all urls. instead a shorter hash is stored, saving a lot of<br>  memory. the output type is an unsigned integer. the hash function used is<br>  sdbm with full avalanche on the output. technically, base32 is exactly equal<br>  to “base,sdbm(1)”.</p>\n<p>base32+src : binary<br>  this returns the concatenation of the base32 fetch above and the src fetch<br>  below. the resulting type is of type binary, with a size of 8 or 20 bytes<br>  depending on the source address family. this can be used to track per-ip,<br>  per-url counters.</p>\n<p>capture.req.hdr(<idx>) : string<br>  this extracts the content of the header captured by the “capture request<br>  header”, idx is the position of the capture keyword in the configuration.<br>  the first entry is an index of 0. see also: “capture request header”.</p>\n<p>capture.req.method : string<br>  this extracts the method of an http request. it can be used in both request<br>  and response. unlike “method”, it can be used in both request and response<br>  because it’s allocated.</p>\n<p>capture.req.uri : string<br>  this extracts the request’s uri, which starts at the first slash and ends<br>  before the first space in the request (without the host part). unlike “path”<br>  and “url”, it can be used in both request and response because it’s<br>  allocated.</p>\n<p>capture.req.ver : string<br>  this extracts the request’s http version and returns either “http/1.0” or<br>  “http/1.1”. unlike “req.ver”, it can be used in both request, response, and<br>  logs because it relies on a persistent flag.</p>\n<p>capture.res.hdr(<idx>) : string<br>  this extracts the content of the header captured by the “capture response<br>  header”, idx is the position of the capture keyword in the configuration.<br>  the first entry is an index of 0.<br>  see also: “capture response header”</p>\n<p>capture.res.ver : string<br>  this extracts the response’s http version and returns either “http/1.0” or<br>  “http/1.1”. unlike “res.ver”, it can be used in logs because it relies on a<br>  persistent flag.</p>\n<p>req.body : binary<br>  this returns the http request’s available body as a block of data. it<br>  requires that the request body has been buffered made available using<br>  “option http-buffer-request”. in case of chunked-encoded body, currently only<br>  the first chunk is analyzed.</p>\n<p>req.body_param([<name>) : string<br>  this fetch assumes that the body of the post request is url-encoded. the user<br>  can check if the “content-type” contains the value<br>  “application/x-www-form-urlencoded”. this extracts the first occurrence of the<br>  parameter <name> in the body, which ends before ‘&amp;’. the parameter name is<br>  case-sensitive. if no name is given, any parameter will match, and the first<br>  one will be returned. the result is a string corresponding to the value of the<br>  parameter <name> as presented in the request body (no url decoding is<br>  performed). note that the acl version of this fetch iterates over multiple<br>  parameters and will iteratively report all parameters values if no name is<br>  given.</p>\n<p>req.body_len : integer<br>  this returns the length of the http request’s available body in bytes. it may<br>  be lower than the advertised length if the body is larger than the buffer. it<br>  requires that the request body has been buffered made available using<br>  “option http-buffer-request”.</p>\n<p>req.body_size : integer<br>  this returns the advertised length of the http request’s body in bytes. it<br>  will represent the advertised content-length header, or the size of the first<br>  chunk in case of chunked encoding. in order to parse the chunks, it requires<br>  that the request body has been buffered made available using<br>  “option http-buffer-request”.</p>\n<p>req.cook([<name>]) : string<br>cook([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, and returns its value as string. if no name is<br>  specified, the first cookie value is returned. when used with acls, all<br>  matching cookies are evaluated. spaces around the name and the value are<br>  ignored as requested by the cookie header specification (rfc6265). the cookie<br>  name is case-sensitive. empty cookies are valid, so an empty cookie may very<br>  well return an empty value if it is present. use the “found” match to detect<br>  presence. use the res.cook() variant for response cookies sent by the server.</p>\n<p>  acl derivatives :<br>    cook([<name>])     : exact string match<br>    cook_beg([<name>]) : prefix match<br>    cook_dir([<name>]) : subdir match<br>    cook_dom([<name>]) : domain match<br>    cook_end([<name>]) : suffix match<br>    cook_len([<name>]) : length match<br>    cook_reg([<name>]) : regex match<br>    cook_sub([<name>]) : substring match</p>\n<p>req.cook_cnt([<name>]) : integer<br>cook_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of the cookie<br>  <name> in the request, or all cookies if <name> is not specified.</p>\n<p>req.cook_val([<name>]) : integer<br>cook_val([<name>]) : integer (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, and converts its value to an integer which is<br>  returned. if no name is specified, the first cookie value is returned. when<br>  used in acls, all matching names are iterated over until a value matches.</p>\n<p>cookie([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “cookie”<br>  header line from the request, or a “set-cookie” header from the response, and<br>  returns its value as a string. a typical use is to get multiple clients<br>  sharing a same profile use the same server. this can be similar to what<br>  “appsession” does with the “request-learn” statement, but with support for<br>  multi-peer synchronization and state keeping across restarts. if no name is<br>  specified, the first cookie value is returned. this fetch should not be used<br>  anymore and should be replaced by req.cook() or res.cook() instead as it<br>  ambiguously uses the direction based on the context where it is used.<br>  see also : “appsession”.</p>\n<p>hdr([<name>[,<occ>]]) : string<br>  this is equivalent to req.hdr() when used on requests, and to res.hdr() when<br>  used on responses. please refer to these respective fetches for more details.<br>  in case of doubt about the fetch direction, please use the explicit ones.<br>  note that contrary to the hdr() sample fetch method, the hdr_* acl keywords<br>  unambiguously apply to the request headers.</p>\n<p>req.fhdr(<name>[,<occ>]) : string<br>  this extracts the last occurrence of header <name> in an http request. when<br>  used from an acl, all occurrences are iterated over until a match is found.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. it differs from req.hdr() in that any commas<br>  present in the value are returned and are not used as delimiters. this is<br>  sometimes useful with headers such as user-agent.</p>\n<p>req.fhdr_cnt([<name>]) : integer<br>  returns an integer value representing the number of occurrences of request<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. contrary to its req.hdr_cnt() cousin, this function returns<br>  the number of full line headers and does not stop on commas.</p>\n<p>req.hdr([<name>[,<occ>]]) : string<br>  this extracts the last occurrence of header <name> in an http request. when<br>  used from an acl, all occurrences are iterated over until a match is found.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. a typical use is with the x-forwarded-for header<br>  once converted to ip, associated with an ip stick-table. the function<br>  considers any comma as a delimiter for distinct values. if full-line headers<br>  are desired instead, use req.fhdr(). please carefully check rfc2616 to know<br>  how certain headers are supposed to be parsed. also, some of them are case<br>  insensitive (eg: connection).</p>\n<p>  acl derivatives :<br>    hdr([<name>[,<occ>]])     : exact string match<br>    hdr_beg([<name>[,<occ>]]) : prefix match<br>    hdr_dir([<name>[,<occ>]]) : subdir match<br>    hdr_dom([<name>[,<occ>]]) : domain match<br>    hdr_end([<name>[,<occ>]]) : suffix match<br>    hdr_len([<name>[,<occ>]]) : length match<br>    hdr_reg([<name>[,<occ>]]) : regex match<br>    hdr_sub([<name>[,<occ>]]) : substring match</p>\n<p>req.hdr_cnt([<name>]) : integer<br>hdr_cnt([<header>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of request<br>  header field name <name>, or the total number of header field values if<br>  <name> is not specified. it is important to remember that one header line may<br>  count as several headers if it has several values. the function considers any<br>  comma as a delimiter for distinct values. if full-line headers are desired<br>  instead, req.fhdr_cnt() should be used instead. with acls, it can be used to<br>  detect presence, absence or abuse of a specific header, as well as to block<br>  request smuggling attacks by rejecting requests which contain more than one<br>  of certain headers. see “req.hdr” for more information on header matching.</p>\n<p>req.hdr_ip([<name>[,<occ>]]) : ip<br>hdr_ip([<name>[,<occ>]]) : ip (deprecated)<br>  this extracts the last occurrence of header <name> in an http request,<br>  converts it to an ipv4 or ipv6 address and returns this address. when used<br>  with acls, all occurrences are checked, and if <name> is omitted, every value<br>  of every header is checked. optionally, a specific occurrence might be<br>  specified as a position number. positive values indicate a position from the<br>  first occurrence, with 1 being the first one.  negative values indicate<br>  positions relative to the last one, with -1 being the last one. a typical use<br>  is with the x-forwarded-for and x-client-ip headers.</p>\n<p>req.hdr_val([<name>[,<occ>]]) : integer<br>hdr_val([<name>[,<occ>]]) : integer (deprecated)<br>  this extracts the last occurrence of header <name> in an http request, and<br>  converts it to an integer value. when used with acls, all occurrences are<br>  checked, and if <name> is omitted, every value of every header is checked.<br>  optionally, a specific occurrence might be specified as a position number.<br>  positive values indicate a position from the first occurrence, with 1 being<br>  the first one. negative values indicate positions relative to the last one,<br>  with -1 being the last one. a typical use is with the x-forwarded-for header.</p>\n<p>http_auth(<userlist>) : boolean<br>  returns a boolean indicating whether the authentication data received from<br>  the client match a username &amp; password stored in the specified userlist. this<br>  fetch function is not really useful outside of acls. currently only http<br>  basic auth is supported.</p>\n<p>http_auth_group(<userlist>) : string<br>  returns a string corresponding to the user name found in the authentication<br>  data received from the client if both the user name and password are valid<br>  according to the specified userlist. the main purpose is to use it in acls<br>  where it is then checked whether the user belongs to any group within a list.<br>  this fetch function is not really useful outside of acls. currently only http<br>  basic auth is supported.</p>\n<p>  acl derivatives :<br>    http_auth_group(<userlist>) : group …<br>    returns true when the user extracted from the request and whose password is<br>    valid according to the specified userlist belongs to at least one of the<br>    groups.</p>\n<p>http_first_req : boolean<br>  returns true when the request being processed is the first one of the<br>  connection. this can be used to add or remove headers that may be missing<br>  from some requests when a request is not the first one, or to help grouping<br>  requests in the logs.</p>\n<p>method : integer + string<br>  returns an integer value corresponding to the method in the http request. for<br>  example, “get” equals 1 (check sources to establish the matching). value 9<br>  means “other method” and may be converted to a string extracted from the<br>  stream. this should not be used directly as a sample, this is only meant to<br>  be used from acls, which transparently convert methods from patterns to these<br>  integer + string values. some predefined acl already check for most common<br>  methods.</p>\n<p>  acl derivatives :<br>    method : case insensitive method match</p>\n<p>  example :</p>\n<pre><code># only accept get and head requests\nacl valid_method method get head\nhttp-request deny if ! valid_method\n</code></pre><p>path : string<br>  this extracts the request’s url path, which starts at the first slash and<br>  ends before the question mark (without the host part). a typical use is with<br>  prefetch-capable caches, and with portals which need to aggregate multiple<br>  information from databases and keep them in caches. note that with outgoing<br>  caches, it would be wiser to use “url” instead. with acls, it’s typically<br>  used to match exact file names (eg: “/login.php”), or directory parts using<br>  the derivative forms. see also the “url” and “base” fetch methods.</p>\n<p>  acl derivatives :<br>    path     : exact string match<br>    path_beg : prefix match<br>    path_dir : subdir match<br>    path_dom : domain match<br>    path_end : suffix match<br>    path_len : length match<br>    path_reg : regex match<br>    path_sub : substring match</p>\n<p>query : string<br>  this extracts the request’s query string, which starts after the first<br>  question mark. if no question mark is present, this fetch returns nothing. if<br>  a question mark is present but nothing follows, it returns an empty string.<br>  this means it’s possible to easily know whether a query string is present<br>  using the “found” matching method. this fetch is the completemnt of “path”<br>  which stops before the question mark.</p>\n<p>req.hdr_names([<delim>]) : string<br>  this builds a string made from the concatenation of all header names as they<br>  appear in the request when the rule is evaluated. the default delimiter is<br>  the comma (‘,’) but it may be overridden as an optional argument <delim>. in<br>  this case, only the first character of <delim> is considered.</p>\n<p>req.ver : string<br>req_ver : string (deprecated)<br>  returns the version string from the http request, for example “1.1”. this can<br>  be useful for logs, but is mostly there for acl. some predefined acl already<br>  check for versions 1.0 and 1.1.</p>\n<p>  acl derivatives :<br>    req_ver : exact string match</p>\n<p>res.comp : boolean<br>  returns the boolean “true” value if the response has been compressed by<br>  haproxy, otherwise returns boolean “false”. this may be used to add<br>  information in the logs.</p>\n<p>res.comp_algo : string<br>  returns a string containing the name of the algorithm used if the response<br>  was compressed by haproxy, for example : “deflate”. this may be used to add<br>  some information in the logs.</p>\n<p>res.cook([<name>]) : string<br>scook([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response, and returns its value as string. if no name is<br>  specified, the first cookie value is returned.</p>\n<p>  acl derivatives :<br>    scook([<name>] : exact string match</p>\n<p>res.cook_cnt([<name>]) : integer<br>scook_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of the cookie<br>  <name> in the response, or all cookies if <name> is not specified. this is<br>  mostly useful when combined with acls to detect suspicious responses.</p>\n<p>res.cook_val([<name>]) : integer<br>scook_val([<name>]) : integer (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response, and converts its value to an integer which is<br>  returned. if no name is specified, the first cookie value is returned.</p>\n<p>res.fhdr([<name>[,<occ>]]) : string<br>  this extracts the last occurrence of header <name> in an http response, or of<br>  the last header if no <name> is specified. optionally, a specific occurrence<br>  might be specified as a position number. positive values indicate a position<br>  from the first occurrence, with 1 being the first one. negative values<br>  indicate positions relative to the last one, with -1 being the last one. it<br>  differs from res.hdr() in that any commas present in the value are returned<br>  and are not used as delimiters. if this is not desired, the res.hdr() fetch<br>  should be used instead. this is sometimes useful with headers such as date or<br>  expires.</p>\n<p>res.fhdr_cnt([<name>]) : integer<br>  returns an integer value representing the number of occurrences of response<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. contrary to its res.hdr_cnt() cousin, this function returns<br>  the number of full line headers and does not stop on commas. if this is not<br>  desired, the res.hdr_cnt() fetch should be used instead.</p>\n<p>res.hdr([<name>[,<occ>]]) : string<br>shdr([<name>[,<occ>]]) : string (deprecated)<br>  this extracts the last occurrence of header <name> in an http response, or of<br>  the last header if no <name> is specified. optionally, a specific occurrence<br>  might be specified as a position number. positive values indicate a position<br>  from the first occurrence, with 1 being the first one. negative values<br>  indicate positions relative to the last one, with -1 being the last one. this<br>  can be useful to learn some data into a stick-table. the function considers<br>  any comma as a delimiter for distinct values. if this is not desired, the<br>  res.fhdr() fetch should be used instead.</p>\n<p>  acl derivatives :<br>    shdr([<name>[,<occ>]])     : exact string match<br>    shdr_beg([<name>[,<occ>]]) : prefix match<br>    shdr_dir([<name>[,<occ>]]) : subdir match<br>    shdr_dom([<name>[,<occ>]]) : domain match<br>    shdr_end([<name>[,<occ>]]) : suffix match<br>    shdr_len([<name>[,<occ>]]) : length match<br>    shdr_reg([<name>[,<occ>]]) : regex match<br>    shdr_sub([<name>[,<occ>]]) : substring match</p>\n<p>res.hdr_cnt([<name>]) : integer<br>shdr_cnt([<name>]) : integer (deprecated)<br>  returns an integer value representing the number of occurrences of response<br>  header field name <name>, or the total number of header fields if <name> is<br>  not specified. the function considers any comma as a delimiter for distinct<br>  values. if this is not desired, the res.fhdr_cnt() fetch should be used<br>  instead.</p>\n<p>res.hdr_ip([<name>[,<occ>]]) : ip<br>shdr_ip([<name>[,<occ>]]) : ip (deprecated)<br>  this extracts the last occurrence of header <name> in an http response,<br>  convert it to an ipv4 or ipv6 address and returns this address. optionally, a<br>  specific occurrence might be specified as a position number. positive values<br>  indicate a position from the first occurrence, with 1 being the first one.<br>  negative values indicate positions relative to the last one, with -1 being<br>  the last one. this can be useful to learn some data into a stick table.</p>\n<p>res.hdr_names([<delim>]) : string<br>  this builds a string made from the concatenation of all header names as they<br>  appear in the response when the rule is evaluated. the default delimiter is<br>  the comma (‘,’) but it may be overridden as an optional argument <delim>. in<br>  this case, only the first character of <delim> is considered.</p>\n<p>res.hdr_val([<name>[,<occ>]]) : integer<br>shdr_val([<name>[,<occ>]]) : integer (deprecated)<br>  this extracts the last occurrence of header <name> in an http response, and<br>  converts it to an integer value. optionally, a specific occurrence might be<br>  specified as a position number. positive values indicate a position from the<br>  first occurrence, with 1 being the first one. negative values indicate<br>  positions relative to the last one, with -1 being the last one. this can be<br>  useful to learn some data into a stick table.</p>\n<p>res.ver : string<br>resp_ver : string (deprecated)<br>  returns the version string from the http response, for example “1.1”. this<br>  can be useful for logs, but is mostly there for acl.</p>\n<p>  acl derivatives :<br>    resp_ver : exact string match</p>\n<p>set-cookie([<name>]) : string (deprecated)<br>  this extracts the last occurrence of the cookie name <name> on a “set-cookie”<br>  header line from the response and uses the corresponding value to match. this<br>  can be comparable to what “appsession” does with default options, but with<br>  support for multi-peer synchronization and state keeping across restarts.</p>\n<p>  this fetch function is deprecated and has been superseded by the “res.cook”<br>  fetch. this keyword will disappear soon.</p>\n<p>  see also : “appsession”</p>\n<p>status : integer<br>  returns an integer containing the http status code in the http response, for<br>  example, 302. it is mostly used within acls and integer ranges, for example,<br>  to remove any location header if the response is not a 3xx.</p>\n<p>url : string<br>  this extracts the request’s url as presented in the request. a typical use is<br>  with prefetch-capable caches, and with portals which need to aggregate<br>  multiple information from databases and keep them in caches. with acls, using<br>  “path” is preferred over using “url”, because clients may send a full url as<br>  is normally done with proxies. the only real use is to match “*” which does<br>  not match in “path”, and for which there is already a predefined acl. see<br>  also “path” and “base”.</p>\n<p>  acl derivatives :<br>    url     : exact string match<br>    url_beg : prefix match<br>    url_dir : subdir match<br>    url_dom : domain match<br>    url_end : suffix match<br>    url_len : length match<br>    url_reg : regex match<br>    url_sub : substring match</p>\n<p>url_ip : ip<br>  this extracts the ip address from the request’s url when the host part is<br>  presented as an ip address. its use is very limited. for instance, a<br>  monitoring system might use this field as an alternative for the source ip in<br>  order to test what path a given source address would follow, or to force an<br>  entry in a table for a given source address. with acls it can be used to<br>  restrict access to certain systems through a proxy, for example when combined<br>  with option “http_proxy”.</p>\n<p>url_port : integer<br>  this extracts the port part from the request’s url. note that if the port is<br>  not specified in the request, port 80 is assumed. with acls it can be used to<br>  restrict access to certain systems through a proxy, for example when combined<br>  with option “http_proxy”.</p>\n<p>urlp([<name>[,<delim>]]) : string<br>url_param([<name>[,<delim>]]) : string<br>  this extracts the first occurrence of the parameter <name> in the query<br>  string, which begins after either ‘?’ or <delim>, and which ends before ‘&amp;’,<br>  ‘;’ or <delim>. the parameter name is case-sensitive. if no name is given,<br>  any parameter will match, and the first one will be returned. the result is<br>  a string corresponding to the value of the parameter <name> as presented in<br>  the request (no url decoding is performed). this can be used for session<br>  stickiness based on a client id, to extract an application cookie passed as a<br>  url parameter, or in acls to apply some checks. note that the acl version of<br>  this fetch iterates over multiple parameters and will iteratively report all<br>  parameters values if no name is given</p>\n<p>  acl derivatives :<br>    urlp(<name>[,<delim>])     : exact string match<br>    urlp_beg(<name>[,<delim>]) : prefix match<br>    urlp_dir(<name>[,<delim>]) : subdir match<br>    urlp_dom(<name>[,<delim>]) : domain match<br>    urlp_end(<name>[,<delim>]) : suffix match<br>    urlp_len(<name>[,<delim>]) : length match<br>    urlp_reg(<name>[,<delim>]) : regex match<br>    urlp_sub(<name>[,<delim>]) : substring match</p>\n<p>  example :</p>\n<pre><code># match http://example.com/foo?phpsessionid=some_id\nstick on urlp(phpsessionid)\n# match http://example.com/foo;jsessionid=some_id\nstick on urlp(jsessionid,;)\n</code></pre><p>urlp_val([<name>[,<delim>])] : integer<br>  see “urlp” above. this one extracts the url parameter <name> in the request<br>  and converts it to an integer value. this can be used for session stickiness<br>  based on a user id for example, or with acls to match a page number or price.</p>\n<h2 id=\"7-4-pre-defined-acls\"><a href=\"#7-4-pre-defined-acls\" class=\"headerlink\" title=\"7.4. pre-defined acls\"></a>7.4. pre-defined acls</h2><p>some predefined acls are hard-coded so that they do not have to be declared in<br>every frontend which needs them. they all have their names in upper case in<br>order to avoid confusion. their equivalence is provided below.</p>\n<p>acl name          equivalent to                usage<br>—————+—————————–+———————————<br>false            always_false                  never match<br>http             req_proto_http                match if protocol is valid http<br>http_1.0         req_ver 1.0                   match http version 1.0<br>http_1.1         req_ver 1.1                   match http version 1.1<br>http_content     hdr_val(content-length) gt 0  match an existing content-length<br>http_url_abs     url_reg ^[^/:]<em>://            match absolute url with scheme<br>http_url_slash   url_beg /                     match url beginning with “/“<br>http_url_star    url     </em>                     match url equal to “*”<br>localhost        src 127.0.0.1/8               match connection from local host<br>meth_connect     method  connect               match http connect method<br>meth_get         method  get head              match http get or head method<br>meth_head        method  head                  match http head method<br>meth_options     method  options               match http options method<br>meth_post        method  post                  match http post method<br>meth_trace       method  trace                 match http trace method<br>rdp_cookie       req_rdp_cookie_cnt gt 0       match presence of an rdp cookie<br>req_content      req_len gt 0                  match data in the request buffer<br>true             always_true                   always match<br>wait_end         wait_end                      wait for end of content analysis<br>—————+—————————–+———————————</p>\n<h2 id=\"8-logging\"><a href=\"#8-logging\" class=\"headerlink\" title=\"8. logging\"></a>8. logging</h2><p>one of haproxy’s strong points certainly lies is its precise logs. it probably<br>provides the finest level of information available for such a product, which is<br>very important for troubleshooting complex environments. standard information<br>provided in logs include client ports, tcp/http state timers, precise session<br>state at termination and precise termination cause, information about decisions<br>to direct traffic to a server, and of course the ability to capture arbitrary<br>headers.</p>\n<p>in order to improve administrators reactivity, it offers a great transparency<br>about encountered problems, both internal and external, and it is possible to<br>send logs to different sources at the same time with different level filters :</p>\n<ul>\n<li>global process-level logs (system errors, start/stop, etc..)</li>\n<li>per-instance system and internal errors (lack of resource, bugs, …)</li>\n<li>per-instance external troubles (servers up/down, max connections)</li>\n<li>per-instance activity (client connections), either at the establishment or<br>at the termination.</li>\n<li>per-request control of log-level, eg:<pre><code>http-request set-log-level silent if sensitive_request\n</code></pre></li>\n</ul>\n<p>the ability to distribute different levels of logs to different log servers<br>allow several production teams to interact and to fix their problems as soon<br>as possible. for example, the system team might monitor system-wide errors,<br>while the application team might be monitoring the up/down for their servers in<br>real time, and the security team might analyze the activity logs with one hour<br>delay.</p>\n<h2 id=\"8-1-log-levels\"><a href=\"#8-1-log-levels\" class=\"headerlink\" title=\"8.1. log levels\"></a>8.1. log levels</h2><p>tcp and http connections can be logged with information such as the date, time,<br>source ip address, destination address, connection duration, response times,<br>http request, http return code, number of bytes transmitted, conditions<br>in which the session ended, and even exchanged cookies values. for example<br>track a particular user’s problems. all messages may be sent to up to two<br>syslog servers. check the “log” keyword in section 4.2 for more information<br>about log facilities.</p>\n<h2 id=\"8-2-log-formats\"><a href=\"#8-2-log-formats\" class=\"headerlink\" title=\"8.2. log formats\"></a>8.2. log formats</h2><p>haproxy supports 5 log formats. several fields are common between these formats<br>and will be detailed in the following sections. a few of them may vary<br>slightly with the configuration, due to indicators specific to certain<br>options. the supported formats are as follows :</p>\n<ul>\n<li><p>the default format, which is very basic and very rarely used. it only<br>provides very basic information about the incoming connection at the moment<br>it is accepted : source ip:port, destination ip:port, and frontend-name.<br>this mode will eventually disappear so it will not be described to great<br>extents.</p>\n</li>\n<li><p>the tcp format, which is more advanced. this format is enabled when “option<br>tcplog” is set on the frontend. haproxy will then usually wait for the<br>connection to terminate before logging. this format provides much richer<br>information, such as timers, connection counts, queue size, etc… this<br>format is recommended for pure tcp proxies.</p>\n</li>\n<li><p>the http format, which is the most advanced for http proxying. this format<br>is enabled when “option httplog” is set on the frontend. it provides the<br>same information as the tcp format with some http-specific fields such as<br>the request, the status code, and captures of headers and cookies. this<br>format is recommended for http proxies.</p>\n</li>\n<li><p>the clf http format, which is equivalent to the http format, but with the<br>fields arranged in the same order as the clf format. in this mode, all<br>timers, captures, flags, etc… appear one per field after the end of the<br>common fields, in the same order they appear in the standard http format.</p>\n</li>\n<li><p>the custom log format, allows you to make your own log line.</p>\n</li>\n</ul>\n<p>next sections will go deeper into details for each of these formats. format<br>specification will be performed on a “field” basis. unless stated otherwise, a<br>field is a portion of text delimited by any number of spaces. since syslog<br>servers are susceptible of inserting fields at the beginning of a line, it is<br>always assumed that the first field is the one containing the process name and<br>identifier.</p>\n<p>note : since log lines may be quite long, the log examples in sections below<br>       might be broken into multiple lines. the example log lines will be<br>       prefixed with 3 closing angle brackets (‘&gt;&gt;&gt;’) and each time a log is<br>       broken into multiple lines, each non-final line will end with a<br>       backslash (‘\\’) and the next line will start indented by two characters.</p>\n<h2 id=\"8-2-1-default-log-format\"><a href=\"#8-2-1-default-log-format\" class=\"headerlink\" title=\"8.2.1. default log format\"></a>8.2.1. default log format</h2><p>this format is used when no specific option is set. the log is emitted as soon<br>as the connection is accepted. one should note that this currently is the only<br>format which logs the request’s destination ip and ports.</p>\n<p>  example :<br>        listen www<br>            mode http<br>            log global<br>            server srv1 127.0.0.1:8000</p>\n<pre><code>&gt;&gt;&gt; feb  6 12:12:09 localhost \\\n      haproxy[14385]: connect from 10.0.1.2:33312 to 10.0.3.31:8012 \\\n      (www/http)\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14385]:<br>      2   ‘connect from’                                          connect from<br>      3   source_ip ‘:’ source_port                             10.0.1.2:33312<br>      4   ‘to’                                                              to<br>      5   destination_ip ‘:’ destination_port                   10.0.3.31:8012<br>      6   ‘(‘ frontend_name ‘/‘ mode ‘)’                            (www/http)</p>\n<p>detailed fields description :</p>\n<ul>\n<li>“source_ip” is the ip address of the client which initiated the connection.</li>\n<li>“source_port” is the tcp port of the client which initiated the connection.</li>\n<li>“destination_ip” is the ip address the client connected to.</li>\n<li>“destination_port” is the tcp port the client connected to.</li>\n<li>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</li>\n<li>“mode is the mode the frontend is operating (tcp or http).</li>\n</ul>\n<p>in case of a unix socket, the source and destination addresses are marked as<br>“unix:” and the ports reflect the internal id of the socket which accepted the<br>connection (the same id as reported in the stats).</p>\n<p>it is advised not to use this deprecated format for newer installations as it<br>will eventually disappear.</p>\n<h2 id=\"8-2-2-tcp-log-format\"><a href=\"#8-2-2-tcp-log-format\" class=\"headerlink\" title=\"8.2.2. tcp log format\"></a>8.2.2. tcp log format</h2><p>the tcp format is used when “option tcplog” is specified in the frontend, and<br>is the recommended format for pure tcp proxies. it provides a lot of precious<br>information for troubleshooting. since this format includes timers and byte<br>counts, the log is normally emitted at the end of the session. it can be<br>emitted earlier if “option logasap” is specified, which makes sense in most<br>environments with long sessions such as remote terminals. sessions which match<br>the “monitor” rules are never logged. it is also possible not to emit logs for<br>sessions for which no data were exchanged between the client and the server, by<br>specifying “option dontlognull” in the frontend. successful connections will<br>not be logged if “option dontlog-normal” is specified in the frontend. a few<br>fields may slightly vary depending on some configuration options, those are<br>marked with a star (‘*’) after the field name below.</p>\n<p>  example :<br>        frontend fnt<br>            mode tcp<br>            option tcplog<br>            log global<br>            default_backend bck</p>\n<pre><code>    backend bck\n        server srv1 127.0.0.1:8000\n\n&gt;&gt;&gt; feb  6 12:12:56 localhost \\\n      haproxy[14387]: 10.0.1.2:33313 [06/feb/2009:12:12:51.443] fnt \\\n      bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14387]:<br>      2   client_ip ‘:’ client_port                             10.0.1.2:33313<br>      3   ‘[‘ accept_date ‘]’                       [06/feb/2009:12:12:51.443]<br>      4   frontend_name                                                    fnt<br>      5   backend_name ‘/‘ server_name                                bck/srv1<br>      6   tw ‘/‘ tc ‘/‘ tt<em>                                           0/0/5007<br>      7   bytes_read</em>                                                      212<br>      8   termination_state                                                 –<br>      9   actconn ‘/‘ feconn ‘/‘ beconn ‘/‘ srv_conn ‘/‘ retries*    0/0/0/0/3<br>     10   srv_queue ‘/‘ backend_queue                                      0/0</p>\n<p>detailed fields description :</p>\n<ul>\n<li><p>“client_ip” is the ip address of the client which initiated the tcp<br>connection to haproxy. if the connection was accepted on a unix socket<br>instead, the ip address would be replaced with the word “unix”. note that<br>when the connection is accepted on a socket configured with “accept-proxy”<br>and the proxy protocol is correctly used, then the logs will reflect the<br>forwarded connection’s information.</p>\n</li>\n<li><p>“client_port” is the tcp port of the client which initiated the connection.<br>if the connection was accepted on a unix socket instead, the port would be<br>replaced with the id of the accepting socket, which is also reported in the<br>stats interface.</p>\n</li>\n<li><p>“accept_date” is the exact date when the connection was received by haproxy<br>(which might be very slightly different from the date observed on the<br>network if there was some queuing in the system’s backlog). this is usually<br>the same date which may appear in any upstream firewall’s log.</p>\n</li>\n<li><p>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</p>\n</li>\n<li><p>“backend_name” is the name of the backend (or listener) which was selected<br>to manage the connection to the server. this will be the same as the<br>frontend if no switching rule has been applied, which is common for tcp<br>applications.</p>\n</li>\n<li><p>“server_name” is the name of the last server to which the connection was<br>sent, which might differ from the first one if there were connection errors<br>and a redispatch occurred. note that this server belongs to the backend<br>which processed the request. if the connection was aborted before reaching<br>a server, “<nosrv>“ is indicated instead of a server name.</p>\n</li>\n<li><p>“tw” is the total time in milliseconds spent waiting in the various queues.<br>it can be “-1” if the connection was aborted before reaching the queue.<br>see “timers” below for more details.</p>\n</li>\n<li><p>“tc” is the total time in milliseconds spent waiting for the connection to<br>establish to the final server, including retries. it can be “-1” if the<br>connection was aborted before a connection could be established. see<br>“timers” below for more details.</p>\n</li>\n<li><p>“tt” is the total time in milliseconds elapsed between the accept and the<br>last close. it covers all possible processing. there is one exception, if<br>“option logasap” was specified, then the time counting stops at the moment<br>the log is emitted. in this case, a ‘+’ sign is prepended before the value,<br>indicating that the final one will be larger. see “timers” below for more<br>details.</p>\n</li>\n<li><p>“bytes_read” is the total number of bytes transmitted from the server to<br>the client when the log is emitted. if “option logasap” is specified, the<br>this value will be prefixed with a ‘+’ sign indicating that the final one<br>may be larger. please note that this value is a 64-bit counter, so log<br>analysis tools must be able to handle it without overflowing.</p>\n</li>\n<li><p>“termination_state” is the condition the session was in when the session<br>ended. this indicates the session state, which side caused the end of<br>session to happen, and for what reason (timeout, error, …). the normal<br>flags should be “–”, indicating the session was closed by either end with<br>no data remaining in buffers. see below “session state at disconnection”<br>for more details.</p>\n</li>\n<li><p>“actconn” is the total number of concurrent connections on the process when<br>the session was logged. it is useful to detect when some per-process system<br>limits have been reached. for instance, if actconn is close to 512 when<br>multiple connection errors occur, chances are high that the system limits<br>the process to use a maximum of 1024 file descriptors and that all of them<br>are used. see section 3 “global parameters” to find how to tune the system.</p>\n</li>\n<li><p>“feconn” is the total number of concurrent connections on the frontend when<br>the session was logged. it is useful to estimate the amount of resource<br>required to sustain high loads, and to detect when the frontend’s “maxconn”<br>has been reached. most often when this value increases by huge jumps, it is<br>because there is congestion on the backend servers, but sometimes it can be<br>caused by a denial of service attack.</p>\n</li>\n<li><p>“beconn” is the total number of concurrent connections handled by the<br>backend when the session was logged. it includes the total number of<br>concurrent connections active on servers as well as the number of<br>connections pending in queues. it is useful to estimate the amount of<br>additional servers needed to support high loads for a given application.<br>most often when this value increases by huge jumps, it is because there is<br>congestion on the backend servers, but sometimes it can be caused by a<br>denial of service attack.</p>\n</li>\n<li><p>“srv_conn” is the total number of concurrent connections still active on<br>the server when the session was logged. it can never exceed the server’s<br>configured “maxconn” parameter. if this value is very often close or equal<br>to the server’s “maxconn”, it means that traffic regulation is involved a<br>lot, meaning that either the server’s maxconn value is too low, or that<br>there aren’t enough servers to process the load with an optimal response<br>time. when only one of the server’s “srv_conn” is high, it usually means<br>that this server has some trouble causing the connections to take longer to<br>be processed than on other servers.</p>\n</li>\n<li><p>“retries” is the number of connection retries experienced by this session<br>when trying to connect to the server. it must normally be zero, unless a<br>server is being stopped at the same moment the connection was attempted.<br>frequent retries generally indicate either a network problem between<br>haproxy and the server, or a misconfigured system backlog on the server<br>preventing new connections from being queued. this field may optionally be<br>prefixed with a ‘+’ sign, indicating that the session has experienced a<br>redispatch after the maximal retry count has been reached on the initial<br>server. in this case, the server name appearing in the log is the one the<br>connection was redispatched to, and not the first one, though both may<br>sometimes be the same in case of hashing for instance. so as a general rule<br>of thumb, when a ‘+’ is present in front of the retry count, this count<br>should not be attributed to the logged server.</p>\n</li>\n<li><p>“srv_queue” is the total number of requests which were processed before<br>this one in the server queue. it is zero when the request has not gone<br>through the server queue. it makes it possible to estimate the approximate<br>server’s response time by dividing the time spent in queue by the number of<br>requests in the queue. it is worth noting that if a session experiences a<br>redispatch and passes through two server queues, their positions will be<br>cumulated. a request should not pass through both the server queue and the<br>backend queue unless a redispatch occurs.</p>\n</li>\n<li><p>“backend_queue” is the total number of requests which were processed before<br>this one in the backend’s global queue. it is zero when the request has not<br>gone through the global queue. it makes it possible to estimate the average<br>queue length, which easily translates into a number of missing servers when<br>divided by a server’s “maxconn” parameter. it is worth noting that if a<br>session experiences a redispatch, it may pass twice in the backend’s queue,<br>and then both positions will be cumulated. a request should not pass<br>through both the server queue and the backend queue unless a redispatch<br>occurs.</p>\n</li>\n</ul>\n<h2 id=\"8-2-3-http-log-format\"><a href=\"#8-2-3-http-log-format\" class=\"headerlink\" title=\"8.2.3. http log format\"></a>8.2.3. http log format</h2><p>the http format is the most complete and the best suited for http proxies. it<br>is enabled by when “option httplog” is specified in the frontend. it provides<br>the same level of information as the tcp format with additional features which<br>are specific to the http protocol. just like the tcp format, the log is usually<br>emitted at the end of the session, unless “option logasap” is specified, which<br>generally only makes sense for download sites. a session which matches the<br>“monitor” rules will never logged. it is also possible not to log sessions for<br>which no data were sent by the client by specifying “option dontlognull” in the<br>frontend. successful connections will not be logged if “option dontlog-normal”<br>is specified in the frontend.</p>\n<p>most fields are shared with the tcp log, some being different. a few fields may<br>slightly vary depending on some configuration options. those ones are marked<br>with a star (‘*’) after the field name below.</p>\n<p>  example :<br>        frontend http-in<br>            mode http<br>            option httplog<br>            log global<br>            default_backend bck</p>\n<pre><code>    backend static\n        server srv1 127.0.0.1:8000\n\n&gt;&gt;&gt; feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/feb/2009:12:14:14.655] http-in \\\n      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n      {} &quot;get /index.html http/1.1&quot;\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                            haproxy[14389]:<br>      2   client_ip ‘:’ client_port                             10.0.1.2:33317<br>      3   ‘[‘ accept_date ‘]’                       [06/feb/2009:12:14:14.655]<br>      4   frontend_name                                                http-in<br>      5   backend_name ‘/‘ server_name                             static/srv1<br>      6   tq ‘/‘ tw ‘/‘ tc ‘/‘ tr ‘/‘ tt<em>                       10/0/30/69/109<br>      7   status_code                                                      200<br>      8   bytes_read</em>                                                     2750<br>      9   captured_request_cookie                                            -<br>     10   captured_response_cookie                                           -<br>     11   termination_state                                               —-<br>     12   actconn ‘/‘ feconn ‘/‘ beconn ‘/‘ srv_conn ‘/‘ retries<em>    1/1/1/1/0<br>     13   srv_queue ‘/‘ backend_queue                                      0/0<br>     14   ‘{‘ captured_request_headers</em> ‘}’                   {haproxy.1wt.eu}<br>     15   ‘{‘ captured_response_headers* ‘}’                                {}<br>     16   ‘“‘ http_request ‘“‘                      “get /index.html http/1.1”</p>\n<p>detailed fields description :</p>\n<ul>\n<li><p>“client_ip” is the ip address of the client which initiated the tcp<br>connection to haproxy. if the connection was accepted on a unix socket<br>instead, the ip address would be replaced with the word “unix”. note that<br>when the connection is accepted on a socket configured with “accept-proxy”<br>and the proxy protocol is correctly used, then the logs will reflect the<br>forwarded connection’s information.</p>\n</li>\n<li><p>“client_port” is the tcp port of the client which initiated the connection.<br>if the connection was accepted on a unix socket instead, the port would be<br>replaced with the id of the accepting socket, which is also reported in the<br>stats interface.</p>\n</li>\n<li><p>“accept_date” is the exact date when the tcp connection was received by<br>haproxy (which might be very slightly different from the date observed on<br>the network if there was some queuing in the system’s backlog). this is<br>usually the same date which may appear in any upstream firewall’s log. this<br>does not depend on the fact that the client has sent the request or not.</p>\n</li>\n<li><p>“frontend_name” is the name of the frontend (or listener) which received<br>and processed the connection.</p>\n</li>\n<li><p>“backend_name” is the name of the backend (or listener) which was selected<br>to manage the connection to the server. this will be the same as the<br>frontend if no switching rule has been applied.</p>\n</li>\n<li><p>“server_name” is the name of the last server to which the connection was<br>sent, which might differ from the first one if there were connection errors<br>and a redispatch occurred. note that this server belongs to the backend<br>which processed the request. if the request was aborted before reaching a<br>server, “<nosrv>“ is indicated instead of a server name. if the request was<br>intercepted by the stats subsystem, “<stats>“ is indicated instead.</p>\n</li>\n<li><p>“tq” is the total time in milliseconds spent waiting for the client to send<br>a full http request, not counting data. it can be “-1” if the connection<br>was aborted before a complete request could be received. it should always<br>be very small because a request generally fits in one single packet. large<br>times here generally indicate network trouble between the client and<br>haproxy. see “timers” below for more details.</p>\n</li>\n<li><p>“tw” is the total time in milliseconds spent waiting in the various queues.<br>it can be “-1” if the connection was aborted before reaching the queue.<br>see “timers” below for more details.</p>\n</li>\n<li><p>“tc” is the total time in milliseconds spent waiting for the connection to<br>establish to the final server, including retries. it can be “-1” if the<br>request was aborted before a connection could be established. see “timers”<br>below for more details.</p>\n</li>\n<li><p>“tr” is the total time in milliseconds spent waiting for the server to send<br>a full http response, not counting data. it can be “-1” if the request was<br>aborted before a complete response could be received. it generally matches<br>the server’s processing time for the request, though it may be altered by<br>the amount of data sent by the client to the server. large times here on<br>“get” requests generally indicate an overloaded server. see “timers” below<br>for more details.</p>\n</li>\n<li><p>“tt” is the total time in milliseconds elapsed between the accept and the<br>last close. it covers all possible processing. there is one exception, if<br>“option logasap” was specified, then the time counting stops at the moment<br>the log is emitted. in this case, a ‘+’ sign is prepended before the value,<br>indicating that the final one will be larger. see “timers” below for more<br>details.</p>\n</li>\n<li><p>“status_code” is the http status code returned to the client. this status<br>is generally set by the server, but it might also be set by haproxy when<br>the server cannot be reached or when its response is blocked by haproxy.</p>\n</li>\n<li><p>“bytes_read” is the total number of bytes transmitted to the client when<br>the log is emitted. this does include http headers. if “option logasap” is<br>specified, the this value will be prefixed with a ‘+’ sign indicating that<br>the final one may be larger. please note that this value is a 64-bit<br>counter, so log analysis tools must be able to handle it without<br>overflowing.</p>\n</li>\n<li><p>“captured_request_cookie” is an optional “name=value” entry indicating that<br>the client had this cookie in the request. the cookie name and its maximum<br>length are defined by the “capture cookie” statement in the frontend<br>configuration. the field is a single dash (‘-‘) when the option is not<br>set. only one cookie may be captured, it is generally used to track session<br>id exchanges between a client and a server to detect session crossing<br>between clients due to application bugs. for more details, please consult<br>the section “capturing http headers and cookies” below.</p>\n</li>\n<li><p>“captured_response_cookie” is an optional “name=value” entry indicating<br>that the server has returned a cookie with its response. the cookie name<br>and its maximum length are defined by the “capture cookie” statement in the<br>frontend configuration. the field is a single dash (‘-‘) when the option is<br>not set. only one cookie may be captured, it is generally used to track<br>session id exchanges between a client and a server to detect session<br>crossing between clients due to application bugs. for more details, please<br>consult the section “capturing http headers and cookies” below.</p>\n</li>\n<li><p>“termination_state” is the condition the session was in when the session<br>ended. this indicates the session state, which side caused the end of<br>session to happen, for what reason (timeout, error, …), just like in tcp<br>logs, and information about persistence operations on cookies in the last<br>two characters. the normal flags should begin with “–”, indicating the<br>session was closed by either end with no data remaining in buffers. see<br>below “session state at disconnection” for more details.</p>\n</li>\n<li><p>“actconn” is the total number of concurrent connections on the process when<br>the session was logged. it is useful to detect when some per-process system<br>limits have been reached. for instance, if actconn is close to 512 or 1024<br>when multiple connection errors occur, chances are high that the system<br>limits the process to use a maximum of 1024 file descriptors and that all<br>of them are used. see section 3 “global parameters” to find how to tune the<br>system.</p>\n</li>\n<li><p>“feconn” is the total number of concurrent connections on the frontend when<br>the session was logged. it is useful to estimate the amount of resource<br>required to sustain high loads, and to detect when the frontend’s “maxconn”<br>has been reached. most often when this value increases by huge jumps, it is<br>because there is congestion on the backend servers, but sometimes it can be<br>caused by a denial of service attack.</p>\n</li>\n<li><p>“beconn” is the total number of concurrent connections handled by the<br>backend when the session was logged. it includes the total number of<br>concurrent connections active on servers as well as the number of<br>connections pending in queues. it is useful to estimate the amount of<br>additional servers needed to support high loads for a given application.<br>most often when this value increases by huge jumps, it is because there is<br>congestion on the backend servers, but sometimes it can be caused by a<br>denial of service attack.</p>\n</li>\n<li><p>“srv_conn” is the total number of concurrent connections still active on<br>the server when the session was logged. it can never exceed the server’s<br>configured “maxconn” parameter. if this value is very often close or equal<br>to the server’s “maxconn”, it means that traffic regulation is involved a<br>lot, meaning that either the server’s maxconn value is too low, or that<br>there aren’t enough servers to process the load with an optimal response<br>time. when only one of the server’s “srv_conn” is high, it usually means<br>that this server has some trouble causing the requests to take longer to be<br>processed than on other servers.</p>\n</li>\n<li><p>“retries” is the number of connection retries experienced by this session<br>when trying to connect to the server. it must normally be zero, unless a<br>server is being stopped at the same moment the connection was attempted.<br>frequent retries generally indicate either a network problem between<br>haproxy and the server, or a misconfigured system backlog on the server<br>preventing new connections from being queued. this field may optionally be<br>prefixed with a ‘+’ sign, indicating that the session has experienced a<br>redispatch after the maximal retry count has been reached on the initial<br>server. in this case, the server name appearing in the log is the one the<br>connection was redispatched to, and not the first one, though both may<br>sometimes be the same in case of hashing for instance. so as a general rule<br>of thumb, when a ‘+’ is present in front of the retry count, this count<br>should not be attributed to the logged server.</p>\n</li>\n<li><p>“srv_queue” is the total number of requests which were processed before<br>this one in the server queue. it is zero when the request has not gone<br>through the server queue. it makes it possible to estimate the approximate<br>server’s response time by dividing the time spent in queue by the number of<br>requests in the queue. it is worth noting that if a session experiences a<br>redispatch and passes through two server queues, their positions will be<br>cumulated. a request should not pass through both the server queue and the<br>backend queue unless a redispatch occurs.</p>\n</li>\n<li><p>“backend_queue” is the total number of requests which were processed before<br>this one in the backend’s global queue. it is zero when the request has not<br>gone through the global queue. it makes it possible to estimate the average<br>queue length, which easily translates into a number of missing servers when<br>divided by a server’s “maxconn” parameter. it is worth noting that if a<br>session experiences a redispatch, it may pass twice in the backend’s queue,<br>and then both positions will be cumulated. a request should not pass<br>through both the server queue and the backend queue unless a redispatch<br>occurs.</p>\n</li>\n<li><p>“captured_request_headers” is a list of headers captured in the request due<br>to the presence of the “capture request header” statement in the frontend.<br>multiple headers can be captured, they will be delimited by a vertical bar<br>(‘|’). when no capture is enabled, the braces do not appear, causing a<br>shift of remaining fields. it is important to note that this field may<br>contain spaces, and that using it requires a smarter log parser than when<br>it’s not used. please consult the section “capturing http headers and<br>cookies” below for more details.</p>\n</li>\n<li><p>“captured_response_headers” is a list of headers captured in the response<br>due to the presence of the “capture response header” statement in the<br>frontend. multiple headers can be captured, they will be delimited by a<br>vertical bar (‘|’). when no capture is enabled, the braces do not appear,<br>causing a shift of remaining fields. it is important to note that this<br>field may contain spaces, and that using it requires a smarter log parser<br>than when it’s not used. please consult the section “capturing http headers<br>and cookies” below for more details.</p>\n</li>\n<li><p>“http_request” is the complete http request line, including the method,<br>request and http version string. non-printable characters are encoded (see<br>below the section “non-printable characters”). this is always the last<br>field, and it is always delimited by quotes and is the only one which can<br>contain quotes. if new fields are added to the log format, they will be<br>added before this field. this field might be truncated if the request is<br>huge and does not fit in the standard syslog buffer (1024 characters). this<br>is the reason why this field must always remain the last one.</p>\n</li>\n</ul>\n<h2 id=\"8-2-4-custom-log-format\"><a href=\"#8-2-4-custom-log-format\" class=\"headerlink\" title=\"8.2.4. custom log format\"></a>8.2.4. custom log format</h2><p>the directive log-format allows you to customize the logs in http mode and tcp<br>mode. it takes a string as argument.</p>\n<p>haproxy understands some log format variables. % precedes log format variables.<br>variables can take arguments using braces (‘{}’), and multiple arguments are<br>separated by commas within the braces. flags may be added or removed by<br>prefixing them with a ‘+’ or ‘-‘ sign.</p>\n<p>special variable “%o” may be used to propagate its flags to all other<br>variables on the same format string. this is particularly handy with quoted<br>string formats (“q”).</p>\n<p>if a variable is named between square brackets (‘[‘ .. ‘]’) then it is used<br>as a sample expression rule (see section 7.3). this it useful to add some<br>less common information such as the client’s ssl certificate’s dn, or to log<br>the key that would be used to store an entry into a stick table.</p>\n<p>note: spaces must be escaped. a space character is considered as a separator.<br>in order to emit a verbatim ‘%’, it must be preceded by another ‘%’ resulting<br>in ‘%%’. haproxy will automatically merge consecutive separators.</p>\n<p>flags are :</p>\n<ul>\n<li>q: quote a string</li>\n<li><p>x: hexadecimal representation (ips, ports, %ts, %rt, %pid)</p>\n<p>example:</p>\n<p>log-format %t\\ %t\\ some\\ text<br>log-format %{+q}o\\ %t\\ %s\\ %{-q}r</p>\n</li>\n</ul>\n<p>at the moment, the default http format is defined this way :</p>\n<pre><code>log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tq/%tw/%tc/%tr/%tt\\ %st\\ %b\\ %cc\\ \\\n           %cs\\ %tsc\\ %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\\ %hr\\ %hs\\ %{+q}r\n</code></pre><p>the default clf format is defined this way :</p>\n<pre><code>log-format %{+q}o\\ %{-q}ci\\ -\\ -\\ [%t]\\ %r\\ %st\\ %b\\ \\&quot;\\&quot;\\ \\&quot;\\&quot;\\ %cp\\ \\\n           %ms\\ %ft\\ %b\\ %s\\ \\%tq\\ %tw\\ %tc\\ %tr\\ %tt\\ %tsc\\ %ac\\ %fc\\ \\\n           %bc\\ %sc\\ %rc\\ %sq\\ %bq\\ %cc\\ %cs\\ \\%hrl\\ %hsl\n</code></pre><p>and the default tcp format is defined this way :</p>\n<pre><code>log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %tw/%tc/%tt\\ %b\\ %ts\\ \\\n           %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\n</code></pre><p>please refer to the table below for currently defined variables :</p>\n<p>  +—+——+———————————————–+————-+<br>  | r | var  | field name (8.2.2 and 8.2.3 for description)  | type        |<br>  +—+——+———————————————–+————-+<br>  |   | %o   | special variable, apply flags on all next var |             |<br>  +—+——+———————————————–+————-+<br>  |   | %b   | bytes_read           (from server to client)  | numeric     |<br>  | h | %cc  | captured_request_cookie                       | string      |<br>  | h | %cs  | captured_response_cookie                      | string      |<br>  |   | %h   | hostname                                      | string      |<br>  | h | %hm  | http method (ex: post)                        | string      |<br>  | h | %hp  | http request uri without query string (path)  | string      |<br>  | h | %hu  | http request uri (ex: /foo?bar=baz)           | string      |<br>  | h | %hv  | http version (ex: http/1.0)                   | string      |<br>  |   | %id  | unique-id                                     | string      |<br>  |   | %st  | status_code                                   | numeric     |<br>  |   | %t   | gmt_date_time                                 | date        |<br>  |   | %tc  | tc                                            | numeric     |<br>  |   | %tl  | local_date_time                               | date        |<br>  | h | %tq  | tq                                            | numeric     |<br>  | h | %tr  | tr                                            | numeric     |<br>  |   | %ts  | timestamp                                     | numeric     |<br>  |   | %tt  | tt                                            | numeric     |<br>  |   | %tw  | tw                                            | numeric     |<br>  |   | %u   | bytes_uploaded       (from client to server)  | numeric     |<br>  |   | %ac  | actconn                                       | numeric     |<br>  |   | %b   | backend_name                                  | string      |<br>  |   | %bc  | beconn      (backend concurrent connections)  | numeric     |<br>  |   | %bi  | backend_source_ip       (connecting address)  | ip          |<br>  |   | %bp  | backend_source_port     (connecting address)  | numeric     |<br>  |   | %bq  | backend_queue                                 | numeric     |<br>  |   | %ci  | client_ip                 (accepted address)  | ip          |<br>  |   | %cp  | client_port               (accepted address)  | numeric     |<br>  |   | %f   | frontend_name                                 | string      |<br>  |   | %fc  | feconn     (frontend concurrent connections)  | numeric     |<br>  |   | %fi  | frontend_ip              (accepting address)  | ip          |<br>  |   | %fp  | frontend_port            (accepting address)  | numeric     |<br>  |   | %ft  | frontend_name_transport (‘~’ suffix for ssl)  | string      |<br>  |   | %lc  | frontend_log_counter                          | numeric     |<br>  |   | %hr  | captured_request_headers default style        | string      |<br>  |   | %hrl | captured_request_headers clf style            | string list |<br>  |   | %hs  | captured_response_headers default style       | string      |<br>  |   | %hsl | captured_response_headers clf style           | string list |<br>  |   | %ms  | accept date milliseconds                      | numeric     |<br>  |   | %pid | pid                                           | numeric     |<br>  | h | %r   | http_request                                  | string      |<br>  |   | %rc  | retries                                       | numeric     |<br>  |   | %rt  | request_counter (http req or tcp session)     | numeric     |<br>  |   | %s   | server_name                                   | string      |<br>  |   | %sc  | srv_conn     (server concurrent connections)  | numeric     |<br>  |   | %si  | server_ip                   (target address)  | ip          |<br>  |   | %sp  | server_port                 (target address)  | numeric     |<br>  |   | %sq  | srv_queue                                     | numeric     |<br>  | s | %sslc| ssl_ciphers (ex: aes-sha)                     | string      |<br>  | s | %sslv| ssl_version (ex: tlsv1)                       | string      |<br>  |   | %t   | date_time      (with millisecond resolution)  | date        |<br>  |   | %ts  | termination_state                             | string      |<br>  | h | %tsc | termination_state with cookie status          | string      |<br>  +—+——+———————————————–+————-+</p>\n<pre><code>r = restrictions : h = mode http only ; s = ssl only\n</code></pre><h2 id=\"8-2-5-error-log-format\"><a href=\"#8-2-5-error-log-format\" class=\"headerlink\" title=\"8.2.5. error log format\"></a>8.2.5. error log format</h2><p>when an incoming connection fails due to an ssl handshake or an invalid proxy<br>protocol header, haproxy will log the event using a shorter, fixed line format.<br>by default, logs are emitted at the log_info level, unless the option<br>“log-separate-errors” is set in the backend, in which case the log_err level<br>will be used. connections on which no data are exchanged (eg: probes) are not<br>logged if the “dontlognull” option is set.</p>\n<p>the format looks like this :</p>\n<pre><code>&gt;&gt;&gt; dec  3 18:27:14 localhost \\\n      haproxy[6103]: 127.0.0.1:56059 [03/dec/2012:17:35:10.380] frt/f1: \\\n      connection error during ssl handshake\n</code></pre><p>  field   format                                extract from the example above<br>      1   process_name ‘[‘ pid ‘]:’                             haproxy[6103]:<br>      2   client_ip ‘:’ client_port                            127.0.0.1:56059<br>      3   ‘[‘ accept_date ‘]’                       [03/dec/2012:17:35:10.380]<br>      4   frontend_name “/“ bind_name “:”                              frt/f1:<br>      5   message                        connection error during ssl handshake</p>\n<p>these fields just provide minimal information to help debugging connection<br>failures.</p>\n<h2 id=\"8-3-advanced-logging-options\"><a href=\"#8-3-advanced-logging-options\" class=\"headerlink\" title=\"8.3. advanced logging options\"></a>8.3. advanced logging options</h2><p>some advanced logging options are often looked for but are not easy to find out<br>just by looking at the various options. here is an entry point for the few<br>options which can enable better logging. please refer to the keywords reference<br>for more information about their usage.</p>\n<h2 id=\"8-3-1-disabling-logging-of-external-tests\"><a href=\"#8-3-1-disabling-logging-of-external-tests\" class=\"headerlink\" title=\"8.3.1. disabling logging of external tests\"></a>8.3.1. disabling logging of external tests</h2><p>it is quite common to have some monitoring tools perform health checks on<br>haproxy. sometimes it will be a layer 3 load-balancer such as lvs or any<br>commercial load-balancer, and sometimes it will simply be a more complete<br>monitoring system such as nagios. when the tests are very frequent, users often<br>ask how to disable logging for those checks. there are three possibilities :</p>\n<ul>\n<li><p>if connections come from everywhere and are just tcp probes, it is often<br>desired to simply disable logging of connections without data exchange, by<br>setting “option dontlognull” in the frontend. it also disables logging of<br>port scans, which may or may not be desired.</p>\n</li>\n<li><p>if the connection come from a known source network, use “monitor-net” to<br>declare this network as monitoring only. any host in this network will then<br>only be able to perform health checks, and their requests will not be<br>logged. this is generally appropriate to designate a list of equipment<br>such as other load-balancers.</p>\n</li>\n<li><p>if the tests are performed on a known uri, use “monitor-uri” to declare<br>this uri as dedicated to monitoring. any host sending this request will<br>only get the result of a health-check, and the request will not be logged.</p>\n</li>\n</ul>\n<h2 id=\"8-3-2-logging-before-waiting-for-the-session-to-terminate\"><a href=\"#8-3-2-logging-before-waiting-for-the-session-to-terminate\" class=\"headerlink\" title=\"8.3.2. logging before waiting for the session to terminate\"></a>8.3.2. logging before waiting for the session to terminate</h2><p>the problem with logging at end of connection is that you have no clue about<br>what is happening during very long sessions, such as remote terminal sessions<br>or large file downloads. this problem can be worked around by specifying<br>“option logasap” in the frontend. haproxy will then log as soon as possible,<br>just before data transfer begins. this means that in case of tcp, it will still<br>log the connection status to the server, and in case of http, it will log just<br>after processing the server headers. in this case, the number of bytes reported<br>is the number of header bytes sent to the client. in order to avoid confusion<br>with normal logs, the total time field and the number of bytes are prefixed<br>with a ‘+’ sign which means that real numbers are certainly larger.</p>\n<h2 id=\"8-3-3-raising-log-level-upon-errors\"><a href=\"#8-3-3-raising-log-level-upon-errors\" class=\"headerlink\" title=\"8.3.3. raising log level upon errors\"></a>8.3.3. raising log level upon errors</h2><p>sometimes it is more convenient to separate normal traffic from errors logs,<br>for instance in order to ease error monitoring from log files. when the option<br>“log-separate-errors” is used, connections which experience errors, timeouts,<br>retries, redispatches or http status codes 5xx will see their syslog level<br>raised from “info” to “err”. this will help a syslog daemon store the log in<br>a separate file. it is very important to keep the errors in the normal traffic<br>file too, so that log ordering is not altered. you should also be careful if<br>you already have configured your syslog daemon to store all logs higher than<br>“notice” in an “admin” file, because the “err” level is higher than “notice”.</p>\n<h2 id=\"8-3-4-disabling-logging-of-successful-connections\"><a href=\"#8-3-4-disabling-logging-of-successful-connections\" class=\"headerlink\" title=\"8.3.4. disabling logging of successful connections\"></a>8.3.4. disabling logging of successful connections</h2><p>although this may sound strange at first, some large sites have to deal with<br>multiple thousands of logs per second and are experiencing difficulties keeping<br>them intact for a long time or detecting errors within them. if the option<br>“dontlog-normal” is set on the frontend, all normal connections will not be<br>logged. in this regard, a normal connection is defined as one without any<br>error, timeout, retry nor redispatch. in http, the status code is checked too,<br>and a response with a status 5xx is not considered normal and will be logged<br>too. of course, doing is is really discouraged as it will remove most of the<br>useful information from the logs. do this only if you have no other<br>alternative.</p>\n<h2 id=\"8-4-timing-events\"><a href=\"#8-4-timing-events\" class=\"headerlink\" title=\"8.4. timing events\"></a>8.4. timing events</h2><p>timers provide a great help in troubleshooting network problems. all values are<br>reported in milliseconds (ms). these timers should be used in conjunction with<br>the session termination flags. in tcp mode with “option tcplog” set on the<br>frontend, 3 control points are reported under the form “tw/tc/tt”, and in http<br>mode, 5 control points are reported under the form “tq/tw/tc/tr/tt” :</p>\n<ul>\n<li><p>tq: total time to get the client request (http mode only). it’s the time<br>elapsed between the moment the client connection was accepted and the<br>moment the proxy received the last http header. the value “-1” indicates<br>that the end of headers (empty line) has never been seen. this happens when<br>the client closes prematurely or times out.</p>\n</li>\n<li><p>tw: total time spent in the queues waiting for a connection slot. it<br>accounts for backend queue as well as the server queues, and depends on the<br>queue size, and the time needed for the server to complete previous<br>requests. the value “-1” means that the request was killed before reaching<br>the queue, which is generally what happens with invalid or denied requests.</p>\n</li>\n<li><p>tc: total time to establish the tcp connection to the server. it’s the time<br>elapsed between the moment the proxy sent the connection request, and the<br>moment it was acknowledged by the server, or between the tcp syn packet and<br>the matching syn/ack packet in return. the value “-1” means that the<br>connection never established.</p>\n</li>\n<li><p>tr: server response time (http mode only). it’s the time elapsed between<br>the moment the tcp connection was established to the server and the moment<br>the server sent its complete response headers. it purely shows its request<br>processing time, without the network overhead due to the data transmission.<br>it is worth noting that when the client has data to send to the server, for<br>instance during a post request, the time already runs, and this can distort<br>apparent response time. for this reason, it’s generally wise not to trust<br>too much this field for post requests initiated from clients behind an<br>untrusted network. a value of “-1” here means that the last the response<br>header (empty line) was never seen, most likely because the server timeout<br>stroke before the server managed to process the request.</p>\n</li>\n<li><p>tt: total session duration time, between the moment the proxy accepted it<br>and the moment both ends were closed. the exception is when the “logasap”<br>option is specified. in this case, it only equals (tq+tw+tc+tr), and is<br>prefixed with a ‘+’ sign. from this field, we can deduce “td”, the data<br>transmission time, by subtracting other timers when valid :</p>\n<pre><code>td = tt - (tq + tw + tc + tr)\n</code></pre><p>timers with “-1” values have to be excluded from this equation. in tcp<br>mode, “tq” and “tr” have to be excluded too. note that “tt” can never be<br>negative.</p>\n</li>\n</ul>\n<p>these timers provide precious indications on trouble causes. since the tcp<br>protocol defines retransmit delays of 3, 6, 12… seconds, we know for sure<br>that timers close to multiples of 3s are nearly always related to lost packets<br>due to network problems (wires, negotiation, congestion). moreover, if “tt” is<br>close to a timeout value specified in the configuration, it often means that a<br>session has been aborted on timeout.</p>\n<p>most common cases :</p>\n<ul>\n<li><p>if “tq” is close to 3000, a packet has probably been lost between the<br>client and the proxy. this is very rare on local networks but might happen<br>when clients are on far remote networks and send large requests. it may<br>happen that values larger than usual appear here without any network cause.<br>sometimes, during an attack or just after a resource starvation has ended,<br>haproxy may accept thousands of connections in a few milliseconds. the time<br>spent accepting these connections will inevitably slightly delay processing<br>of other connections, and it can happen that request times in the order of<br>a few tens of milliseconds are measured after a few thousands of new<br>connections have been accepted at once. setting “option http-server-close”<br>may display larger request times since “tq” also measures the time spent<br>waiting for additional requests.</p>\n</li>\n<li><p>if “tc” is close to 3000, a packet has probably been lost between the<br>server and the proxy during the server connection phase. this value should<br>always be very low, such as 1 ms on local networks and less than a few tens<br>of ms on remote networks.</p>\n</li>\n<li><p>if “tr” is nearly always lower than 3000 except some rare values which seem<br>to be the average majored by 3000, there are probably some packets lost<br>between the proxy and the server.</p>\n</li>\n<li><p>if “tt” is large even for small byte counts, it generally is because<br>neither the client nor the server decides to close the connection, for<br>instance because both have agreed on a keep-alive connection mode. in order<br>to solve this issue, it will be needed to specify “option httpclose” on<br>either the frontend or the backend. if the problem persists, it means that<br>the server ignores the “close” connection mode and expects the client to<br>close. then it will be required to use “option forceclose”. having the<br>smallest possible ‘tt’ is important when connection regulation is used with<br>the “maxconn” option on the servers, since no new connection will be sent<br>to the server until another one is released.</p>\n</li>\n</ul>\n<p>other noticeable http log cases (‘xx’ means any value to be ignored) :</p>\n<p>  tq/tw/tc/tr/+tt  the “option logasap” is present on the frontend and the log<br>                   was emitted before the data phase. all the timers are valid<br>                   except “tt” which is shorter than reality.</p>\n<p>  -1/xx/xx/xx/tt   the client was not able to send a complete request in time<br>                   or it aborted too early. check the session termination flags<br>                   then “timeout http-request” and “timeout client” settings.</p>\n<p>  tq/-1/xx/xx/tt   it was not possible to process the request, maybe because<br>                   servers were out of order, because the request was invalid<br>                   or forbidden by acl rules. check the session termination<br>                   flags.</p>\n<p>  tq/tw/-1/xx/tt   the connection could not establish on the server. either it<br>                   actively refused it or it timed out after tt-(tq+tw) ms.<br>                   check the session termination flags, then check the<br>                   “timeout connect” setting. note that the tarpit action might<br>                   return similar-looking patterns, with “tw” equal to the time<br>                   the client connection was maintained open.</p>\n<p>  tq/tw/tc/-1/tt   the server has accepted the connection but did not return<br>                   a complete response in time, or it closed its connection<br>                   unexpectedly after tt-(tq+tw+tc) ms. check the session<br>                   termination flags, then check the “timeout server” setting.</p>\n<h2 id=\"8-5-session-state-at-disconnection\"><a href=\"#8-5-session-state-at-disconnection\" class=\"headerlink\" title=\"8.5. session state at disconnection\"></a>8.5. session state at disconnection</h2><p>tcp and http logs provide a session termination indicator in the<br>“termination_state” field, just before the number of active connections. it is<br>2-characters long in tcp mode, and is extended to 4 characters in http mode,<br>each of which has a special meaning :</p>\n<ul>\n<li><p>on the first character, a code reporting the first event which caused the<br>session to terminate :</p>\n<pre><code>c : the tcp session was unexpectedly aborted by the client.\n\ns : the tcp session was unexpectedly aborted by the server, or the\n    server explicitly refused it.\n\np : the session was prematurely aborted by the proxy, because of a\n    connection limit enforcement, because a deny filter was matched,\n    because of a security check which detected and blocked a dangerous\n    error in server response which might have caused information leak\n    (eg: cacheable cookie).\n\nl : the session was locally processed by haproxy and was not passed to\n    a server. this is what happens for stats and redirects.\n\nr : a resource on the proxy has been exhausted (memory, sockets, source\n    ports, ...). usually, this appears during the connection phase, and\n    system logs should contain a copy of the precise error. if this\n    happens, it must be considered as a very serious anomaly which\n    should be fixed as soon as possible by any means.\n\ni : an internal error was identified by the proxy during a self-check.\n    this should never happen, and you are encouraged to report any log\n    containing this, because this would almost certainly be a bug. it\n    would be wise to preventively restart the process after such an\n    event too, in case it would be caused by memory corruption.\n\nd : the session was killed by haproxy because the server was detected\n    as down and was configured to kill all connections when going down.\n\nu : the session was killed by haproxy on this backup server because an\n    active server was detected as up and was configured to kill all\n    backup connections when going up.\n\nk : the session was actively killed by an admin operating on haproxy.\n\nc : the client-side timeout expired while waiting for the client to\n    send or receive data.\n\ns : the server-side timeout expired while waiting for the server to\n    send or receive data.\n\n- : normal session completion, both the client and the server closed\n    with nothing left in the buffers.\n</code></pre></li>\n<li><p>on the second character, the tcp or http session state when it was closed :</p>\n<pre><code>r : the proxy was waiting for a complete, valid request from the client\n    (http mode only). nothing was sent to any server.\n\nq : the proxy was waiting in the queue for a connection slot. this can\n    only happen when servers have a &apos;maxconn&apos; parameter set. it can\n    also happen in the global queue after a redispatch consecutive to\n    a failed attempt to connect to a dying server. if no redispatch is\n    reported, then no connection attempt was made to any server.\n\nc : the proxy was waiting for the connection to establish on the\n    server. the server might at most have noticed a connection attempt.\n\nh : the proxy was waiting for complete, valid response headers from the\n    server (http only).\n\nd : the session was in the data phase.\n\nl : the proxy was still transmitting last data to the client while the\n    server had already finished. this one is very rare as it can only\n    happen when the client dies while receiving the last packets.\n\nt : the request was tarpitted. it has been held open with the client\n    during the whole &quot;timeout tarpit&quot; duration or until the client\n    closed, both of which will be reported in the &quot;tw&quot; timer.\n\n- : normal session completion after end of data transfer.\n</code></pre></li>\n<li><p>the third character tells whether the persistence cookie was provided by<br>the client (only in http mode) :</p>\n<pre><code>n : the client provided no cookie. this is usually the case for new\n    visitors, so counting the number of occurrences of this flag in the\n    logs generally indicate a valid trend for the site frequentation.\n\ni : the client provided an invalid cookie matching no known server.\n    this might be caused by a recent configuration change, mixed\n    cookies between http/https sites, persistence conditionally\n    ignored, or an attack.\n\nd : the client provided a cookie designating a server which was down,\n    so either &quot;option persist&quot; was used and the client was sent to\n    this server, or it was not set and the client was redispatched to\n    another server.\n\nv : the client provided a valid cookie, and was sent to the associated\n    server.\n\ne : the client provided a valid cookie, but with a last date which was\n    older than what is allowed by the &quot;maxidle&quot; cookie parameter, so\n    the cookie is consider expired and is ignored. the request will be\n    redispatched just as if there was no cookie.\n\no : the client provided a valid cookie, but with a first date which was\n    older than what is allowed by the &quot;maxlife&quot; cookie parameter, so\n    the cookie is consider too old and is ignored. the request will be\n    redispatched just as if there was no cookie.\n\nu : a cookie was present but was not used to select the server because\n    some other server selection mechanism was used instead (typically a\n    &quot;use-server&quot; rule).\n\n- : does not apply (no cookie set in configuration).\n</code></pre></li>\n<li><p>the last character reports what operations were performed on the persistence<br>cookie returned by the server (only in http mode) :</p>\n<pre><code>n : no cookie was provided by the server, and none was inserted either.\n\ni : no cookie was provided by the server, and the proxy inserted one.\n    note that in &quot;cookie insert&quot; mode, if the server provides a cookie,\n    it will still be overwritten and reported as &quot;i&quot; here.\n\nu : the proxy updated the last date in the cookie that was presented by\n    the client. this can only happen in insert mode with &quot;maxidle&quot;. it\n    happens every time there is activity at a different date than the\n    date indicated in the cookie. if any other change happens, such as\n    a redispatch, then the cookie will be marked as inserted instead.\n\np : a cookie was provided by the server and transmitted as-is.\n\nr : the cookie provided by the server was rewritten by the proxy, which\n    happens in &quot;cookie rewrite&quot; or &quot;cookie prefix&quot; modes.\n\nd : the cookie provided by the server was deleted by the proxy.\n\n- : does not apply (no cookie set in configuration).\n</code></pre></li>\n</ul>\n<p>the combination of the two first flags gives a lot of information about what<br>was happening when the session terminated, and why it did terminate. it can be<br>helpful to detect server saturation, network troubles, local system resource<br>starvation, attacks, etc…</p>\n<p>the most common termination flags combinations are indicated below. they are<br>alphabetically sorted, with the lowercase set just after the upper case for<br>easier finding and understanding.</p>\n<p>  flags   reason</p>\n<pre><code>--   normal termination.\n\ncc   the client aborted before the connection could be established to the\n     server. this can happen when haproxy tries to connect to a recently\n     dead (or unchecked) server, and the client aborts while haproxy is\n     waiting for the server to respond or for &quot;timeout connect&quot; to expire.\n\ncd   the client unexpectedly aborted during data transfer. this can be\n     caused by a browser crash, by an intermediate equipment between the\n     client and haproxy which decided to actively break the connection,\n     by network routing issues between the client and haproxy, or by a\n     keep-alive session between the server and the client terminated first\n     by the client.\n\ncd   the client did not send nor acknowledge any data for as long as the\n     &quot;timeout client&quot; delay. this is often caused by network failures on\n     the client side, or the client simply leaving the net uncleanly.\n\nch   the client aborted while waiting for the server to start responding.\n     it might be the server taking too long to respond or the client\n     clicking the &apos;stop&apos; button too fast.\n\nch   the &quot;timeout client&quot; stroke while waiting for client data during a\n     post request. this is sometimes caused by too large tcp mss values\n     for pppoe networks which cannot transport full-sized packets. it can\n     also happen when client timeout is smaller than server timeout and\n     the server takes too long to respond.\n\ncq   the client aborted while its session was queued, waiting for a server\n     with enough empty slots to accept it. it might be that either all the\n     servers were saturated or that the assigned server was taking too\n     long a time to respond.\n\ncr   the client aborted before sending a full http request. most likely\n     the request was typed by hand using a telnet client, and aborted\n     too early. the http status code is likely a 400 here. sometimes this\n     might also be caused by an ids killing the connection between haproxy\n     and the client. &quot;option http-ignore-probes&quot; can be used to ignore\n     connections without any data transfer.\n\ncr   the &quot;timeout http-request&quot; stroke before the client sent a full http\n     request. this is sometimes caused by too large tcp mss values on the\n     client side for pppoe networks which cannot transport full-sized\n     packets, or by clients sending requests by hand and not typing fast\n     enough, or forgetting to enter the empty line at the end of the\n     request. the http status code is likely a 408 here. note: recently,\n     some browsers started to implement a &quot;pre-connect&quot; feature consisting\n     in speculatively connecting to some recently visited web sites just\n     in case the user would like to visit them. this results in many\n     connections being established to web sites, which end up in 408\n     request timeout if the timeout strikes first, or 400 bad request when\n     the browser decides to close them first. these ones pollute the log\n     and feed the error counters. some versions of some browsers have even\n     been reported to display the error code. it is possible to work\n     around the undesirable effects of this behaviour by adding &quot;option\n     http-ignore-probes&quot; in the frontend, resulting in connections with\n     zero data transfer to be totally ignored. this will definitely hide\n     the errors of people experiencing connectivity issues though.\n\nct   the client aborted while its session was tarpitted. it is important to\n     check if this happens on valid requests, in order to be sure that no\n     wrong tarpit rules have been written. if a lot of them happen, it\n     might make sense to lower the &quot;timeout tarpit&quot; value to something\n     closer to the average reported &quot;tw&quot; timer, in order not to consume\n     resources for just a few attackers.\n\nlr   the request was intercepted and locally handled by haproxy. generally\n     it means that this was a redirect or a stats request.\n\nsc   the server or an equipment between it and haproxy explicitly refused\n     the tcp connection (the proxy received a tcp rst or an icmp message\n     in return). under some circumstances, it can also be the network\n     stack telling the proxy that the server is unreachable (eg: no route,\n     or no arp response on local network). when this happens in http mode,\n     the status code is likely a 502 or 503 here.\n\nsc   the &quot;timeout connect&quot; stroke before a connection to the server could\n     complete. when this happens in http mode, the status code is likely a\n     503 or 504 here.\n\nsd   the connection to the server died with an error during the data\n     transfer. this usually means that haproxy has received an rst from\n     the server or an icmp message from an intermediate equipment while\n     exchanging data with the server. this can be caused by a server crash\n     or by a network issue on an intermediate equipment.\n\nsd   the server did not send nor acknowledge any data for as long as the\n     &quot;timeout server&quot; setting during the data phase. this is often caused\n     by too short timeouts on l4 equipments before the server (firewalls,\n     load-balancers, ...), as well as keep-alive sessions maintained\n     between the client and the server expiring first on haproxy.\n\nsh   the server aborted before sending its full http response headers, or\n     it crashed while processing the request. since a server aborting at\n     this moment is very rare, it would be wise to inspect its logs to\n     control whether it crashed and why. the logged request may indicate a\n     small set of faulty requests, demonstrating bugs in the application.\n     sometimes this might also be caused by an ids killing the connection\n     between haproxy and the server.\n\nsh   the &quot;timeout server&quot; stroke before the server could return its\n     response headers. this is the most common anomaly, indicating too\n     long transactions, probably caused by server or database saturation.\n     the immediate workaround consists in increasing the &quot;timeout server&quot;\n     setting, but it is important to keep in mind that the user experience\n     will suffer from these long response times. the only long term\n     solution is to fix the application.\n\nsq   the session spent too much time in queue and has been expired. see\n     the &quot;timeout queue&quot; and &quot;timeout connect&quot; settings to find out how to\n     fix this if it happens too often. if it often happens massively in\n     short periods, it may indicate general problems on the affected\n     servers due to i/o or database congestion, or saturation caused by\n     external attacks.\n\npc   the proxy refused to establish a connection to the server because the\n     process&apos; socket limit has been reached while attempting to connect.\n     the global &quot;maxconn&quot; parameter may be increased in the configuration\n     so that it does not happen anymore. this status is very rare and\n     might happen when the global &quot;ulimit-n&quot; parameter is forced by hand.\n\npd   the proxy blocked an incorrectly formatted chunked encoded message in\n     a request or a response, after the server has emitted its headers. in\n     most cases, this will indicate an invalid message from the server to\n     the client. haproxy supports chunk sizes of up to 2gb - 1 (2147483647\n     bytes). any larger size will be considered as an error.\n\nph   the proxy blocked the server&apos;s response, because it was invalid,\n     incomplete, dangerous (cache control), or matched a security filter.\n     in any case, an http 502 error is sent to the client. one possible\n     cause for this error is an invalid syntax in an http header name\n     containing unauthorized characters. it is also possible but quite\n     rare, that the proxy blocked a chunked-encoding request from the\n     client due to an invalid syntax, before the server responded. in this\n     case, an http 400 error is sent to the client and reported in the\n     logs.\n\npr   the proxy blocked the client&apos;s http request, either because of an\n     invalid http syntax, in which case it returned an http 400 error to\n     the client, or because a deny filter matched, in which case it\n     returned an http 403 error.\n\npt   the proxy blocked the client&apos;s request and has tarpitted its\n     connection before returning it a 500 server error. nothing was sent\n     to the server. the connection was maintained open for as long as\n     reported by the &quot;tw&quot; timer field.\n\nrc   a local resource has been exhausted (memory, sockets, source ports)\n     preventing the connection to the server from establishing. the error\n     logs will tell precisely what was missing. this is very rare and can\n     only be solved by proper system tuning.\n</code></pre><p>the combination of the two last flags gives a lot of information about how<br>persistence was handled by the client, the server and by haproxy. this is very<br>important to troubleshoot disconnections, when users complain they have to<br>re-authenticate. the commonly encountered flags are :</p>\n<pre><code>--   persistence cookie is not enabled.\n\nnn   no cookie was provided by the client, none was inserted in the\n     response. for instance, this can be in insert mode with &quot;postonly&quot;\n     set on a get request.\n\nii   a cookie designating an invalid server was provided by the client,\n     a valid one was inserted in the response. this typically happens when\n     a &quot;server&quot; entry is removed from the configuration, since its cookie\n     value can be presented by a client when no other server knows it.\n\nni   no cookie was provided by the client, one was inserted in the\n     response. this typically happens for first requests from every user\n     in &quot;insert&quot; mode, which makes it an easy way to count real users.\n\nvn   a cookie was provided by the client, none was inserted in the\n     response. this happens for most responses for which the client has\n     already got a cookie.\n\nvu   a cookie was provided by the client, with a last visit date which is\n     not completely up-to-date, so an updated cookie was provided in\n     response. this can also happen if there was no date at all, or if\n     there was a date but the &quot;maxidle&quot; parameter was not set, so that the\n     cookie can be switched to unlimited time.\n\nei   a cookie was provided by the client, with a last visit date which is\n     too old for the &quot;maxidle&quot; parameter, so the cookie was ignored and a\n     new cookie was inserted in the response.\n\noi   a cookie was provided by the client, with a first visit date which is\n     too old for the &quot;maxlife&quot; parameter, so the cookie was ignored and a\n     new cookie was inserted in the response.\n\ndi   the server designated by the cookie was down, a new server was\n     selected and a new cookie was emitted in the response.\n\nvi   the server designated by the cookie was not marked dead but could not\n     be reached. a redispatch happened and selected another one, which was\n     then advertised in the response.\n</code></pre><h2 id=\"8-6-non-printable-characters\"><a href=\"#8-6-non-printable-characters\" class=\"headerlink\" title=\"8.6. non-printable characters\"></a>8.6. non-printable characters</h2><p>in order not to cause trouble to log analysis tools or terminals during log<br>consulting, non-printable characters are not sent as-is into log files, but are<br>converted to the two-digits hexadecimal representation of their ascii code,<br>prefixed by the character ‘#’. the only characters that can be logged without<br>being escaped are comprised between 32 and 126 (inclusive). obviously, the<br>escape character ‘#’ itself is also encoded to avoid any ambiguity (“#23”). it<br>is the same for the character ‘“‘ which becomes “#22”, as well as ‘{‘, ‘|’ and<br>‘}’ when logging headers.</p>\n<p>note that the space character (‘ ‘) is not encoded in headers, which can cause<br>issues for tools relying on space count to locate fields. a typical header<br>containing spaces is “user-agent”.</p>\n<p>last, it has been observed that some syslog daemons such as syslog-ng escape<br>the quote (‘“‘) with a backslash (‘\\’). the reverse operation can safely be<br>performed since no quote may appear anywhere else in the logs.</p>\n<h2 id=\"8-7-capturing-http-cookies\"><a href=\"#8-7-capturing-http-cookies\" class=\"headerlink\" title=\"8.7. capturing http cookies\"></a>8.7. capturing http cookies</h2><p>cookie capture simplifies the tracking a complete user session. this can be<br>achieved using the “capture cookie” statement in the frontend. please refer to<br>section 4.2 for more details. only one cookie can be captured, and the same<br>cookie will simultaneously be checked in the request (“cookie:” header) and in<br>the response (“set-cookie:” header). the respective values will be reported in<br>the http logs at the “captured_request_cookie” and “captured_response_cookie”<br>locations (see section 8.2.3 about http log format). when either cookie is<br>not seen, a dash (‘-‘) replaces the value. this way, it’s easy to detect when a<br>user switches to a new session for example, because the server will reassign it<br>a new cookie. it is also possible to detect if a server unexpectedly sets a<br>wrong cookie to a client, leading to session crossing.</p>\n<p>  examples :</p>\n<pre><code># capture the first cookie whose name starts with &quot;aspsession&quot;\ncapture cookie aspsession len 32\n\n# capture the first cookie whose name is exactly &quot;vgnvisitor&quot;\ncapture cookie vgnvisitor= len 32\n</code></pre><h2 id=\"8-8-capturing-http-headers\"><a href=\"#8-8-capturing-http-headers\" class=\"headerlink\" title=\"8.8. capturing http headers\"></a>8.8. capturing http headers</h2><p>header captures are useful to track unique request identifiers set by an upper<br>proxy, virtual host names, user-agents, post content-length, referrers, etc. in<br>the response, one can search for information about the response length, how the<br>server asked the cache to behave, or an object location during a redirection.</p>\n<p>header captures are performed using the “capture request header” and “capture<br>response header” statements in the frontend. please consult their definition in<br>section 4.2 for more details.</p>\n<p>it is possible to include both request headers and response headers at the same<br>time. non-existent headers are logged as empty strings, and if one header<br>appears more than once, only its last occurrence will be logged. request headers<br>are grouped within braces ‘{‘ and ‘}’ in the same order as they were declared,<br>and delimited with a vertical bar ‘|’ without any space. response headers<br>follow the same representation, but are displayed after a space following the<br>request headers block. these blocks are displayed just before the http request<br>in the logs.</p>\n<p>as a special case, it is possible to specify an http header capture in a tcp<br>frontend. the purpose is to enable logging of headers which will be parsed in<br>an http backend if the request is then switched to this http backend.</p>\n<p>  example :</p>\n<pre><code>    # this instance chains to the outgoing proxy\n    listen proxy-out\n        mode http\n        option httplog\n        option logasap\n        log global\n        server cache1 192.168.1.1:3128\n\n        # log the name of the virtual server\n        capture request  header host len 20\n\n        # log the amount of data uploaded during a post\n        capture request  header content-length len 10\n\n        # log the beginning of the referrer\n        capture request  header referer len 20\n\n        # server name (useful for outgoing proxies only)\n        capture response header server len 20\n\n        # logging the content-length is useful with &quot;option logasap&quot;\n        capture response header content-length len 10\n\n        # log the expected cache behaviour on the response\n        capture response header cache-control len 8\n\n        # the via header will report the next proxy&apos;s name\n        capture response header via len 20\n\n        # log the url location during a redirection\n        capture response header location len 20\n\n&gt;&gt;&gt; aug  9 20:26:09 localhost \\\n      haproxy[2022]: 127.0.0.1:34014 [09/aug/2004:20:26:09] proxy-out \\\n      proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \\\n      {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \\\n      &quot;get http://fr.adserver.yahoo.com/&quot;\n\n&gt;&gt;&gt; aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34020 [09/aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \\\n      {w.ods.org||} {formilux/0.1.8|3495|||} \\\n      &quot;get http://trafic.1wt.eu/ http/1.1&quot;\n\n&gt;&gt;&gt; aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34028 [09/aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \\\n      {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \\\n      {apache|230|||http://www.sytadin.} \\\n      &quot;get http://www.sytadin.equipement.gouv.fr/ http/1.1&quot;\n</code></pre><h2 id=\"8-9-examples-of-logs\"><a href=\"#8-9-examples-of-logs\" class=\"headerlink\" title=\"8.9. examples of logs\"></a>8.9. examples of logs</h2><p>these are real-world examples of logs accompanied with an explanation. some of<br>them have been made up by hand. the syslog part has been removed for better<br>reading. their sole purpose is to explain how to decipher them.</p>\n<pre><code>&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33318 [15/oct/2003:08:31:57.130] px-http \\\n      px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \\\n      &quot;head / http/1.0&quot;\n\n=&gt; long request (6.5s) entered by hand through &apos;telnet&apos;. the server replied\n   in 147 ms, and the session ended normally (&apos;----&apos;)\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33319 [15/oct/2003:08:31:57.149] px-http \\\n      px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \\\n      0/9 &quot;head / http/1.0&quot;\n\n=&gt; idem, but the request was queued in the global queue behind 9 other\n   requests, and waited there for 1230 ms.\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.654] px-http \\\n      px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \\\n      &quot;get /image.iso http/1.0&quot;\n\n=&gt; request for a long data transfer. the &quot;logasap&quot; option was specified, so\n   the log was produced just before transferring data. the server replied in\n   14 ms, 243 bytes of headers were sent to the client, and total time from\n   accept to first data byte is 30 ms.\n\n&gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/oct/2003:08:32:17.925] px-http \\\n      px-http/srv1 9/0/7/14/30 502 243 - - ph-- 3/2/2/0/0 0/0 \\\n      &quot;get /cgi-bin/bug.cgi? http/1.0&quot;\n\n=&gt; the proxy blocked a server response either because of an &quot;rspdeny&quot; or\n   &quot;rspideny&quot; filter, or because the response was improperly formatted and\n   not http-compliant, or because it blocked sensitive information which\n   risked being cached. in this case, the response is replaced with a &quot;502\n   bad gateway&quot;. the flags (&quot;ph--&quot;) tell us that it was haproxy who decided\n   to return the 502 and not the server.\n\n&gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34548 [15/oct/2003:15:18:55.798] px-http \\\n      px-http/&lt;nosrv&gt; -1/-1/-1/-1/8490 -1 0 - - cr-- 2/2/2/0/0 0/0 &quot;&quot;\n\n=&gt; the client never completed its request and aborted itself (&quot;c---&quot;) after\n   8.5s, while the proxy was waiting for the request headers (&quot;-r--&quot;).\n   nothing was sent to any server.\n\n&gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34549 [15/oct/2003:15:19:06.103] px-http \\\n     px-http/&lt;nosrv&gt; -1/-1/-1/-1/50001 408 0 - - cr-- 2/2/2/0/0 0/0 &quot;&quot;\n\n=&gt; the client never completed its request, which was aborted by the\n   time-out (&quot;c---&quot;) after 50s, while the proxy was waiting for the request\n   headers (&quot;-r--&quot;).  nothing was sent to any server, but the proxy could\n   send a 408 return code to the client.\n\n&gt;&gt;&gt; haproxy[18989]: 127.0.0.1:34550 [15/oct/2003:15:24:28.312] px-tcp \\\n      px-tcp/srv1 0/0/5007 0 cd 0/0/0/0/0 0/0\n\n=&gt; this log was produced with &quot;option tcplog&quot;. the client timed out after\n   5 seconds (&quot;c----&quot;).\n\n&gt;&gt;&gt; haproxy[18989]: 10.0.0.1:34552 [15/oct/2003:15:26:31.462] px-http \\\n      px-http/srv1 3183/-1/-1/-1/11215 503 0 - - sc-- 205/202/202/115/3 \\\n      0/0 &quot;head / http/1.0&quot;\n\n=&gt; the request took 3s to complete (probably a network problem), and the\n   connection to the server failed (&apos;sc--&apos;) after 4 attempts of 2 seconds\n   (config says &apos;retries 3&apos;), and no redispatch (otherwise we would have\n   seen &quot;/+3&quot;). status code 503 was returned to the client. there were 115\n   connections on this server, 202 connections on this proxy, and 205 on\n   the global process. it is possible that the server refused the\n   connection because of too many already established.\n</code></pre><h2 id=\"9-statistics-and-monitoring\"><a href=\"#9-statistics-and-monitoring\" class=\"headerlink\" title=\"9. statistics and monitoring\"></a>9. statistics and monitoring</h2><p>it is possible to query haproxy about its status. the most commonly used<br>mechanism is the http statistics page. this page also exposes an alternative<br>csv output format for monitoring tools. the same format is provided on the<br>unix socket.</p>\n<h2 id=\"9-1-csv-format\"><a href=\"#9-1-csv-format\" class=\"headerlink\" title=\"9.1. csv format\"></a>9.1. csv format</h2><p>the statistics may be consulted either from the unix socket or from the http<br>page. both means provide a csv format whose fields follow. the first line<br>begins with a sharp (‘#’) and has one word per comma-delimited field which<br>represents the title of the column. all other lines starting at the second one<br>use a classical csv format using a comma as the delimiter, and the double quote<br>(‘“‘) as an optional text delimiter, but only if the enclosed text is ambiguous<br>(if it contains a quote or a comma). the double-quote character (‘“‘) in the<br>text is doubled (‘“”‘), which is the format that most tools recognize. please<br>do not insert any column before these ones in order not to break tools which<br>use hard-coded column positions.</p>\n<p>in brackets after each field name are the types which may have a value for<br>that field. the types are l (listeners), f (frontends), b (backends), and<br>s (servers).</p>\n<p>  0. pxname [lfbs]: proxy name<br>  1. svname [lfbs]: service name (frontend for frontend, backend for backend,<br>     any name for server/listener)<br>  2. qcur [..bs]: current queued requests. for the backend this reports the<br>     number queued without a server assigned.<br>  3. qmax [..bs]: max value of qcur<br>  4. scur [lfbs]: current sessions<br>  5. smax [lfbs]: max sessions<br>  6. slim [lfbs]: configured session limit<br>  7. stot [lfbs]: cumulative number of connections<br>  8. bin [lfbs]: bytes in<br>  9. bout [lfbs]: bytes out<br> 10. dreq [lfb.]: requests denied because of security concerns.</p>\n<pre><code>- for tcp this is because of a matched tcp-request content rule.\n- for http this is because of a matched http-request or tarpit rule.\n</code></pre><p> 11. dresp [lfbs]: responses denied because of security concerns.</p>\n<pre><code>- for http this is because of a matched http-request rule, or\n  &quot;option checkcache&quot;.\n</code></pre><p> 12. ereq [lf..]: request errors. some of the possible causes are:</p>\n<pre><code>- early termination from the client, before the request has been sent.\n- read error from the client\n- client timeout\n- client closed connection\n- various bad requests from the client.\n- request was tarpitted.\n</code></pre><p> 13. econ [..bs]: number of requests that encountered an error trying to<br>     connect to a backend server. the backend stat is the sum of the stat<br>     for all servers of that backend, plus any connection errors not<br>     associated with a particular server (such as the backend having no<br>     active servers).<br> 14. eresp [..bs]: response errors. srv_abrt will be counted here also.<br>     some other errors are:</p>\n<pre><code>- write error on the client socket (won&apos;t be counted for the server stat)\n- failure applying filters to the response.\n</code></pre><p> 15. wretr [..bs]: number of times a connection to a server was retried.<br> 16. wredis [..bs]: number of times a request was redispatched to another<br>     server. the server value counts the number of times that server was<br>     switched away from.<br> 17. status [lfbs]: status (up/down/nolb/maint/maint(via)…)<br> 18. weight [..bs]: total weight (backend), server weight (server)<br> 19. act [..bs]: number of active servers (backend), server is active (server)<br> 20. bck [..bs]: number of backup servers (backend), server is backup (server)<br> 21. chkfail […s]: number of failed checks. (only counts checks failed when<br>     the server is up.)<br> 22. chkdown [..bs]: number of up-&gt;down transitions. the backend counter counts<br>     transitions to the whole backend being down, rather than the sum of the<br>     counters for each server.<br> 23. lastchg [..bs]: number of seconds since the last up&lt;-&gt;down transition<br> 24. downtime [..bs]: total downtime (in seconds). the value for the backend<br>     is the downtime for the whole backend, not the sum of the server downtime.<br> 25. qlimit […s]: configured maxqueue for the server, or nothing in the<br>     value is 0 (default, meaning no limit)<br> 26. pid [lfbs]: process id (0 for first instance, 1 for second, …)<br> 27. iid [lfbs]: unique proxy id<br> 28. sid [l..s]: server id (unique inside a proxy)<br> 29. throttle […s]: current throttle percentage for the server, when<br>     slowstart is active, or no value if not in slowstart.<br> 30. lbtot [..bs]: total number of times a server was selected, either for new<br>     sessions, or when re-dispatching. the server counter is the number<br>     of times that server was selected.<br> 31. tracked […s]: id of proxy/server if tracking is enabled.<br> 32. type [lfbs]: (0=frontend, 1=backend, 2=server, 3=socket/listener)<br> 33. rate [.fbs]: number of sessions per second over last elapsed second<br> 34. rate_lim [.f..]: configured limit on new sessions per second<br> 35. rate_max [.fbs]: max number of new sessions per second<br> 36. check_status […s]: status of last health check, one of:<br>        unk     -&gt; unknown<br>        ini     -&gt; initializing<br>        sockerr -&gt; socket error<br>        l4ok    -&gt; check passed on layer 4, no upper layers testing enabled<br>        l4tout  -&gt; layer 1-4 timeout<br>        l4con   -&gt; layer 1-4 connection problem, for example<br>                   “connection refused” (tcp rst) or “no route to host” (icmp)<br>        l6ok    -&gt; check passed on layer 6<br>        l6tout  -&gt; layer 6 (ssl) timeout<br>        l6rsp   -&gt; layer 6 invalid response - protocol error<br>        l7ok    -&gt; check passed on layer 7<br>        l7okc   -&gt; check conditionally passed on layer 7, for example 404 with<br>                   disable-on-404<br>        l7tout  -&gt; layer 7 (http/smtp) timeout<br>        l7rsp   -&gt; layer 7 invalid response - protocol error<br>        l7sts   -&gt; layer 7 response error, for example http 5xx<br> 37. check_code […s]: layer5-7 code, if available<br> 38. check_duration […s]: time in ms took to finish last health check<br> 39. hrsp_1xx [.fbs]: http responses with 1xx code<br> 40. hrsp_2xx [.fbs]: http responses with 2xx code<br> 41. hrsp_3xx [.fbs]: http responses with 3xx code<br> 42. hrsp_4xx [.fbs]: http responses with 4xx code<br> 43. hrsp_5xx [.fbs]: http responses with 5xx code<br> 44. hrsp_other [.fbs]: http responses with other codes (protocol error)<br> 45. hanafail […s]: failed health checks details<br> 46. req_rate [.f..]: http requests per second over last elapsed second<br> 47. req_rate_max [.f..]: max number of http requests per second observed<br> 48. req_tot [.f..]: total number of http requests received<br> 49. cli_abrt [..bs]: number of data transfers aborted by the client<br> 50. srv_abrt [..bs]: number of data transfers aborted by the server<br>     (inc. in eresp)<br> 51. comp_in [.fb.]: number of http response bytes fed to the compressor<br> 52. comp_out [.fb.]: number of http response bytes emitted by the compressor<br> 53. comp_byp [.fb.]: number of bytes that bypassed the http compressor<br>     (cpu/bw limit)<br> 54. comp_rsp [.fb.]: number of http responses that were compressed<br> 55. lastsess [..bs]: number of seconds since last session assigned to<br>     server/backend<br> 56. last_chk […s]: last health check contents or textual error<br> 57. last_agt […s]: last agent check contents or textual error<br> 58. qtime [..bs]: the average queue time in ms over the 1024 last requests<br> 59. ctime [..bs]: the average connect time in ms over the 1024 last requests<br> 60. rtime [..bs]: the average response time in ms over the 1024 last requests<br>     (0 for tcp)<br> 61. ttime [..bs]: the average total session time in ms over the 1024 last<br>     requests</p>\n<h2 id=\"9-2-unix-socket-commands\"><a href=\"#9-2-unix-socket-commands\" class=\"headerlink\" title=\"9.2. unix socket commands\"></a>9.2. unix socket commands</h2><p>the stats socket is not enabled by default. in order to enable it, it is<br>necessary to add one line in the global section of the haproxy configuration.<br>a second line is recommended to set a larger timeout, always appreciated when<br>issuing commands by hand :</p>\n<pre><code>global\n    stats socket /var/run/haproxy.sock mode 600 level admin\n    stats timeout 2m\n</code></pre><p>it is also possible to add multiple instances of the stats socket by repeating<br>the line, and make them listen to a tcp port instead of a unix socket. this is<br>never done by default because this is dangerous, but can be handy in some<br>situations :</p>\n<pre><code>global\n    stats socket /var/run/haproxy.sock mode 600 level admin\n    stats socket ipv4@192.168.0.1:9999 level admin\n    stats timeout 2m\n</code></pre><p>to access the socket, an external utility such as “socat” is required. socat is a<br>swiss-army knife to connect anything to anything. we use it to connect terminals<br>to the socket, or a couple of stdin/stdout pipes to it for scripts. the two main<br>syntaxes we’ll use are the following :</p>\n<pre><code># socat /var/run/haproxy.sock stdio\n# socat /var/run/haproxy.sock readline\n</code></pre><p>the first one is used with scripts. it is possible to send the output of a<br>script to haproxy, and pass haproxy’s output to another script. that’s useful<br>for retrieving counters or attack traces for example.</p>\n<p>the second one is only useful for issuing commands by hand. it has the benefit<br>that the terminal is handled by the readline library which supports line<br>editing and history, which is very convenient when issuing repeated commands<br>(eg: watch a counter).</p>\n<p>the socket supports two operation modes :</p>\n<ul>\n<li>interactive</li>\n<li>non-interactive</li>\n</ul>\n<p>the non-interactive mode is the default when socat connects to the socket. in<br>this mode, a single line may be sent. it is processed as a whole, responses are<br>sent back, and the connection closes after the end of the response. this is the<br>mode that scripts and monitoring tools use. it is possible to send multiple<br>commands in this mode, they need to be delimited by a semi-colon (‘;’). for<br>example :</p>\n<pre><code># echo &quot;show info;show stat;show table&quot; | socat /var/run/haproxy stdio\n</code></pre><p>the interactive mode displays a prompt (‘&gt;’) and waits for commands to be<br>entered on the line, then processes them, and displays the prompt again to wait<br>for a new command. this mode is entered via the “prompt” command which must be<br>sent on the first line in non-interactive mode. the mode is a flip switch, if<br>“prompt” is sent in interactive mode, it is disabled and the connection closes<br>after processing the last command of the same line.</p>\n<p>for this reason, when debugging by hand, it’s quite common to start with the<br>“prompt” command :</p>\n<h1 id=\"socat-var-run-haproxy-readline\"><a href=\"#socat-var-run-haproxy-readline\" class=\"headerlink\" title=\"socat /var/run/haproxy readline\"></a>socat /var/run/haproxy readline</h1><p>   prompt</p>\n<blockquote>\n<p>show info<br>   …</p>\n</blockquote>\n<p>since multiple commands may be issued at once, haproxy uses the empty line as a<br>delimiter to mark an end of output for each command, and takes care of ensuring<br>that no command can emit an empty line on output. a script can thus easily<br>parse the output even when multiple commands were pipelined on a single line.</p>\n<p>it is important to understand that when multiple haproxy processes are started<br>on the same sockets, any process may pick up the request and will output its<br>own stats.</p>\n<p>the list of commands currently supported on the stats socket is provided below.<br>if an unknown command is sent, haproxy displays the usage message which reminds<br>all supported commands. some commands support a more complex syntax, generally<br>it will explain what part of the command is invalid when this happens.</p>\n<p>add acl <acl> <pattern><br>  add an entry into the acl <acl>. <acl> is the #<id> or the <file> returned by<br>  “show acl”. this command does not verify if the entry already exists. this<br>  command cannot be used if the reference <acl> is a file also used with a map.<br>  in this case, you must use the command “add map” in place of “add acl”.</p>\n<p>add map <map> <key> <value><br>  add an entry into the map <map> to associate the value <value> to the key<br>  <key>. this command does not verify if the entry already exists. it is<br>  mainly used to fill a map after a clear operation. note that if the reference<br>  <map> is a file and is shared with a map, this map will contain also a new<br>  pattern entry.</p>\n<p>clear counters<br>  clear the max values of the statistics counters in each proxy (frontend &amp;<br>  backend) and in each server. the cumulated counters are not affected. this<br>  can be used to get clean counters after an incident, without having to<br>  restart nor to clear traffic counters. this command is restricted and can<br>  only be issued on sockets configured for levels “operator” or “admin”.</p>\n<p>clear counters all<br>  clear all statistics counters in each proxy (frontend &amp; backend) and in each<br>  server. this has the same effect as restarting. this command is restricted<br>  and can only be issued on sockets configured for level “admin”.</p>\n<p>clear acl <acl><br>  remove all entries from the acl <acl>. <acl> is the #<id> or the <file><br>  returned by “show acl”. note that if the reference <acl> is a file and is<br>  shared with a map, this map will be also cleared.</p>\n<p>clear map <map><br>  remove all entries from the map <map>. <map> is the #<id> or the <file><br>  returned by “show map”. note that if the reference <map> is a file and is<br>  shared with a acl, this acl will be also cleared.</p>\n<p>clear table <table> [ data.<type> <operator> <value> ] | [ key <key> ]<br>  remove entries from the stick-table <table>.</p>\n<p>  this is typically used to unblock some users complaining they have been<br>  abusively denied access to a service, but this can also be used to clear some<br>  stickiness entries matching a server that is going to be replaced (see “show<br>  table” below for details).  note that sometimes, removal of an entry will be<br>  refused because it is currently tracked by a session. retrying a few seconds<br>  later after the session ends is usual enough.</p>\n<p>  in the case where no options arguments are given all entries will be removed.</p>\n<p>  when the “data.” form is used entries matching a filter applied using the<br>  stored data (see “stick-table” in section 4.2) are removed.  a stored data<br>  type must be specified in <type>, and this data type must be stored in the<br>  table otherwise an error is reported. the data is compared according to<br>  <operator> with the 64-bit integer <value>.  operators are the same as with<br>  the acls :</p>\n<pre><code>- eq : match entries whose data is equal to this value\n- ne : match entries whose data is not equal to this value\n- le : match entries whose data is less than or equal to this value\n- ge : match entries whose data is greater than or equal to this value\n- lt : match entries whose data is less than this value\n- gt : match entries whose data is greater than this value\n</code></pre><p>  when the key form is used the entry <key> is removed.  the key must be of the<br>  same type as the table, which currently is limited to ipv4, ipv6, integer and<br>  string.</p>\n<p>  example :<br>        $ echo “show table http_proxy” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \\\n      bytes_out_rate(60000)=187\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;clear table http_proxy key 127.0.0.1&quot; | socat stdio /tmp/sock1\n\n    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:1\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n    $ echo &quot;clear table http_proxy data.gpc0 eq 1&quot; | socat stdio /tmp/sock1\n    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:1\n</code></pre><p>del acl <acl> [<key>|#<ref>]<br>  delete all the acl entries from the acl <acl> corresponding to the key <key>.<br>  <acl> is the #<id> or the <file> returned by “show acl”. if the <ref> is used,<br>  this command delete only the listed reference. the reference can be found with<br>  listing the content of the acl. note that if the reference <acl> is a file and<br>  is shared with a map, the entry will be also deleted in the map.</p>\n<p>del map <map> [<key>|#<ref>]<br>  delete all the map entries from the map <map> corresponding to the key <key>.<br>  <map> is the #<id> or the <file> returned by “show map”. if the <ref> is used,<br>  this command delete only the listed reference. the reference can be found with<br>  listing the content of the map. note that if the reference <map> is a file and<br>  is shared with a acl, the entry will be also deleted in the map.</p>\n<p>disable agent <backend>/<server><br>  mark the auxiliary agent check as temporarily stopped.</p>\n<p>  in the case where an agent check is being run as a auxiliary check, due<br>  to the agent-check parameter of a server directive, new checks are only<br>  initialised when the agent is in the enabled. thus, disable agent will<br>  prevent any new agent checks from begin initiated until the agent<br>  re-enabled using enable agent.</p>\n<p>  when an agent is disabled the processing of an auxiliary agent check that<br>  was initiated while the agent was set as enabled is as follows: all<br>  results that would alter the weight, specifically “drain” or a weight<br>  returned by the agent, are ignored. the processing of agent check is<br>  otherwise unchanged.</p>\n<p>  the motivation for this feature is to allow the weight changing effects<br>  of the agent checks to be paused to allow the weight of a server to be<br>  configured using set weight without being overridden by the agent.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable frontend <frontend><br>  mark the frontend as temporarily stopped. this corresponds to the mode which<br>  is used during a soft restart : the frontend releases the port but can be<br>  enabled again if needed. this should be used with care as some non-linux oses<br>  are unable to enable it back. this is intended to be used in environments<br>  where stopping a proxy is not even imaginable but a misconfigured proxy must<br>  be fixed. that way it’s possible to release the port and bind it into another<br>  process to restore operations. the frontend will appear with status “stop”<br>  on the stats page.</p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable health <backend>/<server><br>  mark the primary health check as temporarily stopped. this will disable<br>  sending of health checks, and the last health check result will be ignored.<br>  the server will be in unchecked state and considered up unless an auxiliary<br>  agent check forces it down.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>disable server <backend>/<server><br>  mark the server down for maintenance. in this mode, no more checks will be<br>  performed on the server until it leaves maintenance.<br>  if the server is tracked by other servers, those servers will be set to down<br>  during the maintenance.</p>\n<p>  in the statistics page, a server down for maintenance will appear with a<br>  “maint” status, its tracking servers with the “maint(via)” one.</p>\n<p>  both the backend and the server may be specified either by their name or by<br>  their numeric id, prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable agent <backend>/<server><br>  resume auxiliary agent check that was temporarily stopped.</p>\n<p>  see “disable agent” for details of the effect of temporarily starting<br>  and stopping an auxiliary agent.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable frontend <frontend><br>  resume a frontend which was temporarily stopped. it is possible that some of<br>  the listening ports won’t be able to bind anymore (eg: if another process<br>  took them since the ‘disable frontend’ operation). if this happens, an error<br>  is displayed. some operating systems might not be able to resume a frontend<br>  which was disabled.</p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable health <backend>/<server><br>  resume a primary health check that was temporarily stopped. this will enable<br>  sending of health checks again. please see “disable health” for details.</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>enable server <backend>/<server><br>  if the server was previously marked as down for maintenance, this marks the<br>  server up and checks are re-enabled.</p>\n<p>  both the backend and the server may be specified either by their name or by<br>  their numeric id, prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>get map <map> <value><br>get acl <acl> <value><br>  lookup the value <value> in the map <map> or in the acl <acl>. <map> or <acl><br>  are the #<id> or the <file> returned by “show map” or “show acl”. this command<br>  returns all the matching patterns associated with this map. this is useful for<br>  debugging maps and acls. the output format is composed by one line par<br>  matching type. each line is composed by space-delimited series of words.</p>\n<p>  the first two words are:</p>\n<pre><code>&lt;match method&gt;:   the match method applied. it can be &quot;found&quot;, &quot;bool&quot;,\n                  &quot;int&quot;, &quot;ip&quot;, &quot;bin&quot;, &quot;len&quot;, &quot;str&quot;, &quot;beg&quot;, &quot;sub&quot;, &quot;dir&quot;,\n                  &quot;dom&quot;, &quot;end&quot; or &quot;reg&quot;.\n\n&lt;match result&gt;:   the result. can be &quot;match&quot; or &quot;no-match&quot;.\n</code></pre><p>  the following words are returned only if the pattern matches an entry.</p>\n<pre><code>&lt;index type&gt;:     &quot;tree&quot; or &quot;list&quot;. the internal lookup algorithm.\n\n&lt;case&gt;:           &quot;case-insensitive&quot; or &quot;case-sensitive&quot;. the\n                  interpretation of the case.\n\n&lt;entry matched&gt;:  match=&quot;&lt;entry&gt;&quot;. return the matched pattern. it is\n                  useful with regular expressions.\n</code></pre><p>  the two last word are used to show the returned value and its type. with the<br>  “acl” case, the pattern doesn’t exist.</p>\n<pre><code>return=nothing:        no return because there are no &quot;map&quot;.\nreturn=&quot;&lt;value&gt;&quot;:      the value returned in the string format.\nreturn=cannot-display: the value cannot be converted as string.\n\ntype=&quot;&lt;type&gt;&quot;:         the type of the returned sample.\n</code></pre><p>get weight <backend>/<server><br>  report the current weight and the initial weight of server <server> in<br>  backend <backend> or an error if either doesn’t exist. the initial weight is<br>  the one that appears in the configuration file. both are normally equal<br>  unless the current weight has been changed. both the backend and the server<br>  may be specified either by their name or by their numeric id, prefixed with a<br>  sharp (‘#’).</p>\n<p>help<br>  print the list of known keywords and their basic usage. the same help screen<br>  is also displayed for unknown commands.</p>\n<p>prompt<br>  toggle the prompt at the beginning of the line and enter or leave interactive<br>  mode. in interactive mode, the connection is not closed after a command<br>  completes. instead, the prompt will appear again, indicating the user that<br>  the interpreter is waiting for a new command. the prompt consists in a right<br>  angle bracket followed by a space “&gt; “. this mode is particularly convenient<br>  when one wants to periodically check information such as stats or errors.<br>  it is also a good idea to enter interactive mode before issuing a “help”<br>  command.</p>\n<p>quit<br>  close the connection when in interactive mode.</p>\n<p>set map <map> [<key>|#<ref>] <value><br>  modify the value corresponding to each key <key> in a map <map>. <map> is the</p>\n<p>  #<id> or <file> returned by “show map”. if the <ref> is used in place of<br>  <key>, only the entry pointed by <ref> is changed. the new value is <value>.</p>\n<p>set maxconn frontend <frontend> <value><br>  dynamically change the specified frontend’s maxconn setting. any positive<br>  value is allowed including zero, but setting values larger than the global<br>  maxconn does not make much sense. if the limit is increased and connections<br>  were pending, they will immediately be accepted. if it is lowered to a value<br>  below the current number of connections, new connections acceptation will be<br>  delayed until the threshold is reached. the frontend might be specified by<br>  either its name or its numeric id prefixed with a sharp (‘#’).</p>\n<p>set maxconn global <maxconn><br>  dynamically change the global maxconn setting within the range defined by the<br>  initial global maxconn setting. if it is increased and connections were<br>  pending, they will immediately be accepted. if it is lowered to a value below<br>  the current number of connections, new connections acceptation will be<br>  delayed until the threshold is reached. a value of zero restores the initial<br>  setting.</p>\n<p>set rate-limit connections global <value><br>  change the process-wide connection rate limit, which is set by the global<br>  ‘maxconnrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of connections per second.</p>\n<p>set rate-limit http-compression global <value><br>  change the maximum input compression rate, which is set by the global<br>  ‘maxcomprate’ setting. a value of zero disables the limitation. the value is<br>  passed in number of kilobytes per second. the value is available in the “show<br>  info” on the line “compressbpsratelim” in bytes.</p>\n<p>set rate-limit sessions global <value><br>  change the process-wide session rate limit, which is set by the global<br>  ‘maxsessrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of sessions per second.</p>\n<p>set rate-limit ssl-sessions global <value><br>  change the process-wide ssl session rate limit, which is set by the global<br>  ‘maxsslrate’ setting. a value of zero disables the limitation. this limit<br>  applies to all frontends and the change has an immediate effect. the value<br>  is passed in number of sessions per second sent to the ssl stack. it applies<br>  before the handshake in order to protect the stack against handshake abuses.</p>\n<p>set server <backend>/<server> addr <ip4 or ip6 address><br>  replace the current ip address of a server by the one provided.</p>\n<p>set server <backend>/<server> agent [ up | down ]<br>  force a server’s agent to a new state. this can be useful to immediately<br>  switch a server’s state regardless of some slow agent checks for example.<br>  note that the change is propagated to tracking servers if any.</p>\n<p>set server <backend>/<server> health [ up | stopping | down ]<br>  force a server’s health to a new state. this can be useful to immediately<br>  switch a server’s state regardless of some slow health checks for example.<br>  note that the change is propagated to tracking servers if any.</p>\n<p>set server <backend>/<server> state [ ready | drain | maint ]<br>  force a server’s administrative state to a new state. this can be useful to<br>  disable load balancing and/or any traffic to a server. setting the state to<br>  “ready” puts the server in normal mode, and the command is the equivalent of<br>  the “enable server” command. setting the state to “maint” disables any traffic<br>  to the server as well as any health checks. this is the equivalent of the<br>  “disable server” command. setting the mode to “drain” only removes the server<br>  from load balancing but still allows it to be checked and to accept new<br>  persistent connections. changes are propagated to tracking servers if any.</p>\n<p>set server <backend>/<server> weight <weight>[%]<br>  change a server’s weight to the value passed in argument. this is the exact<br>  equivalent of the “set weight” command below.</p>\n<p>set ssl ocsp-response <response><br>  this command is used to update an ocsp response for a certificate (see “crt”<br>  on “bind” lines). same controls are performed as during the initial loading of<br>  the response. the <response> must be passed as a base64 encoded string of the<br>  der encoded response from the ocsp server.</p>\n<p>  example:<br>    openssl ocsp -issuer issuer.pem -cert server.pem \\<br>                 -host ocsp.issuer.com:80 -respout resp.der<br>    echo “set ssl ocsp-response $(base64 -w 10000 resp.der)” | \\<br>                 socat stdio /var/run/haproxy.stat</p>\n<p>set ssl tls-key <id> <tlskey><br>  set the next tls key for the <id> listener to <tlskey>. this key becomes the<br>  ultimate key, while the penultimate one is used for encryption (others just<br>  decrypt). the oldest tls key present is overwritten. <id> is either a numeric</p>\n<p>  #<id> or <file> returned by “show tls-keys”. <tlskey> is a base64 encoded 48<br>  bit tls ticket key (ex. openssl rand -base64 48).</p>\n<p>set table <table> key <key> [data.<data_type> <value>]*<br>  create or update a stick-table entry in the table. if the key is not present,<br>  an entry is inserted. see stick-table in section 4.2 to find all possible<br>  values for <data_type>. the most likely use consists in dynamically entering<br>  entries for source ip addresses, with a flag in gpc0 to dynamically block an<br>  ip address or affect its quality of service. it is possible to pass multiple<br>  data_types in a single call.</p>\n<p>set timeout cli <delay><br>  change the cli interface timeout for current connection. this can be useful<br>  during long debugging sessions where the user needs to constantly inspect<br>  some indicators without being disconnected. the delay is passed in seconds.</p>\n<p>set weight <backend>/<server> <weight>[%]<br>  change a server’s weight to the value passed in argument. if the value ends<br>  with the ‘%’ sign, then the new weight will be relative to the initially<br>  configured weight.  absolute weights are permitted between 0 and 256.<br>  relative weights must be positive with the resulting absolute weight is<br>  capped at 256.  servers which are part of a farm running a static<br>  load-balancing algorithm have stricter limitations because the weight<br>  cannot change once set. thus for these servers, the only accepted values<br>  are 0 and 100% (or 0 and the initial weight). changes take effect<br>  immediately, though certain lb algorithms require a certain amount of<br>  requests to consider changes. a typical usage of this command is to<br>  disable a server during an update by setting its weight to zero, then to<br>  enable it again after the update by setting it back to 100%. this command<br>  is restricted and can only be issued on sockets configured for level<br>  “admin”. both the backend and the server may be specified either by their<br>  name or by their numeric id, prefixed with a sharp (‘#’).</p>\n<p>show errors [<iid>]<br>  dump last known request and response errors collected by frontends and<br>  backends. if <iid> is specified, the limit the dump to errors concerning<br>  either frontend or backend whose id is <iid>. this command is restricted<br>  and can only be issued on sockets configured for levels “operator” or<br>  “admin”.</p>\n<p>  the errors which may be collected are the last request and response errors<br>  caused by protocol violations, often due to invalid characters in header<br>  names. the report precisely indicates what exact character violated the<br>  protocol. other important information such as the exact date the error was<br>  detected, frontend and backend names, the server name (when known), the<br>  internal session id and the source address which has initiated the session<br>  are reported too.</p>\n<p>  all characters are returned, and non-printable characters are encoded. the<br>  most common ones (\\t = 9, \\n = 10, \\r = 13 and \\e = 27) are encoded as one<br>  letter following a backslash. the backslash itself is encoded as ‘\\‘ to<br>  avoid confusion. other non-printable characters are encoded ‘\\xnn’ where<br>  nn is the two-digits hexadecimal representation of the character’s ascii<br>  code.</p>\n<p>  lines are prefixed with the position of their first character, starting at 0<br>  for the beginning of the buffer. at most one input line is printed per line,<br>  and large lines will be broken into multiple consecutive output lines so that<br>  the output never goes beyond 79 characters wide. it is easy to detect if a<br>  line was broken, because it will not end with ‘\\n’ and the next line’s offset<br>  will be followed by a ‘+’ sign, indicating it is a continuation of previous<br>  line.</p>\n<p>  example :<br>        $ echo “show errors” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; [04/mar/2009:15:46:56.081] backend http-in (#2) : invalid response\n      src 127.0.0.1, session #54, frontend fe-eth0 (#1), server s2 (#1)\n      response length 213 bytes, error at position 23:\n\n      00000  http/1.0 200 ok\\r\\n\n      00017  header/bizarre:blah\\r\\n\n      00038  location: blah\\r\\n\n      00054  long-line: this is a very long line which should b\n      00104+ e broken into multiple lines on the output buffer,\n      00154+  otherwise it would be too large to print in a ter\n      00204+ minal\\r\\n\n      00211  \\r\\n\n\nin the example above, we see that the backend &quot;http-in&quot; which has internal\nid 2 has blocked an invalid response from its server s2 which has internal\nid 1\\. the request was on session 54 initiated by source 127.0.0.1 and\nreceived by frontend fe-eth0 whose id is 1\\. the total response length was\n213 bytes when the error was detected, and the error was at byte 23\\. this\nis the slash (&apos;/&apos;) in header name &quot;header/bizarre&quot;, which is not a valid\nhttp character for a header name.\n</code></pre><p>show info<br>  dump info about haproxy status on current process.</p>\n<p>show map [<map>]<br>  dump info about map converters. without argument, the list of all available<br>  maps is returned. if a <map> is specified, its contents are dumped. <map> is<br>  the #<id> or <file>. the first column is a unique identifier. it can be used<br>  as reference for the operation “del map” and “set map”. the second column is<br>  the pattern and the third column is the sample if available. the data returned<br>  are not directly a list of available maps, but are the list of all patterns<br>  composing any map. many of these patterns can be shared with acl.</p>\n<p>show acl [<acl>]<br>  dump info about acl converters. without argument, the list of all available<br>  acls is returned. if a <acl> is specified, its contents are dumped. <acl> if<br>  the #<id> or <file>. the dump format is the same than the map even for the<br>  sample value. the data returned are not a list of available acl, but are the<br>  list of all patterns composing any acl. many of these patterns can be shared<br>  with maps.</p>\n<p>show pools<br>  dump the status of internal memory pools. this is useful to track memory<br>  usage when suspecting a memory leak for example. it does exactly the same<br>  as the sigquit when running in foreground except that it does not flush<br>  the pools.</p>\n<p>show sess<br>  dump all known sessions. avoid doing this on slow connections as this can<br>  be huge. this command is restricted and can only be issued on sockets<br>  configured for levels “operator” or “admin”.</p>\n<p>show sess <id><br>  display a lot of internal information about the specified session identifier.<br>  this identifier is the first field at the beginning of the lines in the dumps<br>  of “show sess” (it corresponds to the session pointer). those information are<br>  useless to most users but may be used by haproxy developers to troubleshoot a<br>  complex bug. the output format is intentionally not documented so that it can<br>  freely evolve depending on demands. you may find a description of all fields<br>  returned in src/dumpstats.c</p>\n<p>  the special id “all” dumps the states of all sessions, which must be avoided<br>  as much as possible as it is highly cpu intensive and can take a lot of time.</p>\n<p>show stat [<iid> <type> <sid>]<br>  dump statistics in the csv format. by passing <id>, <type> and <sid>, it is<br>  possible to dump only selected items :</p>\n<pre><code>- &lt;iid&gt; is a proxy id, -1 to dump everything\n- &lt;type&gt; selects the type of dumpable objects : 1 for frontends, 2 for\n   backends, 4 for servers, -1 for everything. these values can be ored,\n   for example:\n      1 + 2     = 3   -&gt; frontend + backend.\n      1 + 2 + 4 = 7   -&gt; frontend + backend + server.\n- &lt;sid&gt; is a server id, -1 to dump everything from the selected proxy.\n</code></pre><p>  example :<br>        $ echo “show info;show stat” | socat stdio unix-connect:/tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; name: haproxy\n    version: 1.4-dev2-49\n    release_date: 2009/09/23\n    nbproc: 1\n    process_num: 1\n    (...)\n\n    # pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)\n    stats,frontend,,,0,0,1000,0,0,0,0,0,0,,,,,open,,,,,,,,,1,1,0, (...)\n    stats,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,0,0,0,,0,250,(...)\n    (...)\n    www1,backend,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,up,1,1,0,,0,250, (...)\n\n    $\n\nhere, two commands have been issued at once. that way it&apos;s easy to find\nwhich process the stats apply to in multi-process mode. notice the empty\nline after the information output which marks the end of the first block.\na similar empty line appears at the end of the second block (stats) so that\nthe reader knows the output has not been truncated.\n</code></pre><p>show stat resolvers <resolvers section id><br>  dump statistics for the given resolvers section.<br>  for each name server, the following counters are reported:<br>    sent: number of dns requests sent to this server<br>    valid: number of dns valid responses received from this server<br>    update: number of dns responses used to update the server’s ip address<br>    cname: number of cname responses<br>    cname_error: cname errors encountered with this server<br>    any_err: number of empty response (ie: server does not support any type)<br>    nx: non existent domain response received from this server<br>    timeout: how many time this server did not answer in time<br>    refused: number of requests refused by this server<br>    other: any other dns errors<br>    invalid: invalid dns response (from a protocol point of view)<br>    too_big: too big response<br>    outdated: number of response arrived too late (after an other name server)<br>show table<br>  dump general information on all known stick-tables. their name is returned<br>  (the name of the proxy which holds them), their type (currently zero, always<br>  ip), their size in maximum possible number of entries, and the number of<br>  entries currently in use.</p>\n<p>  example :<br>        $ echo “show table” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: front_pub, type: ip, size:204800, used:171454\n&gt;&gt;&gt; # table: back_rdp, type: ip, size:204800, used:0\n</code></pre><p>show table <name> [ data.<type> <operator> <value> ] | [ key <key> ]<br>  dump contents of stick-table <name>. in this mode, a first line of generic<br>  information about the table is reported as with “show table”, then all<br>  entries are dumped. since this can be quite heavy, it is possible to specify<br>  a filter in order to specify what entries to display.</p>\n<p>  when the “data.” form is used the filter applies to the stored data (see<br>  “stick-table” in section 4.2).  a stored data type must be specified<br>  in <type>, and this data type must be stored in the table otherwise an<br>  error is reported. the data is compared according to <operator> with the<br>  64-bit integer <value>.  operators are the same as with the acls :</p>\n<pre><code>- eq : match entries whose data is equal to this value\n- ne : match entries whose data is not equal to this value\n- le : match entries whose data is less than or equal to this value\n- ge : match entries whose data is greater than or equal to this value\n- lt : match entries whose data is less than this value\n- gt : match entries whose data is greater than this value\n</code></pre><p>  when the key form is used the entry <key> is shown.  the key must be of the<br>  same type as the table, which currently is limited to ipv4, ipv6, integer,<br>  and string.</p>\n<p>  example :<br>        $ echo “show table http_proxy” | socat stdio /tmp/sock1</p>\n<pre><code>&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \\\n      bytes_out_rate(60000)=187\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy data.gpc0 gt 0&quot; | socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy data.conn_rate gt 5&quot; | \\\n        socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo &quot;show table http_proxy key 127.0.0.2&quot; | \\\n        socat stdio /tmp/sock1\n&gt;&gt;&gt; # table: http_proxy, type: ip, size:204800, used:2\n&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n</code></pre><p>  when the data criterion applies to a dynamic value dependent on time such as<br>  a bytes rate, the value is dynamically computed during the evaluation of the<br>  entry in order to decide whether it has to be dumped or not. this means that<br>  such a filter could match for some time then not match anymore because as<br>  time goes, the average event rate drops.</p>\n<p>  it is possible to use this to extract lists of ip addresses abusing the<br>  service, in order to monitor them or even blacklist them in a firewall.<br>  example :<br>        $ echo “show table http_proxy data.gpc0 gt 0” \\<br>          | socat stdio /tmp/sock1 \\<br>          | fgrep ‘key=’ | cut -d’ ‘ -f2 | cut -d= -f2 &gt; abusers-ip.txt<br>          ( or | awk ‘/key/{ print a[split($2,a,”=”)]; }’ )</p>\n<p>show tls-keys<br>  dump all loaded tls ticket keys. the tls ticket key reference id and the<br>  file from which the keys have been loaded is shown. both of those can be<br>  used to update the tls keys using “set ssl tls-key”.</p>\n<p>shutdown frontend <frontend><br>  completely delete the specified frontend. all the ports it was bound to will<br>  be released. it will not be possible to enable the frontend anymore after<br>  this operation. this is intended to be used in environments where stopping a<br>  proxy is not even imaginable but a misconfigured proxy must be fixed. that<br>  way it’s possible to release the port and bind it into another process to<br>  restore operations. the frontend will not appear at all on the stats page<br>  once it is terminated.</p>\n<p>  the frontend may be specified either by its name or by its numeric id,<br>  prefixed with a sharp (‘#’).</p>\n<p>  this command is restricted and can only be issued on sockets configured for<br>  level “admin”.</p>\n<p>shutdown session <id><br>  immediately terminate the session matching the specified session identifier.<br>  this identifier is the first field at the beginning of the lines in the dumps<br>  of “show sess” (it corresponds to the session pointer). this can be used to<br>  terminate a long-running session without waiting for a timeout or when an<br>  endless transfer is ongoing. such terminated sessions are reported with a ‘k’<br>  flag in the logs.</p>\n<p>shutdown sessions server <backend>/<server><br>  immediately terminate all the sessions attached to the specified server. this<br>  can be used to terminate long-running sessions after a server is put into<br>  maintenance mode, for instance. such terminated sessions are reported with a<br>  ‘k’ flag in the logs.</p>\n<p>/*</p>\n<ul>\n<li>local variables:</li>\n<li>fill-column: 79</li>\n<li>end:<br>*/</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cit5klxtb000b7sqve4r0psla","tag_id":"cit5klxtq000d7sqvbehvr2k2","_id":"cit5klxum000o7sqvozlpc9rf"},{"post_id":"cit5klxtb000b7sqve4r0psla","tag_id":"cit5klxu6000g7sqv4q7fqfm3","_id":"cit5klxum000q7sqvxpcxi5ky"},{"post_id":"cit5klxtb000b7sqve4r0psla","tag_id":"cit5klxum000k7sqvf6an9b60","_id":"cit5klxv1000s7sqv8miqxkv5"},{"post_id":"cit5klxum000p7sqvqbxyrzto","tag_id":"cit5klxv1000t7sqvmoaa7v08","_id":"cit5klxvh00107sqv1ubiltu5"},{"post_id":"cit5klxum000p7sqvqbxyrzto","tag_id":"cit5klxv1000w7sqvokd6bq7u","_id":"cit5klxvh00117sqvklslrlob"},{"post_id":"cit5klxum000p7sqvqbxyrzto","tag_id":"cit5klxvh000z7sqvi7syind4","_id":"cit5klxvh00127sqv6n6rql62"}],"Tag":[{"name":"bash","_id":"cit5klxtq000d7sqvbehvr2k2"},{"name":"case","_id":"cit5klxu6000g7sqv4q7fqfm3"},{"name":"command","_id":"cit5klxum000k7sqvf6an9b60"},{"name":"SSO","_id":"cit5klxv1000t7sqvmoaa7v08"},{"name":"SESSION 共享","_id":"cit5klxv1000w7sqvokd6bq7u"},{"name":"Cookie作用域","_id":"cit5klxvh000z7sqvi7syind4"}]}}